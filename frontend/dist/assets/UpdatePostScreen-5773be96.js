import{g as Q,r as o,u as W,w as J,aG as K,t as X,j as e,z as Z,B as a,v as O,l as y,e as ee,Q as i}from"./index-6686ab90.js";import{F as te}from"./FormContainer-34eecb5f.js";import{C as se}from"./RemovePostConfirm-e1807ec3.js";import{R as ae}from"./Row-56c8e548.js";const ie=()=>{const{postId:m}=Q(),[F,B]=o.useState([]),[g,I]=o.useState(""),[p,L]=o.useState(""),[h,P]=o.useState(""),[x,d]=o.useState([]),[w,R]=o.useState(""),[b,S]=o.useState(""),[D,N]=o.useState(""),[T,j]=o.useState([]),[C,u]=o.useState(!1),[G,f]=o.useState(null),[k,v]=o.useState(!1),z=W(),[U]=J(),[M]=K(),[A]=X();o.useEffect(()=>{(async()=>{try{const[s,r]=await Promise.all([U(m),A()]),l=s.data;I(l.title),L(l.description),P(l.category._id),d(l.images),R(l.latitude),S(l.longitude),N(l.address),B(r.data.categoryData),j(l.images.map(n=>n))}catch(s){console.error("Error fetching data:",s)}})()},[A,U,m]);const _=t=>{const s=Array.from(t.target.files);if(!s.every(n=>n.type.startsWith("image/"))){i.error("Please upload only image files.");return}const l=s.map(n=>URL.createObjectURL(n));j(n=>[...n,...l]),s.forEach(n=>{if(n instanceof File){const c=new FileReader;c.readAsDataURL(n),c.onloadend=()=>{d(H=>[...H,{url:c.result,isCloudinary:!1}])}}else typeof n=="string"&&d(c=>[...c,{url:n,isCloudinary:!0}])})},$=t=>{const s=t.target.value;P(s)},E=t=>{f(t),v(!0)},V=()=>{d(t=>{const s=[...t];return s.splice(G,1),s}),j(t=>{const s=[...t];return s.splice(G,1),s}),f(null),v(!1)},Y=()=>{f(null),v(!1)},q=async t=>{if(t.preventDefault(),!g.trim()||!p.trim()||!h||x.length===0){i.error("Please fill out all required fields.");return}if(x.length>3){i.error("You can upload up to 3 images.");return}const s={title:g,description:p,category:h,images:x.map(r=>({url:r.url,isCloudinary:r.isCloudinary,isNew:!r.isCloudinary})),latitude:w,longitude:b,address:D};try{u(!0);const r=await M({postId:m,postData:s}).unwrap();r.error?(u(!1),i.error(r.error.data.message)):(u(!1),i.success("Post Updated successfully")),z(`/postDetails/${r.postId}`)}catch(r){u(!1),i.error(r.data.message),console.error("Error updating post:",r)}};return e.jsx(Z,{children:e.jsx("div",{children:e.jsxs(te,{children:[e.jsx("h1",{children:"Update Post"}),e.jsxs(a,{onSubmit:q,children:[e.jsxs(a.Group,{className:"my-2",controlId:"title",children:[e.jsx(a.Label,{children:"Title"}),e.jsx(a.Control,{type:"text",placeholder:"Enter Title",value:g,onChange:t=>I(t.target.value)})]}),e.jsxs(a.Group,{className:"my-2",controlId:"description",children:[e.jsx(a.Label,{children:"Description"}),e.jsx(a.Control,{type:"text",placeholder:"Enter Description",value:p,onChange:t=>L(t.target.value)})]}),e.jsxs(a.Group,{className:"my-2",controlId:"category",children:[e.jsx(a.Label,{children:"Category"}),e.jsx(a.Control,{as:"select",value:h,onChange:$,children:F.map(t=>e.jsx("option",{value:t._id,children:t.name},t._id))})]}),e.jsxs(a.Group,{className:"my-2",controlId:"images",children:[e.jsx(a.Label,{children:"Uploaded Images"}),e.jsx(ae,{className:"mt-3",children:T.map((t,s)=>e.jsx(O,{xs:4,className:"mb-3",children:t.url?e.jsxs("div",{children:[e.jsx("img",{src:t.url,alt:`Preview ${s+1}`,style:{width:"100%",height:"150px",objectFit:"cover"}}),e.jsx(y,{variant:"danger",size:"sm",className:"mt-2",onClick:()=>E(s),children:"Remove"})]}):e.jsxs("div",{children:[e.jsx("img",{src:t,alt:`New Preview ${s+1}`,style:{width:"100%",height:"150px",objectFit:"cover"}}),e.jsx(y,{variant:"danger",size:"sm",className:"mt-2",onClick:()=>E(s),children:"Remove"})]})},s))}),k&&e.jsx(se,{onConfirm:V,onCancel:Y}),e.jsx(a.Control,{className:"mt-5",type:"file",multiple:!0,name:"images",onChange:_})]}),e.jsxs(a.Group,{controlId:"latitude",children:[e.jsx(a.Label,{children:"Latitude"}),e.jsx(a.Control,{as:"textarea",placeholder:"Latitude",value:w,onChange:t=>R(t.target.value)})]}),e.jsxs(a.Group,{controlId:"longitude",children:[e.jsx(a.Label,{children:"Longitude"}),e.jsx(a.Control,{as:"textarea",placeholder:"Longitude",value:b,onChange:t=>S(t.target.value)})]}),e.jsxs(a.Group,{controlId:"address",children:[e.jsx(a.Label,{children:"Address"}),e.jsx(a.Control,{as:"textarea",placeholder:"Add Your Address",value:D,onChange:t=>N(t.target.value)})]}),C&&e.jsx(ee,{}),e.jsx(y,{type:"submit",variant:"primary",className:"mt-3",disabled:C,children:C?"Updating...":"Update"})]})]})})})};export{ie as default};
