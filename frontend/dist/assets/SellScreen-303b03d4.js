import{r as o,q,t as B,u as M,j as t,B as s,v as _,e as H,l as J,Q as l}from"./index-11072bc1.js";import{F as Q}from"./FormContainer-bb58c15d.js";import{R as k}from"./Row-e9e20baa.js";const V=()=>{const[I,w]=o.useState([]),[c,A]=o.useState(""),[d,P]=o.useState(""),[u,E]=o.useState(""),[g,p]=o.useState([]),[G,h]=o.useState([]),[R]=q(),[D]=B(),[m,C]=o.useState(""),[x,y]=o.useState(""),[f,F]=o.useState(""),[j,v]=o.useState(!1),N=M();o.useEffect(()=>{navigator.geolocation?navigator.permissions.query({name:"geolocation"}).then(function(e){e.state==="granted"||e.state==="prompt"?navigator.geolocation.getCurrentPosition(b,S,L):e.state}):console.log("Geolocation is not supported by this browser.")},[]),o.useEffect(()=>{(async()=>{try{const n=(await D()).data.categoryData;w(n)}catch(a){console.error("Error fetching categories:",a)}})()},[]);const U=e=>{const a=Array.from(e.target.files),n=a.map(r=>URL.createObjectURL(r));for(let r=0;r<a.length;r++)if(a[r].type.split("/")[0]!=="image"){l.error("Please upload only images (JPEG, PNG, etc.)."),h([]),p([]),e.target.value=null;return}if(a.length>3){l.error("You can upload up to 3 images."),e.target.value=null,h([]),p([]);return}a.forEach(r=>{const i=new FileReader;i.readAsDataURL(r),i.onloadend=()=>{p($=>[...$,i.result])}}),h(n)},Y=e=>{const a=e.target.value;E(a)},T=async e=>{if(e.preventDefault(),!c.trim()||!d.trim()||!u||g.length===0){l.error("Please fill out all required fields.");return}if(g.length>3){l.error("You can upload up to 3 images.");return}try{v(!0);const a=new FormData;a.append("title",c),a.append("description",d),a.append("category",u),g.forEach((r,i)=>{a.append("images",r)}),a.append("latitude",m),a.append("longitude",x),a.append("address",f);const n=await R({title:c,description:d,categoryId:u,images:g,accessLatitude:m,accessLongitude:x,address:f}).unwrap();n&&(v(!1),p([]),l.success("Product added successfully"),N(`/postDetails/${n.postId}`))}catch(a){v(!1),console.error("Error adding product:",a),l.error(a.data.error)}};var L={enableHighAccuracy:!0,timeout:5e3,maximumAge:0};function b(e){var a=e.coords;console.log("Your current position is:",a),C(a.latitude),y(a.longitude)}function S(e){console.warn(`ERROR(${e.code}): ${e.message}`)}return t.jsxs(Q,{children:[t.jsx("h1",{children:"Sell Your Art"}),t.jsxs(s,{onSubmit:T,children:[t.jsxs(s.Group,{controlId:"title",children:[t.jsx(s.Label,{children:"Title"}),t.jsx(s.Control,{type:"text",placeholder:"Enter title",value:c,onChange:e=>A(e.target.value)})]}),t.jsxs(s.Group,{controlId:"description",children:[t.jsx(s.Label,{children:"Description"}),t.jsx(s.Control,{as:"textarea",placeholder:"Enter description",value:d,onChange:e=>P(e.target.value)})]}),t.jsxs(s.Group,{controlId:"category",children:[t.jsx(s.Label,{children:"Category"}),t.jsxs(s.Control,{as:"select",value:u,onChange:Y,children:[t.jsx("option",{value:"",children:"Select category"}),I.map(e=>t.jsx("option",{value:e._id,children:e.name},e._id))]})]}),t.jsxs(s.Group,{controlId:"images",children:[t.jsx(s.Label,{children:"Upload Images"}),t.jsx(s.Control,{type:"file",multiple:!0,name:"images",onChange:U}),t.jsx(k,{className:"mt-3",children:G.map((e,a)=>t.jsx(_,{xs:4,className:"mb-3",children:t.jsx("img",{src:e,alt:`Preview ${a+1}`,style:{width:"100%",height:"100%"}})},a))})]}),t.jsxs(s.Group,{controlId:"latitude",children:[t.jsx(s.Label,{children:"Latitude"}),t.jsx(s.Control,{as:"textarea",placeholder:"Latitude",value:m,onChange:e=>C(e.target.value)})]}),t.jsxs(s.Group,{controlId:"longitude",children:[t.jsx(s.Label,{children:"Longitude"}),t.jsx(s.Control,{as:"textarea",placeholder:"Longitude",value:x,onChange:e=>y(e.target.value)})]}),t.jsxs(s.Group,{controlId:"address",children:[t.jsx(s.Label,{children:"Address"}),t.jsx(s.Control,{as:"textarea",placeholder:"Add Your Address",value:f,onChange:e=>F(e.target.value)})]}),j&&t.jsx(H,{}),t.jsx(J,{type:"submit",variant:"primary",className:"mt-3",disabled:j,children:j?"Uploading...":"Add Product"})]})]})};export{V as default};
