import{r as reactExports,j as jsxRuntimeExports,B as BootstrapForm,l as Button,d as useSelector,g as useParams,u as useNavigate,w as useGetPostByIdMutation,x as useRemovePostMutation,y as useReportPostMutation,z as ChakraProvider,A as Container,v as Col,F as FaArrowLeft,D as FaArrowRight,Q,E as Button$1}from"./index-6686ab90.js";import{C as ChatButton}from"./ChatButton-fe0c04aa.js";import{R as Row}from"./Row-56c8e548.js";import{C as ConfirmationDialog}from"./RemovePostConfirm-e1807ec3.js";import{M as Modal}from"./Modal-39d65b8e.js";(function(){var p,aa=[];function ba(e){return function(){return aa[e].apply(this,arguments)}}function ca(e,r){return aa[e]=r}function da(e){var r=0;return function(){return r<e.length?{done:!1,value:e[r++]}:{done:!0}}}function ea(e){var r=typeof Symbol<"u"&&Symbol.iterator&&e[Symbol.iterator];return r?r.call(e):{next:da(e)}}function fa(e){for(var r,n=[];!(r=e.next()).done;)n.push(r.value);return n}var ia=typeof Object.defineProperties=="function"?Object.defineProperty:function(e,r,n){e!=Array.prototype&&e!=Object.prototype&&(e[r]=n.value)},ja=typeof window<"u"&&window===this?this:typeof global<"u"&&global!=null?global:this;function ka(e,r){if(r){var n=ja;e=e.split(".");for(var o=0;o<e.length-1;o++){var s=e[o];s in n||(n[s]={}),n=n[s]}e=e[e.length-1],o=n[e],r=r(o),r!=o&&r!=null&&ia(n,e,{configurable:!0,writable:!0,value:r})}}ka("Array.prototype.find",function(e){return e||function(r,n){t:{var o=this;o instanceof String&&(o=String(o));for(var s=o.length,l=0;l<s;l++){var h=o[l];if(r.call(n,h,l,o)){r=h;break t}}r=void 0}return r}});function la(){la=function(){},ja.Symbol||(ja.Symbol=ma)}function na(e,r){this.a=e,ia(this,"description",{configurable:!0,writable:!0,value:r})}na.prototype.toString=function(){return this.a};var ma=function(){function e(n){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new na("jscomp_symbol_"+(n||"")+"_"+r++,n)}var r=0;return e}();function oa(){la();var e=ja.Symbol.iterator;e||(e=ja.Symbol.iterator=ja.Symbol("Symbol.iterator")),typeof Array.prototype[e]!="function"&&ia(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return pa(da(this))}}),oa=function(){}}function pa(e){return oa(),e={next:e},e[ja.Symbol.iterator]=function(){return this},e}function qa(e,r){oa(),e instanceof String&&(e+="");var n=0,o={next:function(){if(n<e.length){var s=n++;return{value:r(s,e[s]),done:!1}}return o.next=function(){return{done:!0,value:void 0}},o.next()}};return o[Symbol.iterator]=function(){return o},o}ka("Array.prototype.keys",function(e){return e||function(){return qa(this,function(r){return r})}});var ra;if(typeof Object.setPrototypeOf=="function")ra=Object.setPrototypeOf;else{var sa;t:{var ta={Fg:!0},ua={};try{ua.__proto__=ta,sa=ua.Fg;break t}catch{}sa=!1}ra=sa?function(e,r){if(e.__proto__=r,e.__proto__!==r)throw new TypeError(e+" is not extensible");return e}:null}var va=ra;ka("Object.setPrototypeOf",function(e){return e||va}),ka("Object.values",function(e){return e||function(r){var n=[],o;for(o in r)Object.prototype.hasOwnProperty.call(r,o)&&n.push(r[o]);return n}}),ka("Object.is",function(e){return e||function(r,n){return r===n?r!==0||1/r===1/n:r!==r&&n!==n}}),ka("Array.prototype.includes",function(e){return e||function(r,n){var o=this;o instanceof String&&(o=String(o));var s=o.length;for(n=n||0,0>n&&(n=Math.max(n+s,0));n<s;n++){var l=o[n];if(l===r||Object.is(l,r))return!0}return!1}}),ka("Promise",function(e){function r(h){this.C=0,this.b=void 0,this.a=[];var d=this.c();try{h(d.resolve,d.reject)}catch(y){d.reject(y)}}function n(){this.a=null}function o(h){return h instanceof r?h:new r(function(d){d(h)})}if(e)return e;n.prototype.b=function(h){if(this.a==null){this.a=[];var d=this;this.c(function(){d.g()})}this.a.push(h)};var s=ja.setTimeout;n.prototype.c=function(h){s(h,0)},n.prototype.g=function(){for(;this.a&&this.a.length;){var h=this.a;this.a=[];for(var d=0;d<h.length;++d){var y=h[d];h[d]=null;try{y()}catch(g){this.f(g)}}}this.a=null},n.prototype.f=function(h){this.c(function(){throw h})},r.prototype.c=function(){function h(g){return function(v){y||(y=!0,g.call(d,v))}}var d=this,y=!1;return{resolve:h(this.m),reject:h(this.f)}},r.prototype.m=function(h){if(h===this)this.f(new TypeError("A Promise cannot resolve to itself"));else if(h instanceof r)this.U(h);else{t:switch(typeof h){case"object":var d=h!=null;break t;case"function":d=!0;break t;default:d=!1}d?this.s(h):this.g(h)}},r.prototype.s=function(h){var d=void 0;try{d=h.then}catch(y){this.f(y);return}typeof d=="function"?this.u(d,h):this.g(h)},r.prototype.f=function(h){this.i(2,h)},r.prototype.g=function(h){this.i(1,h)},r.prototype.i=function(h,d){if(this.C!=0)throw Error("Cannot settle("+h+", "+d+"): Promise already settled in state"+this.C);this.C=h,this.b=d,this.l()},r.prototype.l=function(){if(this.a!=null){for(var h=0;h<this.a.length;++h)l.b(this.a[h]);this.a=null}};var l=new n;return r.prototype.U=function(h){var d=this.c();h.sf(d.resolve,d.reject)},r.prototype.u=function(h,d){var y=this.c();try{h.call(d,y.resolve,y.reject)}catch(g){y.reject(g)}},r.prototype.then=function(h,d){function y(w,I){return typeof w=="function"?function(V){try{g(w(V))}catch(q){v(q)}}:I}var g,v,m=new r(function(w,I){g=w,v=I});return this.sf(y(h,g),y(d,v)),m},r.prototype.catch=function(h){return this.then(void 0,h)},r.prototype.sf=function(h,d){function y(){switch(g.C){case 1:h(g.b);break;case 2:d(g.b);break;default:throw Error("Unexpected state: "+g.C)}}var g=this;this.a==null?l.b(y):this.a.push(y)},r.resolve=o,r.reject=function(h){return new r(function(d,y){y(h)})},r.race=function(h){return new r(function(d,y){for(var g=ea(h),v=g.next();!v.done;v=g.next())o(v.value).sf(d,y)})},r.all=function(h){var d=ea(h),y=d.next();return y.done?o([]):new r(function(g,v){function m(V){return function(q){w[V]=q,I--,I==0&&g(w)}}var w=[],I=0;do w.push(void 0),I++,o(y.value).sf(m(w.length-1),v),y=d.next();while(!y.done)})},r}),ka("Object.entries",function(e){return e||function(r){var n=[],o;for(o in r)Object.prototype.hasOwnProperty.call(r,o)&&n.push([o,r[o]]);return n}});var wa=typeof Object.assign=="function"?Object.assign:function(e,r){for(var n=1;n<arguments.length;n++){var o=arguments[n];if(o)for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e};ka("Object.assign",function(e){return e||wa}),ka("Math.log2",function(e){return e||function(r){return Math.log(r)/Math.LN2}});var xa=this||self;function ya(e,r,n){e=e.split("."),n=n||xa,e[0]in n||typeof n.execScript>"u"||n.execScript("var "+e[0]);for(var o;e.length&&(o=e.shift());)e.length||r===void 0?n[o]&&n[o]!==Object.prototype[o]?n=n[o]:n=n[o]={}:n[o]=r}function za(){}function Aa(e){var r=typeof e;if(r=="object")if(e){if(e instanceof Array)return"array";if(e instanceof Object)return r;var n=Object.prototype.toString.call(e);if(n=="[object Window]")return"object";if(n=="[object Array]"||typeof e.length=="number"&&typeof e.splice<"u"&&typeof e.propertyIsEnumerable<"u"&&!e.propertyIsEnumerable("splice"))return"array";if(n=="[object Function]"||typeof e.call<"u"&&typeof e.propertyIsEnumerable<"u"&&!e.propertyIsEnumerable("call"))return"function"}else return"null";else if(r=="function"&&typeof e.call>"u")return"object";return r}function Ca(e){var r=Aa(e);return r=="array"||r=="object"&&typeof e.length=="number"}function Da(e){return Aa(e)=="function"}function Ea(e){var r=typeof e;return r=="object"&&e!=null||r=="function"}var Ga="closure_uid_"+(1e9*Math.random()>>>0),Ha=0;function Ia(e,r,n){return e.call.apply(e.bind,arguments)}function Ja(e,r,n){if(!e)throw Error();if(2<arguments.length){var o=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,o),e.apply(r,s)}}return function(){return e.apply(r,arguments)}}function Ka(e,r,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Ka=Ia:Ka=Ja,Ka.apply(null,arguments)}function La(e,r){var n=Array.prototype.slice.call(arguments,1);return function(){var o=n.slice();return o.push.apply(o,arguments),e.apply(this,o)}}function t(e,r){ya(e,r,void 0)}function u(e,r){function n(){}n.prototype=r.prototype,e.j=r.prototype,e.prototype=new n,e.prototype.constructor=e,e.ap=function(o,s,l){for(var h=Array(arguments.length-2),d=2;d<arguments.length;d++)h[d-2]=arguments[d];return r.prototype[s].apply(o,h)}}function Ma(e){if(Error.captureStackTrace)Error.captureStackTrace(this,Ma);else{var r=Error().stack;r&&(this.stack=r)}e&&(this.message=String(e))}u(Ma,Error),Ma.prototype.name="CustomError";function Na(e,r){this.c=e,this.f=r,this.b=0,this.a=null}Na.prototype.get=function(){if(0<this.b){this.b--;var e=this.a;this.a=e.next,e.next=null}else e=this.c();return e},Na.prototype.put=function(e){this.f(e),100>this.b&&(this.b++,e.next=this.a,this.a=e)};function Oa(){this.b=this.a=null}var Qa=new Na(function(){return new Pa},function(e){e.reset()});Oa.prototype.add=function(e,r){var n=Qa.get();n.set(e,r),this.b?this.b.next=n:this.a=n,this.b=n},Oa.prototype.remove=function(){var e=null;return this.a&&(e=this.a,this.a=this.a.next,this.a||(this.b=null),e.next=null),e};function Pa(){this.next=this.b=this.a=null}Pa.prototype.set=function(e,r){this.a=e,this.b=r,this.next=null},Pa.prototype.reset=function(){this.next=this.b=this.a=null};var Ra=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function Sa(e,r){return e.indexOf(r)!=-1}function Ta(e,r){return e<r?-1:e>r?1:0}function Ua(e,r){for(var n in e)if(r.call(void 0,e[n],n,e))return!0;return!1}function Va(e){for(var r in e)return!1;return!0}function Wa(e){var r={},n;for(n in e)r[n]=e[n];return r}var Xa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ya(e,r){for(var n,o,s=1;s<arguments.length;s++){o=arguments[s];for(n in o)e[n]=o[n];for(var l=0;l<Xa.length;l++)n=Xa[l],Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}}var Za;t:{var $a=xa.navigator;if($a){var ab=$a.userAgent;if(ab){Za=ab;break t}}Za=""}function bb(e){return Sa(Za,e)}var cb=Array.prototype.indexOf?function(e,r){return Array.prototype.indexOf.call(e,r,void 0)}:function(e,r){if(typeof e=="string")return typeof r!="string"||r.length!=1?-1:e.indexOf(r,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===r)return n;return-1};function db(e,r){this.b=e===eb&&r||"",this.a=fb}var fb={},eb={},gb=new db(eb,"");function hb(e,r){this.b=e===ib&&r||"",this.a=jb}hb.prototype.rc=function(){return 1};var jb={},ib={};function kb(){this.b="",this.c=lb,this.a=null}kb.prototype.rc=function(){return this.a};function mb(){var e=nb;return e instanceof kb&&e.constructor===kb&&e.c===lb?e.b:(Aa(e),"type_error:SafeHtml")}var lb={};function ob(e){var r=new kb;return r.b=e,r.a=0,r}ob("<!DOCTYPE html>");var nb=ob("");ob("<br>");function pb(e){var r=new hb(ib,gb instanceof db&&gb.constructor===db&&gb.a===fb?gb.b:"type_error:Const");r instanceof hb&&r.constructor===hb&&r.a===jb?r=r.b:(Aa(r),r="type_error:TrustedResourceUrl"),e.src=r.toString()}function qb(e){return qb[" "](e),e}qb[" "]=za;function sb(e,r){var n=tb;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=r(e)}var ub=bb("Opera"),vb=bb("Trident")||bb("MSIE"),wb=bb("Edge"),xb=bb("Gecko")&&!(Sa(Za.toLowerCase(),"webkit")&&!bb("Edge"))&&!(bb("Trident")||bb("MSIE"))&&!bb("Edge"),yb=Sa(Za.toLowerCase(),"webkit")&&!bb("Edge");function zb(){var e=xa.document;return e?e.documentMode:void 0}var Ab;t:{var Bb="",Cb=function(){var e=Za;if(xb)return/rv:([^\);]+)(\)|;)/.exec(e);if(wb)return/Edge\/([\d\.]+)/.exec(e);if(vb)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e);if(yb)return/WebKit\/(\S+)/.exec(e);if(ub)return/(?:Version)[ \/]?(\S+)/.exec(e)}();if(Cb&&(Bb=Cb?Cb[1]:""),vb){var Db=zb();if(Db!=null&&Db>parseFloat(Bb)){Ab=String(Db);break t}}Ab=Bb}var tb={};function Eb(e){return sb(e,function(){for(var r=0,n=Ra(String(Ab)).split("."),o=Ra(String(e)).split("."),s=Math.max(n.length,o.length),l=0;r==0&&l<s;l++){var h=n[l]||"",d=o[l]||"";do{if(h=/(\d*)(\D*)(.*)/.exec(h)||["","","",""],d=/(\d*)(\D*)(.*)/.exec(d)||["","","",""],h[0].length==0&&d[0].length==0)break;r=h[1].length==0?0:parseInt(h[1],10);var y=d[1].length==0?0:parseInt(d[1],10);r=Ta(r,y)||Ta(h[2].length==0,d[2].length==0)||Ta(h[2],d[2]),h=h[3],d=d[3]}while(r==0)}return 0<=r})}var Fb;Fb=xa.document&&vb?zb():void 0,!xb&&!vb||vb&&9<=Number(Fb)||xb&&Eb("1.9.1"),vb&&Eb("9");function Gb(e){var r=document;return e=String(e),r.contentType==="application/xhtml+xml"&&(e=e.toLowerCase()),r.createElement(e)}function Hb(e){xa.setTimeout(function(){throw e},0)}var Ib;function Kb(){var e=xa.MessageChannel;if(typeof e>"u"&&typeof window<"u"&&window.postMessage&&window.addEventListener&&!bb("Presto")&&(e=function(){var s=Gb("IFRAME");s.style.display="none",pb(s),document.documentElement.appendChild(s);var l=s.contentWindow;s=l.document,s.open(),s.write(mb()),s.close();var h="callImmediate"+Math.random(),d=l.location.protocol=="file:"?"*":l.location.protocol+"//"+l.location.host;s=Ka(function(y){(d=="*"||y.origin==d)&&y.data==h&&this.port1.onmessage()},this),l.addEventListener("message",s,!1),this.port1={},this.port2={postMessage:function(){l.postMessage(h,d)}}}),typeof e<"u"&&!bb("Trident")&&!bb("MSIE")){var r=new e,n={},o=n;return r.port1.onmessage=function(){if(n.next!==void 0){n=n.next;var s=n.bj;n.bj=null,s()}},function(s){o.next={bj:s},o=o.next,r.port2.postMessage(0)}}return typeof document<"u"&&"onreadystatechange"in Gb("SCRIPT")?function(s){var l=Gb("SCRIPT");l.onreadystatechange=function(){l.onreadystatechange=null,l.parentNode.removeChild(l),l=null,s(),s=null},document.documentElement.appendChild(l)}:function(s){xa.setTimeout(s,0)}}function Lb(e,r){Mb||Nb(),Ob||(Mb(),Ob=!0),Pb.add(e,r)}var Mb;function Nb(){if(xa.Promise&&xa.Promise.resolve){var e=xa.Promise.resolve(void 0);Mb=function(){e.then(Qb)}}else Mb=function(){var r=Qb;!Da(xa.setImmediate)||xa.Window&&xa.Window.prototype&&!bb("Edge")&&xa.Window.prototype.setImmediate==xa.setImmediate?(Ib||(Ib=Kb()),Ib(r)):xa.setImmediate(r)}}var Ob=!1,Pb=new Oa;function Qb(){for(var e;e=Pb.remove();){try{e.a.call(e.b)}catch(r){Hb(r)}Qa.put(e)}Ob=!1}function Rb(e){if(this.C=Sb,this.i=void 0,this.c=this.a=this.b=null,this.f=this.g=!1,e!=za)try{var r=this;e.call(void 0,function(n){Tb(r,Ub,n)},function(n){Tb(r,Vb,n)})}catch(n){Tb(this,Vb,n)}}var Sb=0,Ub=2,Vb=3;function Wb(){this.next=this.c=this.b=this.f=this.a=null,this.g=!1}Wb.prototype.reset=function(){this.c=this.b=this.f=this.a=null,this.g=!1};var Xb=new Na(function(){return new Wb},function(e){e.reset()});function Yb(e,r,n){var o=Xb.get();return o.f=e,o.b=r,o.c=n,o}function Zb(e){if(e instanceof Rb)return e;var r=new Rb(za);return Tb(r,Ub,e),r}function $b(e){return new Rb(function(r,n){n(e)})}function ac(){var e,r,n=new Rb(function(o,s){e=o,r=s});return new cc(n,e,r)}Rb.prototype.then=function(e,r,n){return dc(this,Da(e)?e:null,Da(r)?r:null,n)},Rb.prototype.$goog_Thenable=!0,Rb.prototype.cancel=function(e){if(this.C==Sb){var r=new ec(e);Lb(function(){fc(this,r)},this)}};function fc(e,r){if(e.C==Sb)if(e.b){var n=e.b;if(n.a){for(var o=0,s=null,l=null,h=n.a;h&&(h.g||(o++,h.a==e&&(s=h),!(s&&1<o)));h=h.next)s||(l=h);s&&(n.C==Sb&&o==1?fc(n,r):(l?(o=l,o.next==n.c&&(n.c=o),o.next=o.next.next):gc(n),hc(n,s,Vb,r)))}e.b=null}else Tb(e,Vb,r)}function ic(e,r){e.a||e.C!=Ub&&e.C!=Vb||jc(e),e.c?e.c.next=r:e.a=r,e.c=r}function dc(e,r,n,o){var s=Yb(null,null,null);return s.a=new Rb(function(l,h){s.f=r?function(d){try{var y=r.call(o,d);l(y)}catch(g){h(g)}}:l,s.b=n?function(d){try{var y=n.call(o,d);y===void 0&&d instanceof ec?h(d):l(y)}catch(g){h(g)}}:h}),s.a.b=e,ic(e,s),s.a}Rb.prototype.s=function(e){this.C=Sb,Tb(this,Ub,e)},Rb.prototype.m=function(e){this.C=Sb,Tb(this,Vb,e)};function Tb(e,r,n){if(e.C==Sb){e===n&&(r=Vb,n=new TypeError("Promise cannot resolve to itself")),e.C=1;t:{var o=n,s=e.s,l=e.m;if(o instanceof Rb){ic(o,Yb(s||za,l||null,e));var h=!0}else{if(o)try{var d=!!o.$goog_Thenable}catch{d=!1}else d=!1;if(d)o.then(s,l,e),h=!0;else{if(Ea(o))try{var y=o.then;if(Da(y)){kc(o,y,s,l,e),h=!0;break t}}catch(g){l.call(e,g),h=!0;break t}h=!1}}}h||(e.i=n,e.C=r,e.b=null,jc(e),r!=Vb||n instanceof ec||lc(e,n))}}function kc(e,r,n,o,s){function l(y){d||(d=!0,o.call(s,y))}function h(y){d||(d=!0,n.call(s,y))}var d=!1;try{r.call(e,h,l)}catch(y){l(y)}}function jc(e){e.g||(e.g=!0,Lb(e.l,e))}function gc(e){var r=null;return e.a&&(r=e.a,e.a=r.next,r.next=null),e.a||(e.c=null),r}Rb.prototype.l=function(){for(var e;e=gc(this);)hc(this,e,this.C,this.i);this.g=!1};function hc(e,r,n,o){if(n==Vb&&r.b&&!r.g)for(;e&&e.f;e=e.b)e.f=!1;if(r.a)r.a.b=null,mc(r,n,o);else try{r.g?r.f.call(r.c):mc(r,n,o)}catch(s){nc.call(null,s)}Xb.put(r)}function mc(e,r,n){r==Ub?e.f.call(e.c,n):e.b&&e.b.call(e.c,n)}function lc(e,r){e.f=!0,Lb(function(){e.f&&nc.call(null,r)})}var nc=Hb;function ec(e){Ma.call(this,e)}u(ec,Ma),ec.prototype.name="cancel";function cc(e,r,n){this.Ak=e,this.resolve=r,this.reject=n}var x=this;function oc(){return Object.create(z,void 0)}var A=Ka,pc=String,qc=x.Object.freeze||function(e){return e};function rc(e){for(var r=Object.keys(e),n=r.length,o;n--;)o=e[r[n]],Ea(o)&&rc(o);return qc(e)}function sc(e){var r=Aa(e);if(r=="object"||r=="array"){if(Da(e.clone))return e.clone();r=r=="array"?[]:{};for(var n in e)e.hasOwnProperty(n)&&(r[n]=sc(e[n]));return r}return e}var B=[].pop(),z=/x/.exec("");function tc(e,r){return pc(e).split(r!==B?r:" ")}var uc="prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(e,r,n,o,s){if(!(r=e instanceof r)&&n)throw new D(n,o,vc(s)?s:e);return r}function xc(e,r){if((C(e,r)&&e.constructor===r)===!0)throw new TypeError("Illegal constructor "+yc(r))}function zc(e,r,n,o,s){if(!(r=Ac(e)===r)&&n)throw new D(n,o,vc(s)?s:e);return r}function Bc(e,r,n,o){return zc(e,"Array",r,n,o)}t("H.lang.isArray",Bc);function vc(e){return e!==B}function Cc(e){return typeof e=="string"}t("H.lang.isString",Cc);var Dc=parseInt,Ec=parseFloat,E=isNaN;function Fc(e){return e===+e}t("H.lang.isNumber",Fc),t("H.lang.isInteger",Number.isInteger?Number.isInteger:function(e){return typeof e=="number"&&e%1===0});function Gc(e){return!E(+e)}function Ac(e){var r=Object[uc[0]][uc[6]].call(e).match(/^\[object (\w+)\]$/);return r?r[1]:typeof e}var Hc=[];function Ic(e){0>Hc.indexOf(e)&&Hc.push(e)}Ic(Hc);function yc(e,r,n,o){var s="",l=2>arguments.length,h;return l&&(r={H:x.H},n="",o=Hc.slice()),Jc(r,!0,function(d,y){try{if(h=d[y],y=Kc(d,h),!(Ea(h)&&h.window===h&&h.self===h||Ea(h)&&0<h.nodeType&&Da(h.cloneNode))&&Ea(h)){if(h===e)return s=n+"."+y,!0;if(0>o.indexOf(h)&&(o.push(h),s=yc(e,h,n+"."+y,o)))return!0}}catch{}}),l&&(s=s?s.substr(1).replace("."+uc[0]+".","#"):"~"+(Da(e)?Lc(e)+"()":Ac(e))),s}function Kc(e,r){var n=[];return Jc(e,!1,function(o,s){o[s]===r&&n.push(s)}),n.sort(Mc)[0]}function Mc(e,r){return r.length-e.length}var Nc=Object[uc[0]][uc[2]];function Jc(e,r,n){var o;if(e){for(s in e)if((!r||Nc.call(e,s))&&n(e,s,!0))return;for(o=uc.length;o--;){var s=uc[o];if((!r||Nc.call(e,s))&&n(e,s,!1))break}}}function Lc(e){return(e=/^\s*function ([^\( ]+)/.exec(e))?e[1]:"anonymous"}function Oc(e,r,n){n[r]="#"+r}var Pc=!!x.__karma__;function Qc(){throw Error("unimplemented method")}function Rc(e,r){r=r||{},"status"in r&&(this.status=+r.status),"statusText"in r&&(this.statusText=r.statusText),this.ok=200<=this.status&&300>this.status,this.f=!1,e?typeof e=="string"?this.c=e:(r=x.ArrayBuffer)&&r.prototype.isPrototypeOf(e)?this.a=e:r&&e.buffer?this.a=e.buffer:x.Blob.prototype.isPrototypeOf(e)&&(this.b=e):this.c=""}t("H.net.Response",Rc),Rc.prototype.type="default",Rc.prototype.type=Rc.prototype.type,Rc.prototype.status=200,Rc.prototype.status=Rc.prototype.status,Rc.prototype.statusText="OK",Rc.prototype.statusText=Rc.prototype.statusText;function Sc(e){if(e.f)return $b(new TypeError("Already read"));e.f=!0}Rc.error=function(){return Rc.a||(Rc.a=new Rc(null,{status:0,statusText:""}),Rc.a.type="error"),Rc.a},Rc.error=Rc.error,Rc.prototype.text=function(){var e=Sc(this);if(!e)if(this.c)e=Zb(this.c);else if(this.a){e=new Uint8Array(this.a);var r=e.length,n=Array(r),o;for(o=0;o<r;o++)n[o]=String.fromCharCode(e[o]);e=Zb(n.join(""))}else this.b?e=Tc(this.b):e=$b("Unsupported response body");return e},Rc.prototype.json=function(){return this.text().then(x.JSON.parse)},Rc.prototype.blob=function(){var e,r=Sc(this);return r||(this.b?e=this.b:this.a&&(e=new Blob([this.a],{type:"application/octet-stream"}))),r||Zb(e)},Rc.prototype.arrayBuffer=function(){return this.a?Sc(this)||Zb(this.a.slice(0)):this.blob().then(Rc.b)},Rc.b=function(e){var r=new FileReader;return r.readAsArrayBuffer(e),new Rb(function(n,o){r.onload=function(){n(r.result)},r.onerror=function(){o(r.error)}})};function Tc(e){var r=new FileReader;return r.readAsText(e),new Rb(function(n,o){r.onload=function(){n(r.result)},r.onerror=function(){o(r.error)}})}!Pc&&x.Response&&x.Response.error&&(Rc=x.Response,Ic(Rc.prototype));function D(e,r,n){var o=arguments.length;if(r=r!==B?+r:r,r!==B){var s=(s=/^.*?\(([^\)]+)/.exec((""+e).replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"")))?tc(s[1].replace(/\s+/g,""),","):[];s.forEach(Oc),s=s[r]||"#"+r}var l=e?yc(e):"";return o=2<o?pc(n):"",(s||o)&&(l+=" (Argument "+(s||"")+(o?" "+o:"")+")"),o=Error(l),Object.setPrototypeOf(o,D.prototype),o}u(D,Error),t("H.lang.InvalidArgumentError",D),D.prototype.name="InvalidArgumentError";function Uc(e,r,n){function o(){var v=A(g.b,g),m=+y.timeout||0;Vc?(Wc(g,"timeout",v),s.timeout=m):m&&(g.f=setTimeout(function(){s.abort(),g.b({type:"timeout"})},m)),Wc(g,"error",v),Wc(g,"load",v),s.send(y.data)}var s,l,h,d=n&&n.headers||{},y={},g=this;if(!Da(r))throw new D(Uc,1,"function required");Ya(d,Xc.headers,d),Ya(y,Xc,n||{}),y.headers=d,this.c=r,this.a=s=new XMLHttpRequest,r=y.method;try{s.open(r,e,!0);for(l in d)d.hasOwnProperty(l)&&(h=d[l])&&s.setRequestHeader(l,h);s.withCredentials=!!y.withCredentials,o()}catch{this.b({type:"cors"})}}t("H.net.Xhr",Uc);var Xc={method:"GET",headers:{},data:null},Yc="withCredentials"in new XMLHttpRequest,Vc="timeout"in new XMLHttpRequest;function Wc(e,r,n){Yc?e.a.addEventListener(r,n):e.a["on"+r]=n}function Zc(e,r,n){Yc?e.a.removeEventListener(r,n):e.a["on"+r]=null}Uc.prototype.abort=function(){this.a&&(this.a.abort(),this.a&&this.b({type:"abort"}))},Uc.prototype.abort=Uc.prototype.abort,Uc.prototype.b=function(e){var r=e.type;e=this.a;var n;this.f&&clearTimeout(this.f),r==="load"?e instanceof XMLHttpRequest&&e.status!==200&&(n="network"):n=e.readyState===4&&e.status===0&&r=="error"?"cors":r!="error"?r:"network",r=this.b,Zc(this,"timeout",r),Zc(this,"error",r),Zc(this,"load",r),e=e.status===0||n&&n!=="network"?Rc.error():new Rc(e.responseText||null,e),n=this.c,delete this.b,delete this.c,delete this.a,n(e)};function $c(e,r){var n=[];return e&&n.push(yc(e)),1<arguments.length&&n.push(""+r),n=Error(n.join(" ")),Object.setPrototypeOf(n,$c.prototype),n}u($c,Error),t("H.lang.IllegalOperationError",$c),$c.prototype.name="IllegalOperationError";var bd,cd,dd;function ed(){if(this.constructor=this.constructor,!Cc("STATIC_DB"))throw new D(this.constructor,0);if(this.g=fd(),!this.g)throw new $c(this.constructor,"This browser does not support IndexedDB");this.a=[],this.c=[],this.Zh=A(this.Zh,this)}var gd,hd;p=ed.prototype,p.put=function(e,r,n,o){if(!Cc(e)&&!Fc(e))throw new D(this.put,0);if(!id(r))throw new D(this.put,1);jd(this,function(s){kd(s.put(r,e),n,o)},o)},p.get=function(e,r,n){var o;if(!Cc(e)&&!Fc(e))throw new D(this.get,0);if(!Da(r))throw new D(this.get,1);return jd(this,function(s){o=s.get(e),kd(o,r,n)},n),{cancel:function(){o&&(o.onsuccess=ld)}}},p.remove=function(e,r,n){if(!Cc(e)&&!Fc(e))throw new D(this.remove,0);jd(this,function(o){kd(o.delete(e),r,n)},n)},p.clear=function(e,r){jd(this,function(n){kd(n.clear(),e,r)},r)},p.Zh=function(){var e=this.b.result;e.objectStoreNames.contains("data")||e.createObjectStore("data")};function md(e,r,n){if(e.b)e.a?(e.a.push(r),n&&e.c.push(n)):e.f?n&&n(e.f):r(e.b.result);else{e.b=e.g.open("H_STATIC_DB",1),e.b.onupgradeneeded=e.Zh;var o=e.b.onerror=function(){clearTimeout(e.i),e.f=this.error,e.c.forEach(function(s){s(e.f)}),delete e.a,delete e.c};e.i=setTimeout(function(){o.call({error:Error("DbOpenTimeoutError")})},500),e.b.onsuccess=function(){clearTimeout(e.i),e.a?(e.a.forEach(function(s){s(this.result)},this),delete e.a,delete e.c):(delete e.b,delete e.f,e.a=[],e.c=[])},e.a.push(r),n&&e.c.push(n)}}function jd(e,r,n){md(e,function(o){o=o.transaction(["data"],"readwrite"),r(o.objectStore("data"))},n)}function kd(e,r,n){r&&(e.onsuccess=function(){r(this.result)}),n&&(e.onerror=function(){n(this.error)})}function id(e){var r=Object.prototype.toString.call(e);return r==="[object Blob]"||r==="[object ArrayBuffer]"||Cc(e)||Ea(e)}function nd(){return gd||(gd=new ed),gd}t("H.util.IndexedDBStorage.getInstance",nd);function fd(){return x.indexedDB||x.webkitIndexedDB||x.mozIndexedDB||x.msIndexedDB}function od(){var e="";if(!vc(hd))if(window.location.protocol==="file:"&&-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&128<=window.location.href.length)hd=!1;else{try{var r=fd();e="H_TEST_DB";var n=r&&r.open(e,1)}catch{}hd=!!n&&n.onupgradeneeded===null,n&&r.deleteDatabase&&r.deleteDatabase(e)}return hd}t("H.util.IndexedDBStorage.isSupported",od);function qd(){this.zd=this.zd,this.mb=this.mb}var rd=0;qd.prototype.zd=!1,qd.prototype.F=function(){!this.zd&&(this.zd=!0,this.o(),rd!=0)&&(this[Ga]||(this[Ga]=++Ha))},qd.prototype.tb=function(e,r){this.zd?r!==void 0?e.call(r):e():(this.mb||(this.mb=[]),this.mb.push(r!==void 0?Ka(e,r):e))},qd.prototype.o=function(){if(this.mb)for(;this.mb.length;)this.mb.shift()()};function td(e){e&&typeof e.F=="function"&&e.F()}function ud(e,r){this.type=e,this.currentTarget=this.target=r,this.c=this.a=!1,this.Ik=!0}ud.prototype.stopPropagation=function(){this.a=!0},ud.prototype.preventDefault=function(){this.c=!0,this.Ik=!1},t("H.util.Event",ud),ud.prototype.stopPropagation=ud.prototype.stopPropagation,ud.prototype.stopPropagation=ud.prototype.stopPropagation,ud.prototype.CAPTURING_PHASE=1,ud.prototype.CAPTURING_PHASE=ud.prototype.CAPTURING_PHASE,ud.prototype.AT_TARGET=2,ud.prototype.AT_TARGET=ud.prototype.AT_TARGET,ud.prototype.BUBBLING_PHASE=3,ud.prototype.BUBBLING_PHASE=ud.prototype.BUBBLING_PHASE,ud.prototype.eventPhase=0,ud.prototype.eventPhase=ud.prototype.eventPhase;function vd(e,r,n){vd.j.constructor.call(this,e,n),this.data=r}u(vd,ud),t("H.util.DataEvent",vd);function wd(e,r,n){wd.j.constructor.call(this,e,n),this.message=r}u(wd,ud),t("H.util.ErrorEvent",wd);var xd=Math,yd=xd.min,zd=xd.max,Ad=xd.round,Bd=xd.floor,Cd=xd.ceil,Dd=xd.abs,Ed=xd.log,Fd=xd.sqrt,Gd=xd.pow,Hd=xd.exp,Id=xd.sin,Jd=xd.asin,Kd=xd.cos,Ld=xd.tan,Md=xd.atan,Nd=xd.atan2,Od=xd.LN2,Pd=xd.PI,Qd=Pd/2,Rd=Pd/4,Sd=2*Pd,Td=3*Pd,Ud=Pd/180,Vd=180/Pd,Wd=1/0,Xd=Gd(-2,53),Yd=Yd||function(e){return Ed(e)/Od};function Zd(e,r){var n;return 0>(n=e%r)==0>r?n:n+r}function $d(e,r,n){return r-=n=n||0,e-=n,e-Bd(e/r)*r+n}t("H.math.normalize",$d);function ae(e,r,n){return e>n?n:e<r?r:e}t("H.math.clamp",ae);function be(e,r,n,o){return o||(o=0),r<n?e>=r-o&&e<=n+o:e>=n-o&&e<=r+o}function ce(e,r,n,o,s,l){return Fd(Gd((e-s)*(o-l)-(r-l)*(n-s),2)/(Gd(n-s,2)+Gd(o-l,2)))}var de={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};t("H.math.CoverType",de);function ee(e,r,n,o,s,l){var h=n.length,d=h,y=n[0],g=0,v=0,m=0;o=o/2||0;var w=l||2;l=w*(s?0:1)+1;for(var I=w-2;g!=1&&d>l;){d-=I;var V=n[--d];w=n[--d];var q=n[d?d-I-1:(h+(d-I-1))%h],De=n[d?d-I-2:(h+(d-I-2))%h];w>=e-o&&w<=e+o&&V>=r-o&&V<=r+o||De>=e-o&&De<=e+o&&q>=r-o&&q<=r+o?g=1:!g&&w===e?(De===e&&(V<r&&q>r||V>r&&q<r)||(y<=e&&De>e||y>=e&&De<e)&&(V>=r?++v:++m),g=be(r,V,q,o)&&ce(e,r,w,V,De,q)<=o?2:0):!g&&be(e,w,De,o)&&((w<e&&De>e||w>e&&De<e)&&(y=V+(e-w)/(De-w)*(q-V),v+=y>r,m+=y<r),g=be(r,V,q,o)&&ce(e,r,w,V,De,q)<=o?2:0),y=w}return!g&&s&&m!==0&&v%2!==0&&(g=3),g}function fe(e,r){return ee(e.x,e.y,r,0,!0)!==de.NONE}t("H.math.isPointInsidePolygon",fe);function ge(e){for(var r=e.length,n=new Float64Array(2*r),o=r&&vc(e[0].x);r--;){var s=e[r],l=r<<1;n[l]=o?s.x:s[0],n[l+1]=o?s.y:s[1]}return n}t("H.math.flatten",ge);function he(){}t("H.util.ICancelable",he),he.prototype.cancel=function(){},he.prototype.cancel=he.prototype.cancel;function ie(e,r,n){this.type=e,this.data=r,this.c=ac(),this.resolve=A(this.resolve,this),this.reject=A(this.reject,this),this.priority=je,n!==B&&(this.priority=n),this.fh().add(this)}var je=1,ke={Vo:0,Yo:je,To:2};p=ie.prototype,p.then=function(e,r,n){return this.c.Ak.then(e,r,n)},p.resolve=function(e){this.Yd=3,this.c.resolve(e)},p.reject=function(e){this.Yd=5,this.c.reject(e)},p.Yd=0,p.cancel=function(){3>this.Yd&&(this.oe(),this.fh().remove(this),this.Yd=4)},ie.prototype.cancel=ie.prototype.cancel;function le(e){var r;this.a={};for(r in ke)this.a[ke[r]]=[];this.Ze=e,this.Ze.addEventListener("allocatable",A(this.b,this))}t("H.util.JobManager",le);var me=Object.keys(ke).map(function(e){return ke[e]}).sort().reverse();le.prototype.add=function(e){C(e,ie,this.add,0),this.a[e.priority].push(e),this.b()},le.prototype.contains=function(e){return-1<this.a[e.priority].indexOf(e)},le.prototype.remove=function(e){var r=e.priority,n=this.a[r].indexOf(e);return-1<n?(this.a[r].splice(n,1),!0):(e.Li&&this.Ze.yf(e.Li),!1)},le.prototype.b=function(){me.forEach(function(e){this.a[e]=this.a[e].filter(function(r){var n;if((n=this.Ze.Jg(r))!==z){var o=A(this.Ze.yf,this.Ze,n,r);r.Li=n,r.then(o,o),r.Yd=r.qj(n)?1:5}else return!0},this)},this)};function ne(e,r,n){var o=[],s=arguments.length;return e&&o.push(yc(e)),1<s&&(s=2<s&&Bc(n)?" out of ["+n[0]+"..."+n[1]+"]":"",o.push("("+r+s+")")),o=Error(o.join(" ")),Object.setPrototypeOf(o,ne.prototype),o}u(ne,Error),t("H.lang.OutOfRangeError",ne),ne.prototype.name="OutOfRangeError";var oe="closure_listenable_"+(1e6*Math.random()|0);function pe(e){return!(!e||!e[oe])}var qe=0;function re(e,r,n,o,s){this.listener=e,this.proxy=null,this.src=r,this.type=n,this.capture=!!o,this.Mf=s,this.key=++qe,this.be=this.rf=!1}function se(e){e.be=!0,e.listener=null,e.proxy=null,e.src=null,e.Mf=null}function te(e){this.src=e,this.a={},this.b=0}te.prototype.add=function(e,r,n,o,s){var l=e.toString();e=this.a[l],e||(e=this.a[l]=[],this.b++);var h=ue(e,r,o,s);return-1<h?(r=e[h],n||(r.rf=!1)):(r=new re(r,this.src,l,!!o,s),r.rf=n,e.push(r)),r},te.prototype.remove=function(e,r,n,o){if(e=e.toString(),!(e in this.a))return!1;var s=this.a[e];return r=ue(s,r,n,o),-1<r?(se(s[r]),Array.prototype.splice.call(s,r,1),s.length==0&&(delete this.a[e],this.b--),!0):!1};function ve(e,r){var n=r.type;if(!(n in e.a))return!1;var o=e.a[n],s=cb(o,r),l;return(l=0<=s)&&Array.prototype.splice.call(o,s,1),l&&(se(r),e.a[n].length==0&&(delete e.a[n],e.b--)),l}te.prototype.na=function(e){e=e&&e.toString();var r=0,n;for(n in this.a)if(!e||n==e){for(var o=this.a[n],s=0;s<o.length;s++)++r,se(o[s]);delete this.a[n],this.b--}return r},te.prototype.sh=function(e,r){var n=e!==void 0,o=n?e.toString():"",s=r!==void 0;return Ua(this.a,function(l){for(var h=0;h<l.length;++h)if(!(n&&l[h].type!=o||s&&l[h].capture!=r))return!0;return!1})};function ue(e,r,n,o){for(var s=0;s<e.length;++s){var l=e[s];if(!l.be&&l.listener==r&&l.capture==!!n&&l.Mf==o)return s}return-1}var we=!vb||9<=Number(Fb),xe=vb&&!Eb("9");!yb||Eb("528"),xb&&Eb("1.9b")||vb&&Eb("8")||ub&&Eb("9.5")||yb&&Eb("528"),xb&&!Eb("8")||vb&&Eb("9");var ye=function(){if(!xa.addEventListener||!Object.defineProperty)return!1;var e=!1,r=Object.defineProperty({},"passive",{get:function(){e=!0}});try{xa.addEventListener("test",za,r),xa.removeEventListener("test",za,r)}catch{}return e}();function ze(e,r){if(ud.call(this,e?e.type:""),this.relatedTarget=this.currentTarget=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.b=null,e){var n=this.type=e.type,o=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.currentTarget=r,r=e.relatedTarget){if(xb){t:{try{qb(r.nodeName);var s=!0;break t}catch{}s=!1}s||(r=null)}}else n=="mouseover"?r=e.fromElement:n=="mouseout"&&(r=e.toElement);this.relatedTarget=r,o?(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0):(this.clientX=e.clientX!==void 0?e.clientX:e.pageX,this.clientY=e.clientY!==void 0?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=typeof e.pointerType=="string"?e.pointerType:Ae[e.pointerType]||"",this.b=e,e.defaultPrevented&&this.preventDefault()}}u(ze,ud);var Ae={2:"touch",3:"pen",4:"mouse"};ze.prototype.stopPropagation=function(){ze.j.stopPropagation.call(this),this.b.stopPropagation?this.b.stopPropagation():this.b.cancelBubble=!0},ze.prototype.preventDefault=function(){ze.j.preventDefault.call(this);var e=this.b;if(e.preventDefault)e.preventDefault();else if(e.returnValue=!1,xe)try{(e.ctrlKey||112<=e.keyCode&&123>=e.keyCode)&&(e.keyCode=-1)}catch{}};var Be="closure_lm_"+(1e6*Math.random()|0),Ce={};function Ee(e,r,n,o,s){if(o&&o.once)return Fe(e,r,n,o,s);if(Aa(r)=="array"){for(var l=0;l<r.length;l++)Ee(e,r[l],n,o,s);return null}return n=Ge(n),pe(e)?e.U.add(String(r),n,!1,Ea(o)?!!o.capture:!!o,s):He(e,r,n,!1,o,s)}function He(e,r,n,o,s,l){if(!r)throw Error("Invalid event type");var h=Ea(s)?!!s.capture:!!s,d=Ie(e);if(d||(e[Be]=d=new te(e)),n=d.add(r,n,o,h,l),n.proxy)return n;if(o=Je(),n.proxy=o,o.src=e,o.listener=n,e.addEventListener)ye||(s=h),s===void 0&&(s=!1),e.addEventListener(r.toString(),o,s);else if(e.attachEvent)e.attachEvent(Ke(r.toString()),o);else if(e.addListener&&e.removeListener)e.addListener(o);else throw Error("addEventListener and attachEvent are unavailable.");return n}function Je(){var e=Le,r=we?function(n){return e.call(r.src,r.listener,n)}:function(n){if(n=e.call(r.src,r.listener,n),!n)return n};return r}function Fe(e,r,n,o,s){if(Aa(r)=="array"){for(var l=0;l<r.length;l++)Fe(e,r[l],n,o,s);return null}return n=Ge(n),pe(e)?e.U.add(String(r),n,!0,Ea(o)?!!o.capture:!!o,s):He(e,r,n,!0,o,s)}function Me(e,r,n,o,s){if(Aa(r)=="array"){for(var l=0;l<r.length;l++)Me(e,r[l],n,o,s);return null}return o=Ea(o)?!!o.capture:!!o,n=Ge(n),pe(e)?e.U.remove(String(r),n,o,s):e&&(e=Ie(e))&&(r=e.a[r.toString()],e=-1,r&&(e=ue(r,n,o,s)),n=-1<e?r[e]:null)?Ne(n):!1}function Ne(e){if(typeof e=="number"||!e||e.be)return!1;var r=e.src;if(pe(r))return ve(r.U,e);var n=e.type,o=e.proxy;return r.removeEventListener?r.removeEventListener(n,o,e.capture):r.detachEvent?r.detachEvent(Ke(n),o):r.addListener&&r.removeListener&&r.removeListener(o),(n=Ie(r))?(ve(n,e),n.b==0&&(n.src=null,r[Be]=null)):se(e),!0}function Ke(e){return e in Ce?Ce[e]:Ce[e]="on"+e}function Oe(e,r,n,o){var s=!0;if((e=Ie(e))&&(r=e.a[r.toString()]))for(r=r.concat(),e=0;e<r.length;e++){var l=r[e];l&&l.capture==n&&!l.be&&(l=Pe(l,o),s=s&&l!==!1)}return s}function Pe(e,r){var n=e.listener,o=e.Mf||e.src;return e.rf&&Ne(e),n.call(o,r)}function Le(e,r){if(e.be)return!0;if(!we){if(!r)t:{r=["window","event"];for(var n=xa,o=0;o<r.length;o++)if(n=n[r[o]],n==null){r=null;break t}r=n}if(o=r,r=new ze(o,this),n=!0,!(0>o.keyCode||o.returnValue!=null)){t:{var s=!1;if(o.keyCode==0)try{o.keyCode=-1;break t}catch{s=!0}(s||o.returnValue==null)&&(o.returnValue=!0)}for(o=[],s=r.currentTarget;s;s=s.parentNode)o.push(s);for(e=e.type,s=o.length-1;!r.a&&0<=s;s--){r.currentTarget=o[s];var l=Oe(o[s],e,!0,r);n=n&&l}for(s=0;!r.a&&s<o.length;s++)r.currentTarget=o[s],l=Oe(o[s],e,!1,r),n=n&&l}return n}return Pe(e,new ze(r,this))}function Ie(e){return e=e[Be],e instanceof te?e:null}var Qe="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ge(e){return Da(e)?e:(e[Qe]||(e[Qe]=function(r){return e.handleEvent(r)}),e[Qe])}function F(){qd.call(this),this.U=new te(this),this.wn=this,this.Mg=null}u(F,qd),F.prototype[oe]=!0,p=F.prototype,p.Mb=function(){return this.Mg},p.ka=function(e){this.Mg=e},p.addEventListener=function(e,r,n,o){Ee(this,e,r,n,o)},p.removeEventListener=function(e,r,n,o){Me(this,e,r,n,o)},p.dispatchEvent=function(e){var r,n=this.Mb();if(n)for(r=[];n;n=n.Mb())r.push(n);n=this.wn;var o=e.type||e;if(typeof e=="string")e=new ud(e,n);else if(e instanceof ud)e.target=e.target||n;else{var s=e;e=new ud(o,n),Ya(e,s)}if(s=!0,r)for(var l=r.length-1;!e.a&&0<=l;l--){var h=e.currentTarget=r[l];s=h.jd(o,!0,e)&&s}if(e.a||(h=e.currentTarget=n,s=h.jd(o,!0,e)&&s,e.a||(s=h.jd(o,!1,e)&&s)),r)for(l=0;!e.a&&l<r.length;l++)h=e.currentTarget=r[l],s=h.jd(o,!1,e)&&s;return s},p.o=function(){F.j.o.call(this),this.U&&this.U.na(void 0),this.Mg=null},p.jd=function(e,r,n){if(e=this.U.a[String(e)],!e)return!0;e=e.concat();for(var o=!0,s=0;s<e.length;++s){var l=e[s];if(l&&!l.be&&l.capture==r){var h=l.listener,d=l.Mf||l.src;l.rf&&ve(this.U,l),o=h.call(d,n)!==!1&&o}}return o&&n.Ik!=0},p.sh=function(e,r){return this.U.sh(e!==void 0?String(e):void 0,r)},t("H.util.EventTarget",F),F.prototype.ka=F.prototype.ka,F.prototype.setParentEventTarget=F.prototype.ka,F.prototype.Mb=F.prototype.Mb,F.prototype.getParentEventTarget=F.prototype.Mb,F.prototype.addEventListener=F.prototype.addEventListener,F.prototype.addEventListener=F.prototype.addEventListener,F.prototype.removeEventListener=F.prototype.removeEventListener,F.prototype.removeEventListener=F.prototype.removeEventListener,F.prototype.dispatchEvent=F.prototype.dispatchEvent,F.prototype.dispatchEvent=F.prototype.dispatchEvent,F.prototype.F=F.prototype.F,F.prototype.dispose=F.prototype.F,F.prototype.tb=F.prototype.tb,F.prototype.addOnDisposeCallback=F.prototype.tb,F.prototype.xn=F.prototype.jd,F.prototype.jd=function(e,r,n){var o,s,l=!0,h=n[n.currentTarget===n.target?"AT_TARGET":r?"CAPTURING_PHASE":(o=!0,"BUBBLING_PHASE")];return(!o||(s=n.type)!=="pointerenter"&&s!=="pointerleave")&&(n.eventPhase=h,l=F.prototype.xn.apply(this,arguments),o&&this.Mb&&this.Mb()===null&&delete n.eventPhase),l},F.prototype.Tk=function(e){for(var r,n=this;n&&(r=n.Mb())&&r!==e;)n=r;r||n.ka(e)},F.prototype.setRootParentEventTarget=F.prototype.Tk;function Re(e){e=e||{};var r=e.callback;this.b=e.label,Da(r)&&(this.callback=r),this.a=!!e.disabled,Re.j.constructor.call(this)}u(Re,F),t("H.util.ContextItem",Re),Re.prototype.Ge=function(){return this.b},Re.prototype.getLabel=Re.prototype.Ge,Re.prototype.Jc=function(e){return this.b!==e&&(this.b=e,this.dispatchEvent("update")),this},Re.prototype.setLabel=Re.prototype.Jc,Re.prototype.dc=function(){return this.a},Re.prototype.isDisabled=Re.prototype.dc,Re.prototype.va=function(e){return e!==this.a&&(this.a=e,this.dispatchEvent("update")),this},Re.prototype.setDisabled=Re.prototype.va;var Se=new Re;Re.SEPARATOR=Se;function Te(e){if(x.document){var r=document.createElement("canvas");return r.width=r.height=1,r.getContext("2d",{fp:e})}return null}function Ue(){return window.devicePixelRatio||1}t("H.util.getPixelRatio",Ue);var Ve=/^rgba\(([^,]+),([^,]+),([^,]+),([^)]+)\)$/;function We(e){var r=Xe[e],n=x.RegExp;return r||(x.Uint8ClampedArray||(x.Uint8ClampedArray=function(o){return o instanceof Number?Array(o):o.map(function(s){return ae(Ad(s),0,255)})}),e==="none"?r=new Uint8ClampedArray([0,0,0,0]):(Ye.fillStyle="black",Ye.fillStyle=e,Ve.test(Ye.fillStyle)?r=new Uint8ClampedArray([n.$1,n.$2,n.$3,255*n.$4]):(Ye.clearRect(0,0,1,1),Ye.fillRect(0,0,1,1),r=Ye.getImageData(0,0,1,1).data)),Xe[e]=r),r}function Ze(e){return e!=="none"&&0<We(e)[3]}var Xe=oc(),$e=!!x.VBArray;t("H.util.eval",function(a){return eval(a)});function af(e,r){return e!==B?e:r}function bf(e){return/^<svg/.test(e)?"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(e):e}t("H.util.provide",function(e){var r=xa.$jscomp;if(r&&(typeof r.Vl=="function"&&r.Vl()))throw Error("goog.provide cannot be used within a module.");ya(e,void 0)});function cf(e){this.fc=0<+e?xd.round(e):0}cf.prototype.next=function(e){if(this.fc===9007199254740992)throw new ne(e,this.fc,[0,9007199254740991]);return this.fc++};var df=new cf,ef=A(df.next,df);function ff(){return!0}function gf(){return!1}function ld(){}var hf=qc([]),jf=qc({});function kf(e){return e.tagName==="CANVAS"?[e]:e.getElementsByTagName("CANVAS")}function lf(e,r,n){var o;if(r=e.ownerDocument===r?e.cloneNode(!0):r.importNode(e,!0),n)for(e=kf(e),n=kf(r),o=n.length;o--;)n[o].getContext("2d").drawImage(e[o],0,0);return r}var Ye=Te(!0),mf=Te(!1);function nf(e){var r=e.complete,n=0<e.naturalWidth;if(r&&!n&&$e)try{mf.drawImage(e,0,0),n=!0}catch{}return r&&n}var of=x.BlobBuilder||x.WebKitBlobBuilder||x.MozBlobBuilder;function pf(e,r){if(r=r||"",of){var n=new of;n.append(e),e=n.getBlob(r)}else e=new Blob([e],{type:r});return e}var qf=x.navigator;cd=/Edge\/\d+/.test(qf.appVersion),dd=/(A|a)ndroid/.test(qf.appVersion);function rf(){var e=rf.a;return e||(e=this,rf.a=e,Ic(rf.a),F.call(e),sf(this)),e}u(rf,F),rf.prototype.o=function(){rf.j.o.call(this),sf(this)};function sf(e){e.g=10,e.i=6,e.a=oc(),e.b=oc(),e.c=0}rf.prototype.Jg=function(e){e=e.type;var r=this.a[e]||0;if(this.c<this.g&&r<this.i){var n=++this.f;return this.c++,this.a[e]=r+1,this.b[n+""]=e,n}return z},rf.prototype.yf=function(e){var r=this.b[e];if(!vc(r)||!this.a[r])throw new $c(this.yf,"Unknown requestId");this.c--,this.a[r]--,this.a[r]||delete this.a[r],delete this.b[e],this.dispatchEvent("allocatable")},rf.prototype.f=-1;function tf(e,r,n,o){if(!uf[e])throw new D(tf,0,"Mime type is not supported");this.f=e,e=o?Wa(o):{},"crossOrigin"in e||(e.crossOrigin="anonymous"),this.a=e,vf.href=r.toString(),ie.call(this,vf.protocol+"//"+vf.hostname,r,n)}u(tf,ie),tf.prototype.qj=function(){return this.b=uf[this.f].call(this),!0},tf.prototype.oe=function(){this.b&&(this.b.abort(),delete this.b)};var uf={"application/json":function(){var e=this,r=wf(this.a),n=r.headers;return r.headers=n=n?Wa(n):{},n.Accept="application/json",new Uc(this.data,function(o){200<=o.status&&300>o.status?e.resolve(o.json()):e.reject(o)},r)},"text/plain":function(){var e=this;return new Uc(this.data,function(r){200<=r.status&&300>r.status?e.resolve(r.text()):e.reject(r)},wf(this.a))},image:function(){var e=x.document.createElement("img"),r=this,n=this.data;return e.onload=A(this.resolve,this,e),e.onerror=function(){r.reject(Rc.error())},e.crossOrigin=this.a.crossOrigin,e.src=n,{abort:function(){e.onerror=e.onload=null,$e&&nf(e)||e.removeAttribute("src")}}}};(function(){try{var e=new XMLHttpRequest;e.open("get","/",!0)}catch{e={}}"response"in e&&(uf.arraybuffer=function(){var r=new XMLHttpRequest,n=this,o=this.a,s=o.headers,l;if(r.open("GET",this.data),xf(r,o),r.responseType="arraybuffer",s)for(l in s)r.setRequestHeader(l,s[l]);return r.onerror=r.ontimeout=function(){n.reject(Rc.error())},r.onload=function(){n.resolve(new Rc(r.response))},r.send(),r})})();var yf=new le(new rf);tf.prototype.fh=function(){return yf};var vf=x.document.createElement("a");function wf(e){var r=Wa(e);return delete r.crossOrigin,xf(r,e),r}function xf(e,r){e.withCredentials=r.crossOrigin==="use-credentials"}function J(e,r){this.x=+e,this.y=+r}t("H.math.Point",J),J.prototype.set=J,J.prototype.set=J.prototype.set,J.prototype.clone=function(e){return e?(e.x=this.x,e.y=this.y):e=new J(this.x,this.y),e},J.prototype.clone=J.prototype.clone,J.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},J.prototype.add=J.prototype.add,J.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},J.prototype.sub=J.prototype.sub,J.prototype.scale=function(e,r){return this.x*=e,this.y*=r===void 0?e:r,this},J.prototype.scale=J.prototype.scale,J.prototype.round=function(){return this.x=Ad(this.x),this.y=Ad(this.y),this},J.prototype.round=J.prototype.round,J.prototype.floor=function(){return this.x=Bd(this.x),this.y=Bd(this.y),this},J.prototype.floor=J.prototype.floor,J.prototype.ceil=function(){return this.x=Cd(this.x),this.y=Cd(this.y),this},J.prototype.ceil=J.prototype.ceil,J.prototype.ia=function(e){return!(!e||this.x!==e.x||this.y!==e.y)},J.prototype.equals=J.prototype.ia,J.prototype.Cj=function(e,r){var n=r.x-e.x,o=r.y-e.y,s=e;if(n||o){var l=((this.x-e.x)*n+(this.y-e.y)*o)/(n*n+o*o);0>=l?s=e:1<=l?s=r:s=new J(e.x+l*n,e.y+l*o)}return s},J.prototype.getNearest=J.prototype.Cj,J.prototype.Wa=function(e){return Fd(Gd(this.x-e.x,2)+Gd(this.y-e.y,2))},J.prototype.distance=J.prototype.Wa;function zf(e){if(!e)throw Error("invalid argument");return e instanceof J?e:new J(e.x,e.y)}J.fromIPoint=zf;function Af(e){var r=Bf[e];if(!r)if(e in Cf)r=Bf[e]=e;else{r=Df.length;var n="",o=e.charAt(0).toUpperCase()+e.substr(1),s="",l=!1;for(Ef&&(s=Ef+o,l=s in Cf);r--&&!l;)n=Df[r],s=n+o,l=s in Cf;if(l&&(Ef=n),r=l?s:null)Bf[e]=r;else throw Error("Could not find any variant of CSS property ["+e+"]")}return r}t("H.dom.cssPrefixer.prefix",Af);var Df=["O","Ms","ms","Moz","Webkit"],Bf={},Ef="",Cf=document.createElement("span").style;function Ff(e,r,n,o){if(!e||!r||!n)throw new D(Ff,B,"Must specify name, version and revision parameter");this.name=e,this.version=r,this.revision=n,o&&Ya(this,o)}t("H.util.BuildInfo",Ff),Ff.prototype.toString=function(){var e,r=[];for(e in this)Cc(this[e])&&r.push(this[e]);return r.join(";")};var Gf={};function Hf(e,r,n,o){if(!e)throw new D(Hf,1,"Must specify a name parameter");return Gf[e]||(Gf[e]=new Ff(e,r,n,o))}Ff.get=Hf;function If(){If.j.constructor.call(this),this.a=Jf(this),this.f=oc(),this.c=A(this.c,this),this.a.addEventListener("message",this.c),this.b={}}u(If,F),If.prototype.o=function(){this.a.terminate()},If.prototype.g=function(e){var r=e.type,n=!!this.f[r],o=e.data,s=Kf++,l=o&&o.Mo?o.Mo:B,h=!0;return n?(this.b[s]=e,Lf(this,r,s,o&&o.message,l)):(e.reject(new D(this.g,0,"processor_not_found")),h=!1),h},If.prototype.c=function(e){e=e.data;var r=this.b[e.taskId],n=e.taskId,o=e.data,s=this;if(e.type===2)new tf("arraybuffer",o).then(function(l){return l.arrayBuffer()}).then(function(l){s.a.postMessage(["3",n,[l]],[l])},function(){s.a.postMessage(["3",n,[null,"ERROR"]])});else{if(r){switch(e.type){case 1:r.resolve(o);break;case 0:r.reject(o)}delete this.b[n]}this.dispatchEvent(new ud(this.A.IDLE))}};var Kf=0;function Mf(e,r,n){var o=Kf++,s;return e.b[o]=s=ac(),Lf(e,r,o,n),s.Ak}function Lf(e,r,n,o,s){o===B||Ca(o)||(o=[o]);try{e.a.postMessage([r,n,o],s)}catch(l){e=e.b[n],e.reject(l.message)}}If.prototype.A={IDLE:"idle",Ni:"error"},If.prototype.i=function(e,r){var n=this.l||(this.l=new ud(this.A.Ni));n.data=r,delete this.f[e],this.dispatchEvent(n)};function Jf(a){var b=x.H.__bootstrap__;if(b=Da(b)?(""+b).replace(/^[^{]+{((.|[\r\n])+?)}\s*$/,"$1"):""+b,x.Worker&&x.URL)try{var c=new x.Worker(x.URL.createObjectURL(pf(b,"application/javascript")))}catch{}return c||(a=new Nf(a),function(){eval("var self = arguments[0];"+b)}(),c=new Of(a)),c}function Of(e){F.call(this),this.a=e}u(Of,F),Of.prototype.postMessage=function(e){x.setTimeout(A(this.b,this,e),0)},Of.prototype.b=function(e){var r=new ud("message");r.data=e,this.a.dispatchEvent(r)},Of.prototype.terminate=function(){this.a.F(),this.F()};function Nf(e){F.call(this),this.a=e,this.addEventListener=A(this.addEventListener,this),this.removeEventListener=A(this.removeEventListener,this),this.postMessage=A(this.postMessage,this),this.eval=A(eval,this)}u(Nf,F),Nf.prototype.postMessage=function(e){var r=new ud("message");r.data=e,x.setTimeout(A(this.a.c,this.a,r),0)};function Pf(){var e=Qf;return e||(e=Qf=this,F.call(e),Rf(this)),e}var Qf;u(Pf,F),Pf.prototype.o=function(){Pf.j.o.call(this),Rf(this)};function Rf(e){var r=e.b,n;if(r)for(n=r.length;n--;)r[n].F();e.b=[],Ic(e.b),e.c={},e.f=oc()}Pf.prototype.Jg=function(e){var r;if(e=e.type,r=this.f[e]){var n=this.b,o=n[0];o||(o=n[0]=new If,this.tb(La(td,o)),Va(this.c)||(n=x.Object.keys(this.c),Mf(o,"0",n))),n=o,n.f[e]||(n.f[e]=r,Mf(n,"1",[e,Da(r)?r+"":r]).then(ld,A(n.i,n,e)))}else throw new $c(this.Jg,'Unknown type "'+e+'"');return o},Pf.prototype.yf=function(){},Pf.prototype.a=function(e,r){var n=this.f,o=n[e];if(o){if(r!==o)throw new $c(this.a,'Type "'+e+'" is already registered')}else n[e]=r};function Sf(e,r,n){ie.call(this,e,r,n)}var Tf;u(Sf,ie),Sf.prototype.fh=function(){return Tf||(Tf=new le(new Pf)),Tf},Sf.prototype.oe=function(){},Sf.prototype.qj=function(e){return e.g(this)};function Uf(e,r,n,o,s,l){var h,d,y=e.length,g,v;if(y)for(h=[];y--;){var m=e[y],w=m.length,I=0;for(g=1;g<w;g++)if(v=Vf(m[g-1],m[g],n,r,o,s)){var V=v[0],q=v[1];I&&I.ia(V)?d.push(q):h.push(d=v),I=q,l&&(g=w,y=0)}}else h=e;return h}t("H.math.clipping.clipStrips",Uf);function Vf(e,r,n,o,s,l){var h=e.x;e=-e.y;var d=r.x;if(r=-r.y,n=-n,l=-l,h>d){if(d>s||h<o)return;var y=h,g=e;h=d,e=r,d=y,r=g,y=1}else if(h>s||d<o)return;if(e>r){if(r>n||e<l)return;var v=1;e=-e,r=-r,g=l,l=-n,n=-g}else if(e>n||r<l)return;if(h<o){if((e+=(o-h)*(r-e)/(d-h))>n)return;h=o}if(e<l){if((h+=(l-e)*(d-h)/(r-e))>s)return;e=l}return d>s&&(r=e+(s-h)*(r-e)/(d-h),d=s),r>n&&(d=h+(n-e)*(d-h)/(r-e),r=n),v&&(e=-e,r=-r),y?[new J(d,-r),new J(h,-e)]:[new J(h,-e),new J(d,-r)]}function Wf(e,r,n){e=Xf(e,!0),r=Xf(r,!1);var o,s,l={},h=o=1;switch(~~(n||0)){case 1:h=o=0;break;case 2:o=0,h=1;break;case 3:o=1,h=0}n=o;var d=h;if(r&&e){for(r.se=new Yf(r.x,r.y,null,Zf(r)),e.se=new Yf(e.x,e.y,null,Zf(e)),h=r;h.next;h=h.next)if(!h.Za){for(o=e;o.next;o=o.next)if(!o.Za){var y=$f(h.next),g=$f(o.next);if(s=ag(h,y,o,g,l)){s=l.pl;var v=l.ql,m=l.Po,w=l.Qo;s=new Yf(m,w,null,null,null,null,!0,0,0,s),bg(s,h,y),y=new Yf(m,w,null,null,null,null,!0,0,0,v),bg(y,o,g),s.Th=y,y.Th=s}}}for(l=fe(r,cg(e)),n&&(l=!l),h=r;h;h=h.next)h.Za&&(h.vh=l,l=!l);for(l=fe(e,cg(r)),d&&(l=!l),o=e;o.next;o=o.next)o.Za&&(o.vh=l,l=!l);for(dg(r),dg(e);(e=eg(r))!=r;){for(n=null;!e.yg;e=e.Th){for(l=e.vh;n=new Yf(e.x,e.y,n),n.artificial=e.Za||e.Sj,e.yg=1,e=l?e.next:e.gc,!!e;)if(e.Za){e.yg=1;break}if(!e)break}n.Uh=I||null;var I=n}return I}}t("H.math.clipping.clipPolygon",Wf);function Yf(e,r,n,o,s,l,h,d,y,g){this.x=e,this.y=r,this.next=n||null,this.gc=o||null,this.Uh=s||null,this.Th=l||null,this.Za=!!h,this.vh=!!d,this.yg=y||0,this.alpha=g||0,o&&(o.next=this),n&&(n.gc=this),this.Sj=!1,this.se=null}function $f(e){for(;e&&e.Za;)e=e.next;return e}function Zf(e){if(e)for(;e.next;)e=e.next;return e}function eg(e){var r=e;if(r)do r=r.next;while(r!=e&&(!r.Za||r.Za&&r.yg));return r}function dg(e){var r=Zf(e);r.gc.next=e,e.gc=r.gc}function ag(e,r,n,o,s,l){var h,d=r.x-e.x,y=r.y-e.y,g=o.x-n.x,v=o.y-n.y,m=d*v-y*g;return!m||(g=((n.x-e.x)*v-(n.y-e.y)*g)/m,m=(y*(n.x-e.x)-d*(n.y-e.y))/m,0>g||1<g||0>m||1<m)?0:(g===0?h=e:g===1?h=r:m===0?h=n:m===1&&(h=o),h&&!l?(h.x+=2480549651603763e-20,h.y+=7321997314118067e-20,h.se&&(h.se.x=h.x,h.se.y=h.y),ag(e,r,n,o,s)):(s.Po=e.x+g*d,s.Qo=e.y+g*y,s.pl=g,s.ql=m,1))}function cg(e){for(var r=[];e;)r.push(e.x,e.y),e=e.next;return r}function bg(e,r,n){for(r=r.next;r!==n&&r.alpha<=e.alpha;)r=r.next;e.next=r,e.gc=r.gc,e.next.gc=e,e.gc.next=e}function Xf(e,r){for(var n,o=null,s=0,l=e.length;s<l;s++)n=new Yf(e[s].x,e[s].y,o),n.Sj=r,(n.next=o)&&(o.gc=n),o=n;return o}function fg(e,r,n){var o=ae(+e,-90,90);if(r&&E(o))throw new D(r,n,e);return o}function gg(e,r,n){var o=+e;if((-180>o||180<o)&&(o=Zd(o+180,360)-180),r&&E(o))throw new D(r,n,e);return o}function hg(e,r,n){var o;if(e!==B&&E(o=+e)&&r)throw new D(r,n,e);return o}function ig(e,r){return 0>e!=0>r&&180<Dd(r-e)}t("H.geo.isDBC",ig);function jg(){xc(this,jg)}t("H.geo.AbstractGeometry",jg),jg.prototype.getBoundingBox=jg.prototype.K,jg.prototype.equals=jg.prototype.ia,jg.prototype.rb="",jg.prototype.Hb="",jg.prototype.toString=function(){return this.cd([this.rb.toUpperCase()," "]).join("")},jg.prototype.toString=jg.prototype.toString,jg.prototype.Kc=function(){return{type:this.Hb,coordinates:this.bd()}},jg.prototype.toGeoJSON=jg.prototype.Kc,jg.prototype.Y=function(){return{type:this.rb,coordinates:this.pc(),boundingBox:this.K().Y()}},jg.prototype.forWorkerMessage=jg.prototype.Y;function kg(e,r,n){this.lat=fg(e,kg,0),this.lng=gg(r,kg,1),n!==B&&(this.alt=hg(n,kg,2))}u(kg,jg),t("H.geo.Point",kg),kg.prototype.ia=function(e){return this===e||!!e&&this.lat===e.lat&&this.lng===e.lng&&(this.alt||0)===(e.alt||0)},kg.prototype.equals=kg.prototype.ia,kg.prototype.Wa=function(e){if(this===e||this.lat===e.lat&&this.lng===e.lng)e=0;else{var r=this.lat*Ud,n=e.lat*Ud;e=1274200158e-2*Jd(yd(1,Fd(Gd(Id((r-n)/2),2)+Kd(r)*Kd(n)*Gd(Id((this.lng*Ud-e.lng*Ud)/2),2))))}return e},kg.prototype.distance=kg.prototype.Wa,kg.prototype.zg=function(e,r,n){var o;if(n){if(o=r/637100079e-2){r=e*Ud,e=Ud*this.lat;var s=Id(e);n=Id(o);var l=Kd(o);o=Ud*this.lng;var h=Kd(e);e=Jd(h*Kd(r)*n+s*l),r=Nd(Id(r)*h*n,l-s*Id(e)),r=(o+r+Pd)%(2*Pd)-Pd,r*=Vd,s=new kg(e*Vd,(r+540)%360-180)}return s||this}return e=(e%360+360)%360,(e+90)%180===0?(e=this.lng+r/(637100079e-2*Sd*Kd(this.lat*Ud))*(e===270?-360:360),new kg(this.lat,(e+540)%360-180)):((r/=637100079e-2)&&(e*=Ud,s=this.lat*Ud,n=this.lng*Ud,o=s+r*Kd(e),l=o-s,h=Ed(Ld(o/2+Rd)/Ld(s/2+Rd)),h=E(l/h)?Kd(s):l/h,e=r*Id(e)/h,Dd(o)>Qd&&(o=0<o?Pd-o:-(Pd+o)),o=new kg(o*Vd,((n+e+Td+(Dd(s+l)>Qd?Pd:0))%Sd-Pd)*Vd)),o||this)},kg.prototype.walk=kg.prototype.zg,kg.prototype.K=function(){return new K(this.lat,this.lng,this.lat,this.lng)},kg.prototype.getBoundingBox=kg.prototype.K;function lg(e,r,n){var o=Ea(e)&&!(E(e.lat=fg(e.lat))||E(e.lng=gg(e.lng))||e.alt!==B&&E(e.alt=hg(e.alt)));if(!o&&r)throw new D(r,n,e);return o}kg.validate=lg;function ng(e){if(!e)throw new D(ng,0,e);return new kg(e.lat,e.lng,e.alt)}kg.fromIPoint=ng,p=kg.prototype,p.rb="Point",p.cd=function(e){return e.push("(",this.lng," ",this.lat,")"),e},p.Hb="Point",p.bd=function(){return[this.lng,this.lat,this.alt||0]},p.pc=function(){return[this.lat,this.lng,this.alt||0]};function K(e,r,n,o){og(this,fg(e,K,0),gg(r,K,1),fg(n,K,2),gg(o,K,3))}u(K,jg),t("H.geo.Rect",K),K.prototype.rb="Polygon",K.prototype.cd=function(e){var r=this.c,n=this.a,o=this.f,s=this.b;return e.push("(","(",n," ",r,",",s," ",r,",",s," ",o,",",n," ",o,",",n," ",r,")",")"),e},K.prototype.ia=function(e){var r=this===e;return!r&&C(e,K)&&(r=this.c===e.c&&this.a===e.a&&this.f===e.f&&this.b===e.b),r},K.prototype.equals=K.prototype.ia,K.prototype.clone=function(){return new K(this.c,this.a,this.f,this.b)},K.prototype.clone=K.prototype.clone;function og(e,r,n,o,s){return e.a=n,e.b=s,r<o&&(n=r,r=o,o=n),e.c=r,e.f=o,e.l=e.g=e.i=null,e}K.prototype.Nb=function(){return this.l||(this.l=new kg(this.c,this.a)),this.l},K.prototype.getTopLeft=K.prototype.Nb,K.prototype.Jb=function(){return this.g||(this.g=new kg(this.f,this.b)),this.g},K.prototype.getBottomRight=K.prototype.Jb,K.prototype.bn=function(){return this.c},K.prototype.getTop=K.prototype.bn,K.prototype.Pl=function(){return this.f},K.prototype.getBottom=K.prototype.Pl,K.prototype.xm=function(){return this.a},K.prototype.getLeft=K.prototype.xm,K.prototype.Sm=function(){return this.b},K.prototype.getRight=K.prototype.Sm,K.prototype.bb=function(){return this.i||(this.i=new kg(this.f+(this.c-this.f)/2,pg(this.a,this.Ab()))),this.i},K.prototype.getCenter=K.prototype.bb,K.prototype.Ab=function(){return qg(this.a,this.b)},K.prototype.getWidth=K.prototype.Ab,K.prototype.Ld=function(){return this.c-this.f},K.prototype.getHeight=K.prototype.Ld,K.prototype.Bb=function(){return this.a>this.b},K.prototype.isCDB=K.prototype.Bb,K.prototype.Rf=function(){return!this.Ab()&&!this.Ld()},K.prototype.isEmpty=K.prototype.Rf,K.prototype.K=function(){return new K(this.c,this.a,this.f,this.b)},K.prototype.getBoundingBox=K.prototype.K,K.prototype.uf=function(e,r,n){var o=this.bb();return n||(e=fg(e,this.uf,0),r=gg(r,this.uf,1)),r=this.Xc(e,r,n),e=r.bb(),e.lat===o.lat&&e.lng===o.lng&&this.Ld()===r.Ld()&&this.Ab()===r.Ab()},K.prototype.containsLatLng=K.prototype.uf,K.prototype.gd=function(e,r){return r||lg(e,this.gd,0),this.uf(e.lat,e.lng,r)},K.prototype.containsPoint=K.prototype.gd,K.prototype.Qg=function(e,r){var n=this.bb();if(!r&&!C(e,K))throw new D(this.Qg,0,e);return r=this.ec(e,r),e=r.bb(),e.lat===n.lat&&e.lng===n.lng&&this.Ld()===r.Ld()&&this.Ab()===r.Ab()},K.prototype.containsRect=K.prototype.Qg,K.prototype.Xc=function(e,r,n,o){if(!n){if(E(e=fg(e)))throw new D(this.Xc,0,e);if(E(r=gg(r)))throw new D(this.Xc,1,r)}return rg(this.c,this.a,this.f,this.b,e,r,e,r,o)},K.prototype.mergeLatLng=K.prototype.Xc,K.prototype.jk=function(e,r,n){return r||lg(e,this.jk,0),this.Xc(e.lat,e.lng,r,n)},K.prototype.mergePoint=K.prototype.jk,K.prototype.ec=function(e,r,n){if(!r&&!C(e,K))throw new D(this.ec,0,e);return rg(this.c,this.a,this.f,this.b,e.c,e.a,e.f,e.b,n)},K.prototype.mergeRect=K.prototype.ec,K.prototype.Bc=function(e,r,n,o,s,l){return s||(e=fg(e,this.Bc,0),r=gg(r,this.Bc,1),n=fg(n,this.Bc,2),o=gg(o,this.Bc,3)),rg(this.c,this.a,this.f,this.b,e,r,n,o,l)},K.prototype.mergeTopLeftBottomRight=K.prototype.Bc,K.prototype.nd=function(e,r){var n=this.a<=this.b,o=e.a<=e.b,s=this.a<e.b,l=e.a<this.b;if(!r&&!C(e,K))throw new D(this.nd,0,e);return this.f<=e.c&&e.f<=this.c&&(!n&&(!o||s||l)||!o&&(s||l)||s&&l)},K.prototype.intersects=K.prototype.nd;function qg(e,r){return e=r-e,e+(0>e?360:0)}function pg(e,r){return e+=r/2,e-(180<e?360:0)}function rg(e,r,n,o,s,l,h,d,y){n=yd(n,h),e=zd(e,s),s=qg(r,o);var g=pg(r,s);h=qg(l,d);var v=pg(l,h)-g;if(v+=0>v-1e-6?360:0,180>v-1e-6){g=r;var m=d}else v=360-v,g=l,m=o;return v=v+s/2+h/2,360<=v+5e-7?(g=-180,m=180):v-5e-7<s?(g=r,m=o):v-5e-7<h&&(g=l,m=d),y?og(y,e,g,n,m):new K(e,g,n,m)}K.merge=rg;function sg(e,r,n){return n||(lg(e,sg,0),lg(r,sg,1)),new K(e.lat,e.lng,r.lat,r.lng)}K.fromPoints=sg;function tg(e,r){var n=1,o=e.length,s=null;if(!Ca(e))throw new D(tg,0,e);if(0<o){var l=e[0];for(s=sg(l,l,r);n<o;n++)l=e[n],s.Xc(l.lat,l.lng,r,s)}return s}K.coverPoints=tg;function ug(e,r){var n=3,o=e.length,s;if(!(r||e&&e.length!=null))throw new D(ug,0,e);if(0<o)for(s=new K(e[0],e[1],e[0],e[1]);n<o;n+=3)s.Xc(e[n],e[n+1],r,s);return s}K.coverLatLngAlts=ug;function vg(e,r){var n=1,o=e.length,s;if(r&&(!e||e.length==null))throw new D(vg,0,e);if(0<o)for(s=new K(e[0].c,e[0].a,e[0].f,e[0].b);n<o;n++)s.ec(e[n],r,s);return s}K.coverRects=vg,K.prototype.Hk=function(e,r){var n=this.a,o=this.c,s=this.b,l=this.f,h=this.bb().lng;lg(e,this.Hk,0);var d=e.lat-l-(o-l)/2,y=e.lng-h;return y=180<y||-180>y?-(h+e.lng):y,e=n+(0>y?2*y:0),e=-180>e?360+e:e,s+=0<y?2*y:0,s=180<s?s-360:s,o=0<d?o+2*d:o,90<=o&&(o=90),l=0>d?l+2*d:l,-90>=l&&(l=-90),r?og(r,o,e,l,s):new K(o,e,l,s)},K.prototype.resizeToCenter=K.prototype.Hk,K.prototype.Hb="Polygon",K.prototype.bd=function(){return[[this.a,this.c,0],[this.b,this.c,0],[this.b,this.f,0],[this.a,this.f,0],[this.a,this.c,0]]},K.prototype.Y=function(){return this.pc()},K.prototype.pc=function(){return[this.c,this.a,this.f,this.b]};function wg(e,r,n,o,s,l){xc(this,wg),this.c=e||10,this.b=null,this.f=o||0,this.g=s||0,this.i=r||1,this.l=n||1,this.m=!!l,this.flush()}function xg(e){var r=e.b;if(e.m&&!r){var n=e.head;(n.entries||n[0]||n[1]||n[2]||n[3])&&(r=[n],r=yg([r,r,r,r],[n[6],n[7],n[4],n[5]]),e.b=r)}return r}function yg(e,r){var n,o,s,l,h=0;for(n=3;0<=n;n--){var d=n+4,y=0<n%3,g=[],v=r[n],m=e[n];for(o=m.length;o--;){var w=m[o];if(s=w.entries)for(l=s.length;l--;){var I=s[l].a(n);(y?I>v:I<v)&&(v=I)}for(l=4;l--;)(s=w[l])&&(y?s[d]>v:s[d]<v)&&g.push(s)}h+=g.length,r[n]=v,e[n]=g}return h&&(r=yg(e,r)),r}function zg(e,r,n){var o,s;if(e.m&&(o=e.b))for(s=3;0<=s;s--){var l=r.a(s);if(s%3?l>=o[s]:l<=o[s])if(n)o[s]=l;else{e.b=null;break}}}wg.prototype.remove=function(e){var r,n,o,s=!1;return e&&(r=e.node)&&r.b===this&&(n=r.entries)&&0<=(o=n.indexOf(e))&&(n.splice(o,1),this.s(r),zg(this,e,!1),s=!0),s},wg.prototype.flush=function(){var e=new Ag(B,NaN,this.f-this.i,this.g-this.l,this.f+this.i,this.g+this.l);e.b=this,this.head=this.a=e,this.b=null};function Bg(e,r){var n=e.head,o;if(r){var s=r;if(s!==n)for(n=s;s=s.parent;)(s.entries||1<s.a)&&(n=s)}else for(;!n.entries&&2>(o=n.a)&&o;)n=s;e.head=n}wg.prototype.Za=function(e,r,n,o,s,l){var h=[],d=this.head,y=this.a;return e<=d[5]&&r<=d[6]&&(s?n>=d[7]:n>d[7])&&(l?o>=d[4]:o>d[4])&&Cg(this,d,h,e,r,n,o,l||o>=y[6],s||n>=y[5]),h};function Cg(e,r,n,o,s,l,h,d,y){var g=r.entries,v=r[7],m=r[4],w=r[5],I=r[6],V=r[8],q=r[9],De;if(g){var _n=g.length;if(s>m||o>v||h<I||l<w)for(;_n--;){v=g[_n],m=v.a(3),w=v.a(0),I=v.a(1);var ha=v.a(2);ha>=s&&I>=o&&(w<h||d&&w==h)&&(m<l||y&&m==l)&&n.push(v)}else for(;_n--;)n.push(g[_n])}(l>V||y&&l==V)&&(s<q&&(De=r[1])&&Cg(e,De,n,o,s,l,h,d,y),(h>q||d&&h==q)&&(De=r[3])&&Cg(e,De,n,o,s,l,h,d,y)),o<V&&(s<q&&(De=r[0])&&Cg(e,De,n,o,s,l,h,d,y),(h>q||d&&h==q)&&(De=r[2])&&Cg(e,De,n,o,s,l,h,d,y))}wg.prototype.Lc=ba(1);var Dg=0;function Ag(e,r,n,o,s,l){this.c=r,e&&(this.parent=e,this.b=e.b,r&1?(n=e[8],s=e[5]):(n=e[7],s=e[8]),r&2?(o=e[9],l=e[6]):(o=e[4],l=e[9])),this[7]=n,this[5]=s,this[8]=(n+s)/2,this[4]=o,this[6]=l,this[9]=(o+l)/2}Ag.prototype.a=0;function Eg(e,r){return e[r]||(++e.a,e[r]=new Ag(e,r))}Ag.prototype.removeChild=function(e){var r=e.c;this[r]===e&&(delete this[r],delete e.parent,--this.a)},Ag.prototype.Lc=ba(0);function Fg(e,r){(e.entries||(e.entries=[])).push(r),r.node=e}function Gg(e,r,n,o,s){var l=e[5],h=e[6];return e[7]<=r&&e[4]<=n&&(l>o||l===o&&l===e.b.a[5])&&(h>s||h===s&&h===e.b.a[6])}function Hg(e,r,n,o,s,l){Hg.j.constructor.apply(this,arguments)}u(Hg,wg),Hg.prototype.s=function(e){for(var r,n,o=this.head;e;){if((!(r=e.entries)||!r.length)&&(r&&delete e.entries,!e.a&&(n=e.parent))){n.removeChild(e),o===e&&(o=n),e=n;continue}break}this.head!==o&&(this.head=o,Bg(this))};function Ig(e,r,n,o,s){if(Gg(e.a,r,n,o,s))return Jg(e,e.a,r,n,o,s,e.c);throw Error("Coordinates out of bounds")}Hg.prototype.yc=function(e,r){return Ig(this,e,r,e,r)};function Jg(e,r,n,o,s,l,h){var d=r[8],y=r[9],g=0,v=0;return h&&(s<d||(g=+(n>=d)))&&(l<y||(v=+(o>=y)))?n=Jg(e,Eg(r,g|v<<1),n,o,s,l,h-1):(Fg(r,n=new Kg(n,o,s,l)),zg(e,n,!0),Bg(e,r)),n}function Kg(e,r,n,o){this.id=Dg++,this[0]=r,this[1]=n,this[2]=o,this[3]=e}Kg.prototype.a=function(e){return this[e]};function Lg(e){this.g=new Hg(+e||10,180,90,0,0,!0),this.f=[],this.i=!1,this.a=this.b=this.c=null}t("H.geo.QuadTree",Lg),p=Lg.prototype,p.Eh=0,p.Rc=function(){return this.Eh},p.Bb=function(){return this.i},p.K=function(){var e,r;if(!this.c){var n=[];!this.b&&(e=xg(this.g))&&(this.b=new K(-e[0],e[3],-e[2],e[1])),(r=this.b)&&n.push(r);var o,s,l;if(!this.a&&(l=(s=this.f).length)){e=90;var h=360,d=-90;for(o=0;l--;){var y=s[l];e=yd(e,y[0]),h=yd(h,y[3]),d=zd(d,y[2]),o=zd(o,y[1])}this.a=new K(-e,h,-d,o-360)}(r=this.a)&&n.push(r),(r=n[0])&&(n[1]&&(r=r.ec(n[1],!0)),this.c=r)}return this.c};function Mg(e,r,n,o,s,l){return l?(l=new Kg(s,-r,n+360,-o),e.f.push(l),e.i=!0,e.a&&e.a.Bc(r,n,o,s,!0,e.a)):(l=Ig(e.g,n,-r,s,-o),e.b&&e.b.Bc(r,n,o,s,!0,e.b)),++e.Eh,e.c=null,l}p.yc=function(e){var r=e.lng;return e=e.lat,Mg(this,e,r,e,r,!1)},p.Pj=function(e){var r=e.Nb(),n=e.Jb();return(e=e.Bb())?Mg(this,r.lat,n.lng,n.lat,r.lng,e):Mg(this,r.lat,r.lng,n.lat,n.lng,e)},Lg.prototype.insertBoundingBox=Lg.prototype.Pj,Lg.prototype.remove=function(e){var r;if(e.node){var n=this.g.remove(e);this.b=null}else e=(r=this.f).indexOf(e),(n=0<=e)&&(r.splice(e,1),this.i=0<r.length,this.a=null);return n&&(--this.Eh,this.c=null),n},Lg.prototype.remove=Lg.prototype.remove;function Ng(e,r,n,o,s,l,h){e=e.f;var d=e.length,y=[],g;if(d){var v=n+360;for(g=s+360;d--;){var m=e[d];(Og(m,r,n,o,s,l,h)||Og(m,r,v,o,g,l,h))&&y.push(m)}}return y}function Og(e,r,n,o,s,l,h){var d=e[3],y=e[0],g=e[1];return e=e[2],(l?y<=o:y<o)&&(h?d<=s:d<s)&&e>=r&&g>=n}function Pg(e,r){var n,o,s;if(n=r.length){var l=e.length;for(o={};l--;)o[e[l].id]=1;for(;n--;)(s=r[n]).id in o||e.push(s)}}Lg.prototype.Pf=function(e,r,n){var o=this.g,s=e.Nb(),l=e.Jb(),h=-s.lat;s=s.lng;var d=-l.lat;return l=l.lng,!r&&h===d||!n&&s===l?e=[]:e.Bb()?(e=o.Za(-180,h,l,d,n,r),Pg(e,o.Za(s,h,180,d,!1,r)),Pg(e,Ng(this,h,l,d,s+360,r,n))):(e=o.Za(s,h,l,d,n,r),Pg(e,Ng(this,h,s,d,l,r,n))),e},Lg.prototype.intersectBoundingBox=Lg.prototype.Pf;var Qg=[62,-1,-1,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,63,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],Rg=typeof BigInt<"u"?BigInt:Number;function Sg(e){var r=Rg(0),n=Rg(0),o=[];if(e.split("").forEach(function(s){s=Rg(Qg[s.charCodeAt(0)-45]),r|=(s&Rg(31))<<n,(s&Rg(32))===Rg(0)?(o.push(r),r=Rg(0),n=Rg(0)):n+=Rg(5)}),0<n)throw Error("Invalid encoding");return o}function Tg(e){return e&Rg(1)&&(e=~e),e>>=Rg(1),+e.toString()}function Ug(e){var r=e.precision===void 0?5:e.precision,n=e.hf===void 0?0:e.hf,o=e.jf===void 0?0:e.jf;e=e.ci;var s=Math.pow(10,r),l=Math.pow(10,o);r=Vg(r,n,o);var h=[],d=Rg(0),y=Rg(0),g=Rg(0);return e.forEach(function(v){var m=Rg(Math.round(v[0]*s));h.push(Wg(m-d)),d=m,m=Rg(Math.round(v[1]*s)),h.push(Wg(m-y)),y=m,n&&(v=Rg(Math.round(v[2]*l)),h.push(Wg(v-g)),g=v)}),(r instanceof Array?r:fa(ea(r))).concat(h instanceof Array?h:fa(ea(h))).join("")}function Vg(e,r,n){if(0>e||15<e)throw Error("precision out of range. Should be between 0 and 15");if(0>n||15<n)throw Error("thirdDimPrecision out of range. Should be between 0 and 15");if(0>r||7<r||r===4||r===5)throw Error("thirdDim should be between 0, 1, 2, 3, 6 or 7");return e|=n<<7|r<<4,Xg(1)+Xg(e)}function Xg(e){var r="";for(e=Rg(e);31<e;){var n=e&Rg(31)|Rg(32);r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[n],e>>=Rg(5)}return r+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[e]}function Wg(e){e=Rg(e);var r=0>e;return e<<=Rg(1),r&&(e=~e),Xg(e)}function Yg(e){return Ug({ci:e.polyline,precision:e.precision,hf:e.thirdDim,jf:e.thirdDimPrecision})}t("H.util.flexiblePolyline.encode",Yg);function Zg(e){if(e=Sg(e),+e[0].toString()!=1)throw Error("Invalid format version");var r=+e[1].toString();r={precision:r&15,hf:r>>4&7,jf:r>>7&15};for(var n=Math.pow(10,r.precision),o=Math.pow(10,r.jf),s=r.hf,l=0,h=0,d=0,y=[],g=2;g<e.length;){var v=Tg(e[g])/n,m=Tg(e[g+1])/n;l+=v,h+=m,s?(v=Tg(e[g+2])/o,d+=v,y.push([l,h,d]),g+=3):(y.push([l,h]),g+=2)}if(g!==e.length)throw Error("Invalid encoding. Premature ending reached");return e=Object.assign({},r,{ci:y}),{polyline:e.ci,precision:e.precision,thirdDim:e.hf,thirdDimPrecision:e.jf}}t("H.util.flexiblePolyline.decode",Zg);function L(e){L.j.constructor.call(this),e&&$g(e,L,0),this.$=e||[],this.a=ah(this,0,this.$.length)}u(L,jg),t("H.geo.LineString",L);function ah(e,r,n){e=e.$;var o=0;for(r=zd(r,0),n=yd(n,e.length),n-=2,r+=1;r<n;)o+=ig(e[r],e[r+=3]);return o}L.prototype.gi=function(e,r,n){bh(this,e,r,n,this.gi)},L.prototype.pushLatLngAlt=L.prototype.gi;function bh(e,r,n,o,s){var l=e.$.length;r=fg(r,s),n=gg(n,s),e.$.push(fg(r,s),gg(n,s),o===B?0:hg(o,s)),l&&(e.a+=ig(e.$[l-2],n)),delete e.b,delete e.c}L.prototype.ff=function(e,r,n){n&&$g(n,this.ff,2),r===void 0&&(r=this.$.length),r&&(this.a-=ah(this,e-3,e+r+3));var o=n?this.$.splice.apply(this.$,[e,r].concat(n)):this.$.splice(e,r);return n&&(this.a+=ah(this,e-3,e+n.length+3)),r&&!n&&(this.a+=ah(this,e-3,e-3)),delete this.b,delete this.c,o},L.prototype.spliceLatLngAlts=L.prototype.ff,L.prototype.Qj=function(e,r,n,o){this.ff(e,0,[r,n,o])},L.prototype.insertLatLngAlt=L.prototype.Qj,L.prototype.Dk=function(e){this.ff(e,3)},L.prototype.removeLatLngAlt=L.prototype.Dk,L.prototype.qd=function(e){bh(this,e.lat,e.lng,e.alt,this.qd)},L.prototype.pushPoint=L.prototype.qd,L.prototype.yc=function(e,r){this.Qj(3*e,r.lat,r.lng,r.alt)},L.prototype.insertPoint=L.prototype.yc,L.prototype.Xe=function(e){this.Dk(3*e)},L.prototype.removePoint=L.prototype.Xe,L.prototype.ye=function(e,r){var n=this.$,o=3*e;e=n[o];var s=n[o+1];return n=n[o+2],r&&(r.lat=e,r.lng=s,r.alt=n),r||new kg(e,s,n)},L.prototype.extractPoint=L.prototype.ye,L.prototype.El=function(e,r,n){var o=this.$;r=r||0,n=af(n,o.length/3);for(var s=3*r;r<n;)e(o[s++],o[s++],o[s++],r++)},L.prototype.eachLatLngAlt=L.prototype.El,L.isDBC=ig,L.prototype.eh=function(e){var r=this.a;return e&&(e=this.$,r+=ig(e[e.length-2],e[1])),r},L.prototype.getDBCs=L.prototype.eh,L.prototype.Ie=function(){return this.$.length/3},L.prototype.getPointCount=L.prototype.Ie,L.prototype.um=function(){return this.$},L.prototype.getLatLngAltArray=L.prototype.um,L.prototype.b=z,L.prototype.K=function(){var e;if(!(e=this.b)){e=this.$;var r=e.length,n=3,o,s,l=z;if(3<=r){var h=o=e[0],d=s=e[1];for(l=new K(h,d,o,s);n<r;n+=3){if(h=e[n-3],d=e[n-2],o=e[n],s=e[n+1],d>s&&180<s-d||d<s&&-180>d-s||s<d&&180>Dd(s-d)){var y=d;d=s,s=y}h<o&&(y=h,h=o,o=y),rg(l.c,l.a,l.f,l.b,h,d,o,s,l)}}e=this.b=l}return e},L.prototype.getBoundingBox=L.prototype.K,L.prototype.nn=function(){return this.b!==z},L.prototype.hasBoundingBox=L.prototype.nn;function $g(e,r,n){for(var o=e.length,s=!(o%3),l;s&&o;)s=!(E(e[--o]=hg((l=e[o])===B?0:l))||E(e[--o]=gg(e[o]))||E(e[--o]=fg(e[o])));if(!s&&r)throw new D(r,n,e)}function ch(e){var r=new L,n=0,o=e.length;if(o%2)throw new D(ch,0,e);for(;n<o;)bh(r,e[n++],e[n++],0,ch);return r}L.fromLatLngArray=ch,L.prototype.ia=function(e){var r=this===e,n;if(!r&&(r=C(e,L))){var o=this.$;for(e=e.$,r=(n=o.length)===e.length;r&&n--;)r=o[n]==e[n]}return r},L.prototype.equals=L.prototype.ia;function dh(e,r){return e.b-r.b}function eh(e,r){var n=e.$,o=-2,s=[],l,h=e.c;if(!h){h=e.c=new Lg;var d=0,y=e.$,g=y.length;for(l=0;l<g;l+=3){var v=y[l],m=y[l+1];if(l){if(I<m)var w=I,I=m;else w=m;if(q<v)var V=v;else{V=q;var q=v}w=Mg(h,V,w,q,I,180<I-w),w.b=d++}q=v,I=m}}for(h=h.Pf(r).sort(dh),y=h.length,r=0;r<y;r++){if(d=h[r],d=d.b,g=3*d,d>o+1){var De=[n[g],n[g+1]];s.push(De)}o=d,De.push(n[g+3],n[g+4])}if(e.a){for(n=[],o=s.length,r=0;r<o;r++)if(De=s[r],h=De.length){for(y=[],e=0;e<h;e+=2)d=De[e],g=De[e+1],y.push(d,g),l=De[e-1],e&&ig(g,l)&&(n.push(y),y=[],l+=0>l?360:-360,y.push(De[e-2],l,d,g));n.push(y)}s=n}return s}p=L.prototype,p.rb="LineString",p.cd=function(e,r){var n=this.$,o=n.length,s;if(o){for(e.push("("),s=0;s<o;s+=3)s&&e.push(","),e.push(n[s+1]," ",n[s]);r&&(n[0]!==n[o-3]||n[1]!==n[o-2])&&e.push(",",n[1]," ",n[0]),e.push(")")}else e.push("EMPTY");return e},p.Hb="LineString",p.bd=function(){var e=[],r=this.$,n=r.length,o;for(o=0;o<n;o+=3)e.push([r[o+1],r[o],r[o+2]]);return e},p.pc=function(){var e=this.$,r;if(this.K().Bb()){e=e.slice();var n=1;for(r=e.length;n<r;n+=3)0>e[n]&&(e[n]+=360)}return e},p.Ko=function(e){e=e===void 0?5:e;for(var r=this.$,n=r.length,o=[],s=0;s<n;s+=3)o.push([r[s],r[s+1],r[s+2]]);return Yg({polyline:o,precision:e,thirdDim:2,thirdDimPrecision:e})},L.prototype.toFlexiblePolyline=L.prototype.Ko;function fh(e){var r=Zg(e);e=r.polyline;var n=r.thirdDim;if(r=n===2||n===3,n=n===0,!e)throw new D(fh,0,"data");if(r||n){n=e.length;for(var o=Array(3*n),s=0,l=0;s<n;s++){var h=e[s];o[l++]=h[0],o[l++]=h[1],o[l++]=r?h[2]:0}}if(!o)throw new D(fh,0,"only ABSENT, ALTITUDE or ELEVATION are supported as type of the 3rd dimension");return new L(o)}L.fromFlexiblePolyline=fh;function gh(e){xc(this,gh),gh.j.constructor.call(this),this.la=hh(this,e,this.constructor,0)}u(gh,jg),t("H.geo.MultiGeometry",gh),gh.prototype.splice=function(e,r,n){return e=[e],r!==B&&e.push(r),n&&(r=hh(this,n,this.splice,2),e=e.concat(r)),this.a=z,this.la.splice.apply(this.la,e)},gh.prototype.splice=gh.prototype.splice,gh.prototype.hc=function(e){var r=this.la.length;if(!(0<=e&&e<r))throw new ne(this.hc,e,[0,r-1]);return this.a=z,this.la.splice(e,1)[0]},gh.prototype.removeAt=gh.prototype.hc,gh.prototype.remove=function(e){if(e=this.la.indexOf(e),0<=e){var r=this.la.splice(e,1)[0];this.a=z}return r||z},gh.prototype.remove=gh.prototype.remove,gh.prototype.mm=function(){return this.la},gh.prototype.getGeometries=gh.prototype.mm,gh.prototype.push=function(e){var r=hh(this,[e],this.push,0)[0];this.a&&(this.a=this.a.ec(e.K())),this.la.push(r)},gh.prototype.push=gh.prototype.push,gh.prototype.K=function(){var e;if(!(e=this.a)){e=z;var r,n;if(this.la.length)for(e=this.la[0].K(),n=1;n<this.la.length;n++)(r=this.la[n].K())&&(e=e?e.ec(r):r)}return this.a=e},gh.prototype.getBoundingBox=gh.prototype.K,gh.prototype.a=z;function hh(e,r,n,o){var s,l=[];if(!Bc(r))throw new D(n,o);for(s=0;s<r.length;s++)if(e.b(r[s]))l.push(e.c(r[s]));else throw new D(n,o);return l}gh.prototype.c=function(e){return e},gh.prototype.ia=function(e){var r=this===e,n;if(!r&&(r=C(e,this.constructor))){var o=this.la;for(e=e.la,r=(n=o.length)===e.length;r&&n--;)r=o[n].ia(e[n])}return r},gh.prototype.equals=gh.prototype.ia,gh.prototype.cd=function(e){var r=this.la,n=r.length,o,s,l=!1;if(n){for(e.push("("),o=0;o<n;o++)(s=0<o&&l)&&e.push(","),r[o].cd(e),e[e.length-1]==="EMPTY"?e.splice(-1-+s,1+ +s):l=!0;l?e.push(")"):e.splice(-1,1,"EMPTY")}else e.push("EMPTY");return e},gh.prototype.pc=function(){for(var e=[],r=this.la,n=r.length;n--;)e[n]=r[n].pc();return e},gh.prototype.Y=function(){var e=gh.j.Y.call(this);return e.type=this.rb,e},gh.prototype.bd=function(){for(var e=[],r=this.la,n=r.length;n--;)e[n]=r[n].bd();return e};function ih(e){ih.j.constructor.call(this,e)}u(ih,gh),t("H.geo.MultiLineString",ih),ih.prototype.b=function(e){return C(e,L)},ih.prototype.rb="Multi"+L.prototype.rb,ih.prototype.Hb="Multi"+L.prototype.Hb;function jh(){}t("H.map.provider.Invalidations",jh),jh.MARK_INITIAL=Xd,jh.prototype.update=function(e,r){r!==kh.NONE&&(this.a=e,r&kh.SPATIAL&&(this.f=e),r&kh.VISUAL&&(this.g=e),r&kh.ADD&&(this.b=e),r&kh.REMOVE&&(this.c=e),r&kh.Z_ORDER&&(this.l=e),r&kh.VOLATILITY&&(this.i=e))},jh.prototype.update=jh.prototype.update,jh.prototype.Bm=function(){return this.a},jh.prototype.getMark=jh.prototype.Bm,jh.prototype.a=Xd,jh.prototype.rn=function(e){return this.a>e},jh.prototype.isAny=jh.prototype.rn,jh.prototype.g=Xd,jh.prototype.Vd=function(e){return this.g>e},jh.prototype.isVisual=jh.prototype.Vd,jh.prototype.f=Xd,jh.prototype.yh=function(e){return this.f>e},jh.prototype.isSpatial=jh.prototype.yh,jh.prototype.b=Xd,jh.prototype.Rj=function(e){return this.b>e},jh.prototype.isAdd=jh.prototype.Rj,jh.prototype.c=Xd,jh.prototype.Sf=function(e){return this.c>e},jh.prototype.isRemove=jh.prototype.Sf,jh.prototype.l=Xd,jh.prototype.zh=function(e){return this.l>e},jh.prototype.isZOrder=jh.prototype.zh,jh.prototype.i=Xd,jh.prototype.vn=function(e){return this.i>e},jh.prototype.isVolatility=jh.prototype.vn;var kh={NONE:0,VISUAL:1,SPATIAL:2,ADD:4,REMOVE:8,Z_ORDER:16,VOLATILITY:32};jh.Flag=kh;function lh(e){lh.j.constructor.call(this),e!==void 0&&(this.data=e)}u(lh,F),t("H.map.Feature",lh),lh.prototype.getData=function(){return this.data},lh.prototype.getData=lh.prototype.getData,lh.prototype.o=function(){lh.j.o.call(this),delete this.data};function M(e){if(xc(this,M),M.j.constructor.call(this,e?e.data:B),this.ea=mh.next(),e){var r="min";Fc(e[r])&&(this.m=e[r]),r="max",Fc(e[r])&&(this.s=e[r]),r="visibility",r in e&&(this.u=!!e[r]),r="volatility",r in e&&(this.P=!!e[r]),r="zIndex",r in e&&(this.l=+e[r]||0),r="provider",r in e&&!C(e[r],N)&&(this.ma=e[r],this.ra(kh.ADD))}}u(M,lh),t("H.map.Object",M);var mh=new cf(1),nh={ANY:31,OVERLAY:1,SPATIAL:2,MARKER:4,DOM_MARKER:8,GROUP:16};M.Type=nh,M.prototype.cb=function(){return this.ea},M.prototype.getId=M.prototype.cb,M.prototype.Ai=function(e){if(!Fc(e)&&!Cc(e))throw new D(this.Ai,0,"id must be a number or a string");return this.i=e,this},M.prototype.setRemoteId=M.prototype.Ai,M.prototype.Rm=function(){return this.i},M.prototype.getRemoteId=M.prototype.Rm,M.prototype.m=-1/0,M.prototype.s=1/0,M.prototype.zj=function(e){var r=this.s;if(e)for(e=this;e=e.Fa;)r=yd(r,e.s);return r},M.prototype.getMax=M.prototype.zj,M.prototype.Bj=function(e){var r=this.m;if(e)for(e=this;e=e.Fa;)r=zd(r,e.m);return r},M.prototype.getMin=M.prototype.Bj,M.prototype.u=!0,M.prototype.qb=function(e){var r=this.u;return(e=!!e)!==r&&(this.u=e,this.invalidate(kh.VISUAL)),this},M.prototype.setVisibility=M.prototype.qb,M.prototype.wc=function(e){for(var r=this,n;(n=r.u)&&e&&(r=r.Fa););return n},M.prototype.getVisibility=M.prototype.wc,M.prototype.P=!1,M.prototype.Lf=function(e){for(var r=this,n;!(n=r.P)&&e&&(r=r.Fa););return n},M.prototype.getVolatility=M.prototype.Lf,M.prototype.Vk=function(e){var r=this.P;return r!==!!e&&(this.P=!r,this.invalidate(kh.VOLATILITY)),this},M.prototype.setVolatility=M.prototype.Vk,M.prototype.l=B,M.prototype.Ij=function(){return this.l},M.prototype.getZIndex=M.prototype.Ij,M.prototype.fe=function(e){return e!==this.l&&(this.Ye(),this.l=e,this.invalidate(kh.Z_ORDER)),this},M.prototype.setZIndex=M.prototype.fe,M.prototype.L=B,M.prototype.Uc=function(){var e=this.L,r,n;if(!e){var o=+((r=this.l)!==B);(e=this.Fa)?(e=e.Uc().slice(),e[0]|=o):e=[o],e.push(r||0,0>(n=this.Di)?this.ea:n),this.L=e}return e},M.prototype.getZInfo=M.prototype.Uc,M.prototype.Ye=function(){this.L=B};function oh(e,r,n){var o,s;if(!n||e[0]|r[0]){var l=e.length,h=r.length,d=yd(l,h),y=1;for(s=1+ +n;y<d;y+=s)if(o=e[y]-r[y])return o}return n?0:l-h}M.compareZInfo=oh;function ph(e,r){return e.cj(r)}M.compareZOrder=ph,M.prototype.cj=function(e){return this.T-e.T||oh(this.Uc(),e.Uc(),!1)},M.prototype.compareZOrder=M.prototype.cj,p=M.prototype,p.previousSibling=z,p.nextSibling=z,p.Di=-1,p.Fa=z,p.Fm=function(){return this.Fa},M.prototype.getParentGroup=M.prototype.Fm,M.prototype.bc=function(){for(var e=this,r;r=e.Fa;)e=r;return e},M.prototype.getRootGroup=M.prototype.bc,M.prototype.contains=function(e){return this===e},M.prototype.contains=M.prototype.contains,M.prototype.ka=function(e){if(this.Fa)throw new $c(this.ka,"Not allowed for a child of a group");M.j.ka.call(this,e)},M.prototype.setParentEventTarget=M.prototype.ka,M.prototype.draggable=!1,M.prototype.ma=z,M.prototype.ca=function(){return this.ma},M.prototype.getProvider=M.prototype.ca,M.prototype.ee=function(e,r){var n=this.ma,o;if(o=n!==e){if(r&&(n&&!C(n,N)||e&&!C(e,N)))throw new $c(r,"Only LocalObjectProvider allows an object transfers");r=this.type!==nh.GROUP,n&&(this.invalidate(kh.REMOVE),r&&n.Ga(this)),(this.ma=e)&&(r&&e.fa(this),this.ta=z,this.invalidate(kh.ADD))}return o},M.prototype.ta=z,M.prototype.Kb=function(){return this.ta||(this.ta=new jh)},M.prototype.getInvalidations=M.prototype.Kb,M.prototype.ra=function(e){var r=this.ca(),n;return(n=!!r)&&r.invalidateObject(this,e),n},M.prototype.invalidate=M.prototype.ra,M.prototype.o=function(){this.Fa&&this.Fa.Ga(this),M.j.o.call(this)},M.prototype.setData=function(e){return this.data=e,this},M.prototype.setData=M.prototype.setData,M.prototype.Kc=function(e){var r;if(e&&!Da(e))throw new D(M.prototype.Kc,0,"opt_callback must be a function");return e=qh(this,e?e(this.data):this.data,!!e),this instanceof rh||this instanceof sh||this instanceof th||this instanceof uh?r={type:"Feature",properties:e,geometry:this.ga().Kc()}:r={type:"FeatureCollection",features:hf},this.i&&(r.id=this.i),r},M.prototype.toGeoJSON=M.prototype.Kc;function qh(e,r,n){if(r===null||r===B)return null;if(0<=Object.keys(r).length&&Object.prototype.toString.call(r)!=="[object Object]")throw Error(vh(e,n));try{return JSON.stringify(r),r}catch{throw Error(vh(e,n))}}function vh(e,r){return"Object Remote-Id: "+e.i+" - "+(r?"The value returned by the callback is not a valid JSON object and cannot be set as Feature properties.":"The given object data is not a valid JSON object and cannot be set as Feature properties.")}M.prototype.Y=function(){return{id:this.ea,properties:{min:this.Bj(),max:this.zj(),zIdx:this.l,sIdx:this.Di,parent:this.Fa?this.Fa.cb():0,visible:this.wc(),volatile:this.Lf()},type:"Feature"}},M.prototype.forWorkerMessage=M.prototype.Y;function wh(e){var r;if(e){var n=xh;for(r=C(e,wh);n--;){var o=yh[n];if(e.hasOwnProperty(o)){var s=e[o];if(r)this[o]=s;else{if((s=zh[n](s))===Ah)throw new D(wh,0,o+": "+e[o]);s!==this[o]&&s!==B&&(this[o]=s)}}}n=r?e.b:this.lineWidth&&Ze(this.strokeColor),n||(this.b=n),n=r?e.Ob:Ze(this.fillColor),n||(this.Ob=n),n=r?e.a:this.strokeColor!=="none"&&this.lineWidth,n||(this.a=n)}qc(this)}t("H.map.SpatialStyle",wh),wh.prototype.Ob=!0,wh.prototype.b=!0,wh.prototype.a=!0;var yh="strokeColor fillColor lineWidth lineCap lineJoin miterLimit lineDash lineDashOffset lineDashImage lineHeadCap lineTailCap".split(" ");wh.prototype.strokeColor="rgba(0,85,170,.6)",wh.prototype.strokeColor=wh.prototype.strokeColor,wh.prototype.fillColor="rgba(0,85,170,.4)",wh.prototype.fillColor=wh.prototype.fillColor,wh.prototype.lineWidth=2,wh.prototype.lineWidth=wh.prototype.lineWidth,wh.prototype.lineCap="round",wh.prototype.lineCap=wh.prototype.lineCap,wh.prototype.lineJoin="miter",wh.prototype.lineJoin=wh.prototype.lineJoin,wh.prototype.miterLimit=1,wh.prototype.miterLimit=wh.prototype.miterLimit,wh.prototype.Bn=hf,wh.prototype.lineDash=wh.prototype.Bn,wh.prototype.lineDashOffset=0,wh.prototype.lineDashOffset=wh.prototype.lineDashOffset,wh.prototype.Cn=B,wh.prototype.lineDashImage=wh.prototype.Cn,wh.prototype.Dn=B,wh.prototype.lineHeadCap=wh.prototype.Dn,wh.prototype.En=B,wh.prototype.lineTailCap=wh.prototype.En;var xh=yh.length;wh.prototype.ia=function(e){var r=this===e;if(!r&&e){for(r=0;r<xh;r++){var n=yh[r];if(this[n]!==e[n])break}r=r===xh}return r},wh.prototype.equals=wh.prototype.ia,wh.prototype.vj=function(e){if(e){var r={};Ya(r,this,e)}else r=this;return new wh(r)},wh.prototype.getCopy=wh.prototype.vj;var Ah=qc({}),zh=[function(e){return e?pc(e):Ah},function(e){return e?pc(e):Ah},function(e){return 0<=e&&100>=e?+e:Ah},function(e){return e=pc(e),e==="butt"||e==="square"||e==="round"||e==="arrow-head"||e==="arrow-tail"?e:Ah},function(e){return e==="round"||e==="bevel"||e==="miter"?e:Ah},function(e){return 0<e&&100>=e?+e:Ah},function(e){return e&&e.every&&e.every(Gc)?e:Ah},function(e){return E(+e)?Ah:+e},function(e){return e===B||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||Object.values(Bh).includes(e)?e:Ah},function(e){return vc(e)?zh[3](e):B},function(e){return vc(e)?zh[3](e):B}],Ch=new Image().src="data:image/svg+xml;base64,"+btoa('<svg width="128" height="128" viewBox="0 0 128 128" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><g id="arrow"><path style="fill:#ff0000" d="M 0,0 32,64 2,128 128,64 Z"/></g></svg> '),Dh=new Image().src="data:image/svg+xml;base64,"+btoa('<svg width="128" height="128" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg"><circle style="fill:#ffffff" cx="64" cy="64" r="64" /></svg>'),Bh={ARROW:Ch,CIRCLE:Dh};wh.DashImage=Bh,wh.MAX_LINE_WIDTH=100;var Eh=new wh;wh.DEFAULT_STYLE=Eh;var Fh="fillColor strokeColor lineWidth lineCap lineJoin miterLimit lineDashOffset lineDash lineTailCap lineHeadCap".split(" ");wh.prototype.Y=function(){for(var e={},r=Fh.length,n;r--;)n=Fh[r],e[n]=this[n];return e},wh.prototype.forWorkerMessage=wh.prototype.Y;function Gh(e){var r;if(e){var n=C(e,Gh);for(r in e)if(r in this){var o=e[r];o!==this[r]&&(r==="fillColor"||0<(o=+o))&&(this[r]=o)}e=n?e.Ob:!!(Ze(this.fillColor)&&this.width&&this.width),e||(this.Ob=e)}qc(this)}t("H.map.ArrowStyle",Gh),Gh.prototype.Ob=!0,Gh.prototype.fillColor="rgba(255,255,255,.75)",Gh.prototype.width=1.2,Gh.prototype.length=1.6,Gh.prototype.frequency=5,Gh.prototype.uj=function(){return new Gh(this)},Gh.prototype.ia=function(e){var r=this===e;return!r&&e&&(r=e.width===this.width&&e.fillColor===this.fillColor&&e.length===this.length&&e.frequency===this.frequency),r},Gh.prototype.equals=Gh.prototype.ia;function Hh(e,r){var n;Hh.j.constructor.call(this,r),r&&this.gb(r.style),e&&(this.g=!0),r&&(n=r.arrows)&&this.Mk(n)}u(Hh,M),t("H.map.Spatial",Hh),Hh.prototype.type=nh.SPATIAL,Hh.prototype.T=0,Hh.prototype.style=Eh,Hh.prototype.V=function(){return this.style},Hh.prototype.getStyle=Hh.prototype.V,Hh.prototype.gb=function(e){var r=!0;return e?this.style=C(e,wh)?e:new wh(e):this.style?delete this.style:r=!1,r&&this.invalidate(kh.VISUAL),this},Hh.prototype.setStyle=Hh.prototype.gb,Hh.prototype.Ml=function(){return this.c},Hh.prototype.getArrows=Hh.prototype.Ml,Hh.prototype.Mk=function(e){var r=this.c,n=!1;return!e&&r?(delete this.c,n=!0):!e||r&&r.ia(e)||(this.c=new Gh(e),n=!0),n&&this.style.strokeColor!=="none"&&this.ra(1),this},Hh.prototype.setArrows=Hh.prototype.Mk;function Ih(e,r){var n=!1,o=!1,s;if(r.length){for(n=0;n<r.length;n++)if(r[n]!==Jh){o=!0;break}r=e.style,n=o?r.b||r.Ob&&e.g||(s=e.c||!1)&&r.a&&s.Ob:r.Ob}return n&&e.wc(!0)}Hh.prototype.g=!1,Hh.prototype.sn=function(){return this.g},Hh.prototype.isClosed=Hh.prototype.sn,Hh.prototype.getGeometriesForTile=Hh.prototype.Kd,Hh.prototype.gh=function(){return B},Hh.prototype.getLabels=Hh.prototype.gh;function Kh(e,r){Kh.j.constructor.call(this,e,r)}u(Kh,Hh),t("H.map.GeoShape",Kh),Kh.prototype.getBoundingBox=Kh.prototype.K;function Lh(e,r,n,o){var s=[],l=r.length,h;for(h=0;h<l;h++){var d=r[h];d.length&&s.push(Mh(e,d,n,o))}return s}function Mh(e,r,n,o){var s,l=[],h=r.length,d=0;for(e.xa=0,s=s||0;d<h;)l.push(Nh(e,r[d++],r[d++],s,o));return n&&l.push(Nh(e,r[0],r[1],s,o)),l}function Nh(e,r,n,o,s){var l=e.xa;return l&&180<Dd(l-n)&&(n+=0>l?-360:360),e.xa=n,s.Ah(r,n+o)}function Oh(e,r,n){for(var o=r,s,l=e.length+r,h,d;o--;){for(r=e[o],h=r.length,s=Array(h);h--;)d=r[h],s[h]=new J(d.x+n,d.y);e[--l]=s}}function Ph(e,r,n){this.paths=this.a=e,r!==B&&(this.interiorsIndex=this.b=r),n!==B&&(this.outlinesIndex=this.c=n)}Ph.prototype.b=Wd,Ph.prototype.interiorsIndex=Ph.prototype.b,Ph.prototype.c=Wd,Ph.prototype.outlinesIndex=Ph.prototype.c;var Jh=rc(new Ph([])),Qh=qc([]);function th(e,r){th.j.constructor.call(this,!1,r),this.da(e)}u(th,Kh),t("H.map.Polyline",th),th.prototype.K=function(){return this.a.K()},th.prototype.getBoundingBox=th.prototype.K,th.prototype.da=function(e){var r=this.da,n,o;if(C(e,ih)){var s=e.la;if(n=s.length)for(o=0;o<n;o++)Rh(s[o],r);else throw new D(r,0)}else Rh(e,r);return this.b=!!s,this.a=e,this.ra(kh.SPATIAL),this},th.prototype.setGeometry=th.prototype.da,th.prototype.ga=function(){return this.a},th.prototype.getGeometry=th.prototype.ga,th.prototype.clip=function(e){var r=this.a;return eh(this.b?r.la[0]:r,e)},th.prototype.clip=th.prototype.clip,th.prototype.Kd=function(e){var r=this.a,n,o=[];if(this.b)for(r=r.la,n=r.length;n--;)Sh(this,r[n],e,o);else Sh(this,r,e,o);return o.length?o:B},th.prototype.getGeometriesForTile=th.prototype.Kd;function Rh(e,r){if(!C(e,L)||2>e.Ie())throw new D(r,0)}function Sh(e,r,n,o){var s=eh(r,n.Hf());if(s.length&&(r=n.Jf(),e=Lh(e,s,!1,r),s=e.length)){var l=n.Le();r=r.w,n.x||Oh(e,s,-r),n.x===(1<<n.z)-1&&Oh(e,s,r),n=Uf(e,l.left,l.top,l.right,l.bottom,!1),n.length&&o.push(new Ph(n))}}th.prototype.Y=function(){var e=th.j.Y.call(this),r=e.properties;return e.geometry=this.ga().Y(),r.style=this.V().Y(),r.height=0,e},th.prototype.forWorkerMessage=th.prototype.Y;var Th;function Uh(e,r){if(x.URL)return new x.URL(e,r).toString();if(!e||!Vh(e))return e;if(!r||Vh(r))throw new TypeError("Failed to construct 'URL': Invalid base URL");Th||(Th=document.createElement("a"),Ic(Th));var n=Th;return n.href=r,e[0]!=="/"?e=n.href.replace(/\/[^\/]*$/,"/")+e:((r=n.origin)||(r=n.protocol+"//"+n.host),e=r+e),e}function Vh(e){var r=!1;return typeof e=="string"&&(r=!(-1<e.search(/^(http|https|data|blob):/)||e.substr(0,2)==="//")),r}function Wh(e,r){if(Wh.j.constructor.call(this),r&&Vh(r))throw new D(Wh,1,"Base URL must be absolute");this.C=Xh.INIT,this.Ca=null,this.Yb=r}u(Wh,F),t("H.map.render.Style",Wh),Wh.prototype.load=Wh.prototype.load,Wh.prototype.getState=function(){return this.C},Wh.prototype.getState=Wh.prototype.getState,Wh.prototype.O=function(e){this.C=e},Wh.prototype.setState=Wh.prototype.O,Wh.prototype.Ib=function(){return this.Yb},Wh.prototype.getBaseUrl=Wh.prototype.Ib,Wh.prototype.qc=function(){return sc(this.Ca)},Wh.prototype.getConfig=Wh.prototype.qc,Wh.prototype.Tl=function(){return this.Ca},Wh.prototype.getConfigReference=Wh.prototype.Tl,Wh.prototype.vd=function(e){this.Ca=e},Wh.prototype.setConfig=Wh.prototype.vd,Wh.prototype.Gb=function(e){this.Ca=null,this.O(Xh.ERROR),this.sh(Yh)?this.dispatchEvent(new wd(Yh,e,this)):console.error(e)},Wh.prototype.dispatchError=Wh.prototype.Gb,Wh.prototype.o=function(){Wh.j.o.call(this),this.Ca=null};var Yh="error",Zh={ed:"change",Ni:Yh},Xh={ERROR:-1,INIT:0,LOADING:1,READY:2};Wh.State=Xh;function $h(e,r){var n,o=arguments.length,s,l;for(n=1;n<o;n++)if((s=arguments[n])&&s!==e&&s!==h){var h=s;for(l in s){var d=s[l];e[l]!==d&&(ai(d)?ai(e[l])?e[l]=$h(e[l],d):e[l]=sc(d):d!==void 0&&(e[l]=sc(d)))}}return e}t("H.util.webgl.mergeObjects",$h);var bi=oc();function ci(e,r,n){var o=n[e];return r&&o in r&&0>uc.indexOf(o)?(r=r[o],++e<n.length?ci(e,r,n):r):bi}var di=ci.bind(null,0),ei={polygons:1,lines:1,"pattern-lines":1,points:1,text:1,raster:1,custom_icons:1,overlays:1},fi={data:1,draw:1,enabled:1,filter:1,properties:1},gi=Object.keys(fi);function hi(e,r,n,o,s,l){var h=o[e],d=n[h];if(++e<o.length){var y=r[h]||{};for(n=gi.length;n--;){var g=gi[n];if(g!=="draw"||!l){var v=d[g];v!==B&&(y[g]=sc(v))}}hi(e,y,d,o,s,l)}else s?y=sc(d):(y=d,delete n[h]);r[h]=r[h]?$h(r[h],y):y}var ii=hi.bind(null,0);function ji(e,r){e in ei&&(r[e]=1)}function ki(e,r,n){var o,s,l;for(o in e)if(fi[o]){if(o==="draw"){var h=e[o];for(s in h){var d=h[s];(l=d.style)?(d.style=r+l,ji(l,n)):(delete h[s],h[r+s]=d,ji(s,n))}}}else ki(e[o],r,n)}function li(e,r){var n={},o,s,l,h;if(r+="_",e=$h({},e),o=e.styles)for(s in o){var d=o[s];if(delete o[s],o[r+s]=d,l=d.mix)for(Cc(l)&&(l=[l]),h=l.length;h--;)ji(l[h],n),l[h]=r+l[h];(h=d.base)&&(l||(l=d.mix=[]),l.unshift(r+h),delete d.base,ji(h,n)),ji(s,n)}else o=e.styles={};if(d=e.layers)for(s in d)l=d[s],delete d[s],(h=l.data)&&!h.layer&&(h.layer=s),d[r+s]=l,ki(l,r,n);for(s in n)o[r+s]={base:s};return e}function mi(e,r){var n=e.sources,o=Object.keys(n)[0],s=$h(n[o],{uid:r});n=e.layers;var l;e.sources={},e.sources[r]=s;for(l in n)e=n[l],e.data?e.data.source===o&&(e.data.source=r):e.data={source:r}}function ni(e,r){var n,o=e.textures;e=e.fonts;for(n in o){var s=o[n];s.url&&(s.url=Uh(s.url,r))}for(n in e)if(s=e[n],Bc(s))for(o=0;o<s.length;o++){var l=s[o];l.url=l.url&&Uh(l.url,r)}else l=s,l.url=l.url&&Uh(l.url,r)}function oi(e,r){return"function(){return "+("feature."+e+(r||""))+";}"}function pi(e){return oi("style."+e,void 0)}function qi(e,r,n,o){return e={base:e,blend:r,blend_order:n},o&&(e.clean_depth=!!o),e}function ri(e){var r={};return r["translucent-"+(e?"extruded-":"")+"polygons"]={color:pi("fillColor"),order:1,interactive:!0,extrude:e},r}function si(e,r,n,o){return e={data:{source:e,layer:r}},n&&(e.draw=n),o&&(e.filter=o),e}function ai(e){return Ea(e)&&!Bc(e)}function ti(e,r){if(ti.j.constructor.call(this,e,r),Cc(e))ui.test(e)&&e.indexOf("import:")===-1?(this.b=e,r||(this.g=Vh(this.b)?B:this.b)):this.c=e;else if(Ea(e))this.vd(sc(e));else throw new D(ti,0,"invalid style configuration")}u(ti,Wh),t("H.map.render.webgl.Style",ti),ti.prototype.load=function(){var e=this,r=this.Ib();this.b?(this.O(Xh.LOADING),new tf("text/plain",this.b).then(function(n){var o={};return vi(n,r,!1,(o[r]=!0,o))}).then(function(n){return e.vd(n)},function(n){return e.Gb(n.message)}),delete this.b):this.c&&(this.O(Xh.LOADING),vi(this.c,r).then(function(n){return e.vd(n)},function(n){return e.Gb(n.message)}),delete this.c)},ti.prototype.load=ti.prototype.load,ti.prototype.Rk=function(e,r,n){var o;for(wi(this),e=xi(this,e,this.Rk,n),n=0;n<e.length;n++){var s=e[n].eb.draw;for(o in s){var l=s[o];ai(l)&&(l.interactive=!!r)}}yi(this)},ti.prototype.setInteractive=ti.prototype.Rk,ti.prototype.setProperty=function(e,r,n){var o,s=e.split("."),l=0,h=s.length;if(wi(this),!vc(r))throw new D(this.setProperty,1,"value");if(o=zi(this.Ca,s)){if(!(o.parent instanceof Object)||o.parent instanceof Array)if(n)s.pop(),s=zi(this.Ca,s),o.parent=s.parent[s.fg]={};else throw new D(this.setProperty,0,e+" property is not primitive type");o.parent[o.fg]=r}else{for(o=this.Ca;l!==h-1;)o[s[l]]={},o=o[s[l++]];o[s[l]]=r}Ai(this)&&yi(this)},ti.prototype.setProperty=ti.prototype.setProperty,ti.prototype.kh=function(e){return wi(this),(e=zi(this.Ca,e.split(".")))?sc(e.node):void 0},ti.prototype.getProperty=ti.prototype.kh,ti.prototype.removeProperty=function(e){wi(this),(e=zi(this.Ca,e.split(".")))&&e.parent&&e.parent.hasOwnProperty(e.fg)&&(delete e.parent[e.fg],Ai(this)&&yi(this))},ti.prototype.removeProperty=ti.prototype.removeProperty,ti.prototype.xe=function(e,r,n){var o;wi(this);var s=this.Ca,l=s.layers,h=xi(this,e,this.xe,!1);for(e=h.length,o={};e--;)ii(o,l,h[e].id,!!r,!!n);for(n={},h=Object.keys(s),e=h.length;e--;){var d=h[e],y=s[d];n[d]=y===l?o:sc(y)}return r||yi(this),n},ti.prototype.extractConfig=ti.prototype.xe,ti.prototype.Oe=function(e){if(wi(this),!Ea(e))throw new D(this.Oe,0,"config");this.vd($h(this.Ca,e))},ti.prototype.mergeConfig=ti.prototype.Oe,ti.prototype.a=ba(2),ti.prototype.toString=function(){return this.getState()===Xh.READY?x.H.gl.yaml.safeDump(this.Ca,{lineWidth:120}):""},ti.prototype.o=function(){ti.j.o.call(this),delete this.c,delete this.b};function Ai(e){var r=e.Ca,n;if(Ea(r)){var o;if(o=e.f){r=r&&r.sources,o=!1;for(var s in r)if(r[s].type===e.f){o=!0;break}o=!(!r||o)}o&&(n="invalid source, the only valid type is "+e.f)}else n="invalid style configuration";return n&&e.Gb(n),!n}function yi(e){e.dispatchEvent(new ud("change",e))}function wi(e){if(e.getState()!==Xh.READY)throw new $c(e.Oe,"style is not ready yet")}function xi(e,r,n,o){var s=[],l=Bc(r)?r:[r],h,d;for(o===void 0&&(o=!0),l=l.sort().reverse();h=l.pop();){r=String(h).split(".");t:{for(var y=e.Ca,g=r.length;g--&&!fi[r[g]];);if(y&&0>g&&(y=di(y.layers,r),ai(y)))break t;y=bi}if(y===bi)throw new D(n,0,'Unresolvable layer ID "'+h+'"');if(s.push({id:r,eb:y}),o)for(d in y)!fi[d]&&ai(y[d])&&l.push(h+"."+d)}return s}function zi(e,r){var n=0,o;for(o=r.length;n!==o;){var s=r[n++],l=e;if(e=l[s],!e)break}return n===o?{node:e,parent:l,fg:s}:void 0}var ui=/^(http[s]?)?.*\.ya?ml/i;function vi(e,r,n,o){n=n===void 0?!1:n,o=o===void 0?{}:o;try{var s=x.H.gl.yaml.safeLoad(e,{json:!0})}catch(l){return Promise.reject(l)}return s&&(e=s.import,Cc(e)&&(e=[e]),n&&r&&Bi(s,r),delete s.import,Bc(e)&&e.length)?(n=e.reduce(function(l,h){var d=r?Uh(h,r):h;return o[d]||(o[d]=!0,l.push(new tf("text/plain",d).then(function(y){return vi(y,d,!0,o)}))),l},[]),Promise.all(n).then(function(l){var h={};return l.forEach(function(d){return d&&$h(h,d)}),$h(h,s),h})):Promise.resolve(s)}function Bi(e,r){function n(h){h.url&&(h.url=Uh(h.url,r))}var o=e&&e.fonts;if(o)for(var s in o)Bc(o[s])?o[s].forEach(n):n(o[s]);if(e=e&&e.textures)for(var l in e)n(e[l])}ti.normalize=Bi,ti.prototype.vd=function(e){ti.j.vd.call(this,e),Ai(this)&&(this.O(Xh.READY),yi(this))},ti.prototype.qc=function(){return ti.j.qc.call(this)},ti.prototype.getConfig=ti.prototype.qc,ti.prototype.Ib=function(){return this.g||ti.j.Ib.call(this)},ti.prototype.getBaseUrl=ti.prototype.Ib,t("H.map.Style",ti),ti.State=Xh;function O(e,r){var n;if(O.j.constructor.call(this),C(e,L,O,0),r!==B&&Bc(r,O,1)){for(n=0;n<r.length;n++)C(r[n],L,O,1,"index "+n);this.a=r}else this.a=[];this.b=e,this.c=[]}u(O,jg),t("H.geo.Polygon",O);function Ci(e){var r=O,n=L,o=e.c,s=e.a,l=e.f,h=e.b;return s=[o,s,B,o,h,B,l,h,B,l,s,B],180<=e.Ab()&&(s.splice(9,0,l,e=e.bb().lng,B),s.splice(3,0,o,e,B)),new r(new n(s))}O.fromRect=Ci;var Di={NORTH:90,SOUTH:-90};O.Direction=Di,O.prototype.pd=Di.NORTH,O.prototype.Sk=function(e){return this.pd!==e&&(this.f=z,this.c.length=0,this.pd=e),this},O.prototype.setPoleCovering=O.prototype.Sk,O.prototype.Km=function(){return this.pd},O.prototype.getPoleCovering=O.prototype.Km,O.prototype.fm=function(){return this.b},O.prototype.getExterior=O.prototype.fm,O.prototype.Pk=function(e){if(!C(e,L))throw new D(this.Pk,0,e);this.b=e,this.f=z},O.prototype.setExterior=O.prototype.Pk,O.prototype.rm=function(){return this.a},O.prototype.getInteriors=O.prototype.rm,O.prototype.xg=function(e,r,n){var o=arguments.length,s;for(s=2;s<o;s++)C(arguments[s],L,this.xg,s);var l=this.a.splice.apply(this.a,arguments);for(s=2;s<o;s++)arguments[s]=B;return this.c.splice.apply(this.c,arguments),l},O.prototype.spliceInteriors=O.prototype.xg,O.prototype.no=function(e){return this.xg(e,1)[0]},O.prototype.removeInteriorAt=O.prototype.no,O.prototype.mo=function(e){return e=this.a.indexOf(e),0>e?B:this.xg(e,1)[0]},O.prototype.removeInterior=O.prototype.mo,O.prototype.Bk=function(e){if(!C(e,L))throw new D(this.Bk,0,e);this.a.push(e)},O.prototype.pushInterior=O.prototype.Bk,O.prototype.K=function(){var e=this.f;return e||(this.f=e=Ei(this.b,this.pd)),e},O.prototype.getBoundingBox=O.prototype.K,p=O.prototype,p.tj=function(e){var r=this.a.length;if(0>e||e>=r)throw new ne(this.tj,e,[0,r-1]);return(r=this.c[e])||(this.c[e]=r=Ei(this.a[e],this.pd)),r};function Ei(e,r){var n,o,s;return(s=e.K())&&((n=e.eh(!0))&&(o=e.Ie())&&(s=s.ec(tg([e.ye(0),e.ye(o-1)],!0),!0)),s.Ab()===360&&n%2===1&&(s=s.Xc(r,0))),s}p.rb="Polygon",p.cd=function(e){var r=this.a,n=r.length,o;if(this.b.Ie()){for(e.push("("),this.b.cd(e,!0),o=0;o<n;o++)r[o].Ie()&&(e.push(","),r[o].cd(e,!0));e.push(")")}else e.push("EMPTY");return e},p.Hb="Polygon",p.bd=function(){var e,r=[],n=this.a,o=this.b.bd();for(o[0].toString()!==o[o.length-1].toString()&&o.push(o[0]),r.push(o),e=0;e<n.length;e++)o=n[e].bd(),o[0].toString()!==o[o.length-1].toString()&&o.push(o[0]),r.push(o);return r},p.Y=function(){var e=O.j.Y.call(this);return this.K().Bb()&&(e.type="Multi"+e.type),e},p.pc=function(){var e=[],r=this.a,n=r.length;for(e.push(this.b.pc());n--;)e[n+1]=r[n].pc();return this.K().Bb()?[e]:e},p.ia=function(e){var r=!1;if(C(e,O)){var n=e.a,o=this.a.length;r=n.length;var s=0;for(r=this.b.ia(e.b)&&o===r;r&&s<o;)r=r&&this.a[s].ia(n[s]),s++}return r},O.prototype.equals=O.prototype.ia;function Fi(e,r,n,o){o=o===void 0?!0:o;var s=e.a,l=Gi.bind(null,r,n);return ee(r,n,e.b.$,0,!0,3)!==de.NONE?o?!s.some(l):!0:!1}function Gi(e,r,n){return ee(e,r,n.$,0,!0,3)===de.SURFACE}function Hi(e,r){r=r.$,e=e.b.$;var n,o,s=r.length-3,l=e.length-3,h={};for(n=0;n<s;n+=3){var d=r[n],y=r[n+1],g=r[n+3],v=r[n+4];for(o=0;o<l;o+=3){var m=e[o],w=e[o+1],I=e[o+3],V=e[o+4];if(ag(new Yf(y,d),new Yf(v,g),new Yf(w,m),new Yf(V,I),h,!0))return!0}}return!1}function Ii(e,r){var n=r.b,o=r.a,s=o.length,l=n.$,h=l.length,d=e.b.$,y=d.length;if(Hi(e,n))return!0;for(n=0;n<h;n+=3)if(Fi(e,l[n],l[n+1]))return!0;for(n=0;n<y;n+=3)if(Fi(r,d[n],d[n+1]))return!0;for(n=0;n<s;n++)if(Hi(e,o[n]))return!0;return!1}function Ji(e){Ji.j.constructor.call(this,e)}u(Ji,gh),t("H.geo.MultiPolygon",Ji),Ji.prototype.b=function(e){return C(e,O)},Ji.prototype.rb="Multi"+O.prototype.rb,Ji.prototype.Hb="Multi"+O.prototype.Hb;function uh(e,r){var n=r&&(+r.extrusion||+r.extrude)||0,o=r&&+r.elevation||0,s=0;if(uh.j.constructor.call(this,!0,r),0<o&&(s+=o,this.b=o),0<n&&(s+=n,this.f=n),2047<s)throw new ne(uh,s,[0,2047]);C(e,L)?this.da(new O(e)):this.da(e)}u(uh,Kh),t("H.map.Polygon",uh);var Ki=new O(new L([0,0,0,0,0,0,0,0,0]));uh.prototype.f=0,uh.prototype.b=0,uh.prototype.a=Ki,uh.MAX_EXTRUDE_HEIGHT=2047,uh.prototype.pi=function(e){var r=+e;if(r!==e)throw new D(this.pi,0,e);if(0>r||2047<this.b+r)throw new ne(this.pi,this.b+r,[0,2047]);this.f=r,this.ra(kh.SPATIAL)},uh.prototype.setExtrusion=uh.prototype.pi,uh.prototype.gm=function(){return this.f},uh.prototype.getExtrusion=uh.prototype.gm,uh.prototype.oi=function(e){var r=+e;if(r!==e)throw new D(this.oi,0,e);if(0>r||2047<this.f+r)throw new ne(this.oi,this.f+r,[0,2047]);this.b=r,this.ra(kh.SPATIAL)},uh.prototype.setElevation=uh.prototype.oi,uh.prototype.bm=function(){return this.b},uh.prototype.getElevation=uh.prototype.bm,uh.prototype.ga=function(){return this.a},uh.prototype.getGeometry=uh.prototype.ga,uh.prototype.da=function(e){if(C(e,O))var r=!1;else C(e,Ji,this.da,0),r=!0;return this.J=r,r=this.a,this.a=e,r!==Ki&&this.ra(kh.SPATIAL),this},uh.prototype.setGeometry=uh.prototype.da,uh.prototype.K=function(){return this.ga().K()},uh.prototype.getBoundingBox=uh.prototype.K,uh.prototype.Kd=function(e){var r,n=this.ga(),o,s;if(this.J){n=n.la;var l=0;for(s=n.length;l<s;l++)(o=Li(this,n[l],e,n[l].pd))&&(r||(r=[]),r.push(o))}else o=this.ab,o===B&&(o=this.J?Di.NORTH:this.ga().pd),(o=Li(this,n,e,o))&&(r=[o]);return r},uh.prototype.getGeometriesForTile=uh.prototype.Kd;function Li(e,r,n,o){var s,l,h=0,d=!0;if(s=Mi(e,r.b,n,o,r.K())){var y=new Ph(s),g=r.a;if(l=g.length)for(y.b=y.a.length;h<l;h++)(s=Mi(e,g[h],n,o,r.tj(h)))&&(y.a=y.a.concat(s));for(l=y.a.length,h=0;h<l;h++)if(y.a[h]!==Qh){d=!1;break}d&&(y=h%2?Jh:B)}return y}function Mi(e,r,n,o,s){var l=n.Le(),h=s,d=h.Ab(),y=[[]],g=r.$,v=[],m=g.length,w,I=!1;for(w=0;w<m;w+=3){var V=g[w],q=g[w+1];I||Dd(q)!=180||(v.push(V),v.push(q),v.push(V),v.push(-q),I=!0),v.push(V),v.push(q)}if(g=v,360>d&&h.a==-180&&(h=new K(h.c,180,h.f,h.b)),360>d&&h.b==180&&(h=new K(h.c,h.a,h.f,-180)),h.Bb()){for(d=g,V=d.length,g=-1,v=0;v<V-2;v+=2)if(ig(d[v+1],d[v+3])){g=v+2;break}g===-1&&ig(d[V-1],d[1])&&(g=V),g!==-1&&(m=d[g-2],v=d[g-1],w=d[g%V],I=d[(g+1)%V],Dd(m)!==180&&Dd(w)!==180&&(q=Dd(w-m),V=Dd(I-v),V+=180<V?-360:0,I=Dd(180-I),I+=180<I?-360:0,V&&I&&(q/=Dd(V)/Dd(I),m=w+(w>m?-q:q),v=0<v?180:-180,d.splice(g,0,m,v,m,-v)))),g=d}if(y[0]=Ni(g.concat(),h.a),360>h.Ab()&&h.gd(new kg(h.c,180))&&(g=Ni(g.concat(),h.b),y.push(g)),h=n.Jf(),e=Lh(e,y,!0,h),s.Ab()===360&&r.eh(!0)%2===1){for(r=e,e=n.Le(),r[0][1].x>r[0][r[0].length-1].x&&(r[0]=r[0].reverse()),g=[],d=r[0].length-1,y=0;y<d;y++)v=r[0][y],g[y]=new J(v.x-2*h.w,v.y),g[y+d]=new J(v.x-h.w,v.y),g[y+2*d]=new J(v.x,v.y),g[y+3*d]=new J(v.x+h.w,v.y),g[y+4*d]=new J(v.x+2*h.w,v.y);r[0]=g,y=h.Ah(o,0),y.y=2*e[o===Di.NORTH?"top":"bottom"],o=y.clone(),y.x=r[0][r[0].length-1].x+1,o.x=r[0][0].x-1,r[0].push(y,o),e=r}if(o=l.left,r=l.top,y=l.right,l=l.bottom,Uf(e,o,r,y,l,!0).length){if(!n.Hf().Qg(s)){for(n=e,s=[new J(o,r),new J(y,r),new J(y,l),new J(o,l)],l=[],e=n.length;e--;)if(o=Wf(s,n[e]))for(r=Oi(o),l.push(r);o.Uh;)o=o.Uh,r=Oi(o),l.push(r);e=l}}else n=Pi(o,r,e[0]),e[1]&&(n=n!==Pi(o,r,e[1])),e=n?[Qh]:B;return e}function Pi(e,r,n){var o,s,l,h=o=n[0].x,d=s=n[0].y,y=1;for(l=n.length;y<l;y++){var g=n[y].x,v=n[y].y;g>o?o=g:g<h&&(h=g),v>s?s=v:v<d&&(d=v)}return h<=e&&e<=o&&d<=r&&r<=s&&fe({x:e,y:r},ge(n.concat(n[0])))}function Oi(e){var r=[],n=e;do{var o=Ad(100*(n.eo?n.eo:n.x))/100,s=Ad(100*(n.fo?n.fo:n.y))/100;if(!l||.01<Fd(Gd(l.x-o,2)+Gd(l.y-s,2))){var l=new J(o,s);r.push(l)}n=n.next}while(n&&n!==e);return r}uh.prototype.aa=z;function Ni(e,r){var n,o=Number.POSITIVE_INFINITY,s=-1,l=e.length;for(n=0;n<l;n+=2){var h=Dd(e[n+1]-r);h+=180<h?360-h:h,h<o&&(o=h,s=n)}return 0<n?(r=e.splice(s,e.length-s),r.concat(e)):e}uh.prototype.Y=function(){var e=uh.j.Y.call(this),r=this.ga(),n=this.J?r.la:[r],o,s=e.properties,l=e.geometry=r.Y();if(s.style=this.V().Y(),s.height=this.f+this.b,s.min_height=this.b,this.K().Bb()&&(l.type="MultiPolygon",this.J)){var h=[];n.forEach(function(d,y){o=l.coordinates[y],d.K().Bb()?h=h.concat(o):h.push(o)}),l.coordinates=h}return e},uh.prototype.forWorkerMessage=uh.prototype.Y;function Qi(e,r,n){Qi.j.constructor.call(this,Ki,n),this.tg(e),this.zi(r),n&&"precision"in n&&this.yi(n.precision)}u(Qi,uh),t("H.map.Circle",Qi),Qi.prototype.tg=function(e){(e=ng(e)).ia(this.R)||(this.R=e,Ri(this))},Qi.prototype.setCenter=Qi.prototype.tg,Qi.prototype.bb=function(){return this.R},Qi.prototype.getCenter=Qi.prototype.bb,Qi.prototype.zi=function(e){if(E(e=ae(e,0,637100079e-2*Pd/2)))throw new D(this.zi,0,e);this.wa!==e&&(this.wa=e,Ri(this))},Qi.prototype.setRadius=Qi.prototype.zi,Qi.prototype.Qm=function(){return this.wa},Qi.prototype.getRadius=Qi.prototype.Qm,Qi.prototype.D=60,Qi.prototype.yi=function(e){if(!Fc(e))throw new D(this.yi,0,e);this.D!==(e=ae(Ad(e),4,360))&&(this.D=e,Ri(this))},Qi.prototype.setPrecision=Qi.prototype.yi,Qi.prototype.Nm=function(){return this.D},Qi.prototype.getPrecision=Qi.prototype.Nm,Qi.prototype.da=function(){return this},Qi.prototype.setGeometry=Qi.prototype.da,Qi.prototype.ga=function(){return this.a===Ki&&Qi.j.da.call(this,Si(this)),this.a},Qi.prototype.getGeometry=Qi.prototype.ga;function Ri(e){e.a!==z&&Qi.j.da.call(e,Si(e))}function Si(e){var r=e.R,n=r.lat,o=e.wa,s=0,l=new L;if(Dd(n)===90)for(n=r.zg(0,o,!0).lat;360>s;s+=120)l.gi(n,s-180,B);else for(e=e.D,e=360/e;360>s;s+=e)l.qd(r.zg(s,o,!0));return r=new O(l),0>n&&r.Sk(Di.SOUTH),r}function Ti(e,r){if(!C(e,Element)){if(Ui.innerHTML=e,e=Ui.firstElementChild,!e)throw new D(Ti,0,"No element data");Ui.removeChild(e);var n=!0;Ui.innerHTML=""}this.a=kf(e).length!==0,this.f=n?e:lf(e,x.document,this.a),r&&(n="onAttach",n in r&&zc(e=r[n],"Function",Ti,1,n)&&(this.Vh=e),n="onDetach",n in r&&zc(e=r[n],"Function",Ti,1,n)&&(this.b=e))}t("H.map.DomIcon",Ti);var Ui=document.createElement("DIV");Ti.prototype.Vh=null,Ti.prototype.b=null,Ti.prototype.uj=function(e){return lf(this.f,e,this.a)},Ti.prototype.a=!1;function Vi(e){Vi.j.constructor.call(this,e)}u(Vi,gh),t("H.geo.MultiPoint",Vi),Vi.prototype.b=function(e){return lg(e)},Vi.prototype.c=function(e){return C(e,kg)?e:ng(e)},Vi.prototype.rb="Multi"+kg.prototype.rb,Vi.prototype.Hb="Multi"+kg.prototype.Hb;function Wi(e,r){this.w=+e,this.h=+r}t("H.math.Size",Wi);function Xi(e,r){var n,o=e,s=r||[];if(e!==Yi.NONE){if(r=n=s.length,Zi.indexOf(o)===-1)throw new D(Xi,0,e);if(!s)throw new D(Xi,1,s);for(;n--;)if(E(s[n]))throw new D(Xi,1,s);if(o===Yi.RECT&&3<r&&(s=[s[0],s[1],s[2],s[1],s[2],s[3],s[0],s[3]],o=Yi.POLYGON),o===Yi.CIRCLE&&2<r&&(e=s[2],0<e)){o=s[0];var l=s[1];n=yd(2*Cd(e),40);var h=360/n;for(s=[];n--;){var d=h*n*Ud;s.push(o+Id(d)*e,l+Kd(d)*e)}o=Yi.POLYGON}if(o!==Yi.POLYGON||!r||s.length%2)throw new D(Xi,1,s);this.a=s}}t("H.map.HitArea",Xi);var Yi={NONE:0,RECT:1,CIRCLE:2,POLYGON:3};Xi.ShapeType=Yi;var Zi=[Yi.RECT,Yi.CIRCLE,Yi.POLYGON];Xi.prototype.Of=function(e,r,n){return this.a?ee(e,r,this.a,n,!0):de.NONE},Xi.prototype.hitTest=Xi.prototype.Of;function rh(e,r){var n;xc(this,rh),rh.j.constructor.call(this,r),this.da(e),r&&"icon"in r&&(n=r.icon),this.Ic(n||$i(this))}u(rh,M),t("H.map.AbstractMarker",rh),rh.prototype.ga=function(){return this.a},rh.prototype.getGeometry=rh.prototype.ga,rh.prototype.da=function(e){var r=this.a;return C(e,kg)||C(e,Vi)?this.a=e:(lg(e,this.da,0),this.a=ng(e)),r&&this.ra(kh.SPATIAL),this},rh.prototype.setGeometry=rh.prototype.da,rh.prototype.K=function(){return this.a.K()},rh.prototype.xb=function(){return this.icon},rh.prototype.getIcon=rh.prototype.xb,rh.prototype.Ic=function(e){var r=this.icon,n=!r;if(r!==e){if(!this.Uj(e))throw n?new D(this.constructor,1,e):new D(this.Ic,0,e);this.icon=e,n||this.ra(kh.VISUAL)}return this},rh.prototype.setIcon=rh.prototype.Ic;function $i(e){var r=e.c;return r||(r=e.constructor.prototype.c=e.b(aj)),r}var aj={svg:'<svg xmlns="http://www.w3.org/2000/svg" width="38" height="47" viewBox="0 0 38 47"><g fill="none"><path fill="#0F1621" fill-opacity=".4" d="M15 46c0 .317 1.79.574 4 .574s4-.257 4-.574c0-.317-1.79-.574-4-.574s-4 .257-4 .574z"></path><path fill="#01b6b2" d="M33.25 31.652A19.015 19.015 0 0 0 38 19.06C38 8.549 29.478 0 19 0S0 8.55 0 19.059c0 4.823 1.795 9.233 4.75 12.593L18.975 46 33.25 31.652z"></path><path fill="#6A6D74" fill-opacity=".5" d="M26.862 37.5l4.714-4.77c3.822-3.576 5.924-8.411 5.924-13.62C37.5 8.847 29.2.5 19 .5S.5 8.848.5 19.11c0 5.209 2.102 10.044 5.919 13.614l4.719 4.776h15.724zM19 0c10.493 0 19 8.525 19 19.041 0 5.507-2.348 10.454-6.079 13.932L19 46 6.079 32.973C2.348 29.495 0 24.548 0 19.04 0 8.525 8.507 0 19 0z"></path></g></svg>',size:new Wi(38,47),anchor:new J(19,45),hitArea:new Xi(Yi.POLYGON,[19,46,2,27,0,18,5,6,19,0,32,5,38,15,36,27,19,47])};rh.prototype.Y=function(){var e=rh.j.Y.call(this),r=this.xb(),n=r.yb(),o=r.kd();return e.geometry=this.ga().Y(),n&&(r=e.properties.icon={id:r.uid},r.size={w:n.w,h:n.h},r.offset=[n.w/2-(o?o.x:0),n.h/2-(o?o.y:0)]),e},rh.prototype.forWorkerMessage=rh.prototype.Y;function bj(e,r){bj.j.constructor.call(this,e,r)}u(bj,rh),t("H.map.DomMarker",bj),bj.prototype.type=nh.DOM_MARKER,bj.prototype.T=2,bj.prototype.b=function(e){var r=new Ti(e.svg,e);return e=e.anchor,r.f.style.margin=-e.y+"px 0 0 -"+e.x+"px",r},bj.prototype.Uj=function(e){return C(e,Ti)};function cj(e,r,n){cj.j.constructor.call(this,e),this.oldValue=n,this.newValue=r}u(cj,ud),t("H.util.ChangeEvent",cj);function dj(e,r,n,o){dj.j.constructor.call(this,e,r,n),this.modifiers=o}u(dj,cj),t("H.map.ChangeEvent",dj);var ej={SIZE:1,POSITION:2,HEADING:4,TILT:8,INCLINE:16,ZOOM:32,BOUNDS:64};dj.Type=ej,dj.prototype.ll=ej.SIZE,dj.prototype.SIZE=dj.prototype.ll,dj.prototype.Ui=ej.POSITION,dj.prototype.POSITION=dj.prototype.Ui,dj.prototype.Oi=ej.HEADING,dj.prototype.HEADING=dj.prototype.Oi,dj.prototype.Wi=ej.TILT,dj.prototype.TILT=dj.prototype.Wi,dj.prototype.Pi=ej.INCLINE,dj.prototype.INCLINE=dj.prototype.Pi,dj.prototype.Xi=ej.ZOOM,dj.prototype.ZOOM=dj.prototype.Xi,dj.prototype.Mi=ej.BOUNDS,dj.prototype.BOUNDS=dj.prototype.Mi;function fj(){this.a=[],fj.j.constructor.call(this)}u(fj,F),t("H.util.OList",fj);function gj(e,r,n){if(e=e.a.length,n)var o=e;else if(E(o=0>(o=+r)?zd(0,e+o):yd(e,o)))throw new ne(fj,r,[0,e-1]);return o}fj.prototype.add=function(e,r){r=gj(this,r,E(r)),this.a.splice(r,0,e),this.dispatchEvent(new hj(this,this.A.he,r,e,null,null))},fj.prototype.add=fj.prototype.add;function ij(e,r){var n=e.a.splice(r,1)[0];return e.dispatchEvent(new hj(e,e.A.je,r,null,n,null)),n}fj.prototype.hc=function(e){return this.get(e),ij(this,e)},fj.prototype.removeAt=fj.prototype.hc,fj.prototype.remove=function(e){return e=this.indexOf(e),0<=e?(ij(this,e),!0):!1},fj.prototype.remove=fj.prototype.remove,fj.prototype.set=function(e,r){if(this.a.length!==0||e!==0){this.get(e),e=gj(this,e,!1);var n=this.a[e]}return this.a[e]=r,this.dispatchEvent(new hj(this,this.A.ke,e,r,n,null)),n},fj.prototype.set=fj.prototype.set,fj.prototype.indexOf=function(e){return this.a.indexOf(e)},fj.prototype.indexOf=fj.prototype.indexOf,fj.prototype.get=function(e){var r=gj(this,e,!1),n=this.a;if(r>=n.length)throw new ne(this.get,e,[0,n.length-1]);return n[r]},fj.prototype.get=fj.prototype.get,fj.prototype.ym=function(){return this.a.length},fj.prototype.getLength=fj.prototype.ym,fj.prototype.La=function(){return this.a.concat()},fj.prototype.asArray=fj.prototype.La,fj.prototype.flush=function(){for(var e=this.a.length;e--;)ij(this,e)},fj.prototype.flush=fj.prototype.flush,fj.prototype.o=function(){this.flush(),fj.j.o.call(this)},fj.prototype.A={he:"add",je:"remove",ke:"set",Xo:"move"};function hj(e,r,n,o,s,l){hj.j.constructor.call(this,r,e),this.idx=n,this.added=o,this.removed=s,this.moved=l}u(hj,ud),fj.Event=hj;function jj(){}function kj(e){return yd(1,zd(0,.5-Ed(Ld(Rd+Qd*e/180))/Pd/2))}jj.prototype.Tf=function(e,r,n){return n?(n.x=r/360+.5,n.y=kj(e)):n=new J(r/360+.5,kj(e)),n},jj.prototype.latLngToPoint=jj.prototype.Tf,jj.prototype.Pc=function(e,r){return this.Tf(e.lat,e.lng,r)},jj.prototype.geoToPoint=jj.prototype.Pc;function lj(e){return 0>=e?90:1<=e?-90:Vd*(2*Md(Hd(Pd*(1-2*e)))-Qd)}jj.prototype.Ra=function(e,r,n){return n?(n.lat=lj(r),n.lng=360*(e===1?1:Zd(e,1))-180):n=new kg(lj(r),360*(e===1?1:Zd(e,1))-180),n},jj.prototype.xyToGeo=jj.prototype.Ra,jj.prototype.dg=function(e,r){return this.Ra(e.x,e.y,r)},jj.prototype.pointToGeo=jj.prototype.dg;var mj=new jj;t("H.geo.mercator",mj),t("H.util.constants.DEFAULT_MIN_ZOOM_LEVEL",0),t("H.util.constants.DEFAULT_MAX_ZOOM_LEVEL",22);function nj(e,r){this.projection=e||mj,this.b=0,this.a=this.exp=Ed(r||256)/Od,oj(this),this.y=this.x=0}t("H.geo.PixelProjection",nj);var pj=Dd(24)+Dd(-8);nj.prototype.eg=mj,nj.prototype.projection=nj.prototype.eg,nj.prototype.x=0,nj.prototype.x=nj.prototype.x,nj.prototype.y=0,nj.prototype.y=nj.prototype.y,nj.prototype.Oo=Gd(2,pj),nj.prototype.w=nj.prototype.Oo,nj.prototype.ln=Gd(2,pj),nj.prototype.h=nj.prototype.ln,nj.prototype.Oa=function(e){if(E(e))throw new D(this.Oa,0,e);var r=this.x/this.w,n=this.y/this.h;this.b=e,this.a=this.exp+e,oj(this),this.x=r*this.w,this.y=n*this.h},nj.prototype.rescale=nj.prototype.Oa;function oj(e){e.a>pj&&(e.a=pj),e.w=Gd(2,e.a),e.h=Gd(2,e.a)}nj.prototype.Jj=function(){return this.b||0},nj.prototype.getZoomScale=nj.prototype.Jj,nj.prototype.ib=function(e,r){return e=this.projection.Tf(e.lat,e.lng,r),e.x=e.x*this.w-this.x,e.y=e.y*this.h-this.y,e},nj.prototype.geoToPixel=nj.prototype.ib,nj.prototype.Re=function(e,r){return this.projection.Ra((e.x+this.x)/this.w,(e.y+this.y)/this.h,r)},nj.prototype.pixelToGeo=nj.prototype.Re,nj.prototype.Ra=function(e,r,n){return this.projection.Ra((e+this.x)/this.w,(r+this.y)/this.h,n)},nj.prototype.xyToGeo=nj.prototype.Ra,nj.prototype.Ah=function(e,r,n){return e=this.projection.Tf(e,r,n),e.x=e.x*this.w-this.x,e.y=e.y*this.h-this.y,e},nj.prototype.latLngToPixel=nj.prototype.Ah,nj.prototype.Zd=function(e){return new J(e.x*this.w-this.x,e.y*this.h-this.y)},nj.prototype.pointToPixel=nj.prototype.Zd;function qj(e){e=e||{},qj.j.constructor.call(this),this.min=0,this.max=22,this.yl=this.dark=!!e.dark,e.min&&this.ui(e.min),e.max&&this.si(e.max),this.pixelProjection=new nj(e.projection,e.minWorldSize),e.provider&&(this.ma=e.provider,this.Va=A(this.Va,this),this.ma.addEventListener(P.prototype.A.za,this.Va,!1,this),this.hb=A(this.hb,this),this.ma.addEventListener(P.prototype.A.ie,this.hb,!1,this))}u(qj,F),t("H.map.layer.Layer",qj),qj.prototype.min=0,qj.prototype.min=qj.prototype.min,qj.prototype.max=22,qj.prototype.max=qj.prototype.max,qj.prototype.A={za:"update",ie:"configchange",Ti:"minchange",Si:"maxchange"},qj.prototype.ca=function(){return this.ma},qj.prototype.getProvider=qj.prototype.ca,qj.prototype.un=function(e){return this.min<=e&&e<=this.max},qj.prototype.isValid=qj.prototype.un;function rj(e,r,n){var o=e[r],s=r==="min",l=s?e.ui:e.si;if(n!==o)if(s?n<=e.max:n>=e.min)e[r]=n,e.Va(),e.hb(),e.dispatchEvent(new cj(s?e.A.Ti:e.A.Si,n,o));else throw new D(l,0,"Invalid condition min <= max");return e}qj.prototype.ui=function(e){return rj(this,"min",+e)},qj.prototype.setMin=qj.prototype.ui,qj.prototype.si=function(e){return rj(this,"max",+e)},qj.prototype.setMax=qj.prototype.si,qj.prototype.Va=function(){this.dispatchEvent(this.A.za)},qj.prototype.hb=function(e){e=new cj(this.A.ie,e&&e.newValue,e&&e.oldValue),this.dispatchEvent(e)},qj.prototype.o=function(){qj.j.o.call(this)},qj.prototype.ba=function(){return null},qj.prototype.getCopyrights=qj.prototype.ba;function sj(e){var r;if(sj.j.constructor.call(this),this.dispatchEvent=A(this.dispatchEvent,this),e){var n=e.length;for(r=0;r<n;r++)this.add(e[r])}}u(sj,fj),t("H.map.DataModel",sj);function tj(e,r){var n=r.getProvider&&r.getProvider();n&&(uj[n.uid]=n),r.ka(e)}function vj(e){var r=e.getProvider&&e.getProvider();r&&delete uj[r.uid],e.ka(null)}sj.prototype.add=function(e,r){C(e,qj,this.add,0),tj(this,e),sj.j.add.call(this,e,r)},sj.prototype.add=sj.prototype.add,sj.prototype.set=function(e,r){return C(r,qj,this.set,0),tj(this,r),(e=sj.j.set.call(this,e,r))&&vj(e),e},sj.prototype.set=sj.prototype.set,sj.prototype.hc=function(e){var r;return(r=sj.j.hc.call(this,e))&&vj(r),r},sj.prototype.removeAt=sj.prototype.hc,sj.prototype.remove=function(e){var r;return(r=sj.j.remove.call(this,e))&&vj(e),r},sj.prototype.remove=sj.prototype.remove,sj.prototype.flush=function(){for(var e=this.a.length;e--;)this.hc(e);sj.j.flush.call(this)},sj.prototype.flush=sj.prototype.flush;var uj={};Ic(uj);function wj(e,r,n){if(e=uj[e])return C(e[r],Function,wj,1,"invalid method"),e[r].apply(e,n)}sj.invoke=wj;function xj(e,r){Da(e)&&(this.i=e),Fc(r)&&(this.a=r)}t("H.util.Request",xj),xj.State={PENDING:0,PROCESSING:1,COMPLETE:2,CANCELLED:3,ERROR:4};var yj=[0,1,2,3,4];xj.prototype.C=0,xj.prototype.getState=function(){return this.C},xj.prototype.getState=xj.prototype.getState,xj.prototype.O=function(e){if(0>yj.indexOf(e))throw new D(this.O,0,e);(this.C!==e||e===1&&1<this.a)&&(this.C=e,this.i&&this.i(this))},xj.prototype.a=1,xj.prototype.cn=function(){return this.a},xj.prototype.getTotal=xj.prototype.cn,xj.prototype.b=0,xj.prototype.Om=function(){return this.b},xj.prototype.getProcessed=xj.prototype.Om,xj.prototype.g=0,xj.prototype.hm=function(){return this.g},xj.prototype.getFailed=xj.prototype.hm;function zj(e,r){e.b<e.a&&(vc(r)||(r=2),r===0||r===1||e.C!==0&&e.C!==1||(e.b++,r!==2&&e.g++,e.O(e.b<e.a?1:2)))}xj.prototype.oe=function(){},xj.prototype.cancel=function(){this.C!==3&&(this.oe(),this.O(3))},xj.prototype.cancel=xj.prototype.cancel;function Aj(){}t("H.util.ICapturable",Aj),Aj.prototype.capture=function(){},Aj.prototype.capture=Aj.prototype.capture,t("H.util.Disposable",qd),qd.prototype.tb=qd.prototype.tb,qd.prototype.addOnDisposeCallback=qd.prototype.tb,t("H.util.dispose",td),qd.prototype.F=qd.prototype.F,qd.prototype.dispose=qd.prototype.F,qd.prototype.o=qd.prototype.o,qd.prototype.disposeInternal=qd.prototype.o;function Bj(e,r){var n=e.N(),o=n.ownerDocument;Bj.j.constructor.call(this),this.a=e,this.S=n=n.appendChild(Cj(o,"DIV","position:absolute;bottom:0;right:0;left:0px;z-index:1;direction:ltr;pointer-events:none;height:40px-webkit-touch-callout: none;-webkit-user-select:none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select:none;",null,"H_imprint")),this.qf=Cj(o,"DIV","margin: 0 0 16px 16px;display:inline-block;",'<svg height="40" viewBox="0 0 47 40" width="47" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m45.2054149 8.82876345.6003191.40637037-.2240425.6914074-.4490426 1.38570368c-.1024468.3148889-.6998936 1.9596297-2.43 3.5918519l-.017234.0163704c-.188617.1887407-.3801064.3659259-.5467021.5084444l-.4605319.4285185-.486383.4516296-.1407447-.0702963c-.7257447.4583704-1.4926596.7886667-2.2796809.9831852l.5840426.5864445-.6769149.6817778-2.052766 2.0636296-.169468.1704444-.019149.0192593-2.3821276 2.3958518c-.4902128.8493334-1.1202128 1.6331852-1.8497873 2.3111112-.6031915.6047407-1.2504255 1.1054814-1.935 1.4954814l-.4777659.4805186-4.3247873 4.3506666-.0296808.0298519-.0315958.0269629-2.1532978 1.8171111-.2661702.2253334h-.3485107-3.8948936l-3.968617 3.9914815-1.3547873 1.3616296-.6769148.6808148-.6769149-.6808148-1.3538298-1.3616296-4.80925535-4.837926-3.2687234-3.2875555-1.63436171-1.6437778h2.3112766 4.62255319 2.67223407l-4.71063832-4.7368148-.6769149-.6808148.6769149-.6808148 4.93851062-4.9650371.6769149-.6798518.6769149.6808148 2.7296809 2.7454074c.9363829-.8820741 2.1485106-1.4685185 3.4037234-1.6562963.278617-1.4694815 1.0187234-2.834963 2.168617-3.9885926.5696808-.572 1.1843617-1.0438519 1.8335106-1.4107407l.2901064-.2917778 4.3094681-4.31985187c.5830851-1.0582963 1.4256383-1.78918519 2.0364893-2.12718519l.4471277-.24748148c.3829787-.7617037.9047872-1.47622222 1.5539362-2.12622222 1.510851-1.51666667 3.3165957-2.31881482 5.22-2.31881482.0871276 0 .1752127.00192593.2594681.00577778 1.9484042.06933334 3.8441489.97933334 5.4775532 2.62792593.1512765.15022222.3303191.34859259.5361702.5797037l.0526595.05874074c.1120213.12518519.2345745.26192593.370532.40733334l1.2657446 1.36066666.6328724.67985185-.6548936.65866667-.2508511.25325926zm-27.9288192 22.17414815h-9.57446804l4.78723404 4.8148148zm23.1864894-21.70422223c-.9220213 1.38666663-2.5180851 3.63037033-4.1984042 1.94133333l4.2510638-4.27651851c-.3810638-.41022222-.6711702-.754-.8923404-.97740741-2.2921277-2.31207407-4.8743617-2.34192593-6.8984043-.312-1.3528723 1.35681481-1.7071277 2.91007407-1.313617 4.38533332l-1.332766-1.52629628c-.385851.21474074-2.0182979 1.65918518-.7937234 3.84703708l-1.5252127-1.274963-2.0240426 2.0299259 2.7344681 2.7502222c-2.1121277-1.6861481-4.3889362-1.5205185-6.2157447.312-1.9560638 1.9615556-1.8181915 4.3381482-.3532979 6.293926l-.295851-.2946667c-1.9321277-1.9432593-4.0318085-1.2576296-5.0706383-.2128148-.8023405.8079259-1.2944681 1.9191852-1.0924468 2.6905185l-4.195532-4.2187407-2.22893613 2.2408148 8.25893613 8.3065185h4.4339362l-2.9767021-2.9938519c-.5893908-.6029568-.9604155-1.0987731-1.1531529-1.5232627-.3182349-.7008886-.1504161-1.2073234.3230465-1.680515.7334043-.7318519 1.583617-.2763704 3.0829787 1.2277777l2.9412766 2.9562963 2.2164894-2.2292592-2.7909575-2.8060741c2.0125532 1.5291852 4.4224468 1.612 6.5728724-.545037 1.3567021-1.2653334 1.7425532-2.4565185 1.7425532-2.4565185l-1.6755319-1.1314815c-.9229788 1.3866666-2.5152128 3.6361481-4.195532 1.9461481l4.2606383-4.2851852 2.655 2.6712593 2.3160639-2.3294074-3.3223405-3.3424445c-1.5520212-1.5609629-.6328723-3.0275555.0124469-3.5793333.3025531.6442222.7448936 1.2624445 1.3078723 1.8296296 2.1485106 2.1676297 4.9260638 2.6038519 7.3685106.1550371 1.3567022-1.2643704 1.7425532-2.4565185 1.7425532-2.4565185zm-3.6564894-1.35537321-2.0211702 2.03377777c-.9890425-1.18251851-.9392553-1.81422222-.3245744-2.43051851.7439361-.7462963 1.4993617-.43044445 2.3457446.39674074zm-12.4879787 12.56088884c-.9890425-1.1825185-.9411702-1.819037-.3284042-2.4353333.7448936-.7462963 1.5003191-.4304444 2.3467021.3967408z" fill="#0f1621" fill-opacity=".7"/><path d="m17.2765957 31.0029116-4.787234 4.8148148-4.78723404-4.8148148zm23.1864894-21.70422223 1.6755319 1.13148153s-.385851 1.1921481-1.7425532 2.4565185c-2.4424468 2.4488148-5.22 2.0125926-7.3685106-.1550371-.5629787-.5671851-1.0053192-1.1854074-1.3078723-1.8296296-.6453192.5517778-1.5644681 2.0183704-.0124469 3.5793333l3.3223405 3.3424445-2.3160639 2.3294074-2.655-2.6712593-4.2606383 4.2851852c1.6803192 1.69 3.2725532-.5594815 4.195532-1.9461481l1.6755319 1.1314815s-.3858511 1.1911851-1.7425532 2.4565185c-2.1504256 2.157037-4.5603192 2.0742222-6.5728724.545037l2.7909575 2.8060741-2.2164894 2.2292592-2.9412766-2.9562963c-1.4993617-1.5041481-2.3495744-1.9596296-3.0829787-1.2277777-.4734626.4731916-.6412814.9796264-.3230465 1.680515.1927374.4244896.5637621.9203059 1.1531529 1.5232627l2.9767021 2.9938519h-4.4339362l-8.25893613-8.3065185 2.22893613-2.2408148 4.195532 4.2187407c-.2020213-.7713333.2901063-1.8825926 1.0924468-2.6905185 1.0388298-1.0448148 3.1385106-1.7304445 5.0706383.2128148l.295851.2946667c-1.4648936-1.9557778-1.6027659-4.3323704.3532979-6.293926 1.8268085-1.8325185 4.103617-1.9981481 6.2157447-.312l-2.7344681-2.7502222 2.0240426-2.0299259 1.5252127 1.274963c-1.2245745-2.1878519.4078724-3.63229634.7937234-3.84703708l1.332766 1.52629628c-.3935107-1.47525925-.0392553-3.02851851 1.313617-4.38533332 2.0240426-2.02992593 4.6062766-2.00007407 6.8984043.312.2211702.22340741.5112766.56718519.8923404.97740741l-4.2510638 4.27651851c1.6803191 1.689037 3.2763829-.5546667 4.1984042-1.94133333zm-16.1444681 11.20551563 2.0182979-2.0385925c-.846383-.8271852-1.6018085-1.1430371-2.3467021-.3967408-.612766.6162963-.6606383 1.2528148.3284042 2.4353333zm12.4879787-12.56088884c-.8463829-.82718519-1.6018085-1.14303704-2.3457446-.39674074-.6146809.61629629-.6644681 1.248.3245744 2.43051851z" fill="#fff" fill-opacity=".3"/></g></svg>',"H_logo"),n.appendChild(this.qf),n=n.appendChild(Cj(o,"DIV","right:0;bottom:0;position:absolute;background-color:rgba(255,255,255,.8);color:#0F1621;padding:2px 16px",null,"H_copyright")),this.i=n.appendChild(Cj(o,"A","color:inherit; margin:0px 8px; text-decoration:none; pointer-events:all;","Terms of use")),this.i.target="_blank",this.g=n.appendChild(Cj(o,"SPAN","margin:0px 8px")),this.c=n.appendChild(Cj(o,"SPAN")),this.s=Wa(Dj),this.vi(r),this.f=A(this.f,this),this.b=A(this.b,this),this.a.addEventListener(this.a.A.Ri,this.f),this.a.a.addEventListener("add",this.b),this.a.a.addEventListener("remove",this.b),this.a.a.addEventListener("set",this.b),this.b()}var Ej;u(Bj,qd),t("H.map.Imprint",Bj);var Dj={font:'11px "Lucida Grande", Arial, Helvetica, sans-serif',href:"https://legal.here.com/{LN}/terms/serviceterms/{CN}",invert:!1,reportHref:"https://wego.here.com/",locale:"en-US",mark:""};Bj.prototype.vi=function(e){var r,n=this.qf.firstElementChild.firstElementChild.children;e||(this.s=Wa(Dj));var o=this.s;for(r in o)e&&r in e&&(o[r]=e[r]);e=(this.wh=e=o.invert)?Fj:Gj,n[0].style.fill=e.Wk,n[0].style.fillOpacity=""+e.Xk,n[1].style.fill=e.al,n[1].style.fillOpacity=""+e.bl,e=o.locale,Hj[e]||(e="en-US",o.locale=e),this.i.innerHTML=Hj[e],e=e.split("-"),this.i.href=o.href.replace("{LN}",e[0]).replace("{CN}",e[1].toLowerCase()),o.mark?(this.c.innerHTML=o.mark,this.c.style.margin="0px 8px"):(this.c.innerHTML="",this.c.style.margin="0px"),this.S.style.font=o.font},Bj.prototype.setOptions=Bj.prototype.vi;function Cj(e,r,n,o,s){return e=e.createElement(r),n&&(e.style.cssText=n),o&&(e.innerHTML=o),s&&(e.className=s),e}Bj.prototype.N=function(){return this.S},Bj.prototype.f=function(){this.g.innerHTML=this.l+" "+this.ba()},Bj.prototype.b=function(){this.f(),setTimeout(this.f,5e3)};var Gj={al:"#0F1621",bl:.3,Wk:"#fff",Xk:.6},Fj={al:"#fff",bl:1,Wk:"#0F1621",Xk:.7},Ij="1987&ndash;"+zd(2015,new Date().getFullYear())+" HERE";Bj.prototype.ba=function(){var e=this.a,r=e.pb(),n=e.c.jb().bounds;e=e.a;var o=e.a.length,s={},l=0,h,d,y,g=[Ij];if(n){for(;l<o;l++)if(d=e.get(l).getCopyrights(n.K(),r))for(h=0;h<d.length;h++)s[y=d[h].label]||(g.push(y),s[y]=1)}return g.join(", ")},Bj.prototype.getCopyrights=Bj.prototype.ba,Bj.prototype.V=function(){return this.S.style},Bj.prototype.l=String.fromCharCode(169),Bj.prototype.o=function(){if(this.a.removeEventListener(this.a.A.Ri,this.f),this.a.a.removeEventListener("add",this.b),this.a.a.removeEventListener("remove",this.b),this.a.a.removeEventListener("set",this.b),this.S.parentNode){var e=this.S;e.parentNode.removeChild(e)}},Bj.prototype.disposeInternal=Bj.prototype.o,Bj.prototype.capture=function(e,r,n,o){var s=e.getContext("2d"),l=window.getComputedStyle(this.g.parentElement),h=2*Dc(l.paddingLeft,10),d=(this.g.offsetWidth+2*h)*r,y=this.g.offsetHeight*r,g=this.c.innerHTML.length!==0?this.c.offsetWidth*r:0,v=Ec(l.getPropertyValue("font-size")),m=this.S.ownerDocument,w=+e.width,I=+e.height,V=16*r,q=this.qf.childNodes[0].getBoundingClientRect(),De=q.width*r,_n=q.height*r,ha=ld;Da(o)&&(ha=function(){o("capture_error")}),s.fillStyle=l.backgroundColor,s.fillRect(w-d-g,I-y,d+g,y),d=this.c.innerHTML,d=this.l+" "+function(ga){return ga=Cj(m,"div",null,ga),ga.textContent||ga.innerText||""}(this.ba())+(d?" "+d:""),s.font=v*r+"px "+l.getPropertyValue("font-family"),s.fillStyle=l.getPropertyValue("color"),s.textBaseline="bottom",s.textAlign="right",s.fillText(d,w-h*r,I),Jj(this,s.font,function(ga){new tf("image",ga).then(function(_o){s.drawImage(_o,V,I-(_n+V),De,_n),n(e)},ha)},ha)},Bj.prototype.capture=Bj.prototype.capture;function Jj(e,r,n,o){Kj(A(function(s){s?this.wh?n("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAeCAYAAABe3VzdAAADNklEQVRYR82XW6hVVRSGv7+rmJfSMKSnSkMEfY7EogcJC7tilGRopBAiSaI+SBARQSCIIqgFISih2YW0oAgLCsKXojA0RB+81VugZEFZv/yHuWTt7d7Hfc4+6+h4OWefNfcc3xlj/v+YS1zjoab5bE8DZgGngB8keSg5GwO0PQ54F3i2BnQIWCLpx14hGwG0fT3wOfBwB5DzwOOSDvQC2RTgM8Ae4D/gaeA3YDdwN5AWvyxp+6gD2r4OmAq8AbwInAMmA/OAT4CbgBWStvYClzUjWkHbrwHLgF8LVHJ8DDxah7P9JHCil7M40oA/A7OBC8ANtSqlrQOVs30/8CWQat8r6cxg1RwRQNvPA88Bk4D7gJzBV4A5teSp5MlS4VuA/ZIeu1Kr+wa0/QTwIRDlRhT5eTswBvi2CKOd42AULilndNAYCcA7gK+BmbVMiyXtsh3Qt4FFBTgW8w6wXtLfV4LrSyS2FwAvAWOBX+JtwF0laUDmS/oun23fDNwJnJb0Ty9g1ZphVdB2qrK2LdFfBbb685/AIxXkUKDqa4cMaDs2kjalRe8Fola57J3qRQSJviGHA3gMuAdYI2lDUfDOArQLWAd8VTuTOW9vjUoFy6TIGYpS9wKfAjuK5wVuSfn91iKcvZJeHy5ci0hsZwzNk5Qh3xIFbLyks7aPAtPLgv+L4VZwDwLvA6uKz6XdfcVAi22PBz4q4+lVSRurXW2vKYKIZfwEHCmmXC35HngAyITYD0ys2t8XWflyBfhmvKm24QCk7aVFCPVc7WMszzKucknI+NoHPCUppt13VICZm2nNwjoksByY0SXL72Vi3FieZ97mgrpyqF432H9xScW2O0H+W6oSE/4D2FYuA9kzlUzVTwO3Ad9IOtx3ydo2aLGZLpABm5KW2Z4AfAbMLfsEcpGkKLqRuMwHu0CukrSpCCrvGlF6hBEVL5MUw24kOhp1B8gc+FTqgxpkFLuzSbjk6jpJOkC2tDPeKCkVbDRkO67fDTTC2VK7vgfyBUlfNEpV2zyAK4HNXRLmZfshScdHC6g9T+WDGU2XpkdZdNXhWs6g7dXAhmsJ7jKR2M77bG4kV7Wt9TZfBLgYEC7PSpcIAAAAAElFTkSuQmCC"):n("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAeCAYAAABe3VzdAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAIMSURBVFiFzdZPiE1RGADwXzPTTPIMQoodVpbKgpoUG5qExUi8DSVJQv4slJJsbNjYWFhNETWLUUosRDRLUVLCYhIiojFojHkW997uvefNGIuZc99Xp/fOO6/Or++c75xDi0d7hDlWYQNqeB9hvv+OGq6jUWjPsKZKVBbtuKOMy9p3bKqOlsROCWYc27AWr9PfJnCgKlgbluNqivmGDmzBrxR3sCocnMEw7sqXdEAzboeK9uLTFPVbed8VcesxglFJtqNEHbcxlIL68ChADuCSpEgauBULt11SDI3C5yJJdrLCCNsQumMBl+J5AKinY4slBfNTfsRcxJwYsK0YxD3J0r1RPut6Cv/twgp0xoDBBc3LNhr0RwJktNifAn7gsnLmsuxVinyVTn4i7dcLoH4sU96Tp2Pi2uSVehN75Gdev+QO7pIXztmZnLwTvf+AzU+/v5Rn50+A24gP2IW5M4mbJ7+ejgVjJ/EpHXuCa8p77nGK68FX5eWfsTgfTJoh92qu1vAaa+CtPJuDZuEh3CHZUyHyxSSYrL3DWKE/gStm8aybDDkmKYperJM/BrJMnsJuHMLq2YJNh/wsX7JuPAyQfTFg0yGPFMZreCCv4n2xgTQjxyXP+CxquK8iXBYhMlzOtliQBVg4RVuCG/iSto/YHAuWxWFTHyXDWBkbNFkc1cK4LI5rYVwW57QY7i/pZeJv8QQJRQAAAABJRU5ErkJggg=="):(s=this.qf.cloneNode(!0),s.firstChild.setAttribute("style","font:"+r),n(bf(s.innerHTML)))},e),o)}Bj.prototype.wh=!1;function Kj(e,r){var n="data:image/svg+xml;charset=utf-8,"+encodeURIComponent('<svg height="40" viewBox="0 0 47 40" width="47" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m45.2054149 8.82876345.6003191.40637037-.2240425.6914074-.4490426 1.38570368c-.1024468.3148889-.6998936 1.9596297-2.43 3.5918519l-.017234.0163704c-.188617.1887407-.3801064.3659259-.5467021.5084444l-.4605319.4285185-.486383.4516296-.1407447-.0702963c-.7257447.4583704-1.4926596.7886667-2.2796809.9831852l.5840426.5864445-.6769149.6817778-2.052766 2.0636296-.169468.1704444-.019149.0192593-2.3821276 2.3958518c-.4902128.8493334-1.1202128 1.6331852-1.8497873 2.3111112-.6031915.6047407-1.2504255 1.1054814-1.935 1.4954814l-.4777659.4805186-4.3247873 4.3506666-.0296808.0298519-.0315958.0269629-2.1532978 1.8171111-.2661702.2253334h-.3485107-3.8948936l-3.968617 3.9914815-1.3547873 1.3616296-.6769148.6808148-.6769149-.6808148-1.3538298-1.3616296-4.80925535-4.837926-3.2687234-3.2875555-1.63436171-1.6437778h2.3112766 4.62255319 2.67223407l-4.71063832-4.7368148-.6769149-.6808148.6769149-.6808148 4.93851062-4.9650371.6769149-.6798518.6769149.6808148 2.7296809 2.7454074c.9363829-.8820741 2.1485106-1.4685185 3.4037234-1.6562963.278617-1.4694815 1.0187234-2.834963 2.168617-3.9885926.5696808-.572 1.1843617-1.0438519 1.8335106-1.4107407l.2901064-.2917778 4.3094681-4.31985187c.5830851-1.0582963 1.4256383-1.78918519 2.0364893-2.12718519l.4471277-.24748148c.3829787-.7617037.9047872-1.47622222 1.5539362-2.12622222 1.510851-1.51666667 3.3165957-2.31881482 5.22-2.31881482.0871276 0 .1752127.00192593.2594681.00577778 1.9484042.06933334 3.8441489.97933334 5.4775532 2.62792593.1512765.15022222.3303191.34859259.5361702.5797037l.0526595.05874074c.1120213.12518519.2345745.26192593.370532.40733334l1.2657446 1.36066666.6328724.67985185-.6548936.65866667-.2508511.25325926zm-27.9288192 22.17414815h-9.57446804l4.78723404 4.8148148zm23.1864894-21.70422223c-.9220213 1.38666663-2.5180851 3.63037033-4.1984042 1.94133333l4.2510638-4.27651851c-.3810638-.41022222-.6711702-.754-.8923404-.97740741-2.2921277-2.31207407-4.8743617-2.34192593-6.8984043-.312-1.3528723 1.35681481-1.7071277 2.91007407-1.313617 4.38533332l-1.332766-1.52629628c-.385851.21474074-2.0182979 1.65918518-.7937234 3.84703708l-1.5252127-1.274963-2.0240426 2.0299259 2.7344681 2.7502222c-2.1121277-1.6861481-4.3889362-1.5205185-6.2157447.312-1.9560638 1.9615556-1.8181915 4.3381482-.3532979 6.293926l-.295851-.2946667c-1.9321277-1.9432593-4.0318085-1.2576296-5.0706383-.2128148-.8023405.8079259-1.2944681 1.9191852-1.0924468 2.6905185l-4.195532-4.2187407-2.22893613 2.2408148 8.25893613 8.3065185h4.4339362l-2.9767021-2.9938519c-.5893908-.6029568-.9604155-1.0987731-1.1531529-1.5232627-.3182349-.7008886-.1504161-1.2073234.3230465-1.680515.7334043-.7318519 1.583617-.2763704 3.0829787 1.2277777l2.9412766 2.9562963 2.2164894-2.2292592-2.7909575-2.8060741c2.0125532 1.5291852 4.4224468 1.612 6.5728724-.545037 1.3567021-1.2653334 1.7425532-2.4565185 1.7425532-2.4565185l-1.6755319-1.1314815c-.9229788 1.3866666-2.5152128 3.6361481-4.195532 1.9461481l4.2606383-4.2851852 2.655 2.6712593 2.3160639-2.3294074-3.3223405-3.3424445c-1.5520212-1.5609629-.6328723-3.0275555.0124469-3.5793333.3025531.6442222.7448936 1.2624445 1.3078723 1.8296296 2.1485106 2.1676297 4.9260638 2.6038519 7.3685106.1550371 1.3567022-1.2643704 1.7425532-2.4565185 1.7425532-2.4565185zm-3.6564894-1.35537321-2.0211702 2.03377777c-.9890425-1.18251851-.9392553-1.81422222-.3245744-2.43051851.7439361-.7462963 1.4993617-.43044445 2.3457446.39674074zm-12.4879787 12.56088884c-.9890425-1.1825185-.9411702-1.819037-.3284042-2.4353333.7448936-.7462963 1.5003191-.4304444 2.3467021.3967408z" fill="#0f1621" fill-opacity=".7"/><path d="m17.2765957 31.0029116-4.787234 4.8148148-4.78723404-4.8148148zm23.1864894-21.70422223 1.6755319 1.13148153s-.385851 1.1921481-1.7425532 2.4565185c-2.4424468 2.4488148-5.22 2.0125926-7.3685106-.1550371-.5629787-.5671851-1.0053192-1.1854074-1.3078723-1.8296296-.6453192.5517778-1.5644681 2.0183704-.0124469 3.5793333l3.3223405 3.3424445-2.3160639 2.3294074-2.655-2.6712593-4.2606383 4.2851852c1.6803192 1.69 3.2725532-.5594815 4.195532-1.9461481l1.6755319 1.1314815s-.3858511 1.1911851-1.7425532 2.4565185c-2.1504256 2.157037-4.5603192 2.0742222-6.5728724.545037l2.7909575 2.8060741-2.2164894 2.2292592-2.9412766-2.9562963c-1.4993617-1.5041481-2.3495744-1.9596296-3.0829787-1.2277777-.4734626.4731916-.6412814.9796264-.3230465 1.680515.1927374.4244896.5637621.9203059 1.1531529 1.5232627l2.9767021 2.9938519h-4.4339362l-8.25893613-8.3065185 2.22893613-2.2408148 4.195532 4.2187407c-.2020213-.7713333.2901063-1.8825926 1.0924468-2.6905185 1.0388298-1.0448148 3.1385106-1.7304445 5.0706383.2128148l.295851.2946667c-1.4648936-1.9557778-1.6027659-4.3323704.3532979-6.293926 1.8268085-1.8325185 4.103617-1.9981481 6.2157447-.312l-2.7344681-2.7502222 2.0240426-2.0299259 1.5252127 1.274963c-1.2245745-2.1878519.4078724-3.63229634.7937234-3.84703708l1.332766 1.52629628c-.3935107-1.47525925-.0392553-3.02851851 1.313617-4.38533332 2.0240426-2.02992593 4.6062766-2.00007407 6.8984043.312.2211702.22340741.5112766.56718519.8923404.97740741l-4.2510638 4.27651851c1.6803191 1.689037 3.2763829-.5546667 4.1984042-1.94133333zm-16.1444681 11.20551563 2.0182979-2.0385925c-.846383-.8271852-1.6018085-1.1430371-2.3467021-.3967408-.612766.6162963-.6606383 1.2528148.3284042 2.4353333zm12.4879787-12.56088884c-.8463829-.82718519-1.6018085-1.14303704-2.3457446-.39674074-.6146809.61629629-.6644681 1.248.3245744 2.43051851z" fill="#fff" fill-opacity=".3"/></g></svg>'),o=Ej;vc(o)?e(o):new tf("image",n).then(function(s){Ye.drawImage(s,0,0);try{Ye.getImageData(0,0,1,1),o=!1}catch(l){o=l.code===18}finally{Ej=o,e(o)}},r)}Bj.prototype.nl=function(e,r){Hj[e]=r},Bj.prototype.addL11NString=Bj.prototype.nl;var Hj={"de-DE":"Nutzungsbedingungen","en-US":"Terms of use","en-GB":"Terms of use","es-ES":"Condiciones de uso","fi-FI":"Palveluehdot","fr-FR":"Conditions d'utilisation","it-IT":"Condizioni di utilizzo","nl-NL":"Dienstvoorwaarden","pl-PL":"Warunki świadczenia usługi","pt-BR":"Termos de serviço","pt-PT":"Termos do serviço","ru-RU":"Условия использования","tr-TR":"Servis Koşulları","zh-CN":"使用条款"};function R(e){var r={};this.f=r.previousSibling=r.nextSibling=r,this.g=new cf,R.j.constructor.call(this,e),e&&"objects"in e&&this.Xb(e.objects)}u(R,M),t("H.map.Group",R),R.prototype.type=nh.GROUP,R.prototype.ee=function(e,r){return this.b=!0,e=R.j.ee.call(this,e,r),this.b=!1,e&&this.forEach(Lj,!0),e},R.prototype.setProvider=R.prototype.ee;function Lj(e,r,n){e.ee(n.ma)}R.prototype.contains=function(e){var r=this===e;if(!r&&this.a&&C(e,M))for(;!r&&e;)e===this?r=!0:e=e.Fa;return r},R.prototype.contains=R.prototype.contains,R.prototype.Ye=function(){this.L=B,this.forEach(Mj,!0)},R.prototype.resetZInfo=R.prototype.Ye;function Mj(e){e.Ye()}R.prototype.b=!1,R.prototype.ra=function(e){var r=R.j.ra.call(this,e);return r&&!this.b&&(this.c=e,this.forEach(Nj,!0),delete this.c),r},R.prototype.invalidate=R.prototype.ra;function Nj(e,r,n){e.ra(n.c)}R.prototype.forEach=function(e,r,n){var o;if(this.a){var s=this.f,l=s.nextSibling;for(o=0;l!==s;){var h=l.nextSibling;e.call(n,l,o++,this),r&&C(l,R)&&l.forEach(e,r,n),l=h}}},R.prototype.forEach=R.prototype.forEach,R.prototype.Ua=function(e){var r=[];return this.forEach(Oj,e,r),r},R.prototype.getObjects=R.prototype.Ua,R.prototype.K=function(){var e=null;return this.a&&this.forEach(function(r){r.K&&(r=r.K())&&(e?e=e.ec(r):e=r)}),e},R.prototype.getBoundingBox=R.prototype.K;function Oj(e){this.push(e)}R.prototype.a=0,R.prototype.Rl=function(){return this.a},R.prototype.getChildCount=R.prototype.Rl,R.prototype.fa=function(e){var r=this.f,n=r.previousSibling;if(C(e,M,this.fa,0),e.contains(this))throw new $c(this.fa,"The new object contains the parent group");var o=e.Lf(!0),s=e.Fa;if(s!==this){if(s){s=e.previousSibling;var l=e.nextSibling;s.nextSibling=l,l.previousSibling=s}e.Fa=this,M.j.ka.call(e,this),n.nextSibling=e,e.previousSibling=n,e.nextSibling=r,r.previousSibling=e,this.a++}return e.Di=this.g.next(),e.Ye(),r=e.ee(this.ma,this.fa),e.Lf(!0)!==o&&e.ra(kh.VOLATILITY),r||e.ra(kh.Z_ORDER),e},R.prototype.addObject=R.prototype.fa,R.prototype.Xb=function(e){var r;Bc(e,this.Xb,0);var n=e.length;for(r=0;r<n;r++)this.fa(e[r])},R.prototype.addObjects=R.prototype.Xb,R.prototype.Ga=function(e){if(!e||e.Fa!==this)throw new $c(this.Ga,"object not found");var r=e.previousSibling,n=e.nextSibling;return r.nextSibling=n,n.previousSibling=r,e.Fa=null,M.j.ka.call(e,null),delete e.previousSibling,delete e.nextSibling,C(e.ma,N)&&e.ee(null,this.Ga),this.a--,e},R.prototype.removeObject=R.prototype.Ga,R.prototype.rd=function(e){var r;Bc(e,this.rd,0);var n=e.length;for(r=0;r<n;r++)this.Ga(e[r])},R.prototype.removeObjects=R.prototype.rd,R.prototype.na=function(){var e=this.Ua();this.rd(e)},R.prototype.removeAll=R.prototype.na,R.prototype.Kc=function(e){for(var r=this.Ua(),n=0,o=r.length,s=[],l,h,d;n<o;n++)d=r[n],d instanceof R?(l=e?e(d.getData()):d.getData(),h=qh(this,l,!!e),l={type:"Feature"},l.properties=h,d.i&&(l.id=d.i),l.geometry={},l.geometry.type="GeometryCollection",l.geometry.geometries=Pj(this,d.Ua()),s.push(l)):s.push(d.Kc(e));return{type:"FeatureCollection",features:s}},R.prototype.toGeoJSON=R.prototype.Kc;function Pj(e,r){for(var n=0,o=r.length,s,l,h=[];n<o;n++)s=r[n],s instanceof R?l={type:"GeometryCollection",geometries:Pj(e,s.Ua())}:s instanceof rh||s instanceof sh||s instanceof th||s instanceof uh?l=s.ga().Kc():l={type:"FeatureCollection",features:hf},h.push(l);return h}R.prototype.Y=function(){var e=R.j.Y.call(this);return e.type="Group",e},R.prototype.forWorkerMessage=R.prototype.Y;var Qj={PROVIDES_BY_VIEWPORT:1,PROVIDES_RASTERS:2,PROVIDES_SPATIALS:4,PROVIDES_OVERLAYS:8,PROVIDES_MARKERS:16,PROVIDES_DOM_MARKERS:32,PROVIDES_GEOJSON:64,PROVIDES_OMV:128,CROP_LINES_BY_TILE:256,CROP_POLYGONS_BY_TILE:512,HAS_VOLATILE_DATA:1024};t("H.map.provider.Capabilities",Qj),Qj.PROVIDES_WEBGL_RENDERABLE_OBJECTS=Qj.PROVIDES_SPATIALS|Qj.PROVIDES_OVERLAYS|Qj.PROVIDES_MARKERS;function Rj(e,r,n,o,s){switch(r&&(this.f=r),vc(n)&&(this.c=!!n),this.c&&o&&(this.Lg=new Wi(o.w,o.h)),vc(s)&&(this.g={crossOrigin:s}),Sj[Ac(e)]){case 2:this.a=e,Tj(this,1);break;case 1:if(nf(e)){this.a=e,Uj(this),Tj(this,1);break}e=e.src;case 0:if(e){e=bf(e),this.b=new tf("image",e,B,this.g),this.b.then(A(this.$n,this),A(this.Zn,this));break}default:throw Tj(this,-1),new D(Rj,0,"No image data")}}Rj.prototype.C=0,Rj.prototype.getState=function(){return this.C};function Tj(e,r){e.C=r,delete e.b,e.f&&e.f(r,e)}Rj.prototype.c=!0;function Uj(e){if(e.c){var r=e.a,n=Vj(e),o=n&&n.w||+r.width,s=n&&n.h||+r.height,l=Ue();if(C(r,x.HTMLCanvasElement))n=r;else{n=r.ownerDocument.createElement("canvas"),n.width=Cd(o*l),n.height=Cd(s*l);var h=n.getContext("2d");h.scale(l,l),h.drawImage(r,0,0,o,s),cd&&(h.clearRect(0,0,o,s),h.drawImage(r,0,0,o,s))}e.a=n}}Rj.prototype.getData=function(){return this.a||z};var Sj={String:0,HTMLImageElement:1,HTMLCanvasElement:2};p=Rj.prototype,p.Lg=z,p.yb=function(){return this.C===1?Vj(this):z};function Vj(e){var r=e.Lg,n;if(!r){var o=e.a;if(r=o.naturalWidth||o.width,r===0&&$e&&Sj[Ac(o)]===1){var s=!0;if(n=o.parentNode)var l=o.nextSibling;document.body.appendChild(o)}e.Lg=r=new Wi(o.naturalWidth||o.width,o.naturalHeight||o.height),s&&(n?n.insertBefore(o,l):document.body.removeChild(o))}return r}p.$n=function(e){this.a=e,Uj(this),Tj(this,1)},p.Zn=function(){Tj(this,-1)},p.cancel=function(){this.b&&this.b.cancel()};function Wj(e,r){var n,o="anonymous";if(this.uid=Xj.next(),Wj.j.constructor.call(this),r){var s="size";if(s in r){var l=r[s];if(!l||isNaN(l.w)||isNaN(l.h))throw new D(Wj,1,s);this.g=new Wi(l.w,l.h)}if(s="anchor",s in r){if(l=r[s],!l||isNaN(l.x)||isNaN(l.y))throw new D(Wj,1,s);this.f=new J(l.x,l.y)}s="hitArea",s in r&&(l=r[s],C(l,Xi,Wj,1),this.c=r[s]),s="asCanvas",s in r&&(n=r[s]),s="crossOrigin",s in r&&(o=r[s]),l=r.stickHeight,l===+l&&0<l&&(this.Fo=l),s="stickColor",l=r[s],s in r&&Cc(l)&&(this.Eo=l)}e=new Rj(e,A(this.i,this),n,this.g,o),r=this.C=e.getState(),r!==0?this.i(r,e):this.b=e}u(Wj,F),t("H.map.Icon",Wj);var Xj=new cf;Wj.State={ERROR:-1,LOADING:0,READY:1},Wj.prototype.getState=function(){return this.C},Wj.prototype.getState=Wj.prototype.getState,Wj.prototype.i=function(e,r){if(this.a=r.getData(),e===1){var n=this.g;n||(n=this.g=r.yb()),this.f||(this.f=new J(n.w/2|0,n.h))}this.b&&(this.C=e,delete this.b,this.dispatchEvent("statechange"))},Wj.prototype.a=z,Wj.prototype.Qc=function(){return this.a},Wj.prototype.getBitmap=Wj.prototype.Qc,Wj.prototype.yb=function(){return this.g||z},Wj.prototype.getSize=Wj.prototype.yb,Wj.prototype.f=z,Wj.prototype.kd=function(){return this.f},Wj.prototype.getAnchor=Wj.prototype.kd,Wj.prototype.c=z,Wj.prototype.nm=function(){return this.c},Wj.prototype.getHitArea=Wj.prototype.nm,Wj.prototype.o=function(){Wj.j.o.call(this),this.a?(this.a.removeAttribute("src"),delete this.a):(this.b.cancel(),delete this.b)};function Yj(e,r,n,o,s,l){Yj.j.constructor.call(this,isNaN(e)?15:e,r,n,o,s,l)}u(Yj,wg),Yj.prototype.s=function(e){for(var r,n,o=this.head,s=e;s;){if(e=s.entries){if(r=e.length){if(2>r&&(n=s.parent)&&n.a===1){n.removeChild(s),o===s&&(o=n),n.entries=e,s=e[0].node=n;continue}}else if(delete s.entries,(n=s.parent)&&(n.removeChild(s),o===s&&(o=n),n.a===1)){s=n.a?n[0]||n[1]||n[2]||n[3]:null;continue}}break}this.head!==o&&(this.head=o,Bg(this))},Yj.prototype.yc=function(e,r){if(Gg(this.a,e,r,e,r))return Zj(this,this.a,e,r,this.c);throw Error("Coordinates out of bounds")};function Zj(e,r,n,o,s){var l=r.entries;if(s)if(r.a)l=ak(e,r,n,o,s);else if(l){l=l[0];var h=Eg(r,+(l[1]>=r[8])|+(l[0]>=r[9])<<1);h.entries=r.entries,delete r.entries,l.node=h,Bg(e,h),l=ak(e,r,n,o,s)}else Fg(r,l=new bk(n,o)),Bg(e,r),zg(e,l,!0);else l||Bg(e,r),Fg(r,l=new bk(n,o)),zg(e,l,!0);return l}function ak(e,r,n,o,s){return Zj(e,Eg(r,+(n>=r[8])|+(o>=r[9])<<1),n,o,s-1)}function bk(e,r){this.id=Dg++,this[0]=r,this[1]=e}bk.prototype.a=function(e){return this[e%2]};function ck(){this.a=new Yj(10,180,90,0,0,!0)}p=ck.prototype,p.Dh=0,p.Rc=function(){return this.Dh},p.Uf=null,p.K=function(){var e=this.Uf,r;return!e&&(r=xg(this.a))&&(this.Uf=e=new K(-r[0],r[3],-r[2],r[1])),e},p.yc=function(e){return++this.Dh,this.Uf=null,this.a.yc(e.lng,-e.lat)},p.remove=function(e){return(e=this.a.remove(e))&&(--this.Dh,this.Uf=null),e},p.Pf=function(e,r,n){var o=this.a,s=e.Nb(),l=e.Jb(),h=-s.lat;s=s.lng;var d=-l.lat;l=l.lng;var y;return e.Bb()?y=o.Za(-180,h,l,d,n,r).concat(o.Za(s,h,180,d,n,r)):y=o.Za(s,h,l,d,n,r),y};function dk(e){this.a=e}function ek(e,r,n){this.c=e,this.a=r,this.g=n,this.f=this.c&Qj.PROVIDES_BY_VIEWPORT?"function(){return sources[$source].isInMinMaxRange(feature, $zoom) && feature.ref.effectiveVisibility;}":B,this.b={}}function fk(e,r,n,o){this.a=e,this.b=r,this.c=n,this.kf=o}function gk(e,r,n,o){return e={type:r,uid:e.b,tiled:n,max_zoom:e.c},o&&Ya(e,o),e}function hk(e,r,n,o,s){this.a=e,this.b=r,this.c=n,this.f=o,this.kf=s}function ik(e){if(e.a&Qj.PROVIDES_DOM_MARKERS&&!(e.a&Qj.PROVIDES_MARKERS))return{};var r=new fk(e.a,e.b,e.c,e.kf),n=new dk(e.a);e=new ek(e.a,e.b,e.f);var o={},s=r.b;if(r=r.a&Qj.PROVIDES_BY_VIEWPORT?gk(r,"ObjectSource",!1,{progressiveUpdate:!0,has_volatile_data:!!(r.a&Qj.HAS_VOLATILE_DATA)}):r.a&Qj.PROVIDES_RASTERS?gk(r,"RemoteRasterTileSource",!0,{url:""}):gk(r,"ObjectTileSource",!0,{tile_size:r.kf}),o[s]=r,r={},n.a&Qj.PROVIDES_RASTERS&&(r={"translucent-raster":qi("raster","inlay",1)}),n.a&Qj.PROVIDES_WEBGL_RENDERABLE_OBJECTS){s=!!(n.a&Qj.CROP_LINES_BY_TILE);var l={"translucent-polygons":qi("polygons","inlay",2),"translucent-extruded-polygons":qi("polygons","translucent",3),"translucent-pattern-lines":qi("pattern-lines","translucent",4),"translucent-overlays":qi("overlays","inlay",5),markers:qi("custom_icons","overlay",6,!1)};l["translucent-polygons"].crop_by_tile=!!(n.a&Qj.CROP_POLYGONS_BY_TILE),l["translucent-pattern-lines"].crop_by_tile=s,l.markers.suppress_fade=!0,l.markers.stick=!0,Ya(r,l)}if(e.c&Qj.PROVIDES_RASTERS&&(e.b["tile_layer_"+e.a]=si(e.a,"_default",{"translucent-raster":{color:[1,1,1,e.g],order:0}})),e.c&Qj.PROVIDES_SPATIALS){n={"translucent-pattern-lines":{color:pi("strokeColor"),width:pi("lineWidth * $meters_per_pixel"),join:pi("lineJoin"),cap:pi("lineCap"),tail_cap:pi("lineTailCap"),head_cap:pi("lineHeadCap"),miter_limit:pi("miterLimit"),order:"function() { return 2 + feature.effectiveZIdx / 2; }",interactive:!0,dash:pi("lineDash"),extrude:!0,dash_phase:pi("lineDashOffset")}},s=e.b,l="polygon_layer_"+e.a;var h=si(e.a,"polygons",void 0,e.f);h.flat={filter:"function(){return !feature.height && !feature.min_height;}",draw:ri(!1)},h.extruded={filter:"function(){return feature.height || feature.min_height;}",draw:ri(!0)},s[l]=h,e.b["outline_layer_"+e.a]=si(e.a,"outlines",n,e.f),e.b["polyline_layer_"+e.a]=si(e.a,"polylines",n,e.f)}return e.c&Qj.PROVIDES_OVERLAYS&&(e.b["overlay_layer_"+e.a]=si(e.a,"overlays",{"translucent-overlays":{color:[1,1,1,e.g],order:8190,interactive:!0}})),e.c&Qj.PROVIDES_MARKERS&&(e.b["marker_layer_"+e.a]=si(e.a,"markers",{markers:{sprite:oi("icon.id"),offset:oi("icon.offset"),collide:!1,priority:8191,elevate_by_altitude:!0,interactive:!0,stick:{color:oi("icon.stick_color"),height:oi("icon.stick_height")}}},e.f)),{sources:o,styles:r,layers:e.b}}function P(e){var r=""+ef(),n;if(P.j.constructor.call(this),e=e||{},this.min=e.min||0,this.max=e.max||22,n=e.uri){if(/_/.test(n))throw new D(P,0,"uri "+n)}else n=r;if(this.uri=n||r,this.uid=r,e.getCopyrights&&zc(e.getCopyrights,"Function",P)&&(this.getCopyrights=e.getCopyrights),this.hb=this.hb.bind(this),this.ta=!0,this.b=e.engineType||jk,this.b===kk.HARP&&!H.map.render.harp)throw new D(P,0,"HARP engine is not supported, module not found")}u(P,F),t("H.map.provider.Provider",P),p=P.prototype,p.A={ie:"configchange",za:"update"},p.Va=function(e,r){this.dispatchEvent(new vd(this.A.za,r,e))},p.hb=function(e){e=new cj(this.A.ie,e&&e.newValue,e&&e.oldValue),this.dispatchEvent(e)},p.o=function(){F.prototype.o.call(this),this.a&&(this.a.removeEventListener("change",this.hb),this.a.F(),delete this.a)},p.ba=function(){return null},P.prototype.getCopyrights=P.prototype.ba,P.prototype.getCapabilities=function(){var e=0;return this.di()&&(e|=Qj.PROVIDES_BY_VIEWPORT),this.providesRasters()&&(e|=Qj.PROVIDES_RASTERS),this.providesSpatials()&&(e|=Qj.PROVIDES_SPATIALS),this.providesOverlays()&&(e|=Qj.PROVIDES_OVERLAYS),this.providesMarkers()&&(e|=Qj.PROVIDES_MARKERS),this.providesDomMarkers()&&(e|=Qj.PROVIDES_DOM_MARKERS),this.providesGeoJSON()&&(e|=Qj.PROVIDES_GEOJSON),this.providesOMV()&&(e|=Qj.PROVIDES_OMV),e},P.prototype.getCapabilities=P.prototype.getCapabilities,P.prototype.di=gf,P.prototype.Ve=gf,P.prototype.providesRasters=P.prototype.Ve,P.prototype.Cc=gf,P.prototype.providesSpatials=P.prototype.Cc,P.prototype.fi=gf,P.prototype.providesOverlays=P.prototype.fi,P.prototype.Rb=gf,P.prototype.providesMarkers=P.prototype.Rb,P.prototype.Qb=gf,P.prototype.providesDomMarkers=P.prototype.Qb,P.prototype.ei=gf,P.prototype.providesGeoJSON=P.prototype.ei,P.prototype.Sb=gf,P.prototype.providesOMV=P.prototype.Sb,P.prototype.dm=function(){return this.b},P.prototype.getEngineType=P.prototype.dm,P.prototype.wo=function(e){this.b=e},P.prototype.setEngineType=P.prototype.wo,P.prototype.Ue=ld,P.prototype.preprocessData=P.prototype.Ue,P.prototype.g=1;function lk(e,r){r=ae(r,0,1),E(r)&&(r=1),e.g!==r&&(e.g=r,e.ta&&mk(e),e.hb(),e.Va())}P.prototype.Em=function(){return this.g},P.prototype.getOpacityInternal=P.prototype.Em,P.prototype.Qa=function(e,r){var n=this;if(this.b===kk.WEBGL&&!C(e,ti)||this.b===kk.HARP&&!C(e,H.map.render.harp.Style))throw e=Object.entries(kk).find(function(o){return o[1]===n.b}),new D(this.Qa,0,"Invalid style for engineType "+e);this.a&&(this.a.removeEventListener("change",this.hb),this.a.removeEventListener(Yh,this.hb),this.a.F()),this.a=e,this.a.addEventListener("change",this.hb),this.a.addEventListener(Yh,this.hb),r||this.hb(),this.ta=!1},P.prototype.setStyleInternal=P.prototype.Qa,P.prototype.Ya=function(){return this.a||mk(this),this.a},P.prototype.getStyleInternal=P.prototype.Ya;function mk(e){if(e.b===kk.WEBGL){var r=new hk(e.getCapabilities(),e.uid,e.max,e.g,e.tileSize);e.a=new ti(ik(r))}else e.b===kk.HARP&&H.map.render.harp&&(e.a=new H.map.render.harp.Style({}));e.ta=!0}P.prototype.Ej=function(){var e=this.getCapabilities(),r=nk.FEATURE;return e&Qj.PROVIDES_BY_VIEWPORT?r=nk.SOURCE:e&Qj.PROVIDES_RASTERS?r=null:e&Qj.PROVIDES_WEBGL_RENDERABLE_OBJECTS&&(r=nk.PROVIDER),r},P.prototype.getPickingMode=P.prototype.Ej,P.prototype.im=function(){return!1},P.prototype.getFeatureProxy=P.prototype.im;function ok(e){var r;xc(this,ok),ok.j.constructor.call(this,e),this.wa=e=[];for(r in nh)e[nh[r]]=new jh}u(ok,P),t("H.map.provider.ObjectProvider",ok),ok.prototype.di=ff,ok.prototype.providesByViewport=ok.prototype.di,ok.prototype.Kb=function(e){return this.wa[e||nh.ANY]},ok.prototype.getInvalidations=ok.prototype.Kb,ok.prototype.Td=function(e,r){if(r!==kh.NONE){var n=this.wa[nh.ANY],o=n.a+1;n.update(o,r),n=this.wa[e.type],n.update(o,r),e.Kb().update(o,r),this.Va(e)}},ok.prototype.invalidateObject=ok.prototype.Td,ok.prototype.requestOverlays=ok.prototype.sd,ok.prototype.requestSpatials=ok.prototype.kg,ok.prototype.requestSpatialsByTile=ok.prototype.mg,ok.prototype.qa=!1,ok.prototype.requestMarkers=ok.prototype.Ec,ok.prototype.requestDomMarkers=ok.prototype.Dc;function N(e){e=e||{},N.j.constructor.call(this,e),this.f=e=new R({min:e.min,max:e.max}),e.ma=this,e.ka(this),e.ra(kh.ADD),this.J=new Lg,this.i=new Lg,this.m=new ck,this.u=new Lg,this.P=new ck,this.T=new Lg}u(N,ok),t("H.map.provider.LocalObjectProvider",N),N.prototype.getCapabilities=function(){return Qj.PROVIDES_BY_VIEWPORT|Qj.PROVIDES_WEBGL_RENDERABLE_OBJECTS|Qj.PROVIDES_DOM_MARKERS|Qj.CROP_LINES_BY_TILE},N.prototype.Ya=function(){if(!this.l&&(this.l=N.j.Ya.call(this),this.l instanceof ti)){var e=new hk(this.getCapabilities()|Qj.HAS_VOLATILE_DATA,this.uid+"_vol",this.max,this.g,this.tileSize);this.l.Oe(ik(e))}return this.l},N.prototype.getStyleInternal=N.prototype.Ya,N.prototype.Qa=function(e,r){N.j.Qa.call(this,e,r),this.l=null},N.prototype.setStyleInternal=N.prototype.Qa,N.prototype.bc=function(){return this.f},N.prototype.getRootGroup=N.prototype.bc,N.prototype.Td=function(e,r){r&kh.SPATIAL&&this.fa(e),N.j.Td.call(this,e,r)},N.prototype.invalidateObject=N.prototype.Td,N.prototype.fa=function(e){var r;if(C(e,M,this.fa,0),e.ma!==this)throw new $c(this.fa,"foreign object");this.Ga(e);var n=e.type;if(n===nh.MARKER)if((r=e.ga())instanceof kg){var o=!0;n=this.m}else n=this.u;else n===nh.DOM_MARKER?(r=e.ga())instanceof kg?(o=!0,n=this.P):n=this.T:n=n===nh.OVERLAY?this.J:this.i;o=o?n.yc(r):n.Pj(e.K()),o.c=e,e.qa=o},N.prototype.Ga=function(e){var r;if(e){if(e.ma!==this){if(C(e,M))throw new $c(this.Ga,"foreign object")}else if(r=e.qa){var n=e.type;n===nh.MARKER?this.m.remove(r)||this.u.remove(r):n===nh.DOM_MARKER?this.P.remove(r)||this.T.remove(r):n===nh.OVERLAY?this.J.remove(r):this.i.remove(r),delete r.c,delete e.qa}}},N.prototype.removeObject=N.prototype.Ga;function pk(e,r,n,o,s,l,h){if(h=h||[],r.Rc())for(e=r!==e.m&&r!==e.u,s=!s,r=r.Pf(n,l,l),n=r.length,l=0;l<n;l++){var d=r[l].c,y;if(y=o!==void 0){for(var g=Bd(o),v=d;(y=v.m<=g&&v.s>=g)&&(v=v.Fa););y=!y}y||!s&&!d.wc(!0)||(e||d.xb().getState()===1)&&h.push(d)}return h}N.prototype.fi=function(){return 0<this.J.Rc()},N.prototype.providesOverlays=N.prototype.fi,N.prototype.sd=function(e,r,n){return pk(this,this.J,e,r,n,!1).filter(function(o){return o.Qc()})},N.prototype.requestOverlays=N.prototype.sd,N.prototype.Cc=function(){return 0<this.i.Rc()},N.prototype.providesSpatials=N.prototype.Cc,N.prototype.kg=function(e,r,n){return pk(this,this.i,e,r,n,!1)},N.prototype.requestSpatials=N.prototype.kg,N.prototype.mg=function(e,r){return pk(this,this.i,e.Hf(),e.zL,r,!1)},N.prototype.requestSpatialsByTile=N.prototype.mg,N.prototype.Rb=function(){return 0<this.m.Rc()+this.u.Rc()},N.prototype.providesMarkers=N.prototype.Rb,N.prototype.Ec=function(e,r,n){return qk(this,e,r,n,!1)},N.prototype.requestMarkers=N.prototype.Ec;function qk(e,r,n,o,s){var l=pk(e,e.m,r,n,o,s);return pk(e,e.u,r,n,o,s,l),l}N.prototype.Qb=function(){return 0<this.P.Rc()+this.T.Rc()},N.prototype.providesDomMarkers=N.prototype.Qb,N.prototype.Dc=function(e,r,n){return rk(this,e,r,n,!1)},N.prototype.requestDomMarkers=N.prototype.Dc;function rk(e,r,n,o,s){var l=pk(e,e.P,r,n,o,s);return pk(e,e.T,r,n,o,s,l),l}function sk(e,r,n){var o=n.ga(),s,l=tk.bind(null,e);e=uk.bind(null,e),C(n,th)?s=C(o,L)?l(o):o.la.some(l):C(n,uh)?s=C(o,O)?e(o):o.la.some(e):C(n,sh)&&(s=e(Ci(o))),s&&r.push(n)}function tk(e,r){t:{var n=r.$,o=Hi(e,r);if(!o){r=r.$.length;for(var s=0;s<r;s+=3)if(Fi(e,n[s],n[s+1])){e=!0;break t}}e=o}return e}function uk(e,r){return Ii(e,r)}function vk(e,r,n){for(var o=e.length;o--;){var s=e[o],l=s.ga();if(C(l,Vi)){l=l.la;for(var h=l.length,d;h--;)if(d=l[h],Fi(r,d.lat,d.lng)){n.push(s);break}}else Fi(r,l.lat,l.lng)&&n.push(s)}}N.prototype.Ua=function(e,r,n,o,s){var l=this,h=e.K(),d=[],y=Zb(),g=1;if(h)for(;g&nh.ANY;){if(g&o)switch(g){case nh.MARKER:y=y.then(function(){return qk(l,h,n,r,!0)}).then(function(v){return vk(v,e,d)});break;case nh.DOM_MARKER:y=y.then(function(){return rk(l,h,n,r,!0)}).then(function(v){return vk(v,e,d)});break;case nh.SPATIAL:y=y.then(function(){return pk(l,l.i,h,n,r,!0)}).then(function(v){v.forEach(sk.bind(null,e,d))});break;case nh.OVERLAY:y=y.then(function(){return pk(l,l.J,h,n,r,!0)}).then(function(v){v.forEach(sk.bind(null,e,d))})}g<<=1}y.then(function(){return s(d)})},N.prototype.ld=function(e,r,n){n=n||jf;var o=n.zoom,s=n.visiblesOnly;n=n.types;var l=nh.ANY;C(e,O,this.ld,0,"area"),zc(r,"Function",this.ld,1,"callback"),zc(o,"Number",this.ld,2,"options"),this.Ua(e,vc(s)?!!s:!0,o,vc(n)?n&l:l,r)},N.prototype.getObjectsWithin=N.prototype.ld,N.prototype.o=function(){N.j.o.call(this),this.f.na()};var wk={PENDING:0,ACTIVE:1,DONE:2};t("H.map.render.RenderState",wk);function xk(e,r){r=r||{};var n;if(!C(e,Element))throw new D(xk,0,e);var o=e.ownerDocument.createElement("div");this.S=e,xk.j.constructor.call(this),this.padding=new yk(0,0,0,0),this.center=new J(0,0),this.margin=0,this.element=o,o.style.zIndex=0,o.style.height=o.style.width="100%",o.style.direction="ltr",o.style.position=e.style.position==="relative"?"absolute":"relative",this.resize(),e.appendChild(o),(n=r.padding)!==B&&this.wi(n.top,n.right,n.bottom,n.left),this.ri((n=r.margin)!==B?n:0)}u(xk,F),t("H.map.ViewPort",xk),xk.prototype.A={za:"update",le:"sync"},xk.prototype.ri=function(e){if(this.margin!==+e){if(E(this.margin=+e))throw new D(this.ri,0,e);zk(this),this.dispatchEvent(this.A.za)}},xk.prototype.setMargin=xk.prototype.ri,xk.prototype.wi=function(e,r,n,o){var s=this.padding;if(s.top!==e||s.right!==r||s.bottom!==n||s.left!==o){if(E(e+r+n+o))throw new D(this.wi);s.top=e,s.right=r,s.bottom=n,s.left=o,zk(this),this.dispatchEvent(this.A.za)}},xk.prototype.setPadding=xk.prototype.wi;function zk(e){var r=e.padding;e.center.set((e.width+r.left-r.right)/2<<0,(e.height+r.top-r.bottom)/2<<0)}xk.prototype.resize=function(){var e=this.S.offsetWidth,r=this.S.offsetHeight;(this.width!==e||this.height!==r)&&(this.a=new Wi(this.width,this.height),this.width=e,this.height=r,zk(this),this.dispatchEvent(this.A.za))},xk.prototype.resize=xk.prototype.resize,xk.prototype.$a=function(e){this.dispatchEvent(new dj(this.A.le,this.a,e,ej.SIZE))},xk.prototype.synchronize=xk.prototype.$a,xk.prototype.o=function(){this.S.removeChild(this.element),delete this.S,delete this.element,xk.j.o.call(this)},xk.prototype.lc=Qc,xk.prototype.startInteraction=xk.prototype.lc,xk.prototype.cc=Qc,xk.prototype.interaction=xk.prototype.cc,xk.prototype.wb=Qc,xk.prototype.endInteraction=xk.prototype.wb;function Ak(e,r,n,o,s,l){var h;for(h=[];o<=s;o++)h=h.concat(Bk(e,n,o));for(e=h.length,xj.call(this,l,e),this.l=n=[],this.f=A(this.f,this),this.c=A(this.c,this),this.O(1);e--;)l=h[e],n.push(Ck(r,l[0],l[1],l[2],this.f,this.c))}u(Ak,xj),Ak.prototype.f=function(){zj(this,2)},Ak.prototype.c=function(){zj(this,4)},Ak.prototype.oe=function(){for(var e=this.l,r=e.length;r--;)e[r].cancel();delete this.l};function Dk(e,r){var n=this;if(!Da(r))throw new D(Ek,1,r);if(!Da(e.next||Da(e.cycle)))throw new D(Dk,2,'Argument "mode" must implement H.util.AsyncQueue.Mode');this.b=[],this.c=[],this.g=e,this.i=r,this.l=function(){Fk(n)},this.a=null,this.f=function(){n.a||(n.a=x.setTimeout(n.l,1))}}t("H.util.AsyncQueue",Dk),Dk.prototype.push=function(e,r){if(!Da(r))throw new D(this.push,1,r);return e=Gk(new Hk,e,this.f,r),this.b.push(e),this.f(),e},Dk.prototype.push=Dk.prototype.push;function Fk(e){var r=e.c,n=0,o=e.g;for(o.a(),e.a=null;n<r.length;){var s=r[n];s.Tj?r.splice(n,1):n++}for(;s=o.next(e.b,e.c);)s.cancelled?s.done(null,"cancelled"):(r.push(s),e.i(s,s.data))}function Hk(){Gk(this,null,null,null)}Dk.Task=Hk;function Gk(e,r,n,o){return e.data=r,e.cancelled=!1,e.Tj=!1,e.b=n,e.c=o,e.a=null,e}Hk.prototype.done=function(e,r){this.Tj=!0,this.b(),this.c(this,e,r)},Hk.prototype.done=Hk.prototype.done,Hk.prototype.cancel=function(){this.a&&this.a(),this.cancelled=!0},Hk.prototype.cancel=Hk.prototype.cancel,Hk.prototype.vo=function(e){return this.a=e,this},Hk.prototype.setCancelFn=Hk.prototype.vo;function Ik(){}Dk.Mode=Ik,Ik.prototype.next=function(){},Ik.prototype.a=function(){};var Jk,Kk=function(){function e(){}for(var r,n,o,s=tc("o ms moz webkit "),l=5;l--&&!r;)r=s[l],r=(n=x[r+(r?"R":"r")+"equestAnimationFrame"])&&!E(n.call(window,e))&&(o=x[r+(r?"C":"c")+"ancelAnimationFrame"]);return Jk=r?function(h){return n.call(x,h)}:function(h){return x.setTimeout(h,25)},r?function(h){return o.call(x,h)}:function(h){return x.clearTimeout(h)}}(),Lk=x.performance&&x.performance.now?function(){return x.performance.now()}:function(){return x.Date.now()};function Mk(e,r){Mk.j.constructor.call(this,new Nk(e),r)}u(Mk,Dk),t("H.util.SequentialQueue",Mk);function Nk(e){if(isNaN(e)||0>e)throw new D(Mk,1,'Argument "maxTime" must be a positive number');this.c=e,this.b=Lk()}Nk.prototype.next=function(e){return e.length&&Lk()-this.b<this.c?e=e.shift():null},Nk.prototype.a=function(){this.b=Lk()};function Ok(e){if(xc(this,Ok),Ok.j.constructor.call(this,e),e&&"tileSize"in e){var r=Ed(+e.tileSize)/Od;if(isNaN(r)||r%1||0>r||30<r)throw new D(Ok,0,"tileSize: "+e.tileSize);this.tileSize=+e.tileSize}}u(Ok,P),t("H.map.provider.TileProvider",Ok);function Pk(e,r){return Yd(e)-8-Ad(Yd(r))}Ok.getZoomLevelOffset=Pk,Ok.prototype.requestTile=Ok.prototype.Ha,Ok.prototype.cancelTile=Ok.prototype.mc,Ok.prototype.cancelTileByKey=Ok.prototype.pe,Ok.prototype.createTileInternal=Ok.prototype.ac,Ok.prototype.uc=function(e,r,n){return this.uri.concat("_",e,"_",r,"_",n)},Ok.prototype.getTileKey=Ok.prototype.uc,Ok.prototype.kf=256,Ok.prototype.tileSize=Ok.prototype.kf;function Qk(){}t("H.util.ICache",Qk),Qk.prototype.add=function(){},Qk.prototype.add=Qk.prototype.add,Qk.prototype.get=function(){},Qk.prototype.get=Qk.prototype.get,Qk.prototype.zf=function(){},Qk.prototype.drop=Qk.prototype.zf,Qk.prototype.forEach=function(){},Qk.prototype.forEach=Qk.prototype.forEach,Qk.prototype.na=function(){},Qk.prototype.removeAll=Qk.prototype.na,Qk.prototype.$d=function(){},Qk.prototype.registerOnDrop=Qk.prototype.$d,Qk.prototype.Ug=function(){},Qk.prototype.deRegisterOnDrop=Qk.prototype.Ug;function Rk(e,r,n){if(this.g=[],r&&this.$d(r),n&&!Da(n))throw new D(Rk,2,n);this.b=0,this.filter=n,this.a={},this.f=this.c=null,this.ti(e)}t("H.util.Cache",Rk),Rk.prototype.add=function(e,r,n){var o,s;if(n=+n,!Fc(n)||0>n)throw new D(this.add,2,n);return e=String(e),(s=this.filter?this.filter(e,r,n):!0)&&((o=this.a[e])?(o.data!==r&&Sk(this,o),this.b+=n-o.size,o.size=n,o.data=r,Tk(this,o)):this.a[e]=Uk(this,{id:e,data:r,size:n,fc:null,Zc:null},this.c),Vk(this)),s},Rk.prototype.add=Rk.prototype.add,Rk.prototype.$d=function(e){if(!Da(e))throw new D(this.$d,0,e);this.g.push(e)},Rk.prototype.registerOnDrop=Rk.prototype.$d,Rk.prototype.Ug=function(e){this.g=this.g.filter(function(r){return r!==e})},Rk.prototype.deRegisterOnDrop=Rk.prototype.Ug,Rk.prototype.get=function(e,r){return(e=r?this.a[e]:Tk(this,this.a[e]))&&e.data},Rk.prototype.get=Rk.prototype.get,Rk.prototype.zf=function(e){var r;(r=this.a[e])&&Wk(this,r,!0)},Rk.prototype.drop=Rk.prototype.zf,Rk.prototype.forEach=function(e,r,n){var o;for(o in this.a){var s=this.a[o];(!n||n(o,s.data,s.size))&&e.call(r,o,s.data,s.size)}},Rk.prototype.forEach=Rk.prototype.forEach,Rk.prototype.na=function(e){var r;for(r in this.a){var n=this.a[r];(!e||e(r,n.data,n.size))&&Wk(this,this.a[r],!0)}},Rk.prototype.removeAll=Rk.prototype.na,Rk.prototype.ti=function(e){if(!(0<+e))throw new D(Rk.prototype.ti,0,e);return this.i=+e,Vk(this),this},Rk.prototype.setMaxSize=Rk.prototype.ti,Rk.prototype.Cm=function(){return this.i},Rk.prototype.getMaxSize=Rk.prototype.Cm,Rk.prototype.Xl=function(){return this.b},Rk.prototype.getCurrentSize=Rk.prototype.Xl;function Tk(e,r){return r&&(e.c=Uk(e,r,e.c)),r}function Vk(e){for(;e.b>e.i&&e.f;)Wk(e,e.f,!0)}function Uk(e,r,n){return n!==r&&((r.fc||r.Zc)&&Wk(e,r,!1),(r.fc=n)&&(r.Zc=n.Zc,n.Zc=r),r.Zc||(e.c=r),r.fc||(e.f=r),e.b+=r.size),r}function Wk(e,r,n){var o=r.Zc,s=r.fc;(o||s||r==e.c&&r==e.f)&&(o?o.fc=s:e.c=s,s?s.Zc=o:e.f=o,e.b-=r.size,n&&(delete e.a[r.id],Sk(e,r))),r.fc=r.Zc=null}function Sk(e,r){for(var n=e.g.length;n--;)e.g[n].call(e,r.id,r.data,r.size)}function Xk(e,r,n,o){this.key="",this.x=e,this.y=r,this.z=n,this.data=o,this.valid=!0}t("H.map.provider.Tile",Xk);function Yk(e,r,n,o){return e-=n,r-=o,e*e+r*r}function Zk(e,r,n){return $k(e,r*r,n||0,0,e.length-1)}t("H.math.simplifyDP",Zk);function $k(e,r,n,o,s){var l=0,h=o,d=e[o].x,y=e[o].y,g=e[s].x,v=e[s].y,m=o+1,w=Yk(d,y,g,v);if(w)for(;m<s;){var I=e[m++],V=I.x;I=I.y;var q=((V-d)*(g-d)+(I-y)*(v-y))/w;V=0>q?Yk(V,I,d,y):1<q?Yk(V,I,g,v):Yk(V,I,d+q*(g-d),y+q*(v-y)),V>l&&(l=V,h=m-1)}else for(;m<s;)I=e[m++],V=I.x,I=I.y,V=Yk(V,I,d,y),V>l&&(l=V,h=m-1);return l>=r||0<n&&h-o?(--n,1<h-o?(o=$k(e,r,n,o,h),o.splice(o.length-1,1)):o=[e[o]],o=1<s-h?o.concat($k(e,r,n,h,s)):o.concat(e.slice(h,s+1))):o=[e[o],e[s]],o}function al(e,r,n,o,s,l,h,d){al.j.constructor.call(this,r,n,o,null),this.key=e,this.U=d,this.a=s,this.g=l,this.i={},this.zL=h,this.m=Cd(wh.MAX_LINE_WIDTH/2*this.g+1)}u(al,Xk),t("H.map.provider.SpatialTile",al),al.prototype.c=Xd,al.prototype.u=Xd,al.prototype.b=Xd;function bl(e){return e.U.getInvalidations(nh.SPATIAL)}function cl(e){var r=bl(e),n=r.a,o=e.c,s=o===n,l;if(!(s||r.Rj(o)||r.yh(o))){s=e.f;var h=e.i;if(r.Sf(o))for(l=s.length;l--;){var d=s[l];if(d.Kb().Sf(o)){s.splice(l,1);var y=y||dl(e,d.cb())}}if(r.zh(o)){for(l=s.length;l--;)if(d=s[l],d.Kb().zh(o)){var g=1;if((d=h[d.cb()])&&d.a){y=1;break}}g&&s.sort(el)}if(!y&&r.Vd(o)){for(l=s.length;l--;)if(s[l].Kb().Vd(o)){var v=1;break}}e.u!==o||v||(e.u=n,e.b!==o||y||(e.b=n)),e.c=n,s=!0}return s}al.prototype.Ud=function(){var e=bl(this),r=e.a,n=this.b,o=n===r;return o||(this.U.qa&&!e.Vd(n)?o=!0:cl(this)&&(o=this.b===r)),o},al.prototype.isCanvasValid=al.prototype.Ud,Object.defineProperty(al.prototype,"valid",{get:function(){return this.Ud()},set:ld,configurable:!0});function fl(e,r){this.b=e,this.a=r}function dl(e,r){e=e.i;var n=e[r];if(n)return delete e[r],n.a}al.prototype.f=hf;function gl(e){var r=bl(e),n=e.c,o=e.f,s;if(!cl(e)){for(s=o.length;s--;){var l=o[s],h=l.Kb();(h.Sf(n)||h.yh(n))&&dl(e,l.cb())}e.f=e.U.requestSpatialsByTile(e,!1,!1).sort(el),e.c=r.a}}function el(e,r){return oh(e.Uc(),r.Uc(),!1)}al.prototype.Ua=function(){return this.f},al.prototype.getObjects=al.prototype.Ua,al.prototype.$m=function(){return this.a},al.prototype.getTileSize=al.prototype.$m;var hl={};al.prototype.Le=function(){var e=this.a+"_"+this.g,r=hl[e];if(!r){r=-this.m;var n=this.a-r;r=hl[e]=new yk(r,r,n,n)}return r},al.prototype.getPxClipRect=al.prototype.Le,al.prototype.Hf=function(){var e=this.mb;if(!e){var r=this.Jf();e=0;var n=this.a;this.z&&(n-=e+=this.Le().top),e=this.mb=sg(r.Re(new J(e,e)),r.Re(new J(n,n)))}return e},al.prototype.getGeoClipRect=al.prototype.Hf,al.prototype.Jf=function(){var e=this.J;if(!e){var r=this.a;e=this.J=new nj(B,r),e.Oa(this.z),e.x=this.x*r,e.y=this.y*r}return e},al.prototype.getPxProj=al.prototype.Jf,al.prototype.Xa=function(){return this.g},al.prototype.getPixelRatio=al.prototype.Xa,al.prototype.gg=function(){var e=this.data;return e&&(this.data=null,this.b=Xd),e},al.prototype.releaseCanvas=al.prototype.gg,al.prototype.hg=function(){this.i={},delete this.f,this.c=Xd},al.prototype.releaseData=al.prototype.hg,al.prototype.W=function(e){var r=e.getContext("2d"),n,o,s,l,h=0;if(gl(this),this.b<this.c){var d=this.f;if(n=d.length){e.width=e.height=this.a,r.clearRect(0,0,this.a,this.a);var y=this.i;for(o=0;o<n;o++){var g=d[o],v=g.cb();if(l=(s=y[v])?s.b:g.getGeometriesForTile(this)){if(s)g.Kb().Vd(this.b)&&(s.a=Ih(g,l)),s=s.a;else{s=Ih(g,l);for(var m,w=l,I=g.g?2:0,V=w.length;V--;){var q=w[V];if(q!==Jh){var De=q.a;for(m=De.length;m--;)q=De[m],4<q.length&&(De[m]=Zk(q,.6,I))}}this.i[v]=new fl(l,s)}if(s){for(r.save(),w=g.g?this.D:this.P,v=0;v<l.length;v++)w.call(this,g,l[v],g.V(),r);if(l=g.getLabels(this))for(g=r,v=l.length;v--;)for(I=l[v],w=I.size,g.font=w+"px "+I.font,g.fillStyle=I.color,g.textAlign="center",g.translate(I.x,I.y),g.rotate(I.angle),w=I.lineHeight||1.375*w,V=I.lines,I=V.length;I--;)g.fillText(V[I],0,I*w);r.restore()}h|=+s}}}this.data=h?e:null,this.u=this.b=this.c}else this.data&&(h=1);return 0<h},al.prototype.render=al.prototype.W,al.prototype.data=null,al.prototype.P=function(e,r,n,o){var s;n.b&&(il(o,n,this.g),jl(r,o,!1,!0,!1,this.a,this.m)),n.a&&(s=e.c)&&s.Ob&&(kl(o,s),ll(this,o,r,s,n.lineWidth))},al.prototype.D=function(e,r,n,o){var s=n.Ob,l=n.b,h,d=this.a,y=this.m;if(r===Jh)s&&(kl(o,n),o.fillRect(0,0,d,d));else{if(l&&il(o,n,this.g),n.a&&(h=e.c)){var g=n.lineWidth;h.Ob||(h=null)}e=r.c,e===Wd?((l||s)&&(kl(o,n),jl(r,o,!0,l,s,d,this.m)),h&&(kl(o,h),ll(this,o,r,h,g,0))):(s&&(kl(o,n),jl(r,o,!0,!1,s,d,y,0,e)),l&&jl(r,o,!1,l,!1,d,y,e),h&&(kl(o,h),ll(this,o,r,h,g,e)))}};function jl(e,r,n,o,s,l,h,d,y){var g=e.a,v=-h;if(h=l+h,d=d||0,y===B&&(y=g.length),s&&e===Jh)r.fillRect(0,0,l,l);else if(y>d){for(r.beginPath(),l=d;l<y;l++){var m=g[l],w=m.length;if(m===Qh)r.moveTo(v,v),r.lineTo(v,h),r.lineTo(h,h),r.lineTo(h,v);else{var I=m[0];for(r.moveTo(I.x,I.y),d=1;d<w;d++)I=m[d],r.lineTo(I.x,I.y)}n&&r.closePath()}n&&s&&r.fill(e.b!==Wd?"evenodd":"nonzero"),o&&r.stroke()}}function il(e,r,n){var o;e.strokeStyle=r.strokeColor,e.lineWidth=r.lineWidth*n,e.lineCap=r.lineCap,e.lineJoin=r.lineJoin,e.miterLimit=r.miterLimit,e.setLineDash&&(o=r.lineDash)!==hf&&(e.setLineDash(o),e.lineDashOffset=r.lineDashOffset)}function kl(e,r){e.fillStyle=r.fillColor}function ll(e,r,n,o,s,l){var h=s*o.width/2;s=s*o.length/2;var d=s/2;o=2*s*o.frequency;var y=Fd(Gd(s,2)+Gd(h,2));e=e.a-y,e=new yk(y,y,e,e),n=n.a;var g,v,m,w,I,V,q,De=Pd/2;for(l=l||0,y=n.length;y-- >l;){var _n=0,ha=n[y];if(v=g=ha.length){var ga=ha;for(v=ga.length,m=0;--v;)m+=ga[v].Wa(ga[v-1]);v=(ga=m)>=o}if(v)for(v=yd(Bd(ga/o),1e3),v=ga/(v+1),m=v/2;--g;){for(w=(I=ha[g]).Wa(V=ha[g-1]);m<=_n+w;){var _o=I.x+(V.x-I.x)*(q=(m-_n)/w);q=I.y+(V.y-I.y)*q,e.vf(_o,q)&&(r.save(),r.translate(_o,q),r.rotate(-Md((V.y-I.y)/(I.x-V.x))+(I.x<V.x?De:-De)),r.beginPath(),r.moveTo(-h,-s),r.lineTo(0,s),r.lineTo(h,-s),r.lineTo(0,-d),r.closePath(),r.fill(),r.restore()),m+=v}_n+=w}}}var ml=[];al.prototype.Ea=function(e,r,n){for(var o=this.f,s=o.length,l,h,d,y,g,v,m=hf,w,I=this.g;s--;)if(h=o[s],h.wc(!0)&&(d=this.i[h.cb()])&&(y=d.b)){for(l=h.V(),v=l.fillColor!=="none"&&h.g,w=l.strokeColor==="none"?0:l.lineWidth*I,l=y.length;l--;){g=y[l];var V;if(!(V=v&&g===Jh)&&(V=v||w)){var q;V=e;var De=r,_n=v,ha=w,ga=g.b,_o=g.c,_l=_o!==Wd,wc=g.a,_h=wc.length,_p=0,pd=0,oy=!1;for(g=0;g<_h;g++){var ny=wc[g],fy=g>=_o,wy=!fy&&g>=ga;if(ny===Qh&&_n)wy?_p++:pd++;else{var cy=ny.length;for(ml.length=2*cy,q=0;q<cy;q++){var Gy=ny[q];ml[2*q]=Gy.x,ml[2*q+1]=Gy.y}if(q=_n&&!fy,fy=_l&&!fy?0:ha,q||fy){if(fy=ee(V,De,ml,fy,q),fy===de.EDGE||fy===de.VERTEX){oy=!0;break}else if(fy===de.SURFACE){if(wy)_p++;else if(pd++,ga===Wd)break}}}}V=oy||0<pd&&!(_p%2)}if(V){m===hf&&(m=[]),m.push(h);break}}if(n&&m.length)break}return m};function nl(e,r){var n;nl.j.constructor.call(this,r),this.D=e,this.P=e=r.pixelRatio,this.tileSize=n=1<<Ad(Yd((r.tileSize||256)*e)),this.L=Pk(n,e),this.Gh=A(this.Gh,this),this.Wh=A(this.Wh,this),this.Hh=A(this.Hh,this),this.Fh=A(this.Fh,this),this.m=A(this.m,this),this.D.addEventListener(P.prototype.A.za,this.m,!1,this),this.f=[],this.i=new Rk(r.tileCacheSize||256,this.Gh),this.l=new Rk(r.dataCacheSize||512,this.Wh),this.J=new Mk(20,this.Hh),this.c={},this.u=Lk()}u(nl,Ok),nl.prototype.m=function(e){e=e.target,e.type===nh.SPATIAL&&this.Va(e)},nl.prototype.Ha=function(e,r,n,o){var s=this.getTileKey(e,r,n),l;if(l=this.i.get(s,o)){if(o||l.Ud())return l;o||this.i.zf(s)}if((l=this.l.get(s,o))&&(o||cl(l)))return e=this.f.pop()||document.createElement("canvas"),l.W(e)||this.f.push(e),this.i.add(s,l,1),l;o||((l=this.c[s])?l.count++:(l=this.J.push([s,e,r,n],this.Fh),l.count=1,this.c[s]=l))},nl.prototype.requestTile=nl.prototype.Ha,nl.prototype.ac=function(){},nl.prototype.createTileInternal=nl.prototype.ac,nl.prototype.mc=function(e,r,n){this.pe(this.getTileKey(e,r,n))},nl.prototype.cancelTile=nl.prototype.mc,nl.prototype.pe=function(e){var r;(r=this.c[e])&&(r.count--,r.count||(r.cancel(),delete this.c[e]))},nl.prototype.cancelTileByKey=nl.prototype.pe,p=nl.prototype,p.Hh=function(e,r){var n=r[0],o=r[1],s=r[2],l=r[3];n=this.i.get(n)||new al(n,o,s,l,this.tileSize,this.P,l+this.L,this.D),o=n.data||this.f.pop()||document.createElement("canvas"),n.W(o)||this.f.push(o),r.push(n),e.done(n)},p.Fh=function(e,r){e=e.data[0],r&&this.i.add(e,r,1),delete this.c[e],this.Va()},p.Gh=function(e,r){r.data&&this.f.push(r.gg()),this.l.add(e,r,1)},p.Wh=function(e,r){r.hg()},p.o=function(){for(var e in this.c)this.c[e].cancel();this.i.na(),this.l.na(),this.f.length=0,nl.j.o.call(this)};function yk(e,r,n,o){this.left=+e,this.top=+r,this.right=+n,this.bottom=+o}t("H.math.Rect",yk),yk.prototype.set=yk,yk.prototype.set=yk.prototype.set,yk.prototype.Nb=function(){return this.b||(this.b=new J(this.left,this.top))},yk.prototype.getTopLeft=yk.prototype.Nb,yk.prototype.Jb=function(){return this.a||(this.a=new J(this.right,this.bottom))},yk.prototype.getBottomRight=yk.prototype.Jb,yk.prototype.vf=function(e,r){return this.left<=e&&this.right>=e&&this.top<=r&&this.bottom>=r},yk.prototype.containsXY=yk.prototype.vf;function ol(e,r){return new yk(e.x,e.y,r.x,r.y)}yk.fromPoints=ol,yk.prototype.clone=function(){return new yk(this.left,this.top,this.right,this.bottom)},yk.prototype.clone=yk.prototype.clone;function pl(e,r){if(r=r||{},!e)throw new D(pl,0,e);this.tileSize=e.tileSize,this.a={},qj.call(this,{min:r.min!==void 0?r.min:e.min,max:r.max!==void 0?r.max:e.max,minWorldSize:this.tileSize,projection:r.eg,dark:r.dark,provider:e})}u(pl,qj),t("H.map.layer.BaseTileLayer",pl),pl.prototype.Ae=function(e,r){var n=this.pixelProjection;if(!C(e,K))throw new D(this.Ae,0,e);if(!E(r)){var o=n.Jj();n.Oa(r)}return e=ol(n.ib(e.Nb()),n.ib(e.Jb())),!E(o)&&n.Oa(o),e},pl.prototype.geoRectToRect=pl.prototype.Ae,pl.prototype.Sd=function(e,r){var n=Gd(2,Bd(r)),o=this.tileSize;if(!C(e,yk))throw new D(this.Sd,0,e);if(E(r=+r))throw new D(this.Sd,1,r);r=Bd(e.left/o),r===n&&--r;var s=Bd(e.right/o);return s===n&&--s,new yk(r,ae(Bd(e.top/o),0,n-1),s,ae(Bd(e.bottom/o),0,n-1))},pl.prototype.getTileBounds=pl.prototype.Sd,pl.prototype.Ha=function(e,r,n,o){return this.ma.requestTile(e,r,n,o)},pl.prototype.requestTile=pl.prototype.Ha,pl.prototype.mc=function(e,r,n){this.ma.cancelTile(e,r,n)},pl.prototype.cancelTile=pl.prototype.mc,pl.prototype.ba=function(e,r){return this.ma.getCopyrights?this.ma.getCopyrights(e,r):null},pl.prototype.getCopyrights=pl.prototype.ba;function ql(e,r,n,o,s){o=Bd(o);var l=Gd(2,o),h=r.left,d=r.top,y=r.right;n=y+(n?l+(y===r.left?0:1):1);var g=r.bottom,v=[];if(s)var m=h+(1+y-h)/2+s.x/e.tileSize-.5,w=d+(1+g-d)/2+s.y/e.tileSize-.5;for(;h<n;){for(d=r.top;d<=g;)e=h%l,v.push([e,d,o,s?Dd(m-h)+Dd(w-d):0]),d++;h++}return v}function Bk(e,r,n){n=Bd(n),e.pixelProjection.Oa(n),r=e.Ae(r);var o=e.Sd(r,n);return ql(e,o,r.left>r.right,n)}pl.prototype.Ke=function(e,r,n,o,s,l){var h,d=[],y,g=this.ma;l=l??"__default__";var v=g.requestTile;if(!C(e,yk))throw new D(this.Ke,0,e);if(E(n=+n))throw new D(this.Ke,1,n);if(o||(h={}),r=ql(this,e,r,n,s),e=r.length)for(o||r.sort(rl),n=e;n--;)s=r[n],o||(h[g.uc.apply(g,s)]=!0),s[3]=+o,(y=v.apply(g,s))&&d.push(y);if(!o){o=h;var m;h=this.a[l]||{};for(m in h)h.hasOwnProperty(m)&&h[m]&&!o[m]&&this.ma.cancelTileByKey(m);this.a[l]=o}return{total:e,tiles:d}},pl.prototype.getProviderTiles=pl.prototype.Ke;function rl(e,r){return r[3]-e[3]}function sl(e,r){pl.call(this,e,r)}u(sl,pl),t("H.map.layer.TileLayer",sl),sl.prototype.td=function(e,r,n,o,s){if(!C(e,K))throw new D(this.td,0,e);if(E(r=+r))throw new D(this.td,1,r);r=Bd(r),this.pixelProjection.Oa(r),e=this.Ae(e);var l=this.Sd(e,r);return this.Ke(l,e.left>e.right,r,n,o,s)},sl.prototype.requestTiles=sl.prototype.td;function tl(e,r){r=r?Wa(r):{},r.tileSize=r.tileSize||256,r.pixelRatio=r.pixelRatio||Ue(),r.max=24,this.a=new nl(e,r),this.b=new sl(this.a),r.minWorldSize=this.a.tileSize,r.provider=e,tl.j.constructor.call(this,r),this.tileSize=this.b.tileSize,this.c=A(this.c,this),this.a.addEventListener(this.a.A.za,this.c),e.addEventListener(e.A.za,this.c)}u(tl,qj),t("H.map.layer.ObjectLayer",tl),tl.prototype.c=function(e){e.currentTarget!==this.a&&e.target.type===nh.SPATIAL||this.Va()};var ul={markers:hf,total:0};tl.prototype.Ec=function(e,r,n){var o=this.ma,s;return o.providesMarkers()&&(s=o.requestMarkers(e,r,!0,n)).length?{markers:s,total:s.length}:ul},tl.prototype.requestMarkers=tl.prototype.Ec,tl.prototype.Dc=function(e,r,n){var o=this.ma,s;return o.providesDomMarkers()&&(s=o.requestDomMarkers(e,r,!0,n)).length?{markers:s,total:s.length}:ul},tl.prototype.requestDomMarkers=tl.prototype.Dc;var vl={tiles:hf,total:0};tl.prototype.td=function(e,r,n,o){if(this.ma.providesSpatials()){var s=this.b.td(e,r,n,o);n||(n=this.a,s=Lk(),33<s-n.u&&(Fk(n.J),n.u=s),s=this.b.td(e,r,!0,o))}else s=vl;return s},tl.prototype.requestTiles=tl.prototype.td,tl.prototype.Ha=function(e,r,n,o){return this.b.Ha(e,r,n,o)},tl.prototype.requestTile=tl.prototype.Ha,tl.prototype.mc=function(e,r,n){this.b.mc(e,r,n)},tl.prototype.cancelTile=tl.prototype.mc;var wl={overlays:hf,total:0};tl.prototype.sd=function(e,r,n){var o=this.ma,s=wl;return o.providesOverlays&&o.providesOverlays()&&(e=o.requestOverlays(e,r,!0,n),r=e.length)&&(s={overlays:e,total:r}),s},tl.prototype.requestOverlays=tl.prototype.sd,tl.prototype.o=function(){this.a.F(),this.b.F(),this.ma.dispose(),tl.j.o.call(this)};function S(e){xc(this,S),S.j.constructor.call(this,e),this.sb=new xl,this.ub=A(this.ub,this),this.P=yl,this.createTileInternal=this.ac.bind(this)}u(S,Ok),t("H.map.provider.RemoteTileProvider",S),S.prototype.em=function(){return 1},S.prototype.getEntryWeight=S.prototype.em;var yl,zl=screen.width,Al=screen.height,Bl=Ue();Bl=zd(Bl,1);var Cl=Cd(zl*Bl*Al*Bl/1e6);yl=new Rk(Gd(2,zd(8,yd(12,7+Cl))));var Dl={},El={};S.prototype.nb=function(){return this.P},S.prototype.getCache=S.prototype.nb,S.prototype.J=ba(3),S.prototype.ub=function(e){var r=this.uri;return!e.indexOf(r)&&e.charAt(r.length)==="_"},S.prototype.cacheFilter=S.prototype.ub,S.prototype.wa=function(e,r){r.valid=!1},S.prototype.reload=function(e){var r=this.getCache();e?r.na(this.ub):r.forEach(this.wa,this,this.ub),Fl(this),this.Va(this,{isReload:!0})},S.prototype.reload=S.prototype.reload,S.prototype.l=function(){return!1},S.prototype.MAX_STORE_TIME=1/0,S.prototype.c=function(){return this.sb},S.prototype.ea=function(e,r){r(e)};function Ck(e,r,n,o,s,l){return o=~~o,e.requestInternal(r,n,o,function(h,d){e.c().put(e.uc(r,n,o),{raw:d&&d.raw||h,timestamp:x.Date.now()},s,l)},l,0)}S.prototype.requestInternal=S.prototype.B,S.prototype.Ha=function(e,r,n,o){var s=this,l=this.getCache();if(E(e=+e))throw new D(this.Ha,0,e);if(E(r=+r))throw new D(this.Ha,0,r);if(E(n=+n))throw new D(this.Ha,0,n);n=~~n;var h=this.getTileKey(e,r,n);return l=l.get(h),l&&l.valid||o||Dl[h]||(l=B,this.requestTileAsPromise(e,r,n,o).then(function(d){s.Va(d)},ld)),l},S.prototype.requestTile=S.prototype.Ha,S.prototype.Gk=function(e,r,n,o){var s=this,l=this.getCache(),h=this.getTileKey(e,r,n),d,y,g=this.c();return El[h]?El[h]:(El[h]=d=new Rb(function(v,m){function w(I){var V=0,q,De=function(_n,ha){q=s.createTileInternal(e,r,n,_n,ha),q.key=h,l.add(h,q,1),v(q),Gl(h)};I&&(V=x.Date.now()-I.timestamp),I&&V<s.MAX_STORE_TIME?s.ea(I.raw,De):(0<V&&g.remove(h),(q=l.get(h))&&q.valid||o?v(q||null):Dl[h]=s.requestInternal(e,r,n,De,m))}y=g.get(h,w,w)}),Dl[h]||(Dl[h]=y),d.then(function(){Gl(h)},function(){Gl(h)}),d)},S.prototype.requestTileAsPromise=S.prototype.Gk,S.prototype.Fk=function(e,r){var n=this,o=e.id,s=e.tile.coords;return new Rb(function(l,h){n.Gk(s.x,s.y,s.z,r).then(function(d){var y=z;d=d.Ua?d.Ua():d.data;for(var g=d.length,v;g--;)if(v=d[g],v.cb()===o){y=v;break}l(y)},h)})},S.prototype.requestObjectAsPromise=S.prototype.Fk;function Gl(e){delete Dl[e],delete El[e]}function Fl(e){for(var r in Dl)e.ub(r)&&e.cancelTileByKey(r)}var Hl={cancel:ld};S.prototype.ac=function(e,r,n,o){return new Xk(e,r,n,o)},S.prototype.createTileInternal=S.prototype.ac,S.prototype.pe=function(e){var r=Dl[e];r&&(r.cancel(),Gl(e))},S.prototype.cancelTileByKey=S.prototype.pe,S.prototype.mc=function(e,r,n){this.cancelTileByKey(this.getTileKey(e,r,n))},S.prototype.cancelTile=S.prototype.mc,S.prototype.o=function(){S.j.o.call(this),this.getCache().na(this.ub),Fl(this)};function xl(){}S.NullStorage=xl,xl.prototype.get=function(e,r){return r(),Hl},xl.prototype.get=xl.prototype.get,xl.prototype.put=function(e,r,n){n&&n()},xl.prototype.put=xl.prototype.put,xl.prototype.clear=function(e){e&&e()},xl.prototype.clear=xl.prototype.clear,xl.prototype.remove=function(e,r){r&&r()},xl.prototype.remove=xl.prototype.remove;function Ek(e){if(Ek.j.constructor.call(this,e),e&&(this.u={crossOrigin:e.crossOrigin||"anonymous",headers:e.headers||{}},this.m=e.getURL),this.b===kk.HARP&&H.map.render.harp){var r;e&&e.style&&e.style instanceof H.map.render.harp.Style?r=e.style:r=new H.map.render.harp.Style({styles:[{technique:"raster",attr:{gamma:1,brightness:1}}]}),this.Qa(r)}if(!Da(this.m))throw new D(Ek,0,"getURL");if(lk(this,e.opacity),this.f=x.URL||x.webkitURL,e=this.u.crossOrigin,!(e=e==="anonymous"||e==="use-credentials")){e=this.m(0,0,0),r=window.location;var n=document.createElement("a");n.href=e,e=n.hostname===r.hostname&&n.port===r.port&&n.protocol===r.protocol}(this.T=e&&!!uf.arraybuffer&&!!this.f)&&this.nb().$d(A(this.aa,this))}u(Ek,S),t("H.map.provider.ImageTileProvider",Ek),Ek.prototype.ic=function(e){lk(this,e)},Ek.prototype.setOpacity=Ek.prototype.ic,Ek.prototype.Tc=function(){return this.g},Ek.prototype.getOpacity=Ek.prototype.Tc,Ek.prototype.Ve=ff,Ek.prototype.providesRasters=Ek.prototype.Ve,Ek.prototype.B=function(e,r,n,o,s,l){var h=this,d=this.m(e,r,n),y;if(e=Hl,d){var g=x.setTimeout(function(){h.T?(y=new tf("arraybuffer",d,l,h.u),y.then(function(v){return v.blob()}).then(function(v){var m=new Image;m.onload=A(o,null,m,{raw:v}),m.onerror=A(s,null,"bad url");try{m.src=h.f.createObjectURL(v)}catch{}},s)):(y=new tf("image",d,l,h.u),y.then(o,s))},150);e={cancel:function(){y?y.cancel():x.clearTimeout(g)}}}else o(null);return e},Ek.prototype.requestInternal=Ek.prototype.B,Ek.prototype.ea=function(e,r){var n=new Image;n.onload=function(){r(this)},n.src=this.f.createObjectURL(e)},Ek.prototype.aa=function(e,r){(e=r.data)&&e instanceof HTMLImageElement&&this.f.revokeObjectURL(e.src)},Ek.prototype.V=function(){return this.Ya()},Ek.prototype.getStyle=Ek.prototype.V,Ek.prototype.gb=function(e){H.map.render.harp&&this.b===kk.HARP&&e instanceof H.map.render.harp.Style&&this.Qa(e)},Ek.prototype.setStyle=Ek.prototype.gb,t("H.util.events.listenOnce",Fe),t("H.util.events.dispatchEvent",function(e,r){return e.dispatchEvent(r)}),t("H.util.events.fireListeners",function(e,r,n,o){return pe(e)?e.jd(r,n,o):Oe(e,r,n,o)}),t("H.util.events.listen",Ee),t("H.util.events.unlisten",Me);var Il=Pe;Pe=function(e,r){var n,o,s=!0,l=r[r.currentTarget===r.target?"AT_TARGET":e.capture?"CAPTURING_PHASE":(n=!0,"BUBBLING_PHASE")];return(!n||(o=r.type)!=="pointerenter"&&o!=="pointerleave")&&(r.eventPhase=l,s=Il(e,r),n&&e.src&&e.src.Mb&&e.src.Mb()===null&&delete r.eventPhase),s};function Jl(e,r,n,o){var s=new yk(0,0,0,0);if(Jl.j.constructor.call(this),!e)throw new D(Jl,0,e);if(!r)throw new D(Jl,1,r);if(!n)throw new D(Jl,2,n);if(typeof o!="object")throw new D(Jl,3,o+" is not an object");if(typeof o.pixelRatio!="number")throw new D(Jl,3,o.pixelRatio+" is not a number");this.oa=o.pixelRatio,this.zoom=0,this.fb=Ed(this.oa)/Od,this.b=new nj,this.wa={1:s.clone(),2:s.clone(),4:s.clone()},this.s=new J(.5,.5),this.f=e,Kl(this,this.oa),this.lc=A(this.lc,this),this.cc=A(this.cc,this),this.wb=A(this.wb,this),e.startInteraction=this.lc,e.interaction=this.cc,e.endInteraction=this.wb,e.addEventListener(e.A.za,this.T,!1,this),this.getCapabilities=this.getCapabilities,this.capture=this.capture,this.zoomAt=this.xd,this.relaunch=this.ha,this.dispose=this.F,this.screenToGeo=this.Pa,this.geoToScreen=this.Da,this.screenToLookAtData=this.qg,this.J=r,this.kc=A(this.kc,this),this.control=A(this.control,this),this.vb=A(this.vb,this),r.startControl=this.kc,r.control=this.control,r.endControl=this.vb,r.addEventListener(r.A.za,this.Kg,!1,this),this.c=n,this.Zf=A(this.Zf,this),this.Me=A(this.Me,this),this.Ne=A(this.Ne,this),this.Yf=A(this.Yf,this),n.addEventListener(qj.prototype.A.za,this.Zf,!1,this),n.addEventListener(n.A.he,this.Me,!1,this),n.addEventListener(n.A.je,this.Ne,!1,this),n.addEventListener(n.A.ke,this.Yf,!1,this)}u(Jl,F),t("H.map.render.RenderEngine",Jl),Jl.prototype.xd=function(){};function Kl(e,r){var n=e.f,o=n.width,s=n.height,l=n.padding,h=l.top,d=l.left,y=l.bottom;l=l.right,n=n.margin;var g=-(o+d-l)/2<<0,v=-(s+h-y)/2<<0;o+=g,s+=v,e=e.wa,e[1].set((g-n)*r,(v-n)*r,(o+n)*r,(s+n)*r),e[2].set(g*r,v*r,o*r,s*r),e[4].set((g+d)*r,(v+h)*r,(o-l)*r,(s-y)*r)}Jl.prototype.T=function(){Kl(this,this.oa)},Jl.prototype.o=function(){var e=this.f,r=this.J,n=this.c;e.removeEventListener(e.A.za,this.T,!1,this),e.startInteraction===this.lc&&(e.startInteraction=xk.prototype.lc),e.interaction===this.cc&&(e.interaction=xk.prototype.cc),e.endInteraction===this.wb&&(e.endInteraction=xk.prototype.wb),r.removeEventListener(r.A.za,this.Kg,!1,this),r.startControl===this.kc&&(r.startControl=Ll.prototype.kc),r.control===this.control&&(r.control=Ll.prototype.control),r.endControl===this.vb&&(r.endControl=Ll.prototype.vb),n.removeEventListener(qj.prototype.A.za,this.Zf,!1,this),n.removeEventListener(n.A.he,this.Me,!1,this),n.removeEventListener(n.A.je,this.Ne,!1,this),n.removeEventListener(n.A.ke,this.Yf,!1,this)},Jl.prototype.mi=function(e){this.me=e},Jl.prototype.setAnimationCallback=Jl.prototype.mi,Jl.prototype.hi=function(){this.me=void 0},Jl.prototype.resetAnimationCallback=Jl.prototype.hi,Jl.prototype.control=function(){},Jl.prototype.capture=function(){return $b(Error("not implemented"))};function Ml(e,r){e.style.transition="opacity 1.5s",Fe(e,"transitionend",r,!1),e.style.opacity=0}var Nl={ZOOM:1,HEADING:2,TILT:4,INCLINE:8,COORD:16};Jl.InteractionModifiers=Nl,p=Jl.prototype,p.A={Vi:"render"},p.Zf=function(e){this.nk(e),this.ha()},p.Me=function(e){this.Pe(e.idx,e.added)},p.Ne=function(e){this.Xh(e.idx,e.removed,e.type===this.c.A.ke)},p.Yf=function(e){e.removed&&this.Ne(e),this.Me(e)},p.nk=ld,p.Pe=function(e,r){this.th(e,r),e===0&&this.Eb(),C(r,qj)&&Ol(this,r,!0),this.ce(),this.ha()},p.Eb=function(){var e=this.c.La();if(0<e.length){var r=e[0].max;this.Eg=e[0].min,this.Dg=r}else e=this.getCapabilities().lookAt.zoom,r=e.max,this.Eg=e.min,this.Dg=r;e=Pl(this,this.zoom),e!==this.zoom&&(this.zoom=e,this.b.Oa(e),this.$a())},p.$a=function(e){this.P=this.jb(),e&&(this.P.position=e),this.P.zoom=this.zoom-this.fb,this.P.position.alt=0},p.dl=0,p.heading=180,p.jb=function(){return Ql(this,{position:this.b.projection.dg(this.s),zoom:this.zoom,tilt:this.dl,heading:this.heading})};function Ql(e,r){return r.tilt=Rl(e,r.tilt),r.heading=Sl(e,r.heading),r.incline=e.getCapabilities().lookAt.incline.min,r}function Pl(e,r){var n=e.getCapabilities().lookAt.zoom;return ae(r,zd(n.min,e.Eg),yd(n.max,e.Dg))}function Rl(e,r){return e=e.getCapabilities().lookAt.tilt,ae(r,e.min,e.max)}function Sl(e,r){return e=e.getCapabilities().lookAt.heading,ae((r%360+360)%360,e.min,e.max)}function Ol(e,r,n){n=n?r.addEventListener:r.removeEventListener,n.call(r,r.A.Ti,e.Yh,!1,e),n.call(r,r.A.Si,e.Yh,!1,e)}p.th=ld,p.Xh=ld,p.xo=function(e,r){this.D={before:e,after:r}},Jl.prototype.setOnRenderCallbacks=Jl.prototype.xo;var Tl={P2D:0,WEBGL:1,HARP:2};Jl.EngineType=Tl;var Ul={lookAt:{zoom:{min:-8,max:24},tilt:{min:0,max:85},incline:{min:0,max:0},heading:{min:0,max:360}},interaction:{ZOOM:Nl.ZOOM,COORD:Nl.COORD},capture:!0};t("H.map.render.webgl.capabilities",Ul);function Vl(e){var r,n=this,o=x.H.gl;Vl.j.constructor.call(this),this.a=r=o.Scene.create(x.URL.createObjectURL(pf(JSON.stringify(Wl))),{viewport:e.viewport,container:e.Zb,disableRenderLoop:!0,devicePixelRatio:e.devicePixelRatio,logLevel:"error"}),e.ao&&r.subscribe({load:e.ao}),r.subscribe({view_complete:function(){n.ji=!0,e.qk()}});var s=r.requestRedraw;r.requestRedraw=function(){s.apply(r),e.qk()},this.ki=A(this.ki,this),this.jg=A(this.jg,this),this.f=0,this.c={},this.b={}}u(Vl,qd),p=Vl.prototype,p.ji=!1;function Xl(e){e=e.a.sources;var r;for(r in e){var n=e[r];if(n.hasPendingCommands&&n.hasPendingCommands())return!0}return x.H.gl.Task.hasPendingTasks()}p.W=function(){var e=x.H.gl.Task;return this.a.immediateRedraw(),e.setState({user_moving_view:this.a.view.user_input_active}),e.processAll(),this.ji&&!this.a.dirty&&!this.a.building&&!Xl(this)&&!Object.keys(this.b).length};function Yl(e){e.ji=!1,e.a.resetViewComplete()}function Zl(e){return e.a.view}function $l(e,r){function n(){var s=r.La(),l={},h={},d,y,g,v=++e.f,m,w;for($h(h,Wl),y=0;y<s.length;y++){var I=s[y];if(d=I.ca()){var V=d.Ya();if(V.getState()===Xh.READY){var q=V.qc();if(!Va(q)){delete q.cameras,delete q.camera,l[y]=q=li(q,y),!C(I,tl)&&q.sources&&mi(q,d.uid);for(g in q.sources){var De=q.sources[g];De.max_zoom=yd(d.max,Ul.lookAt.zoom.max),De.max_display_zoom=I.max,De.min_display_zoom=I.min,(w=d.tileSize)&&(2<=o&&256<w&&d instanceof Ek&&(w/=2),De.tile_size=w)}(m=V.Ib())&&ni(q,m),$h(h,q)}}}}return $h(h.layers.skybox.draw.skybox.color,h.scene.sky),e.a.config=h,e.a.updateConfig().then(function(){var _n={},ha,ga;if(v!==e.f)return!1;e.f=0;for(ga in l){I=s[+ga];var _o=l[ga].sources;for(ha in _o)(_o=e.a.sources[ha])&&(_n[ha]=_o,_o.initialize&&I.getProvider()&&_o.initialize(I.getProvider(),e.ki,e.a.getWorkers().length,_o.tiled?B:e.a.tile_manager.getWorkerForTile(z,_o)))}for(ha in e.c)!_n[ha]&&e.c[ha].dispose&&e.c[ha].dispose();return e.c=_n,!0})}var o=e.a.pixelRatio();e.a.initialized?n():e.a.load(z,{blocking:!1}).then(n)}p.ki=function(e,r,n){var o=this,s=this.a.sources[e],l=n&&n.isReload;r?this.b[e]!==!0&&(this.b[e]||(this.b[e]={cl:{},aj:[]}),C(r,Xk)?this.b[e].cl[r.x+"/"+r.y+"/"+r.z]=!0:(r=r.boundingBox,this.b[e].aj.push(new K(r[0],r[1],r[2],r[3])))):this.b[e]=!0,s&&s.has_volatile_data?am(this,l):(x.clearTimeout(this.g),this.g=x.setTimeout(function(){return am(o,l)},100))},p.jg=function(e){var r=!1,n=this.b[e.source.name],o=x.H.gl;if(n)if(n===!0)r=!0;else{var s=o.Tile.coord(o.Geo.wrapTile(e.coords));if(r=!!n.cl[s.key],!r){var l=o.Geo.getTileBoundingBox(s,e.source.tile_size,wh.MAX_LINE_WIDTH/2);l=sg(l.getTopLeft(),l.getBottomRight()),r=n.aj.some(function(h){return h.nd(l,!0)||l.gd(h.bb(),!0)})}}return r};function am(e,r){var n=e.a.tile_manager;n.removeTiles(e.jg),n.updateTilesForView(),r&&n.removeCachedTiles(e.jg),Yl(e),e.b={}}p.qc=function(){return this.a.config};function bm(e,r,n,o){e.a.getFeatureAt(r,n,o),e.a.update()}function cm(e){return e.a.screenshot(void 0).then(function(r){return new Rb(function(n,o){new Rj(URL.createObjectURL(r.blob),function(s,l){s===1?n(l.getData()):o()},!1)})})}p.Xa=function(){return this.a.pixelRatio()},p.o=function(){var e=this.c;Vl.j.o.call(this),this.a.destroy(),this.b={},e&&Object.keys(e).forEach(function(r){e[r].dispose()}),x.clearTimeout(this.g),delete this.c,delete this.a},Vl.prototype.disposeInternal=Vl.prototype.o;var Wl={scene:{background:{color:"#FFFFFF"},sky:{zenith:"#347BC0",horizon:"#EDF2F9",fog:"#FFFFFF"}},lights:{default_light:{type:"directional",name:"default_light",visible:!0}},camera:{type:"perspective"},styles:{},fonts:{},sources:{skybox:{type:"SkyBox"}},layers:{skybox:{data:{source:"skybox"},draw:{skybox:{color:{}}}}},global:{}},nk={FEATURE:1,SOURCE:2,PROVIDER:3};t("H.map.provider.PickingMode",nk);function dm(e){return e}t("H.util.animation.ease.LINEAR",dm),t("H.util.animation.ease.EASE_IN_QUAD",function(e){return e*e});function em(e){return-e*(e-2)}t("H.util.animation.ease.EASE_OUT_QUAD",em),t("H.util.animation.ease.EASE_IN_OUT_QUINT",function(e){return e*=2,1>e?Gd(e,5)/2:(e-=2,Gd(e,5)/2+1)});function fm(e){return 1-Math.sqrt(1-e*e)}function gm(e){return Fd(2*e-e*e)}t("H.util.animation.ease.EASE_OUT_CIRC",gm);function hm(e){return 1-Math.cos(e*Math.PI/2)}function im(e){return Math.sin(e*Math.PI/2)}function jm(e,r){this.a={tilt:km(e.tilt,r.tilt),heading:km(e.heading,r.heading),zoom:r.zoom-e.zoom};var n=this.b=ng(e.position),o=r.position;e=o.lat*Ud;var s=n.lat*Ud;o=o.lng*Ud-n.lng*Ud,n=Id(o)*Kd(e),e=Kd(s)*Id(e)-Id(s)*Kd(e)*Kd(o),e=Math.atan2(n,e),this.i=(0<=e?e:Sd+e)*Vd,this.c=this.b.Wa(r.position),r=this.a.zoom,this.g=r===0?lm:Object.assign({},lm,{zoom:0>r?gm:fm,position:0>r?hm:im}),this.f=Object.assign({},{tilt:0,heading:0,zoom:0})}function km(e,r){return e=r-e,-180<e&&180>=e?e:180<e?e-360:e+360}var lm={tilt:dm,heading:dm,zoom:dm,position:dm};function mm(e,r){if(E(this.x=+e))throw new D(mm,0,e);if(E(this.y=+r))throw new D(mm,1,r)}mm.prototype.add=function(e){return new mm(this.x+e.x,this.y+e.y)},mm.prototype.a=function(e){if(!C(e,mm))throw new D(this.a,0,e);return e=this.b(e),e.x+e.y},mm.prototype.b=function(e){if(!C(e,mm))throw new D(this.b,0,e);return new mm(this.x*e.x,this.y*e.y)},mm.prototype.Oa=function(e){return new mm(this.x*e,this.y*e)};function nm(e){return Fd(e.a(e))}function om(e){e=e||jf,this.mb=vc(e.Wn)?e.Wn:3,this.U=vc(e.Un)?e.Un:300,this.u=vc(e.No)?e.No:3,this.J=vc(e.Io)?e.Io:50,this.c=[],this.clear()}t("H.map.render.InteractionUtils",om),om.prototype.tn=function(){return this.b},om.prototype.isGestureDetected=om.prototype.tn,om.prototype.start=function(e,r){var n=Nl.HEADING,o=Nl.TILT;this.s&&this.clear(),this.g=e,this.l=!!r,this.s=!0,this.b=!(e&(n|o))||e===n||e===o},om.prototype.start=om.prototype.start,om.prototype.store=function(e,r,n,o,s){var l=!1;if(this.s){if(e=new pm(e,r,n,o,s),l=e.c,this.m=this.a,this.a=e,this.f){if(this.i=!0,l){r=this.g;var h=this.b;if(!h&&this.i){s=Nl.HEADING;var d=Nl.TILT;n=Nl.COORD,o=Nl.ZOOM;var y=r&(n|d)?this.Nd(!0):qm,g=r&o?this.Cf(!0):1,v=r&s?Dd(this.bh(!0)):0,m=Dd(y.x),w=Dd(y.y);y=10<m||10<w,m=10<w&&w>3*m,g=.8>g||1.2<g,v=7<v,r&d&&(v||g||y&&!m?rm(this,d):m&&(rm(this,~d>>>0),h=!0)),!h&&r&s&&r&(n|o)&&(g||y?(rm(this,s),h=!0):v&&(rm(this,d),h=!0)),this.b=h}}}else this.f=e,l||(this.b=!0);this.l&&this.c.push(e)}return l},om.prototype.store=om.prototype.store,om.prototype.clear=function(){this.c.length=0,this.s=this.l=this.i=this.b=!1,this.f=this.m=this.a=void 0},om.prototype.clear=om.prototype.clear,om.prototype.Ac=function(e){return 0<(this.g&e)},om.prototype.isModifierEnabled=om.prototype.Ac;function rm(e,r){e.g^=e.g&r}om.prototype.sa=function(){return this.s},om.prototype.isRunning=om.prototype.sa;var qm=qc(new mm(0,0));om.prototype.rc=function(){var e;if(this.l){var r=this.c,n=r.length,o=0;for(e=new mm(0,0);--n&&o<this.u;)e=e.add(sm(r[n-1],r[n])),o++}else e=this.Nd();return r=e,n=nm(r),n!==0?new mm(r.x/n,r.y/n):r},om.prototype.getDirection=om.prototype.rc,om.prototype.zb=function(e){e=e||Lk();var r,n;if(this.l){var o=this.c,s=this.c.length,l=this.c[s-1];for(n=r=0;--s&&r<this.u;)n+=nm(sm(o[s],o[s-1])),r++;o=n/r}else l=this.a,o=nm(this.Nd());return o=o>=this.mb&&e-l.timestamp<=this.J?o>this.U?this.U:o:0},om.prototype.getSpeed=om.prototype.zb,om.prototype.Bf=function(){return this.a?tm(this.a):B},om.prototype.getBifocalCenter=om.prototype.Bf,om.prototype.Nd=function(e){return(e=e?this.f:this.m)?sm(e,this.a):new mm(0,0)},om.prototype.getMoveVector=om.prototype.Nd,om.prototype.Cf=function(e){var r=1;if(this.i){var n=this.a;e=e?this.f:this.m,(e=um(e))&&(n=um(n))&&(r=n/e)}return r},om.prototype.getBifocalScaling=om.prototype.Cf,om.prototype.bh=function(e){if(this.i){var r=e?this.f:this.m,n=this.a;e=r.b;var o=n.b,s=0;e&&o&&(r=r.a,n=n.a,s-=Nd(o.y-n.y,o.x-n.x)*Vd-Nd(e.y-r.y,e.x-r.x)*Vd),e=s}else e=0;return e},om.prototype.getBifocalRotation=om.prototype.bh;function pm(e,r,n,o,s){this.a=new J(e,r),n!==B&&(this.b=new J(n,o),this.c=!0),this.timestamp=s!==B?s:Lk()}pm.prototype.c=!1;function tm(e){var r=e.a;return(e=e.b)?new J(r.x-(r.x-e.x)/2,r.y-(r.y-e.y)/2):B}function vm(e,r){var n=e.a;return(e=e.b)&&e.Wa(r)<n.Wa(r)?e:n}function sm(e,r){var n=e.b,o=r.b;return o&&n?(r=tm(r),e=tm(e)):n?(r=r.a,e=vm(e,r)):o?(e=e.a,r=vm(r,e)):(r=r.a,e=e.a),new mm(r.x-e.x,r.y-e.y)}function um(e){var r=e.b;return r?e.a.Wa(r):0}function wm(){F.call(this),this.reset()}u(wm,F),wm.prototype.start=function(e,r){this.c&&this.reset(),E(e-r)||(this.a=+e,this.b=+r),this.c=!0},wm.prototype.reset=function(){this.c=!1,this.a=this.b=B,this.f=new xm(0,0,0,0,0,0)},wm.prototype.sa=function(){return this.c},wm.prototype.A={Cg:"animationupdate"};function ym(e){ym.j.constructor.call(this,wm.prototype.A.Cg),this.b=e}u(ym,ud),wm.prototype.set=function(e,r,n,o,s,l){var h=this.f;this.c&&(e=new xm(e/1e3,r/1e3,n/1e3,o/1e3,s/1e3,l/1e3),h.ia(e)||(this.f=e,this.dispatchEvent(new ym(zm(this)))))};function zm(e){return x.Object.create(e.f)}wm.prototype.zb=function(){return zm(this).zb()},wm.prototype.rc=function(){var e=zm(this),r=this.zb()||1;return new xm(e.a/r,e.b/r,e.c/r,e.f,e.g,e.i)},wm.prototype.o=function(){this.reset(),wm.j.o.call(this)};function xm(e,r,n,o,s,l){this.a=e,this.b=r,this.c=n,this.f=o,this.g=s,this.i=l}xm.prototype.zb=function(){return Fd(this.a*this.a+this.b*this.b+this.c*this.c)},xm.prototype.rc=function(){var e=this.zb()||1;return new xm(this.a/e,this.b/e,this.c/e,this.f,this.g,this.i)},xm.prototype.ia=function(e){var r=e===this;return!r&&(r=C(e,xm))&&(r=this.a===e.a&&this.b===e.b&&this.c===e.c&&this.f===e.f&&this.g===e.g&&this.i===e.i),r};function Am(e,r,n,o){Am.j.constructor.call(this),this.Zb=e,this.oa=o,this.a=e.appendChild(this.createElement(e.ownerDocument)),this.cf(r,n)}u(Am,qd),Am.prototype.N=function(){return this.a},Am.prototype.cf=function(e,r){this.size?(this.size.w=e,this.size.h=r):this.size=new Wi(e,r),this.Uk(this.a,this.a.style,e,r,this.oa)},Am.prototype.setSize=Am.prototype.cf,p=Am.prototype,p.yb=function(){return this.size},p.Xa=function(){return this.oa},p.Vj=!0,p.qb=function(e){e!==this.Vj&&(this.a.style.display=e?"block":"none",this.Vj=e)},p.Ih=1,p.ic=function(e){this.Ih!==e&&(this.Yj(e),this.Ih=e)},p.Tc=function(){return this.Ih},p.fe=function(e){this.a.style.zIndex=e},Am.prototype.setZIndex=Am.prototype.fe,Am.prototype.Ij=function(){return+this.a.style.zIndex},Am.prototype.Oc=function(){},Am.prototype.clear=function(){},Am.prototype.o=function(){this.clear(),this.Zb.removeChild(this.a),this.cf(0,0),delete this.a,delete this.Zb,Am.j.o.call(this)},Am.prototype.disposeInternal=Am.prototype.o,Am.prototype.f=0,Am.prototype.pg=function(){++this.f},Am.prototype.release=function(){--this.f||this.F()};function Bm(e,r,n,o,s,l){var h=s||"2d";Bm.j.constructor.apply(this,arguments),this.b=this.a.getContext(h,l),this.c=h==="2d",this.g=h,this.In=l}u(Bm,Am),p=Bm.prototype,p.createElement=function(e){e=e.createElement("canvas");var r=e.style;return r.position="absolute",r.top=r.left="0",e},p.Uk=function(e,r,n,o,s){e.width=zd(n,1),e.height=zd(o,1),r.width=Ad(n/s)+"px",r.height=Ad(o/s)+"px"},p.Yj=function(e){this.b.globalAlpha=e},p.Oc=function(e,r,n,o,s){this.c&&this.b.drawImage(e,r,n,o,s)},p.Id=function(){return this.g},p.clear=function(e){var r,n;this.c&&(e?this.b.clearRect(r=e.left,n=e.top,e.right-r,e.bottom-n):this.a.width=this.size.w)},p.o=function(){var e=this.a;e.width=e.height=0,delete this.b,Bm.j.o.call(this)},Bm.prototype.disposeInternal=Bm.prototype.o;function Cm(e){this.eb=e}u(Cm,qd),Cm.prototype.ob=function(){return this.eb},Cm.prototype.getLayer=Cm.prototype.ob,Cm.prototype.Ym=function(){return this.lb},Cm.prototype.getSurface=Cm.prototype.Ym,Cm.prototype.ad=function(e){var r=this.lb;e!==r&&(this.lb=e,e.pg(),r&&r.release())},Cm.prototype.setSurface=Cm.prototype.ad,Cm.prototype.o=function(){this.lb.release()},Cm.prototype.disposeInternal=Cm.prototype.o,Cm.prototype.Rd=function(){},Cm.prototype.render=Cm.prototype.W;function Dm(e){var r="dom";Dm.j.constructor.call(this,e),C(this.eb,Em)&&(r=e.Id()==="2d"?"2d":"webgl"),this.a=r}u(Dm,Cm),Dm.prototype.W=function(e,r,n,o,s,l,h,d){h=this.eb;var y=this.lb,g=!(C(y,Bm)&&y.Id()==="2d");return o>=h.min&&o<=h.max?(g&&y.qb(!0),h.W(y.N(),{boundingBox:e,zoom:o,screenCenter:r,priorityCenter:l,projection:n,cacheOnly:s,size:y.yb(),pixelRatio:y.Xa(),cameraMatrix:d})):(g&&y.qb(!1),wk.DONE)},Dm.prototype.Rd=function(){return this.a};function Fm(e,r,n,o,s){if(!Da(e.mi)||!Da(e.hi))throw new D(Fm,0,e);if(this.b=e,!Da(this.l=r))throw new D(Fm,1,r);if(E(this.i=+n))throw new D(Fm,2,n);if(!Da(this.g=o)&&o!=null)throw new D(Fm,3,o);if(!Da(this.c=s)&&s!=null)throw new D(Fm,4,s);this.id=new cf().next(),this.a=!1}t("H.util.animation.Animation",Fm),Fm.prototype.start=function(){var e=this;this.f=Lk(),this.a=!0;var r=this.f;this.b.mi(function(){if(e.a){var n=Lk(),o=n-e.f,s=o/e.i,l=!1;1<=s&&(s=1,l=!0),e.l(e.c?e.c(s):s,o,n-r,n),r=n,l&&e.stop()}else e.stop()})},Fm.prototype.start=Fm.prototype.start,Fm.prototype.stop=function(e){this.a=!1,this.b.hi(),e||this.g&&this.g(this)},Fm.prototype.stop=Fm.prototype.stop,Fm.prototype.sa=function(){return this.a},Fm.prototype.isRunning=Fm.prototype.sa;function Gm(e,r){Gm.j.constructor.call(this,e),this.oc=!(!r||!r.oc),this.f={}}u(Gm,Cm),Gm.prototype.ad=function(e){Gm.j.ad.call(this,e),this.l=e.Zb.ownerDocument},Gm.prototype.setSurface=Gm.prototype.ad;var Hm=(function(e,r){return r=r.ga(),C(r,gh)?r.la:(e[0]=r,e)}).bind(null,[]);Gm.prototype.W=function(e,r,n,o,s,l,h){var d=this.eb,y,g,v,m;if(this.s=r=this.f,this.f=n={},o>=d.min&&o<=d.max){var w=this.rj(e,o,s,l),I=w.markers;if(e=I.length){for(o=[],s=this.lb,l=0;l<e;l++){d=I[l];var V=Hm(d);for(y=V.length;y--;)(g=h(V[y]))&&((m=r[v=d.cb()+"_"+y])?delete r[v]:m={ik:d},n[v]=m,o.push([m,d,d.xb(),s,g.x,g.y]))}for(o.sort(Im),e=o.length,l=0;l<e;l++)this.Ek.apply(this,o[l])}}return!w||w.requested&&w.requested===w.total||!w.requested&&I.length===w.total?wk.DONE:wk.PENDING},Gm.prototype.render=Gm.prototype.W;function Im(e,r){var n=e[1].Uc(),o=r[1].Uc();return oh(n,o,!0)||e[5]-r[5]||oh(n,o,!1)}Gm.prototype.Ea=function(){},Gm.prototype.getObjectsAt=Gm.prototype.Ea;function Jm(e,r){Jm.j.constructor.apply(this,arguments),this.c=0,this.a=[],this.b=A(this.b,this)}u(Jm,Gm),t("H.map.render.dom.MarkerRenderer",Jm),Jm.prototype.rj=function(){return this.eb.Dc.apply(this.eb,arguments)},Jm.prototype.W=function(e,r,n,o,s,l,h){this.b(),this.i=0;var d=Jm.j.W.apply(this,arguments),y=this.lb,g=this.s,v;for(v in g)Km(this,y,g[v]);return this.a.length===0&&d?wk.DONE:wk.PENDING},Jm.prototype.render=Jm.prototype.W,Jm.prototype.ad=function(e){Jm.j.ad.call(this,e),this.g=e.Xa()},Jm.prototype.setSurface=Jm.prototype.ad,Jm.prototype.b=function(){for(var e=this.a.length,r,n,o;e--;)o=this.a[e],r=o.Ag,n=r.xb(),n.Vh(o,n,r);this.a.length=0},Jm.prototype.Ek=function(e,r,n,o,s,l){var h,d=o.Xa(),y=r.Kb();s*=d,l*=d,this.oc||(s=Ad(s),l=Ad(l)),e.detail&&(y.Vd(e.qn)?Km(this,o,e):h=e.detail),h||(e.detail=h=n.uj(this.l),this.c++,Da(n.Vh)&&this.a.push(h)),e.qn=y.a,h.style.zIndex=this.i++,h.Ag=r,o.Oc(h,s,l,0,0)};var Lm,Mm="pointer-events",Nm;if($e){var Om;$e&&bd!==z&&(bd=(Om=/(MSIE\s+|rv:)([^\);]+)(\)|;)/.exec(navigator.userAgent))?+Om[2]:z),Nm=bd,Nm===9?Mm="display":Nm===10&&(Mm="visibility")}Lm=Mm,Jm.prototype.Ea=function(e,r,n){var o=this.g,s=hf,l,h,d,y,g;if(this.c){e/=o,r/=o,o=this.lb.Zb.getRootNode();var v=o.documentElement,m=this.lb.N(),w=m.getBoundingClientRect();for(e+=w.left,r+=w.top;(h=d=o.elementFromPoint(e,r))&&h!==m&&h!==v&&h!==o.host&&d!==I;){for(;(y=h.parentNode)&&(!Da(y.contains)||!y.contains(m));)h=y;if(y===m&&(h!==d||h.nodeName!=="svg")&&0>s.indexOf(g=h.Ag)&&(s===hf&&(s=[]),s.push(g),n))break;l||(l=[]);var I=h.style;l.push({fj:I.getPropertyValue(Lm),pn:I.getPropertyPriority(Lm),style:I}),I.setProperty(Lm,Lm==="visibility"?"hidden":"none","important"),I=d}if(l)for(r=l.length;r--;)e=l[r],e.style.removeProperty(Lm),Cc(e.fj)&&e.style.setProperty(Lm,e.fj,e.pn)}return s},Jm.prototype.getObjectsAt=Jm.prototype.Ea,Jm.prototype.Rd=function(){return"dom"};function Km(e,r,n){r.clear(r=n.detail),delete r.Ag,e.c--,n=(e=n.ik).xb(),n.b&&n.b(r,n,e)}Jm.prototype.o=function(){this.a.length=0;var e=this.lb,r=this.f,n;for(n in r)Km(this,e,r[n]);this.lb.F(),Jm.j.o.call(this)},Jm.prototype.disposeInternal=Jm.prototype.o;function Em(e,r){var n=r||{},o=n.contextType;if(n=n.contextAttributes,Em.j.constructor.call(this,r),zc(e,"Function",Em,0,"invalid render callback"),o){if(Pm.indexOf(o)===-1)throw new D(Em,1,"invalid context type");this.b=o}n&&(this.c=n),this.f=e}u(Em,qj),t("H.map.layer.CanvasLayer",Em);var Pm=["2d","webgl","webgl2","experimental-webgl"];Em.prototype.b="2d",Em.prototype.Id=function(){return this.b},Em.prototype.W=function(e,r){return this.a&&this.a.canvas===e||(this.a=e.getContext(this.b,this.c)),this.f(this.a,r)},Em.prototype.o=function(){Em.j.o.call(this),delete this.a};function Qm(e,r){Qm.j.constructor.call(this,r),zc(e,"Function",Qm,0,"invalid render callback"),this.a=e}u(Qm,qj),t("H.map.layer.DomLayer",Qm),Qm.prototype.W=function(e,r){return this.a(e,r)};function Rm(e,r){if(E(this.b=+e))throw new D(Rm,0,e);this.a=0,r&&this.Qk(r)}t("H.util.kinetics.KineticMove",Rm),Rm.prototype.Qk=function(e){return this.a=e,this},Rm.prototype.setInitialSpeed=Rm.prototype.Qk,Rm.prototype.am=function(){return Math.abs(this.a/this.b)},Rm.prototype.getDuration=Rm.prototype.am,Rm.prototype.De=function(e){return this.a+this.b*e},Rm.prototype.getCurrentSpeed=Rm.prototype.De,Rm.prototype.Wl=function(e){return this.a*e+this.b*e*e/2},Rm.prototype.getCurrentPath=Rm.prototype.Wl;function Sm(e,r,n,o){Sm.j.constructor.apply(this,arguments)}u(Sm,Am),t("H.map.render.dom.Surface",Sm),p=Sm.prototype,p.Id=function(){return"dom"},p.createElement=function(e){return e=e.createElement("DIV"),e.style.position="absolute",e.style.pointerEvents="none",e},p.Uk=function(e,r,n,o){r.width=n+"px",r.height=o+"px"},p.Yj=function(e){this.a.style.opacity=e},p.Oc=function(e,r,n){var o=this.oa,s=e.style;s[Af("transform")]="matrix(1,0,0,1,"+r/o+","+n/o+")",e.parentNode!==this.a&&(s.position="absolute",this.a.appendChild(e),this.a.style.pointerEvents="auto",getComputedStyle(e).pointerEvents==="auto"&&(e.style.pointerEvents="all"),this.a.style.pointerEvents="none")},p.clear=function(e){e?this.a.removeChild(e):this.a.innerHTML=""};function Tm(e,r){this.a=e,this.b=r}function Um(e,r,n){var o=[],s={Zb:e.a,width:r.w,height:r.h,oa:e.b};for(e=0;e<n.length;e++){r=n[e];var l=r.Rd(),h={};Ya(h,s);var d=r.lb;switch(l){case"2d":if(C(r.ob(),Em)&&(h.Rg=r.ob().c),l=v&&v.Id()==="2d"){l=h.Rg;var y=v.In;l=y===l?!0:y&&!l?!y.alpha&&!y.willReadFrequently:l&&!y?!l.alpha&&!l.willReadFrequently:!l.alpha==!l.alpha&&!y.willReadFrequently==!l.willReadFrequently}if(l)var g=!1;else if(d&&!g){var v=d;g=!1}else v=new Bm(h.Zb,h.width,h.height,h.oa,"2d",h.Rg),g=!0;break;case"dom":v=d||new Sm(h.Zb,h.width,h.height,h.oa),g=!d;break;default:v=d||new Bm(h.Zb,h.width,h.height,h.oa,r.ob().Id(),h.Rg),g=!d}o[o.length-1]!==v&&(v.fe(o.length),o.push(v)),r.ad(v)}return o}function Ll(){Ll.j.constructor.call(this),this.b={},this.a={position:new kg(0,0),zoom:0,heading:180,incline:0,tilt:0,bounds:new O(ch([90,-180,90,0,90,180,-90,180,-90,-180]))}}u(Ll,F),t("H.map.ViewModel",Ll),Ll.prototype.A={za:"update",le:"sync"},Ll.prototype.Wb=function(e,r){if(!e)throw new D(this.Wb,0,e);var n=e[Vm];if(vc(n)&&!lg(n))throw new D(this.Wb,0,Vm);if(n=e[Wm],vc(n)&&E(+n))throw new D(this.Wb,0,Wm);if(n=e[Xm],vc(n)&&!C(n,jg))throw new D(this.Wb,0,Xm);return e=x.Object.assign({},e),n=Ym(e,this.b,this.a),Zm(this,this.b,e),this.dispatchEvent(new $m(this.b,n,r)),this},Ll.prototype.setLookAtData=Ll.prototype.Wb,Ll.prototype.jb=function(){var e={};return e[Vm]=ng(this.a[Vm]),Zm(this,e,this.a,!0),e},Ll.prototype.getLookAtData=Ll.prototype.jb;var Vm="position",Wm="zoom",Xm="bounds",an={Ui:Vm,Xi:Wm,Oi:"heading",Wi:"tilt",Pi:"incline",Mi:Xm},bn=Object.keys(an).map(function(e){return an[e]});function Zm(e,r,n,o){e.g={},e.f={},e.c=[];for(var s=e.l,l=e.i,h=bn.length,d,y,g;h--;)if(d=bn[h],g=n[d],y=r[d],y==null||!o)if(g!=null){vc(s)&&s.call(e,d,y,g);var v=d,m;if((m=d!=="position")||(m=g,m=!(!m||E(m.lat)||E(m.lng))),r[v]=m?g:ng(g),vc(l)){switch(d){case"position":y=g&&y&&(g.lat!==y.lat||g.lng!==y.lng);break;case"bounds":y=g&&y&&!g.ia(y);break;default:y=g!==y}y&&l.call(e,d)}}else delete r[d]}Ll.prototype.l=function(e,r,n){this.g[e]=r,this.f[e]=n},Ll.prototype.i=function(e){this.c.push(cn[e])};var cn=bn.reduce(function(e,r){return e[r]=ej[r.toUpperCase()],e},{});function Ym(e,r,n){var o=0;return["tilt","incline","heading",Wm].forEach(function(s){if(E(e[s])){var l=E(r[s])?n[s]:r[s];e[s]=l}else o|=cn[s]}),[Vm,Xm].forEach(function(s){e[s]?o|=cn[s]:e[s]=r[s]||n[s]}),o}Ll.prototype.$a=function(e){var r={},n={};Zm(this,this.a,e),this.b={},r.lookAt=this.f,n.lookAt=this.g,e=this.c,e=e.length?e.reduce(dn):0,this.dispatchEvent(new dj(this.A.le,r,n,e))},Ll.prototype.synchronize=Ll.prototype.$a;function dn(e,r){return e|r}Ll.prototype.df=function(e,r){if(E(e=+e))throw new D(this.df,0,Wm);this.Wb({zoom:e},r)},Ll.prototype.pb=function(){return this.a.zoom},Ll.prototype.kc=Qc,Ll.prototype.startControl=Ll.prototype.kc,Ll.prototype.control=Qc,Ll.prototype.control=Ll.prototype.control,Ll.prototype.vb=Qc,Ll.prototype.endControl=Ll.prototype.vb;function $m(e,r,n){$m.j.constructor.call(this,Ll.prototype.A.za,e,null,r),this.b=this.animate=Fc(n)&&0<n&&1/0>n?n:!!n}u($m,dj);function T(e,r,n,o){if(T.j.constructor.call(this,e,r,n,o),this.qa=new Rk(100),this.R=new J(0,0),this.Af=!!o.enableSubpixelRendering,this.ab=en,this.m=new om,this.g=o=new wm,this.sb=A(this.sb,this),o.addEventListener(o.A.Cg,this.sb),o=e.element,this.L=e=o.ownerDocument.createElement("div"),e.style.position="absolute",e.style.width=e.style.height="100%",e.style.zIndex=0,o.insertBefore(e,o.firstChild),this.Ad=new Tm(this.L,this.oa),this.ta=r.jb().position,r=x.H.gl,!r)throw new $c(T,'"H-webgl" module is missing');for(this.a=new Vl({viewport:this.f,Zb:this.L,devicePixelRatio:this.oa,qk:A(this.ha,this)}),r.WorkerBroker.addTarget("model",sj),r=this.c.La(),e=0,o=r.length,this.l={Nc:[],ja:[]},this.xa=r;e<o;e++){var s=r[e];this.Pe(e,s),Ol(this,s,!0)}this.Eb(),this.fd=A(this.fd,this),this.Kh=A(this.Kh,this),this.Da=A(this.Da,this),n.addEventListener(qj.prototype.A.ie,this.fd),this.C=fn,this.zoom=Pl(this,this.J.pb()),this.Eb(),this.T()}u(T,Jl),t("H.map.render.webgl.RenderEngine",T),T.prototype.jb=function(){var e=this.ta;return Ql(this,{position:{An:e.An,Fn:e.Fn},zoom:this.zoom,tilt:this.dl,heading:this.heading})},T.prototype.fd=function(e){e=(e=e.target.ca())&&e.Ya(),(e&&e.getState())===Xh.INIT?e.load():(Yl(this.a),$l(this.a,this.c),this.ha())},T.prototype.type=Tl.WEBGL;var fn=2;T.prototype.getState=function(){return this.C},T.prototype.getState=T.prototype.getState;function gn(e,r,n){return r=n-r,e=Gd(2,8+e.zoom),r<e/2?r:r-e*n/Dd(n)}function hn(e,r,n){function o(d){return s[d]+km(s[d],r[d])/2}if(!(n&ej.POSITION||n&ej.BOUNDS))return null;var s=Zl(e.a).getLookAtData();n=s.position;var l=r.position,h=r.bounds;return Fi(s.bounds,l.lat,l.lng,!1)||h&&Fi(h,n.lat,n.lng,!1)?null:(n=jn(e,{tilt:o("tilt"),heading:o("heading"),incline:0,bounds:tg([n,l])}),n.zoom=Pl(e,n.zoom-.5),delete n.bounds,n)}T.prototype.dd=!1;function kn(e,r,n,o){return e=e.getCapabilities().lookAt[o],e=e.max-e.min,Dd(o==="zoom"?n[o]-r[o]:km(r[o],n[o]))/e||0}function ln(e,r,n){return e=zd(8*kn(e,r,n,"zoom"),kn(e,r,n,"heading"),kn(e,r,n,"tilt")/2),ae(3e3*e,300,4e3)}T.prototype.Kg=function(e){var r=this,n=e.newValue,o=e.modifiers,s=Zl(this.a);mn(this),this.R.set(0,0);var l=nn(this,n);if(bn.forEach(function(v){o&e[v.toUpperCase()]||delete l[v]}),e.b){s=Zl(this.a).getLookAtData();var h=jn(this,l);n=hn(this,h,o);var d=1;Fc(e.b)&&(d=1/e.b);var y=function(){return r.dd=!1};if(delete h.bounds,this.dd=!0,n){s=ln(this,s,n);var g=ln(this,n,h);on(this,n,s*d,function(){return on(r,h,g*d,y)})}else n=ln(this,s,h),on(this,h,n*d,y)}else pn(l),s.setLookAtData(l);qn(this),Yl(this.a),this.ha()};function jn(e,r){return pn(r),Zl(e.a).getBestLookAtData(r)}function pn(e){var r=e.bounds;!r||r instanceof O||(e.bounds=Ci(r.K()))}function rn(e,r,n){Zl(e.a).setLookAtData(r),Yl(e.a),qn(e),e.ha(),n&&setTimeout(n,0)}function on(e,r,n,o){var s=Zl(e.a).getLookAtData(),l=new jm(s,r);l.a.tilt+l.a.heading+l.a.zoom+l.c!==0?sn(e,function(h){for(var d in l.a)if(l.a[d]!==0){var y=l.g[d](h);s[d]+=l.a[d]*(y-l.f[d]),l.f[d]=y}return l.c!==0&&(s.position=l.b.zg(l.i,l.c*l.g.position(h),!0)),rn(e,s)},n,function(){return rn(e,r,o)}):rn(e,r,o)}T.prototype.rg=function(){},T.prototype.setAnimationDuration=T.prototype.rg,T.prototype.$g=function(){},T.prototype.getAnimationDuration=T.prototype.$g,T.prototype.sg=function(){},T.prototype.setAnimationEase=T.prototype.sg,T.prototype.ah=function(){},T.prototype.getAnimationEase=T.prototype.ah,T.prototype.ng=function(){},T.prototype.resetAnimationDefaults=T.prototype.ng;function tn(e,r){e.qa.na(function(n,o){return o.Mb()===r})}p=T.prototype,p.nk=function(e){tn(this,e.target.ca()),Yl(this.a),this.ha()},p.Pe=function(e,r){T.j.Pe.call(this,e,r),un(r)&&(Yl(this.a),(e=(e=r.ca())&&e.Ya())&&e.getState()===Xh.INIT&&e.load())},p.Xh=function(e,r,n){var o;if(this.ve=Lk(),tn(this,r.ca()),r.requestDomMarkers||C(r,Em)||C(r,Qm)){var s=this.l.ja;for(o=s.length;o--;){var l=s[o];if(l.ob()===r){s.splice(o,1),l.F();break}}}un(r)&&$l(this.a,this.c),this.xa=this.c.La(),e===0&&(Ol(this,r,!1),this.Eb()),Um(this.Ad,vn(this),this.l.ja.filter(vc)),this.ce(),n||this.ha()};function un(e){return!(C(e,Qm)||C(e,Em))}p.Yh=function(){this.Eb()},p.Eb=function(){T.j.Eb.call(this);var e=this.getCapabilities().lookAt.zoom;Zl(this.a).setZoomConstraints(zd(e.min,this.Eg),yd(e.max,this.Dg))},p.th=function(e,r){var n;if(r){if(e={oc:this.Af,fb:this.fb},r.W?C(r,Em)?n=new Dm(r):C(r,Qm)&&(n=new Dm(r)):r.requestDomMarkers&&(n=new Jm(r,e)),n){this.l.ja.push(n);var o=this.c.La();this.l.ja.sort(function(s,l){return o.indexOf(s.eb)-o.indexOf(l.eb)}),Um(this.Ad,vn(this),this.l.ja.filter(vc))}un(r)&&$l(this.a,this.c)}this.xa=this.c.La()};function nn(e,r){var n=r.position;return Ql(e,{zoom:Pl(e,r.zoom),position:new kg(n.lat,n.lng),tilt:r.tilt,heading:r.heading,bounds:r.bounds})}function qn(e){var r=Zl(e.a).getLookAtData();e.zoom=r.zoom,e.ta=r.position}function wn(e,r){return e=Zl(e.a).geoToMeters(r),new J(e.x/4007501668557849e-8+.5,1-(e.y/4007501668557849e-8+.5))}function xn(e,r){return r.sub(wn(e,e.ta)).scale(Gd(2,8+e.zoom))}p.Da=function(e){return Zl(this.a).geoToPixel(e)},T.prototype.geoToScreen=T.prototype.Da,T.prototype.Pa=function(e,r){return Zl(this.a).xyToGeo(e,r)},T.prototype.screenToGeo=T.prototype.Pa,T.prototype.qg=function(e,r){return e=this.Pa(e,r),r=this.J.jb(),r.position=e,r};function yn(e,r,n,o,s,l,h,d){var y,g,v=0,m,w=function(){--v===0&&l(s)};if(d&&d.features)for(v=g=d.features.length,m=0;m<g;m++){var I=d.features[m],V=I.id;if(y=e.a.a.sources[I.source_name]){var q=y.provider,De=q.Ej();if(De===nk.SOURCE){var _n=I.source_layer;if(_n==="overlays")zn(e,r,n,o,s,y,I.properties.overlays_config);else if(y=y.getMapObjectById(V)){if(_n!=="markers")s.push(y);else if(An(e,r,n,y))s.push(y);else if(o&&!h){var ha=!0;bm(e.a,{x:r,y:n},{radius:3.5,top_most_only:!1},function(ga){yn(e,r,n,o,s,l,!0,ga)})}}v--}else De===nk.FEATURE?(_n=I.tile.coords,ha=q.getFeatureProxy(I.properties,_n,function(ga){ga&&(ga.Tk(q),s.push(ga)),w()}),ha||(y=e.qa.get(V),y||(y=new lh(I),y.ka(q),e.qa.add(V,y,1)),s.push(y),v--)):De===nk.PROVIDER&&(ha=!0,q.Fk(I,!1).then(function(ga){ga&&(!(ga instanceof rh)||An(this,r,n,ga))&&s.push(ga),w()},function(){w()},e))}}De&&(ha||v!==0)||l(s)}function zn(e,r,n,o,s,l,h){var d;for(e=e.Pa(r,n),r=h.length;r--&&(!(d=l.getMapObjectById(h[r].id))||0<=s.indexOf(d)||!d.ga().gd(e)||(s.push(d),!o)););}function An(e,r,n,o){var s=o.xb(),l=s.c,h,d=!l;if(l)if(s=s.kd(),r+=s.x,n+=s.y,s=o.ga(),C(s,Vi))for(o=s.la,h=o.length;h--&&!d;)s=e.Da(o[h]),d=l.Of(r-s.x,n-s.y,0)!==de.NONE;else s=e.Da(s),d=l.Of(r-s.x,n-s.y,0)!==de.NONE;return d}T.prototype.Ea=function(e,r,n,o){var s=this,l=[];l=Bn(l,this.l.ja,e*this.oa,r*this.oa,n),n&&l.length?o(l):this.a.a.initialized?bm(this.a,{x:e,y:r},{radius:3.5,top_most_only:n},function(h){yn(s,e,r,n,l,o,!1,h)}):o(l)},T.prototype.getObjectsAt=T.prototype.Ea;function Bn(e,r,n,o,s){for(var l=r.length,h;l--&&!((h=r[l])&&h.Ea&&(e=e.concat(h.Ea(n,o,s)),e.length&&s)););return e}T.prototype.aa=z;function vn(e){return e=e.wa[2],{w:e.right-e.left,h:e.bottom-e.top}}T.prototype.T=function(){var e=this.l.ja.length;Kl(this,this.oa),this.R.set(0,0);var r=vn(this),n=r.w,o=r.h;for(this.a.a.handleViewportUpdate();e--;){r=this.l.ja[e].lb;var s=r.yb();s.w===n&&s.h===o||r.cf(n,o)}this.aa=new Wi(n,o),Yl(this.a),this.ha()},T.prototype.getCapabilities=function(){return Ul},T.prototype.getCapabilities=T.prototype.getCapabilities;function Cn(e){e.i&&e.i.sa()||(Xl(e.a)||Lk()-e.ve<e.ab)&&!e.ea?e.Vf||(e.Vf=Jk(e.Kh)):(e.ea&&(e.ce(),Dn(e)),e.C=fn)}p=T.prototype,p.Vf=0,p.ce=function(){this.l.Nc.length=0},p.Kh=function(){this.Vf=0,this.D&&this.D.before();var e=Zl(this.a),r=e.getLookAtData(!1),n=e.getLookAtData(!0);e=this.f.center.clone(),n=n.bounds.K();var o=this.zoom,s=this.R,l=this.xa,h=l.length;for(this.ab=en;h--;){var d=l[h];C(d,qj)&&d.ca()&&d.ca().Ue(n,o)}this.ea=this.a.W(),this.J.$a(r),r=this.l,l=r.ja.length;var y=!0,g;for(g=0;g<l;g++){h=r.ja[g];var v=r.Nc;h&&(d=h.W(n,e,void 0,o,!1,s,this.Da,this.a.a.getCameraMatrix()),d===wk.ACTIVE&&(this.ab=1/0),d!==wk.DONE||v[g]||(Dn(this,h.ob()),v[g]=!0),v[g]||(y=!1))}this.ea=y&&this.ea,this.aa&&(this.f.$a(this.aa),this.aa=z),this.i&&this.i.sa()&&this.me(),this.D&&this.D.after(),Cn(this)};function Dn(e,r){e.dd||setTimeout(A(e.dispatchEvent,e,{type:e.A.Vi,target:r||e}),1)}p.o=function(){var e=this.c.La()[0],r=this.f;Kk(this.Vf),En(this),e&&Ol(this,e,!1),this.l.ja.filter(vc).forEach(function(n){n.F()}),r.element&&r.element.removeChild(this.L),delete this.L,this.C=3,this.a.F(),T.j.o.call(this)},p.ha=function(){this.ve=Lk(),this.C===fn&&(this.ea=!1,this.C=1,Cn(this))};function Fn(e,r,n){Zl(e.a).applyPxOffset([r,n]),qn(e),e.R.set(0,0),Yl(e.a),e.ha()}p.xd=function(e,r,n){e=Pl(this,Pl(this,e)),Gn(this,e,r,n)},T.prototype.zoomAt=T.prototype.xd;function Gn(e,r,n,o){Zl(e.a).setLookAtData({zoom:r},Fc(n)&&Fc(n)?[n,o]:B),qn(e),Yl(e.a),e.ha()}function mn(e){En(e),e.g.sa()&&e.vb(!0),e.m.sa()&&e.wb(!0)}function Hn(e,r){if(r){var n={};n.Te=r.power,n.we=r.ease,n.duration=r.duration,e.u=n}}T.prototype.lc=function(e,r){var n=!!(r||e&(Nl.HEADING|Nl.TILT));mn(this),Hn(this,r),this.m.start(e,n),Zl(this.a).setPanning(!0)},T.prototype.startInteraction=T.prototype.lc,T.prototype.cc=function(e,r,n,o,s){var l=this.m,h=!1;if(l.sa()){var d=Zl(this.a),y=d.getLookAtData(),g=this.f.center;g=[g.x,g.y],r=l.store(e,r,n,o,s),n=l.Bf(),e=l.Nd(),s=this.m.Cf(),o=this.m.bh(),l.b&&(l.Ac(Nl.TILT)&&(d.setLookAtData({tilt:Rl(this,y.tilt+e.y/this.f.height*-180)},g),h=!0),r&&s!==1&&l.Ac(Nl.ZOOM)&&(h=l.Bf(),s=Ed(Gd(2,this.zoom)*s)/Od,Gn(this,Pl(this,s),h.x,h.y),h=!0),l.Ac(Nl.COORD)&&0<nm(e)&&(Fn(this,-e.x,-e.y),h=!0),l.Ac(Nl.HEADING)&&(r?d.setLookAtData({heading:y.heading+Sl(this,o)},[n.x,n.y]):e.x&&d.setLookAtData({heading:Sl(this,y.heading+e.x/this.f.width*360)},g),h=!0),h&&(Yl(this.a),this.ha()))}},T.prototype.interaction=T.prototype.cc,T.prototype.wb=function(e){var r=this;if(this.m.sa()&&!e){if(this.u){e=this.m.zb();var n=this.m.rc(),o=this.u.duration,s=(this.u.Te||1)*e,l=new Rm(-s/(0<o?o:1),s);!E(n.x)&&!E(n.y)&&0<s&&r.m.Ac(Nl.COORD)&&sn(this,function(h){s=l.De(h*o),E(s)||Fn(r,Ad(-n.x*s),Ad(-n.y*s))},o,void 0,this.u.we)}delete this.u,this.m.clear()}Zl(this.a).setPanning(!1),this.ha()},T.prototype.endInteraction=T.prototype.wb,T.prototype.kc=function(e,r,n){mn(this),this.g.start(r,n),Hn(this,e),Zl(this.a).setPanning(!0)},T.prototype.startControl=T.prototype.kc,T.prototype.control=function(e,r,n,o,s,l){for(var h=0,d;h<arguments.length;h++)if(d=+arguments[h],d!==d)throw new D(this.control,h,d);this.g.sa()&&this.g.set(e,r,n,o,s,l)},T.prototype.control=T.prototype.control,T.prototype.vb=function(e,r){var n=this,o;if(this.g.sa()){En(this);var s=Lk(),l=s-this.Ed;if(1<=l){var h=zm(this.g);In(this,h,l)}if(!this.u||e||r)typeof r=="function"&&(e=Zl(this.a),e=e.getLookAtData(),r(e),Jn(this,e));else{r=this.g.zb();var d=this.g.rc(),y=this.u.duration,g=(this.u.Te||1)*r,v=new Rm(-g/(0<y?y:1),g);!E(d.a)&&!E(d.b)&&0<g&&sn(this,function(m,w,I,V){s&&(I=V-s,s=0),g=v.De(m*y)*I,E(g)||((o=d.c*g)&&Gn(n,Pl(n,n.zoom+o),n.g.a,n.g.b),Fn(n,Ad(d.a*g),Ad(d.b*g)))},y,void 0,this.u.we)}this.g.reset(),Zl(this.a).setPanning(!1),this.ha()}},T.prototype.endControl=T.prototype.vb;function Jn(e,r){var n=xn(e,wn(e,r.position)),o=n.y;n=n.x;var s=r.zoom,l=xn(e,wn(e,e.ta));r=l.y;var h=l.x;l=e.zoom;var d=e.g.zb(),y=e.g.a,g=e.g.b,v=0;if(n=gn(e,h,n),n-=h,o-=r,l=s-l,r=Fd(n*n+o*o+l*l),d!==0&&r!==0){var m=n/r,w=o/r,I=l/r,V=d*d/(2*r);sn(e,function(q,De){var _n;q!==1?(q=d*De-V*De*De/2,De=q-v,(_n=I*De)&&(_n=Pl(e,e.zoom+_n),Gn(e,_n,y,g)),Fn(e,Ad(m*De),Ad(w*De)),v=q):(Gn(e,Pl(e,s),y,g),e.ha())},2*r/d)}}T.prototype.sb=function(e){var r=this,n=e.b;this.R.set(0,0),n.a||n.b||n.c||n.f||n.g||n.i?(this.Ed=Lk(),sn(this,function(o,s,l,h){r.Ed=h,In(r,n,l)},Wd),this.ha()):En(this)};function In(e,r,n){n=n||0;var o=e.g,s=Zl(e.a),l=s.getLookAtData();r.c&&Gn(e,Pl(e,l.zoom+r.c*n),o.a,o.b),s.setLookAtData({heading:Sl(e,l.heading+r.g*n),tilt:Rl(e,l.tilt+r.f*n)}),qn(e),Fn(e,r.a*n,r.b*n)}function sn(e,r,n,o,s){e.i&&e.i.sa()&&e.i.stop(!0),e.i=new Fm(e,r,n,o,s),e.i.start()}function En(e){e.i&&e.i.sa()&&e.i.stop(!0)}T.prototype.Wg=function(){},T.prototype.enter=T.prototype.Wg,T.prototype.Xg=function(e){Ml(this.L,e)},T.prototype.exit=T.prototype.Xg,T.prototype.capture=function(e,r,n,o){var s=this;return cm(s.a).then(function(l){var h=s.L.ownerDocument.createElement("canvas"),d=s.oa,y=h.getContext("2d"),g=s.a.Xa()/d,v=(n-e)*d;return d*=o-r,h.width=v,h.height=d,y.drawImage(l,e*g,r*g,v*g,d*g,0,0,v,d),h})},T.prototype.Il=function(e){return Zl(this.a).geoToMeters(e)},T.prototype.geoToMeters=T.prototype.Il,T.prototype.Vn=function(e){return Zl(this.a).metersToGeo(e)},T.prototype.metersToGeo=T.prototype.Vn;var en=5e3;function U(e,r,n){var o={};if(!(e instanceof HTMLElement))throw new D(U,0);if(U.j.constructor.call(this),this.i=Kn(n,U),this.c=n=new Ll,this.D=!1,n.addEventListener(n.A.le,this.R,!1,this),!C(e,Element))throw new D(U,0,e);n=this.S=e.ownerDocument.createElement("div");var s=n.style;if(s.position="relative",s.height=n.style.width="100%",s.overflow="hidden",s.webkitTapHighlightColor="transparent",s.webkitTapHighlightColor!=="transparent"&&(s.webkitTapHighlightColor="rgba(0,0,0,0)"),e.appendChild(n),this.b=new xk(this.S,this.i),this.b.addEventListener(this.b.A.le,this.R,!1,this),e=this.a=new sj(this.i.layers),e.addEventListener(e.A.ke,this.P,!1,this),e.addEventListener(e.A.he,this.P,!1,this),e.addEventListener(e.A.je,this.P,!1,this),!this.l&&Ln(this),this.g=null,this.a.add(r,0),this.f=this.u(this.i.engineType!=null?this.i.engineType:jk,this.i),this.J=A(this.J,this),r=this.i.imprint,r!==B&&typeof r!="object")throw new D(U,1,"imprint");Mn&&(r||(r={}),r.mark=r.mark||"GS (2022) 5659"),this.s=r===null?r:new Bj(this,r),r=this.i.autoColor,this.L=r===B||!!r,Nn(this),(r=this.i.zoom)&&(o.zoom=r),(r=this.i.bounds)&&(o.bounds=r),(r=this.i.center)&&(o.position=r),this.c.Wb(o)}u(U,F),t("H.Map",U),U.prototype.draggable=!1;function Kn(e,r){if(e){var n=e.pixelRatio;if(n===B)e.pixelRatio=Ue();else if(!(0<n))throw new D(r,0,"pixelRatio: "+n)}else e={},e.pixelRatio=Ue();return e.renderBaseBackground||(e.renderBaseBackground={lower:3,higher:2}),e}U.prototype.o=function(){this.L=!1,this.s&&this.s.F(),this.f.dispose(),this.c.F(),this.b.F(),this.l.F(),this.m.F(),this.a.F();var e=this.S;e.parentNode.removeChild(e),delete this.S,F.prototype.o.call(this)},U.prototype.N=function(){return this.S},U.prototype.getElement=U.prototype.N,U.prototype.Xa=function(){return this.i.pixelRatio},U.prototype.getPixelRatio=U.prototype.Xa;function Nn(e){e.s&&e.L&&e.s.vi({invert:e.g&&e.g.yl})}U.prototype.P=function(e){var r=e.added,n=e.removed;r&&r.ca()&&r.ca().ka(this),n&&n.ca()&&n.ca().ka(null),n===this.l&&(delete this.l,delete this.m),n===this.g&&(this.g=null),e.idx===0&&(this.dispatchEvent(new cj(this.A.lf,this.g=e.type!==this.a.A.je?r:0<this.a.a.length?this.a.get(0):z,e.type!==this.a.A.he?n:1<this.a.a.length?this.a.get(1):z)),Nn(this))},U.prototype.R=function(e){e.modifiers&&(this.D||(On(this,"start"),this.D=!0),On(this,"",e),this.T&&x.clearTimeout(this.T),this.T=x.setTimeout(this.J,333))};function On(e,r,n){e.dispatchEvent(n?new dj(e.A.Qi,n.newValue,n.oldValue,n.modifiers):e.A.Qi+r)}U.prototype.J=function(){On(this,"end"),this.D=!1},U.prototype.tg=function(e,r){return this.f.getCapabilities().lookAt&&this.c.Wb({position:e},!!r),this},U.prototype.setCenter=U.prototype.tg,U.prototype.bb=function(){var e=this.c.jb();return e?e.position:z},U.prototype.getCenter=U.prototype.bb,U.prototype.df=function(e,r){return this.c.df(e,!!r),this},U.prototype.setZoom=U.prototype.df,U.prototype.pb=function(){return this.c.pb()},U.prototype.getZoom=U.prototype.pb,U.prototype.xd=function(e,r,n){this.f.zoomAt(e,r,n)},U.prototype.zoomAt=U.prototype.xd,U.prototype.hn=function(){return this.b},U.prototype.getViewPort=U.prototype.hn,U.prototype.gn=function(){return this.c},U.prototype.getViewModel=U.prototype.gn,U.prototype.wm=function(){return this.a},U.prototype.getLayers=U.prototype.wm,U.prototype.qm=function(){return this.s},U.prototype.getImprint=U.prototype.qm,U.prototype.capture=function(e,r,n,o,s,l){function h(ha,ga){w?ha.cancel():(q.save(),ga.capture(V,v,function(_o){q.restore(),ha.done(_o)},function(_o){ha.done(null,_o),d(null)}))}function d(ha){w||(w=!0,e(ha))}var y=this.f,g=y.getCapabilities(),v=this.i.pixelRatio,m=this.b,w=!1,I=this,V,q;if(!Da(e))throw new D(this.capture,0,e);n=n||0,o=o||0,s=s||m.width,l=l||m.height;var De=zd(0,yd(n,s)),_n=zd(0,yd(o,l));n=yd(m.width,zd(n,s)),o=yd(m.height,zd(o,l)),g.capture?y.capture(De,_n,n,o).then(function(ha){var ga=I.s,_o=r||[];V=ha,q=V.getContext("2d"),V.style.width=V.width/v+"px",V.style.height=V.height/v+"px";var _l=new Mk(10,h);_o=_o.concat(ga).filter(function(wc){return Da(wc&&wc.capture)}),_o.length?(ha=_o.pop(),_o.forEach(function(wc){_l.push(wc,ld)}),_l.push(ha,A(d,I,V)),Fk(_l)):d(V)},function(){d(z)}):e(null)},U.prototype.capture=U.prototype.capture,U.prototype.cm=function(){return this.f},U.prototype.getEngine=U.prototype.cm,U.prototype.u=function(e,r){if(r=r?Kn(r,this.u):this.i,Nn(this),e===kk.P2D)return new x.H.map.render.p2d.RenderEngine(this.b,this.c,this.a,r);if(e===kk.WEBGL)return new T(this.b,this.c,this.a,r);if(e===kk.HARP)return new x.H.map.render.harp.RenderEngine(this.b,this.c,this.a,r);throw new D(this.u,0,e)},U.prototype.gf=function(e,r,n,o,s){if(r=vc(r)?C(r,K,this.gf,1,r)&&r:this.c.jb().bounds.K(),s=s||this.g,!C(s,pl))throw new D(this.gf,4);var l=s.ca(),h=this.Xa(),d=s.tileSize;if(2<=h&&256<d&&l instanceof Ek&&(d/=2),h=this.pb(),d=Math.log2(d)-8,n=vc(n)?+n:h,o=vc(o)?+o:h,!(n<=o))throw new D(this.gf,B,"!(min <= max)");h=l.min;var y=l.max,g=this.f.type===kk.WEBGL?Bd:Ad;if(n=ae(g(n)-d,h,y),o=ae(g(o)-d,h,y),!(l&&C(l,S)&&od()&&l.l()))throw new $c(this.gf,"Storing is not supported");return new Ak(s,l,r,n,o,e)},U.prototype.storeContent=U.prototype.gf;function Pn(e){xj.call(this,e)}u(Pn,xj),Pn.prototype.f=function(){zj(this,2)},Pn.prototype.c=function(){zj(this,4)},U.prototype.xl=function(e){return e=new Pn(e),nd().clear(A(e.f,e),A(e.c,e)),e},U.prototype.clearContent=U.prototype.xl,U.prototype.nf=function(e,r){var n=this.a,o=n.indexOf(e),s=r!==+r;return r=s?n.a.length-1:r,0>o?n.add(e,r):o-r&&(n.hc(o),n.add(e,s?r-1:r)),this},U.prototype.addLayer=U.prototype.nf,U.prototype.ae=function(e){var r=this.a.indexOf(e);return e!==this.g&&e!==this.l&&r!==-1&&this.a.hc(r),this},U.prototype.removeLayer=U.prototype.ae,U.prototype.ud=function(e){return this.g!==e&&(this.a.a.length&&this.a.get(0)!==this.l?this.a.set(0,e):this.a.add(e,0),this.g=e),this},U.prototype.setBaseLayer=U.prototype.ud,U.prototype.Ol=function(){return this.g},U.prototype.getBaseLayer=U.prototype.Ol,U.prototype.Da=function(e){if(!lg(e))throw new D(this.Da,0,e);return(e=this.f.geoToScreen(e))?zf(e):z},U.prototype.geoToScreen=U.prototype.Da,U.prototype.Pa=function(e,r){var n;if(n=+E(e)||2*+E(r))throw new D(this.Pa,n-1,arguments[n-1]);return(n=this.f.screenToGeo(e,r))?ng(n):z},U.prototype.screenToGeo=U.prototype.Pa,U.prototype.qg=function(e,r){return this.f.screenToLookAtData(e,r)},U.prototype.screenToLookAtData=U.prototype.qg,U.prototype.fa=function(e){if(!C(e,M))throw new D(this.fa,0,e);return!this.l&&Ln(this),this.m.bc().fa(e),e},U.prototype.addObject=U.prototype.fa,U.prototype.Ga=function(e){if(!C(e,M))throw new D(this.Ga,0,e);return!this.l&&Ln(this),this.m.bc().Ga(e),e},U.prototype.removeObject=U.prototype.Ga,U.prototype.Ua=function(e){return!this.l&&Ln(this),this.m.bc().Ua(e)},U.prototype.getObjects=U.prototype.Ua,U.prototype.Xb=function(e){var r;Bc(e,this.Xb,0,e),!this.l&&Ln(this);var n=e.length;for(r=0;r<n;r++)this.fa(e[r]);return this},U.prototype.addObjects=U.prototype.Xb,U.prototype.rd=function(e){var r;Bc(e,this.rd,0,e),!this.l&&Ln(this);var n=e.length;for(r=0;r<n;r++)this.Ga(e[r]);return this},U.prototype.removeObjects=U.prototype.rd,U.prototype.Od=function(e,r,n){var o;if(o=+E(e)||2*+E(r))throw new D(this.Od,o-1,arguments[o-1]);this.f.getObjectsAt(e,r,!0,function(s){n(s[0])})},U.prototype.getObjectAt=U.prototype.Od,U.prototype.Ea=function(e,r,n,o){var s;if(s=+E(e)||2*+E(r))throw new D(this.Od,s-1,arguments[s-1]);this.f.getObjectsAt(e,r,!1,n,!!o)},U.prototype.getObjectsAt=U.prototype.Ea,U.prototype.ld=function(e,r,n){n=n||{};var o=n.zoom;n.zoom=vc(o)?o:this.c.pb(),this.m.ld(e,r,n)},U.prototype.getObjectsWithin=U.prototype.ld;function Ln(e){e.m=new N({max:24,engineType:e.i.engineType}),e.l=new tl(e.m,e.i),e.a.add(e.l)}var Qn=Tl.HARP,kk={P2D:Tl.P2D,WEBGL:Tl.WEBGL,HARP:Qn};U.EngineType=kk,U.prototype.A={Wo:"mapviewchangestart",Qi:"mapviewchange",Ri:"mapviewchangeend",lf:"baselayerchange"};function Rn(e,r){Rn.j.constructor.call(this,e,r)}u(Rn,rh),t("H.map.Marker",Rn),Rn.prototype.type=nh.MARKER,Rn.prototype.T=1,Rn.prototype.ra=function(e){if(e!==kh.VISUAL||this.zk===1||this.icon.getState()===1)var r=Rn.j.ra.call(this,e);return r||!1},Rn.prototype.invalidate=Rn.prototype.ra,p=Rn.prototype,p.zk=0,p.Uj=function(e){return C(e,Wj)},p.xh=!1,p.mk=function(){this.ra(kh.VISUAL)},p.Ic=function(e){var r=this.icon;return this.xh&&(r.removeEventListener("statechange",this.mk,!1,this),delete this.xh),r&&(this.zk=r.getState()),Rn.j.Ic.call(this,e),e.getState()===0&&(this.xh=!0,Fe(e,"statechange",this.mk,!1,this)),this},Rn.prototype.setIcon=Rn.prototype.Ic,Rn.prototype.b=function(e){return new Wj(e.svg,e)},Rn.prototype.Y=function(){var e=this.getIcon(),r=e.Fo||0,n=Rn.j.forWorkerMessage.call(this),o=n.properties.icon;return o&&0<r&&Ya(o,{stick_color:e.Eo,stick_height:r}),n},Rn.prototype.forWorkerMessage=Rn.prototype.Y;function sh(e,r,n){var o="anonymous",s=1;this.c=A(this.c,this),M.call(this,n),this.da(e),n&&(e="crossOrigin",e in n&&(o=n[e]),e="opacity",e in n&&(s=n[e])),this.Ok(r,o),this.ic(s)}u(sh,M),t("H.map.Overlay",sh),sh.prototype.type=nh.OVERLAY,sh.prototype.K=function(){return this.a},sh.prototype.getBoundingBox=sh.prototype.K,sh.prototype.de=function(e){return C(e,K,this.de,0,e),this.da(e)},sh.prototype.setBoundingBox=sh.prototype.de,sh.prototype.ga=function(){return this.a},sh.prototype.getGeometry=sh.prototype.ga,sh.prototype.da=function(e){var r=this.a,n=!r;return C(e,K,this.da,0,e),(n||!r.ia(e))&&(this.a=e,n||this.ra(kh.SPATIAL)),this},sh.prototype.setGeometry=sh.prototype.da,sh.prototype.Qc=function(){return this.b.getData()},sh.prototype.getBitmap=sh.prototype.Qc,sh.prototype.Ok=function(e,r){var n=this.b;return n&&n.getState()!==1&&n.cancel(),this.b=new Rj(e,this.c,!0,B,r),this},sh.prototype.setBitmap=sh.prototype.Ok,sh.prototype.c=function(e,r){this.b=r,e===1&&this.ra(kh.VISUAL)},sh.prototype.Tc=function(){return this.f},sh.prototype.getOpacity=sh.prototype.Tc,sh.prototype.ic=function(e){var r=this.f,n=2>r;if(0<=e&&1>=e)e!==r&&(this.f=e,n&&this.ra(kh.VISUAL));else throw new D(this.ic,0);return this},sh.prototype.setOpacity=sh.prototype.ic,sh.prototype.Y=function(){var e=sh.j.Y.call(this);return e.geometry=Ci(this.a).Y(),e.properties.overlay=!0,e},sh.prototype.forWorkerMessage=sh.prototype.Y;function Sn(e,r){Sn.j.constructor.call(this,e,r)}u(Sn,pl),t("H.map.layer.MarkerTileLayer",Sn);var Tn={markers:[],total:0,requested:0};function Un(e,r,n,o,s){var l=Bd(n);e.pixelProjection.Oa(l),r=e.Sd(e.Ae(r),l),n=e.Ke(r,r.left>r.right,~~n,o,s),e=n.tiles,n=n.total,o=e.length,s=[];var h;for(h=0;h<o;h++)for(r=e[h],l=r.data.length;l--;)s.push(r.data[l]);return{markers:s,total:e.length,requested:n}}Sn.prototype.Ec=function(e,r,n,o){return this.ma.providesDomMarkers()?Tn:Un(this,e,r,n,o)},Sn.prototype.requestMarkers=Sn.prototype.Ec,Sn.prototype.Dc=function(e,r,n,o){return this.ma.providesDomMarkers()?Un(this,e,r,n,o):Tn},Sn.prototype.requestDomMarkers=Sn.prototype.Dc;function Vn(e,r,n){var o,s=6;if(r){for(o=' expected close to: "'+r;s--;)r=e.a.next(),r!==-1&&(o+=String.fromCharCode(r));o+='"'}throw new D(Wn,0,"- Malformed WKT: "+(o?n+o:"unexpected end of stream"))}function Xn(e,r){var n=e.next();r=r?")":"(",n!==r&&Vn(e,n,'"'+r+'"')}function Yn(e){return Zn(e)===","?(e.next(),!0):!1}function $n(e,r,n,o,s){var l,h,d=2+r+n;for(h=1;h<=d;h++)(n=e.next())?(l=+n)!==l?Vn(e,n,"number"):h===1?o[s+1]=l:h===2?o[s]=l:h===3&&(o[s+2]=l):Vn(e,n);r||(o[s+2]=0)}var ao=[];function bo(e,r,n,o){return o||Xn(e,0),$n(e,r,n,ao,0),o||Xn(e,1),new kg(ao[0],ao[1],r?ao[2]:B)}function co(e,r,n){var o=[];Xn(e,0);do $n(e,r,n,o,o.length);while(Yn(e));return Xn(e,1),new L(o)}function eo(e,r,n){Xn(e,0);var o=co(e,r,n);if(Yn(e)){var s=[];do s.push(co(e,r,n));while(Yn(e))}return Xn(e,1),new O(o,s)}var fo=[],go=[eo],ho=[bo],io={POINT:ho,LINESTRING:[co],POLYGON:go,MULTIPOINT:[bo,Vi],MULTILINESTRING:[co,ih],MULTIPOLYGON:[eo,Ji],GEOMETRY:fo,GEOMETRYCOLLECTION:fo,CIRCULARSTRING:fo,COMPOUNDCURVE:fo,CURVEPOLYGON:fo,MULTICURVE:fo,MULTISURFACE:fo,CURVE:fo,SURFACE:fo,POLYHEDRALSURFACE:fo,TIN:fo,TRIANGLE:fo},jo={Z:1,M:2,ZM:3};function Wn(e){e=new ko(e);var r,n=e.next();if((r=io[n.toUpperCase()])||Vn(e,n,"type name"),r!==fo){n=Zn(e),n=jo[n.toUpperCase()];var o=n&1,s=n>>1;if(o|s&&e.next(),n=Zn(e),n==="EMPTY")if(e.next(),o=r[1])var l=new o([]);else r!==ho&&(l=new L([]),r===go&&(l=new O(l)));else if(n==="("){if(l=r[0],r=r[1],r){var h=[];if(Xn(e,0),l===bo){var d=Zn(e)!=="(";do h.push(l(e,o,s,d));while(Yn(e))}else do h.push(l(e,o,s));while(Yn(e));Xn(e,1),o=new r(h)}else o=l(e,o,s);l=o}else Vn(e,n,'"Z", "M", "ZM", "(" or "EMPTY"');e.next()&&Vn(e,n,"end of stream")}return l||z}function ko(e){this.a=e}function Zn(e){var r=e.b;if(r===B){for(r=e.a;r.Pb()===lo;)r.next();if(mo[r.Pb()])r=r.next(),r=r===no?"":String.fromCharCode(r);else{r.ge();do r.next();while(!mo[r.Pb()]);r=String.fromCharCode.apply(null,r.Gd())}e.b=r}return r}ko.prototype.next=function(){var e=Zn(this);return e!==""&&delete this.b,e};var lo=32,no=-1,oo={$o:lo,Uo:40,Zo:41,Ro:44,So:no},mo=Object.keys(oo).reduce(function(e,r){return e[oo[r]]=!0,e},oc());function po(){}t("H.util.ICharStream",po),po.prototype.next=function(){},po.prototype.ge=function(){},po.prototype.Gd=function(){},po.prototype.Pb=function(){};function qo(e){this.c=String(e),this.f=0,this.a=[],this.b=!1}t("H.util.CharStream",qo),qo.prototype.next=function(){var e=this.c.charCodeAt(this.f++);return e=isNaN(e)?-1:e,this.b&&this.a.push(e),e},qo.prototype.ge=function(){this.b=!0,this.a=[]},qo.prototype.Gd=function(){var e=this.a.slice();return this.b=!1,this.a=[],e},qo.prototype.Pb=function(){var e=this.c.charCodeAt(this.f);return isNaN(e)?-1:e},t("H.util.wkt.toGeometry",function(e){return Wn(new qo(e))});function ro(e,r){ro.j.constructor.call(this,Ki,r),this.de(e)}u(ro,uh),t("H.map.Rect",ro),ro.prototype.de=function(e){if(!C(e,K))throw new D(this.de,0,e);e.ia(this.aa)||(this.aa=this.D=e,this.a!==z&&ro.j.da.call(this,Ci(e)))},ro.prototype.setBoundingBox=ro.prototype.de,ro.prototype.K=function(){return this.D},ro.prototype.getBoundingBox=ro.prototype.K,ro.prototype.da=function(){return this},ro.prototype.setGeometry=ro.prototype.da,ro.prototype.ga=function(){return this.a===Ki&&ro.j.da.call(this,Ci(this.aa)),this.a},ro.prototype.getGeometry=ro.prototype.ga;function so(){return Hf("H-core","1.48.1","2d0df27",{region:"row"})}t("H.buildInfo",so);var Mn=so().region==="cn",jk=kk[Mn?"HARP":"WEBGL"],to,uo="maps".concat("js-"),vo,wo,xo,yo,zo;if(vo=x.document.querySelector('script[src*="'+uo+'"]'),!vo){for(wo=x.document.getElementsByTagName("script"),yo=new RegExp("^.*"+uo),zo=0,xo=wo.length;zo<xo;zo++)if(yo.test(wo[zo].src)){vo=wo[zo];break}}to=vo?vo.src.replace(/\/[^\/]*$/,"/"):"",t("H.getScriptPath",function(){return to});function Ao(){var e=decodeURIComponent(to);if(e){e=e[e.length-1]==="/"?e.substring(0,e.length-1):e;var r=x.document,n="";r?(r=r.createElement("a"),r.href=e,n=r.href):/[\w]+:\/\//.test(e)&&(n=e),e=new URL(n),e.pathname+=e.pathname[e.pathname.length-1]==="/"?"styles":"/styles",e=e.toString()}else e="https://js.api.here.com/v3/3.1.48.1/styles";return e}t("H.getStylePath",Ao);function Bo(e){var r=e.ownerDocument;r=r.documentElement||r.body.parentNode||r.body;try{var n=e.getBoundingClientRect()}catch{n={top:0,right:0,bottom:0,left:0,height:0,width:0}}return{x:n.left+(typeof window.pageXOffset=="number"?window.pageXOffset:r.scrollLeft),y:n.top+(typeof window.pageYOffset=="number"?window.pageYOffset:r.scrollTop)}}var Co=(function(){return this}).apply(null);function Do(e,r,n,o,s,l){if(isNaN(e))throw Error("x needs to be a number");if(isNaN(r))throw Error("y needs to be a number");if(isNaN(n))throw Error("pointer must have an id");this.viewportX=e,this.viewportY=r,this.target=null,this.id=n,this.type=o,this.dragTarget=null,this.button=vc(s)?s:-1,this.buttons=vc(l)?l:0,this.a=this.button}t("H.mapevents.Pointer",Do);function Eo(e,r,n){if(isNaN(r))throw Error("x needs to be a number");if(isNaN(n))throw Error("y needs to be a number");e.viewportX=r,e.viewportY=n}Do.prototype.tm=function(){return this.a},Do.prototype.getLastChangedButton=Do.prototype.tm;function Fo(e,r){e.a=r,e.buttons|=Go[+r]||0}function Ho(e,r){e.a=r,e.buttons&=~(Go[+r]||0)}var Go=[1,4,2],Io={NONE:-1,LEFT:0,MIDDLE:1,RIGHT:2};Do.Button=Io;function Jo(e,r,n,o,s,l,h){Jo.j.constructor.call(this,e),this.pointers=r,this.changedPointers=n,this.targetPointers=o,this.currentPointer=s,this.originalEvent=h,this.target=l}u(Jo,ud),t("H.mapevents.Event",Jo);function Ko(e){this.a=e instanceof Array?e.slice(0):[]}p=Ko.prototype,p.clear=function(){this.a.splice(0,this.a.length)},p.length=function(){return this.a.length},p.indexOf=function(e){for(var r=this.a.length;r--;)if(this.a[r].id===e)return r;return-1};function Lo(e,r){return r=e.indexOf(r),r!==-1?e.a[r]:null}p.remove=function(e){return e=this.indexOf(e),e!==-1?this.a.splice(e,1)[0]:null};function Mo(e,r){for(var n=e.a.length,o=[];n--;)e.a[n].type!==r&&o.push(e.a[n]);e.a=o}function No(e,r){for(var n=e.a.length;n--;)if(e.a[n].dragTarget===r)return!0;return!1}p.push=function(e){if(e instanceof Do)return this.a.push(e);throw Error("list needs a pointer")},p.La=function(){return this.a},p.clone=function(){return new Ko(this.a)};function Oo(e,r,n){if(n=n||{},!(e instanceof U))throw Error("events: map instance required");if(!(r instanceof Array))throw Error("events: map array required");qd.call(this),this.Tg=n.Tg||300,this.gj=n.gj||50,this.Zk=n.Zk||50,this.$k=n.$k||500,this.Ch=n.Ch||900,this.Bh=n.Bh||8,this.map=e,this.m=this.map.b,this.f=this.m.element,this.D=r,this.a=new Ko,this.b=new Ko,this.l={},this.c=null,this.u=!0,this.U={},this.g={},this.s=null,this.te=A(this.te,this),this.P={pointerdown:this.Bl,pointermove:this.Cl,pointerup:this.Dl,pointercancel:this.Al},Po(this)}u(Oo,qd);function Po(e,r){var n,o=e.D.length;for(n=0;n<o;n++){var s=e.D[n],l=s.listener;typeof l=="function"&&(r?(s.target||e.f).removeEventListener(s.Sa,l):(s.target||e.f).addEventListener(s.Sa,l))}}function Qo(e,r,n){var o;if(typeof e.P[r]=="function"){r!=="pointermove"&&(e.u=!0);var s=0;for(o=e.b.length();s<o;s++){var l=e.b.a[s]||null;e.f.contains(n.composedPath()[0])?Ro(e,l,e.nj.bind(e,n,r,l)):e.nj(n,r,l,null)}}e.b.clear()}p=Oo.prototype,p.nj=function(e,r,n,o){So(n.id,this.U),this.P[r].call(this,n,o,e)};function Ro(e,r,n){if(e.c===r)n(r.target);else{var o=e.m,s=r.viewportX;if(r=r.viewportY,0>s||0>r||s>=o.width||r>=o.height)n(z);else{var l=e.map;l.Od(s,r,function(h){n(h||l)})}}}p.Dl=function(e,r,n){var o=e.id;e.target=r,To(this,e,n),Uo(this,r,"pointerup",n,e),e.type!=="mouse"&&Uo(this,r,"pointerleave",n,e),r=this.l[e.id];var s={x:e.viewportX,y:e.viewportY},l=n.timeStamp,h=e.target,d=this.s;r&&r.target===h&&r.Se.Wa(s)<this.Zk&&l-r.Hi<this.$k?(Uo(this,h,"tap",n,e),d&&d.target===h&&l-d.Hi<this.Tg?d.Se.Wa({x:e.viewportX,y:e.viewportY})<this.gj&&(Uo(this,h,"dbltap",n,e),this.s=null):this.s={target:h,Se:new J(e.viewportX,e.viewportY),Hi:n.timeStamp}):this.s=null,this.l={},So(o,this.g)};function To(e,r,n){r===e.c&&(Uo(e,r.dragTarget,"dragend",n,r),e.c=null,So(r.id,e.U)),r.dragTarget=null}p.te=function(e,r){var n=this;Uo(this,e.dragTarget,"drag",r,e),So(e.id,this.U),this.U[e.id]=setTimeout(function(){n.te(e,r)},150)};function So(e,r){r[e]&&(r[e].timeout?clearTimeout(r[e].timeout):clearTimeout(r[e]),delete r[e])}function Vo(e,r,n){var o=r.target,s=new J(r.viewportX,r.viewportY),l=r.id;So(l,e.g);var h=setTimeout(function(){o&&o===r.target&&s.Wa({x:r.viewportX,y:r.viewportY})<e.Bh&&(Uo(e,o,"longpress",n,r),delete e.l[r.id])},e.Ch);e.g[l]={timeout:h,Se:s}}p.Cl=function(e,r,n){var o=e.dragTarget,s=e.id,l=e.target;e.target=r,l!==r&&(Uo(this,l,"pointerleave",n,e),Uo(this,r,"pointerenter",n,e)),o?this.c?(this.te(e,n),this.g[s]&&this.g[s].Se.Wa({x:e.viewportX,y:e.viewportY})>this.Bh&&So(s,this.g)):this.u?this.u=!1:(this.c=e,Uo(this,o,"dragstart",n,e),this.te(e,n),delete this.l[s],this.u=!0):(!this.c||this.c&&this.c.dragTarget!==r&&this.c.dragTarget!==this.map)&&Uo(this,r,"pointermove",n,e)},p.Bl=function(e,r,n){var o=!(/^(?:mouse|pen)$/.test(e.type)&&n.button!==0);if(r){e.target=r,this.l[e.id]={Se:new J(e.viewportX,e.viewportY),target:e.target,Hi:n.timeStamp},e.type!=="mouse"&&Uo(this,r,"pointerenter",n,e);var s=Uo(this,r,"pointerdown",n,e);!this.c&&o&&(r.draggable&&!No(this.a,r)?e.dragTarget=r:!this.map.draggable||s.defaultPrevented||No(this.a,this.map)||(e.dragTarget=this.map)),Vo(this,e,n)}},p.Al=function(e,r,n){var o=e.id;e.target=null,r?(Uo(this,r,"pointerleave",n,e),Uo(this,r,"pointercancel",n,e)):Uo(this,this.map,"pointercancel",n,e),To(this,e,n),this.l={},So(o,this.g)};function Uo(e,r,n,o,s){if(r&&typeof r.dispatchEvent=="function"){var l=Jo,h=e.a.La(),d=e.b.La();e=e.a;var y,g=e.a.length,v=[];for(y=0;y<g;y++)e.a[y].target===r&&v.push(e.a[y]);l=new l(n,h,d,v,s,r,o),s.button=/^(?:longpress|(?:dbl)?tap|pointer(?:down|up))$/.test(n)?s.a:Io.NONE,r.dispatchEvent(l)}return l}p.o=function(){Po(this,!0),this.a.clear(),this.b.clear();var e=this.U,r;for(r in e)So(r,e);e=this.g;for(var n in e)So(n,e);delete this.f,delete this.D,delete this.a,delete this.b,delete this.map,this.s=null,delete this.l,this.c=null,qd.prototype.o.call(this)};function Wo(e){this.i=A(this.i,this),Oo.call(this,e,[{Sa:"touchstart",listener:this.i},{Sa:"touchmove",listener:this.i},{Sa:"touchend",listener:this.i},{Sa:"touchcancel",listener:this.i}]),this.L={touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",touchcancel:"pointercancel"},this.J=(e=(e=e.s)?e.N():null)?Array.prototype.slice.call(e.querySelectorAll("a"),0):[]}u(Wo,Oo),Wo.prototype.i=function(e){var r=e.touches,n=this.a.length(),o;if(e.type==="touchstart"&&n>=r.length){for(n=this.a.clone(),o=r.length;o--;)n.remove(r[o].identifier);for(o=n.length();o--;)this.a.remove((n.a[o]||null).id);this.b=n,Qo(this,"pointercancel",e),this.b.clear()}if(this.L[e.type]){r=Bo(this.m.element),n=e.type,o=e.changedTouches;var s=o.length,l;for(this.b.clear(),l=0;l<s;l++){var h=o[l],d=Lo(this.a,h.identifier),y=h.pageX-r.x,g=h.pageY-r.y;if(d)if(n==="touchmove"){h=Math.abs(d.viewportX-y);var v=Math.abs(d.viewportY-g);(1<h||1<v||h===1&&v===1)&&(Eo(d,y,g),this.b.push(d))}else n==="touchend"&&(this.a.remove(d.id),this.b.push(d),Ho(d,Io.LEFT));else d=new Do(y,g,h.identifier,"touch",Io.LEFT,1),this.a.push(d),this.b.push(d)}Qo(this,this.L[e.type],e),this.J.indexOf(e.target)===-1&&e.preventDefault()}},Wo.prototype.o=function(){this.J=null,Oo.prototype.o.call(this)};function Xo(e){var r=Yo(this);(window.PointerEvent||window.MSPointerEvent)&&r.push({Sa:"MSHoldVisual",listener:"prevent"}),Oo.call(this,e,r)}u(Xo,Oo);function Yo(e){var r=!!window.PointerEvent,n,o,s=[];return e.i=A(e.i,e),"MSPointerDown MSPointerMove MSPointerUp MSPointerCancel MSPointerOut MSPointerOver".split(" ").forEach(function(l){n=l.toLowerCase().replace(/ms/g,""),o=r?n:l,s.push({Sa:o,listener:e.i,target:/^pointer(up|move)$/.test(n)?window:null})}),s}var Zo={2:"touch",3:"pen",4:"mouse"};Xo.prototype.i=function(e){var r=window.PointerEvent?e.type:e.type.toLowerCase().replace(/ms/g,""),n=Bo(this.f),o=Lo(this.a,e.pointerId),s=e.pageX-n.x;n=e.pageY-n.y;var l=Zo[e.pointerType]||e.pointerType;if(cd&&x.getComputedStyle(this.m.element).direction==="rtl"&&(s-=(x.devicePixelRatio-1)*this.m.width),!(o||/^pointer(up|out|cancel)$/.test(r)||l==="touch"&&r!=="pointerdown")){o={x:s,y:n};var h=e.pointerType;typeof h=="number"&&(h=Zo[h]),o=new Do(o.x,o.y,e.pointerId,h,e.button,e.buttons),this.a.push(o)}o&&(/^pointer(up|cancel)$/.test(r)?(l==="touch"&&this.a.remove(o.id),Ho(o,e.button)):r==="pointerdown"&&(e.pointerType==="touch"&&(Mo(this.a,"mouse"),Mo(this.a,"pen")),Fo(o,e.button)),this.b.push(o),r!=="pointermove"?(Eo(o,s,n),Qo(this,/^pointer(over|out)$/.test(r)?"pointermove":r,e)):(o.viewportX!==s||o.viewportY!==n)&&(Eo(o,s,n),Qo(this,r,e))),this.b.clear()};function $o(e,r,n,o){$o.j.constructor.call(this,"contextmenu"),this.items=[],this.viewportX=e,this.viewportY=r,this.target=n,this.originalEvent=o}u($o,ud),t("H.mapevents.ContextMenuEvent",$o);function ap(e){this.ph=A(this.ph,this),this.rh=A(this.rh,this),this.qh=A(this.qh,this),this.J=!1,this.i=-1,this.L=0,ap.j.constructor.call(this,e,[{Sa:"contextmenu",listener:this.ph},{target:e,Sa:"longpress",listener:this.rh},{target:e,Sa:"dbltap",listener:this.qh}])}u(ap,Oo),p=ap.prototype,p.rh=function(e){var r=e.currentPointer;r.type==="touch"&&e.pointers.length===1&&bp(this,r.viewportX,r.viewportY,e.originalEvent,e.target)},p.qh=function(e){e.currentPointer.type==="touch"&&(this.L=Date.now())},p.ph=function(e){var r=this;this.i===-1?this.i=setTimeout(function(){var n=Bo(r.f),o=e.pageX-n.x;n=e.pageY-n.y,r.i=-1,bp(r,o,n,e)},this.Tg):(clearInterval(this.i),this.i=-1),e.preventDefault()};function bp(e,r,n,o,s){var l=e.map,h=Date.now()-e.L;s?!e.J&&h>e.Ch&&(e.J=!0,s.dispatchEvent(new $o(r,n,s,o)),Fe(l.N(),cp,e.mj,!1,e)):l.Od(r,n,e.Jn.bind(e,r,n,o))}p.Jn=function(e,r,n,o){o=o&&Da(o.dispatchEvent)?o:this.map,bp(this,e,r,n,o)},p.mj=function(){this.J&&(this.J=!1,this.map.dispatchEvent(new ud("contextmenuclose",this.map)))},p.o=function(){var e=this.map.N();clearInterval(this.i),e&&Me(e,cp,this.mj,!1,this),Oo.prototype.o.call(this)};var cp=["mousedown","touchstart","pointerdown","wheel"];function dp(e,r,n,o,s){dp.j.constructor.call(this,"wheel"),this.delta=e,this.viewportX=r,this.viewportY=n,this.target=o,this.originalEvent=s}u(dp,ud),t("H.mapevents.WheelEvent",dp);function ep(e){var r="onwheel"in document;this.T=r,this.L=(r?"d":"wheelD")+"elta",this.i=A(this.i,this),ep.j.constructor.call(this,e,[{Sa:(r?"":"mouse")+"wheel",listener:this.i}]),this.J=this.map.b}u(ep,Oo),ep.prototype.i=function(e){if(!e.kl){var r=Bo(this.f),n=e.pageX-r.x;r=e.pageY-r.y;var o=this.L,s=e[o+(o+"Y"in e?"Y":"")],l;if(cd&&x.getComputedStyle(this.J.element).direction==="rtl"&&(n-=(x.devicePixelRatio-1)*this.J.width),s){var h=Math.abs,d=h(s);s=(!(l=e[o+"X"])||3<=d/h(l))&&(!(l=e[o+"Z"])||3<=d/h(l))?(+(0<s)-+(0>s))*(this.T?1:-1):0}n=new dp(s,n,r,null,e),n.delta&&(e.stopImmediatePropagation(),e.preventDefault(),this.map.Od(n.viewportX,n.viewportY,this.R.bind(this,n)))}},ep.prototype.R=function(e,r){var n=e.target=r||this.map,o,s;setTimeout(function(){n.dispatchEvent(e),e.c||(o=e.originalEvent,s=new x.WheelEvent("wheel",o),s.kl=!0,o.target.dispatchEvent(s))},0)};function fp(e){this.i=A(this.i,this),Oo.call(this,e,[{Sa:"mousedown",listener:this.i},{Sa:"mousemove",listener:this.i,target:window},{Sa:"mouseup",listener:this.i,target:window},{Sa:"mouseover",listener:this.i},{Sa:"mouseout",listener:this.i},{Sa:"dragstart",listener:this.J}])}u(fp,Oo),fp.prototype.i=function(e){var r=e.type,n=Bo(this.f);n={x:e.pageX-n.x,y:e.pageY-n.y};var o;(o=this.a.a[0]||null)||(o=new Do(n.x,n.y,1,"mouse"),this.a.push(o)),this.b.push(o),Eo(o,n.x,n.y),/^mouse(?:move|over|out)$/.test(r)?Qo(this,"pointermove",e):(/^mouse(down|up)$/.test(r)&&(n=e.which-1,Co.RegExp.$1==="up"?Ho(o,n):Fo(o,n)),Qo(this,r.replace("mouse","pointer"),e)),this.b.clear()},fp.prototype.J=function(e){e.preventDefault()};function gp(e){var r=e.b.element.style;if(hp.indexOf(e)!==-1)throw Error("InvalidArgument: map is already in use");this.a=e,hp.push(e),r.msTouchAction=r.touchAction="none",dd||!window.PointerEvent&&!window.MSPointerEvent?(this.c=new Wo(this.a),this.b=new fp(this.a)):this.c=new Xo(this.a),this.g=new ep(this.a),this.f=new ap(this.a),this.a.tb(this.F,this),qd.call(this)}u(gp,qd),t("H.mapevents.MapEvents",gp);var hp=[];Ic(hp),gp.prototype.F=function(){delete this.a,this.c.F(),this.g.F(),this.f.F(),this.b&&this.b.F(),hp.splice(hp.indexOf(this.a),1),qd.prototype.F.call(this)},gp.prototype.dispose=gp.prototype.F,gp.prototype.Nl=function(){return this.a},gp.prototype.getAttachedMap=gp.prototype.Nl;function ip(e,r){r=r===void 0?{}:r;var n;if(ip.j.constructor.call(this),jp.indexOf(e)!==-1)throw new D(ip,0,"events are already used");this.b=n=e.a,this.l=e,jp.push(e),n.draggable=!0,this.i=r.kinetics||{duration:600,ease:em},this.s=r.modifierKey||"Alt",this.enable(r.enabled),this.c=n.b,this.f=this.c.element,this.g=0,n.addEventListener("dragstart",this.Mh,!1,this),n.addEventListener("drag",this.bk,!1,this),n.addEventListener("dragend",this.Lh,!0,this),n.addEventListener("wheel",this.rk,!1,this),n.addEventListener("dbltap",this.lk,!1,this),n.addEventListener("pointermove",this.ck,!1,this),Ee(this.f,"contextmenu",this.ak,!1,this),e.tb(this.F,this)}u(ip,qd),t("H.mapevents.Behavior",ip);var jp=[];Ic(jp),ip.prototype.a=0;var kp={PANNING:1,PINCH_ZOOM:2,WHEEL_ZOOM:4,DBL_TAP_ZOOM:8,FRACTIONAL_ZOOM:16,TILT:32,HEADING:64};ip.Feature=kp;var lp=kp.PANNING,mp=kp.PINCH_ZOOM,np=kp.WHEEL_ZOOM,op=kp.DBL_TAP_ZOOM,pp=kp.FRACTIONAL_ZOOM,qp=kp.TILT,rp=kp.HEADING,sp=lp|mp|np|op|pp|qp|rp;ip.DRAGGING=lp,ip.WHEELZOOM=np,ip.DBLTAPZOOM=op,ip.FRACTIONALZOOM=pp;function tp(e,r){if(e!==+e||e%1||0>e||2147483647<e)throw new D(r,0,"integer in range [0...0x7FFFFFFF] required")}ip.prototype.disable=function(e){var r=this.a;e!==B?(tp(e,this.disable),r^=r&e):r=0,this.c.endInteraction(!0),this.a=r,this.b.draggable=0<(r&(lp|qp|rp|mp))},ip.prototype.disable=ip.prototype.disable,ip.prototype.enable=function(e){var r=this.a;e!==B?(tp(e,this.enable),r|=e&sp):r=sp,this.a=r,this.b.draggable=0<(r&(lp|qp|rp|mp))},ip.prototype.enable=ip.prototype.enable,ip.prototype.isEnabled=function(e){return tp(e,this.isEnabled),e===(this.a&e)},ip.prototype.isEnabled=ip.prototype.isEnabled;function up(e,r,n){var o=r.currentPointer.type==="touch",s=0,l;if(l=!o){l=e.s;var h,d=r.originalEvent;d.getModifierState?h=d.getModifierState(l):h=!!d[l.replace(/^Control$/,"ctrl").toLowerCase()+"Key"],l=h}return l?s|=qp|rp:(s|=lp,o&&(r=r.pointers,r.length===2&&(s|=mp|rp,n?55>Dd(r[0].viewportY-r[1].viewportY)&&(s|=qp):e.uh&Nl.TILT&&(s|=qp)))),s&=e.a,(s&qp?Nl.TILT:0)|(s&rp?Nl.HEADING:0)|(s&mp?Nl.ZOOM:0)|(s&lp?Nl.COORD:0)}function vp(e){var r=e.pointers;return e=r[0],r=r[1],e=[e.viewportX,e.viewportY],r&&e.push(r.viewportX,r.viewportY),e}p=ip.prototype,p.uh=0,p.Mh=function(e){var r=up(this,e,!0);if(this.uh=r){var n=this.c;if(e=vp(e),n.startInteraction(r,this.i),n.interaction.apply(n,e),this.a&np&&!(this.a&pp)&&(r=e[0],n=e[1],this.g)){e=this.b.pb();var o=(0>this.g?Cd:Bd)(e);e!==o&&(this.g=0,wp(this,e,o,r,n))}}},p.bk=function(e){var r=up(this,e,!1);if(r!==this.uh)e.originalEvent.type!=="pointerout"&&e.originalEvent.type!=="pointerover"&&(this.Lh(e),this.Mh(e));else if(r){r=this.c;var n=vp(e);r.interaction.apply(r,n),e.originalEvent.preventDefault()}},p.Lh=function(e){up(this,e,!1)&&this.c.endInteraction(!this.i)};function wp(e,r,n,o,s){var l=+n-+r;if(e=e.b.c,isNaN(+r))throw Error("start zoom needs to be a number");if(isNaN(+n))throw Error("to zoom needs to be a number");l!==0&&(e.startControl(null,o,s),e.control(0,0,6,0,0,0),e.endControl(!0,function(h){h.zoom=n}))}p.rk=function(e){if(!e.defaultPrevented&&this.a&np){var r=e.delta,n=this.b.pb(),o=this.b,s=o.f.type;o=this.a&pp?n-r:(0>-r?Cd:Bd)(n)-r,(s===kk.P2D||s===kk.WEBGL||s===kk.HARP)&&(wp(this,n,o,e.viewportX,e.viewportY),this.g=r),e.preventDefault()}},p.ck=function(){},p.lk=function(e){var r=e.currentPointer,n=this.b.pb(),o=e.currentPointer.type,s=this.b.f.type;(s===kk.P2D||s===kk.WEBGL||s===kk.HARP)&&this.a&op&&(e=o==="mouse"?e.originalEvent.button===0?-1:1:0<e.pointers.length?1:-1,e=this.a&pp?n-e:(0>-e?Cd:Bd)(n)-e,wp(this,n,e,r.viewportX,r.viewportY))},p.ak=function(e){return this.a&op?(e.preventDefault(),!1):!0},p.F=function(){var e=this.b;e&&(e.draggable=!1,e.removeEventListener("dragstart",this.Mh,!1,this),e.removeEventListener("drag",this.bk,!1,this),e.removeEventListener("dragend",this.Lh,!0,this),e.removeEventListener("wheel",this.rk,!1,this),e.removeEventListener("dbltap",this.lk,!1,this),e.removeEventListener("pointermove",this.ck,!1,this),delete this.b),this.f&&(this.f.style.msTouchAction="",Me(this.f,"contextmenu",this.ak,!1,this),delete this.f),delete this.c,delete this.i,jp.splice(jp.indexOf(this.l),1),delete this.l,qd.prototype.F.call(this)},ip.prototype.dispose=ip.prototype.F,t("H.mapevents.buildInfo",function(){return Hf("H-mapevents","1.48.1","2d0df27",{region:"row"})}),S.prototype.J=ca(3,function(e){var r=this.getCache(),n=this;if(e!==z){C(e,Rk,S.prototype.J,0);var o=e}else o=yl;o!==r&&r.na(function(s,l,h){return n.ub(s)?(o.add(s,l,h),!0):!1}),this.P=o}),ti.prototype.a=ca(2,function(e){this.f=e,e=this.getState(),e!==Xh.INIT&&e!==Xh.LOADING&&Ai(this)});function xp(e){return e=e.uc("_#-;,:","_#-;,:","_#-;,:"),new RegExp("^"+e.replace(/[.*+?^${}()|[\]\\\/]/g,"\\$&").replace(/_#-;,:/g,"\\d+")+"$")}function yp(e,r){return Ya.apply(null,arguments),e}function zp(e,r){var n=x.console;n&&n.warn&&(e=yc(e)+" is deprecated and will be removed soon. ",r&&(e+=r),n.warn(e))}var Ap=globalThis;tc("monospace serif");function Bp(){}Bp.prototype.pop=function(e){return this[e]||(this[e]=[]),this[e].pop()||document.createElement("canvas")},Bp.prototype.push=function(e,r){this[r]||(this[r]=[]),this[r].push(e)};var Cp=new Bp;t("H.service.util.eval",function(a){return eval(a)});function W(e,r,n,o,s,l){if(e&&r)this.Bi(e),this.af(r),this.wd(n),this.xi(s),this.Lk(l),this.bf(o);else throw new D(W,B,'Parameters "scheme" and "host" must be specified')}t("H.service.Url",W);function Dp(e,r){var n=x.document,o,s="";if(n){if(s=n.createElement("a"),r){var l=(o=n.getElementsByTagName("base")[0])&&o.href,h=n.head,d=o||h.appendChild(n.createElement("base"));d.href=r}s.href=e,s=s.href,r&&(o?o.href=l:h.removeChild(d))}else/[\w]+:\/\//.test(e)&&(s=e);l=/(?:(\w+):\/\/)?(?:([^:]+):([^@/]*)@)?([^/:]+)?(?:[:]{1}([0-9]+))?(\/[^?#]*)?(\?[^#]+)?(#.*)?/.exec(s),e=l[1],h=l[4],r=l[5],d=l[6],n=l[7],o=l[8],!l[2]&&h&&/@/.test(h)&&(h=h.split("@")[1]),l=W,d=d&&0<d.length?d.substr(1):"",s={};var y,g;if(n)for(y=/([?&]?([^=&+]+))(=([^&]+))?/g;g=y.exec(n);)s[decodeURIComponent(g[2])]=g[4]?decodeURIComponent(g[4]):void 0;return new l(e,h,d,s,isNaN(+r)?void 0:+r,o&&0<o.length?o.substr(1):"")}W.parse=Dp,W.prototype.clone=function(){var e={},r;for(r in this.a)e[r]=this.a[r];return new W(this.i,this.c,this.b,e,this.g,this.f)},W.prototype.clone=W.prototype.clone,W.prototype.Bi=function(e){if(!e||typeof e!="string")throw new D(this.Bi,0,'The "scheme" parameter must be a non-empty string.');return this.i=e,this},W.prototype.setScheme=W.prototype.Bi,W.prototype.Vm=function(){return this.i},W.prototype.getScheme=W.prototype.Vm,W.prototype.af=function(e){if(!e||typeof e!="string"||e.charAt(0)==="-"||e.charAt(0)==="."||e.charAt(e.length-1)===".")throw new D(this.af,0,'The "host" parameter is not a valid host name.');return this.c=e,this},W.prototype.setHost=W.prototype.af,W.prototype.om=function(){return this.c},W.prototype.getHost=W.prototype.om,W.prototype.wd=function(e){return this.b=e||void 0,this},W.prototype.setPath=W.prototype.wd,W.prototype.Hm=function(){return this.b},W.prototype.getPath=W.prototype.Hm,W.prototype.bf=function(e){if(e)if(typeof e=="object")this.a=e;else throw new D(this.bf,0,'Parameter "params" must be an object.');else this.a={};return this},W.prototype.setQuery=W.prototype.bf,W.prototype.Mj=function(){return!Ep(this)},W.prototype.hasQuery=W.prototype.Mj,W.prototype.getQuery=function(){return this.a},W.prototype.getQuery=W.prototype.getQuery,W.prototype.xi=function(e){if(e===void 0)this.g=e;else{var r=ae(+e<<0,0,65535);if(r!=e)throw new D(this.xi,0,'Parameter "port" must be an integer in range [0...65535]');this.g=r}return this},W.prototype.setPort=W.prototype.xi,W.prototype.Mm=function(){return this.g},W.prototype.getPort=W.prototype.Mm,W.prototype.Lk=function(e){return this.f=e||void 0,this},W.prototype.setAnchor=W.prototype.Lk,W.prototype.kd=function(){return this.f},W.prototype.getAnchor=W.prototype.kd,W.prototype.I=function(e){if(typeof e!="object")throw new D(this.I,0,'Parameter "other" must be an object.');var r=this.a,n;for(n in e)e.hasOwnProperty(n)&&typeof e[n]!="function"&&(r[n]=e[n]);return this},W.prototype.mergeQuery=W.prototype.I,W.prototype.Ba=function(e){if(!e||typeof e!="string")throw new D(this.Ba,0,'Parameter "subDomain" must be a non-empty string');return e.substr(e.length-1)==="."&&(e=e.substr(0,e.length-1)),this.af(e+"."+this.c)},W.prototype.addSubDomain=W.prototype.Ba,W.prototype.G=function(e){if(!e||typeof e!="string")throw new D(this.G,0,'Parameter "subPath" must be a non-empty string');return this.wd((this.b?this.b+"/":"")+e)},W.prototype.addSubPath=W.prototype.G,W.prototype.toString=function(){return[this.i+"://",this.c,this.g?":"+this.g:"",this.b||!Ep(this)||this.f?"/":"",this.b?encodeURI(this.b):"",Fp(this),this.f?"#"+encodeURIComponent(this.f):""].join("")},W.prototype.toString=W.prototype.toString;function Gp(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(r){return"%"+r.charCodeAt(0).toString(16)})}function Fp(e){var r=[],n=e.a,o={},s;for(s in n){if(n.hasOwnProperty(s)&&typeof n[s]!="function"){var l=e.a[s];o.yd=Gp(s),C(l,Hp)?l.a.forEach(function(h){return function(d){r.push(h.yd+"="+Gp(d))}}(o)):C(l,Ip)?r.push(o.yd+"="+l.b.map(function(h){return Gp(h)}).join(l.a)):r.push(l===void 0?o.yd:o.yd+"="+Gp(l))}o={yd:o.yd}}return 0<r.length?"?"+r.join("&"):""}function Jp(e){var r=Hf("H-service","1.48.1","2d0df27",{region:"row"});return e.a.xnlp="CL_JSMv3."+r.version,e}function Ep(e){var r,n=0;for(r in e.a)if(e.a.hasOwnProperty(r)&&typeof e.a[r]!="function"&&(n++,0<n))break;return!n}function Kp(e,r){if(Bc(e))for(var n=0;n<e.length;n++){var o=e[n];if(!Cc(o)&&!Fc(o)){var s="The Array does not contain only strings and numbers";break}}else s="Not an Array";if(s)throw new D(r,0,e);return e}function Hp(e){this.a=Kp(e,Hp)}W.MultiValueQueryParameter=Hp,Hp.prototype.fn=function(){return this.a},Hp.prototype.getValues=Hp.prototype.fn;function Ip(e,r){if(this.b=Kp(e,Ip),!/^[!\$\(\)\*\+,;]$/.test(r))throw new D(Ip,1,'Invalid delimiter "'+r+'"');this.a=r}W.DelimitedQuerySubValues=Ip;function Lp(e,r){C(e,Mp,Lp,0);var n={};Object.assign(n,r),n.min=n.min||0,n.max=n.max||20,n.tileSize=n.tileSize||512,n.getURL=function(o,s,l){return e.v().clone().G(e.b.og+"/"+(e.b.eg+"/")+(l+"/"+o+"/"+s+"/")+e.b.format).I(e.f).clone().I({size:n.tileSize})},Ek.call(this,n),this.i=e}u(Lp,Ek),t("H.service.rasterTile.Provider",Lp),Lp.prototype.ba=function(e,r){var n=this.i;return Np(n.ba(),n.b.og+"."+n.V(),r,e)},Lp.prototype.getCopyrights=Lp.prototype.ba,Lp.prototype.l=function(){return od()},Lp.prototype.c=function(){return od()?nd():Lp.j.c.call(this)};function X(e){e=yp({},this.b,e);var r=e.apikey||e.apiKey,n=e.baseUrl;if(n=r?n?0:"baseUrl":"apikey")throw new D(X,0,'"'+n+'" must be specified');this.Nk(e.baseUrl),this.a=r,this.Yb.I({apikey:r}),this.c=e.headers||{},this.f=Wa(e.servicesConfig||{})}t("H.service.Platform",X),X.prototype.b={apikey:null,baseUrl:new W("https","hereapi"+(Mn?".cn":".com"))},X.prototype.Nk=function(e){this.Yb=Jp(e.clone()),this.a=e=this.a,this.Yb.I({apikey:e})},X.prototype.setBaseUrl=X.prototype.Nk,X.prototype.Ib=function(){return this.Yb},X.prototype.getBaseUrl=X.prototype.Ib,X.prototype.Ma=function(e,r){try{return e.Qf=!0,new e(yp({platformBaseUrl:this.Ib(),headers:this.c},this.f[e.CONFIG_KEY]||{},r||{}))}finally{e.Qf=!1}},X.prototype.createService=X.prototype.Ma,X.prototype.xf=function(e,r,n){var o=this;if(!H.map.render.harp)throw Error("HARP engine module not found");if(!Ea(e)&&!Cc(e))throw new D(this.xf,0,"is invalid: must be either a configuration object or a URL");if(!Da(r))throw new D(this.xf,1,"is invalid: must be a Function");if(!Da(n))throw new D(this.xf,2,"is invalid: must be a Function");var s=new H.map.render.harp.Style(e);s.addEventListener("change",function(){var l=s.getState();if(l===-1)n(Error("H.service.platform#createHybridLayers method failed to load style configuration"));else if(l===2){l={dark:!0};var h=o.lh({resource:"background",queryParams:{style:"satellite.day"}}),d=s.qc(),y={styles:[{technique:"raster",attr:{gamma:1,brightness:1}}]};d.definitions&&(d.definitions["Satellite.Texture.Gamma"]!==void 0&&(y.styles[0].attr.gamma=d.definitions["Satellite.Texture.Gamma"]),d.definitions["Satellite.Texture.Brightness"]!==void 0&&(y.styles[0].attr.brightness=d.definitions["Satellite.Texture.Brightness"])),h=new Lp(h,{engineType:Qn,style:new H.map.render.harp.Style(y)}),r({raster:new sl(h,l),vector:o.He().$b(s,{engineType:Qn},l),traffic:o.oh().$b(s,{engineType:Qn},l)})}}),s.load()},X.prototype.createHybridLayers=X.prototype.xf,X.prototype.wf=function(e,r,n,o,s,l){function h(_h,_p,pd){_p=_h.f(_p),_p=I?new ti(_p):new H.map.render.harp.Style(_p);var oy={engineType:g};m&&m.politicalView&&(oy.politicalView=m.politicalView),n&&(oy.lg=n),o&&(oy.lg2=o),l&&(oy.pois=l);var ny;return pd&&(ny={dark:pd}),_h.$b(_p,oy,ny)}function d(_h,_p,pd,oy,ny){return _h.nc(_p,pd,V,oy,q,1,ny,v)}var y=this,g=jk,v={crossOrigin:"anonymous"};if(Ea(e)){var m=e;"crossOrigin"in m&&(v.crossOrigin=m.crossOrigin),e=m.tileSize,r=m.ppi,n=m.lg,o=m.lg2,s=m.style,l=m.pois,m.engineType!==void 0&&(g=m.engineType,v.engineType=g)}var w=g===kk.HARP,I=g===kk.WEBGL,V=e||512,q={};if(0>[72,250,320,500].indexOf(+r)){if(r!==B)throw new D(this.wf,1,r)}else q.ppi=+r;if(n&&(q.lg=n),o&&(q.lg2=o),s&&(q.style=s),l&&(q.pois=!!l),w&&!H.map.render.harp)throw new D(this.wf,0,"HARP engine is not supported, module not found");if(e={},Mn)yp(e,{vector:{normal:{map:h(this.He(),"harp/oslo/normal.day.json")}}});else{s=this.ih();var De=this.ih({type:"aerial"}),_n=this.nh(),ha=_n.ej(q.lg?{lg:q.lg,i18n:!0,engineType:g}:{engineType:g});if(yp(e,{raster:{normal:{xbase:d(s,"xbasetile","normal.day","png8",!1),xbasenight:d(s,"xbasetile","normal.night","png8",!0),base:d(s,"basetile","normal.day","png8",!1),basenight:d(s,"basetile","normal.night","png8",!0),map:d(s,"maptile","normal.day","png8",!1),mapnight:d(s,"maptile","normal.night","png8",!0),trafficincidents:ha,transit:d(s,"maptile","normal.day.transit","png8",!1),labels:d(s,"labeltile","normal.day","png",!1)},satellite:{xbase:d(De,"xbasetile","hybrid.day","jpg",!0),base:d(De,"basetile","hybrid.day","jpg",!0),map:d(De,"maptile","hybrid.day","jpg",!0),labels:d(De,"labeltile","hybrid.day","png",!0)},terrain:{xbase:d(De,"xbasetile","terrain.day","jpg",!1),base:d(De,"basetile","terrain.day","jpg",!1),map:d(De,"maptile","terrain.day","jpg",!1),labels:d(De,"labeltile","terrain.day","png",!1)}}}),w||I){if(yp(e,{vector:{normal:{traffic:_n.dj(void 0,g),trafficincidents:ha}}}),s=this.He(),I?(e.vector.normal.map=h(s,"omv/miami/normal.day.yaml"),e.vector.normal.truck=h(s,"omv/miami/truck.day.yaml")):w&&(e.vector.normal.map=h(s,"harp/oslo/normal.day.json"),e.vector.normal.truck=h(s,"harp/oslo/normal.day.json")),s=this.oh(),w){var ga={ppi:72<r?400:100,size:256<V?512:256,features:"pois:"+(l===!0||Cc(l)&&/[^0]/.test(l)?"all":"disabled")};n&&(ga.lang=n),o&&(ga.lang2=o),m&&m.politicalView&&(ga.pview=m.politicalView),r={dark:!0},De=function(_h,_p,pd,oy,ny){var fy=yp({},ga);return/^explore\./.test(pd)||delete fy.features,_h=y.lh({format:_p,resource:_h,queryParams:yp({style:pd},fy)}),ny=new Lp(_h,{engineType:g,style:ny}),new sl(ny,oy)},yp(e.raster.normal,{base:De("background","png8","explore.day"),basenight:De("background","png8","explore.night",r),map:De("base","png8","explore.day"),mapnight:De("base","png8","explore.night",r),labels:De("label","png","explore.day")}),yp(e.raster.satellite,{xbase:De("background","jpeg","satellite.day",r),base:De("background","jpeg","explore.satellite.day",r),map:De("base","jpeg","explore.satellite.day",r),labels:De("label","png","explore.satellite.day")}),_n=this.He(),yp(e.vector.normal,{mapnight:h(_n,"harp/oslo/normal.night.json",!0),lite:h(_n,"harp/oslo/lite.day.json"),litenight:h(_n,"harp/oslo/lite.night.json",!0),ism:h(_n,"harp/oslo/ism.day.json"),ismnight:h(_n,"harp/oslo/ism.night.json",!0)}),ha={styles:[{technique:"raster",attr:{gamma:["interpolate",["linear"],["zoom"],0,1,13,1.2,17,1.3],brightness:["interpolate",["linear"],["zoom"],0,.7,13,.9,17,1]}}]};for(var _o=[],_l=0;4>_l;_l++){var wc=new H.map.render.harp.Style(JSON.parse(JSON.stringify(ha)));wc=De("background","jpeg","satellite.day",r,wc),_o.push(wc)}e.hybrid={day:{raster:_o[0],vector:h(_n,"harp/oslo/hybrid.day.json",!0),traffic:h(s,"harp/oslo/hybrid.day.json",!0)},night:{raster:_o[1],vector:h(_n,"harp/oslo/hybrid.night.json",!0),traffic:h(s,"harp/oslo/hybrid.night.json",!0)},liteday:{raster:_o[2],vector:h(_n,"harp/oslo/lite.hybrid.day.json",!0),traffic:h(s,"harp/oslo/lite.hybrid.day.json",!0)},litenight:{raster:_o[3],vector:h(_n,"harp/oslo/lite.hybrid.night.json",!0),traffic:h(s,"harp/oslo/lite.hybrid.night.json",!0)}}}r={traffic:{}},r.traffic.map=h(s,I?"traffic/vector.tile.yaml":"harp/oslo/normal.day.json"),w&&(r.traffic.mapnight=h(s,"harp/oslo/normal.night.json"),r.traffic.lite=h(s,"harp/oslo/lite.day.json"),r.traffic.litenight=h(s,"harp/oslo/lite.night.json")),yp(e.vector,r)}}return e},X.prototype.createDefaultLayers=X.prototype.wf;function Op(e,r){if(r=r===void 0?{}:r,!e.Qf)throw new $c(e);Op.j.constructor.call(this);var n=Pp(this,r);if(!n.baseUrl&&!n.platformBaseUrl)throw new D(e,0,'either "baseUrl" or "platformBaseUrl" must be specified');this.i=(n.baseUrl?n.baseUrl:n.platformBaseUrl).clone(),e=n.baseUrl?r:n,e.host&&this.i.af(e.host),e.subDomain&&this.i.Ba(e.subDomain),e.path&&this.i.wd(e.path),Jp(this.i),this.g=n.headers||{}}u(Op,F),t("H.service.Service",Op);function Pp(e,r){return e=e.Aa(),r?yp({},e,r):e}Op.prototype.Aa=function(){return{}},Op.prototype.v=function(){return this.i},Op.prototype.getUrl=Op.prototype.v,Op.prototype.B=function(e,r,n,o){return o=new tf(o===void 0?"application/json":o,e.toString(),je,{headers:this.g}),o.then(r,Qp(this,e,n)),o};function Qp(e,r,n){return function(o){return typeof o.json!="function"?Promise.reject(n(Rp(r,o))):o.json().then(function(s){return n(e.a(s))},function(){return n(Rp(r,o))})}}Op.prototype.a=function(e){return Error(e.message)};function Rp(e,r){return Error((r.statusText?"["+r.statusText+"] ":"")+e+" request failed")}function Sp(e){Sp.j.constructor.call(this,Sp,e)}u(Sp,Op),t("H.service.traffic.Service7",Sp),Sp.prototype.Aa=function(){return{subDomain:"data.traffic",path:"v7"}},Sp.CONFIG_KEY="traffic_v7",Sp.prototype.qo=function(e,r,n,o){return e=this.v().clone().G(["incidents",e].join("/")).I(r||{}),this.B(e,n,o)},Sp.prototype.requestIncidentById=Sp.prototype.qo,Sp.prototype.oo=function(e,r,n){return e=this.v().clone().G("flow").I(e||{}),this.B(e,r,n)},Sp.prototype.requestFlowByArea=Sp.prototype.oo,Sp.prototype.so=function(e,r,n){return e=this.v().clone().G("incidents").I(e||{}),this.B(e,r,n)},Sp.prototype.requestIncidentsByArea=Sp.prototype.so;function Tp(e){if(!e||!Da(e.requestData))throw new D(Tp,0,"options.requestData");Tp.j.constructor.call(this,e),this.L=e.requestData,this.D=!!e.providesDomMarkers}u(Tp,S),t("H.map.provider.MarkerTileProvider",Tp),Tp.prototype.B=function(e,r,n,o,s){var l=this;return this.L(e,r,n,function(h){for(var d=[],y,g,v=h.length;v--;)g=h[v],g.Ho=l.getTileKey(e,r,n),g.ka(l),y=g.xb(),(C(g,bj)||y.getState()===1)&&d.push(h[v]);o(d)},s)},Tp.prototype.requestInternal=Tp.prototype.B,Tp.prototype.Td=function(e,r){r===kh.VISUAL&&(e=this.nb().get(e.Ho))&&(e.valid=!1,this.Va(e))},Tp.prototype.invalidateObject=Tp.prototype.Td,Tp.prototype.Qb=function(){return this.D},Tp.prototype.providesDomMarkers=Tp.prototype.Qb,Tp.prototype.Rb=ff,Tp.prototype.providesMarkers=Tp.prototype.Rb;function Up(){this.a={}}Up.prototype.xb=function(e,r){var n=e+r,o;return(o=this.a[n])?o:(e=Vp.MARKER.replace("{{icon}}",Wp[e]||Wp.OTHER),e=e.replace("{{color}}",Xp[r]||Xp.BLOCKING),r={size:{w:26,h:33},anchor:{x:13,y:30},hitArea:new Xi(Yi.POLYGON,Yp.MARKER)},this.a[n]=o=new Wj(e,r))};var Vp={MARKER:'<svg width="26" height="33" enable-background="new 0 0 26 33" viewBox="0 0 26 33" xmlns="http://www.w3.org/2000/svg"><path d="m26 33h-26v-33h26z" fill="#8c8c8c" opacity="0"/><path d="m17 29.566c0 1.116-1.791 2.022-4 2.022s-4-.906-4-2.022c0-1.118 1.791-2.026 4-2.026s4 .908 4 2.026" fill="#878787" opacity=".6"/><path d="m1.795 17.971c-1.562-1.555-1.574-3.828-.028-5.655l8.343-10.021c.769-.895 1.795-1.384 2.894-1.384 1.117 0 2.197.521 2.889 1.394l8.338 10.014c1.588 1.854 1.578 4.022-.029 5.65l-11.202 11.202z" fill="{{color}}"/>{{icon}}</svg>'},Wp={CONGESTION:'<path style="fill:#FFFFFF;" d="M12.966,1.177c0.965,0,1.894,0.442,2.496,1.204l8.378,10.258c1.362,1.592,1.482,3.477,0,4.979L12.994,28.464L2.143,17.618c-1.381-1.375-1.38-3.348,0-4.979l8.314-10.258C11.174,1.547,12.085,1.177,12.966,1.177 M12.967,0.177L12.967,0.177c-1.247,0-2.408,0.551-3.269,1.552l-8.332,10.28c-1.711,2.022-1.688,4.567,0.07,6.317l10.85,10.845l0.707,0.707l0.707-0.707l10.847-10.846c1.784-1.807,1.803-4.292,0.053-6.337L16.237,1.748C15.462,0.769,14.236,0.177,12.967,0.177L12.967,0.177z M16.645,10.405l-2.025-2.22c-0.48-0.51-1.15-0.8-1.84-0.8H9.53c-0.69,0-1.36,0.29-1.84,0.8l-1.94,2.22c-0.39,0.63-0.59,1.35-0.59,2.09v1.64c0,0.69,0.56,1.25,1.25,1.25h1.44l0.255-0.539c0.204-0.431,0.456-0.837,0.753-1.21l0.962-1.211l0.83-0.9c0.32-0.35,0.72-0.63,1.15-0.82H8.23c-0.28,0-0.55-0.07-0.79-0.22l-0.28-0.17l1.27-1.45c0.28-0.31,0.68-0.48,1.1-0.48h3.25c0.42,0,0.82,0.17,1.1,0.48l1.354,1.54H16.645z M18.31,12.205c-0.35-0.37-0.81-0.63-1.3-0.74c-0.18-0.04-0.36-0.06-0.54-0.06h-3.24c-0.7,0-1.37,0.29-1.84,0.8l-1.13,1.22l-0.82,1c-0.38,0.63-0.59,1.35-0.59,2.09v1.64c0,0.69,0.56,1.25,1.25,1.25h1.75v-1h5.99v1h1.75c0.69,0,1.25-0.56,1.25-1.25v-1.64c0-0.74-0.2-1.46-0.59-2.09L18.31,12.205z M12.1,17.105h-1c-0.138,0-0.25-0.112-0.25-0.25v-1c0-0.138,0.112-0.25,0.25-0.25h1c0.138,0,0.25,0.112,0.25,0.25v1C12.35,16.993,12.238,17.105,12.1,17.105z M18.59,17.105h-1c-0.138,0-0.25-0.112-0.25-0.25v-1c0-0.138,0.112-0.25,0.25-0.25h1c0.138,0,0.25,0.112,0.25,0.25v1C18.84,16.993,18.728,17.105,18.59,17.105z M18.56,14.505c-0.24,0.15-0.51,0.22-0.79,0.22h-5.85c-0.28,0-0.55-0.07-0.78-0.22l-0.29-0.17l1.27-1.45c0.15-0.16,0.33-0.28,0.53-0.37c0.18-0.07,0.38-0.11,0.58-0.11h3.24c0.24,0,0.48,0.06,0.68,0.16c0.16,0.08,0.3,0.19,0.42,0.32l1.27,1.45L18.56,14.505z M8.42,13.03h-1c-0.138,0-0.25-0.112-0.25-0.25v-1c0-0.138,0.112-0.25,0.25-0.25h1c0.138,0,0.25,0.112,0.25,0.25v1C8.67,12.918,8.559,13.03,8.42,13.03z"/>',ROADWORKS:'<path d="m13.004 1.411c.964 0 1.894.441 2.496 1.204l8.346 10.023c1.363 1.592 1.482 3.477 0 4.979l-10.846 10.847-10.852-10.846c-1.381-1.375-1.379-3.348 0-4.979l8.346-10.023c.717-.835 1.628-1.205 2.51-1.205m0-1c-1.248 0-2.408.551-3.268 1.552l-8.356 10.035c-1.718 2.033-1.695 4.578.064 6.328l10.85 10.845.706.707.707-.707 10.846-10.846c1.784-1.808 1.803-4.293.053-6.337l-8.337-10.012c-.769-.973-1.996-1.565-3.265-1.565zm-.575 15.264c.018-.332-.13-.651-.394-.851l-2.945-2.235-.21.36c-.22.39-.41.78-.58 1.19l-.677 2.129-1.364 3.051h1.314l2.109-4.672 1.317 1.212.138 3.46h1.092zm6.16-1.327c-.401-.54-1.209-.539-1.609.001l-1.17 1.58-2.29-1.74-.139-4.054c-.011-.276-.134-.535-.342-.716l-.7-.61c-.185-.161-.422-.25-.667-.25h-1.885c-.335 0-.648.168-.833.447l-1.144 1.723 7.58 5.76-1.86 2.51c-.098.132-.004.32.161.32h6.648l1.142-1.077zm-8.79-2.989-.876-.665.841-1.018.965.043zm1.63 1.24.969-1.781.118 2.61zm2.76-5.79c-.64 0-1.16.52-1.16 1.16 0 .65.52 1.17 1.16 1.17s1.16-.52 1.16-1.17c0-.64-.52-1.16-1.16-1.16z" fill="#fff"/>',ACCIDENT:'<path style="fill:#FFFFFF;" d="M12.998,1.091c0.964,0,1.894,0.442,2.496,1.204l8.346,10.344c1.363,1.592,1.482,3.477,0,4.979L12.994,28.465L2.143,17.618c-1.381-1.375-1.379-3.348,0-4.979l8.346-10.344C11.205,1.462,12.115,1.091,12.998,1.091 M12.998,0.091L12.998,0.091c-1.248,0-2.408,0.551-3.269,1.552L1.364,12.011c-1.708,2.021-1.685,4.566,0.073,6.316l10.85,10.845l0.707,0.707l0.707-0.707l10.846-10.846c1.784-1.808,1.803-4.293,0.053-6.337l-8.327-10.32C15.494,0.684,14.268,0.091,12.998,0.091L12.998,0.091z M7.83,18.982l-3.309-1.855l0.945,1.855H7.83z M16.111,19h3.942l1.596-2L16.111,19z M10.512,20.064l1.021-1.021l1.632,0.076c0.329,0.018,0.651-0.022,0.963-0.123c0.626-0.206,1.122-0.76,1.288-1.44l0.264-1.089l2.066-0.93c0.373-0.17,0.673-0.42,0.861-0.731c0.275-0.449,0.405-0.97,0.369-1.498L18.9,11.676l1.021-1.021l-0.724-0.724l-0.427,0.427l-0.121-0.364c-0.201-0.603-0.54-1.151-0.989-1.6l-1.159-1.159c-0.5-0.5-1.31-0.5-1.809,0l-1.267,1.267l0.724,0.724l-5.066,5.066l-0.724-0.724l-1.267,1.267c-0.5,0.5-0.5,1.31,0,1.809l1.159,1.159c0.449,0.449,0.997,0.788,1.6,0.989l0.364,0.121l-0.427,0.427L10.512,20.064z M14.901,10.349l0.732-0.732c0.098-0.098,0.256-0.098,0.354,0l0.732,0.732c0.098,0.098,0.098,0.256,0,0.354l-0.732,0.732c-0.098,0.098-0.256,0.098-0.354,0l-0.732-0.732C14.803,10.604,14.803,10.446,14.901,10.349z M9.472,15.777l0.732-0.732c0.098-0.098,0.256-0.098,0.354,0l0.732,0.732c0.098,0.098,0.098,0.256,0,0.354l-0.732,0.732c-0.098,0.098-0.256,0.098-0.354,0L9.472,16.13C9.375,16.033,9.375,15.874,9.472,15.777z M11.391,17.615c0.069-0.271,0.206-0.518,0.405-0.717l4.961-4.961c0.195-0.195,0.445-0.337,0.717-0.405l0.344-0.083l0.137,1.925c0.022,0.318-0.058,0.63-0.221,0.901c-0.101,0.166-0.279,0.271-0.409,0.329L14.8,15.74l-0.38,1.574c-0.083,0.344-0.318,0.615-0.612,0.713c-0.188,0.058-0.38,0.083-0.579,0.072l-1.925-0.138L11.391,17.615z"/>',OTHER:'<path style="fill:#FFFFFF;" d="M13.004,1.411c0.964,0,1.894,0.441,2.496,1.204l8.346,10.023c1.363,1.592,1.482,3.477,0,4.979L13,28.465L2.148,17.618c-1.381-1.375-1.379-3.348,0-4.979l8.346-10.023C11.211,1.781,12.122,1.411,13.004,1.411 M13.004,0.411L13.004,0.411c-1.248,0-2.408,0.551-3.268,1.552L1.38,11.998c-1.718,2.033-1.694,4.579,0.064,6.328l10.85,10.845L13,29.878l0.707-0.707l10.846-10.846c1.784-1.808,1.803-4.293,0.053-6.337L16.269,1.976C15.5,1.003,14.273,0.411,13.004,0.411L13.004,0.411z M14.716,20.139c0,0.947-0.758,1.724-1.724,1.724c-0.947,0-1.704-0.777-1.704-1.724c0-0.928,0.757-1.704,1.704-1.704C13.958,18.435,14.716,19.211,14.716,20.139z M14.204,16.33H11.78l-0.537-8.533h3.5L14.204,16.33z"/>'},Xp={BLOCKING:"#323232",VERYHIGH:"#d5232f",HIGH:"#ffa100"},Yp={MARKER:[24.1,17.8,14.2,28.42,16.8,29.4,12.8,31.4,8.79,29.4,11.23,28.42,1.7,17.8,1.7,12.1,10,1.9,12.9,.498,15.8,1.9,24.1,12.1,24.1,17.8]};function Zp(e,r,n){n=n||{},n.criticality||(n.criticality="major,critical"),C(e,$p,Zp,0),Tp.call(this,{max:20,min:8,requestData:A(this.T,this),engineType:n.engineType}),this.f=new Up,this.u=e,this.i=n,this.reload=A(this.reload,this),this.m=setInterval(this.reload,r||18e4)}u(Zp,Tp),t("H.service.traffic.incidents.Provider",Zp);var aq={minor:"HIGH","low impact":"HIGH",major:"VERYHIGH",critical:"BLOCKING"};Zp.prototype.T=function(e,r,n,o,s){var l=this,h=this.f;return this.u.requestIncidentsByTile(e,r,n,function(d){var y=[];d=d.TRAFFIC_ITEMS;var g;if(d)for(d=d.TRAFFIC_ITEM,g=d.length;g--;){var v=d[g],m=v.TRAFFIC_ITEM_TYPE_DESC;switch(m){case"ACCIDENT":case"CONGESTION":var w=m;break;case"CONSTRUCTION":w="ROADWORKS";break;default:w="OTHER"}w=h.xb(w,aq[v.CRITICALITY.DESCRIPTION]),m=v.LOCATION.GEOLOC.ORIGIN,m=new Rn({lat:m.LATITUDE,lng:m.LONGITUDE},{provider:l,icon:w}),m.setData(v),y.push(m)}o(y)},s,this.i)},Zp.prototype.F=function(){Tp.prototype.F.call(this),clearInterval(this.m)},Zp.prototype.dispose=Zp.prototype.F;var bq="A21 A22 F01 F02 F08 F04 F05 F07 F03 F06 A2F F13 A25 A2C F12 D1B F1B A27 E12 A3A A24 A3D A3F F1F F25 F2C E32 A33 F29 D26 D36 F26 D0F F0F F2B E0C D3A A45 D23 D11 F2E F19 F14 F39 A4A A4B A5C D38 F2A F1A D0A F1C A48 D25 D1D F32 A46 A3E D24 E1C E32 A5F D2E D22 D0A".split(" ");function cq(e,r,n,o){cq.j.constructor.call(this,{min:10,max:21,engineType:o}),C(e,$p,cq,0),this.m=e,this.f=n||dq,this.f.responseattributes="sh,fc",this.i=setInterval(A(this.reload,this),r||18e4),this.b===kk.WEBGL?this.Qa(new ti(Ao()+"/traffic/flow.yaml"),!0):this.Qa(new H.map.render.harp.Style({styles:[{when:["==",["geometry-type"],"LineString"],technique:"solid-line",renderOrder:10002,attr:{color:["case",[">=",["get","JF"],10],"black",[">=",["get","JF"],8],"red",[">=",["get","JF"],4],"yellow","green"],lineWidth:3,metricUnit:"Pixel"}}]}))}u(cq,S),t("H.service.traffic.flow.Provider",cq),cq.prototype.ei=ff,cq.prototype.providesGeoJSON=cq.prototype.ei,cq.prototype.V=function(){return this.Ya()},cq.prototype.getStyle=cq.prototype.V,cq.prototype.gb=function(e){e.a&&e.a("GeoJSONTileSource"),this.Qa(e)},cq.prototype.setStyle=cq.prototype.gb;var dq={locationreferences:"tmc,shp"};cq.prototype.o=function(){cq.j.o.call(this),clearInterval(this.i)},cq.prototype.B=function(e,r,n,o,s){return this.m.requestFlowByTile(e,r,n,function(l){l.type&&l.type.indexOf("Error")!==-1?s(l.Details):o(l)},s,this.f)},cq.prototype.requestInternal=cq.prototype.B,cq.prototype.ac=function(e,r,n,o,s){var l,h,d,y,g={type:"FeatureCollection",features:[]},v,m=o.RWS.length;for(l=0;l<m;l++){var w=o.RWS[l],I=w.RW,V=I.length,q=bq.indexOf(w.EXTENDED_COUNTRY_CODE+w.EBU_COUNTRY_CODE)!==-1;for(w=0;w<V;w++){var De=I[w].FIS,_n=De.length;for(De=0;De<_n;De++){var ha=I[w].FIS[De].FI,ga=ha.length;for(h=0;h<ga;h++){var _o=ha[h],_l=[],wc=_o.CF[0],_h=!!wc.SSS,_p={type:"Feature",properties:wc,geometry:{type:"MultiLineString",coordinates:_l}};for(_p.properties.LHT=q,_o.SHP.length&&(_p.properties.FC=_o.SHP[0].FC),_h&&(v=[]),wc=0;wc<_o.SHP.length;wc++){var pd=_o.SHP[wc].value,oy=pd.length;for(d=0;d<oy;d++){var ny=_h?v:void 0,fy=new qo(pd[d].trim()),wy=[],cy={};for(fy.ge();(y=fy.Pb())!==-1;)y===eq?(cy.lat=+String.fromCharCode.apply(cq,fy.Gd()),fy.next(),fy.ge()):y===fq?(cy.lng=+String.fromCharCode.apply(cq,fy.Gd()),wy.push([cy.lng,cy.lat]),ny&&ny.push(ng(cy)),cy=[],fy.next(),fy.ge()):fy.next();cy.lng=+String.fromCharCode.apply(cq,fy.Gd()),wy.push([cy.lng,cy.lat]),ny&&ny.push(ng(cy)),y=wy,_l.push(y)}}g.features.push(_p)}}}}return cq.j.ac.call(this,e,r,n,g,s)},cq.prototype.createTileInternal=cq.prototype.ac;var fq=32,eq=44;function gq(e){function r(v){o.contains(s)&&o.removeChild(s),g&&clearTimeout(g),delete gq.a[l],v&&e.pj&&e.pj.call(y,v)}if(!e.url||!e.Og)throw Error('Parameter "options" must specify at least a URL and a callback.');if(typeof e.Og!="function")throw Error("Parameters options.callback must be a function");var n=e.cp||document,o=n.getElementsByTagName("head")[0],s=n.createElement("script");n=e.url instanceof W?e.url:Dp(e.url,e.bp);var l=gq.b++,h=e.vl||"callback",d=e.Og,y={},g=null;return y.id=l,y.cancel=function(){r("cancelled")},e.timeout!==0&&(g=x.setTimeout(function(){r("timeout")},e.timeout||3e4)),gq.a[l]=function(v){r(),d.call(y,v)},s.type="text/javascript",s.src=n.toString()+(n.Mj()?"&":"?")+h+"="+(e.ep?"H.service.jsonp.handleResponse("+l+")":encodeURI("H.service.jsonp.handleResponse("+l+")")),o.appendChild(s),y}t("H.service.jsonp",gq),gq.mn=function(e){return(e=gq.a[e])?e:function(){}},gq.handleResponse=gq.mn,gq.b=0,gq.a={};function $p(e){$p.j.constructor.call(this,$p,e),this.c=Pp(this,e).callbackKey,this.b=!1}u($p,Op),t("H.service.traffic.Service",$p),$p.prototype.Aa=function(){return{subDomain:"traffic.ls",path:"traffic/6.1",callbackKey:"jsoncallback"}},$p.CONFIG_KEY="traffic",$p.prototype.dj=function(e,r){return new sl(new cq(this,void 0,e,r),{max:22})},$p.prototype.createFlowLayer=$p.prototype.dj,$p.prototype.ej=function(e){return new Sn(new Zp(this,void 0,e))},$p.prototype.createIncidentsLayer=$p.prototype.ej;function hq(e,r,n,o){return e.b||(zp($p,"Use HERE Traffic API v7 instead."),e.b=!0),gq({url:r,Og:n,pj:function(s){o(Error("["+s+"] "+r+" request failed"))},vl:e.c})}$p.prototype.ro=function(e,r,n){return e=this.v().clone().G("incidents.json").I(e),hq(this,e,r,n)},$p.prototype.requestIncidents=$p.prototype.ro,$p.prototype.po=function(e,r,n,o,s,l){return e=this.v().clone().G(["flow/json",n,e,r].join("/")).I(l||{}),hq(this,e,o,s)},$p.prototype.requestFlowByTile=$p.prototype.po,$p.prototype.to=function(e,r,n,o,s,l){return e=this.v().clone().G(["incidents/json",n,e,r].join("/")).I(l||{}),hq(this,e,o,s)},$p.prototype.requestIncidentsByTile=$p.prototype.to,X.prototype.nh=function(e,r){if(r=r||6,r===6)r=$p;else if(r===7)r=Sp;else throw new D(this.nh,1,"allowed values are 6 and 7");return this.Ma(r,e)},X.prototype.getTrafficService=X.prototype.nh;function iq(e){iq.j.constructor.call(this,iq,e),this.b=Pp(this,e).reverseSubDomain,zp(iq,"Use HERE Geocoding and Search API v7 instead.")}u(iq,Op),t("H.service.GeocodingService",iq),iq.prototype.Aa=function(){return{subDomain:"geocoder.ls",reverseSubDomain:"reverse",path:"6.2"}},iq.CONFIG_KEY="geocoding",iq.prototype.a=function(e){return Error(e.Details||e.message||e.error)},iq.prototype.Zg=function(e,r,n){return e=this.v().clone().G("geocode.json").I(e),this.B(e,r,n)},iq.prototype.geocode=iq.prototype.Zg,iq.prototype.ii=function(e,r,n){return e=this.v().clone().G("reversegeocode.json").I(e),this.b&&e.Ba(this.b),this.B(e,r,n)},iq.prototype.reverseGeocode=iq.prototype.ii,iq.prototype.search=function(e,r,n){return e=this.v().clone().G("search.json").I(e),this.B(e,r,n)},iq.prototype.search=iq.prototype.search,X.prototype.km=function(e){return this.Ma(iq,e)},X.prototype.getGeocodingService=X.prototype.km;function jq(e){zp(jq,"Use HERE Geocoding and Search API v7 instead."),jq.j.constructor.call(this,jq,e)}u(jq,Op),t("H.service.PlacesService",jq),jq.prototype.Aa=function(){return{subDomain:"places.ls",path:"places/v1"}},jq.CONFIG_KEY="places",jq.EntryPoint={SEARCH:"discover/search",SUGGEST:"suggest",EXPLORE:"discover/explore",AROUND:"discover/around",HERE:"discover/here",CATEGORIES:"categories/places"},jq.prototype.request=function(e,r,n,o){return kq(this,e,r,n,o)},jq.prototype.request=jq.prototype.request;function kq(e,r,n,o,s){return r=e.v().clone().G(r).I(n||{}),e.B(r,o,s)}jq.prototype.search=function(e,r,n){return kq(this,"discover/search",e,r,n)},jq.prototype.search=jq.prototype.search,jq.prototype.Go=function(e,r,n){return kq(this,"suggest",e,r,n)},jq.prototype.suggest=jq.prototype.Go,jq.prototype.Fl=function(e,r,n){return kq(this,"discover/explore",e,r,n)},jq.prototype.explore=jq.prototype.Fl,jq.prototype.rl=function(e,r,n){return kq(this,"discover/around",e,r,n)},jq.prototype.around=jq.prototype.rl,jq.prototype.on=function(e,r,n){return kq(this,"discover/here",e,r,n)},jq.prototype.here=jq.prototype.on,jq.prototype.wl=function(e,r,n){return kq(this,"categories/places",e,r,n)},jq.prototype.categories=jq.prototype.wl,jq.prototype.Gl=function(e,r,n,o){return e=Dp(e).I(this.v().getQuery()).I(o||{}),this.B(e,r,n)},jq.prototype.follow=jq.prototype.Gl,X.prototype.Im=function(e){return this.Ma(jq,e)},X.prototype.getPlacesService=X.prototype.Im;function lq(){this.a={}}function mq(e,r){for(var n in r)if(r.hasOwnProperty(n)){var o,s=r[n],l=e.a[n]||(e.a[n]=[]),h=s.length;for(o=0;o<h;o++)l.push(new nq(s[o]))}}function Np(e,r,n,o){var s=(e=e.a[r])?e.length:0,l=[];for(r=0;r<s;r++)e[r].nd(n,o)&&l.push(e[r]);return l}function nq(e){var r,n=e.boxes;if(this.label=e.label,this.min=e.minLevel,this.max=e.maxLevel,this.b=[],n&&(r=n.length)){var o=n[0],s=new K(o[0],o[1],o[2],o[3]);for(this.b.push(s),this.a=new K(o[0],o[1],o[2],o[3]),e=1;e<r;e++)o=n[e],s=new K(o[0],o[1],o[2],o[3]),this.b.push(s),this.a.ec(s,!1,this.a)}}nq.prototype.nd=function(e,r){if(e>=this.min&&e<=this.max)if((e=this.b.length)&&this.a){if(this.a.nd(r)){for(;e--;)if(this.b[e].nd(r))return!0}}else return!0;return!1};function oq(e,r,n){var o=this,s=n||{},l=+s.min,h=+s.max;s.tileSize=s.tileSize||512,s.min=l?ae(l,1,17):1,s.min+=Pk(s.tileSize,1),s.max=h?ae(h,1,17):17,oq.j.constructor.call(this,s),C(e,pq,oq,0),C(r,Wh,oq,1),this.i=e,r.a&&r.a("OMV"),this.Qa(r,!0),this.m=!1,n&&(n.politicalView&&(this.u=n.politicalView),qq(this,n.lg,n.lg2),this.m=!!n.pois),this.aa=function(){o.T=xp(o),o.reload(!1)},e.addEventListener("versionupdate",this.aa),this.T=xp(this),oq.prototype.qa=function(){var d=/^v2\/vectortiles\/(.+)\/mc$/.exec(e.v().b);return d?d[1]:B+""}()}u(oq,S),t("H.service.omv.Provider",oq),oq.prototype.Sb=ff,oq.prototype.providesOMV=oq.prototype.Sb,oq.prototype.ub=function(e){return this.T.test(e)},oq.prototype.cacheFilter=oq.prototype.ub,oq.prototype.uc=function(e,r,n){return rq(this.i,e,r,n).toString()},oq.prototype.getTileKey=oq.prototype.uc,oq.prototype.nb=function(){return this.xa},oq.prototype.getCache=oq.prototype.nb,oq.prototype.Lm=function(){return this.u},oq.prototype.getPoliticalView=oq.prototype.Lm,oq.prototype.yo=function(e){var r=this.u;this.u=e,this.dispatchEvent(new cj("politicalviewchange",this.u,r))},oq.prototype.setPoliticalView=oq.prototype.yo,oq.prototype.MAX_STORE_TIME=2592e6,oq.prototype.l=function(){return od()},oq.prototype.c=function(){return od()?nd():oq.j.c.call(this)},oq.prototype.s=function(){return this.i},oq.prototype.B=function(e,r,n,o,s){return this.i.Ha(e,r,n,o,s)},oq.prototype.requestInternal=oq.prototype.B,oq.prototype.gb=function(e){e.a&&e.a("OMV"),this.Qa(e)},oq.prototype.setStyle=oq.prototype.gb,oq.prototype.V=function(){return oq.j.Ya.apply(this)},oq.prototype.getStyle=oq.prototype.V,oq.prototype.Ya=function(){var e=oq.j.Ya.apply(this),r=e.getState()===Xh.READY,n=e.qc();return r&&n&&n.global&&(this.D&&(this.R&&(n.global.ux_language=this.R),this.L&&(n.global.ux_language_fallback=this.L)),this.m&&n.global.poi&&n.global.poi.default&&(n.global.poi.default.visible=this.m),this.D||this.m)&&(e=new ti(n,e.Ib())),e},oq.prototype.getStyleInternal=oq.prototype.Ya;function qq(e,r,n){var o=Cc(r),s=Cc(n);o&&(e.R=r),s&&(e.L=n),(o||s)&&(e.f=[],o=/^([a-zA-Z]{2})(-|$)/,(s=o.exec(r))&&(s[1]==="zh"?e.f.push(r):e.f.push(s[1])),(s=o.exec(n))&&(s[1]==="zh"?e.f.push(n):e.f.push(s[1])),e.D=!0)}oq.prototype.D=!1;var sq=["en"];oq.prototype.hh=function(){return this.f||sq},oq.prototype.getLanguages=oq.prototype.hh,oq.prototype.o=function(){oq.j.o.call(this),this.i.removeEventListener("versionupdate",this.aa)},oq.prototype.xa=new Rk(256),oq.prototype.ba=function(e,r){return Np(this.i.ba(),this.qa,r,e)},oq.prototype.getCopyrights=oq.prototype.ba;function pq(e){pq.j.constructor.call(this,pq,e);var r=Pp(this,e).mapVersion;this.l=e.queryParams||{},this.b=vc(r)?r:tq[this.v().toString()],vc(this.b)||uq(this)}u(pq,Op),t("H.service.omv.Service",pq),pq.prototype.Aa=function(){return{subDomain:"vector",path:"v2/vectortiles/base/mc"}},pq.CONFIG_KEY="omv";var tq={};Ic(tq),pq.prototype.Am=function(){return this.b},pq.prototype.getMapVersion=pq.prototype.Am;function uq(e){e.B(e.v().clone().G("../../info"),function(r){r=r.mapVersion;var n=e.v().toString();e.b=r,r!==tq[n]&&(tq[n]=r,e.dispatchEvent("versionupdate"))},function(){})}pq.prototype.$b=function(e,r,n){r=r||{};var o={min:0,max:22};return Ea(n)&&yp(o,n),Mn&&(r.min=o.min=4),new sl(new oq(this,e,r),o)},pq.prototype.createLayer=pq.prototype.$b,pq.prototype.Ha=function(e,r,n,o,s){return this.B(rq(this,e,r,n),function(l){return l.arrayBuffer().then(o,s)},s,"arraybuffer")};function rq(e,r,n,o){return r=e.v().clone().G(o+"/"+r+"/"+n+"/omv"),vc(e.b)&&r.I({mv:e.b}).I(e.l),r}pq.prototype.f=function(e){return Ao()+"/"+e},pq.prototype.Je=function(e,r){if(!Da(e))throw new D(this.Je,0,'"onResult" must be a function');if(!Da(r))throw new D(this.Je,1,'"onError" must be a function');return this.B(this.v().clone().wd("v2/vectortiles/pviews"),e,r)},pq.prototype.getPoliticalViews=pq.prototype.Je,X.prototype.He=function(e){return this.Ma(pq,e)},X.prototype.getOMVService=X.prototype.He,pq.prototype.s=function(e){mq(this.c,e),this.dispatchEvent("copyrightupdate")},pq.prototype.ba=function(){return this.c||(this.c=new lq,this.B(this.v().clone().G("../../copyrights"),A(this.s,this),ld)),this.c},pq.prototype.getCopyrights=pq.prototype.ba;function vq(e){vq.j.constructor.call(this,vq,e),this.b=e.getToken}u(vq,Op),t("H.service.iml.Service",vq),vq.prototype.Aa=function(){return{host:"interactive.data.api.platform.here.com",path:"interactive/v1/catalogs"}},vq.prototype.a=function(e){function r(){for(var o=ea(n),s=o.next();!s.done;s=o.next()){s=s.value;var l=s.format;if(s.keys.every(function(h){return e[h]}))return l()}return JSON.stringify(e)}var n=[{keys:["code","title","cause","action"],format:function(){return e.code+": "+e.title+"; cause: "+e.cause+"; action: "+e.action}},{keys:["error","error_description"],format:function(){return e.error+": "+e.error_description}},{keys:["error","errorMessage"],format:function(){return e.error+": "+e.errorMessage}}];return Error(Ea(e)?r():e)},vq.prototype.Qd=function(e,r,n,o,s){var l=this.Qd;return wq(l,0,e,r),xq(l,2,n,o),e=this.v().clone().G(e+"/layers/"+r+"/statistics").I(s||{}),yq(this,e,"GET",n,o)},vq.prototype.getStatistics=vq.prototype.Qd,vq.prototype.Ff=function(e,r,n,o,s,l,h,d,y){var g=y?"":".mvtf";return e=this.v().clone().G(o+"/layers/"+s+"/tile/web/"+n+"_"+e+"_"+r+g).I(Object.assign({clip:!0},d)),yq(this,e,"GET",y?l:function(v){return v.arrayBuffer().then(l)},h,void 0,y?"application/json":"arraybuffer")},vq.prototype.getFeaturesByTile=vq.prototype.Ff,vq.prototype.wj=function(e,r,n,o,s,l){var h=this.wj;return zq(h,e),wq(h,1,r,n),xq(h,3,o,s),e=Aq(this,e,r,n,l),yq(this,e,"GET",o,s)},vq.prototype.getFeatureById=vq.prototype.wj,vq.prototype.Sc=function(e,r,n,o,s,l){var h=this.Sc;return Bq(h,e),wq(h,1,r,n),xq(h,3,o,s),e=Dq(this,e,r,n,l),yq(this,e,"GET",o,s)},vq.prototype.getFeaturesById=vq.prototype.Sc,vq.prototype.Jd=function(e,r,n,o,s){var l=this.Jd;if(!Ea(e)||!(e.bbox||e.north&&e.east&&e.south&&e.west))throw new D(l,0,'must be an object with either "bbox" or a full set of "north", "east", "south" and "west"');return wq(l,1,r,n),xq(l,3,o,s),e=this.v().clone().G(r+"/layers/"+n+"/bbox").I(e),yq(this,e,"GET",o,s)},vq.prototype.getFeaturesByBoundingBox=vq.prototype.Jd,vq.prototype.yj=function(e,r,n,o,s){var l=this.yj;if(!(Ea(e)&&e.radius&&(e.lat&&(e.lng||e.lon)||e.refCatalogHrn&&e.refLayerId&&e.refFeatureId)))throw new D(l,0,'must be an object with "radius" and a combination of either "lat"+"lng" or "refCatalogHrn"+"refLayerId"+"refFeatureId"');return wq(l,1,r,n),xq(l,3,o,s),e=this.v().clone().G(r+"/layers/"+n+"/spatial").I(e),yq(this,e,"GET",o,s)},vq.prototype.getFeaturesByPointAndRadius=vq.prototype.yj,vq.prototype.xj=function(e,r,n,o,s,l){var h=this.xj;if(!Ea(e)||!e.radius)throw new D(h,0,'must be an object with "radius"');return Eq(h,1,r),wq(h,2,n,o),xq(h,4,s,l),e=this.v().clone().G(n+"/layers/"+o+"/spatial").I(e),yq(this,e,"POST",s,l,r)},vq.prototype.getFeaturesByGeometryAndRadius=vq.prototype.xj,vq.prototype.Jk=function(e,r,n,o,s){var l=this.Jk;return wq(l,0,e,r),xq(l,2,n,o),e=this.v().clone().G(e+"/layers/"+r+"/search").I(s||{}),yq(this,e,"GET",n,o)},vq.prototype.searchFeatures=vq.prototype.Jk,vq.prototype.Wj=function(e,r,n,o,s){var l=this.Wj;return wq(l,0,e,r),xq(l,2,n,o),e=this.v().clone().G(e+"/layers/"+r+"/iterate").I(s||{}),yq(this,e,"GET",n,o)},vq.prototype.iterateFeatures=vq.prototype.Wj,vq.prototype.$c=function(e,r,n,o,s,l){var h=this.$c;return Eq(h,0,e),wq(h,1,r,n),xq(h,3,o,s),r=Fq(this,r,n,l),yq(this,r,"PUT",o,s,e)},vq.prototype.putFeatures=vq.prototype.$c,vq.prototype.Yc=function(e,r,n,o,s,l){var h=this.Yc;return Eq(h,0,e),wq(h,1,r,n),xq(h,3,o,s),r=Fq(this,r,n,l),yq(this,r,"POST",o,s,e)},vq.prototype.postFeatures=vq.prototype.Yc,vq.prototype.hd=function(e,r,n,o,s){var l=this.hd;return Bq(l,e),wq(l,1,r,n),xq(l,3,o,s),e=Dq(this,e,r,n),yq(this,e,"DELETE",o,s)},vq.prototype.deleteFeatures=vq.prototype.hd,vq.prototype.Ck=function(e,r,n,o,s,l,h){var d=this.Ck;return zq(d,e),Eq(d,1,r),wq(d,2,n,o),xq(d,4,s,l),e=Aq(this,e,n,o,h),yq(this,e,"PUT",s,l,r)},vq.prototype.putFeature=vq.prototype.Ck,vq.prototype.wk=function(e,r,n,o,s,l,h){var d=this.wk;return zq(d,e),Eq(d,1,r),wq(d,2,n,o),xq(d,4,s,l),e=Aq(this,e,n,o,h),yq(this,e,"PATCH",s,l,r)},vq.prototype.patchFeature=vq.prototype.wk,vq.prototype.ij=function(e,r,n,o,s){var l=this.ij;return zq(l,e),wq(l,1,r,n),xq(l,3,o,s),e=Aq(this,e,r,n),yq(this,e,"DELETE",o,s,void 0,"text/plain")},vq.prototype.deleteFeature=vq.prototype.ij;function Fq(e,r,n,o){return e.v().clone().G(r+"/layers/"+n+"/features").I(o||{})}function Dq(e,r,n,o,s){return r=Object.assign({},s,{id:new Hp(r)}),Fq(e,n,o,r)}function Aq(e,r,n,o,s){return e.v().clone().G(n+"/layers/"+o+"/features/"+r).I(s||{})}function yq(e,r,n,o,s,l,h){return h=h===void 0?"application/json":h,n={method:n,headers:Object.assign({},l?{"Content-Type":"application/geo+json"}:void 0,typeof e.b=="function"?{Authorization:"Bearer "+e.b()}:void 0,e.g)},l&&(n.data=JSON.stringify(l)),l=new tf(h,r.toString(),je,n),l.then(o,Qp(e,r,s)),l}vq.CONFIG_KEY="iml";function wq(e,r,n,o){zc(n,"String",e,r,"must be a string"),zc(o,"String",e,r+1,"must be a string")}function zq(e,r){zc(r,"String",e,0,"must be a string")}function Bq(e,r){if(!Array.isArray(r)||r.length===0||r.some(function(n){return typeof n!="string"}))throw new D(e,0,"must be a non-empty array of strings")}function Eq(e,r,n){if(!Ea(n))throw new D(e,r,"must be a GeoJSON object")}function xq(e,r,n,o){if(!Da(n))throw new D(e,r,"must be a function");if(!Da(o))throw new D(e,r+1,"must be a function")}X.prototype.pm=function(e){return this.Ma(vq,e)},X.prototype.getIMLService=X.prototype.pm;function Gq(e,r,n,o){if(Gq.j.constructor.call(this,o?{min:o.min,max:o.max,engineType:o.engineType}:void 0),C(e,vq,Gq,0),!Cc(r))throw new D(Gq,1,'"catalogHrn" must be a string');if(!Cc(n))throw new D(Gq,2,'"layerId" must be a string');this.u=e,this.f=r,this.i=n,this.m=Ea(o)&&Ea(o.parameters)?o.parameters:{},this.Qa(this.b===kk.WEBGL?new ti({sources:{iml:{type:"MVT"}},layers:{iml:{data:{source:"iml",layer:this.f+":"+this.i},points:{filter:{$geometry:"point"},draw:{points:{collide:!1,order:200,color:"#92CF48",size:[[10,"8px"],[14,"12px"],[18,"16px"]]}}},polygons:{filter:{$geometry:"polygon"},draw:{polygons:{order:201,color:"#E39E3C"},lines:{order:202,color:"#755DA5",width:"1px"}}},lines:{filter:{$geometry:"line"},draw:{lines:{order:203,color:"#0258AE",width:"2px",join:"round",cap:"round"}}}}}}):new H.map.render.harp.Style({styles:[{layer:this.f+":"+this.i,when:["==",["geometry-type"],"Point"],technique:"circles",renderOrder:200,color:"#92CF48",size:["interpolate",["linear"],["zoom"],10,8,14,12,18,16]},{layer:this.f+":"+this.i,when:["==",["geometry-type"],"Polygon"],technique:"fill",color:"#E39E3C",renderOrder:201},{layer:this.f+":"+this.i,when:["==",["geometry-type"],"Polygon"],technique:"solid-line",color:"#755DA5",lineWidth:"1px",renderOrder:202},{layer:this.f+":"+this.i,when:["==",["geometry-type"],"LineString"],technique:"solid-line",color:"#0258AE",lineWidth:"2px",renderOrder:203}]}))}u(Gq,S),t("H.service.iml.Provider",Gq),Gq.prototype.B=function(e,r,n,o,s){return this.u.Ff(e,r,n,this.f,this.i,o,s,this.m)},Gq.prototype.requestInternal=Gq.prototype.B,Gq.prototype.Sb=ff,Gq.prototype.providesOMV=Gq.prototype.Sb,Gq.prototype.V=function(){return this.Ya()},Gq.prototype.getStyle=Gq.prototype.V,Gq.prototype.gb=function(e){C(e,ti)&&e.a("MVT"),this.Qa(e)},Gq.prototype.setStyle=Gq.prototype.gb;function Mp(e){e=e===void 0?{}:e,Mp.j.constructor.call(this,Mp,e),this.b={og:e.resource||"base",eg:e.projection||"mc",format:e.format||"png8"},this.f=e.queryParams||{}}u(Mp,Op),t("H.service.rasterTile.Service",Mp),p=Mp.prototype,p.V=function(){return this.f.style||"explore.day"},p.Aa=function(){return{subDomain:"maps",path:"v3"}},p.ba=function(){return this.c||(this.c=new lq,this.B(this.v().clone().G("copyright"),A(this.Kn,this),ld)),this.c},p.Kn=function(e){var r=e.copyrights;e=e.resources;var n={},o=this.b.og+"."+this.V();n[o]=[],e[this.b.og].styles[this.V()].forEach(function(s){r[s].forEach(function(l){var h=[];l.boundingBoxes.forEach(function(d){h.push([d.north,d.west,d.south,d.east])}),n[o].push({boxes:h,label:l.label,alt:l.alt,minLevel:l.minLevel,maxLevel:l.maxLevel})})}),mq(this.c,n)},p.Fe=function(e,r){return this.B(this.v().clone().G("info"),e,r)},Mp.prototype.getInfo=Mp.prototype.Fe,Mp.prototype.Je=function(e,r){return this.B(this.v().clone().G("politicalViews"),e,r)},Mp.prototype.getPoliticalViews=Mp.prototype.Je,Mp.prototype.jm=function(e,r){return this.B(this.v().clone().G("features"),e,r)},Mp.prototype.getFeatures=Mp.prototype.jm,Mp.prototype.hh=function(e,r){return this.B(this.v().clone().G("languages"),e,r)},Mp.prototype.getLanguages=Mp.prototype.hh,Mp.CONFIG_KEY="rasterTile",X.prototype.lh=function(e){return this.Ma(Mp,e)},X.prototype.getRasterTileService=X.prototype.lh;function Hq(e,r,n,o,s,l,h){var d=this;h=h||{},l=l||{};var y=e.v().clone().G(r+"/"+e.vc()+"/"+n).I(l),g=e.c;this.D=e,this.R=y,Ek.call(this,{tileSize:o,max:o===512?19:20,min:o===512?2:0,getURL:function(v,m,w){var I=d.R.clone();return g&&I.Ba(g[(w+m+v)%g.length]),I.G(w+"/"+v+"/"+m+"/"+o+"/"+s),I.toString()},crossOrigin:h.crossOrigin,headers:h.headers,uri:y.toString().replace(/_/g,"")+o,engineType:h.engineType}),this.me=r,this.ab=n,this.xa=l,this.qa=n.split(".")[0],this.i=A(this.i,this),this.getCopyrights=this.ba,this.L=!1,e.addEventListener("versionupdate",this.i)}u(Hq,Ek),Hq.prototype.MAX_STORE_TIME=2592e6,Hq.prototype.B=function(e,r,n,o,s,l){return this.L||(zp(Iq,"Use HERE Vector Tile API or Raster Tile API v3 instead."),this.L=!0),Hq.j.B.call(this,e,r,n,o,s,l)},Hq.prototype.requestInternal=Hq.prototype.B,Hq.prototype.o=function(){Ek.prototype.o.call(this),this.D.removeEventListener("versionupdate",this.i)},Hq.prototype.ba=function(e,r){return Np(this.D.ba(),this.qa,r,e)},Hq.prototype.getCopyrights=Hq.prototype.ba,Hq.prototype.i=function(){var e=this.D;this.R=e.v().clone().G(this.me+"/"+e.vc()+"/"+this.ab).I(this.xa),this.reload(!1)},Hq.prototype.l=function(){return od()},Hq.prototype.c=function(){return od()?nd():Hq.j.c.call(this)};function Iq(e){Iq.j.constructor.call(this,Iq,e),e=Pp(this,e),this.c=e.shards,(this.f=e.ignoreTypes?null:e.type)&&this.v().Ba(this.f),this.b=e.version,this.s=new lq,this.m={},this.l=0,this.b==="newest"&&Jq(this)}u(Iq,Op),t("H.service.MapTileService",Iq),Iq.prototype.Aa=function(){return{subDomain:"maps.ls",path:"maptile/2.1",type:"base",version:"newest",shards:["1","2","3","4"]}},Iq.CONFIG_KEY="maptile";function Kq(e,r){for(var n={},o=e[r+"s"][r],s=o.length;s--;)n[o[s].id]=o[s];e[r+"s"]=n}Iq.prototype.Hj=function(){return this.f},Iq.prototype.getType=Iq.prototype.Hj,Iq.prototype.vc=function(){return this.b},Iq.prototype.getVersion=Iq.prototype.vc,Iq.prototype.ba=function(){return this.l||(this.b&&this.b!=="newest"||this.f==="traffic")&&Lq(this),this.s},Iq.prototype.getCopyrights=Iq.prototype.ba;function Jq(e){var r=e.v().clone().G("info").I({output:"json"});e.c&&r.Ba(e.c[0]),e.B(r,function(n){n=n.response;var o;if(Kq(n,"map"),Kq(n,"scheme"),Kq(n,"tiletype"),Kq(n,"format"),Kq(n,"resolution"),Kq(n,"language"),e.b==="newest"&&e.f!=="traffic")for(o in n.maps)n.maps[o].hash&&n.maps[o].newest&&(e.b=n.maps[o].hash,e.dispatchEvent("versionupdate"));e.u=n,e.dispatchEvent("infoupdate")},function(n){throw n})}function Lq(e){var r=e.v().clone().G("copyright").G(e.vc()).I({output:"json"});e.c&&r.Ba(e.c[0]),e.l=1,e.B(r,function(n){e.l=2,mq(e.s,n),e.dispatchEvent("copyrightupdate")},function(n){throw e.l=-1,n})}Iq.prototype.Fe=function(){return this.u},Iq.prototype.getInfo=Iq.prototype.Fe,Iq.prototype.ue=function(e,r,n,o,s,l){var h=this.v().clone().G(e+"/"+this.vc()+"/"+r+"/"+n+"/"+o).I(s||{}).toString(),d=0,y,g=h.length;if(g!==0)for(y=0;y<g;y++){var v=h.charCodeAt(y);d=(d<<5)-d+v,d|=0}return h=d,d=this.m[h],d||(d=new Hq(this,e,r,n,o,s,yp({headers:this.g},l||{})),this.m[h]=d),d},Iq.prototype.createTileProvider=Iq.prototype.ue,Iq.prototype.nc=function(e,r,n,o,s,l,h,d){return e=this.ue(e,r,n,o,s,d),new sl(e,{opacity:l,dark:!!h})},Iq.prototype.createTileLayer=Iq.prototype.nc,X.prototype.ih=function(e){return this.Ma(Iq,e)},X.prototype.getMapTileService=X.prototype.ih;function Mq(e){Mq.j.constructor.call(this,Mq,e)}u(Mq,Op),t("H.service.publicTransit.Service",Mq),Mq.prototype.Aa=function(){return{subDomain:"transit.router",path:"v8"}},Mq.CONFIG_KEY="publicTransit",Mq.prototype.Tm=function(e,r,n){return e=this.v().clone().G("routes").I(e),this.B(e,r,n)},Mq.prototype.getRoutes=Mq.prototype.Tm,Mq.prototype.$l=function(e,r,n){return e=this.v().clone().G("departures").I(e),this.B(e,r,n)},Mq.prototype.getDepartures=Mq.prototype.$l,Mq.prototype.Xm=function(e,r,n){return e=this.v().clone().G("stations").I(e),this.B(e,r,n)},Mq.prototype.getStations=Mq.prototype.Xm,Mq.prototype.a=function(e){return Error(JSON.stringify(e))},X.prototype.Pm=function(e){return this.Ma(Mq,e)},X.prototype.getPublicTransitService=X.prototype.Pm;function Nq(e){Nq.j.constructor.call(this,Nq,e),zp(Nq,"Use HERE Routing API v8 instead.")}u(Nq,Op),t("H.service.RoutingService",Nq),Nq.prototype.Aa=function(){return{subDomain:"route.ls",path:"routing/7.2"}},Nq.prototype.a=function(e){return Error(e.details)},Nq.CONFIG_KEY="routing",Nq.prototype.Cd=function(e,r,n){return e=this.v().clone().G("calculateroute.json").I(e),this.B(e,r,n)},Nq.prototype.calculateRoute=Nq.prototype.Cd,Nq.prototype.Ng=function(e,r,n){return e=this.v().clone().Ba("isoline").G("calculateisoline.json").I(e),this.B(e,r,n)},Nq.prototype.calculateIsoline=Nq.prototype.Ng;function Oq(e){Oq.j.constructor.call(this,Oq,e)}u(Oq,Op),t("H.service.RoutingService8",Oq),Oq.CONFIG_KEY="routing_v8",Oq.prototype.Aa=function(){return{subDomain:"router",path:"v8/routes"}},Oq.prototype.a=function(e){return Error(e.error)},Oq.prototype.Cd=function(e,r,n){return e=this.v().clone().I(e),this.B(e,r,n)},Oq.prototype.calculateRoute=Oq.prototype.Cd,Oq.prototype.Ng=function(e,r,n){return e=this.v().clone().Ba("isoline").wd("v8/isolines").I(e),this.B(e,r,n)},Oq.prototype.calculateIsoline=Oq.prototype.Ng,X.prototype.Fj=function(e,r){if(r=Mn?8:+r||7,r===7)r=Nq;else if(r===8)r=Oq;else throw new D(this.Fj,1,"allowed values are 7 and 8");return this.Ma(r,e)},X.prototype.getRoutingService=X.prototype.Fj;function Pq(){}t("H.service.extension.dataView.ITable",Pq),Pq.prototype.Md=function(){},Pq.prototype.getMeta=Pq.prototype.Md,Pq.prototype.Pd=function(){},Pq.prototype.getRowCount=Pq.prototype.Pd,Pq.prototype.tc=function(){},Pq.prototype.getRow=Pq.prototype.tc,Pq.prototype.Ta=function(){},Pq.prototype.getColumnNames=Pq.prototype.Ta,Pq.prototype.Be=function(){},Pq.prototype.getColumn=Pq.prototype.Be,Pq.prototype.ua=function(){},Pq.prototype.getCell=Pq.prototype.ua,Pq.prototype.concat=function(){},Pq.prototype.concat=Pq.prototype.concat;function Qq(){}t("H.service.extension.dataView.IRow",Qq),Qq.prototype.Ta=function(){},Qq.prototype.getColumnNames=Qq.prototype.Ta,Qq.prototype.ua=function(){},Qq.prototype.getCell=Qq.prototype.ua,Qq.prototype.md=function(){},Qq.prototype.getTable=Qq.prototype.md;function Rq(e,r){this.a=e,this.b=r}t("H.service.extension.dataView.ObjRow",Rq),Rq.prototype.Ta=function(){return this.a.Ta()},Rq.prototype.getColumnNames=Rq.prototype.Ta,Rq.prototype.ua=function(e){return this.a.ua(this.b,e)},Rq.prototype.getCell=Rq.prototype.ua,Rq.prototype.md=function(){return this.a},Rq.prototype.getTable=Rq.prototype.md;function Sq(){}t("H.service.extension.dataView.IColumn",Sq),Sq.prototype.ua=function(){},Sq.prototype.getCell=Sq.prototype.ua;function Tq(e,r){this.b=e,this.a=r}t("H.service.extension.dataView.ObjColumn",Tq),Tq.prototype.ua=function(e){return this.b.ua(e,this.a)},Tq.prototype.getCell=Tq.prototype.ua;function Uq(e,r,n){var o;if(r=r||(e&&e.length?Object.keys(e[0]):B),this.Cb=e,r)for(this.Dd=r,this.Pg=e=oc(),o=r.length;o--;)e[r[o]]=!0;n!==B&&(this.Sh=n)}t("H.service.extension.dataView.ObjTable",Uq),p=Uq.prototype,p.Sh=B,p.Cb=B,p.Dd=B,p.Pg=B,p.Md=function(){return this.Sh},Uq.prototype.getMeta=Uq.prototype.Md,Uq.prototype.Pd=function(){return this.Cb?this.Cb.length:0},Uq.prototype.getRowCount=Uq.prototype.Pd,Uq.prototype.tc=function(e){var r=this.Cb;return r&&r[e]?new Rq(this,e):B},Uq.prototype.getRow=Uq.prototype.tc,Uq.prototype.Ta=function(){return this.Dd||hf},Uq.prototype.getColumnNames=Uq.prototype.Ta,Uq.prototype.Be=function(e){return this.Pg[e]?new Tq(this,e):B},Uq.prototype.getColumn=Uq.prototype.Be,Uq.prototype.ua=function(e,r){var n=this.Cb;return(e=n&&this.Pg[r]&&n[e])&&e[r]},Uq.prototype.getCell=Uq.prototype.ua,Uq.prototype.concat=function(){var e=arguments.length,r,n=this.Dd,o=""+this.Dd,s=(this.Cb||[]).slice();for(r=0;r<e;r++){var l=arguments[r];if(!(l instanceof Uq))throw new D(this.concat,r);if(l.Cb){if(n&&""+l.Dd!==o)throw new D(this.concat,r,"Incompatible columns!");s=s.concat(l.Cb)}}return new Uq(s,this.Dd,this.Sh)},Uq.prototype.concat=Uq.prototype.concat;function Vq(e,r){return e.Cb?e.Cb.push(r):e.Cb=[r],e.Cb.length-1}function Wq(e){var r=Xq;if(!e||!Cc(af(e.layerId,e.layer))||!Fc(e.level)||vc(e.rowFilter)&&!Da(e.rowFilter)||vc(e.rowFilterContext)&&!Ea(e.rowFilterContext))throw new D(r,1,vc("invalid layer config")?"invalid layer config":e)}function Yq(e,r,n,o){o=o||Zq,this.a={},o.provider=e,this.invalidate=gf,Yq.j.constructor.call(this,r,o),delete this.invalidate,n&&(this.b=n),this.ra(kh.ADD)}u(Yq,Hh),t("H.service.remote.Spatial",Yq);var Zq={};Yq.prototype.cb=function(){return this.b||Hh.prototype.cb.call(this)},Yq.prototype.getId=Yq.prototype.cb,Yq.prototype.pg=ld,Yq.prototype.retain=Yq.prototype.pg,Yq.prototype.release=ff,Yq.prototype.release=Yq.prototype.release;function $q(e,r){this.a=e,r&&(this.b=r)}var ar=new $q(hf);Yq.prototype.Kd=function(e){return(this.a[e.key]||ar).a},Yq.prototype.getGeometriesForTile=Yq.prototype.Kd,Yq.prototype.gh=function(e){return(this.a[e.key]||ar).b},Yq.prototype.getLabels=Yq.prototype.gh;function br(e,r,n){e.a[r.key]=new $q(n,void 0)}function cr(e,r,n,o){if(!Da(n))throw new D(e,r,"has invalid type");if(!Da(o))throw new D(e,r+1,"has invalid type")}function dr(e,r,n){var o=e===8;this.b=r,this.c=n||ld,(this.a=e===4||o)?this.l=o:this.g=e===1,this.f=this.a?"$HProjGeometry":"geometry"}dr.prototype.parse=function(e,r,n){var o,s,l={},h=[],d,y,g=0;for(d=n.length;g<d;g++){var v=n[g],m=v.Rows;if(v=m.length){var w=Object.keys(m[0]).filter(function(V){return V!=="geometry"&&V!=="$HProjGeometry"});for(w=new Uq(m,w),y=0;y<v;y++){var I=m[y];if(s=I[this.f]){if(delete I[this.f],I=w.tc(y))try{this.a?o=er(this,e,r,I,s):o=fr(this,e,I,s.path),o.ka(e),h.push(o)}catch(V){this.c(V.message)}}else this.c("Layer must contain geometries")}}}return l[this.a?"spatials":this.g?"markers":"domMarkers"]=h,l};function er(e,r,n,o,s){var l=[],h=s.paths,d=h.length,y=0,g=e.b&&e.b(o);for(e=new Yq(r,e.l,B,{style:g||e.i,data:o});y!==d;)l.push(gr(h[y++]));return br(e,n,[new Ph(l,s.interiorsIndex,s.outlinesIndex)]),e}function fr(e,r,n,o){o=new kg(o[0],o[1]);var s=e.b&&e.b(n);return e.g?(e={icon:s,data:n,provider:r},e=new Rn(o,e)):(e={icon:s,data:n,provider:r},e=new bj(o,e)),e}function gr(e){for(var r=0,n=e.length,o=[];r<n;)o.push(new J(e[r++],e[r++]));return o}function hr(e,r){var n={};this.c=e,Ya(n,r||n),ok.call(this,n),this.ig={},e=this.Kb(nh.SPATIAL),e.update(e.a+1,kh.ADD)}u(hr,ok),t("H.service.remote.ObjectProvider",hr),hr.prototype.F=function(){ok.prototype.F.call(this)},hr.prototype.dispose=hr.prototype.F,hr.prototype.Ec=function(){return hf},hr.prototype.requestMarkers=hr.prototype.Ec,hr.prototype.Dc=function(){return hf},hr.prototype.requestDomMarkers=hr.prototype.Dc,hr.prototype.sd=function(){return hf},hr.prototype.requestOverlays=hr.prototype.sd,hr.prototype.Rb=ff,hr.prototype.providesMarkers=hr.prototype.Rb,hr.prototype.Qb=ff,hr.prototype.providesDomMarkers=hr.prototype.Qb,hr.prototype.Cc=ff,hr.prototype.providesSpatials=hr.prototype.Cc,hr.prototype.kg=function(){return hf},hr.prototype.requestSpatials=hr.prototype.kg;function ir(e){return e.wc(!0)}hr.prototype.mg=function(e,r){return e=jr(this,e,kr),r&&(e=e.filter(ir)),e},hr.prototype.requestSpatialsByTile=hr.prototype.mg;function jr(e,r,n){var o=r.l&&r.l[n],s;return!o&&(s=r.s)&&(delete r.s,(r.l=e=e.c.parse(e,r,s))&&(o=e[n])),o||hf}hr.prototype.fa=function(e){var r=e.cb();if(this.ig[r])throw new $c(this.fa,"Remote object "+r+" already added");return this.ig[r]=e},hr.prototype.Ga=function(e){delete this.ig[e.cb()]};var kr="spatials";function lr(e){e=e||{};var r=e.tileCacheSize||1024,n=e.resultType,o=e.styleCallback;if(vc(e.min)||(e.min=12),lr.j.constructor.call(this,e),mr.indexOf(n)===-1)throw new D(lr,2,"invalid resultType");if(this.f=n,o&&!Da(o))throw new D(lr,2,"invalid style callback");this.aa=o,this.R=e.pixelRatio||Ue(),this.Gb=A(this.Gb,this),this.J(new Rk(r,A(this.ab,this))),this.createTileInternal=n===4||n===8?A(this.T,this):A(this.L,this)}u(lr,S),t("H.service.extension.TileProvider",lr),lr.prototype.i=!1,lr.prototype.getCapabilities=function(){return lr.j.getCapabilities.call(this)|Qj.CROP_LINES_BY_TILE|Qj.CROP_POLYGONS_BY_TILE},lr.prototype.Ha=function(e,r,n,o){return this.i?lr.j.Ha.call(this,e,r,n,o):B},lr.prototype.requestTile=lr.prototype.Ha,lr.prototype.Gb=function(e){this.dispatchEvent(new wd("error",Cc(e)?e:e+"",this))},lr.prototype.Rb=function(){return this.f===1},lr.prototype.providesMarkers=lr.prototype.Rb,lr.prototype.Qb=function(){return this.f===2},lr.prototype.providesDomMarkers=lr.prototype.Qb,lr.prototype.Cc=function(){return this.f===4||this.f===8},lr.prototype.providesSpatials=lr.prototype.Cc;function nr(e){var r=e.qa;return r||(e.u||(e.u=e.m(e.f,e.aa,e.Gb)),r=e.qa=new hr(e.u),r.ka(e),r.addEventListener(e.A.za,A(e.xa,e)),r.qa=!0),r}lr.prototype.L=function(e,r,n,o){var s=this.getTileKey(e,r,n);s=this.nb().get(s);var l=this.f==2,h=[],d=nr(this);for(s?s.valid=!0:(e=s=new Xk(e,r,n,z),delete e.l,e.s=o),o=l?jr(d,s,"domMarkers"):jr(d,s,"markers"),r=o.length;r--;)e=o[r],e.Ii=s,(l||e.xb().getState()===1)&&h.push(e);return s.data=h,s},lr.prototype.xa=function(e){(e=e.target.Ii)&&(e.valid=!1)},lr.prototype.Ao=function(e){this.D=!!e},lr.prototype.setTileCanvasRendering=lr.prototype.Ao,lr.prototype.D=!0,lr.prototype.T=function(e,r,n,o){var s=nr(this),l=this.getTileKey(e,r,n),h=this.tileSize,d=this.nb().get(l);return d||(e=d=new al(l,e,r,n,h,this.R,n,s),delete e.l,e.s=o),this.D?(o=Cp.pop(h),d.W(o)||Cp.push(o,h)):gl(d),d},lr.prototype.ab=function(e,r){var n;if(this.f===4||this.f===8){for(e=r.Ua(),n=e.length;n--;)delete e[n].a[r.key];(e=r.gg())&&(Cp.push(e,this.tileSize),r.hg())}else for(e=r.data,n=e.length;n--;)delete e[n].Ii},lr.prototype.o=function(){lr.j.o.call(this),nr(this).F()};var or={MARKER:1,DOM_MARKER:2,POLYLINE:4,POLYGON:8};lr.ResultType=or;var mr=[1,2,4,8];function Xq(e,r,n){var o=this,s=r&&r.rowFilter,l=n.resultType;Xq.j.constructor.call(this,n),C(e,pr,Xq,0),Wq(r),s?(n=Wa(r),n.rowFilter=s.toString()):n=Wa(r),delete n.layer,n.layerId=af(r.layerId,r.layer),new Pf().a("pde","H.service.extension.worker.processor"),e=e.v().clone().G(qr+"."+rr).I({meta:1}),new Sf("pde",{message:[this.uid,0,{tileSize:this.tileSize,projected:!0,onlyOutline:l===4,serverUrl:e.toString(),layerConfigs:[n],horizontalMargin:1}]}).then(function(){o.i=!0,o.Va()},this.Gb)}u(Xq,lr),t("H.service.extension.platformData.TileProvider",Xq),Xq.prototype.m=function(e,r,n){return e=new dr(e,r,n),e.i=sr,e};var sr=new wh({strokeColor:"transparent",fillColor:"transparent",lineWidth:0,lineJoin:"round",lineCap:"round"});Xq.prototype.B=function(e,r,n,o,s){var l=this,h=this.getTileKey(e,r,n),d;h=this.nb().get(h);var y={cancel:ld},g=!0,v=this.f;if(h&&(v===4||v===8?h.Ud()||(o(Cp.pop(this.tileSize),null),g=!1):(o(z),g=!1)),g){var m=Ap.setTimeout(function(){d=new Sf("pde",{message:[l.uid,1,[e,r,n]]}),d.then(o,s)},500);y.cancel=function(){d?d.cancel():Ap.clearTimeout(m)}}return y},Xq.prototype.requestInternal=Xq.prototype.B,Xq.prototype.o=function(){Xq.j.o.call(this),new Sf("pde",{message:[this.uid,3]})},Xq.ResultType=or;function tr(e,r,n,o,s,l){cr(tr,1,r,n),cr(tr,2,o,s),(this.f=e.length)?(this.U=e,this.m=r,this.i=n,this.b=0,this.c=A(this.c,this),this.s=o,this.l=s,this.a=oc(),Ya(this.a,ur,l||{}),this.g={},x.setTimeout(this.c,0)):r(hf,!0)}var ur={duration:100,Kl:"geometry",Jl:"WKT",uo:"searchAttributes",hj:B};tr.prototype.c=function(){for(var e=[],r=!1,n=Lk(),o;this.b<this.f;){var s=this.U[this.b];if(r=s.attributes,o=s.layerId||this.a.hj,s.distance&&(r[this.a.uo]={nearest:new kg(s.nearestLat,s.nearestLon),distance:s.distance}),s=s[this.a.Kl]){try{var l=Wn(new qo(s))}catch(h){this.i(new x.Error(h.message)),r=!0;break}r[this.a.Jl]=l}if((s=this.g[o])||(s=this.g[o]=this.s({layerId:o,columnNames:Object.keys(r)})),r=this.l(s,r),e.push(r),this.b++,(r=this.b===this.f)||Lk()-n>=this.a.duration){this.m(e,r);break}}r?this.g={}:this.u=x.setTimeout(this.c,0)},tr.prototype.cancel=function(){x.clearTimeout(this.u),this.b<this.f&&this.i(new x.Error("parsing canceled"))},tr.prototype.cancel=tr.prototype.cancel;function vr(e){this.a=e}vr.prototype.cancel=function(){for(var e=this.a,r=e.length;r--;)e[r].cancel();e.length=0},vr.prototype.cancel=vr.prototype.cancel;function pr(e){pr.j.constructor.call(this,pr,e),zp(pr)}u(pr,Op),t("H.service.extension.platformData.Service",pr),pr.prototype.Aa=function(){return{subDomain:"s.fleet.ls",path:"1"}},pr.CONFIG_KEY="platformData",pr.prototype.request=function(e,r,n,o,s){var l="text/plain";if(!e)throw new D(this.request,0,e);if(!r)throw new D(this.request,1,r);if(!o)throw new D(this.request,3,o);if(!s)throw new D(this.request,4,s);return e=this.v().clone().G(e+"."+r).I(n),r===wr.JSON&&(l="application/json"),this.B(e,o,s,l)},pr.prototype.request=pr.prototype.request;var qr="tiles";pr.EntryPoint={DOC_ATTRIBUTES:"doc/attributes",DOC_LAYER:"doc/layer",DOC_LAYERS:"doc/layers",DOC_MAPS:"doc/maps",DOC_INDEXES:"doc/indexes",SEARCH_BBOX:"search/bbox",SEARCH_CORRIDOR:"search/corridor",SEARCH_PROXIMITY:"search/proximity",SEARCH_QUADKEY:"search/quadkey",SERVICE_CONFIGURATION:"serviceconfiguration",STATIC:"static",TILE:"tile",TILES:qr,FILE:"file",INDEX:"index"};var rr="json",wr={TXT:"txt",JSON:rr,HTML:"html",BIN:"bin"};pr.EntryPointType=wr,pr.prototype.nc=function(e,r){var n=r&&r.resultType;e=new Xq(this,e,r);var o;return n==1||n===2?o=new Sn(e):o=new sl(e),o},pr.prototype.createTileLayer=pr.prototype.nc;function xr(e,r,n,o,s){var l=[],h,d=n.layer_id||n.layer_ids;return e=e.request(r,rr,n,function(y){h=new tr(y.geometries,o,s,function(g){return new Uq([],g.columnNames,g)},function(g,v){return g.tc(Vq(g,v))},{hj:d}),l.push(h)},function(y){s(new x.Error(y))}),l.push(e),new vr(l)}function yr(e,r,n){if(!Bc(e))throw new D(n,0,"has invalid type");if(!Bc(r))throw new D(n,1,"has invalid type");if(e.length!==r.length||!e.length)throw new D(n,1,"specify one key attribute for each given layer id in the same order")}pr.prototype.Fc=function(e,r,n,o,s,l){function h(g,v){v&&d--,o(g,!d)}var d,y=[];for(yr(e,r,this.Fc),cr(this.Fc,3,o,s),C(n,K,this.Fc,2),n={bbox:n.c+","+n.a+";"+n.f+","+n.b},l&&Ya(n,l),e=n.layer_id?[n.layer_id]:e,l=0,d=e.length;l<d;l++)n.layer_id=e[l],n.key_attribute=r[l],y.push(xr(this,"search/bbox",n,h,s));return new vr(y)},pr.prototype.searchByBoundingBox=pr.prototype.Fc,pr.prototype.Ub=function(e,r,n,o,s,l,h){if(yr(e,r,this.Ub),C(n,kg,this.Ub,2,"has invalid type"),!Fc(o))throw new D(this.Ub,3,"has invalid type");return cr(this.Ub,4,s,l),e={layer_ids:e.join(","),key_attributes:r.join(","),proximity:n.lat+","+n.lng+","+o},h&&Ya(e,h),xr(this,"search/proximity",e,s,l)},pr.prototype.searchByProximity=pr.prototype.Ub,pr.prototype.Tb=function(e,r,n,o,s,l,h){var d="";if(yr(e,r,this.Tb),!Cc(n)&&!C(n,L))throw new D(this.Tb,1,"has invalid type");if(!Fc(o))throw new D(this.Tb,2,"has invalid type");if(cr(this.Tb,4,s,l),e={layer_ids:e.join(","),key_attributes:r.join(","),radius:o},Cc(n))e.route_id=n;else{for(o=n.$,n=0,r=o.length;n<r;n+=3)d+=o[n]+","+o[n+1],n<r-3&&(d+=";");e.corridor=d}return h&&Ya(e,h),xr(this,"search/corridor",e,s,l)},pr.prototype.searchByCorridor=pr.prototype.Tb,X.prototype.Jm=function(e){return this.Ma(pr,e)},X.prototype.getPlatformDataService=X.prototype.Jm;function zr(e){zr.j.constructor.call(this,zr,e),zp(zr)}u(zr,Op),t("H.service.extension.geofencing.Service",zr),zr.prototype.Aa=function(){return{subDomain:"fleet.ls",path:"2"}},zr.CONFIG_KEY="geofencing",zr.prototype.request=function(e,r,n,o){if(!e)throw new D(this.request,0,e);if(!Da(n))throw new TypeError("onResult must be a function");if(!Da(o))throw new TypeError("onError must be a function");return e=this.v().clone().G(e+".json").I(r),this.B(e,n,o)},zr.prototype.request=zr.prototype.request,zr.prototype.a=function(e){return Error(e.issues&&e.issues.length?e.issues.map(function(r){return r.message}).join(". "):e.message||e.response_code)},zr.EntryPoint={SEARCH_PROXIMITY:"search/proximity"},X.prototype.lm=function(e){return this.Ma(zr,e)},X.prototype.getGeofencingService=X.prototype.lm,t("H.service.extension.customLocation.Permission",{READ:"read",WRITE:"write",EXPORT:"export"}),t("H.service.extension.customLocation.Storage",{READONLY:"readonly",UPDATABLE:"updatable"});function Ar(e){var r=Br;if(!e||!Cc(e.layerId)||vc(e.rowFilter)&&!Da(e.rowFilter)||vc(e.rowFilterContext)&&!Ea(e.rowFilterContext))throw new D(r,1,vc("invalid layer config")?"invalid layer config":e)}function Cr(e){return Cc(e)&&/^[A-Z][A-Z0-9_]*$/.test(e)}function Dr(e){for(var r=e&&e.length,n=2<=r&&e[--r]==="WKT"&&e[--r]==="GEOMETRY_ID";n&&r--;)n=Cr(e[r]);return n}function Er(e,r){var n="",o=[];if(r){var s=e.geometries;if(s&&s.length){var l=Object.keys(s[0].attributes);for(n=n+("Meta:	"+r+`
`)+l.join("	"),n+=`	WKT
`,e=0;e<s.length;e++){var h=s[e].attributes,d=s[e].geometry;for(r=0;r<l.length;r++)o.push(h[l[r]]);n+=o.join("	"),n+="	"+d+`
`,o=[]}}}else{if(d={},o=[],e.geometries)for(s=0;s<e.geometries.length;s++)r=e.geometries[s],d[r.layerId]||(d[r.layerId]=[]),d[r.layerId].push(r);for(l in d)o.push({layerId:l,geometries:d[l]});for(e=0;e<o.length;e++)n+=Er(o[e],o[e].layerId)}return n}function Br(e,r,n){var o=this,s=r&&r.rowFilter,l;Br.j.constructor.call(this,n),C(e,Fr,Br,0);var h=n.resultType;if(Ar(r),s){var d=Wa(r);d.rowFilter=s.toString()}else d=r;new Pf().a("cle","H.service.extension.worker.processor");var y=r.layerId;e.request(Gr,Hr,{detail_level:"all",layer_id:y},function(g){g=g.layers;var v;for(v=0;v<g.length;v++)if(g[v].layerId===y){d.level=g[v].level;break}l=e.v().clone().G(Ir+"."+Hr).I({meta:1}),new Sf("cle",{message:[o.uid,0,{tileSize:o.tileSize,projected:!0,onlyOutline:h===4,serverUrl:l.toString(),layerConfigs:[d],batchTiles:!1,horizontalMargin:1}]}).then(function(){o.i=!0,o.Va()},o.Gb)},function(g){o.Gb(g.message)})}u(Br,lr),t("H.service.extension.customLocation.TileProvider",Br),Br.prototype.m=function(e,r,n){return new dr(e,r,n)},Br.prototype.B=function(e,r,n,o,s){var l=this,h=this.getTileKey(e,r,n),d;h=this.nb().get(h);var y={cancel:ld},g=!0,v=this.f;if(h&&(v===4||v===8?h.Ud()||(o(Cp.pop(this.tileSize),null),g=!1):(o(z),g=!1)),g){var m=Ap.setTimeout(function(){d=new Sf("cle",{message:[l.uid,1,[e,r,n]]}),d.then(o,s)},500);y.cancel=function(){d?d.cancel():Ap.clearTimeout(m)}}return y},Br.prototype.requestInternal=Br.prototype.B,Br.prototype.o=function(){Br.j.o.call(this),new Sf("cle",{message:[this.uid,3]})};function Jr(){if(Kr)throw new $c(Jr)}t("H.service.extension.customLocation.Table",Jr);var Kr=!0;function Lr(e,r){var n;Kr=!1;var o=new Jr;Kr=!0,o.c=rc(x.JSON.parse(x.JSON.stringify(e))),e=e.columnNames;var s=oc();for(n=e.length;n--;)s[e[n]]=n;if(o.f=s,o.b=e.length,r){if(r.length%e.length)throw new D(Lr,1,"Invalid number of cells")}else r=[];return o.a=r,o}Jr.prototype.Md=function(){return this.c},Jr.prototype.getMeta=Jr.prototype.Md,Jr.prototype.Pd=function(){return this.a.length/this.b},Jr.prototype.getRowCount=Jr.prototype.Pd,Jr.prototype.tc=function(e){return e<this.a.length/this.b?new Mr(this,e):B},Jr.prototype.getRow=Jr.prototype.tc,Jr.prototype.Um=function(){var e=this.a.length/this.b,r,n=new x.Array(e);for(r=0;r<e;r++)n[r]=new Mr(this,r);return n},Jr.prototype.getRows=Jr.prototype.Um,Jr.prototype.Hg=function(e){var r=this.b,n=this.a,o=n.length/this.b;if(!e||e.length%r)throw new D(this.Hg,0,"Invalid number of cells");return this.a=n.concat(e),o},Jr.prototype.addCells=Jr.prototype.Hg,Jr.prototype.ol=function(){for(var e=this.b,r=this.a,n=this.a.length/this.b;e--;)r.push(z);return this.tc(n)},Jr.prototype.addRow=Jr.prototype.ol,Jr.prototype.Ta=function(){return this.c.columnNames},Jr.prototype.getColumnNames=Jr.prototype.Ta,Jr.prototype.Be=function(e){return this.f[e]===B?B:new Nr(this,e)},Jr.prototype.getColumn=Jr.prototype.Be,Jr.prototype.ua=function(e,r){return this.a[e*this.b+this.f[r]]},Jr.prototype.getCell=Jr.prototype.ua,Jr.prototype.Gc=function(e,r,n){if(r=this.f[r],e>=this.a.length/this.b)throw new D(this.Gc,0,"Row index out of bounds");if(r===B)throw new D(this.Gc,0,"Column unknown");this.a[e*this.b+r]=n},Jr.prototype.setCell=Jr.prototype.Gc,Jr.prototype.concat=function(e){var r=arguments.length,n,o=""+this.Ta(),s=this.a?this.a.slice():[];for(n=0;n<r;n++){var l=arguments[n];if(!(l instanceof Jr))throw new D(this.concat,n);if(""+l.Ta()!==o)throw new D(this.concat,n,"Incompatible columns!");l.a&&(s=s.concat(l.a))}return Lr(this.c,s)},Jr.prototype.concat=Jr.prototype.concat;var Or=/(\n|\t|\r|")/;Jr.prototype.Gi=function(e,r){var n,o=this.b,s=this.Ta(),l=[],h=[],d=this.a,y=-1;for(n=0;n<o;n++)(!e||e.test(s[n]))&&(s[n]==="WKT"&&(y=l.length),l.push(n));if(!(e=l.length))throw new D(this.Gi,1,"No columns filtered");if(Pr(this,h,s,0,o,l,e,y),r){var g=r.length;for(n=0;n<g;n++)h.push(`
`),s=r[n],Pr(this,h,d,s,o,l,e,y)}else for(g=this.Pd(),s=0;s<g;s++)h.push(`
`),Pr(this,h,d,s,o,l,e,y);return h.join("")};function Pr(e,r,n,o,s,l,h,d){var y;for(y=0;y<h;y++){y&&r.push("	");var g=n[o*s+l[y]];if(y!==d){if(g!==z){if(g=String(g),Or.test(g))throw new D(e.Gi,0,'Invalid character (\\n, \\r, \\t, or ") in row '+o+" column "+e.c.columnNames[l[y]]);r.push(g)}}else r.push(g)}}function Nr(e,r){this.b=e,this.a=r}Jr.Column=Nr,Nr.prototype.ua=function(e){return this.b.ua(e,this.a)},Nr.prototype.getCell=Nr.prototype.ua,Nr.prototype.Gc=function(e,r){this.b.Gc(e,this.a,r)},Nr.prototype.setCell=Nr.prototype.Gc;function Mr(e,r){this.a=e,this.Nh=r}Jr.Row=Mr,Mr.prototype.Ta=function(){return this.a.Ta()},Mr.prototype.getColumnNames=Mr.prototype.Ta,Mr.prototype.ua=function(e){return this.a.ua(this.Nh,e)},Mr.prototype.getCell=Mr.prototype.ua,Mr.prototype.Gc=function(e,r){this.a.Gc(this.Nh,e,r)},Mr.prototype.setCell=Mr.prototype.Gc,Mr.prototype.md=function(){return this.a},Mr.prototype.getTable=Mr.prototype.md;function Qr(e){if(e===B)e="	";else if(!/^[^"\r\n]$/.test(e))throw new D(Qr,0);this.b=String(e).charCodeAt(0),this.Oh=A(this.Oh,this),this.C=Rr}var Rr=0;p=Qr.prototype,p.getState=function(){return this.C};function Sr(e,r,n){var o=e.C;if(o!==r)throw o===1&&(e.C=Rr),new $c(n,"Requires state: "+["READY","PARSE","PAUSE"][r]+" but found "+["READY","PARSE","PAUSE"][o])}p.abort=function(){Sr(this,2,Qr.prototype.abort),this.C=Rr},p.Oh=function(e){throw this.C=Rr,new D(Qr.prototype.parse,0,"Malformed DSV at row "+this.a.l+" column "+this.a.b+": "+e)};function Tr(e,r){var n=[];return e.parse(r,function(o,s,l){return 1>o&&(n[s]=l),0<o}),e.C=Rr,n}p.parse=function(e,r,n){Sr(this,Rr,Qr.prototype.parse),e=e.trim(),this.a=new Ur(e,this.b,this.Oh),this.c=r,this.kk=n||gf,this.C=2,this.Ph()},p.kk=gf,p.Ph=function(){var e=this.a,r=[];Sr(this,2,Qr.prototype.Ph),this.C=1;do{if(!e.g){this.C=Rr;break}if(s>e.b){if(n!==void 0&&n!==s){this.a.a("The number of columns must be the same for all rows");return}var n=s}var o=e.l,s=e.b,l=e.tf,h=this.kk(o,s,e);if(e.tf>l)for(;e.next()!==-1;);else{for(;(l=e.next())!==-1;)r.push(l);h=String.fromCharCode.apply(z,r),r.length=0}Vr(e),this.c(o,s,h)&&(this.C=e.g?2:Rr)}while(this.C===1);this.C!=2&&n!==void 0&&0<s&&n!==s&&this.a.a("The number of columns must be the same for all rows")};function Ur(e,r,n){this.c=new qo(e),this.s=r,this.g=!0,this.tf=this.l=this.b=0,Vr(this),this.a=n,this.f=[],this.i=!1}p=Ur.prototype,p.tf=0;function Vr(e){var r=e.c.Pb();e.m=!1,(e.U=r===34)&&e.c.next()}function Wr(e,r){var n=e.c;switch(e.m=!0,r){case e.s:e.b++;break;case 13:n.next(),n.Pb()!==10&&e.a("CR without LF");case 10:e.b=0,e.l++;break;case-1:e.g=!1;break;default:e.a("End of field expected")}return n.next(),-1}p.Pb=function(){if(this.m)var e=-1;else{var r=this.c;if(e=r.Pb(),this.U)switch(e){case 34:r.next(),e=r.Pb(),e!==34&&(e=Wr(this,e));break;case-1:this.a("Closing quotation mark expected")}else switch(e){case 34:this.a("Unexpected quotation mark");case this.s:case 13:case 10:case-1:e=Wr(this,e)}}return e},p.ge=function(){this.i=!0,this.f=[]},p.Gd=function(){var e=this.f.slice();return this.i=!1,this.f=[],e},p.next=function(){var e=this.Pb();return e!==-1&&this.c.next(),this.i&&this.f.push(e),this.tf++,e};function Xr(e,r,n,o){if(o=o||{},!r)throw new D(Xr,1,"has to be a function");if(!n)throw new D(Xr,2,"has to be a function");for(this.s=r,this.u=n,this.a=[],this.g={},this.f=[],this.b={},this.i={},this.l={},this.m={},this.U=o.duration||100,this.c=A(this.c,this),e=e.split("Meta:	").slice(1),r=0;r<e.length;r++){o=e[r].split(`
`),n=o[0].split("	")[0],o=o.slice(1).join(`
`),this.b[n]=new Qr,this.g[n]=Tr(this.b[n],o);var s={layerId:n,columnNames:this.g[n]};this.f.push(n),this.m[n]=Lr(s),this.i[n]=Lk(),Yr(this,o,n),this.c(n)}}function Yr(e,r,n){var o=[],s=e.g[n].length-1,l=e.m[n];try{e.b[n].parse(r,function(h,d,y){var g=!1;return 0<h&&(o[d]=y,d===s&&(e.a.push(l.tc(l.Hg(o))),Lk()-e.i[n]>e.U&&(g=!0))),g},function(h,d,y){if(0<h&&d===s)return Wn(y)})}catch(h){e.u(h)}}Xr.prototype.cancel=function(){for(var e in this.l)x.clearTimeout(this.l[e])},Xr.prototype.cancel=Xr.prototype.cancel,Xr.prototype.c=function(e){var r=this,n,o;this.l[e]=x.setTimeout(function(){if(r.b[e].getState()===2)r.i[e]=Lk(),r.s(r.a,!1),r.a=[],r.b[e].Ph(),r.c(e);else{for(n=!0,o=0;o<r.f.length;o++)if(r.b[r.f[o]].getState()!==Rr){n=!1;break}n&&(0<r.a.length&&r.s(r.a,!0),r.a=[])}},0)};function Fr(e){Fr.j.constructor.call(this,Fr,e),zp(Fr)}u(Fr,Op),t("H.service.extension.customLocation.Service",Fr),Fr.prototype.Aa=function(){return{subDomain:"fleet.ls",path:"2"}},Fr.CONFIG_KEY="customLocation",Fr.prototype.nc=function(e,r){var n=r&&r.resultType;e=new Br(this,e,r);var o;return n===1||n===2?o=new Sn(e):o=new sl(e),o},Fr.prototype.createTileLayer=Fr.prototype.nc;function Zr(e,r,n,o){var s;e=e===$r?"changes":"file";var l=r[e],h=Cc(l),d=!h&&C(l,Blob);if(!h&&!d)throw new D(o,0,"Invalid "+e+" parameter");if(as)d?s=l:s=pf(l,"text/plain"),o=new x.FormData,o.append(e,s,s.name||e+".wkt"),n.method="POST",n.data=o,delete r[e];else if(d)throw new D(o,0,"Sending Blob data is not supported by the browser")}var as=x.FormData&&!!x.FormData.prototype.append;Fr.prototype.request=function(e,r,n,o,s){return bs(this,e,r,n,o,s)},Fr.prototype.request=Fr.prototype.request;function bs(e,r,n,o,s,l){var h="text/plain",d=r===cs.LAYERS_UPLOAD||r===cs.LAYERS_MODIFY||r===cs.LAYERS_IMPORT,y=o,g={data:B,method:"GET",headers:e.g};if(!r)throw new D(e.request,0,r);if(!n)throw new D(e.request,1,n);cr(e.request,3,s,l),d&&(C(o,Object,e.request,2,"Invalid request parameters"),y=Wa(o),Zr(r,y,g,e.request));var v=e.v().clone().G(r+"."+n).I(y);return n===ds.JSON&&(h="application/json"),e=new tf(h,v.toString(),je,g),e.then(function(m){var w=m.issues;w&&m.error_id&&m.response_code?l(Error(w[0].message)):s(m)},function(m){m.type==="error"||m.status===404?l(Error(m.statusText||"Unable to load data")):m.json().then(function(w){l(Error("["+w.issues[0].message+"] "+v+" request failed"))},function(){l(Error("["+m.statusText+"] "+v+" request failed"))})}),e}var Gr="layers/list",$r="layers/modify",Ir="tiled/tile",cs={LAYERS_DELETE:"layers/delete",LAYERS_GRANT:"layers/access/grant",LAYERS_LIST:Gr,LAYERS_MODIFY:$r,LAYERS_UPLOAD:"layers/upload",LAYERS_IMPORT:"layers/import",SEARCH_ALL:"search/all",SEARCH_BBOX:"search/bbox",SEARCH_CORRIDOR:"search/corridor",SEARCH_PROXIMITY:"search/proximity",SEARCH_QUADKEY:"search/quadkey",SEARCH_TILE:Ir};Fr.EntryPoint=cs;var Hr="json",ds={TXT:"txt",JSON:Hr};Fr.EntryPointType=ds,Fr.prototype.ob=function(e,r,n){var o=this;return this.request("search/all","txt",{filter:'WKT==""',layer_id:e},function(s){var l=String(s).replace(/[\r\n]+$/g,"").split("	");o.request(Gr,Hr,{layer_id:e,detail_level:"all"},function(h){h=h.layers[0],h.columnNames=l,r(Lr(h))},n)},n)},Fr.prototype.getLayer=Fr.prototype.ob,Fr.prototype.Kj=function(e,r,n,o){function s(){return++h<l?d.request("layers/access/grant",Hr,{layer_id:e,granted_app_id:r[h].grantedAppId,permissions:r[h].permissions.join(",")},s,o):d.ob(e,n,o)}var l=r&&r.length,h=-1,d=this;return s()},Fr.prototype.grantAccess=Fr.prototype.Kj,Fr.prototype.jj=function(e,r,n){return this.request("layers/delete",Hr,{layer_ids:e},r,n)},Fr.prototype.deleteLayer=Fr.prototype.jj,Fr.prototype.$b=function(e,r,n){function o(){setTimeout(function(){y.ob(h,function(w){setTimeout(s.bind(null,w),v)},function(){64e3>g?(g+=v,o()):n(x.Error("Timeout"))})},v),v*=2}function s(w){var I=JSON.stringify(w.Ta()),V=e.grants;if(I!==JSON.stringify(d)){var q="Results into different column names on the backend: "+I;setTimeout(function(){y.jj(h,function(){n(x.Error(q))},function(De){n(x.Error(q+". "+De.message))})},v)}else V&&V.length?y.Kj(h,V,r,n):r(w)}var l,h,d,y=this,g=0,v=1e3,m=!e||!Cr(h=e.layerId)&&(l="layerId")||!Dr(d=e.columnNames)&&(l="columnNames")?0:Da(r)?Da(n)?-1:2:1;if(0<=m)throw new D(y.$b,m,l||arguments[m]);return y.ob(h,function(){n(x.Error("Layer exists already"))},function(){var w={layer_id:h,file:d.join("	")},I=e.level,V=e.storage;I!==B&&(w.level=I),V!==B&&(w.storage=V),y.request("layers/upload",Hr,w,o,n)})},Fr.prototype.createLayer=Fr.prototype.$b;function es(e,r,n,o,s){var l=[],h;return e=e.request(r,Hr,n,function(d){d.geometries.length?(d=Er(d,n.layer_id),h=new Xr(d,o,s),l.push(h)):o(hf,!0)},s),l.push(e),new vr(l)}Fr.prototype.Ub=function(e,r,n,o,s,l){if(!Bc(e))throw new D(this.Ub,0,"has invalid type");if(C(r,kg,this.Ub,1,"has invalid type"),!Fc(n))throw new D(this.Ub,2,"has invalid type");return cr(this.Ub,3,o,s),e={layer_ids:e.join(","),proximity:r.lat+","+r.lng+","+n},l&&Ya(e,l),es(this,"search/proximity",e,o,s)},Fr.prototype.searchByProximity=Fr.prototype.Ub,Fr.prototype.Tb=function(e,r,n,o,s,l){var h="";if(!Bc(e))throw new D(this.Tb,0,"has invalid type");if(!Cc(r)&&!C(r,L))throw new D(this.Tb,1,"has invalid type");if(!Fc(n))throw new D(this.Tb,2,"has invalid type");if(cr(this.Tb,3,o,s),e={layer_ids:e.join(","),radius:n},Cc(r))e.route_id=r;else{var d=r.$;for(r=0,n=d.length;r<n;r+=3)h+=d[r]+","+d[r+1],r<n-3&&(h+=",");e.corridor=h}return l&&Ya(e,l),es(this,"search/corridor",e,o,s)},Fr.prototype.searchByCorridor=Fr.prototype.Tb,Fr.prototype.Fc=function(e,r,n,o,s){function l(y,g){g&&d--,n(y,!d)}var h=[],d;if(!Bc(e))throw new D(this.Fc,0,"has invalid type");for(C(r,K,this.Fc,1,"has invalid type"),cr(this.Fc,2,n,o),r={bbox:r.c+","+r.a+";"+r.f+","+r.b},s&&Ya(r,s),e=r.layer_id?[r.layer_id]:e,s=0,d=e.length;s<d;s++)r.layer_id=e[s],h.push(es(this,"search/bbox",r,l,o));return new vr(h)},Fr.prototype.searchByBoundingBox=Fr.prototype.Fc,Fr.prototype.li=function(e,r,n,o){var s,l=[];if(!Cc(e))throw new D(this.li,0,"has invalid type");cr(this.li,1,r,n);var h={layer_id:e};return o&&Ya(h,o),o=this.request("search/all",Hr,h,function(d){d.geometries.length?(d=Er(d,e),s=new Xr(d,r,n),l.push(s)):r(hf,!0)},n),l.push(o),new vr(l)},Fr.prototype.searchAll=Fr.prototype.li;var fs={delete:/^GEOMETRY_ID$/,append:/^(?!GEOMETRY_ID$)/};function gs(e,r,n,o,s,l){function h(){V++,o(this,V===w)}function d(ga){V++,s(ga,this,V===w)}var y=r!=="append",g,v={},m=oc(),w=0,I=[],V=0;if(!Bc(n))throw new D(l,0,n);for(cr(l,1,o,s),g=n.length;g--;){var q=n[g];if(C(q,Mr)){var De=q.md().Md().layerId,_n=q.ua("GEOMETRY_ID");if(y){if(_n===z||String(_n)==="")var ha='GEOMETRY_ID must not be null or ""';v[_n=De+"_"+_n]&&(ha="same GEOMETRY_ID for multiple rows"),v[_n]=q}else _n!==z&&String(_n)!==""&&(ha='GEOMETRY_ID must be null or ""')}else ha="Invalid type";if(ha)throw new D(l,0,"- Invalid row at index "+g+", "+ha);_n=m[De],_n||(_n=m[De]=[],w++),_n.push(q)}for(De in m){for(_n=m[De],n=[],g=_n.length;g--;)n.push(_n[g].Nh);I.push(e.request($r,Hr,{layer_id:De,action:r,changes:_n[0].md().Gi(fs[r]||null,n)},A(h,_n),A(d,_n)))}return new vr(I)}Fr.prototype.$i=function(e,r,n){return gs(this,"append",e,r,n,this.$i)},Fr.prototype.appendRows=Fr.prototype.$i,Fr.prototype.il=function(e,r,n){return gs(this,"update",e,r,n,this.il)},Fr.prototype.updateRows=Fr.prototype.il,Fr.prototype.kj=function(e,r,n){return gs(this,"delete",e,r,n,this.kj)},Fr.prototype.deleteRows=Fr.prototype.kj,X.prototype.Yl=function(e){return this.Ma(Fr,e)},X.prototype.getCustomLocationService=X.prototype.Yl;function hs(e){jq.j.constructor.call(this,hs,e),zp(hs)}u(hs,Op),t("H.service.extension.customRoute.Service",hs),hs.prototype.Aa=function(){return{subDomain:"s.fleet.ls",path:"2"}},hs.CONFIG_KEY="customRoute",hs.prototype.a=function(e){return Error(e.issues&&e.issues.length?e.issues.map(function(r){return r.message}).join(". "):e)},hs.prototype.Cd=function(e,r,n){return cr(this.Cd,1,r,n),e=this.v().clone().G("calculateroute.json").I(e),this.B(e,r,n)},hs.prototype.calculateRoute=hs.prototype.Cd,X.prototype.Zl=function(e){return this.Ma(hs,e)},X.prototype.getCustomRoutingService=X.prototype.Zl;function is(e,r,n){n=n||{};var o=+n.min,s=+n.max;n.min=o?ae(o,1,17):1,n.max=s?ae(s,1,17):17,is.j.constructor.call(this,n),C(e,js,is,0),C(r,Wh,is,1),this.f=e,r.a&&r.a("OMV"),this.Qa(r,!0),this.i=xp(this)}u(is,S),t("H.service.trafficVectorTile.Provider",is),is.prototype.Sb=ff,is.prototype.providesOMV=is.prototype.Sb,is.prototype.ub=function(e){return this.i.test(e)},is.prototype.cacheFilter=is.prototype.ub,is.prototype.uc=function(e,r,n){return ks(this.f,e,r,n).toString()},is.prototype.getTileKey=is.prototype.uc,is.prototype.nb=function(){return this.m},is.prototype.getCache=is.prototype.nb,is.prototype.MAX_STORE_TIME=2592e6,is.prototype.l=function(){return od()},is.prototype.c=function(){return od()?nd():is.j.c.call(this)},is.prototype.s=function(){return this.f},is.prototype.B=function(e,r,n,o,s){return this.f.Ha(e,r,n,o,s)},is.prototype.requestInternal=is.prototype.B,is.prototype.gb=function(e){e.a&&e.a("OMV"),this.Qa(e)},is.prototype.setStyle=is.prototype.gb,is.prototype.V=function(){return is.j.Ya.apply(this)},is.prototype.getStyle=is.prototype.V,is.prototype.m=new Rk(256),is.prototype.ba=function(){return null},is.prototype.getCopyrights=is.prototype.ba;function js(e){js.j.constructor.call(this,js,e),this.b=(e||jf).layer||"traffic"}u(js,Op),t("H.service.trafficVectorTile.Service",js),js.prototype.Aa=function(){return{subDomain:"traffic.vector",path:"v2"}},js.CONFIG_KEY="trafficVectorTile",js.prototype.$b=function(e,r,n){r=r||{};var o={min:0,max:22};return Ea(n)&&yp(o,n),new sl(new is(this,e,r),o)},js.prototype.createLayer=js.prototype.$b,js.prototype.Ha=function(e,r,n,o,s){return this.B(ks(this,e,r,n),function(l){return l.arrayBuffer().then(o,s)},s,"arraybuffer")};function ks(e,r,n,o){return e.v().clone().G("traffictiles/"+e.b+"/mc/"+o+"/"+r+"/"+n+"/omv")}js.prototype.f=function(e){return Ao()+"/"+e},js.prototype.vm=function(){return this.b},js.prototype.getLayerName=js.prototype.vm,X.prototype.oh=function(e){return this.Ma(js,e)},X.prototype.getTrafficVectorTileService=X.prototype.oh;function ls(e){ls.j.constructor.call(this,ls,e)}u(ls,Op),t("H.service.SearchService",ls),ls.CONFIG_KEY="search",ls.prototype.Aa=function(){return{subDomain:"search",path:"v1"}},ls.prototype.a=function(e){return e=[e.title,e.action,e.cause].filter(function(r){return r}),Error(e.join(". "))},ls.prototype.Zg=function(e,r,n){return e=this.v().clone().Ba("geocode").G("geocode").I(e),this.B(e,r,n)},ls.prototype.geocode=ls.prototype.Zg,ls.prototype.ii=function(e,r,n){return e=this.v().clone().Ba("revgeocode").G("revgeocode").I(e),this.B(e,r,n)},ls.prototype.reverseGeocode=ls.prototype.ii,ls.prototype.sl=function(e,r,n){return e=this.v().clone().Ba("autosuggest").G("autosuggest").I(e),this.B(e,r,n)},ls.prototype.autosuggest=ls.prototype.sl,ls.prototype.zl=function(e,r,n){return e=this.v().clone().Ba("discover").G("discover").I(e),this.B(e,r,n)},ls.prototype.discover=ls.prototype.zl,ls.prototype.Gn=function(e,r,n){return e=this.v().clone().Ba("lookup").G("lookup").I(e),this.B(e,r,n)},ls.prototype.lookup=ls.prototype.Gn,ls.prototype.ul=function(e,r,n){return e=this.v().clone().Ba("browse").G("browse").I(e),this.B(e,r,n)},ls.prototype.browse=ls.prototype.ul,X.prototype.Wm=function(e){return this.Ma(ls,e)},X.prototype.getSearchService=X.prototype.Wm;function ms(e){if(this.c=!!e.toBypassToken,!this.c&&!e.token)throw new D(ms,0,'"token" must be specified');zp(ms,"Use HERE IML service instead."),ms.j.constructor.call(this,ms,e),this.l=e.token,this.f={},this.b={}}u(ms,Op),t("H.service.xyz.Service",ms),ms.prototype.Aa=function(){return{host:"xyz.api.here.com",path:"hub/spaces"}},ms.prototype.a=function(e){return Error(e.errorMessage||e.message)},ms.prototype.jh=function(e,r,n){return zc(e,"String",this.jh,0,'"projectId" must be a string'),ns(this.jh,1,r,n),e=os(this.v().clone().wd("project-api/projects/"+e)),this.B(e,r,n)},ms.prototype.getProject=ms.prototype.jh,ms.prototype.Gj=function(e,r,n){return ns(this.Gj,0,e,r),n=ps(this,this.v().clone().I(n||{})),this.B(n,e,r)},ms.prototype.getSpaces=ms.prototype.Gj,ms.prototype.Kf=function(e,r,n){return zc(e,"String",this.Kf,0,'"spaceId" must be a string'),ns(this.Kf,1,r,n),e=ps(this,this.v().clone().G(e)),this.B(e,r,n)},ms.prototype.getSpace=ms.prototype.Kf,ms.prototype.Qd=function(e,r,n){return zc(e,"String",this.Qd,0,'"spaceId" must be a string'),ns(this.Qd,1,r,n),e=ps(this,this.v().clone().G(e+"/statistics")),this.B(e,r,n)},ms.prototype.getStatistics=ms.prototype.Qd,ms.prototype.Ff=function(e,r,n,o,s,l,h){return e=ps(this,this.v().clone().G(o+"/tile/web/"+n+"_"+e+"_"+r+".mvtf").I(Object.assign({clip:!0},h))),this.B(e,function(d){return d.arrayBuffer().then(s)},l,"arraybuffer")},ms.prototype.search=function(e,r,n,o){return zc(e,"String",this.search,0,'"spaceId" must be a string'),ns(this.search,1,r,n),e=ps(this,this.v().clone().G(e+"/search").I(o||{})),this.B(e,r,n)},ms.prototype.search=ms.prototype.search,ms.prototype.Sc=function(e,r,n,o){if(zc(e,"String",this.Sc,0,'"spaceId" must be a string'),!Ea(r))throw new D(this.Sc,1,'"params" must be an object');return ns(this.Sc,2,n,o),e=ps(this,this.v().clone().G(e+"/features").I(r)),this.B(e,n,o)},ms.prototype.getFeaturesById=ms.prototype.Sc,ms.prototype.Jd=function(e,r,n,o){if(zc(e,"String",this.Jd,0,'"spaceId" must be a string'),!Ea(r))throw new D(this.Sc,1,'"params" must be an object');return ns(this.Jd,2,n,o),e=ps(this,this.v().clone().G(e+"/bbox").I(r)),this.B(e,n,o)},ms.prototype.getFeaturesByBoundingBox=ms.prototype.Jd,ms.prototype.ba=function(e){var r=this.f[e];return r||(this.b[e]||qs(this,e),null)},ms.prototype.$c=function(e,r,n,o,s){if(zc(e,"String",this.$c,0,'"spaceId" must be a string'),!Ea(r))throw new D(this.$c,1,'"geojsonObject" must be an object');if(ns(this.$c,2,n,o),s&&!Ea(s))throw new D(this.$c,4,'"opt_params" must be an object');return rs(this,e,n,o,"PUT",r,s)},ms.prototype.putFeatures=ms.prototype.$c,ms.prototype.Yc=function(e,r,n,o,s){if(zc(e,"String",this.Yc,0,'"spaceId" must be a string'),!Ea(r))throw new D(this.Yc,1,'"featureCollection" must be an object');if(ns(this.Yc,2,n,o),s&&!Ea(s))throw new D(this.Yc,4,'"opt_params" must be an object');return rs(this,e,n,o,"POST",r,s)},ms.prototype.postFeatures=ms.prototype.Yc,ms.prototype.hd=function(e,r,n,o){if(zc(e,"String",this.hd,0,'"spaceId" must be a string'),!Ea(r))throw new D(this.hd,1,'"params" must be an object');return ns(this.hd,2,n,o),rs(this,e,n,o,"DELETE",B,r)},ms.prototype.deleteFeatures=ms.prototype.hd;function rs(e,r,n,o,s,l,h){var d=Object.assign(e.c?{}:{authorization:"Bearer "+e.l},{"Content-Type":"application/geo+json"},e.g);return s={method:s,headers:d},l&&(s.data=JSON.stringify(l)),r=os(e.v().clone().G(r+"/features").I(h||{})),l=new tf("application/json",r.toString(),je,s),l.then(n,Qp(e,r,o)),l}function qs(e,r){e.b[r]=ss,e.Kf(r,function(n){e.b[r]=ts,e.f[r]=n.copyright,e.dispatchEvent("copyrightupdate")},function(n){throw e.b[r]=us,n})}function ps(e,r){return e.c?r:os(r).I({access_token:e.l})}function os(e){var r=Object.assign({},e.getQuery());return delete r.apikey,e.bf(r)}ms.CONFIG_KEY="xyz";var ss=1,ts=2,us=-1;function ns(e,r,n,o){if(!Da(n))throw new D(e,r,'"onResult" must be a function');if(!Da(o))throw new D(e,r+1,'"onError" must be a function')}X.prototype.jn=function(e){return this.Ma(ms,e)},X.prototype.getXYZService=X.prototype.jn;function vs(e,r,n){var o;if(vs.j.constructor.call(this,n?{min:n.min,max:n.max,engineType:n.engineType}:void 0),C(e,ms,vs,0),!Cc(r))throw new D(vs,1,'"spaceId" must be a string');if(this.m=e,this.f=r,this.i={},n&&(["limit","simplificationLevel","tags"].forEach(function(s){s in n&&(this.i[s]=n[s])},this),e=n.parameters))for(o in e)this.i[o]=e[o];this.Qa(this.b===kk.WEBGL?new ti({sources:{xyz:{type:"MVT"}},layers:{xyz:{data:{source:"xyz",layer:this.f},points:{filter:{$geometry:"point"},draw:{points:{collide:!1,order:200,color:"#92CF48",size:[[10,"8px"],[14,"12px"],[18,"16px"]]}}},polygons:{filter:{$geometry:"polygon"},draw:{polygons:{order:201,color:"#E39E3C"},lines:{order:202,color:"#755DA5",width:"1px"}}},lines:{filter:{$geometry:"line"},draw:{lines:{order:203,color:"#000000",width:"2px",join:"round",cap:"round"}}}}}}):new H.map.render.harp.Style({styles:[{layer:this.f,when:["==",["geometry-type"],"Point"],technique:"circles",renderOrder:200,color:"#92CF48",size:["interpolate",["linear"],["zoom"],10,8,14,12,18,16]},{layer:this.f,when:["==",["geometry-type"],"Polygon"],technique:"fill",color:"#E39E3C",renderOrder:201},{layer:this.f,when:["==",["geometry-type"],"Polygon"],technique:"solid-line",color:"#755DA5",lineWidth:"1px",renderOrder:202},{layer:this.f,when:["==",["geometry-type"],"LineString"],technique:"solid-line",color:"#000000",lineWidth:"2px",renderOrder:203}]}))}u(vs,S),t("H.service.xyz.Provider",vs),vs.prototype.B=function(e,r,n,o,s){return this.m.Ff(e,r,n,this.f,o,s,this.i)},vs.prototype.requestInternal=vs.prototype.B,vs.prototype.ba=function(){return this.m.ba(this.f)},vs.prototype.getCopyrights=vs.prototype.ba,vs.prototype.Sb=ff,vs.prototype.providesOMV=vs.prototype.Sb,vs.prototype.V=function(){return this.Ya()},vs.prototype.getStyle=vs.prototype.V,vs.prototype.gb=function(e){C(e,ti)&&e.a("MVT"),this.Qa(e)},vs.prototype.setStyle=vs.prototype.gb,t("H.service.buildInfo",function(){return Hf("H-service","1.48.1","2d0df27",{region:"row"})});function ws(e,r,n,o,s){s&1&&xs(e,e,r,n,o,0),s&2&&xs(e,e,r,n,o,1),s&4&&xs(e,e,r,n,o,2),s&8&&xs(e,e,r,n,o,3)}function xs(e,r,n,o,s,l){for(var h=(n+1)*(n+1),d,y=4*o,g=n+1,v,m=[{r:0,Hl:0,tl:0,Fg:0,next:null}],w=1,I=["r","g","b","a"][l],V=2*n+1,q,De;w<V;w++)m[w]={r:0,Hl:0,tl:0,Fg:0,next:null},m[w-1].next=m[w];m[2*n].next=m[0];var _n=4*(o-1);for(d=0;d<s;d++){var ha=d*y,ga=e[ha+l],_o=ga*g*(n+2)/2;for(V=ga*g,w=0;w<=n;w++)m[w][I]=ga;var _l=0;for(w=1;w<=n;w++){var wc=w<o?ha+4*w:ha+_n;wc=e[wc+l],_o+=wc*(g-w),_l+=wc,m[n+w][I]=wc}wc=m[0],q=m[g],w=ha,De=4*g;var _h=ha+_n;for(ga=0;ga<o;ga++){r[w+l]=_o/h,_o-=V;var _p=ga+g<o?w+De:_h;if(_p=e[_p+l],_l+=_p,_o+=_l,V-=wc[I],V+=q[I],_l-=q[I],wc[I]=_p,wc=wc.next,q=q.next,w+=4,!_o)for(;(v=4*(ga+g))<y&&e[ha+l+v]===0;)ga++,w+=4}}for(ha=(s-1)*y,ga=0;ga<o;ga++){for(e=4*ga,d=r[e+l],_o=d*g*(n+2)/2,V=d*g,w=0;w<=n;w++)m[w][I]=d;for(_l=0,w=1;w<=n;w++)wc=w<s?e+w*y:e+ha,wc=r[wc+l],_o+=wc*(n-w+1),_l+=wc,m[n+w][I]=wc;for(wc=m[0],q=m[g],w=e,_h=g*y,_n=e+ha,d=0;d<s;d++)if(r[w+l]=_o/h,_o-=V,_p=d+g<s?w+_h:_n,_p=r[_p+l],_l+=_p,_o+=_l,V-=wc[I],V+=q[I],_l-=q[I],wc[I]=_p,wc=wc.next,q=q.next,w+=y,!_o)for(;(v=d+g)<s&&r[v*y+l+e]===0;)d++,w+=y}}function ys(e,r,n){this.f=r=e>>r,this.l=Math.log(r)*Math.LOG2E,this.i=e=document.createElement("CANVAS"),this.a=e.getContext("2d"),this.b=e.width=e.height=3*r;var o=document.createElement("canvas");e=n.a;var s=n.b;r=[];var l;o.width=256,o.height=1,o=o.getContext("2d");for(h in s)s.hasOwnProperty(h)&&r.push({stop:parseFloat(h),value:s[h]});s=r.length,r.sort(this.s),0<r[0].stop&&r.unshift({stop:0,value:r[0].value}),1>r[s-1].stop&&r.push({stop:1,value:r[s-1].value}),s=r.length;var h=o.createLinearGradient(0,0,256,0);for(l=0;l<s;l++){if(!e&&y){var d=y.stop+(r[l].stop-y.stop)/2;h.addColorStop(d,y.value),h.addColorStop(d,r[l].value)}h.addColorStop(r[l].stop,r[l].value);var y=r[l]}o.fillStyle=h,o.fillRect(0,0,256,1),this.c=o.getImageData(0,0,256,1).data,this.g=n.a}ys.prototype.s=function(e,r){return e.stop-r.stop};function zs(e,r){this.a=e,this.size=r}function As(e,r){var n,o=0;if(!Ea(e)||Va(e))throw new D(As,0,e);for(n in e){var s=+n;if(o++,!(Fc(s)&&0<=s&&1>=s&&Cc(e[n])))throw new D(As,0,e)}if(2>o)throw new D(As,0,"Specify at least 2 stops");this.b=e,this.a=!!r}t("H.data.heatmap.Colors",As);var Bs=new As({0:"#008","0.2":"#0b0","0.5":"#ff0","0.7":"#f00"},!0);As.DEFAULT=Bs;function Cs(e,r,n){this.a=e=ae(e,0,30),this.u=r,this.i=n,this.s=[],this.b=[];do this.b[e]=[],this.s[e]=new Ds;while(e--);r===Es?(this.m=Fs,this.l=Gs):(this.m=Hs,this.l=Is),this.c=1/0,this.f=-1/0}var Js=Math.log(.5);function Gs(e){return this.g?Math.round((e-this.c)/this.g*255):127}function Is(e){return this.U===void 0?127:Math.round(255*Math.pow(e,this.U))}Cs.prototype.Db=function(e){var r,n,o=e.value;o===void 0&&(o=1),o>this.f&&(this.f=o,this.g=this.f-this.c),o<this.c&&(this.c=o,this.g=this.f-this.c);var s=mj.Pc(e).scale(1073741823).floor();o=this.a;var l=s.x>>30-o;for(s=s.y>>30-o,n=this.m;-1<o;){this.b[o][s]||(this.b[o][s]=[]),(r=this.b[o][s][l])||(r=this.b[o][s][l]=new n(l,s,o)),r.Db(e,o);var h=this.s[o];h.f>r.b&&(h.f=r.b),h.a<r.b&&(h.a=r.b),h.c>r.a&&(h.c=r.a),h.b<r.a&&(h.b=r.a),o--,l>>=1,s>>=1}};function Ks(e,r,n,o,s){var l=1<<r,h,d;return o=$d(o,l),l=0<=n&&n<l&&(h=e.b[r])&&(d=h[n])&&(l=d[o])||null,!l&&s&&0<=r&&(l=Ks(e,r-1,n>>1,o>>1,s)),l}function Ls(e,r,n,o,s,l){for(var h,d=[];n<=o;n++)for(h=s;h<=l;h++)d.push(Ks(e,r,n,h,!1));return d}function Ms(e,r){var n=0,o=0,s=Ks(e,0,0,0,!1),l;return r.f||(r.z===e.a?r.c=r.a:(Ns(e,r,function(h){var d=Os(e,h),y=4-d.length;if(h.z!==e.a){for(l=0;l<d.length;l++)n+=d[l].a,o++;n+=y*s.a,o+=y}}),r.c=n/o),r.f=!0),r.c}function Ns(e,r,n){r=[r];for(var o,s;0<r.length;)s=r.shift(),o=Os(e,s),n(s),r.push.apply(r,o)}function Os(e,r){var n=[],o,s,l;for(s=0;1>=s;s++)for(l=0;1>=l;l++)(o=Ks(e,r.z+1,2*r.x+s,2*r.y+l,!1))&&n.push(o);return n}Cs.prototype.clear=function(){Cs.call(this,this.a,this.u,this.i)};function Hs(e,r,n){this.x=e,this.y=r,this.z=n,this.a=this.b=this.g=0,this.f=!1,this.c=0}Hs.prototype.Db=function(e,r){this.g++,this.b+=e.value||1,this.a=this.b/Math.pow(2,2*(30-r))};function Fs(e,r,n){this.x=e,this.y=r,this.z=n,this.a=this.b=this.g=0,this.f=!1,this.c=0}Fs.prototype.Db=function(e){e=e.value,this.b+=e!==void 0?e:1,this.a=this.b/++this.g,this.f=!1};function Ds(){this.f=this.c=1/0,this.a=this.b=-1/0}function Ps(e){var r=e||{},n=+r.sampleDepth,o=r.pointSize;e=+r.coarseness;var s=r.colors,l={min:r.min,max:r.max,engineType:r.engineType},h=r.tileSize,d=+r.dataMax;if(r.tileSize&&(l.tileSize=h),S.call(this,l),lk(this,r.opacity),this.i=r.type==="value"?Es:Qs,this.sampleDepth_=Fc(n)?ae(Math.round(n),1,8):4,this.L=this.i===Qs?Fc(o)?ae(Math.round(7-o),0,6):2:1,this.D=!!r.assumeValues,r=this.max,this.T=Fc(d)?ae(Math.round(d),this.min,r+this.sampleDepth_):r,e=Fc(e)?ae(Math.round(e),0,3):1,s&&!C(s,As))throw new D(Ps,0,"colors");this.f=new Cs(r+this.sampleDepth_+this.L,this.i,this.T),this.aa=new ys(this.tileSize,e,s||Bs),this.u=A(this.u,this),this.m=A(this.m,this),this.R=new Mk(20,this.u)}u(Ps,S),t("H.data.heatmap.Provider",Ps),Ps.prototype.ic=function(e){lk(this,e)},Ps.prototype.setOpacity=Ps.prototype.ic,Ps.prototype.Tc=function(){return this.g},Ps.prototype.getOpacity=Ps.prototype.Tc,Ps.prototype.Ve=ff,Ps.prototype.providesRasters=Ps.prototype.Ve,Ps.prototype.B=function(e,r,n,o,s){var l=this.D,h,d;if(Ks(this.f,0,0,0,!1)){if(!l){var y=Ls(this.f,n,r-1,r+1,e-1,e+1);for(h=y.length;h--&&!l;)if(y[h]!==null){l=!0;break}}l&&(d=this.R.push([e,r,n,o,s],this.m))}return l||o(null),d||Hl},Ps.prototype.requestInternal=Ps.prototype.B;function Rs(e,r,n,o){var s=document.createElement("canvas"),l=e.tileSize,h=s.getContext("2d");s.width=s.height=l;var d=e.aa,y=e.f,g=e.D,v=e.i,m=e.L,w=d.f,I=d.a,V,q,De=v===Qs?m===void 0?2:m:1;m=De,e=Math.min(e.sampleDepth_+De,d.l),De=d.b;var _n=y.a;if(g&&v===Es){for(q=-1;1>=q;q++)for(g=-1;1>=g;g++){var ha=(ha=Ks(y,o,n+q,r+g,!0))?y.l(Ms(y,ha)):128;I.fillStyle="rgba("+ha+",128,0,1)",I.fillRect((g+1)*w,(q+1)*w,w,w)}g=w-Math.floor(w/10),q=3,ha=I.getImageData(0,0,De,De),ws(ha.data,g,De,De,q),I.putImageData(ha,0,0)}else I.fillStyle=g?"#080":"#000",I.fillRect(0,0,De,De);for(;m<=e&&o+m<=_n;m++){g=w>>m,q=w-g;var ga=v===Qs?127+Math.floor(128/(1<<e-m)):255;ha=(1<<m)+2;var _o=1<<m,_l=r<<m,wc=n<<m;for(_o=Ls(y,o+m,wc-1,wc+_o,_l-1,_l+_o),_l=_o.length;_l--;){wc=_l%ha;var _h=_l/ha<<0;(V=_o[_l])&&(V=y.l(V.a),I.fillStyle="rgba("+V+","+ga+",0,1)",I.fillRect(wc*g+q,_h*g+q,g,g))}ha=I,ga=g,_o=q,_l=w+2*g,g=w+2*g,wc=wc=3,_h=I.getImageData(_o,q,_l,g),ws(_h.data,ga,_l,g,wc),ha.putImageData(_h,_o,q)}for(r=I.getImageData(0,0,De,De),n=d.c,o=d.g,y=r.data,e=0,De=y.length;e<De;e+=4)v=y[e],m=y[e+1],n.length===4&&(v=0),y[e]=n[4*v],y[e+1]=n[4*v+1],y[e+2]=n[4*v+2],y[e+3]=n[4*v+3]*(o?m/255:10>m?0:1);return I.putImageData(r,0,0),d=new zs(d.i,w),w=d.size,h.drawImage(d.a,w,w,w,w,0,0,l,l),s}Ps.prototype.u=function(e,r){e.done(Rs(this,r[0],r[1],r[2]))},Ps.prototype.m=function(e,r,n){var o=e.data;e=o[3],o=o[4],n?o():e(r)},Ps.prototype.Zi=function(e,r){var n;if(!Bc(e))throw new D(this.Zi,0,e);if(n=e.length){for(;n--;)this.f.Db(e[n]);e=this.f;var o;n=e.s;var s=e.a,l=0;if(e.u===Qs){var h=n[e.a].a;for(o=e.a;0<=o&&n[o].a===h;o--)l=o;for(h=n[0].a,o=0;o<=l&&h===n[o].a;o++)s=o;l>e.i&&(l=e.i),h=Math.round(s+(l-s)/2),e.U=Js/Math.log(n[h].b)}this.reload(!!r)}},Ps.prototype.addData=Ps.prototype.Zi,Ps.prototype.clear=function(){this.f.clear(),this.reload(!0)},Ps.prototype.clear=Ps.prototype.clear;var Qs=0,Es=1;function Ss(){}t("H.data.utils.Dom",Ss),Ss.prototype.Hd=function(e){return!!e&&/^\s*(1|true)\s*$/i.test(this.Na(e))},Ss.prototype.getBoolean=Ss.prototype.Hd,Ss.prototype.Na=function(e){var r;try{if(e.nodeType===Node.ATTRIBUTE_NODE)return e.value;var n="",o=0,s=e.childNodes;for(r=s.length;o<r;o++)s[o].nodeType!==Node.COMMENT_NODE&&(n+=s[o].nodeValue.replace(/^\s+|\s+$/g,""))}catch{}return n||""},Ss.prototype.getString=Ss.prototype.Na,Ss.prototype.Gf=function(e){return parseFloat(this.Na(e))||0},Ss.prototype.getFloat=Ss.prototype.Gf,Ss.prototype.vk=function(e){var r=e.split(/\s+/),n=r.length,o=!(r&&n==1),s=o?1:3,l=[],h;for(o||(r=e.split(","),n=r.length),h=0;h<n;h+=s)if(e=this.$h(o?r[h]:h+3>r.length?null:r.slice(h,h+3)))l.push(e);else return[];return l},Ss.prototype.parseCoords=Ss.prototype.vk,Ss.prototype.$h=function(e){if(!e)return null;var r=e instanceof Array&&0<e.length&&4>e.length?e:e.split(",");e=parseFloat(r[0]);var n=parseFloat(r[1]);return r=parseFloat(r[2]),isNaN(n)||isNaN(e)?null:new kg(n,e,isNaN(r)?void 0:r)},Ss.prototype.parseCoord=Ss.prototype.$h,Ss.prototype.Ef=function(e){return e=this.Na(e),/^[0-9a-fA-F]{8}$/.test(e)?"#"+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2):"#000000ff"},Ss.prototype.getColor=Ss.prototype.Ef;function Ts(e){e=e.attributes;for(var r,n=e.length;n--;)switch(r=e[n],r.name){case"x":this.x=parseFloat(r.value);break;case"y":this.y=parseFloat(r.value);break;case"xunits":this.Vc=Ss.prototype.Na(r)==="fraction";break;case"yunits":this.zc=Ss.prototype.Na(r)==="fraction"}}t("H.data.kml.HotSpot",Ts);function Us(e){var r=e.childNodes,n=new Ss;for(e=r.length;e--;){var o=r[e];switch(o.nodeName){case"href":this.href=n.Na(o)}}}t("H.data.kml.Icon",Us);function Vs(e){var r;if(e){e=e.childNodes;var n=e.length;for(r=new Ss;n--;){var o=e[n];switch(o.nodeName){case"scale":this.scale=r.Gf(o);break;case"Icon":this.icon=o=new Us(o);break;case"hotSpot":this.a=o=new Ts(o)}}}}t("H.data.kml.IconStyle",Vs);function Ws(){this.a={4:function(e){return["#",e.charAt(1),e.charAt(1),e.charAt(2),e.charAt(2),e.charAt(3),e.charAt(3),"ff"].join("")},5:function(e){return["#",e.charAt(1),e.charAt(1),e.charAt(2),e.charAt(2),e.charAt(3),e.charAt(3),e.charAt(4),e.charAt(4)].join("")},7:function(e){return e+"ff"},9:function(e){return e}},this.b={4:function(e){return[Xs(e.charAt(1)),Xs(e.charAt(2)),Xs(e.charAt(3)),255]},5:function(e){return[Xs(e.charAt(1)),Xs(e.charAt(2)),Xs(e.charAt(3)),Xs(e.charAt(4))]},7:function(e){return e=parseInt(e.substring(1),16),[e>>16&255,e>>8&255,e&255,255]},9:function(e){return e=parseInt(e.substring(1),16),[e>>24&255,e>>16&255,e>>8&255,e&255]}}}t("H.data.utils.ColorHelper",Ws);function Xs(e){return e=parseInt(e,16),(e<<4)+e}function Ys(e){return 16>e?"0"+Math.round(e).toString(16):Math.round(e).toString(16)}function Zs(e,r,n){return/^(#|rgb).*/.test(r)?(n||(n="",r.charAt(0)==="#"?n=e.a[r.length]?r:"":r.substr(0,3)==="rgb"&&(r=r.match(/\d+(\.\d+)?/g),n=r.length,n=2<n&&5>n?["#",Ys(+r[0]),Ys(+r[1]),Ys(+r[2]),3<n?Ys(255*+r[3]):"ff"].join(""):""),r=n),e=e.b[r.length](r),e[3]=Math.round(e[3]/255*100)/100,e):[0,0,0,255]}Ws.prototype.el=function(e,r){var n="";if(!/^(#|rgb).*/.test(e)){n="";var o;for(o=0;6>o;o++)n+="ABCDEF0123456789".charAt(Math.floor(16*Math.random()));return n+"ff"}for(e=Zs(this,e,r),r=0;4>r;r++)3>r?o=Math.floor(Math.random()*(e[r]+1)):o=255*e[r],n+=Ys(o);return n},Ws.prototype.toRandomRGBA=Ws.prototype.el;function $s(e){e=e.childNodes;for(var r,n=e.length,o=new Ss,s=new Ws;n--;)switch(r=e[n],r.nodeName){case"color":this.a=o.Ef(r);break;case"colorMode":this.b=o.Na(r)}this.b==="random"&&(this.a="#"+s.el(this.a,!1))}t("H.data.kml.ColorStyle",$s);function at(e){var r=e.childNodes,n=r.length,o=new Ss;for(this.a=this.fill=!0,this.b=new $s(e);n--;)switch(e=r[n],e.nodeName){case"fill":this.fill=o.Hd(e);break;case"outline":this.a=o.Hd(e)}}t("H.data.kml.PolyStyle",at);function bt(e){var r=e.childNodes,n=r.length,o=new Ss;for(this.a=new $s(e);n--;)e=r[n],e.nodeName==="width"&&(this.width=o.Gf(e))}t("H.data.kml.LineStyle",bt);function ct(e){e=e.childNodes;for(var r,n=e.length,o=new Ss;n--;)switch(r=e[n],r.nodeName){case"bgColor":this.bgColor=o.Ef(r);break;case"textColor":this.textColor=o.Ef(r);break;case"text":this.text=o.Na(r);break;case"displayMode":this.displayMode=o.Na(r)}}t("H.data.kml.BalloonStyle",ct);function dt(e){var r=e.childNodes,n=r.length;for(this.id=e.getAttribute("id");n--;)switch(e=r[n],e.nodeName){case"IconStyle":this.Oj=e=new Vs(e);break;case"LineStyle":this.Wd=e=new bt(e);break;case"PolyStyle":this.yk=e=new at(e);break;case"BalloonStyle":this.pf=e=new ct(e)}}t("H.data.kml.Style",dt);function et(e,r){e=e.childNodes;var n=e.length,o=new Ss;for(this.b=r;n--;)switch(r=e[n],r.nodeName){case"key":this.key=o.Na(r);break;case"styleUrl":this.a=o.Na(r)}}t("H.data.kml.Pair",et),et.prototype.V=function(){if(this.a){var e=this.key==="highlight";e=this.b.mh(this.a.substr(1),e)}return e},et.prototype.getStyle=et.prototype.V;function ft(e,r){var n=e.childNodes,o=n.length;for(this.b=r,this.id=e.getAttribute("id"),this.a=[];o--;)e=n[o],e.nodeName==="Pair"&&(e=new et(e,this.b),this.a.push(e))}t("H.data.kml.StyleMap",ft),ft.prototype.V=function(e){var r=null;e=e?"highlight":"normal";for(var n=this.a.length;n--;)this.a[n].key===e&&(r=this.a[n].V());return r},ft.prototype.getStyle=ft.prototype.V;function gt(){this.a={}}t("H.data.kml.StyleContainer",gt),gt.prototype.Ig=function(e){e&&e.id&&(this.a["style_"+e.id]=e)},gt.prototype.addStyle=gt.prototype.Ig,gt.prototype.mh=function(e,r){return e=this.a["style_"+e],e instanceof ft&&(e=e.V(r)),e},gt.prototype.getStyleById=gt.prototype.mh;function ht(e){e=e.childNodes;for(var r,n=e.length,o=null,s=new Ss;n--;)r=e[n],r.nodeName==="coordinates"&&(o=s.Na(r));this.a=null,o&&(this.a=s.$h(o)||null)}t("H.data.kml.Point",ht);function it(e,r){var n=e&&e.childNodes||[],o=new Ss;if(!e||!r)throw Error("Node or stylesContainer is not defined");for(this.visibility=!0,this.f=e,e=n.length;e--;){var s=n[e];switch(s.nodeName){case"name":this.name=o.Na(s);break;case"description":this.description=o.Na(s);break;case"visibility":this.visibility=o.Hd(s);break;case"open":this.open=o.Hd(s);break;case"styleUrl":(this.b=o.Na(s))&&(s=this.b.substr(1),this.c=r.mh(s,!1));break;case"Style":this.a=s=new dt(s)}}}t("H.data.kml.Feature",it);function jt(e){e=e.childNodes;for(var r,n=e.length,o=new Ss;n--;)if(r=e[n],r.nodeName==="coordinates"){var s=[],l=new Ss;try{s=l.vk(o.Na(r))}catch{s=[]}this.a=2>s.length?[]:s}}t("H.data.kml.Line",jt);function kt(e){for(var r=new L,n=e.a?e.a.length:0;n--;)r.qd(e.a[n]);return r}function lt(){}lt.prototype.f=0,lt.prototype.b=0;function mt(e){var r=e.childNodes,n=r.length;for(this.a=new L,this.c=[];n--;){var o=r[n],s=o.nodeName;if(s==="outerBoundaryIs"||s==="innerBoundaryIs"){var l=o.childNodes;for(o=l.length;o--;){var h=l[o];if(h.nodeName==="LinearRing"){var d=new jt(h);if(s==="outerBoundaryIs"){this.a=kt(d);var y=void 0,g=e,v=d.a;d=new Ss;var m=g.querySelector("altitudeMode");if(m&&m.parentNode===g&&!/^\s*clampTo/.test(d.Na(m))&&v){m=v.length;for(var w=0;w<m&&y!==0;w++){var I=v[w].alt;I?y?I!==y&&(y=0):y=I:y=0}(v=g.querySelector("*|altitudeOffset"))&&v.parentNode===h&&v.namespaceURI==="http://www.google.com/kml/ext/2.2"&&(h=d.Gf(v))&&(y+=h),y&&(y=yd(2047,y),(h=g.querySelector("extrude"))&&h.parentNode===g&&d.Hd(h)?this.b=y:this.f=y)}}else this.c.push(kt(d))}}}}}u(mt,lt),t("H.data.kml.Polygon",mt);function nt(e,r){var n=document.createElement("CANVAS");n.width=1,n.height=1,this.g=e,this.b={},this.c={},this.f=new Wj(n),this.Yb=r||""}nt.prototype.create=function(e){return this.a=new it(e,this.g),ot(this,e)};function ot(e,r,n){r=r.childNodes;for(var o=r.length,s,l={},h;o--;){var d=r[o];switch(d.nodeName){case"Point":d=new ht(d),h=pt(e,"Marker"),(d=d.a)&&(s=new Rn(d,h),h.ai&&Fe(h.ai,"statechange",A(e.i,e,h.ai,s,h),!1));break;case"LineString":d=new jt(d),h=pt(e,"Polyline"),s=new th(kt(d),h);break;case"LinearRing":d=new jt(d),h=pt(e,"Polyline"),s=new th(kt(d),h);break;case"Polygon":d=new mt(d),h=pt(e,"Polygon"),h.elevation=d.f,h.extrusion=d.b,s=new uh(new O(d.a,d.c),h);break;case"MultiGeometry":s=ot(e,d,new R)}s&&(e.a.name&&(l.name=e.a.name),e.a.description&&(l.description=e.a.description),h&&h.pf&&(l.balloonStyle=h.pf),l.kmlNode=e.a.f,s.setData(l),n&&n.fa(s))}return n||s}nt.prototype.i=function(e,r,n){var o=n.anchor,s=n.scale;n=s+"_"+o.x+o.y+o.Vc+o.zc+"_"+n.href;var l={};if(e.getState()===1){var h=this.b[n];if(!h){var d=o.x,y=o.y;(h=e.yb())&&(h={w:h.w*s,h:h.h*s},l.size=h),d=o.Vc&&h?h.w*d:d*s,y=o.zc&&h?h.h*(1-y):!o.zc&&h?h.h-y*s:y*s,l.anchor={x:d,y},h=new Wj(e.Qc(),l),this.b[n]=h}r.Ic(h)}delete this.c[n]};function pt(e,r){var n=e.a,o={visibility:n.visibility},s=new Ws,l=1,h={x:0,y:0,Vc:!1,zc:!1},d=qt(e,n.c);switch(n.a&&(d=qt(e,n.a,d)),r){case"Marker":if(d&&d.Oj){if(s=d.Oj,s.scale&&(l=s.scale),s.a){var y=s.a;h={x:y.x,y:y.y,Vc:y.Vc,zc:y.zc}}s.icon&&s.icon.href?(r=s.icon.href,rt.test(r)||(r=e.Yb+r),s=l+"_"+h.x+h.y+h.Vc+h.zc+"_"+r,y=e.b[s]||e.c[s],y||(y=new Wj(r),e.c[s]=y),y.getState()===0?(o.icon=e.f,o.ai=y,o.href=r,o.anchor=h,o.scale=l):y.getState()===1&&(o.icon=y)):l!==1&&(y||(h={x:14,y:4,Vc:!1,zc:!1}),e={w:28*l,h:36*l},l={size:new Wi(e.w,e.h),anchor:new J(h.Vc?e.w*h.x:h.x*l,h.zc?e.h*(1-h.y):e.h-h.y*l),hitArea:new Xi(Yi.POLYGON,[0*l,16*l,0*l,7*l,8*l,0*l,18*l,0*l,26*l,7*l,26*l,16*l,18*l,34*l,8*l,34*l])},o.icon=new Wj('<svg xmlns="http://www.w3.org/2000/svg" width="28px" height="36px"><path d="M 19 31 C 19 32.7 16.3 34 13 34 C 9.7 34 7 32.7 7 31 C 7 29.3 9.7 28 13 28 C 16.3 28 19 29.3 19 31 Z" fill="#000" fill-opacity=".2"/><path d="M 13 0 C 9.5 0 6.3 1.3 3.8 3.8 C 1.4 7.8 0 9.4 0 12.8 C 0 16.3 1.4 19.5 3.8 21.9 L 13 31 L 22.2 21.9 C 24.6 19.5 25.9 16.3 25.9 12.8 C 25.9 9.4 24.6 6.1 22.1 3.8 C 19.7 1.3 16.5 0 13 0 Z" fill="#fff"/><path d="M 13 2.2 C 6 2.2 2.3 7.2 2.1 12.8 C 2.1 16.1 3.1 18.4 5.2 20.5 L 13 28.2 L 20.8 20.5 C 22.9 18.4 23.8 16.2 23.8 12.8 C 23.6 7.07 20 2.2 13 2.2 Z" fill="#18d"/></svg>',l))}break;case"Polyline":o.style={},d&&d.Wd&&(l=d.Wd,o.style.strokeColor="rgba("+Zs(s,l.a.a,!0)+")",0<=l.width&&(o.style.lineWidth=l.width));break;case"Polygon":o.style={},d&&(d.Wd&&(l=d.Wd,o.style.strokeColor="rgba("+Zs(s,l.a.a,!0)+")",0<=l.width&&(o.style.lineWidth=l.width)),d.yk&&(l=d.yk,o.style.fillColor=l.fill?"rgba("+Zs(s,l.b.a,!0)+")":"rgba(0,0,0,0)",l.a||(o.style.lineWidth=0)))}return o.pf=d.pf,o}function qt(e,r,n){n=n||{};for(var o in r)r.hasOwnProperty(o)&&(n[o]=typeof r[o]=="object"?qt(e,r[o],n[o]):r[o]);return n}var rt=/^[^:\/]+:/;function st(e){xc(this,st),this.url=e,this.b=[],this.a=z,this.c=A(this.c,this),F.call(this)}u(st,F),t("H.data.AbstractReader",st);var tt={ERROR:-1,LOADING:0,VISIT:1,READY:2};st.State=tt,st.prototype.f=tt.READY,st.prototype.A={ml:"statechange"},st.prototype.ob=function(){if(!this.a){this.a=new N;var e=this.a.bc();e.Xb(this.b)}return new tl(this.a)},st.prototype.getLayer=st.prototype.ob,st.prototype.Gm=function(){return this.b.concat([])},st.prototype.getParsedObjects=st.prototype.Gm,st.prototype.v=function(){return this.url},st.prototype.getUrl=st.prototype.v,st.prototype.Co=function(e){if(this.f===tt.LOADING||this.f===tt.VISIT)throw Error("InvalidState: state "+this.f);return this.b=[],this.a=z,this.url=e,this},st.prototype.setUrl=st.prototype.Co,st.prototype.getState=function(){return this.f},st.prototype.getState=st.prototype.getState,st.prototype.O=function(e,r,n){this.f=e,this.dispatchEvent(new ut(r||this,this.A.ml,e,n||""))},st.prototype.parse=function(){var e=this;vc(this.url)?(this.O(tt.LOADING),new tf("text/plain",this.url).then(function(r){try{e.c(r)}catch(n){e.O(tt.ERROR,z,n.message)}},function(){e.O(tt.ERROR,z,"Error loading file")})):e.O(tt.ERROR,z,"File url was not set")},st.prototype.parse=st.prototype.parse;function ut(e,r,n,o){ut.j.constructor.call(this,r,e),this.state=n,this.message=o}u(ut,ud),st.Event=ut;function vt(e){var r=e?e.lastIndexOf("/"):-1;this.g=[],st.call(this,e),0<=r&&(this.i=e.substr(0,r)+"/")}u(vt,st),t("H.data.kml.Reader",vt),vt.prototype.c=function(e){var r,n=null;if(Cc(e)&&e.trim()!=""){try{var o=new DOMParser().parseFromString(e,"text/xml")}catch{this.O(tt.ERROR,z,"Error parsing KML document");return}if(o.getElementsByTagName("parsererror").length)this.O(tt.ERROR,z,"Error parsing KML document");else if((e=o.childNodes&&o.childNodes[0].nodeName==="kml"?o.childNodes[0]:void 0)&&(r=wt(e.childNodes,"Document")[0]),r=r||e){o=new gt;for(var s=wt(r.childNodes,"Style"),l=wt(r.childNodes,"StyleMap"),h=s.length;h--;)e=new dt(s[h]),o.Ig(e);for(h=l.length;h--;)e=new ft(l[h],o),o.Ig(e);for(this.l=new nt(o,this.i),e=r.childNodes,r=e.length;r--;)s=e[r],o=n,s.nodeName==="Placemark"?(s=this.l.create(s))&&xt(this,s,o):s.nodeName==="Folder"&&(s={group:new R,node:s},xt(this,s.group,o),this.g.push(s)),!r&&(o=this.g.shift())&&(e=o.node.childNodes,n=o.group,r=e.length);this.O(tt.READY)}else this.O(tt.ERROR,z,"Invalid KML document")}else this.O(tt.ERROR,z,"Unable to create objects from the empty data")};function xt(e,r,n){n?n.fa(r):(e.a&&e.a.bc().fa(r),e.b.push(r),e.O(tt.VISIT,r))}function wt(e,r){for(var n=e.length,o,s=[];n--;)o=e[n],o.nodeName===r&&s.push(o);return s}function yt(e,r){this.b=e,this.a=r}yt.prototype.create=function(e,r){var n=e.coordinates;switch(e.type){case"Point":var o=new Rn(zt(n));break;case"LineString":o=new th(At(n));break;case"Polygon":o=new uh(Bt(n));break;case"MultiPoint":var s=0,l=n.length;if(o=[],this.a){for(;s<l;s++)o.push(zt(n[s]));n=new Rn(new Vi(o))}else{for(;s<l;s++)o.push(new Rn(zt(n[s])));n=new R,n.Xb(o)}o=n,l="multiPoint";break;case"MultiLineString":if(s=0,l=n.length,o=[],this.a){for(;s<l;s++)o.push(At(n[s]));n=new th(new ih(o))}else{for(;s<l;s++)o.push(new th(At(n[s])));n=new R,n.Xb(o)}o=n,l="multiLineString";break;case"MultiPolygon":if(o=[],s=0,l=n.length,this.a){for(;s<l;s++)o.push(Bt(n[s]));n=new uh(new Ji(o))}else{for(;s<l;s++)o.push(new uh(Bt(n[s])));n=new R,n.Xb(o)}o=n,l="multiPolygon";break;case"GeometryCollection":n=o=new R,s=e.geometries,l=0;for(var h=s.length;l<h;l++)this.create(s[l],n);l="geometryCollection"}return o&&(n=o,s=e.properties,e=e.id,h={},s&&(this.a?h=s:h.properties=s),l&&!this.a&&(h[l]=!0),e&&n.Ai(e),n.setData(h),this.b(o)),r&&o&&r.fa(o),o},yt.prototype.create=yt.prototype.create;function zt(e){return new kg(e[1],e[0])}function Bt(e){for(var r=At(e[0]),n=[],o,s=1,l=e.length;s<l;s++)o=At(e[s]),n.push(o);return new O(r,n)}function At(e){for(var r=0,n=e.length,o=new L;r<n;r++)o.qd(zt(e[r]));return o}function Ct(e,r){r=r||{},this.i=r.style||this.Fd,(this.g=!!r.disableLegacyMode)||window.console.warn("H.data.geojson.Reader: Legacy parser is enabled in GeoJSON Reader. Features like Multi-Geometries, Polygon interiors and GeoJSON feature properties might not work as expected. To maximise compatibility with the remote services it is recommended to set the `disableLegacyMode` flag to true."),st.call(this,e)}u(Ct,st),t("H.data.geojson.Reader",Ct),Ct.prototype.c=function(e){var r,n;try{var o=typeof e=="string"?JSON.parse(e):e;if(typeof o=="object"){var s=new yt(this.i,this.g);switch(o.type){case"FeatureCollection":if(r=o.features){var l=new R;for(Dt(this,l),n=0;n<r.length;n++){var h=Et(r[n]);(h=s.create(h))&&l.fa(h)}}break;case"Feature":h=Et(o),(h=s.create(h))&&Dt(this,h);break;default:(h=s.create(o))&&Dt(this,h)}this.O(tt.READY)}else this.O(tt.ERROR,z,"Invalid syntax")}catch(d){this.O(tt.ERROR,z,"Parse error. "+d.message)}},Ct.prototype.io=function(e){this.O(tt.LOADING),this.c(e)},Ct.prototype.parseData=Ct.prototype.io,Ct.prototype.Fd=function(){};function Et(e){var r={};if(e.geometry){var n=e.geometry;r.type=n.type,r.properties=e.properties,n.coordinates&&(r.coordinates=n.coordinates),n.geometries&&(r.geometries=n.geometries),e.id&&(r.id=e.id)}return r}function Dt(e,r){e.a&&e.a.bc().fa(r),e.b.push(r),e.O(tt.VISIT,r)}t("H.data.buildInfo",function(){return Hf("H-data","1.48.1","2d0df27",{region:"row"})}),wg.prototype.Lc=ca(1,function(e,r){this.a.Lc(e,Fc(r)?r:this.c)}),Ag.prototype.Lc=ca(0,function(e,r){var n=0,o;if(!e(this)&&r--)for(;3>=n;n++)(o=this[n])&&o.Lc(e,r)});function Ft(e,r){this.a=e,this.b=r}t("H.clustering.grid.NoisePoint",Ft),Ft.prototype.ya=function(){return ng(this.a)},Ft.prototype.getPosition=Ft.prototype.ya,Ft.prototype.xc=function(){return this.a.wt},Ft.prototype.getWeight=Ft.prototype.xc,Ft.prototype.od=gf,Ft.prototype.isCluster=Ft.prototype.od,Ft.prototype.sc=function(){return this.b},Ft.prototype.getMinZoom=Ft.prototype.sc,Ft.prototype.getData=function(){return this.a.data},Ft.prototype.getData=Ft.prototype.getData;function Gt(e,r,n){this.g=this.b=n,this.bi=[],this.a=0,this.f=sg(e,r,!0)}t("H.clustering.grid.Cluster",Gt),Gt.prototype.ne=function(e){this.c||(this.c=ng(e)),this.a+=e.wt||1,this.bi.push(e)},Gt.prototype.ya=function(){return this.c},Gt.prototype.getPosition=Gt.prototype.ya,Gt.prototype.xc=function(){return this.a},Gt.prototype.getWeight=Gt.prototype.xc,Gt.prototype.od=ff,Gt.prototype.isCluster=Gt.prototype.od,Gt.prototype.sc=function(){return this.b},Gt.prototype.getMinZoom=Gt.prototype.sc,Gt.prototype.If=function(){return this.g},Gt.prototype.getMaxZoom=Gt.prototype.If,Gt.prototype.K=function(){return this.f},Gt.prototype.getBoundingBox=Gt.prototype.K,Gt.prototype.Yg=function(e){this.ze(e)},Gt.prototype.forEachEntry=Gt.prototype.Yg,Gt.prototype.ze=function(e){var r=this;if(!Da(e))throw new D(this.ze,0,e);this.bi.forEach(function(n){e(new Ft(n,r.b+1))})},Gt.prototype.forEachDataPoint=Gt.prototype.ze;function Ht(e){qd.call(this),this.a=[];var r;e?Ya(r={},It,e):r=It,this.g=r,qd.call(this)}u(Ht,qd);var Jt={clusters:[],noisePoints:[]},It={projection:mj,min:0,max:22,eps:32,minWeight:2};p=Ht.prototype,p.Hc=function(e){this.a=e,this.b=!0},p.Db=function(e){this.a.push(e),this.b=!0},p.mf=function(e){this.a=this.a.concat(e),this.b=!0},p.We=function(e){this.a=this.a.filter(function(r){return r!==e}),this.b=!0},p.o=function(){Ht.j.o.call(this),delete this.a},Ht.prototype.disposeInternal=Ht.prototype.o,Ht.prototype.U=ld;function Kt(e){Ht.call(this,e)}u(Kt,Ht),Kt.prototype.Ei=function(e){var r=this.g,n=r.min,o=r.max,s=[],l=[],h;if(this.b){for(h=this.a;n<=o;n++){for(var d,y=void 0,g,v,m,w,I,V,q,De=n,_n=h,ha=s,ga=l,_o=r.eps,_l=r.projection,wc=r.minWeight,_h=_n.length,_p=Math.pow(2,De+8),pd=[];q=_n[--_h];)if(!q.Ki){for(v=_l.Pc(q).scale(_p).floor(),V=_p,I=v.x,w=v.y,g=pd.length;g--;)d=pd[g],m=d.ya(),d.Ji||(d.Ji=_l.Pc(m).scale(_p).floor()),m=d.Ji,m=m.Wa(v),m<V&&(V=m,y=d);y&&y.K().gd(q)||(y=new Gt(_l.dg({x:(I-_o)/_p,y:(w-_o)/_p}),_l.dg({x:(I+_o)/_p,y:(w+_o)/_p}),De),pd.push(y)),y.ne(q),y=null}for(_h=pd.length;_h--;)if(d=pd[_h],g=d.xc(),g<wc)for(d=d.bi,g=d.length;q=d[--g];)ga.push(new Ft(q,De)),q.Ki=!0;else ha.push(d)}for(n=0,o=h.length;n<o;n++)delete h[n].Ki;this.b=!1,e({clusters:s,noisePoints:l})}};function Lt(e){this.a=e,e=document.createElement("canvas");var r=e.getContext("2d"),n=this.a,o=14*n;e.width=o,e.height=o,r.scale(n,n),r.beginPath(),r.strokeStyle="#FFFFFF",r.fillStyle="#1080DD",r.arc(7,7,6,0,2*Math.PI,!1),r.fill(),r.lineWidth=1,r.stroke(),this.f=new Wj(e,{size:{w:14,h:14},anchor:{x:7,y:7}}),this.b={},this.c={}}t("H.clustering.theme.Circular",Lt);function Mt(e,r,n){var o,s=document.createElement("canvas"),l=s.getContext("2d"),h=e.a,d=r*h;return s.width=d,s.height=d,l.scale(h,h),h=r+":"+n,(o=e.b[h])?l.putImageData(o,0,0):(r/=2,l.beginPath(),l.strokeStyle="rgba("+n+",0.2)",l.fillStyle="rgba("+n+",1)",l.arc(r,r,r/5*3,0,2*Math.PI,!1),l.fill(),l.lineWidth=r/5*4,l.stroke(),e.b[h]=l.getImageData(0,0,d,d)),s}Lt.prototype.Sl=function(e){var r=e.xc(),n=this.c[r];if(!n){if(10>r){n=Mt(this,28,"118,209,0");var o={x:11,y:18}}else 25>r?(n=Mt(this,38,"255,105,0"),o={x:13,y:23}):50>r?(n=Mt(this,38,"240,60,0"),o={x:13,y:23}):100>r?(n=Mt(this,38,"181,0,21"),o={x:13,y:23}):1e3>r?(n=Mt(this,48,"181,0,21"),o={x:15,y:28}):(n=Mt(this,66,"181,0,21"),o={x:20,y:38});var s=n.getContext("2d");s.fillStyle="#FFFFFF",s.font="bold 11px Arial",s.fillText(String(r),o.x,o.y),o=n.width/this.a,n=new Wj(n,{size:{w:o,h:o},anchor:{x:o/2,y:o/2}}),this.c[r]=n}return r=new Rn(e.ya(),{icon:n,min:e.sc(),max:e.If()}),r.setData(e),r},Lt.prototype.getClusterPresentation=Lt.prototype.Sl,Lt.prototype.Dm=function(e){var r=new Rn(e.ya(),{icon:this.f,min:e.sc()});return r.setData(e),r},Lt.prototype.getNoisePresentation=Lt.prototype.Dm;function Nt(e){if(Ht.call(this,e),e=this.g,e.projection!==mj)throw new D(Nt,0,"Other projection than mercator not supported yet");this.s=e.projection,this.f=e.eps,this.D=e.minWeight,this.m=new nj(this.s),new Pf().a("cluster","H.clustering.dynamicgrid.worker"),this.i=A(this.i,this),this.l=A(this.l,this)}u(Nt,Ht),Nt.prototype.U=function(e,r){this.u=e,this.J=Bd(r)},Nt.prototype.Ei=function(e,r){var n=this.c,o=this.u,s=this.J||0,l=!n||!(n.zoom===s&&n.b.ia(o));if(o&&(this.b||l)){if(n&&3>n.Yd&&n.cancel(),this.b=!1,n=this.f,n>=128*Gd(2,s))var h=Ot;else{l=this.m,l.Oa(s);var d=l.ib(o.Nb());h=l.ib(o.Jb()),d.y-=n,h.y+=n,d=l.Re(d);var y=l.Re(h);h=new K(d.lat,d.lng,y.lat,y.lng),n=l.Ra(n,0).lng+180,h=h.Bc(d.lat,d.lng-n,y.lat,d.lng).Bc(d.lat,y.lng,y.lat,y.lng+n)}for(n=h,d=this.a,h=[],l=d.length;l--;)n.gd(d[l])&&h.push(d[l]);0<h.length?(this.c=new Pt(o,s,h,this.f,this.D,this.s!==mj,e,r),this.c.then(this.i,this.l)):e(Jt)}},Nt.prototype.i=function(e){Ca(e)||(e=new x.Uint32Array(e)),this.c.g(Qt(this,e))},Nt.prototype.l=function(e){Cc(e)&&this.c.f(e)};var Ot=new K(90,-180,-90,180);function Qt(e,r){for(var n=0,o=r[n++],s=Array(o),l=0,h=[],d=r.length,y=e.c.a,g=e.c.zoom;o--;)s[l++]=new Ft(y[r[n++]],g);for(;n<d;){o=r[n++],l=y[r[n]];var v=e.m,m=e.f;v.Oa(e.c.zoom);var w=v.ib(l);for(l=v.Ra(w.x-m,w.y-m),v=v.Ra(w.x+m,w.y+m),l=new K(l.lat,l.lng,v.lat,v.lng),l=new Gt(l.Nb(),l.Jb(),g);o--;)l.ne(y[r[n++]]);h.push(l)}return{clusters:h,noisePoints:s}}Nt.prototype.o=function(){Nt.j.o.call(this)},Nt.prototype.disposeInternal=Nt.prototype.o;function Pt(e,r,n,o,s,l,h,d){this.b=e,this.zoom=r,this.a=n,this.g=h,this.f=d,e=n.length,h=3*e,d=new(x.Float64Array||Array)(h);for(var y;e--;)y=n[e],d[--h]=y.lat,d[--h]=y.lng,d[--h]=y.wt;ie.call(this,"cluster",{message:[d,o,s,r,l]},void 0)}u(Pt,Sf);function Rt(e,r,n){this.b=e,this.a=r,this.f=n}t("H.clustering.fastgrid.NoisePoint",Rt),Rt.prototype.ya=function(){return this.c||(this.c=this.b.Ra(this.a[1],this.a[0],1)),this.c},Rt.prototype.getPosition=Rt.prototype.ya,Rt.prototype.xc=function(){return this.a.a},Rt.prototype.getWeight=Rt.prototype.xc,Rt.prototype.od=gf,Rt.prototype.isCluster=Rt.prototype.od,Rt.prototype.sc=function(){return this.f-this.b.c},Rt.prototype.getMinZoom=Rt.prototype.sc,Rt.prototype.getData=function(){return this.a.data},Rt.prototype.getData=Rt.prototype.getData;function St(e,r,n,o){this.b=e,this.a=r,this.l=n,this.U=o,this.f=Ka(this.f,this),this.c=Ka(this.c,this)}t("H.clustering.fastgrid.Cluster",St),St.prototype.ya=function(){return this.s||(this.s=this.b.Ra(this.a.qe,this.a.re,this.a.Fb)),this.s},St.prototype.getPosition=St.prototype.ya,St.prototype.xc=function(){return this.a.Fb},St.prototype.getWeight=St.prototype.xc,St.prototype.od=ff,St.prototype.isCluster=St.prototype.od,St.prototype.sc=function(){return this.l?this.l-this.b.c:-1/0},St.prototype.getMinZoom=St.prototype.sc,St.prototype.If=function(){return this.U-this.b.c},St.prototype.getMaxZoom=St.prototype.If,St.prototype.K=function(){return this.i||(this.i=sg(this.b.Ra(this.a.a,this.a.f,1),this.b.Ra(this.a.b,this.a.c,1),!0)),this.i},St.prototype.getBoundingBox=St.prototype.K,St.prototype.Yg=function(e){this.g=e,this.a.Lc(this.f,Wd)},St.prototype.forEachEntry=St.prototype.Yg,St.prototype.f=function(e,r){var n=!1,o,s;if(e.Fb>=this.b.s&&e!==this.a&&e.Fb!==this.a.Fb&&(this.g(new St(this.b,e,0,r)),n=!0),!n&&(o=e.entries))for(e=o.length,s=0;s<e;s++)this.g(new Rt(this.b,o[s],r));return n},St.prototype.ze=function(e){this.m=e,this.a.Lc(this.c,Wd)},St.prototype.forEachDataPoint=St.prototype.ze,St.prototype.c=function(e,r){var n;if(e=e.entries){var o=e.length;for(n=0;n<o;n++)this.m(new Rt(this.b,e[n],r))}return!1};function Tt(e,r,n,o,s,l){this.g=r,e&&(this.parent=e,r&1?(n=e[8],s=e[5]):(n=e[7],s=e[8]),r&2?(o=e[9],l=e[6]):(o=e[4],l=e[9])),this[7]=n,this[5]=s,this[8]=(n+s)/2,this[4]=o,this[6]=l,this[9]=(o+l)/2}p=Tt.prototype,p.Xd=0;function Ut(e,r){return e[r]||(++e.Xd,e[r]=new Tt(e,r))}p.removeChild=function(e){var r=e.g;this[r]===e&&(delete this[r],delete e.parent,--this.Xd)},p.Lc=function(e,r){for(var n=0,o=this;o=o.parent;)++n;Vt(this,e,r,n)};function Vt(e,r,n,o){var s,l;if(!r(e,o)&&n--)for(++o,s=0;4>s;s++)(l=e[s])&&Vt(l,r,n,o)}p.qe=0,p.re=0,p.Fb=0;function Wt(e){this.b=e||10,Xt(this)}function Xt(e){e.head=e.a=new Tt(null,NaN,0,0,4294967296,4294967296)}function Yt(e,r){var n,o;for(n=0;4>n;n++)(o=r[n])&&(Yt(e,o),delete r[n]);delete r.parent,delete r.entries}function Zt(e,r){var n=e.head,o;if(r){var s=r;if(s!==n)for(n=s;s=s.parent;)(s.entries||1<s.Xd)&&(n=s)}else for(;!n.entries&&2>(o=n.Xd)&&o;)n=s;e.head=n}Wt.prototype.yc=function(e,r,n,o){var s=this.a;if(!(e>=s[7]&&r>=s[4]&&e<=s[5]&&r<=s[6]))throw Error("Coordinates out of bounds");return $t(this,this.a,e,r,n,this.b,o)};function $t(e,r,n,o,s,l,h){var d=r.entries;return l?r.Xd?d=$t(e,Ut(r,+(n>=r[8])|+(o>=r[9])<<1),n,o,s,l-1,h):d?(d=d[0],d=Ut(r,+(d[1]>=r[8])|+(d[0]>=r[9])<<1),d.entries=r.entries,d.qe=r.qe,d.re=r.re,d.Fb=r.Fb,d.a=r.a,d.f=r.f,d.b=r.b,d.c=r.c,delete r.entries,Zt(e,d),d=$t(e,Ut(r,+(n>=r[8])|+(o>=r[9])<<1),n,o,s,l-1,h)):(l=d=new au(n,o,s,h),(r.entries||(r.entries=[])).push(l),Zt(e,r)):(d||Zt(e,r),e=d=new au(n,o,s,h),(r.entries||(r.entries=[])).push(e)),r.qe+=n*s,r.re+=o*s,r.Fb+=s,r.a===B?(r.a=r.b=n,r.f=r.c=o):(n<r.a?r.a=n:n>r.b&&(r.b=n),o<r.f?r.f=o:o>r.c&&(r.c=o)),d}Wt.prototype.Lc=function(e,r){Vt(this.a,e,r===+r?r:this.b,0)};function au(e,r,n,o){this[0]=r,this[1]=e,this.a=n,this.data=o}function bu(e){Ht.call(this,e),e=this.g,this.l=e.projection,this.m=e.min,this.f=e.max,this.s=e.minWeight,this.c=7-Ad(Ed(zd(1,e.eps))/Od),this.i=new Wt(zd(this.m,this.f+this.c))}u(bu,Ht),p=bu.prototype,p.Hc=function(e){var r=0,n=e.length,o,s=new J(0,0),l=this.l,h=this.i;for(bu.j.Hc.call(this,e),Yt(h,h.a),Xt(h);r<n;r++)l.Pc(o=e[r],s).scale(4294967296).floor(),h.yc(s.x,s.y,o.wt,o.data);this.b=!0},p.Db=function(e){bu.j.Db.call(this,e),this.Hc(this.a)},p.mf=function(e){for(var r=e.length,n=bu.j.Db;r--;)n.call(this,e[r]);this.Hc(this.a)},p.We=function(e){bu.j.We.call(this,e),this.Hc(this.a)},p.Ra=function(e,r,n,o){return this.l.Ra(e/n/4294967296,r/n/4294967296,o)},p.Ei=function(e){if(this.b){var r={clusters:[],noisePoints:[]};cu(this,this.i.a,0,this.f+this.c,-1/0,r,null),this.b=!1,e(r)}};function cu(e,r,n,o,s,l,h){var d=r.Fb,y;if(h&&(h.node.Fb!==d?(l.clusters.push(new St(e,h.node,h.depth,n-1)),h=null):s++),h||(d>=e.s?(h={node:r,depth:n},s=n):du(e,r,s+1,l)),r.Xd&&o--)for(n++,d=0;4>d;d++)(y=r[d])&&(cu(e,y,n,o,s,l,h),h=null);h&&l.clusters.push(new St(e,h.node,h.depth,e.f+e.c))}function du(e,r,n,o){r=r.entries;var s;if(r){var l=r.length;for(o=o.noisePoints,s=0;s<l;s++)o.push(new Rt(e,r[s],n))}else for(s=0;4>s;s++)(l=e[s])&&du(e,l,n,o)}p.o=function(){bu.j.o.call(this),this.i=null},bu.prototype.disposeInternal=bu.prototype.o,t("H.clustering.DataPoint",function(e,r,n,o){this.lat=e,this.lng=r,this.wt=n===+n?n:1,this.data=o});function eu(e,r){r=r||{};var n={},o=r.min||0,s=zd(o,r.max||22);switch(o={min:o,max:s},eu.j.constructor.call(this,o),this.xa=r.pixelRatio||Ue(),Ya(n,It,o,r.clusteringOptions||{}),n.minWeight=zd(It.minWeight,n.minWeight),n.strategy){case fu.DYNAMICGRID:if(n.projection!==mj)throw new D(eu,1,"Unsupported projection");this.c=new Nt(n);break;case fu.GRID:this.c=new Kt(n);break;default:this.c=new bu(n)}this.c.Hc(e),this.D=r.theme||new Lt(this.xa),this.R=A(this.R,this),this.aa=A(this.aa,this),gu(this)}u(eu,N),t("H.clustering.Provider",eu),eu.prototype.o=function(){eu.j.o.call(this),this.f.na(),this.c.F(),delete this.c,delete this.L,delete this.D,x.clearTimeout(this.ea)};var fu={FASTGRID:0,GRID:1,DYNAMICGRID:2};eu.Strategy=fu,eu.prototype.R=function(){this.dispatchEvent("start"),this.c.Ei(this.aa,ld)};function gu(e,r,n){e.ea&&x.clearTimeout(e.ea),r&&e.c.U(r,n),e.ea=x.setTimeout(e.R,150)}eu.prototype.aa=function(e){this.L=e,hu(this),this.dispatchEvent("end")},eu.prototype.Hc=function(e){this.c.Hc(e),gu(this)},eu.prototype.setDataPoints=eu.prototype.Hc,eu.prototype.Db=function(e){this.c.Db(e),gu(this)},eu.prototype.addDataPoint=eu.prototype.Db,eu.prototype.mf=function(e){this.c.mf(e),gu(this)},eu.prototype.addDataPoints=eu.prototype.mf,eu.prototype.We=function(e){this.c.We(e),gu(this)},eu.prototype.removeDataPoint=eu.prototype.We,eu.prototype.Zm=function(){return this.D},eu.prototype.getTheme=eu.prototype.Zm,eu.prototype.zo=function(e){this.D=e,this.L&&(this.f.na(),hu(this))},eu.prototype.setTheme=eu.prototype.zo;function hu(e){var r=e.L.clusters,n=e.L.noisePoints,o=r.length,s=n.length,l=0<o+s;for(e.f.na();s--;){var h=n[s];e.f.fa(e.D.getNoisePresentation(h))}for(;o--;)n=r[o],e.f.fa(e.D.getClusterPresentation(n));l&&e.Va()}eu.prototype.Qb=function(){return!0},eu.prototype.providesDomMarkers=eu.prototype.Qb,eu.prototype.Rb=function(){return!0},eu.prototype.providesMarkers=eu.prototype.Rb,eu.prototype.Cc=function(){return!0},eu.prototype.providesSpatials=eu.prototype.Cc,eu.prototype.Ue=function(e,r){gu(this,e,r)},eu.prototype.preprocessData=eu.prototype.Ue,t("H.clustering.buildInfo",function(){return Hf("H-clustering","1.48.1","2d0df27",{region:"row"})});function iu(e,r){t:{for(var n=e.length,o=typeof e=="string"?e.split(""):e,s=0;s<n;s++)if(s in o&&r.call(void 0,o[s],s,e)){r=s;break t}r=-1}return 0>r?null:typeof e=="string"?e.charAt(r):e[r]}var ju={};function ku(e){var r=e.ownerDocument,n=r.documentElement;r=r.defaultView;var o=e.getBoundingClientRect();return e=o.left,o=o.top,isNaN(r.pageXOffset)?(e+=n.scrollLeft,o+=n.scrollTop):(e+=r.pageXOffset,o+=r.pageYOffset),new J(e,o)}function lu(e,r,n){r=Fc(r)?r+"px":r,n=Fc(n)?n+"px":n,e.style[Af("transform")]="translate("+r+","+n+")"}var mu,nu=navigator.userAgent,ou=-1<nu.indexOf("Android")&&-1<nu.indexOf("Mozilla/5.0")&&-1<nu.indexOf("AppleWebKit"),pu=/AppleWebKit\/([\d.]+)/,qu=pu.exec(nu)===null?null:parseFloat(pu.exec(nu)[1]);mu=ou&&qu!==null&&537>qu;var ru=globalThis,su=document.createElement("T");function tu(){this.a=this.lj()}tu.prototype.lj=function(){var e=navigator,r=[];return e&&(e.msPointerEnabled?r.push(uu):e.pointerEnabled&&r.push(vu)),1>r.length&&("TouchEvent"in ru&&r.push(wu),r.push(xu)),r},tu.prototype.detectEventSets=tu.prototype.lj,tu.prototype.addEventListener=function(e,r,n,o){for(var s=this.a,l,h=s.length,d=!1;h--;)(l=s[h][r])&&(d=!0,e.addEventListener(l,n,o||!1));d||e.addEventListener(r,n,o||!1)},tu.prototype.removeEventListener=function(e,r,n,o){for(var s=this.a,l,h=s.length,d=!1;h--;)(l=s[h][r])&&(d=!0,e.removeEventListener(l,n,o||!1));d||e.removeEventListener(r,n,o||!1)};var vu={start:"pointerdown",end:"pointerup",move:"pointermove",cancel:"pointercancel",over:"pointerover",out:"pointerout",hover:"pointerhover"},uu={start:"MSPointerDown",end:"MSPointerUp",move:"MSPointerMove",cancel:"MSPointerCancel",over:"MSPointerOver",out:"MSPointerOut",hover:"MSPointerHover"},wu={start:"touchstart",end:"touchend",move:"touchmove",cancel:"touchcancel"},xu={start:"mousedown",end:"mouseup",move:"mousemove",over:"mouseover",out:"mouseout",hover:"mousehover"};function yu(e,r,n,o){return e=e.createElement(r),n&&(e.className=n),o&&(e.innerHTML=o),e}function zu(e,r){for(var n=1,o=arguments.length;n<o;n++)e.appendChild(arguments[n])}var Au=new tu;function Bu(e,r,n){Au.addEventListener(e,r,n,void 0)}function Cu(e,r,n){Au.removeEventListener(e,r,n,void 0)}function Y(e,r){F.call(this),this.ab=e||"div",this.f=r?r.split(" "):[],this.L=!1,this.f.push("H_el")}u(Y,F),t("H.ui.base.Element",Y),Y.prototype.W=function(e){if(!e)throw Error("Wrong document object");return this.S=yu(e,this.ab,this.f.join(" ")),this.renderInternal(this.S,e),this.va(this.dc(),!0),this.jc(this.aa),this.qb(this.R),this.S},Y.prototype.ta=function(){},Y.prototype.T=function(){},Y.prototype.X=function(){},Y.prototype.renderInternal=Y.prototype.X,Y.prototype.dc=function(){return this.L},Y.prototype.isDisabled=Y.prototype.dc,Y.prototype.va=function(e,r){return e=!!e,(e!==this.L||r)&&((this.L=e)?this.Ka("H_disabled"):this.kb("H_disabled")),this},Y.prototype.setDisabled=Y.prototype.va,Y.prototype.J=null,Y.prototype.getData=function(){return this.J},Y.prototype.getData=Y.prototype.getData,Y.prototype.setData=function(e){this.J=e},Y.prototype.setData=Y.prototype.setData,Y.prototype.jc=function(e){var r=this.N();this.aa=e,r&&(e?r.setAttribute("title",e):r.removeAttribute("title"))},Y.prototype.setTooltip=Y.prototype.jc,Y.prototype.S=null,Y.prototype.N=function(){return this.S},Y.prototype.getElement=Y.prototype.N,Y.prototype.R=!0,Y.prototype.qb=function(e){var r=this.N();this.R=e,r&&(r.style.display=e?"":"none")},Y.prototype.setVisibility=Y.prototype.qb,Y.prototype.wc=function(){return this.R},Y.prototype.getVisibility=Y.prototype.wc,Y.prototype.Ka=function(e){var r=this.N();return 0>this.f.indexOf(e)&&this.f.push(e),r&&(r.className=this.f.join(" ")),this},Y.prototype.addClass=Y.prototype.Ka,Y.prototype.kb=function(e){e=this.f.indexOf(e);var r=this.N();return-1<e&&this.f.splice(e,1),r&&(r.className=this.f.join(" ")),this},Y.prototype.removeClass=Y.prototype.kb;function Du(e){(e=e.N())&&e.parentNode&&e.parentNode.removeChild(e)}Y.prototype.o=function(){Y.j.o.call(this),Du(this),this.J=this.S=null,delete this.aa};function Eu(e){e=e||{},Y.call(this,"div","H_btn"),this.Jc(e.label||" "),this.jc(e.tooltip||""),this.setData(e.data),this.va(!!e.disabled),this.O(Fu.UP,!0),e.onStateChange&&this.addEventListener("statechange",e.onStateChange),this.b=A(this.b,this),this.a=A(this.a,this)}u(Eu,Y),t("H.ui.base.Button",Eu),Eu.prototype.va=function(e,r){return e&&this.kb("H_active"),Eu.j.va.call(this,e,r)},Eu.prototype.setDisabled=Eu.prototype.va,Eu.prototype.X=function(e){Bu(e,"start",this.b),Bu(e,"end",this.a),Bu(e,"out",this.a),this.Jc(this.Ge(),!0)},Eu.prototype.renderInternal=Eu.prototype.X,Eu.prototype.getState=function(){return this.C},Eu.prototype.getState=Eu.prototype.getState,Eu.prototype.O=function(e,r){return e!==this.C&&(this.C=e,e===Fu.DOWN?this.Ka("H_active"):this.kb("H_active"),r||this.dispatchEvent("statechange")),this},Eu.prototype.setState=Eu.prototype.O,Eu.prototype.Ge=function(){return this.c},Eu.prototype.getLabel=Eu.prototype.Ge,Eu.prototype.Jc=function(e,r){return(r||e!==this.c)&&(this.c=e,(r=this.N())&&(r.innerHTML=e)),this},Eu.prototype.setLabel=Eu.prototype.Jc,Eu.prototype.b=function(e){this.dc()||this.O(Fu.DOWN),e.preventDefault()},Eu.prototype.a=function(e){this.dc()||this.O(Fu.UP),e.preventDefault()},Eu.prototype.o=function(){var e=this.N();e&&(Cu(e,"start",this.b),Cu(e,"end",this.a),Cu(e,"out",this.a)),Y.prototype.o.call(this)};var Fu={UP:"up",DOWN:"down"};Eu.State=Fu;var Gu={in:'<svg version="1.1" class="H_icon" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g><path d="m5 10.6h5.6v-5.6h2.8v5.6h5.6v2.8h-5.6v5.6h-2.8v-5.6h-5.6v-2.8z"></path></g></svg>',out:'<svg version="1.1" class="H_icon" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><path d="m5 10.6h14v2.8h-14z"/></svg>'};function Hu(e){e=e||{};var r;this.b=!!e.vertical,this.ea=e.length||"16em",this.a=Fc(r=e.min)?r:0,this.i=zd(this.a,Fc(r=e.max)?r:100),this.wa=E(r=e.step)?1:r,this.l=Iu(this,Fc(r=e.value)?r:(this.a+this.i)/2),this.ag=A(this.ag,this),this.Wf=A(this.Wf,this),this.cg=A(this.cg,this),this.bg=A(this.bg,this),this.s=e.pointerArea,Y.call(this,"div","H_slider"+(this.b?"":" H_l_horizontal"))}u(Hu,Y),t("H.ui.base.Slider",Hu),Hu.prototype.wg=function(e,r){var n=this.b,o=n?"top":"left";return(!this.c||r)&&(e=ae(e,this.a,this.i),this.g&&(r=100*(e-this.a)/(this.i-this.a),n=(n?-1:1)*r,this.g.style[o]=n+"%",this.qa.style[o]=100+n+"%"),this.l=Iu(this,e)),this.l},Hu.prototype.setValue=Hu.prototype.wg,Hu.prototype.en=function(){return this.l},Hu.prototype.getValue=Hu.prototype.en;function Ju(e){if(!e.m){Bu(e.N(),"start",e.ag);var r=e.s;Bu(r,"move",e.Wf),Bu(r,"end",e.cg),Bu(r,"out",e.bg),e.m=!0}}function Ku(e){if(e.m){Cu(e.N(),"start",e.ag);var r=e.s;Cu(r,"move",e.Wf),Cu(r,"end",e.cg),Cu(r,"out",e.bg),e.m=!1}}function Iu(e,r){var n=e.wa;return r=ae(r,e.a,e.i),n?e.a+Ad((r-e.a)/n)*n:r}function Lu(e,r){var n=e.D,o=e.b;e.u||(e.u=n["offset"+(o?"Height":"Width")]),r-=ku(n)[o?"y":"x"],0>r&&(r=0),r=(e.i-e.a)*r/e.u,r=Iu(e,o?e.i-r:e.a+r),e.l!==r&&(e.wg(r,!0),e.dispatchEvent(new cj(e.A.ed,r,e.l)))}function Mu(e,r){return(r.touches?r.targetTouches[0]:r)["page"+(e.b?"Y":"X")]}function Nu(e){var r=!1,n=e.type;return n.indexOf("pointer")!==-1||n.indexOf("touch")!==-1?r=!0:C(e,MouseEvent)&&(r=e.which===1||e.buttons===1),r}function Ou(e){var r=e.touches;return r&&r.length===1||C(e,MouseEvent)}p=Hu.prototype,p.ag=function(e){var r=this.b;if(Nu(e)&&Ou(e)){var n=Mu(this,e),o=e.target;o===this.g||o.parentElement===this.g?(this.P=n-ku(this.g)[r?"y":"x"]-this.g.offsetWidth/2,this.N().className="H_slider H_slider_active"+(this.b?"":" H_l_horizontal"),this.c=!0):Lu(this,n),e.preventDefault()}},p.cg=function(){this.c&&(this.N().className="H_slider "+(this.b?"":" H_l_horizontal"),this.c=!1)},p.bg=function(e){this.c&&e.target===this.s&&(this.c=!1)},p.Wf=function(e){this.c&&Ou(e)&&(Nu(e)?(Lu(this,Mu(this,e)-this.P),e.preventDefault()):this.c=!1)},p.A={ed:"change"},p.X=function(e,r){var n=yu(r,"div","H_slider_cont"),o=yu(r,"div","H_slider_knob_cont"),s=yu(r,"div","H_slider_knob"),l=yu(r,"div","H_slider_knob_halo"),h=yu(r,"div","H_slider_track");r=yu(r,"div","H_slider_track H_slider_track_active"),e.appendChild(n),n.appendChild(h),h.appendChild(r),n.appendChild(o),o.appendChild(s),o.appendChild(l),this.D=h,this.qa=r,this.g=o,this.s||(this.s=e.ownerDocument.body),n.style[this.b?"height":"width"]=this.ea,this.wg(this.l),Ju(this)},Hu.prototype.renderInternal=Hu.prototype.X,Hu.prototype.o=function(){Ku(this)},Hu.prototype.va=function(e,r){return e?Ku(this):this.D&&Ju(this),Y.prototype.va.call(this,e,r)},Hu.prototype.setDisabled=Hu.prototype.va;var Pu={TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right",LEFT_TOP:"left-top",LEFT_MIDDLE:"left-middle",LEFT_BOTTOM:"left-bottom",RIGHT_TOP:"right-top",RIGHT_MIDDLE:"right-middle",RIGHT_BOTTOM:"right-bottom",BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right"};t("H.ui.LayoutAlignment",Pu);function Qu(e,r,n){Y.call(this,e,r),this.a=n?n.concat():[]}u(Qu,Y),t("H.ui.base.Container",Qu),Qu.prototype.va=function(e,r){var n=this.a?this.a.length:0;for(Y.prototype.va.call(this,e,r);n--;)this.a[n].va(e,r);return this},Qu.prototype.setDisabled=Qu.prototype.va,Qu.prototype.Ja=function(e){var r=this.N();return this.a.push(e),r&&(e.W(r.ownerDocument),r.appendChild(e.N())),this},Qu.prototype.addChild=Qu.prototype.Ja,Qu.prototype.dh=function(){return this.a.concat()},Qu.prototype.getChildren=Qu.prototype.dh,Qu.prototype.removeChild=function(e){var r=this.a.indexOf(e),n=this.N();0<=r&&(this.a.splice(r,1),n&&n.removeChild(e.N()))},Qu.prototype.removeChild=Qu.prototype.removeChild,Qu.prototype.na=function(){var e=this.N();e&&this.a.forEach(function(r){e.removeChild(r.N())}),this.a=[]},Qu.prototype.X=function(e,r){for(var n=0,o=this.a.length;n<o;n++)e.appendChild(this.a[n].W(r))},Qu.prototype.renderInternal=Qu.prototype.X,Qu.prototype.o=function(){this.na(),this.a.forEach(this.qa,this),Y.prototype.o.call(this)},Qu.prototype.qa=function(e){e.F()};function Ru(){Qu.call(this,"div","H_ctl"),this.map=null,this.Mc="top-left"}u(Ru,Qu),t("H.ui.Control",Ru),Ru.prototype.Ia=function(e){this.map=e},Ru.prototype.W=function(e){return Qu.prototype.W.call(this,e)},Ru.prototype.X=function(e,r){Qu.prototype.renderInternal.call(this,e,r),this.Vb(this.Mc)},Ru.prototype.renderInternal=Ru.prototype.X,Ru.prototype.Qe=function(){},Ru.prototype.onUnitSystemChange=Ru.prototype.Qe,Ru.prototype.Lb=function(){return this.map},Ru.prototype.getMap=Ru.prototype.Lb,Ru.prototype.pa=function(){return this.xa},Ru.prototype.getLocalization=Ru.prototype.pa,Ru.prototype.Ll=function(){return this.Mc},Ru.prototype.getAlignment=Ru.prototype.Ll,Ru.prototype.Vb=function(e){return typeof e=="string"&&Pu[e.replace("-","_").toUpperCase()]===e&&(this.Mc=e,this.dispatchEvent("alignmentchange")),this},Ru.prototype.setAlignment=Ru.prototype.Vb;function Su(e){e=e||{};var r=e.slider;Ru.call(this),this.s=A(this.s,this),this.g=A(this.g,this),this.b=A(this.b,this),r&&(this.u=A(this.u,this),this.D=r,this.wa=e.sliderSnaps,this.Ka("H_zoom_slider")),this.i=new Eu({label:Gu.in,onStateChange:this.s}),this.m=new Eu({label:Gu.out,onStateChange:this.s}),this.Ka("H_zoom"),this.Ka("H_grp"),this.ea=e.fractionalZoom!==!1,this.setZoomSpeed(e.zoomSpeed||4),this.Vb(e.alignment||"right-middle")}u(Su,Ru),t("H.ui.ZoomControl",Su),Su.prototype.kn=function(){return this.P},Su.prototype.getZoomSpeed=Su.prototype.kn,Su.prototype.Do=function(e){this.P=e},Su.prototype.setZoomSpeed=Su.prototype.Do,Su.prototype.Ia=function(e){this.map!==e&&(this.map&&this.map.removeEventListener("mapviewchange",this.g),Tu(this)),Ru.prototype.Ia.apply(this,arguments),this.map&&(this.b(),e.addEventListener("mapviewchange",this.g),e.addEventListener("baselayerchange",this.b))},Su.prototype.setMap=Su.prototype.Ia,Su.prototype.o=function(){Ru.prototype.o.apply(this,arguments),this.map.removeEventListener("baselayerchange",this.b),Tu(this)},Su.prototype.X=function(e,r){Ru.prototype.renderInternal.call(this,e,r),this.i.jc(this.pa().translate("zoom.in")),this.m.jc(this.pa().translate("zoom.out"))},Su.prototype.renderInternal=Su.prototype.X,Su.prototype.Vb=function(e){var r=this.Mc;return Ru.prototype.Vb.call(this,e),r!==e&&this.b(),this},Su.prototype.setAlignment=Su.prototype.Vb,Su.prototype.g=function(){var e=this.map,r=e.pb(),n=e.Xa()-1;e=e.g||e.f.getCapabilities().lookAt.zoom,this.D&&this.c.wg(r),this.dc()||(this.i.va(r+n>=e.max),this.m.va(r<=e.min))},Su.prototype.va=function(e,r){return Su.j.va.call(this,e,r),this.g(),this},Su.prototype.setDisabled=Su.prototype.va;function Tu(e){e.removeChild(e.c),e.c=null,e.l&&(e.l.removeEventListener("minchange",e.b),e.l.removeEventListener("maxchange",e.b),e.l=null)}Su.prototype.s=function(e){e=e.target;var r=e===this.i?1:-1,n=0<r?Math.ceil:Math.floor,o=this.map,s,l=this;o&&(e.getState()==="down"?(o.c.startControl(),o.c.control(0,0,r*this.P,0,0,0)):o.c.endControl(!0,function(h){s=l.ea?h.zoom:n(h.zoom),h.zoom=s}))},Su.prototype.u=function(e){this.map&&this.map.df(e.newValue)},Su.prototype.b=function(){var e=this.Mc,r=this.Lb();if(/^top/g.test(e)||/^bottom/g.test(e)){var n=this.m;e=this.i;var o=!1}else n=this.i,e=this.m,o=!0;if(this.removeChild(n),this.removeChild(e),this.Ja(n),this.D&&r){Tu(this),r=o;var s=(o=(n=this.map)&&n.g)||n.f.getCapabilities().lookAt.zoom;(this.l=o)&&(o.addEventListener("minchange",this.b),o.addEventListener("maxchange",this.b)),this.c=new Hu({step:this.wa?1:0,vertical:r,min:s.min,max:s.max,value:n.pb(),pointerArea:n.N()}),this.c.addEventListener(this.c.A.ed,this.u),this.Ja(this.c)}this.Ja(e)};function Uu(e,r){var n={},o={};n["top-left"]=yu(r,"div",[Vu,Wu].join(" ")),n["top-center"]=yu(r,"div",[Vu,Xu,Yu,Wu].join(" ")),n["top-right"]=yu(r,"div",[Vu,Wu].join(" ")),n["left-top"]=yu(r,"div",[Vu,Zu].join(" ")),n["left-middle"]=yu(r,"div",[Vu,$u,av,Zu].join(" ")),n["left-bottom"]=yu(r,"div",[Vu,Zu].join(" ")),n["right-top"]=yu(r,"div",[Vu,Zu].join(" ")),n["right-middle"]=yu(r,"div",[Vu,bv,av,Zu].join(" ")),n["right-bottom"]=yu(r,"div",[Vu,Zu].join(" ")),n["bottom-left"]=yu(r,"div",[Vu,Wu].join(" ")),n["bottom-center"]=yu(r,"div",[Vu,cv,Yu,Wu].join(" ")),n["bottom-right"]=yu(r,"div",[Vu,Wu].join(" ")),o["top-left"]=yu(r,"div",[Xu,$u].join(" ")),o["top-right"]=yu(r,"div",[Xu,bv].join(" ")),o["bottom-left"]=yu(r,"div",[cv,$u].join(" ")),o["bottom-right"]=yu(r,"div",[cv,bv].join(" ")),zu(o["top-left"],n["top-left"],n["left-top"]),zu(o["top-right"],n["top-right"],n["right-top"]),zu(o["bottom-left"],n["left-bottom"],n["bottom-left"]),zu(o["bottom-right"],n["right-bottom"],n["bottom-right"]),zu(e,o["top-left"],o["top-right"],o["bottom-left"],o["bottom-right"],n["top-center"],n["left-middle"],n["right-middle"],n["bottom-center"]),this.a=n}var Xu="H_l_top",cv="H_l_bottom",$u="H_l_left",bv="H_l_right",Yu="H_l_center",av="H_l_middle",Wu="H_l_horizontal",Zu="H_l_vertical",Vu="H_l_anchor";Uu.prototype.update=function(){var e=this.a;dv(e["top-center"],!0),dv(e["bottom-center"],!0),dv(e["left-middle"],!1),dv(e["right-middle"],!1)};function dv(e,r){r?(r=e.offsetWidth,e.style.marginLeft=-Math.round(.5*r)+"px"):(r=e.offsetHeight,e.style.marginTop=-Math.round(.5*r)+"px")}Uu.prototype.put=function(e,r){e=e?e.N():null;var n=r?this.a[r]:null;e&&n&&(e.parentElement&&e.parentElement.removeChild(e),n.insertBefore(e,/(bottom|right)$/.test(r)||/(center|middle)/.test(r)&&n.childNodes.length%2?n.firstChild:null)),this.update()};var ev={IMPERIAL:"imperial",METRIC:"metric"};t("H.ui.UnitSystem",ev);var fv={btn:'<svg class="H_icon" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><g fill-rule="evenodd"><g transform="translate(3 2)"><path d="m18 13v7h-18v-7h2v5h2v-2h2v2h2v-3h2v3h2v-2h2v2h2v-5z"></path><path d="m2.3.3c.7 0 1.3.1 1.8.4s.9.6 1.1 1 .4.9.4 1.4c0 .5-.1 1-.3 1.4s-.57 1-1 1.6-1.3 1.3-2.3 2.2h3.9l-.2 1.7h-6.16v-1.6c1.1-1.1 2-2 2.5-2.6s.9-1 1-1.4.3-.8.3-1.2c0-.4-.1-.7-.3-.9s-.5-.3-.9-.3c-.3 0-.6 0-.9.2s-.5.4-.8.7l-1.3-1c.4-.5.9-.9 1.4-1.2s1.2-.4 1.8-.4zm14.4 9.7h-2.3l-.2-3.8c 0-.9-.1-1.7-.1-2.4 0-.5 0-1 0-1.5l-1.5 6.7h-2.2l-1.6-6.7c.1.8.1 1.6.1 2.3 0 .5 0 1.1 0 1.7l-.2 3.8h-2.2l.7-9.7h2.9l1.5 6.6 1.4-6.6h2.9z"></path></g></g></svg>',point:'<svg height="22" viewBox="0 0 12 12" width="22" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m6 12c3.3 0 6-2.7 6-6s-2.7-6-6-6-6 2.7-6 6 2.7 6 6 6z" fill="#fff"></path><path d="m6 10c2.2 0 4-1.8 4-4s-1.8-4-4-4-4 1.8-4 4 1.8 4 4 4z" fill="#2ed5c9" stroke="#272c36" stroke-width="2"></path></g></svg>'};function gv(e){Eu.call(this,e),this.i=function(r){r.preventDefault()},this.g=A(function(r){this.dc()||this.toggleState(),r.preventDefault()},this)}u(gv,Eu),t("H.ui.base.PushButton",gv),gv.prototype.X=function(e){Bu(e,"start",this.g),Bu(e,"end",this.i),this.Jc(this.Ge(),!0)},gv.prototype.renderInternal=gv.prototype.X,gv.prototype.Lo=function(){var e=Fu.DOWN;return this.O(this.getState()===e?Fu.UP:e),this},gv.prototype.toggleState=gv.prototype.Lo,gv.prototype.o=function(){var e=this.N();e&&Cu(e,"start",this.g),Eu.prototype.o.call(this)};function hv(e,r,n){bj.call(this,e,{icon:iv,visibility:n}),jv(this,r)}u(hv,bj);function jv(e,r){e.zn=r,e.S&&(e.S.textContent=r)}var iv=new Ti(yu(ru.document,"span","H_dm_label"),{onAttach:function(e,r,n){n.S=e,jv(n,n.zn)},onDetach:function(e,r,n){delete n.S}});function kv(e,r){F.call(this),this.b=e,this.f=new hv(this.Jo,""),r.push(this.f),this.a=new R({objects:r,data:this}),this.ug=this.ug.bind(this)}u(kv,F),p=kv.prototype,p.Wc=!1,p.Jo={lat:0,lng:0},p.Jc=function(e,r){jv(this.f,e),this.f.da(r)},p.Rh=0,p.ug=function(){this.f.qb(this.m)};function lv(e,r){r&&(e.nextSibling=r,r.previousSibling=e)}function mv(e,r,n,o){var s=new L,l=[];lv(e,this),lv(this,r),s.qd(e.ya()),s.qd(r.ya()),this.c=new th(s,{style:n.Wd}),this.i=new th(s,{style:{strokeColor:"transparent",lineWidth:Math.min(100,this.c.V().lineWidth+2*(o||5))}}),n.c&&(this.g=new th(s,{style:n.c}),l.push(this.g)),l.push(this.c,this.i),kv.call(this,n,l),this.s=this.l=-1,e=this.a,e.addEventListener("pointermove",this.J,!0,this),e.addEventListener("pointerleave",this.u,!0,this)}u(mv,kv),mv.prototype.Ee=function(){var e=this.c.ga();return e.ye(0).Wa(e.ye(1))};function nv(e,r,n){var o=e.c.ga();o.ff(3*+n,3,[r.lat,r.lng,0]),e.g&&e.g.da(o),e.i.da(o),e.c.da(o)}mv.prototype.J=function(e){var r=e.currentPointer;e=this.previousSibling.ya();var n=this.nextSibling.ya(),o=this.b.f,s=r.viewportX;r=r.viewportY,(this.l!==s||this.s!==r)&&(this.l=s,this.s=r,o.da(this.b.g(e,n,{x:s,y:r})),o.qb(!0))},mv.prototype.u=function(){this.b.f.qb()},mv.prototype.ni=function(){this.Jc(this.b.a(this.Ee()),this.c.K().bb())};function ov(e,r,n){n=r.b(n||0),this.c=new Rn(e,{icon:n,zIndex:0}),this.c.draggable=!0,kv.call(this,r,[this.c]),e=this.a,e.addEventListener("dragstart",this.Qn,!0,this),e.addEventListener("drag",this.Rn,!0,this),e.addEventListener("dragend",this.Pn,!0,this)}u(ov,kv),p=ov.prototype,p.hk=0,p.A={ed:"change"},p.Ee=function(){return this.hk},p.ya=function(){return this.c.ga()};function pv(e){var r=0;e.nextSibling&&e.previousSibling&&(e.nextSibling.Wc||e.previousSibling.Wc?e.nextSibling.Wc&&!e.previousSibling.Wc&&(r=2):r=1),r=e.b.b(r),e.c.Ic(r)}p.Rn=function(e){var r=e.currentPointer;e=r.viewportX,r=r.viewportY,(this.i!==e||this.l!==r)&&(this.i=e,this.l=r,this.c.da(this.b.map.Pa(e-this.g.x,r-this.g.y)),this.dispatchEvent(new ud(this.A.ed,this)))},p.Qn=function(e){var r=e.currentPointer,n=r.viewportX;r=r.viewportY;var o=this.b.map.Da(this.ya());this.c.fe(1),this.g={x:n-o.x,y:r-o.y},e.stopPropagation()},p.Pn=function(){this.c.fe(0)},p.ni=function(e){this.hk=e,this.Jc(this.b.a(e),this.ya())};function qv(e,r){this.Ca=r,this.b=e,this.a={Wc:!0},rv(this,this.a),this.$f=A(this.$f,this)}t("H.ui.distanceMeasurement.Model",qv),p=qv.prototype,p.Rf=function(){return this.a.nextSibling===this.a};function sv(e,r){e=e.a;for(var n=e.nextSibling;n!==e;){var o=n,s=n.previousSibling===e?!1:r;(o.m=s)?o.ug():(o.Rh&&x.clearTimeout(o.Rh),o.Rh=x.setTimeout(o.ug,100)),n=n.nextSibling}}function tv(e,r){var n=r||e.a.nextSibling,o=0,s=0;if(r&&!uv(e,r))throw new D(e.Xe,0,r);for(n instanceof ov?o=n.Ee():n instanceof mv&&(o=n.previousSibling.Ee()),r=n;r&&r!==e.a;r=r.nextSibling,s++)r.ni(o),s%2===1&&(o+=r.Ee())}p.ne=function(e){var r=this.a.previousSibling,n=this.Rf();return e=new ov(e,this.Ca,n?0:2),this.b.fa(e.a),lv(e,this.a),e.addEventListener(e.A.ed,this.$f),n?rv(this,e):(vv(this,r,e),pv(r),tv(this,r)),e},p.insertBefore=function(e,r){var n,o=1;if(r){if(!uv(this,r))throw new D(this.insertBefore,1,r);(n=r.previousSibling.Wc)&&(o=0),e=new ov(e,this.Ca,o),e.addEventListener(e.A.ed,this.$f),this.b.fa(e.a),n?(n=this.a.nextSibling,vv(this,e,n),rv(this,e),r=e,pv(n)):(n=r.previousSibling,r=n.previousSibling,o=n.nextSibling,this.b.Ga(n.a),vv(this,r,e),vv(this,e,o)),tv(this,r)}else e=this.ne(e);return e},p.na=function(){rv(this,this.a),this.b.na()},p.Xe=function(e){var r=this.a,n=e.previousSibling,o=e.nextSibling;if(!uv(this,e))throw new D(this.Xe,0,e);if(this.b.Ga(e.a),n===r){var s=o;s!==r?(e=s.nextSibling,rv(this,e),e.ni(0),pv(e),tv(this,e)):rv(this,this.a)}else o===r?(s=n,e=s.previousSibling,lv(e,r),pv(e)):n&&o&&(vv(this,n.previousSibling,o.nextSibling),this.b.rd([o.a,n.a]),tv(this,n.previousSibling));s&&s!==r&&this.b.Ga(s.a)};function uv(e,r){for(var n=e.a.nextSibling,o=!1;n!==e.a;){if(n===r){o=!0;break}n=n.nextSibling}return o}function vv(e,r,n){r=new mv(r,n,e.Ca),e.b.fa(r.a)}function rv(e,r){e.a.nextSibling=r,r.previousSibling=e.a}p.$f=function(e){e=e.target;var r=e.previousSibling,n=e.nextSibling,o=e.ya();if(!n.Wc){nv(n,o,!1);var s=e}r.Wc||(nv(r,o,!0),s=r.previousSibling),tv(this,s)};function wv(e){e=e||{};var r,n=e.lineStyle;Ru.call(this),this.s=new gv({label:fv.btn,onStateChange:A(this.Nn,this)}),this.Ja(this.s),(r=e.distanceFormatter)&&(this.oj=r),n&&(this.Xj=n,this.sk=B),this.Vb(e.alignment||"right-bottom"),this.g={},this.g[0]=e.startIcon,this.g[2]=e.endIcon,this.g[1]=e.stopoverIcon,this.g[3]=e.splitIcon}u(wv,Ru),t("H.ui.DistanceMeasurement",wv),p=wv.prototype,p.Qh=ev.METRIC,p.Xj={strokeColor:"rgb(39,44,54)",lineWidth:5},p.sk={strokeColor:"white",lineWidth:7};function xv(e){var r=e.map,n,o={};e.c||(e.l=new N,e.m=new tl(e.l,{pixelRatio:e.map.Xa()}),e.u=n=e.l.bc(),e.u.Vk(!0),n.addEventListener("dragstart",e.Ln,!0,e),n.addEventListener("dragend",e.ef,!0,e),n.addEventListener("pointerenter",e.ef,!0,e),n.addEventListener("pointerleave",e.Mn,!0,e),n.addEventListener("tap",e.co,!0,e),e.i=yv(e),o.a=A(e.oj,e),o.b=A(e.dk,e),o.g=A(e.Dj,e),o.map=e.map,o.f=e.i,o.Wd=e.Xj,o.c=e.sk,e.b=new qv(e.u,o),e.c=!0),e.i&&e.u.fa(e.i),r.addEventListener("tap",e.pk,!0,e),r.a.add(e.m)}function zv(e){var r=e.map;e.c&&(r.removeEventListener("tap",e.pk,!0,e),r.ae(e.m),e.b.na())}function yv(e){function r(){var d=n.yb();return d={anchor:n.kd().clone().scale(l).floor(),size:new Wi(Bd(d.w*l),Bd(d.h*l)),hitArea:o},new Wj(n.Qc(),d)}var n=e.dk(3),o=new Xi(Yi.NONE,[]),s,l=n===e.D?.5:1;if(n.getState()===1)var h=r();else h=new Wj("<svg/>",{hitArea:o}),n.addEventListener("statechange",function(){n.getState()===1&&s.Ic(r())});return s=new Rn(e.map.bb(),{visibility:!1,icon:h})}p.oj=function(e){var r="m",n=0;return this.Qh==="metric"?1e3<=e&&(e/=1e3,r="km",n=1):(e/=.3048,r="ft",5280<=e&&(e/=5280,r="mi",n=1)),e.toFixed(n)+" "+this.pa().translate("scale."+r)},p.Dj=function(e,r,n){var o=this.map.Da(e);return r=this.map.Da(r),n=new J(n.x,n.y).Cj(o,r),this.map.Pa(n.x,n.y)||ng(e)},p.X=function(e,r){var n=22*(this.map.f.type===kk.P2D?this.map.Xa():1),o=n/2;Ru.prototype.renderInternal.call(this,e,r),this.Qh=ev.METRIC,this.D=new Wj(fv.point,{anchor:{x:o,y:o},size:{w:n,h:n},hitArea:new Xi(Yi.CIRCLE,[o,o,o])}),this.s.jc(this.pa().translate("distance.measurement"))},wv.prototype.renderInternal=wv.prototype.X,p=wv.prototype,p.dk=function(e){return this.g[e]||this.D},p.ef=function(){sv(this.b,!0)},p.Ln=function(){sv(this.b)},p.Mn=function(e){e.currentPointer.type!=="touch"&&sv(this.b)},p.co=function(e){var r=e.currentPointer,n=e.target.Fa,o;n&&(n=n.getData())instanceof kv&&(o=n),n=o,e=e.originalEvent,e=e.metaKey||e.altKey,n&&(e&&n instanceof ov?this.b.Xe(n):n instanceof mv&&(e=n.previousSibling.ya(),o=n.nextSibling.ya(),r={x:r.viewportX,y:r.viewportY},this.b.insertBefore(this.Dj(e,o,r),n.nextSibling),this.i.qb()),this.ef())},p.pk=function(e){var r=e.currentPointer;e=e.target,e!==this.map&&e.getProvider&&e.getProvider()===this.l||(this.b.ne(this.map.Pa(r.viewportX,r.viewportY)),this.i.qb(),this.ef())},p.Nn=function(e){e.target.getState()==="down"?xv(this):zv(this)},p.Qe=function(e){this.Qh=e,this.c&&(tv(this.b),this.ef())},wv.prototype.onUnitSystemChange=wv.prototype.Qe,wv.prototype.o=function(){zv(this),this.c&&(this.l.F(),this.m.F()),wv.j.o.call(this)},wv.prototype.Ia=function(e){e?this.s.getState()===Fu.DOWN&&(this.map=e,xv(this)):(zv(this),this.c=!1),Ru.prototype.Ia.apply(this,arguments)},wv.prototype.setMap=wv.prototype.Ia;function Av(){this.C=Bv.CLOSED,Qu.call(this,"div","H_overlay")}u(Av,Qu),t("H.ui.base.OverlayPanel",Av),Av.prototype.O=function(e,r){return(e!==this.C||r)&&(this.C=e,e===Bv.OPEN?this.Ka("H_open"):this.kb("H_open")),this},Av.prototype.setState=Av.prototype.O,Av.prototype.getState=function(){return this.C},Av.prototype.getState=Av.prototype.getState,Av.prototype.xk=function(e){var r=e.Mc;e=e.N();var n=this.N(),o=n.style;if(this.kb("H_top"),this.kb("H_middle"),this.kb("H_bottom"),this.kb("H_left"),this.kb("H_center"),this.kb("H_right"),o.bottom=o.top=o.left=o.right=o.margin="",/top/g.test(r)){this.Ka("H_top"),o.top="0",o.margin="0 12px";var s=-1}else/bottom/g.test(r)?(this.Ka("H_bottom"),o.bottom="0",o.margin="0 12px",s=1):(this.Ka("H_middle"),o.top="50%",o.margin="0 12px",o.marginTop=-Math.round(.5*n.offsetHeight)+"px",s=0);/left/g.test(r)?(this.Ka("H_left"),o.left=e.offsetWidth+"px",o.marginLeft="12px"):/right/g.test(r)?(this.Ka("H_right"),o.right=e.offsetWidth+"px",o.marginRight="12px"):(this.Ka("H_center"),o.left="50%",0>s?(o.top=e.offsetHeight+"px",o.marginTop="12px"):0<s&&(o.bottom=e.offsetHeight+"px",o.marginBottom="12px"),o.marginLeft=-Math.round(.5*n.offsetWidth)+"px",e.appendChild(n))},Av.prototype.pointToControl=Av.prototype.xk;var Bv={OPEN:"open",CLOSED:"closed"};Av.State=Bv;function Cv(e){e=e||{},Qu.call(this,"div","H_rdo"),this.g=new Y("div","H_rdo_title"),this.b=new Qu("div","H_rdo_buttons"),this.Ja(this.g),this.Ja(this.b),this.i=A(function(r){r.target.getState()===Fu.DOWN?(this.Kk(r.target,!0),this.dispatchEvent(Dv)):r.target.O(Fu.DOWN,!0)},this),this.addEventListener("statechange",this.i),this.Ci(e.title||""),e.onActiveButtonChange&&this.addEventListener(Dv,e.onActiveButtonChange),e.buttonsOptions&&e.buttonsOptions.forEach(function(r){this.Gg(new gv(r))},this)}u(Cv,Qu),t("H.ui.base.RadioGroup",Cv);var Dv="activebuttonchange";Cv.prototype.X=function(e,r){Qu.prototype.renderInternal.call(this,e,r),this.Ci(this.c,!0)},Cv.prototype.renderInternal=Cv.prototype.X,Cv.prototype.na=function(){this.b.na()},Cv.prototype.Ci=function(e,r){return(e!==this.c||r)&&(this.c=e,this.g.N()&&(this.g.N().innerHTML=this.c)),this},Cv.prototype.setTitle=Cv.prototype.Ci,Cv.prototype.an=function(){return this.c},Cv.prototype.getTitle=Cv.prototype.an,Cv.prototype.Gg=function(e){if(!(e instanceof gv))throw Error("PushButton expected");return e.ka(this),this.b.Ja(e),this},Cv.prototype.addButton=Cv.prototype.Gg,Cv.prototype.ko=function(e){return this.b.removeChild(e),e.ka(null),this},Cv.prototype.removeButton=Cv.prototype.ko,Cv.prototype.Df=function(){return this.b.dh()},Cv.prototype.getButtons=Cv.prototype.Df,Cv.prototype.Kk=function(e,r){for(var n=this.Df(),o=n.length;o--;)n[o].O(n[o]===e?Fu.DOWN:Fu.UP,r)},Cv.prototype.setActiveButton=Cv.prototype.Kk,Cv.prototype.o=function(){this.removeEventListener("statechange",this.i),this.na(),Qu.prototype.o.call(this)};function Ev(e){e=e||{},Ru.call(this),this.i=new Av,this.b=this.b.bind(this),this.s=this.s.bind(this),this.m=this.m.bind(this),this.Vb(e.alignment||"bottom-right"),Fv(this,e.baseLayers,e.layers)}u(Ev,Ru),t("H.ui.MapSettingsControl",Ev);function Gv(e,r){var n=[];return e.concat(r).forEach(function(o){n=n.concat(o.layer)}),n}function Hv(e,r,n){var o=e.Lb();if(o){e=Gv(e.c,e.g);var s=Gv(r,n);e.forEach(function(l){s.includes(l)||o.ae(l)})}}function Fv(e,r,n){Hv(e,r,n),e.D=NaN,e.c=Bc(r)?r:[],e.g=Bc(n)?n:[],e.l&&(e.l.na(),e.u.na(),Iv(e))}Ev.prototype.ta=function(){var e=this.Lb();e&&(e.addEventListener("tap",this.s),e=e.a,e.addEventListener("add",this.b),e.addEventListener("remove",this.b),e.addEventListener("set",this.b))},Ev.prototype.T=function(){var e=this.Lb();e&&(e.removeEventListener("tap",this.s),e=e.a,e.removeEventListener("add",this.b),e.removeEventListener("remove",this.b),e.removeEventListener("set",this.b))},Ev.prototype.X=function(e,r){var n=this.pa().translate("layers.choose");Ru.prototype.renderInternal.call(this,e,r),this.ta(),this.P=new gv({tooltip:n,label:'<svg xmlns="http://www.w3.org/2000/svg" class="H_icon" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M6.7,14.6 L4.5,16 L12,20.6 L19.5,16 L17.3,14.6 L19.1,13.5 L23,16 L12,23 L1,16 L4.9,13.5 L6.7,14.6 Z M12,2 L23,9 L12,16 L1,9 L12,2 Z"></path></svg>',onStateChange:A(function(o){o.target.getState()===Fu.DOWN?(this.i.O(Bv.OPEN),this.i.xk(this)):this.i.O(Bv.CLOSED)},this)}),Ev.prototype.wa=function(o){if(this.map.f.type===Qn){var s=H.map.render.harp.Style;o=[].concat(o);for(var l=0;!d&&l<o.length;l++){var h=o[l].ca();if(h.Sb()&&h.V){h=h.V();var d=h.getConfig()||h.getUrl()}}if(d){var y=function(g){g=g.ca(),g.Sb()&&g.V&&g.V()instanceof s&&g.gb(new s(d))};this.g.forEach(function(g){g=g.layer,Bc(g)?g.forEach(y):g&&y(g)})}}},this.l=new Cv({title:n,onActiveButtonChange:(function(){var o=this.D;t:{for(var s=this.l.Df(),l=s.length;l--;)if(s[l].getState()===Fu.DOWN){s=s[l];break t}s=null}if(s=s.getData(),s=this.c[s].layer,l=Bc(s),this.map.ud(l?s[0]:s),(o=this.c[o])&&(o=o.layer,Bc(o)))for(var h=o.length;1<h--;)this.map.ae(o[h]);if(l)for(o=s.length;1<o--;)this.map.nf(s[o],1);this.wa(s),this.m()}).bind(this)}),this.u=new Qu("div","H_grp"),this.ea=new Y("div","H_separator"),this.Ja(this.P),this.Ja(this.i),this.i.Ja(this.l),this.i.Ja(this.ea),this.i.Ja(this.u),Iv(this)},Ev.prototype.renderInternal=Ev.prototype.X;function Iv(e){var r=e.pa();e.c.forEach(function(n,o){var s=n.layer;this.l.Gg(new gv({label:Jv(r,n.label),data:o,disabled:!s||Bc(s)&&!s.length}))},e),e.g.forEach(function(n,o){var s=n.layer;this.u.Ja(new gv({label:Jv(r,n.label),onStateChange:this.sb.bind(this,n.layer),data:o,disabled:!s||Bc(s)&&!s.length}))},e),e.ea.qb(!(!e.g.length||!e.c.length)),x.setTimeout((function(){this.map&&(this.b(),this.P.va(!(this.c&&this.c.length||this.g&&this.g.length)))}).bind(e))}Ev.prototype.b=function(){var e=this.map.g,r=this.map.a;this.D=NaN,this.c.forEach(function(n,o){n=n.layer,n=e===(Bc(n)?n[0]:n),this.l.Df()[o].O(Fu[n?"DOWN":"UP"],!0),n&&(this.D=o)},this),this.g.forEach(function(n,o){n=n.layer;var s=Bc(n);o=this.u.dh()[o],!n||s&&!n.length?o.va(!0):o.O(Fu[r.indexOf(s?n[0]:n)!==-1?"DOWN":"UP"],!0)},this)},Ev.prototype.sb=function(e,r){e=Bc(e)?e:[e],r=r.target.getState()===Fu.DOWN;for(var n=0;n<e.length;n++)r?this.map.nf(e[n]):this.map.ae(e[n]);this.m()},Ev.prototype.m=function(){var e=Kv(this);e&&(e.Bg.ca().V().Oe(e.ca().V().qc()),this.map.ae(e),e.F(),delete e.Bg),Lv(this)&&Mv(this,this.map.g)};function Mv(e,r){var n=window.H.service&&window.H.service.omv.Provider,o=r.ca();if(n&&r.ca()instanceof n&&o.V().xe){var s=o.V(),l=(function(){var h=Nv.ground.filter(function(g){return!!s.kh("layers."+g)}),d=Nv.water.filter(function(g){return!!s.kh("layers."+g)});if(h.concat(d).length){var y={};$h(y,s.xe(h)),$h(y,s.xe(d,!1,!0)),delete y.global,h=new ti(y,s.Ib()),h=o.s().$b(h),h.Bg=r,this.map.nf(h)}s.removeEventListener(Zh.CHANGE,l)}).bind(e);s.getState()!==Xh.READY?s.addEventListener(Zh.CHANGE,l):l()}}function Kv(e){return iu(e.map.a.La(),function(r){return!!r.Bg})}function Lv(e){e=e.map.a.La();var r=window.H.service&&window.H.service.traffic.flow.Provider;return!!r&&e.some(function(n){return n.ca()instanceof r})}var Nv={water:["water.water-labels"],ground:"road_labels continent_label island_label roads.shields roads.directions truck-restriction.signs places landuse.label".split(" ")};function Jv(e,r){return/^layers?/.test(r)&&e.Nf(r)?e.translate(r):r}Ev.prototype.s=function(){this.P.O(Fu.UP)},Ev.prototype.o=function(){Ev.j.o.call(this),this.T()};var Ov=[];t("H.ui.i18n.defaultLocales",Ov);var Pv={},Qv=[];function Rv(e,r){Pv[e]=r,Ov.indexOf(e)===-1&&Ov.push(e),Qv.length?Sv(e,r):Qv=Object.keys(r)}function Sv(e,r){for(var n=Qv,o=n.length,s;o--;)if(s=n[o],!r[s])throw Error("'"+s+"' key missing in translation map for "+e)}function Tv(e){e=e||{},Ru.call(this),this.c=new gv({label:'<svg xmlns="http://www.w3.org/2000/svg" class="H_icon" viewBox="0 0 24 24"><g transform="translate(1 3)"><path fill-rule="nonzero" d="M5,0 L5,2 L2,2 L2,16 L5,16 L5,18 L2,18 C0.9,18 0,17 0,15.75 L0,2.25 C0,1 0.9,0 2,0 L5,0 Z M17,0 L20,0 C21.1,0 22,1 22,2.25 L22,15.75 C22,17 21.1,18 20,18 L17,18 L17,16 L20,16 L20,2 L17,2 L17,0 Z"></path><rect width="10" height="2" x="6" y="8"></rect><rect width="2" height="10" x="10" y="4"></rect></g></svg>',onStateChange:A(this.On,this)}),this.Ja(this.c),this.Vb(e.alignment||"right-bottom")}u(Tv,Ru),t("H.ui.ZoomRectangle",Tv),p=Tv.prototype,p.On=function(e){var r=this.map,n=r.b.element;e.target.getState()===Fu.DOWN?(r.addEventListener("dragstart",this.fk,!0,this),r.addEventListener("drag",this.gk,!0,this),r.addEventListener("dragend",this.ek,!0,this),e=n.ownerDocument.createElement("div"),e.className="H_zoom_lasso",n.appendChild(e),this.b=e):(r.removeEventListener("dragstart",this.fk,!0,this),r.removeEventListener("drag",this.gk,!0,this),r.removeEventListener("dragend",this.ek,!0,this),n.removeChild(this.b))},p.fk=function(e){var r=this.b.style,n=e.currentPointer,o=n.viewportX;n=n.viewportY,e.target===this.map&&(e.stopPropagation(),r.width="0px",r.height="0px",r.top=n+"px",r.left=o+"px",r.display="block",this.i=n,this.g=o)},p.gk=function(e){var r=e.currentPointer,n=r.viewportX,o=r.viewportY;r=this.g;var s=this.i,l=this.b.style;e.target===this.map&&(e.stopPropagation(),e=n-r,n=o-s,l.left=r+(0>e?e:0)+"px",l.top=s+(0>n?n:0)+"px",l.width=Math.abs(e)+"px",l.height=Math.abs(n)+"px")},p.ek=function(e){var r=this.map,n=e.currentPointer;e.target===this.map&&(e.stopPropagation(),this.b.style.display="none",r.c.Wb({bounds:tg([r.Pa(this.g,this.i),r.Pa(n.viewportX,n.viewportY)])},!0))},p.X=function(e,r){Ru.prototype.renderInternal.call(this,e,r),this.c.jc(this.pa().translate("zoom.rectangle"))},Tv.prototype.renderInternal=Tv.prototype.X,Rv("nl-NL",{"layers.normal":"Kaartweergave","layers.satellite":"Satelliet","layers.terrain":"Terrein","layer.transit":"Openbaar vervoer","layer.traffic":"Verkeerssituatie","layer.incidents":"Toon verkeersincidenten","layers.choose":"Weergave kiezen",minimap:"Minimap","scale.switchToImperial":"Overgaan naar mijlen","scale.switchToMetric":"Wijzigen naar km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Uitzoomen","zoom.in":"Inzoomen","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Openbaar vervoer","traffic.MISCELLANEOUS":"Diversen","traffic.ACCIDENT":"Ongeval","traffic.OTHER_NEWS":"Meer informatie","traffic.OTHER":"Meer informatie","traffic.PLANNED_EVENT":"Geplande afzetting","traffic.ROAD_HAZARD":"Gevaar op de weg","traffic.ROAD_CLOSURE":"Rijbaan afgesloten","traffic.WEATHER":"Weer","traffic.CONGESTION":"Verkeersopstopping","traffic.CONSTRUCTION":"Wegwerkzaamheden","traffic.DISABLED_VEHICLE":"Voertuig met pech","traffic.LANE_RESTRICTION":"Rijstrookbeperking","traffic.from":"Begintijd:","traffic.until":"Geschatte eindtijd:","distance.measurement":"Measure distance"}),Rv("pt-PT",{"layers.normal":"Vista do mapa","layers.satellite":"Satélite","layers.terrain":"Terreno","layer.transit":"Transportes públicos","layer.traffic":"Condições de trânsito","layer.incidents":"Mostrar incidentes de trânsito","layers.choose":"Escolher vista",minimap:"Minimap","scale.switchToImperial":"Mudar para milhas","scale.switchToMetric":"Mudar para km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Diminuir","zoom.in":"Aumentar","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transportes públicos","traffic.MISCELLANEOUS":"Diversos","traffic.ACCIDENT":"Acidente","traffic.OTHER_NEWS":"Outras notícias","traffic.OTHER":"Outras notícias","traffic.PLANNED_EVENT":"Evento planeado","traffic.ROAD_HAZARD":"Perigo na estrada","traffic.ROAD_CLOSURE":"Estrada fechada","traffic.WEATHER":"Meteorologia","traffic.CONGESTION":"Congestionamento","traffic.CONSTRUCTION":"Construção","traffic.DISABLED_VEHICLE":"Veículo avariado","traffic.LANE_RESTRICTION":"Limitação da faixa de rodagem","traffic.from":"Hora de início:","traffic.until":"Hora de fim prevista:","distance.measurement":"Measure distance"}),Rv("ru-RU",{"layers.normal":"Режим карты","layers.satellite":"Спутниковая","layers.terrain":"Местность","layer.transit":"Общественный транспорт","layer.traffic":"Дорожные условия","layer.incidents":"Показать дорожные события","layers.choose":"Выберите вид",minimap:"Minimap","scale.switchToImperial":"Использовать мили","scale.switchToMetric":"Использовать километры","scale.km":"км","scale.m":"м","scale.mi":"миль","scale.ft":"фут","zoom.out":"Отдалить","zoom.in":"Приблизить","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Общественный транспорт","traffic.MISCELLANEOUS":"Прочее ДТП","traffic.ACCIDENT":"ДТП","traffic.OTHER_NEWS":"Другие новости","traffic.OTHER":"Другие новости","traffic.PLANNED_EVENT":"Плановое мероприятие","traffic.ROAD_HAZARD":"Дорожная опасность","traffic.ROAD_CLOSURE":"Дорога закрыта","traffic.WEATHER":"Погода","traffic.CONGESTION":"Пробка","traffic.CONSTRUCTION":"Ремонт","traffic.DISABLED_VEHICLE":"Неисправный автомобиль","traffic.LANE_RESTRICTION":"Ограничение полосы движения","traffic.from":"Время начала:","traffic.until":"Ожидаемое время окончания:","distance.measurement":"Измерить расстояние"}),Rv("fi-FI",{"layers.normal":"Karttanäkymä","layers.satellite":"Satelliitti","layers.terrain":"Maasto","layer.transit":"Julkinen liikenne","layer.traffic":"Liikenneolosuhteet","layer.incidents":"Näytä liikennetapahtumat","layers.choose":"Valitse näkymä",minimap:"Minimap","scale.switchToImperial":"Vaihda maileihin","scale.switchToMetric":"Vaihda kilometreihin","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Loitonna","zoom.in":"Lähennä","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Julkinen liikenne","traffic.MISCELLANEOUS":"Erittelemätön syy","traffic.ACCIDENT":"Onnettomuus","traffic.OTHER_NEWS":"Muu tapahtuma","traffic.OTHER":"Muu tapahtuma","traffic.PLANNED_EVENT":"Suunniteltu tapahtuma","traffic.ROAD_HAZARD":"Vaara tiellä","traffic.ROAD_CLOSURE":"Tie suljettu","traffic.WEATHER":"Sää","traffic.CONGESTION":"Ruuhka","traffic.CONSTRUCTION":"Rakennustyö","traffic.DISABLED_VEHICLE":"Pysähtynyt ajoneuvo","traffic.LANE_RESTRICTION":"Kaista rajoitus","traffic.from":"Alkamisaika:","traffic.until":"Arvioitu päättymisaika:","distance.measurement":"Measure distance"}),Rv("pt-BR",{"layers.normal":"Exibição do mapa","layers.satellite":"Satélite","layers.terrain":"Terreno","layer.transit":"Transporte público","layer.traffic":"Condições do trânsito","layer.incidents":"Mostrar incidentes no trânsito","layers.choose":"Escolher exibição",minimap:"Minimap","scale.switchToImperial":"Mudar para milhas","scale.switchToMetric":"Mudar para km","scale.km":"km","scale.m":"m","scale.mi":"milhas","scale.ft":"pés","zoom.out":"Menos zoom","zoom.in":"Mais zoom","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transporte público","traffic.MISCELLANEOUS":"Miscelânea","traffic.ACCIDENT":"Acidente","traffic.OTHER_NEWS":"Outras notícias","traffic.OTHER":"Outras notícias","traffic.PLANNED_EVENT":"Evento planejado","traffic.ROAD_HAZARD":"Risco na estrada","traffic.ROAD_CLOSURE":"Estrada fechada","traffic.WEATHER":"Clima","traffic.CONGESTION":"Congestionamento","traffic.CONSTRUCTION":"Construção","traffic.DISABLED_VEHICLE":"Veículo incapacitado","traffic.LANE_RESTRICTION":"Restrição de pista","traffic.from":"Hora de início:","traffic.until":"Tempo final estimado:","distance.measurement":"Measure distance"}),Rv("zh-CN",{"layers.normal":"地图视图","layers.satellite":"卫星","layers.terrain":"地形","layer.transit":"公共交通","layer.traffic":"交通情况","layer.incidents":"显示交通事件","layers.choose":"选择视图",minimap:"Minimap","scale.switchToImperial":"切换为「英里」","scale.switchToMetric":"切换为「公里」","scale.km":"公里","scale.m":"米","scale.mi":"英里","scale.ft":"英尺","zoom.out":"缩小","zoom.in":"放大","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"公共交通","traffic.MISCELLANEOUS":"综合事件","traffic.ACCIDENT":"交通意外","traffic.OTHER_NEWS":"其他新闻","traffic.OTHER":"其他新闻","traffic.PLANNED_EVENT":"预定事件","traffic.ROAD_HAZARD":"道路危险","traffic.ROAD_CLOSURE":"道路已关闭","traffic.WEATHER":"天气","traffic.CONGESTION":"堵塞","traffic.CONSTRUCTION":"施工","traffic.DISABLED_VEHICLE":"车辆抛锚","traffic.LANE_RESTRICTION":"车道限制","traffic.from":"开始时间：","traffic.until":"预计结束时间：","distance.measurement":"Measure distance"}),Rv("es-ES",{"layers.normal":"Mapa","layers.satellite":"Satélite","layers.terrain":"Terreno","layer.transit":"Transporte público","layer.traffic":"Estado del tráfico","layer.incidents":"Mostrar incidentes de tráfico","layers.choose":"Elija una vista",minimap:"Minimap","scale.switchToImperial":"Cambiar a millas","scale.switchToMetric":"Cambiar a km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Alejar","zoom.in":"Acercar","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transporte público","traffic.MISCELLANEOUS":"Varios","traffic.ACCIDENT":"Accidente","traffic.OTHER_NEWS":"Más noticias","traffic.OTHER":"Más noticias","traffic.PLANNED_EVENT":"Acto programado","traffic.ROAD_HAZARD":"Riesgo en carretera","traffic.ROAD_CLOSURE":"Carretera cerrada","traffic.WEATHER":"Tiempo","traffic.CONGESTION":"Atasco","traffic.CONSTRUCTION":"Construcción","traffic.DISABLED_VEHICLE":"Vehículo averiado","traffic.LANE_RESTRICTION":"Restricción de carril","traffic.from":"Inicio:","traffic.until":"Finalización estimada:","distance.measurement":"Measure distance"}),Rv("fr-FR",{"layers.normal":"Carte","layers.satellite":"Satellite","layers.terrain":"Terrain","layer.transit":"Transports publics","layer.traffic":"Conditions de circulation","layer.incidents":"Afficher les incidents de circulation","layers.choose":"Choisir la vue",minimap:"Minimap","scale.switchToImperial":"Passer en miles","scale.switchToMetric":"Passer en km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Zoom arrière","zoom.in":"Zoom avant","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transports publics","traffic.MISCELLANEOUS":"Divers","traffic.ACCIDENT":"Accident","traffic.OTHER_NEWS":"Autre","traffic.OTHER":"Autre","traffic.PLANNED_EVENT":"Événement prévu","traffic.ROAD_HAZARD":"Danger routier","traffic.ROAD_CLOSURE":"Chaussée fermée","traffic.WEATHER":"Météo","traffic.CONGESTION":"Embouteillage","traffic.CONSTRUCTION":"Travaux","traffic.DISABLED_VEHICLE":"Véhicule en panne","traffic.LANE_RESTRICTION":"Restriction de voie","traffic.from":"Date ou heure de début:","traffic.until":"Date et heure de fin estimées:","distance.measurement":"Measure distance"}),Rv("pl-PL",{"layers.normal":"Widok mapy","layers.satellite":"Satelita","layers.terrain":"Teren","layer.transit":"Transport publiczny","layer.traffic":"Warunki drogowe","layer.incidents":"Pokaż zdarzenia drogowe","layers.choose":"Wybierz widok",minimap:"Minimap","scale.switchToImperial":"Zmień na mile","scale.switchToMetric":"Zmień na km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Oddal","zoom.in":"Przybliż","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transport publiczny","traffic.MISCELLANEOUS":"Inne zdarzenie","traffic.ACCIDENT":"Wypadek","traffic.OTHER_NEWS":"Inne wiadomości","traffic.OTHER":"Inne wiadomości","traffic.PLANNED_EVENT":"Zdarzenie planowane","traffic.ROAD_HAZARD":"Niebezpieczeństwo na drodze","traffic.ROAD_CLOSURE":"Jezdnia zamknięta","traffic.WEATHER":"Pogoda","traffic.CONGESTION":"Korek","traffic.CONSTRUCTION":"Budowa","traffic.DISABLED_VEHICLE":"Uszkodzony pojazd","traffic.LANE_RESTRICTION":"Ograniczenie pasa ruchu","traffic.from":"Data rozpoczęcia:","traffic.until":"Przybliżona data zakończenia:","distance.measurement":"Measure distance"}),Rv("de-DE",{"layers.normal":"Kartenansicht","layers.satellite":"Satellit","layers.terrain":"Gelände","layer.transit":"Öffentliche Verkehrsmittel","layer.traffic":"Verkehrslage","layer.incidents":"Verkehrsstörungen anzeigen","layers.choose":"Ansicht auswählen",minimap:"Minimap","scale.switchToImperial":"Umrechnung in Meilen","scale.switchToMetric":"Umrechnung in Kilometer","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Verkleinern","zoom.in":"Vergrößern","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Öffentliche Verkehrsmittel","traffic.MISCELLANEOUS":"Diverse","traffic.ACCIDENT":"Unfall","traffic.OTHER_NEWS":"Anderes Ereignis","traffic.OTHER":"Anderes Ereignis","traffic.PLANNED_EVENT":"Geplantes Ereignis","traffic.ROAD_HAZARD":"Verkehrshindernis","traffic.ROAD_CLOSURE":"Fahrbahn gesperrt","traffic.WEATHER":"Wetter","traffic.CONGESTION":"Verkehrsstau","traffic.CONSTRUCTION":"Baustelle","traffic.DISABLED_VEHICLE":"Liegengebliebenes Fahrzeug","traffic.LANE_RESTRICTION":"Fahrstreifensperrung","traffic.from":"Beginn:","traffic.until":"Voraussichtliches Ende:","distance.measurement":"Measure distance"}),Rv("tr-TR",{"layers.normal":"Harita görünümü","layers.satellite":"Uydu","layers.terrain":"Arazi","layer.transit":"Toplu ulaşım","layer.traffic":"Trafik durumları","layer.incidents":"Trafik olaylarını göster","layers.choose":"Görünüm seç",minimap:"Minimap","scale.switchToImperial":"Mile dönüştür","scale.switchToMetric":"Kilometreye dönüştür","scale.km":"km","scale.m":"m","scale.mi":"mil","scale.ft":"ft","zoom.out":"Uzaklaştır","zoom.in":"Yakınlaştır","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Toplu ulaşım","traffic.MISCELLANEOUS":"Çeşitli","traffic.ACCIDENT":"Kaza","traffic.OTHER_NEWS":"Diğer haberler","traffic.OTHER":"Diğer haberler","traffic.PLANNED_EVENT":"Planlı etkinlik","traffic.ROAD_HAZARD":"Yol tehlikesi","traffic.ROAD_CLOSURE":"Yol kapalı","traffic.WEATHER":"Hava durumu","traffic.CONGESTION":"Yoğunluk","traffic.CONSTRUCTION":"Yol çalışması","traffic.DISABLED_VEHICLE":"Araç arızası","traffic.LANE_RESTRICTION":"Şerit kısıtlaması","traffic.from":"Başlangıç zamanı:","traffic.until":"Tahmini bitiş zamanı:","distance.measurement":"Measure distance"}),Rv("it-IT",{"layers.normal":"Vista mappa","layers.satellite":"Satellite","layers.terrain":"Terreno","layer.transit":"Mezzi pubblici","layer.traffic":"Condizioni del traffico","layer.incidents":"Mostra incidenti stradali","layers.choose":"Scegli vista",minimap:"Minimap","scale.switchToImperial":"Passa a miglia","scale.switchToMetric":"Passa a km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Zoom indietro","zoom.in":"Zoom avanti","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Mezzi pubblici","traffic.MISCELLANEOUS":"Varie","traffic.ACCIDENT":"Incidente","traffic.OTHER_NEWS":"Altre notizie","traffic.OTHER":"Altre notizie","traffic.PLANNED_EVENT":"Evento pianificato","traffic.ROAD_HAZARD":"Strada dissestata","traffic.ROAD_CLOSURE":"Strada chiusa","traffic.WEATHER":"Maltempo","traffic.CONGESTION":"Ingorgo","traffic.CONSTRUCTION":"Lavori in corso","traffic.DISABLED_VEHICLE":"Veicolo in panne","traffic.LANE_RESTRICTION":"Restrizione di corsia","traffic.from":"Ora di inizio:","traffic.until":"Ora di fine stimata:","distance.measurement":"Measure distance"}),Rv("en-US",{"layers.normal":"Map view","layers.satellite":"Satellite","layers.terrain":"Terrain","layer.transit":"Public transport","layer.traffic":"Traffic conditions","layer.incidents":"Show traffic incidents","layers.choose":"Choose view",minimap:"Minimap","scale.switchToImperial":"Change to miles","scale.switchToMetric":"Change to km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Zoom out","zoom.in":"Zoom in","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Public transport","traffic.MISCELLANEOUS":"Miscellaneous","traffic.ACCIDENT":"Accident","traffic.OTHER_NEWS":"Other news","traffic.OTHER":"Other news","traffic.PLANNED_EVENT":"Planned event","traffic.ROAD_HAZARD":"Road hazard","traffic.ROAD_CLOSURE":"Roadway closed","traffic.WEATHER":"Weather","traffic.CONGESTION":"Congestion","traffic.CONSTRUCTION":"Construction","traffic.DISABLED_VEHICLE":"Disabled vehicle","traffic.LANE_RESTRICTION":"Lane restriction","traffic.from":"Start time:","traffic.until":"Estimated end time:","distance.measurement":"Measure distance"});function Uv(e,r){if(!Cc(e))throw new TypeError("string locale code required");if(Ea(r))Sv(e,r);else{if(Ov.indexOf(e)===-1)throw Error("Default locale '"+e+"' does nto exist.");r=Pv[e]}this.b=r||{},this.a=e}t("H.ui.i18n.Localization",Uv),Uv.prototype.zm=function(){return this.a},Uv.prototype.getLocale=Uv.prototype.zm,Uv.prototype.sm=function(){return Object.keys(this.b)},Uv.prototype.getKeys=Uv.prototype.sm,Uv.prototype.Nf=function(e){return!(!this.b||!this.b[e])},Uv.prototype.hasKey=Uv.prototype.Nf,Uv.prototype.translate=function(e){var r=this.b[e];if(!Cc(r))throw Error("Translation missing for key '"+e+"'.");return r},Uv.prototype.translate=Uv.prototype.translate;function Vv(e){e=e||{},Ru.call(this),this.Ka("H_scalebar"),this.Vb(e.alignment||"right-bottom"),this.m=150,this.update=A(this.update,this),this.i=this.g=this.b=this.c=null}u(Vv,Ru),t("H.ui.ScaleBar",Vv),Vv.prototype.X=function(e,r){Ru.prototype.renderInternal.call(this,e,r),e.innerHTML='<svg height="12" version="1.1" xmlns="http://www.w3.org/2000/svg"><polyline style="fill:none; stroke:white; stroke-width:4" points="2,2 2,10 98,10 98,2"/><polyline style="fill:none; stroke:black; stroke-width:2" points="2,2 2,10 98,10 98,2"/></svg><div style="padding: 0 0 0 10px"></div>',e.style.direction="ltr",this.c=e.firstChild,r=this.c.childNodes,this.b=r[0],this.g=r[1],this.i=e.lastChild,this.l=ev.METRIC,this.s=A(function(n){this.dc()||(this.dispatchEvent("toggleunitsystem"),n.preventDefault())},this),this.u=A(function(n){n.preventDefault()},this),Bu(e,"start",this.u),Bu(e,"end",this.s),this.jc(this.pa().translate("scale.switchToImperial")),this.update()},Vv.prototype.renderInternal=Vv.prototype.X,Vv.prototype.Ia=function(e){this.map&&this.map.removeEventListener("mapviewchange",this.update),e&&e.addEventListener("mapviewchange",this.update),Ru.prototype.Ia.apply(this,arguments)},Vv.prototype.setMap=Vv.prototype.Ia,Vv.prototype.capture=function(e,r,n){var o=this.N(),s=o.ownerDocument,l=s.createElement("canvas"),h=l.getContext("2d"),d=s.createElementNS("http://www.w3.org/2000/svg","svg"),y=s.createElementNS("http://www.w3.org/2000/svg","foreignObject"),g=lf(o,s,!1);s=parseFloat(o.offsetWidth)+1;var v=parseFloat(o.offsetHeight),m=s*e;e*=v,l.width=m,l.height=e,d.setAttribute("xmlns","http://www.w3.org/2000/svg"),d.setAttribute("width",m),d.setAttribute("height",e),d.setAttribute("viewBox","0 0 "+s+" "+v),y.setAttribute("width","100%"),y.setAttribute("height","100%"),d.appendChild(y),g.setAttribute("width","100%"),g.setAttribute("height","100%"),g.setAttribute("xmlns","http://www.w3.org/1999/xhtml");var w=window.getComputedStyle(o);"box-shadow display align-items font font-family font-size height text-shadow direction".split(" ").forEach(function(I){g.style.setProperty(I,w.getPropertyValue(I))}),y.appendChild(g),o=bf(d.outerHTML),new tf("image",o).then(function(I){h.drawImage(I,0,0),r(l)},n)},Vv.prototype.capture=Vv.prototype.capture,Vv.prototype.Qe=function(e){this.l=e,this.jc(e==="imperial"?this.pa().translate("scale.switchToMetric"):this.pa().translate("scale.switchToImperial")),this.update()},Vv.prototype.onUnitSystemChange=Vv.prototype.Qe,Vv.prototype.update=function(){var e;if(this.N()){this.c=this.c,this.b=this.b;var r=this.m,n=0,o=this.map;if(o){var s=Math.round(.5*o.b.width),l=Math.round(.5*o.b.height);(e=o.Pa(s,l))&&(o=o.Pa(s+1,l))&&(n=100*e.Wa(o))}n&&(this.l===ev.IMPERIAL?1609.344>n?(o=n/.3048006,e=this.pa().translate("scale.ft")):(o=n/1609.344,e=this.pa().translate("scale.mi")):1e3>n?(o=n,e=this.pa().translate("scale.m")):(o=n/1e3,e=this.pa().translate("scale.km")),n=Math.pow(10,Math.floor(Math.log(o)/Math.LN10)),o=n/o*100,o<r/5?(n*=5,o*=5):o<r/2?(n*=2,o*=2):o>r&&(n/=2,o/=2),o=Math.round(o),this.c.setAttribute("width",o),this.i.textContent=n+" "+e,this.b.points.getItem(2).x=this.g.points.getItem(2).x=this.b.points.getItem(3).x=this.g.points.getItem(3).x=o-2)}};function Wv(e){C(e,Re,Wv,1),Y.call(this,"div","H_context_menu_item"),this.b=e,this.c=A(this.c,this),this.a=A(this.a,this),this.b.addEventListener("update",this.a)}u(Wv,Y),t("H.ui.context.Item",Wv),Wv.prototype.c=function(e){var r=this.b,n=r.callback;n&&!r.isDisabled()&&(this.dispatchEvent("click"),n(e))},Wv.prototype.X=function(){var e=this,r=this.N();Ee(r,"click",this.c),r.addEventListener("keyup",function(n){n.keyCode==13&&e.c(n)}),this.a()},Wv.prototype.renderInternal=Wv.prototype.X,Wv.prototype.a=function(){var e=this.N(),r=this.b;r.callback?(this.Ka("clickable"),e.setAttribute("tabindex","0")):(this.kb("clickable"),e.removeAttribute("tabindex")),r.isDisabled()?this.Ka("disabled"):this.kb("disabled"),r=r.getLabel(),su.textContent=r,e.innerHTML=su.innerHTML.split(`
`).join("<br/>")},Wv.prototype.o=function(){Y.prototype.o.call(this),this.b.removeEventListener("update",this.a)};function Xv(e){C(e,Array,Xv,1),Qu.call(this,"div","H_context_menu"),this.c=e,this.b=null}u(Xv,Qu),t("H.ui.context.Menu",Xv),Xv.prototype.X=function(){Qu.prototype.X.apply(this,arguments),this.c.forEach(function(e){e===Se?e=new Y("div","H_context_menu_item_separator"):(e=new Wv(e),e.addEventListener("click",this.g.bind(this))),this.Ja(e)},this),Ee(this.N(),["mousedown","touchstart","pointerdown","wheel"],function(e){e.stopPropagation()})},Xv.prototype.renderInternal=Xv.prototype.X,Xv.prototype.setPosition=function(e,r){if(this.b){var n=this.N(),o=n.offsetWidth,s=n.offsetHeight,l=this.b,h=l.b.width;l=l.b.height,e+o>h&&e>h/2&&(e-=o),r+s>l&&r>l/2&&(r-=s),lu(n,e,r)}},Xv.prototype.setPosition=Xv.prototype.setPosition,Xv.prototype.g=function(){this.b&&this.b.dispatchEvent(new ud("contextmenuclose",this.b))},Xv.prototype.Ia=function(e){this.b=e},Xv.prototype.setMap=Xv.prototype.Ia;function Yv(e,r){r=r||{};var n=this;Y.call(this,"div","H_ib H_ib_top"),this.u=A(function(o){n.dc()||(n.close(),o.preventDefault())},this),this.update=A(this.update,this),this.i=A(this.i,this),this.setPosition(e),this.$e(r.content),r.onStateChange&&this.addEventListener("statechange",r.onStateChange),this.O(Zv.OPEN)}u(Yv,Y),t("H.ui.InfoBubble",Yv),Yv.prototype.a=null,Yv.prototype.ya=function(){return this.m},Yv.prototype.setPosition=function(e){this.m=ng(e),this.update()},Yv.prototype.setPosition=Yv.prototype.setPosition,Yv.prototype.Ia=function(e){this.a=e},Yv.prototype.X=function(e,r){this.l=yu(r,"div","H_ib_body"),this.tailEl_=yu(r,"div","H_ib_tail"),this.c=yu(r,"div","H_ib_close H_btn",'<svg version="1.1" class="H_icon" viewBox="0 0 12 12"><path d="m8.12 6 3.66-3.66c.29-.29.29-.76 0-1.05l-1.06-1.06c-.29-.29-.76-.29-1.05 0l-3.66 3.66-3.66-3.66c-.29-.29-.76-.29-1.05 0l-1.06 1.06c-.29.29-.3.76 0 1.05l3.66 3.66-3.66 3.66c-.29.29-.29.76 0 1.05l1.06 1.06c.29.29.76.29 1.05 0l3.66-3.66 3.66 3.66c.29.29.76.29 1.05 0l1.06-1.06c.29-.29.3-.76 0-1.05z"></path></svg>'),this.b=yu(r,"div","H_ib_content","&nbsp;"),this.l.appendChild(this.c),this.l.appendChild(this.b),Bu(this.c,"start",this.u),this.a.c.addEventListener("sync",this.update),this.a.b.addEventListener("sync",this.update),e.appendChild(this.l),e.appendChild(this.tailEl_),this.$e(this.g)},Yv.prototype.renderInternal=Yv.prototype.X,Yv.prototype.i=function(){this.s||(this.s=setTimeout(this.update,0))},Yv.prototype.update=function(){var e=this.N(),r=this.a,n,o="none";if(this.s=0,r&&e&&this.getState()===Zv.OPEN){if(n=r.Da(this.m)){var s=n.x;n=n.y,r=r.b.width,(s>=-r||s<=2*r||n>=-r||n<=2*r)&&(o="",mu?(e.style.left=s-r+"px",e.style.top=n+"px"):lu(e,s,n))}e.style.display=o,o===""&&(e.style.visibility="visible")}};var Zv={OPEN:"open",CLOSED:"closed"};Yv.State=Zv,Yv.prototype.C=Zv.OPEN,Yv.prototype.getState=function(){return this.C},Yv.prototype.getState=Yv.prototype.getState,Yv.prototype.O=function(e){e!==this.C&&(this.C=e,this.dispatchEvent("statechange")),(e=this.N())&&(this.C===Zv.OPEN?(e.style.display="block",e.style.visibility="hidden",this.i()):e.style.display="none")},Yv.prototype.setState=Yv.prototype.O,Yv.prototype.close=function(){this.O(Zv.CLOSED)},Yv.prototype.close=Yv.prototype.close,Yv.prototype.open=function(){this.O(Zv.OPEN)},Yv.prototype.open=Yv.prototype.open,Yv.prototype.Ul=function(){return this.b||null},Yv.prototype.getContentElement=Yv.prototype.Ul,Yv.prototype.$e=function(e){if(e)if(typeof e=="string"||typeof e.nodeType=="number"&&typeof e.nodeName=="string")this.g=e;else throw Error("InfoBubble content must be a string or HTML node.");else this.g="";this.N()&&(this.g?(this.b.innerHTML="",typeof this.g=="string"?this.b.innerHTML=e:typeof e.nodeType=="number"&&typeof e.nodeName=="string"&&this.b.appendChild(e)):this.b.innerHTML="&nbsp;",this.i())},Yv.prototype.setContent=Yv.prototype.$e,Yv.prototype.o=function(){this.close(),this.$e(""),this.c&&Cu(this.c,"end",this.u),this.a&&(this.a.c.removeEventListener("sync",this.update),this.a.b.removeEventListener("sync",this.update)),Y.prototype.o.call(this)};function $v(e,r){this.b=e,this.a=null,this.f=0,this.c=22,this.i=r,this.Xf=A(this.Xf,this),this.Sg=A(this.Sg,this),e=this.b.Lb(),e.addEventListener("mapviewchange",this.bo,!1,this),this.g=e.f.type,e=e.a,e.addEventListener("add",this.Sn,!1,this),e.addEventListener("remove",this.Tn,!1,this)}function aw(e,r,n){var o=r.ca();o&&(n!==void 0&&n)&&o.removeEventListener("tap",e.Xf),r?(o.addEventListener("tap",e.Xf),e.f=o.min,e.c=o.max):(e.f=0,e.c=22)}p=$v.prototype,p.bo=function(e){var r=e.newValue.zoom;this.a&&e.modifiers&e.ZOOM&&(r<this.f||r>this.c)&&this.a.close()},p.Sn=function(e){e=e.added,bw(e)&&aw(this,e)},p.Tn=function(e){e=e.removed,bw(e)&&(this.a&&this.a.close(),aw(this,e,!0))};function bw(e){return window.H.service&&(e.ca()instanceof window.H.service.traffic.incidents.Provider||e.ca()instanceof window.H.service.trafficVectorTile.Provider&&e.ca().s().b==="incident")}p.Xf=function(e){var r,n=this.g===kk.HARP;e.target&&(r=e.target.getData())&&e.currentPointer.button===0&&(n?(r=this.b.Lb().Pa(e.currentPointer.viewportX,e.currentPointer.viewportY),(n=e.target.getData()?e.target.getData().properties.id:null)&&this.i.requestIncidentById(n,{locationReferencing:"none",lang:this.b.pa().a},this.hl.bind(this,r),console.error)):(n=e.target.ga(),this.hl(n,r)),e.stopPropagation())},p.hl=function(e,r){if(this.g===kk.HARP){r=r.incidentDetails;var n=this.b.pa().a,o=r.type,s=o.split(/(?=[A-Z])/).join("_").toUpperCase();this.b.pa().Nf("traffic."+s)&&(o=this.b.pa().translate("traffic."+s)),e={position:e,title:o,description:r.description.value,startTime:new Date(r.startTime).toLocaleString(n).split(",").join(" "),endTime:new Date(r.endTime).toLocaleString(n).split(",").join(" ")}}else n=r.TRAFFIC_ITEM_TYPE_DESC.replace(" ","_"),this.b.pa().Nf("traffic."+n)?n=this.b.pa().translate("traffic."+n):n=r.TRAFFIC_ITEM_DESCRIPTION[r.TRAFFIC_ITEM_DESCRIPTION.length-1].value,e={position:e,title:n,description:r.TRAFFIC_ITEM_DESCRIPTION[0].value,startTime:r.START_TIME,endTime:r.END_TIME};this.Sg(e)},p.Sg=function(e){var r=e.position,n=e.title,o=e.description,s=e.startTime;e=e.endTime,this.a||(this.a=new Yv(r),this.a.Ka("H_tib"),this.b.Yi(this.a)),this.a.setPosition(r),this.a.$e('<div class="H_tib_content"><div class="H_rdo_title" dir="auto">{{title}}</div><div class="H_tib_desc" dir="auto"><span>{{desc}}</span><div class="H_tib_time"><span class="H_tib_left">{{traffic.from}}</span><span class="H_tib_right">{{from}}</span><br/><span class="H_tib_left">{{traffic.until}}</span><span class="H_tib_right">{{until}}</span></div></div>'.replace("{{title}}",n).replace("{{desc}}",o).replace("{{traffic.from}}",this.b.pa().translate("traffic.from")).replace("{{traffic.until}}",this.b.pa().translate("traffic.until")).replace("{{from}}",s).replace("{{until}}",e)),this.a.open()};function cw(e,r){try{return e.Qf=!0,new e(r)}finally{e.Qf=!1}}function dw(e,r){var n=e.N(),o=this;F.call(this),this.c=e,this.i=n.ownerDocument,this.f={},this.b=[],this.S=yu(this.i,"div","H_ui"),this.setDirection(),this.P=A(function(s){this.m.put(s.target,s.target.Mc)},this),this.addEventListener("alignmentchange",this.P),this.L=A(function(){this.fl()},this),this.addEventListener("toggleunitsystem",this.L),this.S.addEventListener("contextmenu",this.J,!1),this.S.addEventListener("MSHoldVisual",this.J,!1),this.c.addEventListener("contextmenu",this.D,!1,this),this.c.addEventListener("contextmenuclose",this.u,!1,this),this.c.tb(this.F.bind(this)),this.a=null,this.s=-1,this.m=new Uu(this.S,this.i),this.g=ev.METRIC,ew(this,"en-US"),r&&fw(this,r),n.appendChild(this.S),x.setTimeout(function(){o.m.update()},1)}u(dw,F),t("H.ui.UI",dw),dw.prototype.J=function(e){for(var r=e.target;r&&!/\bH_ib_content\b/.test(r.className);)r=r.parentNode;r||e.preventDefault()},dw.prototype.N=function(){return this.S},dw.prototype.getElement=dw.prototype.N,dw.prototype.Lb=function(){return this.c},dw.prototype.getMap=dw.prototype.Lb,dw.prototype.dn=function(){return this.g},dw.prototype.getUnitSystem=dw.prototype.dn,dw.prototype.vg=function(e){var r=this.f,n;if(e!==this.g)for(n in this.g=e,r)r[n]instanceof Ru&&r[n].onUnitSystemChange(this.g)},dw.prototype.setUnitSystem=dw.prototype.vg,dw.prototype.setDirection=function(e){this.S.setAttribute("dir",e||getComputedStyle(this.Lb().N()).direction)},dw.prototype.setDirection=dw.prototype.setDirection;function ew(e,r){if(Cc(r))var n=r;else if(r instanceof Uv){n=r.a;var o=r}else throw Error("The locale parameter must be a string or a H.ui.i18n.Localization object.");if(n)if(o)e.l=o;else if(0<=Ov.indexOf(n))e.l=new Uv(n);else throw Error("Locale ["+n+"] is not supported.");else throw Error("No locale was defined.")}dw.prototype.pa=function(){return this.l},dw.prototype.fl=function(){this.g===ev.METRIC?this.vg(ev.IMPERIAL):this.vg(ev.METRIC)},dw.prototype.toggleUnitSystem=dw.prototype.fl,dw.prototype.Yi=function(e){var r=this.b.length,n=this.S;if(0>this.b.indexOf(e)){e.ka(this),e.Ia(this.c);var o=e.W(this.i);r=0<r?this.b[r-1].N().nextSibling:this.S.firstChild,n.insertBefore(o,r),this.b.push(e)}},dw.prototype.addBubble=dw.prototype.Yi,dw.prototype.D=function(e){var r=e.items;this.a&&this.u(),clearTimeout(this.s),this.s=x.setTimeout((function(){r.length&&(this.a=new Xv(r),this.S.insertBefore(this.a.W(this.i),this.S.firstChild),this.a.ka(this),this.a.Ia(this.c),this.a.setPosition(e.viewportX,e.viewportY))}).bind(this),0)},dw.prototype.u=function(){this.a&&(this.a.F(),this.a=null)},dw.prototype.jo=function(e){var r=this.b.indexOf(e);-1<r&&(e.ka(null),e.Ia(null),this.b.splice(r,1),this.S.removeChild(e.N()))},dw.prototype.removeBubble=dw.prototype.jo,dw.prototype.Ql=function(){return this.b},dw.prototype.getBubbles=dw.prototype.Ql,dw.prototype.Bd=function(e,r){if(this.Ce(e))throw Error("A control with name ["+e+"] is already registered.");r.ka(this),r.Ia(this.c),r.xa=this.l,r.W(this.i),r.onUnitSystemChange(this.g),this.f[e]=r},dw.prototype.addControl=dw.prototype.Bd,dw.prototype.lo=function(e){var r=this.Ce(e);if(r)r.T(),r.ka(null),r.Ia(null),Du(r),delete this.f[e];else throw Error("Control ["+e+"] not found in this UI's controls.");return r},dw.prototype.removeControl=dw.prototype.lo,dw.prototype.Ce=function(e){return this.f[e]},dw.prototype.getControl=dw.prototype.Ce,dw.prototype.o=function(){for(var e in this.f)ju.hasOwnProperty.call(this.f,e)&&this.f[e].F();this.b.forEach(function(r){r.F()}),(e=this.S.parentNode)&&e.removeChild(this.S),F.prototype.o.call(this),delete this.S};function fw(e,r){var n,o;r.unitSystem&&e.vg(r.unitSystem),(o=r.locale)&&ew(e,o),(n=r.zoom)&&e.Bd("zoom",new Su(Ea(n)?n:null)),(n=r.zoomrectangle)&&e.Bd("zoomrectangle",new Tv(Ea(n)?n:null)),(n=r.mapsettings)&&e.Bd("mapsettings",new Ev(Ea(n)?n:null)),(n=r.scalebar)&&e.Bd("scalebar",new Vv(Ea(n)?n:null)),(n=r.distancemeasurement)&&e.Bd("distancemeasurement",new wv(Ea(n)?n:null))}dw.prototype.capture=function(e,r,n,o){var s=this.Ce("scalebar"),l=e.getContext("2d"),h=e.width,d=e.height,y=this.c.s,g=5+(y?y.N().childNodes[1].offsetHeight:0);s&&s.wc()?s.capture(r,function(v){l.drawImage(v,h-v.width-5*r,d-v.height-g*r),n(e)},o):n(e)},dw.prototype.capture=dw.prototype.capture,dw.createDefault=function(e,r,n){var o=e.f.type;if(n=new dw(e,{unitSystem:ev.METRIC,zoom:{alignment:"right-bottom"},mapsettings:gw(o,r,e.g),scalebar:{alignment:"bottom-right"},locale:n||"en-US"}),o===kk.P2D){var s=n.Ce("mapsettings"),l=function(){if(s.Lb()){var g=gw(o,r,e.g);Fv(s,g.baseLayers,g.layers)}};e.addEventListener(e.A.lf,l),n.tb(function(){e.removeEventListener(e.A.lf,l)}),s.tb(function(){e.removeEventListener(e.A.lf,l)})}if(o===kk.HARP){if(window.H.service){var h=r.vector.traffic.map.ca().s().v(),d=new window.H.service.Url(h.i,h.c.split(".").slice(-2).join("."));d=cw(window.H.service.traffic.Service7,{platformBaseUrl:d});var y=d.v().getQuery();y.apikey=h.getQuery().apikey,d.v().bf(y),new $v(n,d)}}else new $v(n);return n},dw.prototype.Bo=function(){},dw.prototype.setTrafficIncidentsHandle=dw.prototype.Bo;function hw(e,r,n,o){for(var s=e,l=0;s&&l<r.length;l++)s=s[r[l]];if(s&&s!==e)return e={label:n,layer:s},o.push(e),e}function gw(e,r,n){var o=[],s=[],l=r.raster;if(e===kk.P2D&&l){if(hw(r,["raster","normal","map"],"layers.normal",o),hw(r,["raster","satellite","map"],"layers.satellite",o),hw(r,["raster","terrain","map"],"layers.terrain",o),n){for(var h in l)if(l[h]&&l[h].map===n){var d=h;break}}hw(r,["raster","normal","trafficincidents"],"layer.incidents",s),hw(r,["raster",d,"transit"],"layer.transit",s)}else hw(r,["vector","normal","map"],"layers.normal",o),e===kk.WEBGL?(hw(r,["raster","satellite","map"],"layers.satellite",o),hw(r,["vector","normal","traffic"],"layer.traffic",s),hw(r,["vector","normal","trafficincidents"],"layer.incidents",s)):(n=hw(r,["hybrid","day","vector"],"",[]),l=hw(r,["hybrid","day","raster"],"layers.satellite",o),l.layer=[l.layer,n.layer],window.H.service&&(n=r.vector.traffic.map.ca().s().v(),r=cw(window.H.service.trafficVectorTile.Service,{baseUrl:n,layer:"flow"}),n=cw(window.H.service.trafficVectorTile.Service,{baseUrl:n,layer:"incident"}),d=Ao()+"/harp/oslo/normal.day.json",l=new H.map.render.harp.Style(d),d=new H.map.render.harp.Style(d),r=r.createLayer(l,{engineType:e}),e=n.createLayer(d,{engineType:e}),s.push({label:"layer.traffic",layer:r},{label:"layer.incidents",layer:e})));return{alignment:"bottom-right",baseLayers:o,layers:s}}function iw(e,r){if(r=r||{},!(e&&e instanceof sl))throw Error("Base layer is mandatory for overview UI element");Ru.call(this),this.c=new gv({label:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="H_icon"><g fill-rule="evenodd" transform="translate(2 2)"><rect width="9" height="9" x="10" y="10"/><rect class="H_icon_stroke" width="18" height="18" x="1" y="1" fill="none" stroke="#000" stroke-width="2" rx="2"/></g></svg>',onStateChange:A(this.g,this)}),this.Ja(this.c),this.b=new jw(e,r.zoomDelta,r.scaleX,r.scaleY),this.Vb(r.alignment||"right-bottom"),this.Ja(this.b)}u(iw,Ru),t("H.ui.Overview",iw),iw.prototype.ud=function(e){return this.b.ud(e),this},iw.prototype.setBaseLayer=iw.prototype.ud,iw.prototype.g=function(e){e.target.getState()===Fu.DOWN?(e=this.b,kw(e,!0),e.Fi(),e.Ka("H_overview_active"),e.b.addEventListener("mapviewchange",e.Fi,!1,e)):lw(this.b)},iw.prototype.X=function(e,r){Ru.prototype.renderInternal.call(this,e,r),this.c.N().style.float=this.Mc.match("right")?"right":"left",this.b.Ia(this.map),this.c.jc(this.pa().translate("minimap"))},iw.prototype.renderInternal=iw.prototype.X,iw.prototype.o=function(){this.b.F(),Y.prototype.o.call(this)};function jw(e,r,n,o){this.l=e,typeof r=="number"&&(this.jl=r),typeof n=="number"&&(this.tk=n),typeof o=="number"&&(this.uk=o),Qu.call(this,"div","H_overview")}u(jw,Ru),jw.prototype.ud=function(e){this.c.ud(e)},jw.prototype.X=function(e,r){r=yu(r,"div","H_overview_map"),zu(e,r),this.g=r},jw.prototype.renderInternal=jw.prototype.X,jw.prototype.renderInternal=jw.prototype.X,p=jw.prototype,p.jl=3,p.tk=5,p.uk=5,p.Ia=function(e){this.b=e,this.c=new U(this.g,this.l,{pixelRatio:this.b.Xa(),engineType:this.b.f.type}),this.c.s.N().style.display="none",this.s=this.c.c,this.i=this.b.c};function lw(e){!e.zd&&kw(e),e.kb("H_overview_active"),e.b.removeEventListener("mapviewchange",e.Fi,!1,e)}p.Fi=function(e){e&&e.modifiers&e.SIZE&&kw(this,!0),e=this.i.jb(),e.zoom-=this.jl,this.s.Wb(e)};function kw(e,r){var n=e.b.b.element,o=e.N().style,s=n.offsetWidth/e.tk/10;n=n.offsetHeight/e.uk/10;var l=e.g.style;r?(o.width=s+"em",o.height=n+"em",l.width=s+"em",l.height=n+"em"):o.width=o.height="0em",e.c.b.resize()}p.o=function(){jw.j.o.call(this),lw(this),this.c.F(),this.c=this.s=this.i=this.b=this.l=this.g=null},t("H.ui.buildInfo",function(){return Hf("H-ui","1.48.1","2d0df27",{region:"row"})});function mw(e,r){if(!e)throw new D(mw,0,e);mw.j.constructor.call(this,e),this.b={},this.c=!(!r||!r.oc),this.f=nw++}u(mw,Cm);var nw=0;mw.prototype.W=function(e,r,n,o,s,l){var h=Ad(o),d=this.eb,y=h+(n.exp-d.pixelProjection.exp),g=d.min,v=d.max;o=d.tileSize;var m=d.ca().g,w=this.lb,I=w.Tc(),V=w.yb().w,q=n.w,De=n.x,_n=n.y,ha={};if(h<g||h>v)return wk.DONE;for(s=d.requestTiles(e,y,s,l,this.f),e=s.total,s=s.tiles,l=s.length,this.g=n,this.l=r,this.a=y,I!==m&&w.ic(m),n=o=o*q/(Gd(2,y)*o),this.c||(o%1&&(o=Bd(o),q=n/o,De/=q,_n/=q,q=Gd(2,y)*o),De=Bd(De),_n=Bd(_n)),this.i=n,y=-o,h=V+o,d=0;d<l;d++){if(V=s[d],(g=V.data)&&g.tagName){for(n=r.x-(De-V.x*o),m=r.y-(_n-V.y*o),w.Oc(g,n,m,o,o),I=n;(I-=q)>y;)w.Oc(g,I,m,o,o);for(I=n;(I+=q)<h;)w.Oc(g,I,m,o,o)}ha[this.a+"_"+V.x+"_"+V.y]=V}return this.b=ha,l===e?wk.DONE:wk.PENDING},mw.prototype.Ea=function(e,r,n){var o=this.i,s=o/this.eb.tileSize,l=this.g,h=this.l,d;if(vc(this.a)&&l){e=l.x+(e-h.x),r=l.y+(r-h.y);var y=Bd(l.w/o),g=l=Bd(e/o);h=Bd(r/o),Dd(g)>=y&&(g%=y),0>g&&(g=y+g),(y=this.b[this.a+"_"+g+"_"+h])&&y.Ea&&(d=y.Ea((e-o*l)/s,(r-o*h)/s,n))}return d||hf},mw.prototype.Rd=function(){return"2d"};function ow(e,r){r=r||{},C(e,tl,ow,0),ow.j.constructor.call(this,e),this.oc=!!r.oc,this.c=r.fb||0,this.a=[],this.b={}}u(ow,Cm),ow.prototype.W=function(e,r,n,o,s,l){var h,d=this.eb,y;o-=this.c,this.a.length=0;var g=this.b;if(this.b=h={},o>=d.min&&o<=d.max){var v=d.sd(e,o,s,l),m=v.overlays;if(e=m.length)for(m.sort(ph),o=this.lb,s=this.oc,l=0;l<e;l++){d=m[l];var w=d.K(),I=n.ib(w.Nb()),V=n.ib(w.Jb());w=n.w,I.x>=V.x&&(I.x-=w),w=-((I.x+V.x)/w>>1)*w,I.x+=w,I.add(r),V.x+=w,V.add(r),s||(I.round(),V.round()),(w=g[y=d.cb()])?delete g[y]:w={ho:d},h[y]=w;var q=I.x;I=I.y;var De=V.x;V=V.y;var _n=De-q,ha=V-I;o.ic(d.Tc()),o.Oc(d.Qc(),q,I,_n,ha),w.Vg?w.Vg.set(q,I,De,V):w.Vg=new yk(q,I,De,V),this.a.push(w)}}return!v||v.requested&&v.requested===v.total||!v.requested&&m.length===v.total?wk.DONE:wk.PENDING},ow.prototype.Ea=function(e,r,n){for(var o=this.a,s=o.length,l,h,d;s--;)if(l=o[s],h=l.Vg,h.vf(e,r)){if(l=l.ho,d)d.push(l);else if(d=[l],n)break}return d||hf},ow.prototype.Rd=function(){return"2d"},ow.prototype.o=function(){delete this.a,ow.j.o.call(this)},ow.prototype.disposeInternal=ow.prototype.o;var pw={lookAt:{zoom:{min:-8,max:24},tilt:{min:0,max:0},incline:{min:0,max:0},heading:{min:180,max:180}},interaction:{ZOOM:Nl.ZOOM,COORD:Nl.COORD},capture:!0};t("H.map.render.p2d.capabilities",pw);function qw(e,r){this.a=[],qw.j.constructor.apply(this,arguments)}u(qw,Gm),p=qw.prototype,p.rj=function(){return this.eb.Ec.apply(this.eb,arguments)},p.W=function(e,r,n,o,s,l,h){return this.a=[],qw.j.W.apply(this,arguments)},p.$j=1,p.Ek=function(e,r,n,o,s,l){var h=this.$j=o.Xa();s*=h,l*=h;var d=n.yb();r=d.w*h,d=d.h*h;var y=n.kd();this.oc?(s-=y.x*h,l-=y.y*h):(s=Ad(s-y.x*h),l=Ad(l-y.y*h)),o.Oc(n.Qc(),s,l,r,d),e.detail?e.detail.set(s,l,s+r,l+d):e.detail=new yk(s,l,s+r,l+d),this.a.push(e)},p.Ea=function(e,r,n){for(var o=this.a,s=o.length,l,h,d,y=hf,g=this.$j;s--&&(l=o[s],h=l.detail,!(h.vf(e,r)&&(l=l.ik,(!(d=l.xb().c)||d.Of((e-h.left)/g,(r-h.top)/g,0))&&0>y.indexOf(l)&&(y===hf&&(y=[]),y.push(l),n)))););return y},p.Rd=function(){return"2d"},p.o=function(){this.a=[],qw.j.o.call(this)},qw.prototype.disposeInternal=qw.prototype.o;function Z(e,r,n,o){Z.j.constructor.call(this,e,r,n,o),this.L=new J(0,0),(n=o.renderBaseBackground)&&(this.Xn=n.lower,this.Hn=n.higher),this.yn=!!o.enableSubpixelRendering,this.fd=rw,this.Af=0,this.Ed=this.ve=!1,this.g=new om,this.a=o=new wm,this.dd=A(this.dd,this),o.addEventListener(o.A.Cg,this.dd),this.Da=A(this.Da,this),o=e.element,this.aa=e=o.ownerDocument.createElement("div"),e.style.position="absolute",e.style.width=e.style.height="100%",e.style.zIndex=0,o.insertBefore(e,o.firstChild),this.sj=new Tm(this.aa,this.oa),this.m=[],sw(this),this.Jh=A(Z.prototype.Jh,this),this.C=tw,this.ng(),this.zoom=uw(this,this.J.pb()+this.fb),this.Eb(),vw(this,r.jb().position,this.zoom),this.$a(),this.T()}u(Z,Jl),t("H.map.render.p2d.RenderEngine",Z),Z.prototype.type=Tl.P2D;var tw=2;Z.prototype.getState=function(){return this.C},Z.prototype.getState=Z.prototype.getState;function ww(e,r,n){return r=n-r,Dd(r)<e.b.w/2?r:r-e.b.w*n/Dd(n)}Z.prototype.Kg=function(e){var r=this,n=e.b,o=e.newValue,s=e.modifiers;e=o.position;var l=o.bounds,h,d=this.zoom,y=this.s,g=0;if(s&ej.POSITION&&(h=r.b.ib(e)),s&ej.BOUNDS)o=xw(this,l.K(),s&ej.ZOOM?o.zoom:B,s&ej.POSITION?e:B),this.J.Wb(o,n);else{s&ej.POSITION||(h=r.b.ib(o.position));var v=h.x,m=h.y;yw(this),this.L.set(0,0),o=zw(this,o);var w=o.zoom,I=o.position;if(n){var V=w-d,q={x:y.x,y:y.y};n=this.b.Zd(q).x;var De=this.b.projection.Pc(e);(De.x!==this.s.x||De.y!==this.s.y||w!==this.zoom)&&(v=ww(this,n,v),Aw(this,function(_n){var ha=_n-g;if(w!==d){h=r.b.Zd(De);var ga=r.b.Zd(q);v=ww(r,ga.x,h.x),m=h.y-ga.y}g=_n,Bw(r,v*ha,m*ha),d+=V*ha,Cw(r,d),r.$a(),r.ha()},this.qa,function(){vw(r,I,w),Cw(r,w),r.$a(I),r.ha()},this.xa))}else Dw(this),vw(this,I,w),Cw(this,w),this.$a(I);this.ha()}},Z.prototype.qa=300,Z.prototype.rg=function(e){var r=Fc(e);if(!r||r&&0>e)throw new D(this.rg,1,"positive number required");this.qa=e},Z.prototype.setAnimationDuration=Z.prototype.rg,Z.prototype.$g=function(){return this.qa},Z.prototype.getAnimationDuration=Z.prototype.$g,Z.prototype.xa=em,Z.prototype.sg=function(e){if(!Da(e))throw new D(this.sg,1,"function required");this.xa=e},Z.prototype.setAnimationEase=Z.prototype.sg,Z.prototype.ah=function(){return this.xa},Z.prototype.getAnimationEase=Z.prototype.ah,Z.prototype.ng=function(){this.xa=em,this.qa=300},Z.prototype.resetAnimationDefaults=Z.prototype.ng,Z.prototype.Xh=function(e,r,n){var o;this.Nj=Lk(),(o=this.R.ja.splice(e,1)[0])&&o.F&&o.F(),(o=this.u.ja.splice(e,1)[0])&&o.F&&o.F(),(o=this.ta.ja.splice(e,1)[0])&&o.F&&o.F(),(o=this.ea.ja.splice(e,1)[0])&&o.F&&o.F(),this.ab=this.c.La(),e===0&&(Ol(this,r,!1),this.Eb()),this.m=Um(this.sj,Ew(this),Fw(this)),this.ce(),n||this.ha()};function sw(e){var r=e.c.La(),n=0,o=r.length;for([e.R={},e.u={},e.ta={},e.ea={}].forEach(function(s){s.Nc=[],s.ja=[]}),e.ab=e.c.La();n<o;n++)e.Pe(n,r[n]);e.Eb()}Z.prototype.Yh=function(){this.Eb(),this.ha()},Z.prototype.th=function(e,r,n){var o,s,l,h;if(r){var d={oc:this.yn,fb:this.fb};r.W?C(r,Em)?s=new Dm(r):C(r,Qm)&&(h=new Dm(r)):(r.requestOverlays&&(o=new ow(r,d)),r.requestTiles&&(s=new mw(r,d)),r.requestMarkers&&(l=new qw(r,d)),r.requestDomMarkers&&(h=new Jm(r,d)))}n=n||0,this.R.ja.splice(e,n,o),this.u.ja.splice(e,n,s),this.ta.ja.splice(e,n,l),this.ea.ja.splice(e,n,h),this.ab=this.c.La(),this.m=Um(this.sj,Ew(this),Fw(this))};function Fw(e){var r=[];return r=r.concat(e.u.ja),r=r.concat(e.R.ja),r=r.concat(e.ta.ja),r=r.concat(e.ea.ja),r=r.filter(vc)}function zw(e,r){var n=Pl(e,Pl(e,r.zoom)+e.fb);return e=Ql(e,r),e.zoom=n,e}function vw(e,r,n){var o=e.b;o.Oa(n),e.s=o.projection.Pc(r),o.x=o.w*e.s.x,o.y=o.h*e.s.y}Z.prototype.Pa=function(e,r){var n=this.f.center,o=this.oa;return this.b.Ra((e-n.x)*o,(r-n.y)*o)},Z.prototype.screenToGeo=Z.prototype.Pa,Z.prototype.qg=function(e,r){return e=this.Pa(e,r),r=this.J.jb(),r.position=e,r},Z.prototype.Da=function(e){var r=this.oa,n=this.f.center,o=n.x*r;n=n.y*r,e=this.b.ib(e);var s=this.b.w;return new J(Ad((e.x-Ad(e.x/s)*s+o)/r),Ad((e.y+n)/r))},Z.prototype.geoToScreen=Z.prototype.Da,Z.prototype.K=function(e,r){var n=this.wa[e||4];e=this.b;var o=n.left-r,s=e.Ra(o,n.top-r),l=n.right+r;return r=e.Ra(l,n.bottom+r),l-o>=e.w&&(s.lng=-(r.lng=180)),sg(s,r)},Z.prototype.Ea=function(e,r,n,o){var s=[],l=this.oa,h;for(e*=l,r*=l,l=[this.R,this.u,this.ta,this.ea],h=l.length;h--&&(!n||!s.length);){for(var d=s,y=l[h].ja,g=e,v=r,m=n,w=y.length;w--&&!((s=y[w])&&s.Ea&&(d=d.concat(s.Ea(g,v,m)),d.length&&m)););s=d}o(s)},Z.prototype.getObjectsAt=Z.prototype.Ea,Z.prototype.sb=z;function Ew(e){return e=e.wa[2],{w:e.right-e.left,h:e.bottom-e.top}}Z.prototype.T=function(){var e=this.m.length,r;Z.j.T.call(this);var n=Ew(this);this.L.set(0,0);var o=n.w;for(r=n.h;e--;){n=this.m[e];var s=n.yb();s.w===o&&s.h===r||n.cf(o,r)}this.sb=new Wi(o,r),this.ha()},Z.prototype.getCapabilities=function(){return pw},Z.prototype.getCapabilities=Z.prototype.getCapabilities;function Gw(e){e.i&&e.i.sa()||Lk()-e.Nj<e.fd&&!e.Ad?e.Yn=Jk(e.Jh):(e.Ad&&(e.ce(),Hw(e)),e.C=tw)}p=Z.prototype,p.ce=function(){this.R.Nc.length=0,this.u.Nc.length=0,this.ta.Nc.length=0,this.ea.Nc.length=0},p.Jh=function(){var e;this.D&&this.D.before();var r=this.u.ja,n=this.f.center.clone().scale(this.oa).round(),o=this.K(1,0),s=this.K(1,Iw),l=this.zoom,h=l-this.fb,d=this.b,y=this.Xn,g=this.Hn,v=r[0];r=this.L;var m=this.m.length,w=this.ab;for(e=w.length;m--;){var I=this.m[m];C(I,Bm)&&I.clear()}if(v){if(y)for(;y;)m=l-y,v.W(o,n,d,m,!0,r),--y;if(g&&this.Ed)for(I=1;I<=g&&(m=l+I,d.Oa(m),y=this.K(2,0),d.Oa(l),!v.W(y,n,d,m,!0,r));I++);}for(this.fd=rw;e--;)d=w[e],C(d,qj)&&d.ca()&&d.ca().Ue(s,h);o=this.Zj(o,n,l,!1,r,Jw,this.u,this.R),n=this.Zj(s,n,h,!1,r,Kw,this.ta,this.ea),this.Ad=o&&n,this.i&&this.i.sa()&&this.me(),this.P||(this.P=this.J.jb()),this.P.bounds=this.K(4,0),this.J.$a(this.P),this.P=null,this.sb&&(this.f.$a(this.sb),this.sb=z),l<this.Af?this.Ed=!0:this.ve&&(this.Ed=!1),this.Af=l,this.ve=o,this.D&&this.D.after(),Gw(this)},p.Zj=function(e,r,n,o,s,l,h){var d=Array.prototype.slice.call(arguments,6),y=d.length,g=d[0].ja.length,v=y*g,m=!!v,w;for(w=0;w<v;w++){if(l===Jw)var I=w%y,V=Math.floor(w/y);else I=Math.floor(w/g),V=w%g;var q=d[I].ja[V];I=d[I].Nc,q&&(q=q.W(e,r,this.b,n,o,s,this.Da),q===wk.ACTIVE&&(this.fd=1/0),q!==wk.DONE||I[V]||(Hw(this,this.ab[V]),I[V]=!0),I[V]||(m=!1))}return m};function Hw(e,r){e.dispatchEvent({type:e.A.Vi,target:r||e})}p.o=function(){var e=this.c.La()[0],r=this.f;Kk(this.Yn),Dw(this,!0),e&&Ol(this,e,!1),Fw(this).forEach(function(n){n.F()}),r.element&&r.element.removeChild(this.aa),this.aa=null,this.C=3,Z.j.o.call(this)},p.ha=function(){this.Nj=Lk(),this.C===tw&&(this.Ad=!1,this.C=1,Gw(this))};function Lw(e,r,n){Bw(e,r*e.oa,n*e.oa),e.L.set(0,0),e.$a(),e.ha()}function Bw(e,r,n){var o=e.b;e=e.s,o.x=Zd(o.x+r,o.w),o.y=zd(0,yd(o.w,o.y+n)),e.x=o.x/o.w,e.y=o.y/o.h}p.xd=function(e,r,n){e=Pl(this,Pl(this,e)+this.fb),Cw(this,e,r,n)},Z.prototype.zoomAt=Z.prototype.xd;function Cw(e,r,n,o){var s=e.oa,l=e.f.center;n===+n&&o===+o?(n=(n-l.x)*s,o=(o-l.y)*s,e.L.set(n,o),Bw(e,n,o),e.b.Oa(r),Bw(e,-n,-o)):(e.L.set(0,0),e.b.Oa(r)),e.zoom=r,e.$a(),e.ha()}function xw(e,r,n,o){var s=e.getCapabilities().lookAt.zoom.max,l=r.bb(),h=o||l;if(r.Rf()||n&&o)n=n===B?s:n;else{var d=new nj(e.b.projection);d.Oa(s);var y=d.ib(r.Nb()).round(),g=d.ib(r.Jb()).round();s=d.w,r.Bb()&&(y.x-=s),o?(l=d.ib(h),r=2*zd(l.x-y.x,g.x-l.x),y=2*zd(l.y-y.y,g.y-l.y)):(r=g.x-y.x,y=g.y-y.y,h=l),n===B&&(l=e.wa[4],n=l.right-l.left,l=l.bottom-l.top,n=-8+yd(Ed(n/r*s)/Od,Ed(l/y*s)/Od)-e.fb,n=Pl(e,n))}return{zoom:Bd(n),position:h}}function yw(e){Dw(e,!0),e.a.sa()&&e.vb(!0),e.g.sa()&&e.wb(!0),Dw(e,!0)}Z.prototype.lc=function(e,r){yw(this),Mw(this,r),this.g.start(e,!!r)},Z.prototype.startInteraction=Z.prototype.lc;function Mw(e,r){if(r){var n={};n.Te=r.power,n.we=r.ease,n.duration=r.duration,e.l=n}}function uw(e,r){return Pl(e,Pl(e,r-e.fb)+e.fb)}Z.prototype.cc=function(e,r,n,o,s){var l=!1;this.g.sa()&&(r=this.g.store(e,r,n,o,s),this.g.Ac(Nl.COORD)&&(e=this.g.Nd(),0<nm(e)&&(Lw(this,-e.x,-e.y),l=!0)),r&&this.g.Ac(Nl.ZOOM)&&(e=this.g.Bf(),r=this.g.Cf(),r=Ed(Gd(2,this.zoom)*r)/Od,r!==this.zoom&&(r=uw(this,r),Cw(this,r,e.x,e.y),l=!0)),l&&this.ha())},Z.prototype.interaction=Z.prototype.cc,Z.prototype.wb=function(e){var r=this;if(this.g.sa()&&!e){if(this.l){e=this.g.zb();var n=this.g.rc(),o=this.l.duration,s=(this.l.Te||1)*e,l=new Rm(-s/(0<o?o:1),s);!E(n.x)&&!E(n.y)&&0<s&&r.g.Ac(Nl.COORD)&&Aw(this,function(h){s=l.De(h*o),E(s)||Lw(r,Ad(-n.x*s),Ad(-n.y*s))},o,void 0,this.l.we)}this.l=null,this.g.clear()}},Z.prototype.endInteraction=Z.prototype.wb,Z.prototype.kc=function(e,r,n){yw(this),this.a.start(r,n),Mw(this,e)},Z.prototype.startControl=Z.prototype.kc,Z.prototype.control=function(e,r,n){if(E(+n))throw new D(this.control,2,n);if(E(e))throw new D(this.control,0,e);if(E(r))throw new D(this.control,1,r);this.a.sa()&&this.a.set(e,r,n,0,0,0)},Z.prototype.control=Z.prototype.control,Z.prototype.vb=function(e,r){var n=this,o;if(this.a.sa()){Dw(this,!0);var s=Lk(),l=s-this.Lj;if(1<=l){var h=zm(this.a);Nw(this,h,l)}if(!this.l||e||r)typeof r=="function"&&(e=this.jb(),e.zoom=this.zoom-this.fb,r(e),e.zoom+=this.fb,Ow(this,e));else{r=this.a.zb();var d=this.a.rc(),y=this.l.duration,g=(this.l.Te||1)*r,v=new Rm(-g/(0<y?y:1),g);!E(d.a)&&!E(d.b)&&0<g&&Aw(this,function(m,w,I,V){s&&(I=V-s,s=0),g=v.De(m*y)*I,E(g)||((o=d.c*g)&&Cw(n,uw(n,n.zoom+o),n.a.a,n.a.b),Lw(n,Ad(d.a*g),Ad(d.b*g)))},y,void 0,this.l.we)}this.a.reset()}},Z.prototype.endControl=Z.prototype.vb;function Ow(e,r){var n=e.s,o=e.b.projection.Pc(r.position),s=e.b.Zd(o),l=s.y;s=s.x;var h=r.zoom;n=e.b.Zd(n),r=n.y;var d=n.x;n=e.zoom;var y=e.a.zb(),g=e.a.a,v=e.a.b,m=0;if(s=ww(e,d,s),s-=d,l-=r,n=h-n,r=Fd(s*s+l*l+n*n),y!==0&&r!==0){var w=s/r,I=l/r,V=n/r,q=y*y/(2*r);Aw(e,function(De,_n){var ha;De!==1?(De=y*_n-q*_n*_n/2,_n=De-m,(ha=V*_n)&&(ha=uw(e,e.zoom+ha),Cw(e,uw(e,ha),g,v)),Lw(e,Ad(w*_n),Ad(I*_n)),m=De):(e.s=o,Cw(e,uw(e,h),g,v),e.$a(),e.ha())},2*r/y)}}Z.prototype.dd=function(e){var r=this,n=e.b;this.L.set(0,0),n.a||n.b||n.c?(this.Lj=Lk(),Aw(this,function(o,s,l,h){r.Lj=h,Nw(r,n,l)},Number.POSITIVE_INFINITY),this.ha()):Dw(this,!0)};function Nw(e,r,n){n=n||0,r.c&&Cw(e,uw(e,e.zoom+r.c*n),e.a.atX,e.a.atY),Lw(e,r.a*n,r.b*n)}function Aw(e,r,n,o,s){e.i&&e.i.sa()&&e.i.stop(!0),e.i=new Fm(e,r,n,o,s),e.i.start()}function Dw(e,r){e.i&&e.i.sa()&&e.i.stop(r)}Z.prototype.Wg=function(){},Z.prototype.enter=Z.prototype.Wg,Z.prototype.Xg=function(e){Ml(this.aa,e)},Z.prototype.exit=Z.prototype.Xg,Z.prototype.capture=function(e,r,n,o){var s=this.aa.ownerDocument.createElement("canvas"),l=s.getContext("2d"),h=this.oa;for(s.width=(n-e)*h,s.height=(o-r)*h,n=0;n<this.m.length;n++)o=this.m[n],C(o,Bm)&&l.drawImage(o.N(),-e*h,-r*h);return Zb(s)};var Kw=0,Jw=1,rw=1e3,Iw=256;function Pw(e){var r;if(e)for(Qw={},r=e.length;r--;)Qw[e[r]]=!0;this.Yk={}}var Rw,Qw={};Pw.prototype.parse=function(e,r,n){var o,s,l,h,d;Rw=!1;try{n=JSON.parse(n)}catch{Rw=!0}if(n&&(o=n.metadata)){var y={spatials:[]};for(s in o)if((n=!Qw[s]&&(l=Sw[s]))&&((h=o[s])||(Rw=!0,h=void 0),n=h),n)for(n=h.length;n--;){var g;(g=h[n])||(Rw=!0,g=void 0),(d=g)&&l(r,e,this,s,d,y)}}else Rw=!0;return Rw?void 0:y},Pw.prototype.parse=Pw.prototype.parse;var Sw={"street labels":function(e,r,n,o,s,l){var h;if((h=s.vertices)||(Rw=!0,h=void 0),h){var d,y=h.length,g;if((g=0<y)||(Rw=!0,g=void 0),g)for(d=Array(y/2);y;){var v=h[--y];g=h[--y],d[y/2]=new J(g,v)}d=d?{a:[d]}:B,y=+s["font size"]/e.Xa(),h=n.Yk[y],h||(Tw.lineWidth=y,h=n.Yk[y]=n.Fd.vj(Tw)),Uw(e,r,d,!1,h,s,o,l)}delete s.vertices},"city center labels":function(e,r,n,o,s,l){Uw(e,r,Vw(s,new Ph([])),!0,n.Fd,s,o,l)},labels:function(e,r,n,o,s,l){var h;if((h=s["bounding boxes"])||(Rw=!0,h=void 0),h){for(var d=h.length,y=new Ph([]),g;d--;){var v;(v=h[d])||(Rw=!0,v=void 0),(g=v)&&Vw(g,y)}Uw(e,r,y,!0,n.Fd,s,o,l)}delete s["bounding boxes"]},buildings:function(e,r,n,o,s,l){var h=s.id,d=r.ig[h],y,g,v,m=[],w=[];if((y=s)||(Rw=!0,y=void 0),y&&((g=y.vertices)||(Rw=!0,g=void 0),g)){var I;(I=y.polygons)||(Rw=!0,I=void 0),(v=I)&&m.push.apply(m,Ww(g,v)),(y=y.outlines)||(Rw=!0,y=void 0),(v=y)&&w.push.apply(w,Ww(g,v))}v=m.length,m.push.apply(m,w),w=new Ph(m,Wd,v),(m=m.length)||(Rw=!0,m=void 0),m&&(d?(br(d,e,[w]),l.spatials.push(d)):(d=Uw(e,r,w,!0,n.Fd,s,o,l,h),r.fa(d)))}};Sw["transit stops"]=Sw.POIs=Sw.labels;var Xw=["box 2","box 1","annotation box","icon box"];function Vw(e,r){for(var n=Xw.length,o,s;n--;)if(o=Xw[n],s=e[o]){var l=s[0],h=s[1],d=s[2];s=s[3],r.a.push([new J(l,h),new J(l+d,h),new J(l+d,h+s),new J(l,h+s)]),delete e[o]}return r}function Ww(e,r){var n=r.length,o,s,l;if(0<n){for(s=Array(n);n--;)if((o=r[n])||(Rw=!0,o=void 0),o){var h=o.length;if(0<h)for(s[n]=l=Array(h);h--;){var d=2*o[h];l[h]=new J(e[d],e[d+1])}}}return s||[]}var Yw={};function Uw(e,r,n,o,s,l,h,d,y){return Yw.style=s,o=new Yq(r,o,y,Yw),n&&br(o,e,[n]),Zw(l),l.category=h,o.setData(l),d.spatials.push(o),o.ka(r),o}Pw.prototype.Fd=new wh({strokeColor:"transparent",fillColor:"transparent",lineWidth:0});var Tw={};function Zw(e){var r,n=!1;switch(typeof e){case"object":if(e instanceof Array)for(r=e.length;r--;)Zw(e[r])?n=!0:delete e[r];else if(e)for(r in e)Zw(e[r])?n=!0:delete e[r];break;case"number":n=!0;break;default:n=!!e}return n}function $w(e,r,n){n=n||{},r=r||{};var o=n.tileType||"maptile",s=n.scheme||"normal.day";if(S.call(this,{min:0,max:20}),r.pois===!0&&(r.pois="!F"),this.L=r,!(e&&e instanceof ax))throw Error("InvalidArgument: service required");this.m=e,this.i=A(this.i,this),this.m.addEventListener("versionupdate",this.i),this.Yb=e.v().clone().G(o+"/"+e.vc()+"/"+s).I(bx).I(r),this.R=e.f||null,this.T=n.pixelRatio||n.pixelratio||Ue(),this.tileSize=n.tileSize||256,this.tileType=o,this.scheme=s,this.f=new hr(new Pw(n.categoryFilter)),this.f.ka(this),this.u=A(this.u,this),this.f.addEventListener("update",this.u),this.D=!1,S.call(this,{min:0,max:20}),this.J(new Rk(n.tileCacheSize||256,A(this.aa,this)))}u($w,S),t("H.service.metaInfo.TileProvider",$w),$w.prototype.aa=function(e,r){e=r.Ua();for(var n=e.length,o;n--;)o=e[n],delete o.a[r.key],o.release();r.data&&(Cp.push(r.gg(),this.tileSize),r.hg())},$w.prototype.u=function(){this.dispatchEvent("update")},$w.prototype.B=function(e,r,n,o,s){var l=this.Yb.clone(),h=this.R,d=this.tileSize,y=this.getTileKey(e,r,n);y=this.nb().get(y);var g;if(y&&!y.Ud()){o(Cp.pop(this.tileSize),null);var v={cancel:function(){}}}else{h&&l.Ba(h[(n+r+e)%h.length]),l.G(n+"/"+e+"/"+r+"/"+d+"/png8");var m=Ap.setTimeout(function(){g=new tf("text/plain",l.toString()),g.then(function(w){o(null,w)},s)},500)}return this.D||(zp($w,"Use HERE Vector Tile API or Raster Tile API v3 instead."),this.D=!0),v||{cancel:function(){g?g.cancel():Ap.clearTimeout(m)}}},$w.prototype.requestInternal=$w.prototype.B,$w.prototype.ac=function(e,r,n,o,s){var l=this.f,h=o||Cp.pop(this.tileSize);if(o)e=this.nb().get(this.getTileKey(e,r,n)),e.W(o);else if(o=e=new al(this.uc(e,r,n),e,r,n,this.tileSize,this.T,n,l),delete o.l,o.s=s,e.W(h))for(s=e.Ua(),h=s.length;h--;)s[h].pg();else Cp.push(h,this.tileSize);return e},$w.prototype.createTileInternal=$w.prototype.ac,$w.prototype.F=function(){this.f.F(),this.m.removeEventListener("versionupdate",this.i),S.prototype.F.call(this)},$w.prototype.dispose=$w.prototype.F,$w.prototype.i=function(){var e=this.m;this.Yb=e.v().clone().G(this.tileType+"/"+e.vc()+"/"+this.scheme).I(bx).I(this.L),this.reload(!1)};var bx={metadata:"metaonly",mgen:"2"};function ax(e){ax.j.constructor.call(this,ax,e),e=Pp(this,e),this.f=e.shards,(this.b=e.ignoreTypes?null:e.type)&&this.v().Ba(this.b),this.c=e.version,this.l=new lq,this.c==="newest"&&cx(this)}u(ax,Op),t("H.service.metaInfo.Service",ax),ax.prototype.Aa=function(){return{type:"base",version:"newest",subDomain:"maps.ls",path:"maptile/2.1",shards:["1","2","3","4"]}},ax.CONFIG_KEY="metaInfo";function dx(e,r){for(var n={},o=e[r+"s"][r],s=o.length;s--;)n[o[s].id]=o[s];e[r+"s"]=n}ax.prototype.Hj=function(){return this.b},ax.prototype.vc=function(){return this.c},ax.prototype.getVersion=ax.prototype.vc,ax.prototype.ba=function(){return this.l},ax.prototype.getCopyrights=ax.prototype.ba;function cx(e){var r=e.v().clone().G("info").I({output:"json"});e.f&&r.Ba(e.f[0]),e.B(r,function(n){n=n.response;var o;if(dx(n,"map"),dx(n,"scheme"),dx(n,"tiletype"),dx(n,"format"),dx(n,"resolution"),dx(n,"language"),e.c==="newest"&&e.b!=="traffic")for(o in n.maps)n.maps[o].hash&&n.maps[o].newest&&(e.c=n.maps[o].hash,e.dispatchEvent("versionupdate"));e.s=n,e.dispatchEvent("infoupdate")},function(n){throw n})}ax.prototype.Fe=function(){return this.s},ax.prototype.getInfo=ax.prototype.Fe,ax.prototype.ue=function(e,r,n,o,s,l){return new $w(this,o,{tileSize:e,pixelRatio:r,categoryFilter:n,tileType:s,scheme:l})},ax.prototype.createTileProvider=ax.prototype.ue,ax.prototype.nc=function(e,r,n,o,s,l){return new sl(this.ue(e,r,n,o,s,l))},ax.prototype.createTileLayer=ax.prototype.nc,X.prototype.Aj=function(e){return this.Ma(ax,e)},X.prototype.getMetaInfoService=X.prototype.Aj,function(){var e=X.prototype.createDefaultLayers;X.prototype.createDefaultLayers=function(r,n,o,s,l,h){var d=e.call(this,r,n,o,s,l,h),y={},g=this.Aj();typeof r=="object"&&(h=r,r=h.tileSize,n=h.ppi,o=h.lg,s=h.lg2,l=h.style,h=h.pois),r=r||256;var v=n===320?2:1;if(0>[72,250,320,500].indexOf(+n)){if(n!==B)throw new D(this.wf,1,n)}else y.ppi=+n;return o&&(y.lg=o),s&&(y.lg2=s),l&&(y.style=l),h&&(y.pois=h),d.raster.normal.metaInfo=g.nc(r,v,["buildings"],y),d}}(),H.__bootstrap__=`var l,aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(a,b){if(b){var c=ba;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&aa(c,a,{configurable:!0,writable:!0,value:b})}}var ea;
if("function"==typeof Object.setPrototypeOf)ea=Object.setPrototypeOf;else{var fa;a:{var ha={lb:!0},ja={};try{ja.__proto__=ha;fa=ja.lb;break a}catch(a){}fa=!1}ea=fa?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var ka=ea;ca("Object.setPrototypeOf",function(a){return a||ka});var p=this||self;
function la(a,b,c){a=a.split(".");c=c||p;a[0]in c||"undefined"==typeof c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)a.length||void 0===b?c[d]&&c[d]!==Object.prototype[d]?c=c[d]:c=c[d]={}:c[d]=b}function ma(){}
function na(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function r(a){return"function"==na(a)}function oa(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var pa="closure_uid_"+(1E9*Math.random()>>>0),ra=0;function sa(a,b,c){return a.call.apply(a.bind,arguments)}
function ta(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,d);return a.apply(b,e)}}return function(){return a.apply(b,arguments)}}function ua(a,b,c){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ua=sa:ua=ta;return ua.apply(null,arguments)}
function va(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();d.push.apply(d,arguments);return a.apply(this,d)}}function t(a,b){la(a,b,void 0)}function wa(a,b){function c(){}c.prototype=b.prototype;a.U=b.prototype;a.prototype=new c;a.prototype.constructor=a};function v(){}t("H.util.ICache",v);v.prototype.add=function(){};v.prototype.add=v.prototype.add;v.prototype.get=function(){};v.prototype.get=v.prototype.get;v.prototype.sa=function(){};v.prototype.drop=v.prototype.sa;v.prototype.forEach=function(){};v.prototype.forEach=v.prototype.forEach;v.prototype.S=function(){};v.prototype.removeAll=v.prototype.S;v.prototype.aa=function(){};v.prototype.registerOnDrop=v.prototype.aa;v.prototype.qa=function(){};v.prototype.deRegisterOnDrop=v.prototype.qa;function xa(){var a=ya,b;for(b in a)return!1;return!0}function za(a){var b={},c;for(c in a)b[c]=a[c];return b}var Aa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ba(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Aa.length;f++)c=Aa[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};var Ca=this;function Da(a){if(Error.captureStackTrace)Error.captureStackTrace(this,Da);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))}wa(Da,Error);Da.prototype.name="CustomError";var Ea=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"===typeof a)return"string"!==typeof b||1!=b.length?-1:a.indexOf(b,0);for(var c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};var Fa=ua,Ga=String,Ha=Ca.Object.freeze||function(a){return a},x=[].pop(),Ia=/x/.exec("");function Ja(a){return Ga(a).split(","!==x?",":" ")}var Ma="prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Na(a,b,c,d){if(!(b=a instanceof b)&&c)throw new y(c,d,void 0!==x?void 0:a);return b}function Oa(a,b,c,d){var e;if(!(e="Array"===Pa(a))&&b)throw new y(b,c,d!==x?d:a);return e}
t("H.lang.isArray",function(a,b,c,d){return Oa(a,b,c,d)});function Qa(a){return"string"===typeof a}t("H.lang.isString",Qa);var Ra=isNaN;function Sa(a){return a===+a}t("H.lang.isNumber",Sa);t("H.lang.isInteger",Number.isInteger?Number.isInteger:function(a){return"number"===typeof a&&0===a%1});function Pa(a){var b=Object[Ma[0]][Ma[6]].call(a).match(/^\\[object (\\w+)\\]$/);return b?b[1]:typeof a}var Ta=[];0>Ta.indexOf(Ta)&&Ta.push(Ta);
function Ua(a,b,c,d){var e="",f=2>arguments.length,g;f&&(b={H:Ca.H},c="",d=Ta.slice());Va(b,!0,function(h,k){try{if(g=h[k],k=Wa(h,g),!(oa(g)&&g.window===g&&g.self===g||oa(g)&&0<g.nodeType&&r(g.cloneNode))&&oa(g)){if(g===a)return e=c+"."+k,!0;if(0>d.indexOf(g)&&(d.push(g),e=Ua(a,g,c+"."+k,d)))return!0}}catch(m){}});f&&(e=e?e.substr(1).replace("."+Ma[0]+".","#"):"~"+(r(a)?Xa(a)+"()":Pa(a)));return e}
function Wa(a,b){var c=[];Va(a,!1,function(d,e){d[e]===b&&c.push(e)});return c.sort(Ya)[0]}function Ya(a,b){return b.length-a.length}var Za=Object[Ma[0]][Ma[2]];function Va(a,b,c){var d;if(a){for(e in a)if((!b||Za.call(a,e))&&c(a,e,!0))return;for(d=Ma.length;d--;){var e=Ma[d];if((!b||Za.call(a,e))&&c(a,e,!1))break}}}function Xa(a){return(a=/^\\s*function ([^\\( ]+)/.exec(a))?a[1]:"anonymous"}function $a(a,b,c){c[b]="#"+b};function A(a,b,c){this.g=[];b&&this.aa(b);if(c&&!r(c))throw new y(A,2,c);this.b=0;this.filter=c;this.a={};this.f=this.c=null;this.Ha(a)}t("H.util.Cache",A);A.prototype.add=function(a,b,c){var d,e;c=+c;if(!Sa(c)||0>c)throw new y(this.add,2,c);a=String(a);if(e=this.filter?this.filter(a,b,c):!0)(d=this.a[a])?(d.data!==b&&ab(this,d),this.b+=c-d.size,d.size=c,d.data=b,eb(this,d)):this.a[a]=fb(this,{id:a,data:b,size:c,m:null,C:null},this.c),gb(this);return e};A.prototype.add=A.prototype.add;
A.prototype.aa=function(a){if(!r(a))throw new y(this.aa,0,a);this.g.push(a)};A.prototype.registerOnDrop=A.prototype.aa;A.prototype.qa=function(a){this.g=this.g.filter(function(b){return b!==a})};A.prototype.deRegisterOnDrop=A.prototype.qa;A.prototype.get=function(a,b){return(a=b?this.a[a]:eb(this,this.a[a]))&&a.data};A.prototype.get=A.prototype.get;A.prototype.sa=function(a){var b;(b=this.a[a])&&hb(this,b,!0)};A.prototype.drop=A.prototype.sa;
A.prototype.forEach=function(a,b,c){var d;for(d in this.a){var e=this.a[d];(c?c(d,e.data,e.size):1)&&a.call(b,d,e.data,e.size)}};A.prototype.forEach=A.prototype.forEach;A.prototype.S=function(a){var b;for(b in this.a){var c=this.a[b];(a?a(b,c.data,c.size):1)&&hb(this,this.a[b],!0)}};A.prototype.removeAll=A.prototype.S;A.prototype.Ha=function(a){if(!(0<+a))throw new y(A.prototype.Ha,0,a);this.i=+a;gb(this);return this};A.prototype.setMaxSize=A.prototype.Ha;A.prototype.Bb=function(){return this.i};
A.prototype.getMaxSize=A.prototype.Bb;A.prototype.xb=function(){return this.b};A.prototype.getCurrentSize=A.prototype.xb;function eb(a,b){b&&(a.c=fb(a,b,a.c));return b}function gb(a){for(;a.b>a.i&&a.f;)hb(a,a.f,!0)}function fb(a,b,c){if(c!==b){(b.m||b.C)&&hb(a,b,!1);if(b.m=c)b.C=c.C,c.C=b;b.C||(a.c=b);b.m||(a.f=b);a.b+=b.size}return b}function hb(a,b,c){var d=b.C,e=b.m;if(d||e||b==a.c&&b==a.f)d?d.m=e:a.c=e,e?e.C=d:a.f=d,a.b-=b.size,c&&(delete a.a[b.id],ab(a,b));b.m=b.C=null}
function ab(a,b){for(var c=a.g.length;c--;)a.g[c].call(a,b.id,b.data,b.size)};function B(){}t("H.service.extension.dataView.ITable",B);B.prototype.xa=function(){};B.prototype.getMeta=B.prototype.xa;B.prototype.ya=function(){};B.prototype.getRowCount=B.prototype.ya;B.prototype.ga=function(){};B.prototype.getRow=B.prototype.ga;B.prototype.A=function(){};B.prototype.getColumnNames=B.prototype.A;B.prototype.wa=function(){};B.prototype.getColumn=B.prototype.wa;B.prototype.l=function(){};B.prototype.getCell=B.prototype.l;B.prototype.concat=function(){};B.prototype.concat=B.prototype.concat;function ib(){}t("H.service.extension.dataView.IRow",ib);ib.prototype.A=function(){};ib.prototype.getColumnNames=ib.prototype.A;ib.prototype.l=function(){};ib.prototype.getCell=ib.prototype.l;ib.prototype.za=function(){};ib.prototype.getTable=ib.prototype.za;function jb(a,b){this.a=a;this.b=b}t("H.service.extension.dataView.ObjRow",jb);jb.prototype.A=function(){return this.a.A()};jb.prototype.getColumnNames=jb.prototype.A;jb.prototype.l=function(a){return this.a.l(this.b,a)};jb.prototype.getCell=jb.prototype.l;jb.prototype.za=function(){return this.a};jb.prototype.getTable=jb.prototype.za;function kb(){}t("H.service.extension.dataView.IColumn",kb);kb.prototype.l=function(){};kb.prototype.getCell=kb.prototype.l;function lb(a,b){this.b=a;this.a=b}t("H.service.extension.dataView.ObjColumn",lb);lb.prototype.l=function(a){return this.b.l(a,this.a)};lb.prototype.getCell=lb.prototype.l;function y(a,b,c){var d=arguments.length;b=b!==x?+b:b;if(b!==x){var e=(e=/^.*?\\(([^\\)]+)/.exec((""+a).replace(/(\\/\\*([\\s\\S]*?)\\*\\/)|(\\/\\/(.*)$)/gm,"")))?Ja(e[1].replace(/\\s+/g,"")):[];e.forEach($a);e=e[b]||"#"+b}var f=a?Ua(a):"";d=2<d?Ga(c):"";if(e||d)f+=" (Argument "+(e||"")+(d?" "+d:"")+")";d=Error(f);Object.setPrototypeOf(d,y.prototype);return d}wa(y,Error);t("H.lang.InvalidArgumentError",y);y.prototype.name="InvalidArgumentError";function C(a,b,c){var d;b=b||(a&&a.length?Object.keys(a[0]):x);this.D=a;if(b)for(this.M=b,this.pa=a=Object.create(Ia,void 0),d=b.length;d--;)a[b[d]]=!0;c!==x&&(this.Ca=c)}t("H.service.extension.dataView.ObjTable",C);l=C.prototype;l.Ca=x;l.D=x;l.M=x;l.pa=x;l.xa=function(){return this.Ca};C.prototype.getMeta=C.prototype.xa;C.prototype.ya=function(){return this.D?this.D.length:0};C.prototype.getRowCount=C.prototype.ya;C.prototype.ga=function(a){var b=this.D;return b&&b[a]?new jb(this,a):x};
C.prototype.getRow=C.prototype.ga;C.prototype.A=function(){return this.M||mb};C.prototype.getColumnNames=C.prototype.A;C.prototype.wa=function(a){return this.pa[a]?new lb(this,a):x};C.prototype.getColumn=C.prototype.wa;C.prototype.l=function(a,b){var c=this.D;return(a=c&&this.pa[b]&&c[a])&&a[b]};C.prototype.getCell=C.prototype.l;
C.prototype.concat=function(){var a=arguments.length,b,c=this.M,d=""+this.M,e=(this.D||[]).slice();for(b=0;b<a;b++){var f=arguments[b];if(!(f instanceof C))throw new y(this.concat,b);if(f.D){if(c&&""+f.M!==d)throw new y(this.concat,b,"Incompatible columns!");e=e.concat(f.D)}}return new C(e,this.M,this.Ca)};C.prototype.concat=C.prototype.concat;var D=Math,nb=D.min,ob=D.max,pb=D.round,qb=D.floor,rb=D.ceil,sb=D.abs,tb=D.log,ub=D.sqrt,vb=D.pow,wb=D.exp,xb=D.sin,yb=D.asin,zb=D.cos,Ab=D.tan,Bb=D.atan,Cb=D.atan2,Db=D.LN2,E=D.PI,Eb=E/2,Fb=E/4,Gb=2*E,Hb=3*E,Ib=E/180,Kb=180/E,Lb=1/0;vb(-2,53);function Mb(a,b){var c;return 0>(c=a%b)===0>b?c:c+b}t("H.math.normalize",function(a,b,c){b-=c=c||0;a-=c;return a-qb(a/b)*b+c});function Nb(a,b,c){return a>c?c:a<b?b:a}t("H.math.clamp",Nb);function Ob(a,b,c){return b<c?a>=b&&a<=c:a>=c&&a<=b}
function Pb(a,b,c,d,e,f){return ub(vb((a-e)*(d-f)-(b-f)*(c-e),2)/(vb(c-e,2)+vb(d-f,2)))}var Qb={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};t("H.math.CoverType",Qb);
function Rb(a,b,c){for(var d=c.length,e=d,f,g,h,k,m=c[0],n=0,q=0,u=0;1!=n&&1<e;){g=c[--e];f=c[--e];k=c[e?e-1:(d+(e-1))%d];h=c[e?e-2:(d+(e-2))%d];if(f>=a&&f<=a&&g>=b&&g<=b||h>=a&&h<=a&&k>=b&&k<=b)n=1;else if(!n&&f===a)h===a&&(g<b&&k>b||g>b&&k<b)||(m<=a&&h>a||m>=a&&h<a)&&(g>=b?++q:++u),n=Ob(b,g,k)&&0>=Pb(a,b,f,g,h,k)?2:0;else if(!n&&Ob(a,f,h)){if(f<a&&h>a||f>a&&h<a)m=g+(a-f)/(h-f)*(k-g),q+=m>b,u+=m<b;n=Ob(b,g,k)&&0>=Pb(a,b,f,g,h,k)?2:0}m=f}!n&&0!==u&&0!==q%2&&(n=3);return n}
function Sb(a,b){return Rb(a.x,a.y,b)!==Qb.NONE}t("H.math.isPointInsidePolygon",Sb);function Tb(a){for(var b=a.length,c=new Float64Array(2*b),d=b&&a[0].x!==x;b--;){var e=a[b],f=b<<1;c[f]=d?e.x:e[0];c[f+1]=d?e.y:e[1]}return c}t("H.math.flatten",Tb);function F(a,b){this.x=+a;this.y=+b}t("H.math.Point",F);F.prototype.set=F;F.prototype.set=F.prototype.set;F.prototype.clone=function(a){a?(a.x=this.x,a.y=this.y):a=new F(this.x,this.y);return a};F.prototype.clone=F.prototype.clone;F.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};F.prototype.add=F.prototype.add;F.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};F.prototype.sub=F.prototype.sub;F.prototype.scale=function(a,b){this.x*=a;this.y*=void 0===b?a:b;return this};
F.prototype.scale=F.prototype.scale;F.prototype.round=function(){this.x=pb(this.x);this.y=pb(this.y);return this};F.prototype.round=F.prototype.round;F.prototype.floor=function(){this.x=qb(this.x);this.y=qb(this.y);return this};F.prototype.floor=F.prototype.floor;F.prototype.ceil=function(){this.x=rb(this.x);this.y=rb(this.y);return this};F.prototype.ceil=F.prototype.ceil;F.prototype.F=function(a){return!(!a||this.x!==a.x||this.y!==a.y)};F.prototype.equals=F.prototype.F;
F.prototype.Cb=function(a,b){var c=b.x-a.x,d=b.y-a.y,e=a;if(c||d){var f=((this.x-a.x)*c+(this.y-a.y)*d)/(c*c+d*d);0>=f?e=a:1<=f?e=b:e=new F(a.x+f*c,a.y+f*d)}return e};F.prototype.getNearest=F.prototype.Cb;F.prototype.ra=function(a){return ub(vb(this.x-a.x,2)+vb(this.y-a.y,2))};F.prototype.distance=F.prototype.ra;F.fromIPoint=function(a){if(!a)throw Error("invalid argument");return a instanceof F?a:new F(a.x,a.y)};function Ub(a,b,c,d,e,f){var g,h,k=a.length,m,n;if(k)for(g=[];k--;){var q=a[k];var u=q.length;var I=0;for(m=1;m<u;m++)if(n=Vb(q[m-1],q[m],c,b,d,e)){var L=n[0];var w=n[1];I&&I.F(L)?h.push(w):g.push(h=n);I=w;f&&(m=u,k=0)}}else g=a;return g}t("H.math.clipping.clipStrips",Ub);
function Vb(a,b,c,d,e,f){var g=a.x;a=-a.y;var h=b.x;b=-b.y;c=-c;f=-f;if(g>h){if(h>e||g<d)return;var k=g;var m=a;g=h;a=b;h=k;b=m;k=1}else if(g>e||h<d)return;if(a>b){if(b>c||a<f)return;var n=1;a=-a;b=-b;m=f;f=-c;c=-m}else if(a>c||b<f)return;if(g<d){if((a+=(d-g)*(b-a)/(h-g))>c)return;g=d}if(a<f){if((g+=(f-a)*(h-g)/(b-a))>e)return;a=f}h>e&&(b=a+(e-g)*(b-a)/(h-g),h=e);b>c&&(h=g+(c-a)*(h-g)/(b-a),b=c);n&&(a=-a,b=-b);return k?[new F(h,-b),new F(g,-a)]:[new F(g,-a),new F(h,-b)]}
function Wb(a,b,c){a=Xb(a,!0);b=Xb(b,!1);var d,e;var f={};var g=d=1;switch(~~(c||0)){case 1:g=d=0;break;case 2:d=0;g=1;break;case 3:d=1,g=0}c=d;var h=g;if(b&&a){b.W=new Yb(b.x,b.y,null,Zb(b));a.W=new Yb(a.x,a.y,null,Zb(a));for(g=b;g.next;g=g.next)if(!g.u)for(d=a;d.next;d=d.next)if(!d.u){var k=$b(g.next);var m=$b(d.next);if(e=ac(g,k,d,m,f)){e=f.mb;var n=f.nb;var q=f.ec;var u=f.fc;e=new Yb(q,u,null,null,null,null,!0,0,0,e);bc(e,g,k);k=new Yb(q,u,null,null,null,null,!0,0,0,n);bc(k,d,m);e.Da=k;k.Da=e}}f=
Sb(b,cc(a));c&&(f=!f);for(g=b;g;g=g.next)g.u&&(g.Aa=f,f=!f);f=Sb(a,cc(b));h&&(f=!f);for(d=a;d.next;d=d.next)d.u&&(d.Aa=f,f=!f);dc(b);for(dc(a);(a=ec(b))!=b;){for(c=null;!a.na;a=a.Da){for(f=a.Aa;;){c=new Yb(a.x,a.y,c);c.artificial=a.u||a.Wa;a.na=1;a=f?a.next:a.o;if(!a)break;if(a.u){a.na=1;break}}if(!a)break}c.Za=I||null;var I=c}return I}}t("H.math.clipping.clipPolygon",Wb);
function Yb(a,b,c,d,e,f,g,h,k,m){this.x=a;this.y=b;this.next=c||null;this.o=d||null;this.Za=e||null;this.Da=f||null;this.u=!!g;this.Aa=!!h;this.na=k||0;this.alpha=m||0;d&&(d.next=this);c&&(c.o=this);this.Wa=!1;this.W=null}function $b(a){for(;a&&a.u;)a=a.next;return a}function Zb(a){if(a)for(;a.next;)a=a.next;return a}function ec(a){var b=a;if(b){do b=b.next;while(b!=a&&(!b.u||b.u&&b.na))}return b}function dc(a){var b=Zb(a);b.o.next=a;a.o=b.o}
function ac(a,b,c,d,e){var f,g=b.x-a.x,h=b.y-a.y;var k=d.x-c.x;var m=d.y-c.y;var n=g*m-h*k;if(!n)return 0;k=((c.x-a.x)*m-(c.y-a.y)*k)/n;n=(h*(c.x-a.x)-g*(c.y-a.y))/n;if(0>k||1<k||0>n||1<n)return 0;0===k?f=a:1===k?f=b:0===n?f=c:1===n&&(f=d);if(f)return f.x+=2.480549651603763E-5,f.y+=7.321997314118067E-5,f.W&&(f.W.x=f.x,f.W.y=f.y),ac(a,b,c,d,e);e.ec=a.x+k*g;e.fc=a.y+k*h;e.mb=k;e.nb=n;return 1}function cc(a){for(var b=[];a;)b.push(a.x,a.y),a=a.next;return b}
function bc(a,b,c){for(b=b.next;b!==c&&b.alpha<=a.alpha;)b=b.next;a.next=b;a.o=b.o;a.next.o=a;a.o.next=a}function Xb(a,b){for(var c,d=null,e=0,f=a.length;e<f;e++){c=new Yb(a[e].x,a[e].y,d);c.Wa=b;if(c.next=d)d.o=c;d=c}return d};function fc(a,b){var c=[];a&&c.push(Ua(a));1<arguments.length&&c.push(""+b);c=Error(c.join(" "));Object.setPrototypeOf(c,fc.prototype);return c}wa(fc,Error);t("H.lang.IllegalOperationError",fc);fc.prototype.name="IllegalOperationError";function gc(){this.constructor=this.constructor;if(!Qa("STATIC_DB"))throw new y(this.constructor,0);this.i=hc();if(!this.i)throw new fc(this.constructor,"This browser does not support IndexedDB");this.a=[];this.c=[];this.g=Fa(this.g,this)}var ic,jc;gc.prototype.get=function(a,b,c){var d;if(!Qa(a)&&!Sa(a))throw new y(this.get,0);if(!r(b))throw new y(this.get,1);kc(this,function(e){d=e.get(a);lc(d,b,c)},c);return{cancel:function(){d&&(d.onsuccess=mc)}}};
gc.prototype.g=function(){var a=this.b.result;a.objectStoreNames.contains("data")||a.createObjectStore("data")};
function nc(a,b,c){if(a.b)a.a?(a.a.push(b),c&&a.c.push(c)):a.f?c&&c(a.f):b(a.b.result);else{a.b=a.i.open("H_STATIC_DB",1);a.b.onupgradeneeded=a.g;var d=a.b.onerror=function(){clearTimeout(a.j);a.f=this.error;a.c.forEach(function(e){e(a.f)});delete a.a;delete a.c};a.j=setTimeout(function(){d.call({error:Error("DbOpenTimeoutError")})},500);a.b.onsuccess=function(){clearTimeout(a.j);a.a?(a.a.forEach(function(e){e(this.result)},this),delete a.a,delete a.c):(delete a.b,delete a.f,a.a=[],a.c=[])};
a.a.push(b);c&&a.c.push(c)}}function kc(a,b,c){nc(a,function(d){d=d.transaction(["data"],"readwrite");b(d.objectStore("data"))},c)}function lc(a,b,c){b&&(a.onsuccess=function(){b(this.result)});c&&(a.onerror=function(){c(this.error)})}t("H.util.IndexedDBStorage.getInstance",function(){ic||(ic=new gc);return ic});function hc(){return Ca.indexedDB||Ca.webkitIndexedDB||Ca.mozIndexedDB||Ca.msIndexedDB}
t("H.util.IndexedDBStorage.isSupported",function(){var a="";if(jc===x)if("file:"===window.location.protocol&&-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&128<=window.location.href.length)jc=!1;else{try{var b=hc();a="H_TEST_DB";var c=b&&b.open(a,1)}catch(d){}jc=!!c&&null===c.onupgradeneeded;c&&b.deleteDatabase&&b.deleteDatabase(a)}return jc});function J(){0!=oc&&(pc[this[pa]||(this[pa]=++ra)]=this);this.c=this.c;this.a=this.a}var oc=0,pc={};J.prototype.c=!1;J.prototype.s=function(){if(!this.c&&(this.c=!0,this.v(),0!=oc)){var a=this[pa]||(this[pa]=++ra);if(0!=oc&&this.a&&0<this.a.length)throw Error(this+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete pc[a]}};
J.prototype.L=function(a,b){this.c?void 0!==b?a.call(b):a():(this.a||(this.a=[]),this.a.push(void 0!==b?ua(a,b):a))};J.prototype.v=function(){if(this.a)for(;this.a.length;)this.a.shift()()};function K(a,b){this.type=a;this.currentTarget=this.target=b;this.a=!1;this.ab=!0}K.prototype.stopPropagation=function(){this.a=!0};K.prototype.c=function(){this.ab=!1};t("H.util.Event",K);K.prototype.stopPropagation=K.prototype.stopPropagation;K.prototype.stopPropagation=K.prototype.stopPropagation;K.prototype.CAPTURING_PHASE=1;K.prototype.CAPTURING_PHASE=K.prototype.CAPTURING_PHASE;K.prototype.AT_TARGET=2;K.prototype.AT_TARGET=K.prototype.AT_TARGET;K.prototype.BUBBLING_PHASE=3;K.prototype.BUBBLING_PHASE=K.prototype.BUBBLING_PHASE;K.prototype.eventPhase=0;K.prototype.eventPhase=K.prototype.eventPhase;function qc(a,b,c){qc.U.constructor.call(this,a,c);this.data=b}wa(qc,K);t("H.util.DataEvent",qc);function rc(a,b,c){rc.U.constructor.call(this,a,c);this.message=b}wa(rc,K);t("H.util.ErrorEvent",rc);function sc(){}t("H.util.ICancelable",sc);sc.prototype.cancel=function(){};sc.prototype.cancel=sc.prototype.cancel;function tc(a,b){this.c=a;this.f=b;this.b=0;this.a=null}tc.prototype.get=function(){if(0<this.b){this.b--;var a=this.a;this.a=a.next;a.next=null}else a=this.c();return a};function uc(a,b){a.f(b);100>a.b&&(a.b++,b.next=a.a,a.a=b)};function vc(){this.b=this.a=null}var xc=new tc(function(){return new wc},function(a){a.reset()});vc.prototype.add=function(a,b){var c=xc.get();c.set(a,b);this.b?this.b.next=c:this.a=c;this.b=c};function yc(){var a=zc,b=null;a.a&&(b=a.a,a.a=a.a.next,a.a||(a.b=null),b.next=null);return b}function wc(){this.next=this.b=this.a=null}wc.prototype.set=function(a,b){this.a=a;this.b=b;this.next=null};wc.prototype.reset=function(){this.next=this.b=this.a=null};var Ac=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\\s\\xa0]*([\\s\\S]*?)[\\s\\xa0]*$/.exec(a)[1]};function Bc(a,b){return a<b?-1:a>b?1:0};var Cc;a:{var Dc=p.navigator;if(Dc){var Ec=Dc.userAgent;if(Ec){Cc=Ec;break a}}Cc=""}function M(a){return-1!=Cc.indexOf(a)};function Hc(a,b){this.b=a===Ic&&b||"";this.a=Jc}var Jc={},Ic={},Kc=new Hc(Ic,"");function Lc(a,b){this.b=a===Mc&&b||"";this.a=Nc}var Nc={},Mc={};function Oc(){this.a="";this.b=Pc}function Qc(){var a=Rc;if(a instanceof Oc&&a.constructor===Oc&&a.b===Pc)return a.a;na(a);return"type_error:SafeHtml"}var Pc={};function Sc(a){var b=new Oc;b.a=a;return b}Sc("<!DOCTYPE html>");var Rc=Sc("");Sc("<br>");function Tc(a){var b=new Lc(Mc,Kc instanceof Hc&&Kc.constructor===Hc&&Kc.a===Jc?Kc.b:"type_error:Const");b instanceof Lc&&b.constructor===Lc&&b.a===Nc?b=b.b:(na(b),b="type_error:TrustedResourceUrl");a.src=b.toString()};function Uc(a){Uc[" "](a);return a}Uc[" "]=ma;var Vc=M("Opera"),Wc=M("Trident")||M("MSIE"),Xc=M("Edge"),Yc=M("Gecko")&&!(-1!=Cc.toLowerCase().indexOf("webkit")&&!M("Edge"))&&!(M("Trident")||M("MSIE"))&&!M("Edge"),Zc=-1!=Cc.toLowerCase().indexOf("webkit")&&!M("Edge");function $c(){var a=p.document;return a?a.documentMode:void 0}var ad;
a:{var bd="",cd=function(){var a=Cc;if(Yc)return/rv:([^\\);]+)(\\)|;)/.exec(a);if(Xc)return/Edge\\/([\\d\\.]+)/.exec(a);if(Wc)return/\\b(?:MSIE|rv)[: ]([^\\);]+)(\\)|;)/.exec(a);if(Zc)return/WebKit\\/(\\S+)/.exec(a);if(Vc)return/(?:Version)[ \\/]?(\\S+)/.exec(a)}();cd&&(bd=cd?cd[1]:"");if(Wc){var dd=$c();if(null!=dd&&dd>parseFloat(bd)){ad=String(dd);break a}}ad=bd}var ed={},fd;fd=p.document&&Wc?$c():void 0;function gd(a){var b=document;a=String(a);"application/xhtml+xml"===b.contentType&&(a=a.toLowerCase());return b.createElement(a)};function hd(a){p.setTimeout(function(){throw a;},0)}var id;
function jd(){var a=p.MessageChannel;"undefined"===typeof a&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&!M("Presto")&&(a=function(){var e=gd("IFRAME");e.style.display="none";Tc(e);document.documentElement.appendChild(e);var f=e.contentWindow;e=f.document;e.open();e.write(Qc());e.close();var g="callImmediate"+Math.random(),h="file:"==f.location.protocol?"*":f.location.protocol+"//"+f.location.host;e=ua(function(k){if(("*"==h||k.origin==h)&&k.data==g)this.port1.onmessage()},
this);f.addEventListener("message",e,!1);this.port1={};this.port2={postMessage:function(){f.postMessage(g,h)}}});if("undefined"!==typeof a&&!M("Trident")&&!M("MSIE")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(void 0!==c.next){c=c.next;var e=c.Pa;c.Pa=null;e()}};return function(e){d.next={Pa:e};d=d.next;b.port2.postMessage(0)}}return"undefined"!==typeof document&&"onreadystatechange"in gd("SCRIPT")?function(e){var f=gd("SCRIPT");f.onreadystatechange=function(){f.onreadystatechange=null;
f.parentNode.removeChild(f);f=null;e();e=null};document.documentElement.appendChild(f)}:function(e){p.setTimeout(e,0)}};function kd(a,b){ld||md();nd||(ld(),nd=!0);zc.add(a,b)}var ld;function md(){if(p.Promise&&p.Promise.resolve){var a=p.Promise.resolve(void 0);ld=function(){a.then(od)}}else ld=function(){var b=od;!r(p.setImmediate)||p.Window&&p.Window.prototype&&!M("Edge")&&p.Window.prototype.setImmediate==p.setImmediate?(id||(id=jd()),id(b)):p.setImmediate(b)}}var nd=!1,zc=new vc;function od(){for(var a;a=yc();){try{a.a.call(a.b)}catch(b){hd(b)}uc(xc,a)}nd=!1};function pd(a){this.a=qd;this.j=void 0;this.f=this.b=this.c=null;this.g=this.i=!1;if(a!=ma)try{var b=this;a.call(void 0,function(c){rd(b,sd,c)},function(c){rd(b,td,c)})}catch(c){rd(this,td,c)}}var qd=0,sd=2,td=3;function ud(){this.next=this.c=this.b=this.f=this.a=null;this.g=!1}ud.prototype.reset=function(){this.c=this.b=this.f=this.a=null;this.g=!1};var vd=new tc(function(){return new ud},function(a){a.reset()});function wd(a,b,c){var d=vd.get();d.f=a;d.b=b;d.c=c;return d}
function xd(a,b,c){yd(a,b,c,null)||kd(va(b,a))}function zd(a){return new pd(function(b,c){var d=a.length,e=[];if(d)for(var f=function(m,n){d--;e[m]=n;0==d&&b(e)},g=function(m){c(m)},h=0,k;h<a.length;h++)k=a[h],xd(k,va(f,h),g);else b(e)})}function Ad(){var a,b,c=new pd(function(d,e){a=d;b=e});return new Bd(c,a,b)}pd.prototype.then=function(a,b,c){return Cd(this,r(a)?a:null,r(b)?b:null,c)};pd.prototype.$goog_Thenable=!0;
pd.prototype.cancel=function(a){if(this.a==qd){var b=new Dd(a);kd(function(){Ed(this,b)},this)}};function Ed(a,b){if(a.a==qd)if(a.c){var c=a.c;if(c.b){for(var d=0,e=null,f=null,g=c.b;g&&(g.g||(d++,g.a==a&&(e=g),!(e&&1<d)));g=g.next)e||(f=g);e&&(c.a==qd&&1==d?Ed(c,b):(f?(d=f,d.next==c.f&&(c.f=d),d.next=d.next.next):Fd(c),Gd(c,e,td,b)))}a.c=null}else rd(a,td,b)}function Hd(a,b){a.b||a.a!=sd&&a.a!=td||Id(a);a.f?a.f.next=b:a.b=b;a.f=b}
function Cd(a,b,c,d){var e=wd(null,null,null);e.a=new pd(function(f,g){e.f=b?function(h){try{var k=b.call(d,h);f(k)}catch(m){g(m)}}:f;e.b=c?function(h){try{var k=c.call(d,h);void 0===k&&h instanceof Dd?g(h):f(k)}catch(m){g(m)}}:g});e.a.c=a;Hd(a,e);return e.a}pd.prototype.Ea=function(a){this.a=qd;rd(this,sd,a)};pd.prototype.Ga=function(a){this.a=qd;rd(this,td,a)};
function rd(a,b,c){a.a==qd&&(a===c&&(b=td,c=new TypeError("Promise cannot resolve to itself")),a.a=1,yd(c,a.Ea,a.Ga,a)||(a.j=c,a.a=b,a.c=null,Id(a),b!=td||c instanceof Dd||Jd(a,c)))}function yd(a,b,c,d){if(a instanceof pd)return Hd(a,wd(b||ma,c||null,d)),!0;if(a)try{var e=!!a.$goog_Thenable}catch(g){e=!1}else e=!1;if(e)return a.then(b,c,d),!0;if(oa(a))try{var f=a.then;if(r(f))return Kd(a,f,b,c,d),!0}catch(g){return c.call(d,g),!0}return!1}
function Kd(a,b,c,d,e){function f(k){h||(h=!0,d.call(e,k))}function g(k){h||(h=!0,c.call(e,k))}var h=!1;try{b.call(a,g,f)}catch(k){f(k)}}function Id(a){a.i||(a.i=!0,kd(a.P,a))}function Fd(a){var b=null;a.b&&(b=a.b,a.b=b.next,b.next=null);a.b||(a.f=null);return b}pd.prototype.P=function(){for(var a;a=Fd(this);)Gd(this,a,this.a,this.j);this.i=!1};
function Gd(a,b,c,d){if(c==td&&b.b&&!b.g)for(;a&&a.g;a=a.c)a.g=!1;if(b.a)b.a.c=null,Ld(b,c,d);else try{b.g?b.f.call(b.c):Ld(b,c,d)}catch(e){Md.call(null,e)}uc(vd,b)}function Ld(a,b,c){b==sd?a.f.call(a.c,c):a.b&&a.b.call(a.c,c)}function Jd(a,b){a.g=!0;kd(function(){a.g&&Md.call(null,b)})}var Md=hd;function Dd(a){Da.call(this,a)}wa(Dd,Da);Dd.prototype.name="cancel";function Bd(a,b,c){this.a=a;this.b=b;this.reject=c};function Nd(a,b,c){this.type=a;this.data=b;this.a=Ad();this.Xa=Fa(this.Xa,this);this.reject=Fa(this.reject,this);this.priority=Od;c!==x&&(this.priority=c);this.b().add(this)}var Od=1,Pd={hc:0,ic:Od,gc:2};l=Nd.prototype;l.then=function(a,b,c){return this.a.a.then(a,b,c)};l.Xa=function(a){this.Z=3;this.a.b(a)};l.reject=function(a){this.Z=5;this.a.reject(a)};l.Z=0;
l.cancel=function(){if(3>this.Z){this.c();var a=this.b(),b=this.priority,c=a.a[b].indexOf(this);-1<c?a.a[b].splice(c,1):this.Ma&&a.ca.qb(this.Ma);this.Z=4}};Nd.prototype.cancel=Nd.prototype.cancel;function Qd(a){var b;this.a={};for(b in Pd)this.a[Pd[b]]=[];this.ca=a;this.ca.addEventListener("allocatable",Fa(this.b,this))}t("H.util.JobManager",Qd);var Rd=Object.keys(Pd).map(function(a){return Pd[a]}).sort().reverse();Qd.prototype.add=function(a){Na(a,Nd,this.add,0);this.a[a.priority].push(a);this.b()};Qd.prototype.contains=function(a){return-1<this.a[a.priority].indexOf(a)};
Qd.prototype.b=function(){Rd.forEach(function(a){this.a[a]=this.a[a].filter(function(b){var c;if((c=this.ca.jc(b))!==Ia){var d=Fa(this.ca.qb,this.ca,c,b);b.Ma=c;b.then(d,d);b.Z=b.kc(c)?1:5}else return!0},this)},this)};function Sd(a,b,c){var d=[],e=arguments.length;a&&d.push(Ua(a));1<e&&(e=2<e&&Oa(c,void 0,void 0,void 0)?" out of ["+c[0]+"..."+c[1]+"]":"",d.push("("+b+e+")"));d=Error(d.join(" "));Object.setPrototypeOf(d,Sd.prototype);return d}wa(Sd,Error);t("H.lang.OutOfRangeError",Sd);Sd.prototype.name="OutOfRangeError";var Td="closure_listenable_"+(1E6*Math.random()|0),Ud=0;function Vd(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.capture=!!d;this.ha=e;this.key=++Ud;this.T=this.da=!1}function Wd(a){a.T=!0;a.listener=null;a.proxy=null;a.src=null;a.ha=null};function Xd(a){this.src=a;this.a={};this.b=0}Xd.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.a[f];a||(a=this.a[f]=[],this.b++);var g=Yd(a,b,d,e);-1<g?(b=a[g],c||(b.da=!1)):(b=new Vd(b,this.src,f,!!d,e),b.da=c,a.push(b));return b};function Zd(a,b){var c=b.type;if(c in a.a){var d=a.a[c],e=Ea(d,b),f;(f=0<=e)&&Array.prototype.splice.call(d,e,1);f&&(Wd(b),0==a.a[c].length&&(delete a.a[c],a.b--))}}
Xd.prototype.S=function(a){a=a&&a.toString();var b=0,c;for(c in this.a)if(!a||c==a){for(var d=this.a[c],e=0;e<d.length;e++)++b,Wd(d[e]);delete this.a[c];this.b--}return b};function Yd(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.T&&f.listener==b&&f.capture==!!c&&f.ha==d)return e}return-1};var $d;($d=!Wc)||($d=9<=Number(fd));var ae=$d,be;
if(be=Wc){var ce;if(Object.prototype.hasOwnProperty.call(ed,"9"))ce=ed["9"];else{for(var de=0,ee=Ac(String(ad)).split("."),fe=Ac("9").split("."),ge=Math.max(ee.length,fe.length),he=0;0==de&&he<ge;he++){var ie=ee[he]||"",je=fe[he]||"";do{var ke=/(\\d*)(\\D*)(.*)/.exec(ie)||["","","",""],le=/(\\d*)(\\D*)(.*)/.exec(je)||["","","",""];if(0==ke[0].length&&0==le[0].length)break;de=Bc(0==ke[1].length?0:parseInt(ke[1],10),0==le[1].length?0:parseInt(le[1],10))||Bc(0==ke[2].length,0==le[2].length)||Bc(ke[2],le[2]);
ie=ke[3];je=le[3]}while(0==de)}ce=ed["9"]=0<=de}be=!ce}var me=be,ne=function(){if(!p.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{p.addEventListener("test",ma,b),p.removeEventListener("test",ma,b)}catch(c){}return a}();function oe(a,b){K.call(this,a?a.type:"");this.relatedTarget=this.currentTarget=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=0;this.key="";this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.pointerId=0;this.pointerType="";this.b=null;if(a){var c=this.type=a.type,d=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.currentTarget=b;if(b=a.relatedTarget){if(Yc){a:{try{Uc(b.nodeName);var e=!0;break a}catch(f){}e=
!1}e||(b=null)}}else"mouseover"==c?b=a.fromElement:"mouseout"==c&&(b=a.toElement);this.relatedTarget=b;d?(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0);this.button=a.button;this.key=a.key||"";this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=
a.shiftKey;this.metaKey=a.metaKey;this.pointerId=a.pointerId||0;this.pointerType="string"===typeof a.pointerType?a.pointerType:pe[a.pointerType]||"";this.b=a;a.defaultPrevented&&this.c()}}wa(oe,K);var pe={2:"touch",3:"pen",4:"mouse"};oe.prototype.stopPropagation=function(){oe.U.stopPropagation.call(this);this.b.stopPropagation?this.b.stopPropagation():this.b.cancelBubble=!0};
oe.prototype.c=function(){oe.U.c.call(this);var a=this.b;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,me)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var qe="closure_lm_"+(1E6*Math.random()|0),re={},se=0;function te(a,b,c,d,e){if(d&&d.once)ue(a,b,c,d,e);else if("array"==na(b))for(var f=0;f<b.length;f++)te(a,b[f],c,d,e);else c=ve(c),a&&a[Td]?a.b.add(String(b),c,!1,oa(d)?!!d.capture:!!d,e):we(a,b,c,!1,d,e)}
function we(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=oa(e)?!!e.capture:!!e,h=xe(a);h||(a[qe]=h=new Xd(a));c=h.add(b,c,d,g,f);if(!c.proxy){d=ye();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)ne||(e=g),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(ze(b.toString()),d);else if(a.addListener&&a.removeListener)a.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");se++}}
function ye(){var a=Ae,b=ae?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b}function ue(a,b,c,d,e){if("array"==na(b))for(var f=0;f<b.length;f++)ue(a,b[f],c,d,e);else c=ve(c),a&&a[Td]?a.b.add(String(b),c,!0,oa(d)?!!d.capture:!!d,e):we(a,b,c,!0,d,e)}
function Be(a,b,c,d,e){if("array"==na(b))for(var f=0;f<b.length;f++)Be(a,b[f],c,d,e);else(d=oa(d)?!!d.capture:!!d,c=ve(c),a&&a[Td])?(a=a.b,b=String(b).toString(),b in a.a&&(f=a.a[b],c=Yd(f,c,d,e),-1<c&&(Wd(f[c]),Array.prototype.splice.call(f,c,1),0==f.length&&(delete a.a[b],a.b--)))):a&&(a=xe(a))&&(b=a.a[b.toString()],a=-1,b&&(a=Yd(b,c,d,e)),(c=-1<a?b[a]:null)&&Ce(c))}
function Ce(a){if("number"!==typeof a&&a&&!a.T){var b=a.src;if(b&&b[Td])Zd(b.b,a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(ze(c),d):b.addListener&&b.removeListener&&b.removeListener(d);se--;(c=xe(b))?(Zd(c,a),0==c.b&&(c.src=null,b[qe]=null)):Wd(a)}}}function ze(a){return a in re?re[a]:re[a]="on"+a}
function De(a,b,c,d){var e=!0;if(a=xe(a))if(b=a.a[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.capture==c&&!f.T&&(f=Ee(f,d),e=e&&!1!==f)}return e}function Ee(a,b){var c=a.listener,d=a.ha||a.src;a.da&&Ce(a);return c.call(d,b)}
function Ae(a,b){if(a.T)return!0;if(!ae){if(!b)a:{b=["window","event"];for(var c=p,d=0;d<b.length;d++)if(c=c[b[d]],null==c){b=null;break a}b=c}d=b;b=new oe(d,this);c=!0;if(!(0>d.keyCode||void 0!=d.returnValue)){a:{var e=!1;if(0==d.keyCode)try{d.keyCode=-1;break a}catch(g){e=!0}if(e||void 0==d.returnValue)d.returnValue=!0}d=[];for(e=b.currentTarget;e;e=e.parentNode)d.push(e);a=a.type;for(e=d.length-1;!b.a&&0<=e;e--){b.currentTarget=d[e];var f=De(d[e],a,!0,b);c=c&&f}for(e=0;!b.a&&e<d.length;e++)b.currentTarget=
d[e],f=De(d[e],a,!1,b),c=c&&f}return c}return Ee(a,new oe(b,this))}function xe(a){a=a[qe];return a instanceof Xd?a:null}var Fe="__closure_events_fn_"+(1E9*Math.random()>>>0);function ve(a){if(r(a))return a;a[Fe]||(a[Fe]=function(b){return a.handleEvent(b)});return a[Fe]};function N(){J.call(this);this.b=new Xd(this);this.j=this;this.i=null}wa(N,J);N.prototype[Td]=!0;l=N.prototype;l.B=function(){return this.i};l.la=function(a){this.i=a};l.addEventListener=function(a,b,c,d){te(this,a,b,c,d)};l.removeEventListener=function(a,b,c,d){Be(this,a,b,c,d)};
l.dispatchEvent=function(a){var b,c=this.B();if(c)for(b=[];c;c=c.B())b.push(c);c=this.j;var d=a.type||a;if("string"===typeof a)a=new K(a,c);else if(a instanceof K)a.target=a.target||c;else{var e=a;a=new K(d,c);Ba(a,e)}e=!0;if(b)for(var f=b.length-1;!a.a&&0<=f;f--){var g=a.currentTarget=b[f];e=g.N(d,!0,a)&&e}a.a||(g=a.currentTarget=c,e=g.N(d,!0,a)&&e,a.a||(e=g.N(d,!1,a)&&e));if(b)for(f=0;!a.a&&f<b.length;f++)g=a.currentTarget=b[f],e=g.N(d,!1,a)&&e;return e};
l.v=function(){N.U.v.call(this);this.b&&this.b.S(void 0);this.i=null};l.N=function(a,b,c){a=this.b.a[String(a)];if(!a)return!0;a=a.concat();for(var d=!0,e=0;e<a.length;++e){var f=a[e];if(f&&!f.T&&f.capture==b){var g=f.listener,h=f.ha||f.src;f.da&&Zd(this.b,f);d=!1!==g.call(h,c)&&d}}return d&&0!=c.ab};t("H.util.EventTarget",N);N.prototype.la=N.prototype.la;N.prototype.setParentEventTarget=N.prototype.la;N.prototype.B=N.prototype.B;N.prototype.getParentEventTarget=N.prototype.B;N.prototype.addEventListener=N.prototype.addEventListener;N.prototype.addEventListener=N.prototype.addEventListener;N.prototype.removeEventListener=N.prototype.removeEventListener;N.prototype.removeEventListener=N.prototype.removeEventListener;N.prototype.dispatchEvent=N.prototype.dispatchEvent;
N.prototype.dispatchEvent=N.prototype.dispatchEvent;N.prototype.s=N.prototype.s;N.prototype.dispose=N.prototype.s;N.prototype.L=N.prototype.L;N.prototype.addOnDisposeCallback=N.prototype.L;N.prototype.P=N.prototype.N;
N.prototype.N=function(a,b,c){var d,e,f=!0;var g=c[c.currentTarget===c.target?"AT_TARGET":b?"CAPTURING_PHASE":(d=!0,"BUBBLING_PHASE")];if(!d||"pointerenter"!==(e=c.type)&&"pointerleave"!==e)c.eventPhase=g,f=N.prototype.P.apply(this,arguments),d&&this.B&&null===this.B()&&delete c.eventPhase;return f};N.prototype.Yb=function(a){for(var b,c=this;c&&(b=c.B())&&b!==a;)c=b;b||c.la(a)};N.prototype.setRootParentEventTarget=N.prototype.Yb;function Q(a){a=a||{};var b=a.callback;this.g=a.label;r(b)&&(this.callback=b);this.f=!!a.disabled;Q.U.constructor.call(this)}wa(Q,N);t("H.util.ContextItem",Q);Q.prototype.zb=function(){return this.g};Q.prototype.getLabel=Q.prototype.zb;Q.prototype.Xb=function(a){this.g!==a&&(this.g=a,this.dispatchEvent("update"));return this};Q.prototype.setLabel=Q.prototype.Xb;Q.prototype.Ob=function(){return this.f};Q.prototype.isDisabled=Q.prototype.Ob;
Q.prototype.Wb=function(a){a!==this.f&&(this.f=a,this.dispatchEvent("update"));return this};Q.prototype.setDisabled=Q.prototype.Wb;var Ge=new Q;Q.SEPARATOR=Ge;function Ie(a){if(Ca.document){var b=document.createElement("canvas");b.width=b.height=1;b.getContext("2d",{lc:a})}}t("H.util.getPixelRatio",function(){return window.devicePixelRatio||1});Object.create(Ia,void 0);t("H.util.eval",function(a){return eval(a)});t("H.util.provide",function(a){var b=p.$jscomp;if(b&&("function"!=typeof b.wb?0:b.wb()))throw Error("goog.provide cannot be used within a module.");la(a,void 0)});function Je(){this.m=0}
Je.prototype.next=function(a){if(9007199254740992===this.m)throw new Sd(a,this.m,[0,9007199254740991]);return this.m++};var Ke=new Je;Fa(Ke.next,Ke);function mc(){}var mb=Ha([]);Ha({});Ie(!0);Ie(!1);function Le(a,b,c){var d=Nb(+a,-90,90);if(b&&Ra(d))throw new y(b,c,a);return d}function Me(a,b,c){var d=+a;if(-180>d||180<d)d=Mb(d+180,360)-180;if(b&&Ra(d))throw new y(b,c,a);return d}function Ne(a,b,c){var d;if(a!==x&&Ra(d=+a)&&b)throw new y(b,c,a);return d}t("H.geo.isDBC",function(a,b){return 0>a!==0>b&&180<sb(b-a)});function R(){var a=R;if(!0===(Na(this,a)&&this.constructor===a))throw new TypeError("Illegal constructor "+Ua(a));}t("H.geo.AbstractGeometry",R);R.prototype.getBoundingBox=R.prototype.X;R.prototype.equals=R.prototype.F;R.prototype.oa="";R.prototype.va="";R.prototype.toString=function(){return this.eb([this.oa.toUpperCase()," "]).join("")};R.prototype.toString=R.prototype.toString;R.prototype.$b=function(){return{type:this.va,coordinates:this.cb()}};R.prototype.toGeoJSON=R.prototype.$b;
R.prototype.ta=function(){return{type:this.oa,coordinates:this.ua(),boundingBox:this.X().ta()}};R.prototype.forWorkerMessage=R.prototype.ta;function S(a,b,c){this.lat=Le(a,S,0);this.lng=Me(b,S,1);c!==x&&(this.alt=Ne(c,S,2))}wa(S,R);t("H.geo.Point",S);S.prototype.F=function(a){return this===a||!!a&&this.lat===a.lat&&this.lng===a.lng&&(this.alt||0)===(a.alt||0)};S.prototype.equals=S.prototype.F;S.prototype.ra=function(a){if(this===a||this.lat===a.lat&&this.lng===a.lng)a=0;else{var b=this.lat*Ib;var c=a.lat*Ib;a=1.274200158E7*yb(nb(1,ub(vb(xb((b-c)/2),2)+zb(b)*zb(c)*vb(xb((this.lng*Ib-a.lng*Ib)/2),2))))}return a};
S.prototype.distance=S.prototype.ra;
S.prototype.dc=function(a,b,c){var d;if(c){if(d=b/6371000.79){b=a*Ib;a=Ib*this.lat;var e=xb(a);c=xb(d);var f=zb(d);d=Ib*this.lng;var g=zb(a);a=yb(g*zb(b)*c+e*f);b=Cb(xb(b)*g*c,f-e*xb(a));b=(d+b+E)%(2*E)-E;b*=Kb;e=new S(a*Kb,(b+540)%360-180)}return e||this}a=(a%360+360)%360;if(0===(a+90)%180)return a=this.lng+b/(6371000.79*Gb*zb(this.lat*Ib))*(270===a?-360:360),new S(this.lat,(a+540)%360-180);if(b/=6371000.79)a*=Ib,e=this.lat*Ib,c=this.lng*Ib,d=e+b*zb(a),f=d-e,g=tb(Ab(d/2+Fb)/Ab(e/2+Fb)),g=Ra(f/g)?
zb(e):f/g,a=b*xb(a)/g,sb(d)>Eb&&(d=0<d?E-d:-(E+d)),d=new S(d*Kb,((c+a+Hb+(sb(e+f)>Eb?E:0))%Gb-E)*Kb);return d||this};S.prototype.walk=S.prototype.dc;S.prototype.X=function(){return new V(this.lat,this.lng,this.lat,this.lng)};S.prototype.getBoundingBox=S.prototype.X;function Oe(a,b,c){var d=oa(a)&&!(Ra(a.lat=Le(a.lat))||Ra(a.lng=Me(a.lng))||a.alt!==x&&Ra(a.alt=Ne(a.alt)));if(!d&&b)throw new y(b,c,a);return d}S.validate=Oe;function Pe(a){if(!a)throw new y(Pe,0,a);return new S(a.lat,a.lng,a.alt)}
S.fromIPoint=Pe;l=S.prototype;l.oa="Point";l.eb=function(a){a.push("(",this.lng," ",this.lat,")");return a};l.va="Point";l.cb=function(){return[this.lng,this.lat,this.alt||0]};l.ua=function(){return[this.lat,this.lng,this.alt||0]};function Qe(){}function Re(a){return nb(1,ob(0,.5-tb(Ab(Fb+Eb*a/180))/E/2))}Qe.prototype.ia=function(a,b,c){c?(c.x=b/360+.5,c.y=Re(a)):c=new F(b/360+.5,Re(a));return c};Qe.prototype.latLngToPoint=Qe.prototype.ia;Qe.prototype.tb=function(a,b){return this.ia(a.lat,a.lng,b)};Qe.prototype.geoToPoint=Qe.prototype.tb;function Se(a){return 0>=a?90:1<=a?-90:Kb*(2*Bb(wb(E*(1-2*a)))-Eb)}Qe.prototype.V=function(a,b,c){c?(c.lat=Se(b),c.lng=360*(1===a?1:Mb(a,1))-180):c=new S(Se(b),360*(1===a?1:Mb(a,1))-180);return c};
Qe.prototype.xyToGeo=Qe.prototype.V;Qe.prototype.Tb=function(a,b){return this.V(a.x,a.y,b)};Qe.prototype.pointToGeo=Qe.prototype.Tb;var Te=new Qe;t("H.geo.mercator",Te);t("H.util.constants.DEFAULT_MIN_ZOOM_LEVEL",0);t("H.util.constants.DEFAULT_MAX_ZOOM_LEVEL",22);function W(a,b){this.projection=a||Te;this.b=0;this.a=this.exp=tb(b||256)/Db;Ue(this);this.y=this.x=0}t("H.geo.PixelProjection",W);var Ve=sb(24)+sb(-8);W.prototype.Vb=Te;W.prototype.projection=W.prototype.Vb;W.prototype.x=0;W.prototype.x=W.prototype.x;W.prototype.y=0;W.prototype.y=W.prototype.y;W.prototype.cc=vb(2,Ve);W.prototype.w=W.prototype.cc;W.prototype.Jb=vb(2,Ve);W.prototype.h=W.prototype.Jb;
W.prototype.ba=function(a){if(Ra(a))throw new y(this.ba,0,a);var b=this.x/this.w;var c=this.y/this.h;this.b=a;this.a=this.exp+a;Ue(this);this.x=b*this.w;this.y=c*this.h};W.prototype.rescale=W.prototype.ba;function Ue(a){a.a>Ve&&(a.a=Ve);a.w=vb(2,a.a);a.h=vb(2,a.a)}W.prototype.Ta=function(){return this.b||0};W.prototype.getZoomScale=W.prototype.Ta;W.prototype.sb=function(a,b){a=this.projection.ia(a.lat,a.lng,b);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};W.prototype.geoToPixel=W.prototype.sb;
W.prototype.Fa=function(a,b){return this.projection.V((a.x+this.x)/this.w,(a.y+this.y)/this.h,b)};W.prototype.pixelToGeo=W.prototype.Fa;W.prototype.V=function(a,b,c){return this.projection.V((a+this.x)/this.w,(b+this.y)/this.h,c)};W.prototype.xyToGeo=W.prototype.V;W.prototype.Ba=function(a,b,c){a=this.projection.ia(a,b,c);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};W.prototype.latLngToPixel=W.prototype.Ba;W.prototype.Ub=function(a){return new F(a.x*this.w-this.x,a.y*this.h-this.y)};
W.prototype.pointToPixel=W.prototype.Ub;t("H.util.Disposable",J);J.prototype.L=J.prototype.L;J.prototype.addOnDisposeCallback=J.prototype.L;t("H.util.dispose",function(a){a&&"function"==typeof a.s&&a.s()});J.prototype.s=J.prototype.s;J.prototype.dispose=J.prototype.s;J.prototype.v=J.prototype.v;J.prototype.disposeInternal=J.prototype.v;function We(a,b,c,d){if(!a||!b||!c)throw new y(We,x,"Must specify name, version and revision parameter");this.name=a;this.version=b;this.revision=c;d&&Ba(this,d)}t("H.util.BuildInfo",We);We.prototype.toString=function(){var a,b=[];for(a in this)Qa(this[a])&&b.push(this[a]);return b.join(";")};var Xe={};function Ye(a,b,c,d){if(!a)throw new y(Ye,1,"Must specify a name parameter");return Xe[a]||(Xe[a]=new We(a,b,c,d))}We.get=Ye;function Y(a,b,c,d,e,f){if(a&&b)this.Ka(a),this.ka(b),this.Ia(c),this.Ja(e),this.bb(f),this.ma(d);else throw new y(Y,x,'Parameters "scheme" and "host" must be specified');}t("H.service.Url",Y);
function Ze(a,b){var c=Ca.document,d;var e="";if(c){e=c.createElement("a");if(b){var f=(d=c.getElementsByTagName("base")[0])&&d.href;var g=c.head;var h=d||g.appendChild(c.createElement("base"));h.href=b}e.href=a;e=e.href;b&&(d?d.href=f:g.removeChild(h))}else/[\\w]+:\\/\\//.test(a)&&(e=a);f=/(?:(\\w+):\\/\\/)?(?:([^:]+):([^@/]*)@)?([^/:]+)?(?:[:]{1}([0-9]+))?(\\/[^?#]*)?(\\?[^#]+)?(#.*)?/.exec(e);a=f[1];g=f[4];b=f[5];h=f[6];c=f[7];d=f[8];!f[2]&&g&&/@/.test(g)&&(g=g.split("@")[1]);f=Y;h=h&&0<h.length?h.substr(1):
"";e={};var k,m;if(c)for(k=/([?&]?([^=&+]+))(=([^&]+))?/g;m=k.exec(c);)e[decodeURIComponent(m[2])]=m[4]?decodeURIComponent(m[4]):void 0;return new f(a,g,h,e,isNaN(+b)?void 0:+b,d&&0<d.length?d.substr(1):"")}Y.parse=Ze;Y.prototype.clone=function(){var a={},b;for(b in this.a)a[b]=this.a[b];return new Y(this.i,this.g,this.b,a,this.f,this.c)};Y.prototype.clone=Y.prototype.clone;
Y.prototype.Ka=function(a){if(!a||"string"!==typeof a)throw new y(this.Ka,0,'The "scheme" parameter must be a non-empty string.');this.i=a;return this};Y.prototype.setScheme=Y.prototype.Ka;Y.prototype.Gb=function(){return this.i};Y.prototype.getScheme=Y.prototype.Gb;Y.prototype.ka=function(a){if(!a||"string"!==typeof a||"-"===a.charAt(0)||"."===a.charAt(0)||"."===a.charAt(a.length-1))throw new y(this.ka,0,'The "host" parameter is not a valid host name.');this.g=a;return this};
Y.prototype.setHost=Y.prototype.ka;Y.prototype.yb=function(){return this.g};Y.prototype.getHost=Y.prototype.yb;Y.prototype.Ia=function(a){this.b=a||void 0;return this};Y.prototype.setPath=Y.prototype.Ia;Y.prototype.Db=function(){return this.b};Y.prototype.getPath=Y.prototype.Db;Y.prototype.ma=function(a){if(a)if("object"==typeof a)this.a=a;else throw new y(this.ma,0,'Parameter "params" must be an object.');else this.a={};return this};Y.prototype.setQuery=Y.prototype.ma;Y.prototype.Kb=function(){return!$e(this)};
Y.prototype.hasQuery=Y.prototype.Kb;Y.prototype.getQuery=function(){return this.a};Y.prototype.getQuery=Y.prototype.getQuery;Y.prototype.Ja=function(a){if(void 0===a)this.f=a;else{var b=Nb(+a<<0,0,65535);if(b!=a)throw new y(this.Ja,0,'Parameter "port" must be an integer in range [0...65535]');this.f=b}return this};Y.prototype.setPort=Y.prototype.Ja;Y.prototype.Eb=function(){return this.f};Y.prototype.getPort=Y.prototype.Eb;Y.prototype.bb=function(a){this.c=a||void 0;return this};
Y.prototype.setAnchor=Y.prototype.bb;Y.prototype.ub=function(){return this.c};Y.prototype.getAnchor=Y.prototype.ub;Y.prototype.R=function(a){if("object"!==typeof a)throw new y(this.R,0,'Parameter "other" must be an object.');var b=this.a,c;for(c in a)a.hasOwnProperty(c)&&"function"!==typeof a[c]&&(b[c]=a[c]);return this};Y.prototype.mergeQuery=Y.prototype.R;
Y.prototype.Na=function(a){if(!a||"string"!==typeof a)throw new y(this.Na,0,'Parameter "subDomain" must be a non-empty string');"."===a.substr(a.length-1)&&(a=a.substr(0,a.length-1));return this.ka(a+"."+this.g)};Y.prototype.addSubDomain=Y.prototype.Na;Y.prototype.Oa=function(a){if(!a||"string"!==typeof a)throw new y(this.Oa,0,'Parameter "subPath" must be a non-empty string');return this.Ia((this.b?this.b+"/":"")+a)};Y.prototype.addSubPath=Y.prototype.Oa;
Y.prototype.toString=function(){return[this.i+"://",this.g,this.f?":"+this.f:"",this.b||!$e(this)||this.c?"/":"",this.b?encodeURI(this.b):"",af(this),this.c?"#"+encodeURIComponent(this.c):""].join("")};Y.prototype.toString=Y.prototype.toString;function bf(a){return encodeURIComponent(a).replace(/[!'()*]/g,function(b){return"%"+b.charCodeAt(0).toString(16)})}
function af(a){var b=[],c=a.a,d={},e;for(e in c){if(c.hasOwnProperty(e)&&"function"!==typeof c[e]){var f=a.a[e];d.K=bf(e);Na(f,cf)?f.a.forEach(function(g){return function(h){b.push(g.K+"="+bf(h))}}(d)):Na(f,df)?b.push(d.K+"="+f.b.map(function(g){return bf(g)}).join(f.a)):b.push(void 0===f?d.K:d.K+"="+bf(f))}d={K:d.K}}return 0<b.length?"?"+b.join("&"):""}function $e(a){var b,c=0;for(b in a.a)if(a.a.hasOwnProperty(b)&&"function"!==typeof a.a[b]&&(c++,0<c))break;return!c}
function ef(a,b){if(Oa(a,void 0,void 0,void 0))for(var c=0;c<a.length;c++){var d=a[c];if(!Qa(d)&&!Sa(d)){var e="The Array does not contain only strings and numbers";break}}else e="Not an Array";if(e)throw new y(b,0,a);return a}function cf(a){this.a=ef(a,cf)}Y.MultiValueQueryParameter=cf;cf.prototype.Ib=function(){return this.a};cf.prototype.getValues=cf.prototype.Ib;function df(a,b){this.b=ef(a,df);if(!/^[!\\$\\(\\)\\*\\+,;]$/.test(b))throw new y(df,1,'Invalid delimiter "'+b+'"');this.a=b}
Y.DelimitedQuerySubValues=df;var ff={};function gf(a){try{importScripts.apply(self,arguments)}catch(b){this.postError("invalid_script")}}function hf(a){delete ff[a];this.postMessage(a)}function jf(a,b,c){if(r(b))var d=b;else try{d=self.eval("("+b+")"),r(d)||(d=null)}catch(e){}d?(ff[a]=d,c||this.postMessage(a)):this.postError("invalid_processor")}function kf(a){this.b=a&&a[0];this.a=a&&a[1];this.c=a&&a[2]||[]}kf.prototype.postError=function(a){this.postMessage(a,x,0)};
kf.prototype.postMessage=function(a,b,c){self.postMessage({processor:this.b,taskId:this.a,type:c===x?1:c,data:a},b||x)};function lf(a,b,c){if(!Qa(a))throw new y(lf,0,"InvalidArgument");if(!r(b))throw new y(lf,1,"InvalidArgument");var d=mf++;nf[d]={mimeType:c||of,ob:b};(new kf(["3",d,[]])).postMessage(a,[],2)}var nf={},mf=0;
function pf(a,b){var c=a;if(nf[this.a]){var d=nf[this.a];var e=d.ob;delete nf[this.a];if(b)e(null,b);else{if(d.mimeType===qf){a=new Uint8Array(a);b=a.byteLength;d="";c=0;for(var f,g,h,k;c<b;)f=a[c++],192>f||(g=a[c++],224>f?f=(f&31)<<6|g&63:(h=a[c++],240>f?f=(f&15)<<12|(g&63)<<6|h&63:(k=a[c++],f=(f&7)<<18|(g&63)<<12|(h&63)<<6|k&63))),65536>f?d+=String.fromCharCode(f):(f-=65536,d+=String.fromCharCode((f>>10)+55296,(f&1023)+56320));c=d}e(c)}}}var of=0,qf=1;function V(a,b,c,d){rf(this,Le(a,V,0),Me(b,V,1),Le(c,V,2),Me(d,V,3))}wa(V,R);t("H.geo.Rect",V);V.prototype.oa="Polygon";V.prototype.eb=function(a){var b=this.f,c=this.a,d=this.c,e=this.b;a.push("(","(",c," ",b,",",e," ",b,",",e," ",d,",",c," ",d,",",c," ",b,")",")");return a};V.prototype.F=function(a){var b=this===a;!b&&Na(a,V)&&(b=this.f===a.f&&this.a===a.a&&this.c===a.c&&this.b===a.b);return b};V.prototype.equals=V.prototype.F;
V.prototype.clone=function(){return new V(this.f,this.a,this.c,this.b)};V.prototype.clone=V.prototype.clone;function rf(a,b,c,d,e){a.a=c;a.b=e;b<d&&(c=b,b=d,d=c);a.f=b;a.c=d;a.j=a.g=a.i=null;return a}V.prototype.Sa=function(){this.j||(this.j=new S(this.f,this.a));return this.j};V.prototype.getTopLeft=V.prototype.Sa;V.prototype.Ra=function(){this.g||(this.g=new S(this.c,this.b));return this.g};V.prototype.getBottomRight=V.prototype.Ra;V.prototype.Hb=function(){return this.f};V.prototype.getTop=V.prototype.Hb;
V.prototype.vb=function(){return this.c};V.prototype.getBottom=V.prototype.vb;V.prototype.Ab=function(){return this.a};V.prototype.getLeft=V.prototype.Ab;V.prototype.Fb=function(){return this.b};V.prototype.getRight=V.prototype.Fb;V.prototype.G=function(){this.i||(this.i=new S(this.c+(this.f-this.c)/2,sf(this.a,this.I())));return this.i};V.prototype.getCenter=V.prototype.G;V.prototype.I=function(){return tf(this.a,this.b)};V.prototype.getWidth=V.prototype.I;
V.prototype.O=function(){return this.f-this.c};V.prototype.getHeight=V.prototype.O;V.prototype.Nb=function(){return this.a>this.b};V.prototype.isCDB=V.prototype.Nb;V.prototype.Pb=function(){return!this.I()&&!this.O()};V.prototype.isEmpty=V.prototype.Pb;V.prototype.X=function(){return new V(this.f,this.a,this.c,this.b)};V.prototype.getBoundingBox=V.prototype.X;
V.prototype.ea=function(a,b,c){var d=this.G();c||(a=Le(a,this.ea,0),b=Me(b,this.ea,1));b=this.J(a,b,c);a=b.G();return a.lat===d.lat&&a.lng===d.lng&&this.O()===b.O()&&this.I()===b.I()};V.prototype.containsLatLng=V.prototype.ea;V.prototype.fa=function(a,b){b||Oe(a,this.fa,0);return this.ea(a.lat,a.lng,b)};V.prototype.containsPoint=V.prototype.fa;
V.prototype.Qa=function(a,b){var c=this.G();if(!b&&!Na(a,V))throw new y(this.Qa,0,a);b=this.ja(a,b);a=b.G();return a.lat===c.lat&&a.lng===c.lng&&this.O()===b.O()&&this.I()===b.I()};V.prototype.containsRect=V.prototype.Qa;V.prototype.J=function(a,b,c,d){if(!c){if(Ra(a=Le(a)))throw new y(this.J,0,a);if(Ra(b=Me(b)))throw new y(this.J,1,b);}return uf(this.f,this.a,this.c,this.b,a,b,a,b,d)};V.prototype.mergeLatLng=V.prototype.J;
V.prototype.Ya=function(a,b,c){b||Oe(a,this.Ya,0);return this.J(a.lat,a.lng,b,c)};V.prototype.mergePoint=V.prototype.Ya;V.prototype.ja=function(a,b,c){if(!b&&!Na(a,V))throw new y(this.ja,0,a);return uf(this.f,this.a,this.c,this.b,a.f,a.a,a.c,a.b,c)};V.prototype.mergeRect=V.prototype.ja;V.prototype.$=function(a,b,c,d,e,f){e||(a=Le(a,this.$,0),b=Me(b,this.$,1),c=Le(c,this.$,2),d=Me(d,this.$,3));return uf(this.f,this.a,this.c,this.b,a,b,c,d,f)};V.prototype.mergeTopLeftBottomRight=V.prototype.$;
V.prototype.Va=function(a,b){var c=this.a<=this.b,d=a.a<=a.b,e=this.a<a.b,f=a.a<this.b;if(!b&&!Na(a,V))throw new y(this.Va,0,a);return this.c<=a.f&&a.c<=this.f&&(!c&&(!d||e||f)||!d&&(e||f)||e&&f)};V.prototype.intersects=V.prototype.Va;function tf(a,b){a=b-a;return a+(0>a?360:0)}function sf(a,b){a+=b/2;return a-(180<a?360:0)}
function uf(a,b,c,d,e,f,g,h,k){c=nb(c,g);a=ob(a,e);e=tf(b,d);var m=sf(b,e);g=tf(f,h);var n=sf(f,g)-m;n+=0>n-1E-6?360:0;if(180>n-1E-6){m=b;var q=h}else n=360-n,m=f,q=d;n=n+e/2+g/2;360<=n+5E-7?(m=-180,q=180):n-5E-7<e?(m=b,q=d):n-5E-7<g&&(m=f,q=h);return k?rf(k,a,m,c,q):new V(a,m,c,q)}V.merge=uf;function vf(a,b,c){c||(Oe(a,vf,0),Oe(b,vf,1));return new V(a.lat,a.lng,b.lat,b.lng)}V.fromPoints=vf;
function wf(a,b){var c=1,d=a.length,e=null;var f=na(a);if("array"!=f&&("object"!=f||"number"!=typeof a.length))throw new y(wf,0,a);if(0<d)for(f=a[0],e=vf(f,f,b);c<d;c++)f=a[c],e.J(f.lat,f.lng,b,e);return e}V.coverPoints=wf;function xf(a,b){var c=3,d=a.length,e;if(!(b||a&&null!=a.length))throw new y(xf,0,a);if(0<d)for(e=new V(a[0],a[1],a[0],a[1]);c<d;c+=3)e.J(a[c],a[c+1],b,e);return e}V.coverLatLngAlts=xf;
function yf(a,b){var c=1,d=a.length,e;if(b&&(!a||null==a.length))throw new y(yf,0,a);if(0<d)for(e=new V(a[0].f,a[0].a,a[0].c,a[0].b);c<d;c++)e.ja(a[c],b,e);return e}V.coverRects=yf;
V.prototype.$a=function(a,b){var c=this.a,d=this.f,e=this.b,f=this.c,g=this.G().lng;Oe(a,this.$a,0);var h=a.lat-f-(d-f)/2;var k=a.lng-g;k=180<k||-180>k?-(g+a.lng):k;a=c+(0>k?2*k:0);a=-180>a?360+a:a;e+=0<k?2*k:0;e=180<e?e-360:e;d=0<h?d+2*h:d;90<=d&&(d=90);f=0>h?f+2*h:f;-90>=f&&(f=-90);return b?rf(b,d,a,f,e):new V(d,a,f,e)};V.prototype.resizeToCenter=V.prototype.$a;V.prototype.va="Polygon";
V.prototype.cb=function(){return[[this.a,this.f,0],[this.b,this.f,0],[this.b,this.c,0],[this.a,this.c,0],[this.a,this.f,0]]};V.prototype.ta=function(){return this.ua()};V.prototype.ua=function(){return[this.f,this.a,this.c,this.b]};function zf(a,b,c,d){this.key="";this.x=a;this.y=b;this.b=c;this.Y=d;this.a=Ad()}zf.prototype.then=function(a,b,c){return this.a.a.then(a,b,c)};zf.prototype.reject=function(a){this.a.reject(a)};zf.prototype.cancel=function(){this.a.a.cancel()};zf.prototype.cancel=zf.prototype.cancel;function Af(a,b,c,d){var e=!!c,f,g=0,h=0,k=0,m=0,n=0,q,u=-1;var I=Ca.Float32Array;var L,w=[];if(b){b=Ja(b);a=Ja(a);e&&(f=Ja(c));c=b.length;d=d?1E-7:1E-5;for(L=new I(3*c);g<c;){I=b[g];var G=+I;var X=+a[g];e&&(q=+f[g]);Bf.test(I)?0<=u&&(0<g-u&&w.push(u,g+1),u=-1):0>u&&(u=g);g++;m=L[h++]=m+X*d;k=L[h++]=k+G*d;e&&(n=L[h]=n+q);h++}0<=u&&1<c-u&&w.push(u,c)}else L=new I(0);return{path:L,outlineIndices:w}}var Bf=/^-?0\\d/;
function Cf(a,b){for(var c=0,d=a.length/3,e=new Ca.Array(d),f=0;c<d;)e[c++]=b.Ba(a[f],a[++f]),f+=2;return e};function Df(a,b){b=180/(1<<b);var c=a.lat+90;a=(a.lng+180)%360;var d=0;180==c&&d--;d+=Math.floor(c/b);return[d,Math.floor(a/b)]}var Ef=1/Math.pow(10,10);function Ff(a,b){var c=[],d=a.Sa();a=a.Ra();var e;180==a.lng&&(a.lng-=Ef);d=Df(d,b);a=Df(a,b);for(e=d[0];e>=a[0];e--)for(b=d[1];b<=a[1];b++)c.push(e,b);return c};function Gf(a,b){var c=a.tileSize||256;this.b={};this.j=Ze(a.serverUrl);this.g=b;this.fb=a.layerConfigs||[];this.i=a.projected;this.P=c;this.Ea=!1!==a.batchTiles;this.bc=a.horizontalMargin||0;this.gb=a.onlyOutline;this.ib=new W(x,c);this.f=new W(x,c);this.f.ba(22-Math.log(c)/Math.LN2+8)}wa(Gf,J);
Gf.prototype.kb=function(a,b,c){var d=this.P,e=this.bc,f={x:a*d-e,y:b*d};d={x:(a+1)*d-1+e,y:(b+1)*d-1};e=this.ib;e.ba(c);f=e.Fa(f);d=e.Fa(d);return Hf(this,new V(f.lat,f.lng,d.lat,d.lng),this.fb,{x:a,y:b,z:c})};Gf.prototype.jb=function(a,b,c,d,e){return Hf(this,new V(a,b,c,d),e)};
function Hf(a,b,c,d){var e=If(c),f=e.length,g={},h,k=a.b,m=[],n=[];for(c=0;c<f;c++){var q=e[c];var u=q.layerId;var I=q.level;g[u]=q.columns;q=Ff(b,I);var L=q.length-1;for(h=0;h<L;h+=2){var w=[u,q[h+1],q[h],I].join("_");var G=k[w]||a.g.get(w);G||(G=new zf(q[h+1],q[h],I,u),G.key=w,k[w]=G,n.push(G));m.push(G)}}n.length&&(a.Ea?Jf(a,n):Kf(a,n));return zd(m.map(function(X){return X.then(Fa(this.Ga,this,X.Y,Lf(e))).then(Fa(this.hb,this,X,d||Mf)).then(Fa(this.ac,this,g[X.Y]))},a))}var Mf={x:0,y:0,z:0};
Gf.prototype.Ga=function(a,b,c){var d=c.Rows,e=d.length,f,g;if(e&&(f=b[a])){b=new C(c.Rows);var h=[];for(g=0;g<e;g++){var k=d[g];f(b.ga(g),a)&&h.push(k)}a={Rows:h};if(c=c.Meta)a.Meta=c}else a=c;return a};function Kf(a,b){function c(k,m,n){n?(delete a.b[k.key],k.reject(n)):Nf(a,k,m)}var d,e=b.length,f=a.j;for(d=0;d<e;d++){var g=b[d];var h=f.clone().R({tilex:g.x}).R({tiley:g.y}).R({level:g.b}).R({layer:g.Y});new lf(h.toString(),Fa(c,null,g),qf)}}
function Jf(a,b){var c=b.length,d;for(d=0;d<c;d+=15){var e=b.slice(d,d+15);Of(a,e)}}function Of(a,b){var c=a.j.clone(),d=[],e=[],f=[],g=c.getQuery();b.length&&(b.forEach(function(h){d.push(h.x,h.y);e.push(h.b);f.push(h.Y)}),g.tilexy=d.join(","),g.layers=f.join(","),g.levels=e.join(","),c.ma(g),new lf(c.toString(),function(h,k){k?b.forEach(function(m){delete a.b[m.key];m.reject("error")}):Nf(a,b,h)},qf))}
function Nf(a,b,c){var d=b.length,e;if(Oa(b,void 0,void 0,void 0)){var f=c.indexOf("[")+1;for(e=0;e<d;e++){var g=c.indexOf("]},{",f+3)+2;g<f&&(g=c.lastIndexOf("]}"));var h=c.substr(f,g-f);f=g+1;Pf(a,b[e],h)}}else Pf(a,b,c)}function Pf(a,b,c){try{var d=c.length;var e=b.key;delete a.b[e];a.g.add(e,b,2*d);var f=JSON.parse(c);b.a.b(f)}catch(g){b.reject(g.message)}}
function Lf(a){var b={},c,d=a.length;for(c=0;c<d;c++){var e=a[c];if(e.rowFilter){var f=e.layerId;f=f!==x?f:e.layer;b[f]=Fa(e.rowFilter,e.rowFilterContext)}}return b}function Qf(a,b,c,d,e){return e?[new F(a,b),new F(c,b),new F(c,d),new F(a,d),new F(a,b)]:[a,b,c,b,c,d,a,d]}
Gf.prototype.hb=function(a,b,c){var d=this.f.Ta()-b.z,e=this.P<<d,f=50<<d,g=b.x*e;b=b.y*e;var h=g+e;e=b+e;var k=g-f,m=b-f,n=h+f;f=e+f;var q,u,I=c.Rows,L=I.length,w,G=/^ADAS/.test(a.Y),X=this.f,qa=this.gb,O,bb=[],Ka=[],La=[],cb=[];for(a=0;a<L;a++){var z=w=I[a];var T=(O=G)?"HPY":"LAT";var U=O?"HPX":"LON";var da=O?"HPZ":"ZLEVEL";if(z[T]){var P=Af(z[T],z[U],z[da],O);z.geometry=P;delete z[T];delete z[U];delete z[da];if(z.INNER_LAT)for(T=z.INNER_LAT.split(";"),P=z.INNER_LON.split(";"),delete z.INNER_LAT,
delete z.INNER_LON,z.interiors=da=[],U=T.length,z=0;z<U;z++)da.push(Af(T[z],P[z],"",O))}if(this.i){U=w;z=X;P=U.$$projected$$;T=0;if(!P){var Z=U.geometry;O=Cf(Z.path,z);w=[O];U.$$projected$$=P={Sb:w};U=(da=U.interiors)?da.length:0;w.length+=U;T|=+Rf(w,O,Z.outlineIndices);if(U)for(P.Lb=1,q=0;q<U;q++)Z=da[q],O=Cf(Z.path,z),w[1+q]=O,T|=+Rf(w,O,Z.outlineIndices);T&&(P.Qb=1+U)}z=P;O=z.Sb;w=z.Lb;var Fc=z.Qb;P=[];T=U=Lb;var db=da=x;z=O[0];if(1===z.length){var Gc=Gc||(Gc=Qf(g,b,h,e,!1));w=z[0];Rb(w.x,w.y,
Gc)&&P.push(Sf(z,g,b,d))}else{var He=O.length;for(Z=qa?Fc:0;Z<He&&(qa||!Z||P.length);Z++)if(z=O[Z],Z>=Fc){Z===Fc&&(T=P.length);var ia=Ub([z],k,m,n,f,!1);Tf(ia,g,b,d,P)}else{var Jb=Jb||(Jb=Qf(k,m,n,f,!0));if(Z>=w)if(Z===w&&(U=P.length),db)for(q=db.length;q--;){if(ia=Uf(db[q],z),u=ia.length){for(da=da||[];u--;)da.push(q);Tf(ia,g,b,d,P)}}else ia=Uf(Jb,z),Tf(ia,g,b,d,P);else if(ia=Uf(Jb,z),Tf(ia,g,b,d,P),1<ia.length&&w<He)for(db=[],q=ia.length;q--;)db[q]=ia[q]}}P.length&&(bb[a]=P,Ka[a]=U,La[a]=da,cb[a]=
T)}}return{Zb:c,pb:bb,Mb:Ka,rb:La,Rb:cb}};function Rf(a,b,c){for(var d=c.length,e=0,f,g,h=b.length;e<d;)f=c[e++],g=c[e++],a.push(g-f===h?b:b.slice(f,g));return 0<c.length}function Uf(a,b){var c,d=[];if(c=Wb(a,b)){do{a=[];b=c;do a.push(b);while(b=b.next);d.push(a)}while(c=c.Za)}else Sb(b[0],Tb(a))?d.push(b):Sb(a[0],Tb(b))&&d.push(a);return d}function Tf(a,b,c,d,e){for(var f=0,g=a.length;f<g;f++)e.push(Sf(a[f],b,c,d))}
function Sf(a,b,c,d){var e,f=a.length,g=new Int32Array(2*f),h=0;for(e=0;e<f;e++){var k=a[e];g[h++]=k.x-b>>d;g[h++]=k.y-c>>d}return g}
Gf.prototype.ac=function(a,b){var c=b.Zb,d=b.pb,e=b.Mb,f=b.Rb;b=b.rb;for(var g=[],h,k={Rows:g},m,n=a?a.length:0,q=0,u,I=c.Rows,L=I.length,w;q<L;q+=1)if(d[q]||!this.i){h={};u=I[q];if(n)for(m=0;m<n;m++)u.hasOwnProperty(a[m])&&(h[a[m]]=u[a[m]]);else for(w in u)"$$projected$$"!==w&&(h[w]=u[w]);u.geometry&&(h.geometry=u.geometry);m=void 0;var G,X=h,qa=d[q],O=e[q],bb=b[q],Ka=f[q],La=g;if(qa){var cb=qa.length;if(bb)for(G=O;G--;){if(G){var z={};for(m in X)z[m]=X[m]}else z=X;u=[qa[G]];var T=nb(cb,Ka)-O;for(h=
0;h<T;h++)bb[h]===G&&u.push(qa[O+h]);T=u.length;if(!G)for(h=Ka;h<cb;h++)u.push(qa[h]);z.$HProjGeometry={paths:u,interiorsIndex:1,outlinesIndex:T};La.push(z)}else X.$HProjGeometry={paths:qa,interiorsIndex:O,outlinesIndex:Ka},La.push(X)}else La.push(X)}c.Meta&&(k.Meta=c.Meta);return k};Gf.prototype.v=function(){var a,b=this.b;for(a in b)b.hasOwnProperty(a)&&(b[a].reject("disposed"),delete b[a])};Gf.prototype.disposeInternal=Gf.prototype.v;
function If(a){for(var b=[],c,d=a.length,e=0;e<d;e++){c=za(a[e]);if(c.rowFilter&&(c.rowFilter=eval("("+c.rowFilter+")"),!r(c.rowFilter)))throw Error("Invalid row filter for layer "+c.layerId);b.push(c)}return b};t("H.service.extension.worker.processor",function(a,b,c){function d(h){e.postMessage(h)}var e=this,f=ya[a];var g=function(h){e.postError(h.toString())};if(0===b)f||(ya[a]=new Gf(c,Vf)),this.postMessage(void 0);else if(f)switch(b){case 1:try{f.kb.apply(f,c).then(d,g)}catch(h){this.postError(h.message)}break;case 2:try{f.jb.apply(f,c).then(d,g)}catch(h){this.postError(h.message)}break;case 3:f.s();delete ya[a];xa()&&Vf.S();break;default:e.postError("Unsupported command")}});
var Vf=new A(26214400),ya=Object.create(Ia,void 0);function Wf(a,b,c){var d=a[b];a=a[b+1];this.Ua=[];this.La=0;this.b=b;this.a=[a-c,d-c,a+c,d+c]}Wf.prototype.fa=function(a,b){var c=a[b];a=a[b+1];b=this.a;return b[1]<=c&&c<=b[3]&&b[0]<=a&&a<=b[2]};Wf.prototype.G=function(){return this.b};var Xf=new F(0,0);function Yf(a,b,c,d,e){d[e]=b;d[e+1]=a}var Zf=new W;function $f(a,b,c,d,e){Zf.Ba(a,b,Xf);d[e]=Xf.x;d[e+1]=Xf.y}
t("H.clustering.dynamicgrid.worker",function(a,b,c,d,e){var f=e?Yf:$f,g=0;e=!!self.ArrayBuffer;var h=a.byteLength?new Float64Array(a):a,k=h.length/3;a=[];var m=[],n=[],q=e?new Float64Array(2*k):[];k=0;var u=0;for(Zf.ba(d);g<h.length;){var I=h[g++];var L=h[g++];var w=h[g++];f(w,L,d,q,u);for(w=a.length;w--;)if(L=a[w],L.fa(q,u)){var G=L;break}G||(G=new Wf(q,u,b),a.push(G));w=u/2;G.La+=I||1;G.Ua.push(w);G=null;u+=2}for(w=a.length;w--;)L=a[w],b=L.La>=c,f=L.Ua,d=f.length,b?(m.push(d),m=m.concat(f)):
(k+=d,n=n.concat(f));c=[k].concat(n,m);c=e?(new Uint32Array(c)).buffer:c;this.postMessage(c,[c])});self.addEventListener("message",function(a){a=new kf(a.data);var b=ff[a.b];if(b)try{b.apply(a,a.c)}catch(c){a.postError(c.message)}else a.postError("processor_not_found")});(function(){var a=new kf;var b=function(c,d){jf.apply(a,[c,d,!0])};b("0",gf);b("1",jf);b("2",hf);b("3",pf)})();
`,function(){var f=function(){var target=(typeof self>"u"||!(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope))&&(typeof module<"u"&&module.exports||typeof window<"u"),__worker_src__,__worker_src_map__,__worker_src_origin__;target&&(__worker_src__=f.toString(),__worker_src_map__="",__worker_src_origin__=typeof document<"u"&&document.currentScript instanceof HTMLScriptElement?document.currentScript.src:""),function(){var toString={}.toString,classofRaw=function(e){return toString.call(e).slice(8,-1)},commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function createCommonjsModule(e,r){return e(r={exports:{}},r.exports),r.exports}var O="object",check=function(e){return e&&e.Math==Math&&e},global_1=check(typeof globalThis==O&&globalThis)||check(typeof window==O&&window)||check(typeof self==O&&self)||check(typeof commonjsGlobal==O&&commonjsGlobal)||Function("return this")(),fails=function(e){try{return!!e()}catch{return!0}},descriptors=!fails(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7}),isObject=function(e){return typeof e=="object"?e!==null:typeof e=="function"},document$1=global_1.document,exist=isObject(document$1)&&isObject(document$1.createElement),documentCreateElement=function(e){return exist?document$1.createElement(e):{}},ie8DomDefine=!descriptors&&!fails(function(){return Object.defineProperty(documentCreateElement("div"),"a",{get:function(){return 7}}).a!=7}),anObject=function(e){if(!isObject(e))throw TypeError(String(e)+" is not an object");return e},toPrimitive=function(e,r){if(!isObject(e))return e;var n,o;if(r&&typeof(n=e.toString)=="function"&&!isObject(o=n.call(e))||typeof(n=e.valueOf)=="function"&&!isObject(o=n.call(e))||!r&&typeof(n=e.toString)=="function"&&!isObject(o=n.call(e)))return o;throw TypeError("Can't convert object to primitive value")},nativeDefineProperty=Object.defineProperty,f=descriptors?nativeDefineProperty:function(e,r,n){if(anObject(e),r=toPrimitive(r,!0),anObject(n),ie8DomDefine)try{return nativeDefineProperty(e,r,n)}catch{}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[r]=n.value),e},objectDefineProperty={f},createPropertyDescriptor=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}},hide=descriptors?function(e,r,n){return objectDefineProperty.f(e,r,createPropertyDescriptor(1,n))}:function(e,r,n){return e[r]=n,e},setGlobal=function(e,r){try{hide(global_1,e,r)}catch{global_1[e]=r}return r},isPure=!1,shared=createCommonjsModule(function(e){var r="__core-js_shared__",n=global_1[r]||setGlobal(r,{});(e.exports=function(o,s){return n[o]||(n[o]=s!==void 0?s:{})})("versions",[]).push({version:"3.1.0",mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})}),id=0,postfix=Math.random(),uid=function(e){return"Symbol(".concat(e===void 0?"":e,")_",(++id+postfix).toString(36))},nativeSymbol=!fails(function(){return!String(Symbol())}),store=shared("wks"),Symbol$1=global_1.Symbol,wellKnownSymbol=function(e){return store[e]||(store[e]=nativeSymbol&&Symbol$1[e]||(nativeSymbol?Symbol$1:uid)("Symbol."+e))},TO_STRING_TAG=wellKnownSymbol("toStringTag"),CORRECT_ARGUMENTS=classofRaw(function(){return arguments}())=="Arguments",tryGet=function(e,r){try{return e[r]}catch{}},classof=function(e){var r,n,o;return e===void 0?"Undefined":e===null?"Null":typeof(n=tryGet(r=Object(e),TO_STRING_TAG))=="string"?n:CORRECT_ARGUMENTS?classofRaw(r):(o=classofRaw(r))=="Object"&&typeof r.callee=="function"?"Arguments":o},TO_STRING_TAG$1=wellKnownSymbol("toStringTag"),test={};test[TO_STRING_TAG$1]="z";var objectToString=String(test)!=="[object z]"?function(){return"[object "+classof(this)+"]"}:test.toString,hasOwnProperty={}.hasOwnProperty,has=function(e,r){return hasOwnProperty.call(e,r)},functionToString=shared("native-function-to-string",Function.toString),WeakMap=global_1.WeakMap,nativeWeakMap=typeof WeakMap=="function"&&/native code/.test(functionToString.call(WeakMap)),shared$1=shared("keys"),sharedKey=function(e){return shared$1[e]||(shared$1[e]=uid(e))},hiddenKeys={},WeakMap$1=global_1.WeakMap,set,get,has$1,enforce=function(e){return has$1(e)?get(e):set(e,{})},getterFor=function(e){return function(r){var n;if(!isObject(r)||(n=get(r)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}},store$1,wmget,wmhas,wmset,set,get,has$1,STATE;has$1=nativeWeakMap?(store$1=new WeakMap$1,wmget=store$1.get,wmhas=store$1.has,wmset=store$1.set,set=function(e,r){return wmset.call(store$1,e,r),r},get=function(e){return wmget.call(store$1,e)||{}},function(e){return wmhas.call(store$1,e)}):(STATE=sharedKey("state"),hiddenKeys[STATE]=!0,set=function(e,r){return hide(e,STATE,r),r},get=function(e){return has(e,STATE)?e[STATE]:{}},function(e){return has(e,STATE)});var internalState={set,get,has:has$1,enforce,getterFor},redefine=createCommonjsModule(function(e){var r=internalState.get,n=internalState.enforce,o=String(functionToString).split("toString");shared("inspectSource",function(s){return functionToString.call(s)}),(e.exports=function(s,l,h,d){var y=!!d&&!!d.unsafe,g=!!d&&!!d.enumerable,v=!!d&&!!d.noTargetGet;typeof h=="function"&&(typeof l!="string"||has(h,"name")||hide(h,"name",l),n(h).source=o.join(typeof l=="string"?l:"")),s!==global_1?(y?!v&&s[l]&&(g=!0):delete s[l],g?s[l]=h:hide(s,l,h)):g?s[l]=h:setGlobal(l,h)})(Function.prototype,"toString",function(){return typeof this=="function"&&r(this).source||functionToString.call(this)})}),ObjectPrototype=Object.prototype;objectToString!==ObjectPrototype.toString&&redefine(ObjectPrototype,"toString",objectToString,{unsafe:!0});var ceil=Math.ceil,floor=Math.floor,toInteger=function(e){return isNaN(e=+e)?0:(0<e?floor:ceil)(e)},requireObjectCoercible=function(e){if(e==null)throw TypeError("Can't call method on "+e);return e},stringAt=function(e,r,n){var o,s,l=String(requireObjectCoercible(e)),h=toInteger(r),d=l.length;return h<0||d<=h?n?"":void 0:(o=l.charCodeAt(h))<55296||56319<o||h+1===d||(s=l.charCodeAt(h+1))<56320||57343<s?n?l.charAt(h):o:n?l.slice(h,h+2):s-56320+(o-55296<<10)+65536},nativePropertyIsEnumerable={}.propertyIsEnumerable,nativeGetOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,NASHORN_BUG=nativeGetOwnPropertyDescriptor&&!nativePropertyIsEnumerable.call({1:2},1),f$1=NASHORN_BUG?function(e){var r=nativeGetOwnPropertyDescriptor(this,e);return!!r&&r.enumerable}:nativePropertyIsEnumerable,objectPropertyIsEnumerable={f:f$1},split="".split,indexedObject=fails(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return classofRaw(e)=="String"?split.call(e,""):Object(e)}:Object,toIndexedObject=function(e){return indexedObject(requireObjectCoercible(e))},nativeGetOwnPropertyDescriptor$1=Object.getOwnPropertyDescriptor,f$2=descriptors?nativeGetOwnPropertyDescriptor$1:function(e,r){if(e=toIndexedObject(e),r=toPrimitive(r,!0),ie8DomDefine)try{return nativeGetOwnPropertyDescriptor$1(e,r)}catch{}if(has(e,r))return createPropertyDescriptor(!objectPropertyIsEnumerable.f.call(e,r),e[r])},objectGetOwnPropertyDescriptor={f:f$2},min=Math.min,toLength=function(e){return 0<e?min(toInteger(e),9007199254740991):0},max=Math.max,min$1=Math.min,toAbsoluteIndex=function(e,r){var n=toInteger(e);return n<0?max(n+r,0):min$1(n,r)},arrayIncludes=function(e){return function(r,n,o){var s,l=toIndexedObject(r),h=toLength(l.length),d=toAbsoluteIndex(o,h);if(e&&n!=n){for(;d<h;)if((s=l[d++])!=s)return!0}else for(;d<h;d++)if((e||d in l)&&l[d]===n)return e||d||0;return!e&&-1}},arrayIndexOf=arrayIncludes(!1),objectKeysInternal=function(e,r){var n,o=toIndexedObject(e),s=0,l=[];for(n in o)!has(hiddenKeys,n)&&has(o,n)&&l.push(n);for(;r.length>s;)has(o,n=r[s++])&&(~arrayIndexOf(l,n)||l.push(n));return l},enumBugKeys=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],hiddenKeys$1=enumBugKeys.concat("length","prototype"),f$3=Object.getOwnPropertyNames||function(e){return objectKeysInternal(e,hiddenKeys$1)},objectGetOwnPropertyNames={f:f$3},f$4=Object.getOwnPropertySymbols,objectGetOwnPropertySymbols={f:f$4},Reflect$1=global_1.Reflect,ownKeys=Reflect$1&&Reflect$1.ownKeys||function(e){var r=objectGetOwnPropertyNames.f(anObject(e)),n=objectGetOwnPropertySymbols.f;return n?r.concat(n(e)):r},copyConstructorProperties=function(e,r){for(var n=ownKeys(r),o=objectDefineProperty.f,s=objectGetOwnPropertyDescriptor.f,l=0;l<n.length;l++){var h=n[l];has(e,h)||o(e,h,s(r,h))}},replacement=/#|\.prototype\./,isForced=function(e,r){var n=data[normalize(e)];return n==POLYFILL||n!=NATIVE&&(typeof r=="function"?fails(r):!!r)},normalize=isForced.normalize=function(e){return String(e).replace(replacement,".").toLowerCase()},data=isForced.data={},NATIVE=isForced.NATIVE="N",POLYFILL=isForced.POLYFILL="P",isForced_1=isForced,getOwnPropertyDescriptor=objectGetOwnPropertyDescriptor.f,_export=function(e,r){var n,o,s,l,h=e.target,d=e.global,y=e.stat,g=d?global_1:y?global_1[h]||setGlobal(h,{}):(global_1[h]||{}).prototype;if(g)for(n in r){if(s=r[n],o=e.noTargetGet?(l=getOwnPropertyDescriptor(g,n))&&l.value:g[n],!isForced_1(d?n:h+(y?".":"#")+n,e.forced)&&o!==void 0){if(typeof s==typeof o)continue;copyConstructorProperties(s,o)}(e.sham||o&&o.sham)&&hide(s,"sham",!0),redefine(g,n,s,e)}},toObject=function(e){return Object(requireObjectCoercible(e))},correctPrototypeGetter=!fails(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),IE_PROTO=sharedKey("IE_PROTO"),ObjectPrototype$1=Object.prototype,objectGetPrototypeOf=correctPrototypeGetter?Object.getPrototypeOf:function(e){return e=toObject(e),has(e,IE_PROTO)?e[IE_PROTO]:typeof e.constructor=="function"&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?ObjectPrototype$1:null},ITERATOR=wellKnownSymbol("iterator"),BUGGY_SAFARI_ITERATORS=!1,returnThis=function(){return this},IteratorPrototype,PrototypeOfArrayIteratorPrototype,arrayIterator;[].keys&&(arrayIterator=[].keys(),"next"in arrayIterator?(PrototypeOfArrayIteratorPrototype=objectGetPrototypeOf(objectGetPrototypeOf(arrayIterator)),PrototypeOfArrayIteratorPrototype!==Object.prototype&&(IteratorPrototype=PrototypeOfArrayIteratorPrototype)):BUGGY_SAFARI_ITERATORS=!0),IteratorPrototype==null&&(IteratorPrototype={}),has(IteratorPrototype,ITERATOR)||hide(IteratorPrototype,ITERATOR,returnThis);var iteratorsCore={IteratorPrototype,BUGGY_SAFARI_ITERATORS},objectKeys=Object.keys||function(e){return objectKeysInternal(e,enumBugKeys)},objectDefineProperties=descriptors?Object.defineProperties:function(e,r){anObject(e);for(var n,o=objectKeys(r),s=o.length,l=0;l<s;)objectDefineProperty.f(e,n=o[l++],r[n]);return e},document$2=global_1.document,html=document$2&&document$2.documentElement,IE_PROTO$1=sharedKey("IE_PROTO"),PROTOTYPE="prototype",Empty=function(){},createDict=function(){var e,r=documentCreateElement("iframe"),n=enumBugKeys.length,o="script";for(r.style.display="none",html.appendChild(r),r.src="javascript:",(e=r.contentWindow.document).open(),e.write("<script>document.F=Object</"+o+">"),e.close(),createDict=e.F;n--;)delete createDict[PROTOTYPE][enumBugKeys[n]];return createDict()},objectCreate=Object.create||function(e,r){var n;return e!==null?(Empty[PROTOTYPE]=anObject(e),n=new Empty,Empty[PROTOTYPE]=null,n[IE_PROTO$1]=e):n=createDict(),r===void 0?n:objectDefineProperties(n,r)};hiddenKeys[IE_PROTO$1]=!0;var defineProperty=objectDefineProperty.f,TO_STRING_TAG$2=wellKnownSymbol("toStringTag"),setToStringTag=function(e,r,n){e&&!has(e=n?e:e.prototype,TO_STRING_TAG$2)&&defineProperty(e,TO_STRING_TAG$2,{configurable:!0,value:r})},iterators={},IteratorPrototype$1=iteratorsCore.IteratorPrototype,returnThis$1=function(){return this},createIteratorConstructor=function(e,r,n){var o=r+" Iterator";return e.prototype=objectCreate(IteratorPrototype$1,{next:createPropertyDescriptor(1,n)}),setToStringTag(e,o,!1),iterators[o]=returnThis$1,e},validateSetPrototypeOfArguments=function(e,r){if(anObject(e),!isObject(r)&&r!==null)throw TypeError("Can't set "+String(r)+" as a prototype")},objectSetPrototypeOf=Object.setPrototypeOf||("__proto__"in{}?function(){var e,r=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),r=n instanceof Array}catch{}return function(o,s){return validateSetPrototypeOfArguments(o,s),r?e.call(o,s):o.__proto__=s,o}}():void 0),ITERATOR$1=wellKnownSymbol("iterator"),IteratorPrototype$2=iteratorsCore.IteratorPrototype,BUGGY_SAFARI_ITERATORS$1=iteratorsCore.BUGGY_SAFARI_ITERATORS,KEYS="keys",VALUES="values",ENTRIES="entries",returnThis$2=function(){return this},defineIterator=function(e,r,n,o,s,l,h){createIteratorConstructor(n,r,o);function d(_n){if(_n===s&&q)return q;if(!BUGGY_SAFARI_ITERATORS$1&&_n in I)return I[_n];switch(_n){case KEYS:case VALUES:case ENTRIES:return function(){return new n(this,_n)}}return function(){return new n(this)}}var y,g,v,m=r+" Iterator",w=!1,I=e.prototype,V=I[ITERATOR$1]||I["@@iterator"]||s&&I[s],q=!BUGGY_SAFARI_ITERATORS$1&&V||d(s),De=r=="Array"&&I.entries||V;if(De&&(y=objectGetPrototypeOf(De.call(new e)),IteratorPrototype$2!==Object.prototype&&y.next&&(objectGetPrototypeOf(y)!==IteratorPrototype$2&&(objectSetPrototypeOf?objectSetPrototypeOf(y,IteratorPrototype$2):typeof y[ITERATOR$1]!="function"&&hide(y,ITERATOR$1,returnThis$2)),setToStringTag(y,m,!0))),s==VALUES&&V&&V.name!==VALUES&&(w=!0,q=function(){return V.call(this)}),I[ITERATOR$1]!==q&&hide(I,ITERATOR$1,q),iterators[r]=q,s)if(g={values:d(VALUES),keys:l?q:d(KEYS),entries:d(ENTRIES)},h)for(v in g)!BUGGY_SAFARI_ITERATORS$1&&!w&&v in I||redefine(I,v,g[v]);else _export({target:r,proto:!0,forced:BUGGY_SAFARI_ITERATORS$1||w},g);return g},STRING_ITERATOR="String Iterator",setInternalState=internalState.set,getInternalState=internalState.getterFor(STRING_ITERATOR);defineIterator(String,"String",function(e){setInternalState(this,{type:STRING_ITERATOR,string:String(e),index:0})},function(){var e,r=getInternalState(this),n=r.string,o=r.index;return o>=n.length?{value:void 0,done:!0}:(e=stringAt(n,o,!0),r.index+=e.length,{value:e,done:!1})});var domIterables={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},UNSCOPABLES=wellKnownSymbol("unscopables"),ArrayPrototype=Array.prototype;ArrayPrototype[UNSCOPABLES]==null&&hide(ArrayPrototype,UNSCOPABLES,objectCreate(null));var addToUnscopables=function(e){ArrayPrototype[UNSCOPABLES][e]=!0},ARRAY_ITERATOR="Array Iterator",setInternalState$1=internalState.set,getInternalState$1=internalState.getterFor(ARRAY_ITERATOR),es_array_iterator=defineIterator(Array,"Array",function(e,r){setInternalState$1(this,{type:ARRAY_ITERATOR,target:toIndexedObject(e),index:0,kind:r})},function(){var e=getInternalState$1(this),r=e.target,n=e.kind,o=e.index++;return!r||o>=r.length?{value:e.target=void 0,done:!0}:n=="keys"?{value:o,done:!1}:n=="values"?{value:r[o],done:!1}:{value:[o,r[o]],done:!1}},"values");iterators.Arguments=iterators.Array,addToUnscopables("keys"),addToUnscopables("values"),addToUnscopables("entries");var ITERATOR$2=wellKnownSymbol("iterator"),TO_STRING_TAG$3=wellKnownSymbol("toStringTag"),ArrayValues=es_array_iterator.values;for(var COLLECTION_NAME in domIterables){var Collection=global_1[COLLECTION_NAME],CollectionPrototype=Collection&&Collection.prototype;if(CollectionPrototype){if(CollectionPrototype[ITERATOR$2]!==ArrayValues)try{hide(CollectionPrototype,ITERATOR$2,ArrayValues)}catch{CollectionPrototype[ITERATOR$2]=ArrayValues}if(CollectionPrototype[TO_STRING_TAG$3]||hide(CollectionPrototype,TO_STRING_TAG$3,COLLECTION_NAME),domIterables[COLLECTION_NAME]){for(var METHOD_NAME in es_array_iterator)if(CollectionPrototype[METHOD_NAME]!==es_array_iterator[METHOD_NAME])try{hide(CollectionPrototype,METHOD_NAME,es_array_iterator[METHOD_NAME])}catch{CollectionPrototype[METHOD_NAME]=es_array_iterator[METHOD_NAME]}}}}var aFunction=function(e){if(typeof e!="function")throw TypeError(String(e)+" is not a function");return e},anInstance=function(e,r,n){if(!(e instanceof r))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},ITERATOR$3=wellKnownSymbol("iterator"),ArrayPrototype$1=Array.prototype,isArrayIteratorMethod=function(e){return e!==void 0&&(iterators.Array===e||ArrayPrototype$1[ITERATOR$3]===e)},bindContext=function(e,r,n){if(aFunction(e),r===void 0)return e;switch(n){case 0:return function(){return e.call(r)};case 1:return function(o){return e.call(r,o)};case 2:return function(o,s){return e.call(r,o,s)};case 3:return function(o,s,l){return e.call(r,o,s,l)}}return function(){return e.apply(r,arguments)}},ITERATOR$4=wellKnownSymbol("iterator"),getIteratorMethod=function(e){if(e!=null)return e[ITERATOR$4]||e["@@iterator"]||iterators[classof(e)]},callWithSafeIterationClosing=function(e,r,n,o){try{return o?r(anObject(n)[0],n[1]):r(n)}catch(l){var s=e.return;throw s!==void 0&&anObject(s.call(e)),l}},iterate=createCommonjsModule(function(e){var r={};(e.exports=function(n,o,s,l,h){var d,y,g,v,m,w=bindContext(o,s,l?2:1);if(h)d=n;else{if(typeof(y=getIteratorMethod(n))!="function")throw TypeError("Target is not iterable");if(isArrayIteratorMethod(y)){for(g=0,v=toLength(n.length);g<v;g++)if((l?w(anObject(m=n[g])[0],m[1]):w(n[g]))===r)return r;return}d=y.call(n)}for(;!(m=d.next()).done;)if(callWithSafeIterationClosing(d,w,m.value,l)===r)return r}).BREAK=r}),ITERATOR$5=wellKnownSymbol("iterator"),SAFE_CLOSING=!1;try{var called=0,iteratorWithReturn={next:function(){return{done:!!called++}},return:function(){SAFE_CLOSING=!0}};iteratorWithReturn[ITERATOR$5]=function(){return this}}catch(e){}var checkCorrectnessOfIteration=function(e,r){if(!r&&!SAFE_CLOSING)return!1;var n=!1;try{var o={};o[ITERATOR$5]=function(){return{next:function(){return{done:n=!0}}}},e(o)}catch{}return n},SPECIES=wellKnownSymbol("species"),speciesConstructor=function(e,r){var n,o=anObject(e).constructor;return o===void 0||(n=anObject(o)[SPECIES])==null?r:aFunction(n)},location=global_1.location,set$1=global_1.setImmediate,clear=global_1.clearImmediate,process=global_1.process,MessageChannel=global_1.MessageChannel,Dispatch=global_1.Dispatch,counter=0,queue={},ONREADYSTATECHANGE="onreadystatechange",defer,channel,port,run=function(e){var r;queue.hasOwnProperty(e)&&(r=queue[e],delete queue[e],r())},runner=function(e){return function(){run(e)}},listener=function(e){run(e.data)},post=function(e){global_1.postMessage(e+"",location.protocol+"//"+location.host)};set$1&&clear||(set$1=function(e){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);return queue[++counter]=function(){(typeof e=="function"?e:Function(e)).apply(void 0,r)},defer(counter),counter},clear=function(e){delete queue[e]},classofRaw(process)=="process"?defer=function(e){process.nextTick(runner(e))}:Dispatch&&Dispatch.now?defer=function(e){Dispatch.now(runner(e))}:MessageChannel?(channel=new MessageChannel,port=channel.port2,channel.port1.onmessage=listener,defer=bindContext(port.postMessage,port,1)):!global_1.addEventListener||typeof postMessage!="function"||global_1.importScripts||fails(post)?defer=ONREADYSTATECHANGE in documentCreateElement("script")?function(e){html.appendChild(documentCreateElement("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this),run(e)}}:function(e){setTimeout(runner(e),0)}:(defer=post,global_1.addEventListener("message",listener,!1)));var task={set:set$1,clear},navigator$1=global_1.navigator,userAgent=navigator$1&&navigator$1.userAgent||"",getOwnPropertyDescriptor$1=objectGetOwnPropertyDescriptor.f,macrotask=task.set,MutationObserver=global_1.MutationObserver||global_1.WebKitMutationObserver,process$1=global_1.process,Promise$1=global_1.Promise,IS_NODE=classofRaw(process$1)=="process",queueMicrotaskDescriptor=getOwnPropertyDescriptor$1(global_1,"queueMicrotask"),queueMicrotask=queueMicrotaskDescriptor&&queueMicrotaskDescriptor.value,flush,head,last,notify,toggle,node,promise;queueMicrotask||(flush=function(){var e,r;for(IS_NODE&&(e=process$1.domain)&&e.exit();head;){r=head.fn,head=head.next;try{r()}catch(n){throw head?notify():last=void 0,n}}last=void 0,e&&e.enter()},notify=IS_NODE?function(){process$1.nextTick(flush)}:MutationObserver&&!/(iphone|ipod|ipad).*applewebkit/i.test(userAgent)?(toggle=!0,node=document.createTextNode(""),new MutationObserver(flush).observe(node,{characterData:!0}),function(){node.data=toggle=!toggle}):Promise$1&&Promise$1.resolve?(promise=Promise$1.resolve(void 0),function(){promise.then(flush)}):function(){macrotask.call(global_1,flush)});var microtask=queueMicrotask||function(e){var r={fn:e,next:void 0};last&&(last.next=r),head||(head=r,notify()),last=r},PromiseCapability=function(e){var r,n;this.promise=new e(function(o,s){if(r!==void 0||n!==void 0)throw TypeError("Bad Promise constructor");r=o,n=s}),this.resolve=aFunction(r),this.reject=aFunction(n)},f$5=function(e){return new PromiseCapability(e)},newPromiseCapability={f:f$5},promiseResolve=function(e,r){if(anObject(e),isObject(r)&&r.constructor===e)return r;var n=newPromiseCapability.f(e);return(0,n.resolve)(r),n.promise},hostReportErrors=function(e,r){var n=global_1.console;n&&n.error&&(arguments.length===1?n.error(e):n.error(e,r))},perform=function(e){try{return{error:!1,value:e()}}catch(r){return{error:!0,value:r}}},redefineAll=function(e,r,n){for(var o in r)redefine(e,o,r[o],n);return e},path=global_1,aFunction$1=function(e){return typeof e=="function"?e:void 0},getBuiltIn=function(e,r){return arguments.length<2?aFunction$1(path[e])||aFunction$1(global_1[e]):path[e]&&path[e][r]||global_1[e]&&global_1[e][r]},SPECIES$1=wellKnownSymbol("species"),setSpecies=function(e){var r=getBuiltIn(e),n=objectDefineProperty.f;descriptors&&r&&!r[SPECIES$1]&&n(r,SPECIES$1,{configurable:!0,get:function(){return this}})},PROMISE="Promise",task$1=task.set,SPECIES$2=wellKnownSymbol("species"),getInternalState$2=internalState.get,setInternalState$2=internalState.set,getInternalPromiseState=internalState.getterFor(PROMISE),PromiseConstructor=global_1[PROMISE],TypeError$1=global_1.TypeError,document$3=global_1.document,process$2=global_1.process,$fetch=global_1.fetch,versions=process$2&&process$2.versions,v8=versions&&versions.v8||"",newPromiseCapability$1=newPromiseCapability.f,newGenericPromiseCapability=newPromiseCapability$1,IS_NODE$1=classofRaw(process$2)=="process",DISPATCH_EVENT=!!(document$3&&document$3.createEvent&&global_1.dispatchEvent),UNHANDLED_REJECTION="unhandledrejection",REJECTION_HANDLED="rejectionhandled",PENDING=0,FULFILLED=1,REJECTED=2,HANDLED=1,UNHANDLED=2,Internal,OwnPromiseCapability,PromiseWrapper,FORCED=isForced_1(PROMISE,function(){function e(){}var r=PromiseConstructor.resolve(1),n=(r.constructor={})[SPECIES$2]=function(o){o(e,e)};return!((IS_NODE$1||typeof PromiseRejectionEvent=="function")&&!isPure&&r.then(e)instanceof n&&v8.indexOf("6.6")!==0&&userAgent.indexOf("Chrome/66")===-1)}),INCORRECT_ITERATION=FORCED||!checkCorrectnessOfIteration(function(e){PromiseConstructor.all(e).catch(function(){})}),isThenable=function(e){var r;return!(!isObject(e)||typeof(r=e.then)!="function")&&r},notify$1=function(e,r,n){var o;r.notified||(r.notified=!0,o=r.reactions,microtask(function(){for(var s=r.value,l=r.state==FULFILLED,h=0;o.length>h;)(function(d){var y,g,v,m=l?d.ok:d.fail,w=d.resolve,I=d.reject,V=d.domain;try{m?(l||(r.rejection===UNHANDLED&&onHandleUnhandled(e,r),r.rejection=HANDLED),m===!0?y=s:(V&&V.enter(),y=m(s),V&&(V.exit(),v=!0)),y===d.promise?I(TypeError$1("Promise-chain cycle")):(g=isThenable(y))?g.call(y,w,I):w(y)):I(s)}catch(q){V&&!v&&V.exit(),I(q)}})(o[h++]);r.reactions=[],r.notified=!1,n&&!r.rejection&&onUnhandled(e,r)}))},dispatchEvent=function(e,r,n){var o,s;DISPATCH_EVENT?((o=document$3.createEvent("Event")).promise=r,o.reason=n,o.initEvent(e,!1,!0),global_1.dispatchEvent(o)):o={promise:r,reason:n},(s=global_1["on"+e])?s(o):e===UNHANDLED_REJECTION&&hostReportErrors("Unhandled promise rejection",n)},onUnhandled=function(e,r){task$1.call(global_1,function(){var n,o=r.value;if(isUnhandled(r)&&(n=perform(function(){IS_NODE$1?process$2.emit("unhandledRejection",o,e):dispatchEvent(UNHANDLED_REJECTION,e,o)}),r.rejection=IS_NODE$1||isUnhandled(r)?UNHANDLED:HANDLED,n.error))throw n.value})},isUnhandled=function(e){return e.rejection!==HANDLED&&!e.parent},onHandleUnhandled=function(e,r){task$1.call(global_1,function(){IS_NODE$1?process$2.emit("rejectionHandled",e):dispatchEvent(REJECTION_HANDLED,e,r.value)})},bind=function(e,r,n,o){return function(s){e(r,n,s,o)}},internalReject=function(e,r,n,o){r.done||(r.done=!0,o&&(r=o),r.value=n,r.state=REJECTED,notify$1(e,r,!0))},internalResolve=function(e,r,n,o){if(!r.done){r.done=!0,o&&(r=o);try{if(e===n)throw TypeError$1("Promise can't be resolved itself");var s=isThenable(n);s?microtask(function(){var l={done:!1};try{s.call(n,bind(internalResolve,e,l,r),bind(internalReject,e,l,r))}catch(h){internalReject(e,l,h,r)}}):(r.value=n,r.state=FULFILLED,notify$1(e,r,!1))}catch(l){internalReject(e,{done:!1},l,r)}}};FORCED&&(PromiseConstructor=function(e){anInstance(this,PromiseConstructor,PROMISE),aFunction(e),Internal.call(this);var r=getInternalState$2(this);try{e(bind(internalResolve,this,r),bind(internalReject,this,r))}catch(n){internalReject(this,r,n)}},Internal=function(){setInternalState$2(this,{type:PROMISE,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:PENDING,value:void 0})},Internal.prototype=redefineAll(PromiseConstructor.prototype,{then:function(e,r){var n=getInternalPromiseState(this),o=newPromiseCapability$1(speciesConstructor(this,PromiseConstructor));return o.ok=typeof e!="function"||e,o.fail=typeof r=="function"&&r,o.domain=IS_NODE$1?process$2.domain:void 0,n.parent=!0,n.reactions.push(o),n.state!=PENDING&&notify$1(this,n,!1),o.promise},catch:function(e){return this.then(void 0,e)}}),OwnPromiseCapability=function(){var e=new Internal,r=getInternalState$2(e);this.promise=e,this.resolve=bind(internalResolve,e,r),this.reject=bind(internalReject,e,r)},newPromiseCapability.f=newPromiseCapability$1=function(e){return e===PromiseConstructor||e===PromiseWrapper?new OwnPromiseCapability(e):newGenericPromiseCapability(e)},typeof $fetch=="function"&&_export({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return promiseResolve(PromiseConstructor,$fetch.apply(global_1,arguments))}})),_export({global:!0,wrap:!0,forced:FORCED},{Promise:PromiseConstructor}),setToStringTag(PromiseConstructor,PROMISE,!1),setSpecies(PROMISE),PromiseWrapper=path[PROMISE],_export({target:PROMISE,stat:!0,forced:FORCED},{reject:function(e){var r=newPromiseCapability$1(this);return r.reject.call(void 0,e),r.promise}}),_export({target:PROMISE,stat:!0,forced:FORCED},{resolve:function(e){return promiseResolve(this,e)}}),_export({target:PROMISE,stat:!0,forced:INCORRECT_ITERATION},{all:function(e){var r=this,n=newPromiseCapability$1(r),o=n.resolve,s=n.reject,l=perform(function(){var h=aFunction(r.resolve),d=[],y=0,g=1;iterate(e,function(v){var m=y++,w=!1;d.push(void 0),g++,h.call(r,v).then(function(I){w||(w=!0,d[m]=I,--g||o(d))},s)}),--g||o(d)});return l.error&&s(l.value),n.promise},race:function(e){var r=this,n=newPromiseCapability$1(r),o=n.reject,s=perform(function(){var l=aFunction(r.resolve);iterate(e,function(h){l.call(r,h).then(n.resolve,o)})});return s.error&&o(s.value),n.promise}}),_export({target:"Promise",proto:!0,real:!0},{finally:function(e){var r=speciesConstructor(this,getBuiltIn("Promise")),n=typeof e=="function";return this.then(n?function(o){return promiseResolve(r,e()).then(function(){return o})}:e,n?function(o){return promiseResolve(r,e()).then(function(){throw o})}:e)}}),path.Promise;var perf,start;function _typeof(e){return(_typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(e)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var n=0;n<r.length;n++){var o=r[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,r,n){return r&&_defineProperties(e.prototype,r),n&&_defineProperties(e,n),e}function _defineProperty(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function _inherits(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&_setPrototypeOf(e,r)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)})(e)}function _setPrototypeOf(e,r){return(_setPrototypeOf=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n})(e,r)}function _isNativeReflectConstruct(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function _construct(e,r,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(o,s,l){var h=[null];h.push.apply(h,s);var d=new(Function.bind.apply(o,h));return l&&_setPrototypeOf(d,l.prototype),d}).apply(null,arguments)}function _isNativeFunction(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function _wrapNativeSuper(e){var r=typeof Map=="function"?new Map:void 0;return(_wrapNativeSuper=function(n){if(n===null||!_isNativeFunction(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(r!==void 0){if(r.has(n))return r.get(n);r.set(n,o)}function o(){return _construct(n,arguments,_getPrototypeOf(this).constructor)}return o.prototype=Object.create(n.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(o,n)})(e)}function _assertThisInitialized(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,r){return!r||typeof r!="object"&&typeof r!="function"?_assertThisInitialized(e):r}function _createSuper(e){var r=_isNativeReflectConstruct();return function(){var n,o=_getPrototypeOf(e);return _possibleConstructorReturn(this,r?(n=_getPrototypeOf(this).constructor,Reflect.construct(o,arguments,n)):o.apply(this,arguments))}}function _superPropBase(e,r){for(;!Object.prototype.hasOwnProperty.call(e,r)&&(e=_getPrototypeOf(e))!==null;);return e}function _get(e,r,n){return(_get=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(o,s,l){var h=_superPropBase(o,s);if(h){var d=Object.getOwnPropertyDescriptor(h,s);return d.get?d.get.call(l):d.value}})(e,r,n||e)}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function _iterableToArrayLimit(e,r){if(typeof Symbol<"u"&&Symbol.iterator in Object(e)){var n=[],o=!0,s=!1,l=void 0;try{for(var h,d=e[Symbol.iterator]();!(o=(h=d.next()).done)&&(n.push(h.value),!r||n.length!==r);o=!0);}catch(y){s=!0,l=y}finally{try{o||d.return==null||d.return()}finally{if(s)throw l}}return n}}function _unsupportedIterableToArray(e,r){if(e){if(typeof e=="string")return _arrayLikeToArray(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(r==null||r>e.length)&&(r=e.length);for(var n=0,o=new Array(r);n<r;n++)o[n]=e[n];return o}function _nonIterableSpread(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _createForOfIteratorHelper(e,r){var n;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||r&&e&&typeof e.length=="number"){n&&(e=n);var o=0,s=function(){};return{s,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(y){throw y},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var l,h=!0,d=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var y=n.next();return h=y.done,y},e:function(y){d=!0,l=y},f:function(){try{h||n.return==null||n.return()}finally{if(d)throw l}}}}typeof Object.assign!="function"&&(Object.assign=function(e){if(e==null)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(o!=null)for(var s in o)o.hasOwnProperty(s)&&(r[s]=o[s])}return r}),typeof Object.values!="function"&&(Object.values=function(e){return Object.keys(e).map(function(r){return e[r]})}),Math.hypot=Math.hypot||function(){for(var e=0,r=arguments.length,n=0;n<r;n++){if(arguments[n]===1/0||arguments[n]===-1/0)return 1/0;e+=arguments[n]*arguments[n]}return Math.sqrt(e)},Math.log2=Math.log2||function(e){return Math.log(e)*Math.LOG2E},typeof window<"u"?(!("performance"in window)&&(window.performance={}),perf=window.performance):typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&(!("performance"in self)&&(self.performance={}),perf=self.performance),perf&&typeof perf.now!="function"&&(start=+new Date,perf.now=function(){return new Date-start});var global$1=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},ns={},MathUtils;(function(){var e,r,n=typeof Object.defineProperties=="function"?Object.defineProperty:function($,_i,Fa){$!=Array.prototype&&$!=Object.prototype&&($[_i]=Fa.value)},o=(typeof window>"u"||window!==this)&&global$1!==void 0&&global$1!=null?global$1:this;if(typeof Object.setPrototypeOf=="function")e=Object.setPrototypeOf;else{t:{var s={};try{s.__proto__={ea:!0},r=s.ea;break t}catch{}r=!1}e=r?function($,_i){if($.__proto__=_i,$.__proto__!==_i)throw new TypeError($+" is not extensible");return $}:null}var l=e;(function($,_i){if(_i){var Fa=o;$=$.split(".");for(var _u=0;_u<$.length-1;_u++){var _c=$[_u];_c in Fa||(Fa[_c]={}),Fa=Fa[_c]}(_i=_i(_u=Fa[$=$[$.length-1]]))!=_u&&_i!=null&&n(Fa,$,{configurable:!0,writable:!0,value:_i})}})("Object.setPrototypeOf",function($){return $||l});var h=this||self;function d($){var _i=_typeof($);if(_i=="object"){if(!$)return"null";if($ instanceof Array)return"array";if($ instanceof Object)return _i;var Fa=Object.prototype.toString.call($);if(Fa=="[object Window]")return"object";if(Fa=="[object Array]"||typeof $.length=="number"&&$.splice!==void 0&&$.propertyIsEnumerable!==void 0&&!$.propertyIsEnumerable("splice"))return"array";if(Fa=="[object Function]"||$.call!==void 0&&$.propertyIsEnumerable!==void 0&&!$.propertyIsEnumerable("call"))return"function"}else if(_i=="function"&&$.call===void 0)return"object";return _i}function y($){return d($)=="function"}function g($){var _i=_typeof($);return _i=="object"&&$!=null||_i=="function"}function v($,_i){$=$.split(".");var Fa,_u=h;for(($[0]in _u)||_u.execScript===void 0||_u.execScript("var "+$[0]);$.length&&(Fa=$.shift());)$.length||_i===void 0?_u=_u[Fa]&&_u[Fa]!==Object.prototype[Fa]?_u[Fa]:_u[Fa]={}:_u[Fa]=_i}function m($,_i){function Fa(){}Fa.prototype=_i.prototype,$.ua=_i.prototype,$.prototype=new Fa,$.prototype.constructor=$}var w=Math,I=w.min,V=w.max,q=w.round,De=w.floor,_n=w.ceil,ha=w.abs,ga=w.log,_o=w.sqrt,_l=w.pow,wc=w.sin,_h=w.asin,_p=w.cos,pd=w.tan,oy=w.atan2,ny=w.PI,fy=ny/2,wy=ny/4,cy=2*ny,Gy=3*ny,jy=ny/180,Wy=180/ny;function Iy($,_i,Fa){return Fa<$?Fa:$<_i?_i:$}function vy($,_i,Fa){return _i<Fa?_i<=$&&$<=Fa:Fa<=$&&$<=_i}function Ty($,_i,Fa,_u,_c,_f){return _o(_l(($-_c)*(_u-_f)-(_i-_f)*(Fa-_c),2)/(_l(Fa-_c,2)+_l(_u-_f,2)))}v("H.math.normalize",function($,_i,Fa){return _i-=Fa=Fa||0,($-=Fa)-De($/_i)*_i+Fa}),v("H.math.clamp",Iy);var Vy={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};function a0($,_i){var Fa=$.x;$=$.y;for(var _u,_c,_f,sy,ty=_i.length,hy=ty,Ay=_i[0],ky=0,Ly=0,Hy=0;ky!=1&&1<hy;)_c=_i[--hy],_u=_i[--hy],sy=_i[hy?hy-1:(ty+(hy-1))%ty],_f=_i[hy?hy-2:(ty+(hy-2))%ty],Fa<=_u&&_u<=Fa&&$<=_c&&_c<=$||Fa<=_f&&_f<=Fa&&$<=sy&&sy<=$?ky=1:ky||_u!==Fa?!ky&&vy(Fa,_u,_f)&&((_u<Fa&&Fa<_f||Fa<_u&&_f<Fa)&&(Ly+=$<(Ay=_c+(Fa-_u)/(_f-_u)*(sy-_c)),Hy+=Ay<$),ky=vy($,_c,sy)&&Ty(Fa,$,_u,_c,_f,sy)<=0?2:0):(_f===Fa&&(_c<$&&$<sy||$<_c&&sy<$)||(Ay<=Fa&&Fa<_f||Fa<=Ay&&_f<Fa)&&($<=_c?++Ly:++Hy),ky=vy($,_c,sy)&&Ty(Fa,$,_u,_c,_f,sy)<=0?2:0),Ay=_u;return ky||Hy===0||Ly%2==0||(ky=3),ky!==Vy.NONE}function zy($,_i){this.x=+$,this.y=+_i}function h0($,_i,Fa,_u,_c,_f,sy,ty,hy,Ay){return $={x:$,y:_i,next:Fa||null,s:_u||null,ta:_c||null,X:_f||null,o:!!sy,T:ty||0,O:hy||0,alpha:Ay||0},_u&&($.s.next=$),Fa&&($.next.s=$),$}function k0($){for(;$&&$.o;)$=$.next;return $}function _0($){if($)for(;$.next;)$=$.next;return $}function T0($){var _i=_0($);(_i.s.next=$).s=_i.s}function x0($){for(var _i=[];$;)_i.push($.x,$.y),$=$.next;return _i}function c0($,_i,Fa){for(_i=_i.next;_i!==Fa&&_i.alpha<=$.alpha;)_i=_i.next;$.next=_i,$.s=_i.s,($.next.s=$).s.next=$}function _g($,_i){for(var Fa,_u=null,_c=0,_f=$.length;_c<_f;_c++)(Fa=h0($[_c].x,$[_c].y,_u)).qa=_i,(Fa.next=_u)&&(_u.s=Fa),_u=Fa;return _u}function w0($,_i,Fa,_u){return($-=Fa)*$+(_i-=_u)*_i}v("H.math.CoverType",Vy),v("H.math.isPointInsidePolygon",a0),v("H.math.flatten",function($){for(var _i=$.length,Fa=new Float64Array(2*_i),_u=_i&&$[0].x!==y0;_i--;){var _c=$[_i],_f=_i<<1;Fa[_f]=_u?_c.x:_c[0],Fa[1+_f]=_u?_c.y:_c[1]}return Fa}),v("H.math.Point",zy),(zy.prototype.set=zy).prototype.clone=function($){return $?($.x=this.x,$.y=this.y):$=new zy(this.x,this.y),$},zy.prototype.add=function($){return this.x+=$.x,this.y+=$.y,this},zy.prototype.sub=function($){return this.x-=$.x,this.y-=$.y,this},zy.prototype.scale=function($,_i){return this.x*=$,this.y*=_i===void 0?$:_i,this},zy.prototype.round=function(){return this.x=q(this.x),this.y=q(this.y),this},zy.prototype.floor=function(){return this.x=De(this.x),this.y=De(this.y),this},zy.prototype.ceil=function(){return this.x=_n(this.x),this.y=_n(this.y),this},zy.prototype.equals=zy.prototype.w=function($){return!(!$||this.x!==$.x||this.y!==$.y)},zy.prototype.getNearest=zy.prototype.la=function($,_i){var Fa,_u=_i.x-$.x,_c=_i.y-$.y,_f=$;return(_u||_c)&&(_f=(Fa=((this.x-$.x)*_u+(this.y-$.y)*_c)/(_u*_u+_c*_c))<=0?$:1<=Fa?_i:new zy($.x+Fa*_u,$.y+Fa*_c)),_f},zy.prototype.distance=zy.prototype.R=function($){return _o(_l(this.x-$.x,2)+_l(this.y-$.y,2))},zy.fromIPoint=function($){if(!$)throw Error("invalid argument");return $ instanceof zy?$:new zy($.x,$.y)},v("H.math.clipping.clipStrips",function($,_i,Fa,_u,_c,_f){var sy,ty,hy,Ay=$.length;if(Ay)for(sy=[];Ay--;)for(var ky,Ly,Hy=$[Ay],Yy=Hy.length,i0=0,Ry=1;Ry<Yy;Ry++)(hy=function(Oy,Py,Dy,Xy,_v,Ky){var Zy=Oy.x;Oy=-Oy.y;var qy=Py.x;if(Py=-Py.y,Dy=-Dy,Ky=-Ky,qy<Zy){if(_v<qy||Zy<Xy)return;var S0=Zy,u0=Oy;Zy=qy,Oy=Py,qy=S0,Py=u0,S0=1}else if(_v<Zy||qy<Xy)return;if(Py<Oy){if(Dy<Py||Oy<Ky)return;var R0=1;Oy=-Oy,Py=-Py,u0=Ky,Ky=-Dy,Dy=-u0}else if(Dy<Oy||Py<Ky)return;if(Zy<Xy){if((Oy+=(Xy-Zy)*(Py-Oy)/(qy-Zy))>Dy)return;Zy=Xy}if(Oy<Ky){if((Zy+=(Ky-Oy)*(qy-Zy)/(Py-Oy))>_v)return;Oy=Ky}return _v<qy&&(Py=Oy+(_v-Zy)*(Py-Oy)/(qy-Zy),qy=_v),Dy<Py&&(qy=Zy+(Dy-Oy)*(qy-Zy)/(Py-Oy),Py=Dy),R0&&(Oy=-Oy,Py=-Py),S0?[new zy(qy,-Py),new zy(Zy,-Oy)]:[new zy(Zy,-Oy),new zy(qy,-Py)]}(Hy[Ry-1],Hy[Ry],Fa,_i,_u,_c))&&(ky=hy[0],Ly=hy[1],i0&&i0.w(ky)?ty.push(Ly):sy.push(ty=hy),i0=Ly,_f&&(Ry=Yy,Ay=0));else sy=$;return sy}),v("H.math.clipping.clipPolygon",function($,_i,Fa){var _u;$=_g($,!0),_i=_g(_i,!1);var _c={},_f=_u=1;switch(~~(Fa||0)){case 1:_f=_u=0;break;case 2:_u=0,_f=1;break;case 3:_u=1,_f=0}Fa=_u;var sy,ty,hy,Ay,ky,Ly,Hy=_f;if(_i&&$){for(_i.M=h0(_i.x,_i.y,null,_0(_i)),$.M=h0($.x,$.y,null,_0($)),_f=_i;_f.next;_f=_f.next)if(!_f.o)for(_u=$;_u.next;_u=_u.next)_u.o||(Ly=function i0(Ry,Oy,Py,Dy,Xy){var _v,Ky=Oy.x-Ry.x,Zy=Oy.y-Ry.y,qy=Dy.x-Py.x,S0=Dy.y-Py.y,u0=Ky*S0-Zy*qy;return!u0||(qy=((Py.x-Ry.x)*S0-(Py.y-Ry.y)*qy)/u0,u0=(Zy*(Py.x-Ry.x)-Ky*(Py.y-Ry.y))/u0,qy<0||1<qy||u0<0||1<u0)?0:(qy===0?_v=Ry:qy===1?_v=Oy:u0===0?_v=Py:u0===1&&(_v=Dy),_v?(_v.x+=2480549651603763e-20,_v.y+=7321997314118067e-20,_v.M&&(_v.M.x=_v.x,_v.M.y=_v.y),i0(Ry,Oy,Py,Dy,Xy)):(Xy.xa=Ry.x+qy*Ky,Xy.ya=Ry.y+qy*Zy,Xy.fa=qy,Xy.ga=u0,1))}(_f,sy=k0(_f.next),_u,ty=k0(_u.next),_c))&&(Ly=_c.fa,hy=_c.ga,c0(Ly=h0(Ay=_c.xa,ky=_c.ya,null,null,null,null,!0,0,0,Ly),_f,sy),c0(sy=h0(Ay,ky,null,null,null,null,!0,0,0,hy),_u,ty),(Ly.X=sy).X=Ly);for(_c=a0(_i,x0($)),Fa&&(_c=!_c),_f=_i;_f;_f=_f.next)_f.o&&(_c=!(_f.T=_c));for(_c=a0($,x0(_i)),Hy&&(_c=!_c),_u=$;_u.next;_u=_u.next)_u.o&&(_c=!(_u.T=_c));for(T0(_i),T0($);($=function(i0){var Ry=i0;if(Ry)for(;(Ry=Ry.next)!=i0&&(!Ry.o||Ry.o&&Ry.O););return Ry}(_i))!=_i;){for(Fa=null;!$.O;$=$.X){for(_c=$.T;(Fa=h0($.x,$.y,Fa)).artificial=$.o||$.qa,$.O=1,$=_c?$.next:$.s;)if($.o){$.O=1;break}if(!$)break}Fa.ta=Yy;var Yy=Fa}return Yy}}),v("H.math.simplifyDP",function($,_i,Fa){return function _u(_c,_f,sy,ty,hy){var Ay=0,ky=ty,Ly=_c[ty].x,Hy=_c[ty].y,Yy=_c[hy].x,i0=_c[hy].y,Ry=ty+1,Oy=w0(Ly,Hy,Yy,i0);if(Oy)for(;Ry<hy;){var Py=_c[Ry++],Dy=Py.x;Py=Py.y;var Xy=((Dy-Ly)*(Yy-Ly)+(Py-Hy)*(i0-Hy))/Oy;Dy=Xy<0?w0(Dy,Py,Ly,Hy):1<Xy?w0(Dy,Py,Yy,i0):w0(Dy,Py,Ly+Xy*(Yy-Ly),Hy+Xy*(i0-Hy)),Ay<Dy&&(Ay=Dy,ky=Ry-1)}else for(;Ry<hy;)Py=_c[Ry++],Dy=Py.x,Py=Py.y,Dy=w0(Dy,Py,Ly,Hy),Ay<Dy&&(Ay=Dy,ky=Ry-1);return ty=_f<=Ay||0<sy&&ky-ty?(--sy,1<ky-ty?(ty=_u(_c,_f,sy,ty,ky),ty.splice(ty.length-1,1)):ty=[_c[ty]],1<hy-ky?ty.concat(_u(_c,_f,sy,ky,hy)):ty.concat(_c.slice(ky,hy+1))):[_c[ty],_c[hy]],ty}($,_i*_i,Fa||0,0,$.length-1)});var z0=this,d0=String,y0=[].pop(),Q0=/x/.exec(""),b0="prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function l0($,_i){if($ instanceof _i&&$.constructor===_i)throw new TypeError("Illegal constructor "+A0(_i))}v("H.lang.isArray",function($,_i,Fa,_u){var _c;if(!(_c=G0($)==="Array")&&_i)throw new n0(_i,Fa,_u!==y0?_u:$);return _c}),v("H.lang.isString",function($){return typeof $=="string"});var g0=isNaN;function F0($){return $===+$}function G0($){var _i=Object[b0[0]][b0[6]].call($).match(/^\[object (\w+)\]$/);return _i?_i[1]:_typeof($)}v("H.lang.isNumber",F0),v("H.lang.isInteger",Number.isInteger?Number.isInteger:function($){return typeof $=="number"&&$%1==0});var m0=[];function A0($,_i,Fa,_u){var _c,_f,sy="",ty=arguments.length<2;return ty&&(_i={H:z0.H},Fa="",_u=m0.slice()),l_(_i,!0,function(hy,Ay){try{if(_c=hy[Ay],ky=_c,l_(hy,!(Ly=[]),function(Hy,Yy){Hy[Yy]===ky&&Ly.push(Yy)}),Ay=Ly.sort(b_)[0],!(g(_c)&&_c.window===_c&&_c.self===_c||g(_c)&&0<_c.nodeType&&y(_c.cloneNode))&&g(_c)){if(_c===$)return sy=Fa+"."+Ay,1;if(_u.indexOf(_c)<0&&(_u.push(_c),sy=A0($,_c,Fa+"."+Ay,_u)))return 1}}catch{}var ky,Ly}),ty&&(sy=sy?sy.substr(1).replace("."+b0[0]+".","#"):"~"+(y($)?((_f=/^\s*function ([^\( ]+)/.exec(_f=$))?_f[1]:"anonymous")+"()":G0($))),sy}function b_($,_i){return _i.length-$.length}m0.indexOf(m0)<0&&m0.push(m0);var r0=Object[b0[0]][b0[2]];function l_($,_i,Fa){var _u;if($){for(_c in $)if((!_i||r0.call($,_c))&&Fa($,_c,!0))return;for(_u=b0.length;_u--;){var _c=b0[_u];if((!_i||r0.call($,_c))&&Fa($,_c,!1))break}}}function x_($,_i,Fa){Fa[_i]="#"+_i}function n0($,_i,Fa){var _u,_c,_f=arguments.length;return(_i=_i!==y0?+_i:_i)!==y0&&((_c=_u=(_c=/^.*?\(([^\)]+)/.exec((""+$).replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"")))?d0(_c[1].replace(/\s+/g,"")).split(y0!==","?",":" "):[]).forEach(x_),_c=_c[_i]||"#"+_i),_u=$?A0($):"",_f=2<_f?d0(Fa):"",(_c||_f)&&(_u+=" (Argument "+(_c||"")+(_f?" "+_f:"")+")"),_f=Error(_u),Object.setPrototypeOf(_f,n0.prototype),_f}function L0($,_i,Fa){var _u=Iy(+$,-90,90);if(_i&&g0(_u))throw new n0(_i,Fa,$);return _u}function M0($,_i,Fa){var _u,_c=+$;if((_c<-180||180<_c)&&(_c=((_u=(_c+180)%360)<0?360+_u:_u)-180),_i&&g0(_c))throw new n0(_i,Fa,$);return _c}function u_($,_i,Fa){var _u;if($!==y0&&g0(_u=+$)&&_i)throw new n0(_i,Fa,$);return _u}function p0(){l0(this,p0)}function _m($,_i,Fa){this.lat=L0($,_m,0),this.lng=M0(_i,_m,1),Fa!==y0&&(this.alt=u_(Fa,_m,2))}function D0($,_i,Fa){var _u=g($)&&!(g0($.lat=L0($.lat))||g0($.lng=M0($.lng))||$.alt!==y0&&g0($.alt=u_($.alt)));if(!_u&&_i)throw new n0(_i,Fa,$);return _u}function _y($,_i,Fa,_u){t_(this,L0($,_y,0),M0(_i,_y,1),L0(Fa,_y,2),M0(_u,_y,3))}function t_($,_i,Fa,_u,_c){return $.f=Fa,$.g=_c,_i<_u&&(Fa=_i,_i=_u,_u=Fa),$.i=_i,$.h=_u,$.m=$.b=$.c=null,$}function P0($,_i){return($=_i-$)+($<0?360:0)}function H0($,_i){return($+=_i/2)-(180<$?360:0)}function $0($,_i,Fa,_u,_c,_f,sy,ty,hy){Fa=I(Fa,sy),$=V($,_c);var Ay=H0(_i,_c=P0(_i,_u)),ky=H0(_f,sy=P0(_f,ty))-Ay,Ly=(ky+=ky-1e-6<0?360:0)-1e-6<180?(Ay=_i,ty):(ky=360-ky,Ay=_f,_u);return 360<=(ky=ky+_c/2+sy/2)+5e-7?(Ay=-180,Ly=180):ky-5e-7<_c?(Ay=_i,Ly=_u):ky-5e-7<sy&&(Ay=_f,Ly=ty),hy?t_(hy,$,Ay,Fa,Ly):new _y($,Ay,Fa,Ly)}function V0($,_i,Fa){return Fa||(D0($,V0,0),D0(_i,V0,1)),new _y($.lat,$.lng,_i.lat,_i.lng)}function U0($,_i,Fa,_u,_c,_f){l0(this,U0),this.sa=$||10,this.c=this.b=null,this.j=_u||0,this.l=_c||0,this.m=_i||1,this.u=Fa||1,this.I=!!_f,this.flush()}function c_($,_i,Fa){var _u,_c;if($.I&&(_u=$.c))for(_c=3;0<=_c;_c--){var _f=_i[_c];if(_c%3?_f>=_u[_c]:_f<=_u[_c]){if(!Fa){$.c=null;break}_u[_c]=_f}}}function e_($,_i){var Fa,_u=$.a;if(_i){var _c=_i;if(_c!==_u)for(_u=_c;_c=_c.c;)(_c.entries||1<_c.a)&&(_u=_c)}else for(;!_u.entries&&(Fa=_u.a)<2&&Fa;)_u=_c;$.a=_u}m(n0,Error),v("H.lang.InvalidArgumentError",n0),n0.prototype.name="InvalidArgumentError",v("H.geo.isDBC",function($,_i){return($<0^_i<0)!=0&&180<ha(_i-$)}),v("H.geo.AbstractGeometry",p0),p0.prototype.getBoundingBox=p0.prototype.D,p0.prototype.equals=p0.prototype.w,p0.prototype.a="",p0.prototype.l="",p0.prototype.toString=function(){return this.I([this.a.toUpperCase()," "]).join("")},p0.prototype.toGeoJSON=p0.prototype.va=function(){return{type:this.l,coordinates:this.u()}},p0.prototype.forWorkerMessage=p0.prototype.U=function(){return{type:this.a,coordinates:this.j(),boundingBox:this.D().U()}},m(_m,p0),v("H.geo.Point",_m),_m.prototype.equals=_m.prototype.w=function($){return this===$||!!$&&this.lat===$.lat&&this.lng===$.lng&&(this.alt||0)===($.alt||0)},_m.prototype.distance=_m.prototype.R=function($){var _i,Fa;return $=this===$||this.lat===$.lat&&this.lng===$.lng?0:(_i=this.lat*jy,Fa=$.lat*jy,1274200158e-2*_h(I(1,_o(_l(wc((_i-Fa)/2),2)+_p(_i)*_p(Fa)*_l(wc((this.lng*jy-$.lng*jy)/2),2)))))},_m.prototype.walk=_m.prototype.wa=function($,_i,Fa){var _u,_c,_f,sy,ty,hy,Ay;return Fa?((_i/=637100079e-2)&&($*=jy,ty=jy*this.lat,_u=wc(ty),_c=wc(_i),_f=_p(_i),sy=jy*this.lng,hy=_p(ty),ty=_h(hy*_p($)*_c+_u*_f),hy=($=(sy+($=oy(wc($)*hy*_c,_f-_u*wc(ty)))+ny)%(2*ny)-ny)*Wy),_i?new _m(ty*Wy,(hy+540)%360-180):this):(($=($%360+360)%360)+90)%180==0?(ty=this.lng+_i/(637100079e-2*cy*_p(this.lat*jy))*($===270?-360:360),new _m(this.lat,(ty+540)%360-180)):((_i/=637100079e-2)&&($*=jy,sy=this.lat*jy,_u=this.lng*jy,_f=(_c=sy+_i*_p($))-sy,ty=ga(pd(_c/2+wy)/pd(sy/2+wy)),ty=g0(_f/ty)?_p(sy):_f/ty,Ay=_i*wc($)/ty,ha(_c)>fy&&(_c=0<_c?ny-_c:-(ny+_c))),_i?new _m(_c*Wy,((_u+Ay+Gy+(ha(sy+_f)>fy?ny:0))%cy-ny)*Wy):this)},_m.prototype.getBoundingBox=_m.prototype.D=function(){return new _y(this.lat,this.lng,this.lat,this.lng)},_m.validate=D0,_m.fromIPoint=function $(_i){if(!_i)throw new n0($,0,_i);return new _m(_i.lat,_i.lng,_i.alt)},_m.prototype.a="Point",_m.prototype.I=function($){return $.push("(",this.lng," ",this.lat,")"),$},_m.prototype.l="Point",_m.prototype.u=function(){return[this.lng,this.lat,this.alt||0]},_m.prototype.j=function(){return[this.lat,this.lng,this.alt||0]},m(_y,p0),v("H.geo.Rect",_y),_y.prototype.a="Polygon",_y.prototype.I=function($){var _i=this.i,Fa=this.f,_u=this.h,_c=this.g;return $.push("(","(",Fa," ",_i,",",_c," ",_i,",",_c," ",_u,",",Fa," ",_u,",",Fa," ",_i,")",")"),$},_y.prototype.equals=_y.prototype.w=function($){return this===$||!!$&&this.i===$.i&&this.f===$.f&&this.h===$.h&&this.g===$.g},_y.prototype.clone=function(){return new _y(this.i,this.f,this.h,this.g)},_y.prototype.getTopLeft=_y.prototype.W=function(){return this.m||(this.m=new _m(this.i,this.f)),this.m},_y.prototype.getBottomRight=_y.prototype.V=function(){return this.b||(this.b=new _m(this.h,this.g)),this.b},_y.prototype.getTop=_y.prototype.na=function(){return this.i},_y.prototype.getBottom=_y.prototype.ha=function(){return this.h},_y.prototype.getLeft=_y.prototype.ja=function(){return this.f},_y.prototype.getRight=_y.prototype.ma=function(){return this.g},_y.prototype.getCenter=_y.prototype.F=function(){return this.c||(this.c=new _m(this.h+(this.i-this.h)/2,H0(this.f,this.A()))),this.c},_y.prototype.getWidth=_y.prototype.A=function(){return P0(this.f,this.g)},_y.prototype.getHeight=_y.prototype.G=function(){return this.i-this.h},_y.prototype.isCDB=_y.prototype.N=function(){return this.f>this.g},_y.prototype.isEmpty=_y.prototype.ra=function(){return!this.A()&&!this.G()},_y.prototype.getBoundingBox=_y.prototype.D=function(){return new _y(this.i,this.f,this.h,this.g)},_y.prototype.containsLatLng=_y.prototype.L=function($,_i,Fa){var _u=this.F();return Fa||($=L0($,this.L,0),_i=M0(_i,this.L,1)),($=(_i=this.B($,_i,Fa)).F()).lat===_u.lat&&$.lng===_u.lng&&this.G()===_i.G()&&this.A()===_i.A()},_y.prototype.containsPoint=_y.prototype.$=function($,_i){return _i||D0($,this.$,0),this.L($.lat,$.lng,_i)},_y.prototype.containsRect=_y.prototype.aa=function($,_i){var Fa=this.F();if(!(_i||$ instanceof _y))throw new n0(this.aa,0,$);return($=(_i=this.J($,_i)).F()).lat===Fa.lat&&$.lng===Fa.lng&&this.G()===_i.G()&&this.A()===_i.A()},_y.prototype.mergeLatLng=_y.prototype.B=function($,_i,Fa,_u){if(!Fa){if(g0($=L0($)))throw new n0(this.B,0,$);if(g0(_i=M0(_i)))throw new n0(this.B,1,_i)}return $0(this.i,this.f,this.h,this.g,$,_i,$,_i,_u)},_y.prototype.mergePoint=_y.prototype.ca=function($,_i,Fa){return _i||D0($,this.ca,0),this.B($.lat,$.lng,_i,Fa)},_y.prototype.mergeRect=_y.prototype.J=function($,_i,Fa){if(!(_i||$ instanceof _y))throw new n0(this.J,0,$);return $0(this.i,this.f,this.h,this.g,$.i,$.f,$.h,$.g,Fa)},_y.prototype.mergeTopLeftBottomRight=_y.prototype.C=function($,_i,Fa,_u,_c,_f){return _c||($=L0($,this.C,0),_i=M0(_i,this.C,1),Fa=L0(Fa,this.C,2),_u=M0(_u,this.C,3)),$0(this.i,this.f,this.h,this.g,$,_i,Fa,_u,_f)},_y.prototype.intersects=_y.prototype.ba=function($,_i){var Fa=this.f<=this.g,_u=$.f<=$.g,_c=this.f<$.g,_f=$.f<this.g;if(!(_i||$ instanceof _y))throw new n0(this.ba,0,$);return this.h<=$.i&&$.h<=this.i&&(!Fa&&(!_u||_c||_f)||!_u&&(_c||_f)||_c&&_f)},_y.merge=$0,_y.fromPoints=V0,_y.coverPoints=function $(_i,Fa){var _u=1,_c=_i.length,_f=null,sy=d(_i);if(sy!="array"&&(sy!="object"||typeof _i.length!="number"))throw new n0($,0,_i);if(0<_c)for(_f=V0(sy=_i[0],sy,Fa);_u<_c;_u++)sy=_i[_u],_f.B(sy.lat,sy.lng,Fa,_f);return _f},_y.coverLatLngAlts=function $(_i,Fa){var _u,_c=3,_f=_i.length;if(!(Fa||_i&&_i.length!=null))throw new n0($,0,_i);if(0<_f)for(_u=new _y(_i[0],_i[1],_i[0],_i[1]);_c<_f;_c+=3)_u.B(_i[_c],_i[_c+1],Fa,_u);return _u},_y.coverRects=function $(_i,Fa){var _u,_c=1,_f=_i.length;if(Fa&&(!_i||_i.length==null))throw new n0($,0,_i);if(0<_f)for(_u=new _y(_i[0].i,_i[0].f,_i[0].h,_i[0].g);_c<_f;_c++)_u.J(_i[_c],Fa,_u);return _u},_y.prototype.resizeToCenter=_y.prototype.da=function($,_i){var Fa=this.f,_u=this.i,_c=this.g,_f=this.h,sy=this.F().lng;D0($,this.da,0);var ty=$.lat-_f-(_u-_f)/2,hy=$.lng-sy;return $=($=Fa+((hy=180<hy||hy<-180?-(sy+$.lng):hy)<0?2*hy:0))<-180?360+$:$,_c=180<(_c+=0<hy?2*hy:0)?_c-360:_c,90<=(_u=0<ty?_u+2*ty:_u)&&(_u=90),(_f=ty<0?_f+2*ty:_f)<=-90&&(_f=-90),_i?t_(_i,_u,$,_f,_c):new _y(_u,$,_f,_c)},_y.prototype.l="Polygon",_y.prototype.u=function(){return[[this.f,this.i,0],[this.g,this.i,0],[this.g,this.h,0],[this.f,this.h,0],[this.f,this.i,0]]},_y.prototype.U=function(){return this.j()},_y.prototype.j=function(){return[this.i,this.f,this.h,this.g]},U0.prototype.remove=function($){var _i,Fa,_u,_c,_f,sy,ty=!1;if($&&(_i=$.a)&&_i.b===this&&(Fa=_i.entries)&&0<=(_u=Fa.indexOf($))){for(Fa.splice(_u,1),Fa=this.a;_i;)(_c=_i.entries)&&_c.length||(_c&&delete _i.entries,_i.a||!(_f=_i.c))?_i=Q0:((_u=_f)[sy=(ty=_i).j]===ty&&(delete _u[sy],delete ty.c,--_u.a),Fa===_i&&(Fa=_f),_i=_f);this.a!==Fa&&(this.a=Fa,e_(this)),c_(this,$,!1),ty=!0}return ty},U0.prototype.flush=function(){var $=new W0(null,NaN,this.j-this.m,this.l-this.u,this.j+this.m,this.l+this.u);($.b=this).a=this.b=$,this.c=null},U0.prototype.o=function($,_i,Fa,_u,_c,_f){var sy=[],ty=this.a,hy=this.b;return $<=ty[5]&&_i<=ty[6]&&(_c?Fa>=ty[7]:Fa>ty[7])&&(_f?_u>=ty[4]:_u>ty[4])&&function Ay(ky,Ly,Hy,Yy,i0,Ry,Oy,Py,Dy){var Xy,_v=Ly.entries,Ky=Ly[7],Zy=Ly[4],qy=Ly[5],S0=Ly[6],u0=Ly[8],R0=Ly[9];if(_v){var O0=_v.length;if(Zy<i0||Ky<Yy||Oy<S0||Ry<qy)for(;O0--;){Ky=_v[O0],Zy=Ky[3],qy=Ky[0],S0=Ky[1];var w_=Ky[2];i0<=w_&&Yy<=S0&&(qy<Oy||Py&&qy==Oy)&&(Zy<Ry||Dy&&Zy==Ry)&&Hy.push(Ky)}else for(;O0--;)Hy.push(_v[O0])}(u0<Ry||Dy&&Ry==u0)&&(i0<R0&&(Xy=Ly[1])&&Ay(ky,Xy,Hy,Yy,i0,Ry,Oy,Py,Dy),(R0<Oy||Py&&Oy==R0)&&(Xy=Ly[3])&&Ay(ky,Xy,Hy,Yy,i0,Ry,Oy,Py,Dy)),Yy<u0&&(i0<R0&&(Xy=Ly[0])&&Ay(ky,Xy,Hy,Yy,i0,Ry,Oy,Py,Dy),(R0<Oy||Py&&Oy==R0)&&(Xy=Ly[2])&&Ay(ky,Xy,Hy,Yy,i0,Ry,Oy,Py,Dy))}(this,ty,sy,$,_i,Fa,_u,_f||_u>=hy[6],_c||Fa>=hy[5]),sy};var h_=0;function W0($,_i,Fa,_u,_c,_f){this.j=_i,$&&(this.c=$,this.b=$.b,_c=1&_i?(Fa=$[8],$[5]):(Fa=$[7],$[8]),_f=2&_i?(_u=$[9],$[6]):(_u=$[4],$[9])),this[7]=Fa,this[5]=_c,this[8]=(Fa+_c)/2,this[4]=_u,this[6]=_f,this[9]=(_u+_f)/2}function r_($,_i,Fa,_u,_c,_f){r_.ua.constructor.apply(this,arguments)}function p_($,_i,Fa,_u,_c,_f,sy){var ty,hy,Ay=_i[8],ky=_i[9];return sy&&(_c<Ay||(ty=Ay<=Fa))&&(_f<ky||(hy=ky<=_u))?Fa=(Ay=p_)($,_i=_i[ty|=hy<<1]||(++_i.a,_i[ty]=new W0(_i,ty)),Fa,_u,_c,_f,sy-1):(_u=Fa=new f_(Fa,_u,_c,_f),(_i.entries||(_i.entries=[])).push(_u),_u.a=_i,c_($,Fa,!0),e_($,_i)),Fa}function f_($,_i,Fa,_u){this.id=h_++,this[0]=_i,this[1]=Fa,this[2]=_u,this[3]=$}function N0($){this.l=new r_(+$||10,180,90,0,0,!0),this.j=[],this.m=!1,this.a=this.b=this.c=null}function d_($,_i,Fa,_u,_c,_f){if(_f)_f=new f_(_c,-_i,Fa+360,-_u),$.j.push(_f),$.m=!0,$.a&&$.a.C(_i,Fa,_u,_c,!0,$.a);else{var sy=-_i,ty=-_u,hy=(_f=$.l).b,Ay=hy[5],ky=hy[6];if(!(hy[7]<=Fa&&hy[4]<=sy&&(_c<Ay||Ay===_c&&Ay===hy.b.b[5])&&(ty<ky||ky===ty&&ky===hy.b.b[6])))throw Error("Coordinates out of bounds");_f=p_(_f,_f.b,Fa,sy,_c,ty,_f.sa),$.b&&$.b.C(_i,Fa,_u,_c,!0,$.b)}return $.c=null,_f}function Y0($,_i,Fa,_u,_c,_f,sy){var ty=($=$.j).length,hy=[];if(ty)for(var Ay=Fa+360,ky=_c+360;ty--;){var Ly=$[ty];(i_(Ly,_i,Fa,_u,_c,_f,sy)||i_(Ly,_i,Ay,_u,ky,_f,sy))&&hy.push(Ly)}return hy}function i_($,_i,Fa,_u,_c,_f,sy){var ty=$[3],hy=$[0],Ay=$[1];return $=$[2],(_f?hy<=_u:hy<_u)&&(sy?ty<=_c:ty<_c)&&_i<=$&&Fa<=Ay}function q0($,_i){var Fa,_u;if(Fa=_i.length){for(var _c=$.length,_f={};_c--;)_f[$[_c].id]=1;for(;Fa--;)(_u=_i[Fa]).id in _f||$.push(_u)}}function v0(){}function o0($,_i,Fa){if(this.l=[],_i&&this.K(_i),Fa&&!y(Fa))throw new n0(o0,2,Fa);this.b=0,this.m=Fa,this.a={},this.j=this.c=null,this.Z($)}function X0($,_i){return _i&&($.c=Z0($,_i,$.c)),_i}function K0($){for(;$.b>$.u&&$.j;)j0($,$.j,!0)}function Z0($,_i,Fa){return Fa!==_i&&((_i.H||_i.v)&&j0($,_i,!1),(_i.H=Fa)&&(_i.v=Fa.v,Fa.v=_i),_i.v||($.c=_i),_i.H||($.j=_i),$.b+=_i.size),_i}function j0($,_i,Fa){var _u=_i.v,_c=_i.H;(_u||_c||_i==$.c&&_i==$.j)&&(_u?_u.H=_c:$.c=_c,_c?_c.v=_u:$.j=_u,$.b-=_i.size,Fa&&(delete $.a[_i.id],n_($,_i))),_i.H=_i.v=null}function n_($,_i){for(var Fa=$.l.length;Fa--;)$.l[Fa].call($,_i.id,_i.data,_i.size)}W0.prototype.a=0,m(r_,U0),v("H.geo.QuadTree",N0),N0.prototype.N=function(){return this.m},N0.prototype.D=function(){var $;if(!this.c){var _i,Fa,_u=[];if((sy=!this.b)&&(ty=(_f=this.l).c,_f.I&&!ty&&((sy=_f.a).entries||sy[0]||sy[1]||sy[2]||sy[3])&&(ty=function Ay(ky,Ly){for(var Hy,Yy,i0=0,Ry=3;0<=Ry;Ry--){for(var Oy=Ry+4,Py=0<Ry%3,Dy=[],Xy=Ly[Ry],_v=ky[Ry],Ky=_v.length;Ky--;){var Zy=_v[Ky];if(Hy=Zy.entries)for(Yy=Hy.length;Yy--;){var qy=Hy[Yy][Ry];(Py?Xy<qy:qy<Xy)&&(Xy=qy)}for(Yy=4;Yy--;)(Hy=Zy[Yy])&&(Py?Hy[Oy]>Xy:Hy[Oy]<Xy)&&Dy.push(Hy)}i0+=Dy.length,Ly[Ry]=Xy,ky[Ry]=Dy}return i0&&(Ly=Ay(ky,Ly)),Ly}([ty=[sy],ty,ty,ty],[sy[6],sy[7],sy[4],sy[5]]),_f.c=ty),sy=_f=ty),sy&&(this.b=new _y(-_f[0],_f[3],-_f[2],_f[1])),($=this.b)&&_u.push($),!this.a&&(Fa=(_i=this.j).length)){for(sy=360,ty=-(_f=90),hy=0;Fa--;)var _c=_i[Fa],_f=I(_f,_c[0]),sy=I(sy,_c[3]),ty=V(ty,_c[2]),hy=V(hy,_c[1]);this.a=new _y(-_f,sy,-ty,hy-360)}($=this.a)&&_u.push($),($=_u[0])&&(_u[1]&&($=$.J(_u[1],!0)),this.c=$)}return this.c},N0.prototype.insertBoundingBox=N0.prototype.oa=function($){var _i=$.W(),Fa=$.V();return($=$.N())?d_(this,_i.lat,Fa.lng,Fa.lat,_i.lng,$):d_(this,_i.lat,_i.lng,Fa.lat,Fa.lng,$)},N0.prototype.remove=function($){var _i,Fa;return $.a?(Fa=this.l.remove($),this.b=null):(Fa=0<=($=(_i=this.j).indexOf($)))&&(_i.splice($,1),this.m=0<_i.length,this.a=null),Fa&&(this.c=null),Fa},N0.prototype.intersectBoundingBox=N0.prototype.pa=function($,_i,Fa){var _u=this.l,_f=$.W(),ty=$.V(),_c=-_f.lat,_f=_f.lng,sy=-ty.lat,ty=ty.lng;return!_i&&_c==sy||!Fa&&_f===ty?$=[]:$.N()?(q0($=_u.o(-180,_c,ty,sy,Fa,_i),_u.o(_f,_c,180,sy,!1,_i)),q0($,Y0(this,_c,ty,sy,_f+360,_i,Fa))):q0($=_u.o(_f,_c,ty,sy,Fa,_i),Y0(this,_c,_f,sy,ty,_i,Fa)),$},v("H.util.ICache",v0),v0.prototype.add=function(){},v0.prototype.get=function(){},v0.prototype.drop=v0.prototype.S=function(){},v0.prototype.forEach=function(){},v0.prototype.removeAll=v0.prototype.Y=function(){},v0.prototype.registerOnDrop=v0.prototype.K=function(){},v0.prototype.deRegisterOnDrop=v0.prototype.P=function(){},v("H.util.Cache",o0),o0.prototype.add=function($,_i,Fa){var _u,_c;if(!F0(Fa=+Fa)||Fa<0)throw new n0(this.add,2,Fa);return $=String($),(_c=!this.m||this.m($,_i,Fa))&&((_u=this.a[$])?(_u.data!==_i&&n_(this,_u),this.b+=Fa-_u.size,_u.size=Fa,_u.data=_i,X0(this,_u)):this.a[$]=Z0(this,{id:$,data:_i,size:Fa,H:null,v:null},this.c),K0(this)),_c},o0.prototype.registerOnDrop=o0.prototype.K=function($){if(!y($))throw new n0(this.K,0,$);this.l.push($)},o0.prototype.deRegisterOnDrop=o0.prototype.P=function($){this.l=this.l.filter(function(_i){return _i!==$})},o0.prototype.get=function($,_i){return($=_i?this.a[$]:X0(this,this.a[$]))&&$.data},o0.prototype.drop=o0.prototype.S=function($){var _i;(_i=this.a[$])&&j0(this,_i,!0)},o0.prototype.forEach=function($,_i,Fa){var _u;for(_u in this.a){var _c=this.a[_u];Fa&&!Fa(_u,_c.data,_c.size)||$.call(_i,_u,_c.data,_c.size)}},o0.prototype.removeAll=o0.prototype.Y=function($){var _i;for(_i in this.a){var Fa=this.a[_i];$&&!$(_i,Fa.data,Fa.size)||j0(this,this.a[_i],!0)}},o0.prototype.setMaxSize=o0.prototype.Z=function($){if(!(0<+$))throw new n0(o0.prototype.Z,0,$);return this.u=+$,K0(this),this},o0.prototype.getMaxSize=o0.prototype.ka=function(){return this.u},o0.prototype.getCurrentSize=o0.prototype.ia=function(){return this.b}}).call(ns);var MathUtils$1=MathUtils={},Geo;function _xyToArr(e){return[e.x,e.y]}function _arrToXy(e){return _construct(ns.H.math.Point,_toConsumableArray(e))}MathUtils.clipPolygon=function(e,r){var n,o,s=[],l=ns.H.math.clipping.clipPolygon(e.map(_arrToXy),r.map(_arrToXy));if(l)do{for(n=[],o=l;n.push(_xyToArr(o)),o=o.next;);s.push(n)}while(l=l.nextPoly);else MathUtils.isPointInsidePolygon(r[0],e)?s.push(r):MathUtils.isPointInsidePolygon(e[0],r)&&s.push(e);return s},MathUtils.isPointInsidePolygon=function(e,r){return ns.H.math.isPointInsidePolygon({x:e[0],y:e[1]},ns.H.math.flatten(r))},MathUtils.clamp=function(e,r,n){return(e-=0)>n?n:e<r?r:e},MathUtils.splitLegs=function(e,r){var n=[];e.push(e[0]);for(var o=0;o<e.length-1;o++){var s,l=e[o],h=e[o+1];n.push(l),Math.abs(h[0]-l[0])>=r&&(s=[(l[0]+h[0])/2,(l[1]+h[1])/2],n.push(s))}return n.length!==e.length-1?MathUtils.splitLegs(n,r):n},MathUtils.getBBox=function(e){var r=1/0,n=1/0,o=-1/0,s=-1/0;return e.forEach(function(l){l[0]<r&&(r=l[0]),l[1]<n&&(n=l[1]),l[0]>o&&(o=l[0]),l[1]>s&&(s=l[1])}),[r,n,o,s]},MathUtils.getBBoxCenter=function(e){var r=_slicedToArray(e,4),n=r[0],o=r[1];return[n+(r[2]-n)/2,o+(r[3]-o)/2]},MathUtils.getLineLength=function(e,r,n,o){return Math.sqrt(Math.pow(e-n,2)+Math.pow(r-o,2))},MathUtils.modulo=function(e,r){var n;return(n=e%r)<0==r<0?n:n+r};var Geo$1=Geo={};Geo.default_source_max_zoom=18,Geo.default_view_max_zoom=20,Geo.tile_size=256,Geo.half_circumference_meters=20037508342789244e-9,Geo.circumference_meters=2*Geo.half_circumference_meters,Geo.min_zoom_meters_per_pixel=Geo.circumference_meters/Geo.tile_size;var meters_per_pixel=[];Geo.metersPerPixel=function(e){return meters_per_pixel[e]=meters_per_pixel[e]||Geo.min_zoom_meters_per_pixel/Math.pow(2,e),meters_per_pixel[e]};var meters_per_tile=[];Geo.metersPerTile=function(e){return meters_per_tile[e]=meters_per_tile[e]||Geo.circumference_meters/Math.pow(2,e),meters_per_tile[e]},Geo.tile_scale=4096,Geo.units_per_pixel=Geo.tile_scale/Geo.tile_size,Geo.height_scale=16;var units_per_meter=[];Geo.unitsPerMeter=function(e){return units_per_meter[e]=units_per_meter[e]||Geo.tile_scale/(Geo.tile_size*Geo.metersPerPixel(e)),units_per_meter[e]},Geo.metersForTile=function(e){return{x:e.x*Geo.circumference_meters/Math.pow(2,e.z)-Geo.half_circumference_meters,y:-(e.y*Geo.circumference_meters/Math.pow(2,e.z)-Geo.half_circumference_meters)}},Geo.tileForMeters=function(e,r){var n=_slicedToArray(e,2),o=n[0],s=n[1];return{x:Math.floor((o+Geo.half_circumference_meters)/(Geo.circumference_meters/Math.pow(2,r))),y:Math.floor((-s+Geo.half_circumference_meters)/(Geo.circumference_meters/Math.pow(2,r))),z:r}},Geo.metersToExactTileCoords=function(e,r){var n=_slicedToArray(e,2),o=n[0],s=n[1];return{x:Math.pow(2,r-1)*(1+o/Geo.half_circumference_meters),y:Math.pow(2,r-1)*(1-s/Geo.half_circumference_meters),z:r}},Geo.wrapTile=function(e){var r=e.x,n=e.y,o=e.z,s=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{x:!0,y:!1},l=(1<<o)-1;return s.x&&(r&=l),s.y&&(n&=l),{x:r,y:n,z:o}},Geo.wrapMeters=function(e){var r=e.x,n=e.y;return{x:MathUtils$1.modulo(r+Geo.half_circumference_meters,Geo.circumference_meters)-Geo.half_circumference_meters,y:n}},Geo.metersToLatLng=function(e){var r=_slicedToArray(e,2),n=r[0],o=r[1];return n/=Geo.half_circumference_meters,o/=Geo.half_circumference_meters,o=(2*Math.atan(Math.exp(o*Math.PI))-Math.PI/2)/Math.PI,[n*=180,o*=180]},Geo.latLngToMeters=function(e){var r=_slicedToArray(e,2),n=r[0],o=r[1],o=Math.log(Math.tan(o*Math.PI/360+Math.PI/4))/Math.PI;return o*=Geo.half_circumference_meters,o=Math.min(Math.max(o,-Geo.half_circumference_meters),Geo.half_circumference_meters),[n*=Geo.half_circumference_meters/180,o]},Geo.tileSpaceToMeters=function(e,r,n){var o=_slicedToArray(e,2),s=o[0],l=o[1],h=Geo.unitsPerMeter(r);return[s/h+n.x,l/h+n.y]},Geo.tileSpaceToLatlng=function(e,r,n){var o=Geo.unitsPerMeter(r);return Geo.transformGeometry(e,function(s){s[0]=s[0]/o+n.x,s[1]=s[1]/o+n.y;var l=_slicedToArray(Geo.metersToLatLng(s),2),h=l[0],d=l[1];s[0]=h,s[1]=d}),e},Geo.copyGeometry=function(e){if(e!=null){var r={type:e.type};return e.type==="Point"?r.coordinates=[e.coordinates[0],e.coordinates[1]]:e.type==="LineString"||e.type==="MultiPoint"?r.coordinates=e.coordinates.map(function(n){return[n[0],n[1]]}):e.type==="Polygon"||e.type==="MultiLineString"?r.coordinates=e.coordinates.map(function(n){return n.map(function(o){return[o[0],o[1]]})}):e.type==="MultiPolygon"&&(r.coordinates=e.coordinates.map(function(n){return n.map(function(o){return o.map(function(s){return[s[0],s[1]]})})})),r}},Geo.transformGeometry=function(e,r){e!=null&&(e.type==="Point"?r(e.coordinates):e.type==="LineString"||e.type==="MultiPoint"?e.coordinates.forEach(r):e.type==="Polygon"||e.type==="MultiLineString"?e.coordinates.forEach(function(n){return n.forEach(r)}):e.type==="MultiPolygon"&&e.coordinates.forEach(function(n){n.forEach(function(o){return o.forEach(r)})}))},Geo.boxIntersect=function(e,r){return!(r.sw.x>e.ne.x||r.ne.x<e.sw.x||r.sw.y>e.ne.y||r.ne.y<e.sw.y)},Geo.findBoundingBox=function(e){for(var r=1/0,n=-1/0,o=1/0,s=-1/0,l=e[0].length,h=0;h<l;h++){var d=e[0][h];d[0]<r&&(r=d[0]),d[1]<o&&(o=d[1]),d[0]>n&&(n=d[0]),d[1]>s&&(s=d[1])}return[r,o,n,s]},Geo.geometryType=function(e){return e==="Polygon"||e==="MultiPolygon"?"polygon":e==="LineString"||e==="MultiLineString"?"line":e==="Point"||e==="MultiPoint"?"point":void 0},Geo.centroid=function(e){var r=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1];if(e&&e.length!==0){var n,o=0,s=0,l=0,h=e[0],d=h.length;r&&(n=h[0],h=h.map(function(V){return[V[0]-n[0],V[1]-n[1]]}));for(var y=0,g=d-1;y<d;g=y,y++){var v=h[y],m=h[g],w=v[1]*m[0]-m[1]*v[0];o+=(v[0]+m[0])*w,s+=(v[1]+m[1])*w,l+=3*w}var I=[o/l,s/l];return r&&(I[0]+=n[0],I[1]+=n[1]),I}},Geo.multiCentroid=function(e){for(var r=e.length,n=[0,0],o=0;o<e.length;o++){var s=Geo.centroid(e[o]);n[0]+=s[0],n[1]+=s[1]}return n[0]/=r,n[1]/=r,n},Geo.signedPolygonRingAreaSum=function(e){for(var r=0,n=e.length,o=0;o<n-1;o++){var s=e[o],l=e[o+1];r+=s[0]*l[1]-l[0]*s[1]}return r+=e[n-1][0]*e[0][1]-e[0][0]*e[n-1][1]},Geo.polygonRingArea=function(e){return Math.abs(Geo.signedPolygonRingAreaSum(e))/2},Geo.polygonArea=function(e){if(e)return Geo.polygonRingArea(e[0])},Geo.multiPolygonArea=function(e){for(var r=0,n=0;n<e.length;n++)r+=Geo.polygonArea(e[n]);return r},Geo.ringWinding=function(e){var r=Geo.signedPolygonRingAreaSum(e);return 0<r?"CW":r<0?"CCW":void 0},Geo.getTileBoundingBox=function(e,r){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,o=Geo.wrapTile(e,{x:!0}),s=Geo.metersForTile(o),l=Geo.metersPerPixel(o.z),h=Geo.metersToLatLng([s.x-n*l,s.y+n*l]),d=Geo.metersToLatLng([s.x+(r+n)*l,s.y-(r+n)*l]),y=Geo.isLastTile(o);return new ns.H.geo.Rect(e.y===0?90:MathUtils$1.clamp(h[1],-90,90),MathUtils$1.clamp(h[0],-180,180),y.row?-90:MathUtils$1.clamp(d[1],-90,90),y.column?180:MathUtils$1.clamp(d[0],-180,180))},Geo.isLastTile=function(e){var r=e.x,n=e.y,o=e.z;return{row:n===Math.pow(2,o)-1,column:r===Math.pow(2,o)-1}};var MethodNotImplemented=function(){_inherits(r,_wrapNativeSuper(Error));var e=_createSuper(r);function r(n){var o;return _classCallCheck(this,r),(o=e.call(this)).name="MethodNotImplemented",o.message="Method "+n+" must be implemented in subclass",o}return r}(),is_worker=!1,is_main=!1,force_main,force_worker;try{window.document!==HTMLDocument&&(is_main=!0)}catch(e){self!==void 0&&(is_worker=!0,self.window={document:{}},self.document=self.window.document)}var Thread={get is_fake_worker(){return self.is_fake_worker},get is_worker(){return force_worker!==void 0?force_worker:is_worker||self.is_fake_worker},set is_worker(e){force_worker=e},get is_main(){return force_main!==void 0?force_main:is_main&&!self.is_fake_worker},set is_main(e){force_main=e},is_native_worker:is_worker},WorkerBroker={},message_id=0,messages={},targets={},main_worker_targets={};function findTarget(e,r){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:targets,o=[];if(typeof e=="string"&&(e=(o=e.split(".")).pop()),Thread.is_main&&r&&o.length===1&&o[0]==="self")n=r;else for(var s=0;s<o.length;s++){if(!n[o[s]])return[];n=n[o[s]]}return[e,n]}WorkerBroker.addTarget=function(e,r){Thread.is_fake_worker?main_worker_targets[e]=r:targets[e]=r},WorkerBroker.removeTarget=function(e){delete targets[e],delete main_worker_targets[e]};var ERROR_NO_TARGET=" No object with that name is registered on main thread.",ERROR_NO_METHOD=" Object has no method with that name.",ERROR_NOT_SET="_worker_broker_error_not_set_";function setupMainThread(){WorkerBroker.postMessage=function(e,r){for(var n=arguments.length,o=new Array(2<n?n-2:0),s=2;s<n;s++)o[s-2]=arguments[s];if(Array.isArray(e))return Promise.all(e.map(function(m){return WorkerBroker.postMessage.apply(WorkerBroker,[m,r].concat(_toConsumableArray(o)))}));var l,h={};_typeof(r)==="object"&&(r=(h=r).method);var d="main_send";typeof e=="string"?(r=e,o=Array.prototype.slice.call(arguments,1),l=!0,d="worker_send"):e.init&&(l=!0);var y,g=[];if(o&&o.length===1&&o[0]instanceof WorkerBroker.withTransferables&&(g=o[0].transferables,o=o[0].value),y={type:d,message_id:++message_id,method:r,message:o},l)return function(m,w){var I=m.type,V=_slicedToArray(findTarget(m.method,w,I==="main_send"?main_worker_targets:targets),2),q=V[0],De=V[1],_n="Worker broker could not dispatch message type ".concat(m.method," on target ").concat(m.target,".");if(!De)throw Error(_n+ERROR_NO_TARGET);var ha=typeof De[q]=="function"&&De[q];if(!ha)throw Error(_n+ERROR_NO_METHOD);return new Promise(function(ga,_o){var _l;try{_l=ha.apply(De,m.message)}catch(wc){return void _o(wc)}_l instanceof Promise?_l.then(function(wc){wc instanceof WorkerBroker.withTransferables&&(wc=wc.value[0]),ga(wc)},function(wc){_o(wc instanceof Error?"".concat(wc.message,": ").concat(wc.stack):wc)}):(_l instanceof WorkerBroker.withTransferables&&(_l=_l.value[0]),ga(_l))})}(y,e&&e.init?e:void 0);var v=new Promise(function(m,w){messages[message_id]={method:r,message:o,resolve:m,reject:w}});return h.stringify&&(y=JSON.stringify(y)),e.postMessage(y,g.map(function(m){return m.object})),freeTransferables(g),v},WorkerBroker.addWorker=function(e){if(!(e instanceof Worker))throw Error("Worker broker could not add non-Worker object",e);e.addEventListener("message",function(r){var n=typeof r.data=="string"?JSON.parse(r.data):r.data,o=n.message_id;if(n.type==="worker_reply")messages[o]&&(n.error?messages[o].reject(n.error):messages[o].resolve(n.message),delete messages[o]);else if(n.type==="worker_send"&&o!=null){var s=_slicedToArray(findTarget(n.method),2),l=s[0],h=s[1],d="Worker broker could not dispatch message type ".concat(n.method," on target ").concat(n.target,".");if(!h)throw Error(d+ERROR_NO_TARGET);var y=typeof h[l]=="function"&&h[l];if(!y)throw Error(d+ERROR_NO_METHOD);var g,v=ERROR_NOT_SET;try{g=y.apply(h,n.message)}catch(I){v=I}var m,w=[];g&&typeof g.then=="function"?g.then(function(I){I instanceof WorkerBroker.withTransferables&&(w=I.transferables,I=I.value[0]),m={type:"main_reply",message_id:o,message:I},e.postMessage(m,w.map(function(V){return V.object})),freeTransferables(w)},function(I){e.postMessage({type:"main_reply",message_id:o,error:I instanceof Error?"".concat(I.message,": ").concat(I.stack):I})}):(g instanceof WorkerBroker.withTransferables&&(w=g.transferables,g=g.value[0]),m={type:"main_reply",message_id:o,message:g,error:v instanceof Error?"".concat(v.message,": ").concat(v.stack):v},e.postMessage(m,w.map(function(I){return I.object})),freeTransferables(w))}})},WorkerBroker.getMessages=function(){return messages},WorkerBroker.getMessageId=function(){return message_id}}function setupWorkerThread(){WorkerBroker.postMessage=function(e){for(var r=arguments.length,n=new Array(1<r?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];var s={};_typeof(e)==="object"&&(e=(s=e).method);var l,h=new Promise(function(y,g){messages[message_id]={method:e,message:n,resolve:y,reject:g}}),d=[];return n&&n.length===1&&n[0]instanceof WorkerBroker.withTransferables&&(d=n[0].transferables,n=n[0].value),l={type:"worker_send",message_id,method:e,message:n},s.stringify&&(l=JSON.stringify(l)),self.postMessage(l,d.map(function(y){return y.object})),freeTransferables(d),message_id++,h},self.addEventListener("message",function(e){var r=typeof e.data=="string"?JSON.parse(e.data):e.data,n=r.message_id;if(r.type==="main_reply")messages[n]&&(r.hasOwnProperty("error")&&r.error!==ERROR_NOT_SET?messages[n].reject(r.error):messages[n].resolve(r.message),delete messages[n]);else if(r.type==="main_send"&&n!=null){var o=_slicedToArray(findTarget(r.method),2),s=o[0],l=o[1],h="Worker broker could not dispatch message type ".concat(r.method," on target ").concat(r.target,".");if(!l)throw Error(h+ERROR_NO_TARGET);var d,y,g=typeof l[s]=="function"&&l[s];if(!g)throw Error(h+ERROR_NO_METHOD);try{d=g.apply(l,r.message)}catch(w){y=w}var v,m=[];d instanceof Promise?d.then(function(w){w instanceof WorkerBroker.withTransferables&&(m=w.transferables,w=w.value[0]),v={type:"worker_reply",message_id:n,message:w},self.postMessage(v,m.map(function(I){return I.object})),freeTransferables(m)},function(w){self.postMessage({type:"worker_reply",message_id:n,error:w instanceof Error?"".concat(w.message,": ").concat(w.stack):w})}):(d instanceof WorkerBroker.withTransferables&&(m=d.transferables,d=d.value[0]),v={type:"worker_reply",message_id:n,message:d,error:y instanceof Error?"".concat(y.message,": ").concat(y.stack):y},self.postMessage(v,m.map(function(w){return w.object})),freeTransferables(m))}})}function findTransferables(e){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:[];if(!e)return o;if(Array.isArray(e))e.forEach(function(l,h){return findTransferables(l,e,h,o)});else if(_typeof(e)==="object")if(e instanceof ArrayBuffer)o.push({object:e,parent:r,property:n});else if(e.buffer instanceof ArrayBuffer)o.push({object:e.buffer,parent:r,property:n});else for(var s in e)findTransferables(e[s],e,s,o);return o}function freeTransferables(e){Array.isArray(e)&&e.filter(function(r){return r.parent&&r.property}).forEach(function(r){return delete r.parent[r.property]})}WorkerBroker.withTransferables=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];if(!(this instanceof WorkerBroker.withTransferables))return _construct(WorkerBroker.withTransferables,r);this.value=r,this.transferables=findTransferables(this.value)},Thread.is_main&&setupMainThread(),Thread.is_worker&&setupWorkerThread();var LEVELS={silent:-1,error:0,warn:1,info:2,debug:3,trace:4},methods={},logged_once={},Utils;function methodForLevel(e){return methods[e]=methods[e]||(console[e]?console[e]:console.log).bind(console),methods[e]}function log(e){var r=_typeof(e)==="object"?e.level:e;if(LEVELS[r]<=LEVELS[log.level]){for(var n=arguments.length,o=new Array(1<n?n-1:0),s=1;s<n;s++)o[s-1]=arguments[s];if(Thread.is_native_worker)WorkerBroker.postMessage.apply(WorkerBroker,[{method:"_logProxy",stringify:!0},e].concat(o));else{if(_typeof(e)==="object"&&e.once===!0){if(logged_once[JSON.stringify(o)])return;logged_once[JSON.stringify(o)]=!0}var l=methodForLevel(r);1<o.length?l.apply(void 0,["Tangram [".concat(r,"]: ").concat(o[0])].concat(_toConsumableArray(o.slice(1)))):l("Tangram [".concat(r,"]: ").concat(o[0]))}}}function debounce(e,r,n){var o,s;return n=n||0,function(){var l=this,h=arguments;function d(){s=0,e.apply(l,h)}clearTimeout(o),s&&n&&Date.now()-s>=n?d():(s=s||Date.now(),o=setTimeout(function(){d()},r))}}log.level="info",log.workers=null,log.setLevel=function(e){log.level=e,Thread.is_main&&Array.isArray(log.workers)&&WorkerBroker.postMessage(log.workers,"_logSetLevelProxy",e)},Thread.is_main&&(log.setWorkers=function(e){log.workers=e},log.reset=function(){logged_once={}}),WorkerBroker.addTarget("_logProxy",log),WorkerBroker.addTarget("_logSetLevelProxy",log.setLevel);var Utils$1=Utils={};WorkerBroker.addTarget("Utils",Utils),Utils.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},Utils.isMicrosoft=function(){return/(Trident\/7.0|Edge[ /](\d+[\.\d]+))/i.test(navigator.userAgent)},Utils._requests={},Utils._proxy_requests={},Utils.io=function(e){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:6e4,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"text",o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:"GET",s=4<arguments.length&&arguments[4]!==void 0?arguments[4]:{},l=5<arguments.length&&arguments[5]!==void 0?arguments[5]:null,h=6<arguments.length&&arguments[6]!==void 0&&arguments[6];if(Thread.is_worker&&Utils.isMicrosoft())return log("debug","Proxying request for URL to worker",e),l&&(Utils._proxy_requests[l]=!0),WorkerBroker.postMessage("Utils.io",e,r,n,o,s,l,!0);var d=new XMLHttpRequest,y=(y=new Promise(function(g,v){d.open(o,e,!0),d.timeout=r,d.responseType=n,d.onload=function(){d.status===200?-1<["text","json"].indexOf(d.responseType)?g(d.responseText):g(d.response):v(Error("Request error with a status of "+d.statusText))},d.onerror=function(m){v(Error("There was a network error"+m.toString()))},d.ontimeout=function(m){v(Error("timeout "+m.toString()))},d.send()})).then(function(g){return l&&delete Utils._requests[l],h?WorkerBroker.withTransferables(g):g});return l&&(Utils._requests[l]=d),y},Utils.cancelRequest=function(e){if(Thread.is_worker&&Utils._proxy_requests[e])return WorkerBroker.postMessage("Utils.cancelRequest",e);Utils._requests[e]?(log("trace","Cancelling network request key '".concat(e,"'")),Utils._requests[e].abort(),delete Utils._requests[e]):log("trace","Could not find network request key '".concat(e,"'"))},Utils.requestAnimationFramePolyfill=function(){typeof window.requestAnimationFrame!="function"&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,16.666666666666668)})},Utils.serializeWithFunctions=function(e){return typeof e=="function"?e.toString():JSON.stringify(e,function(r,n){return typeof n=="function"?n.toString():n})},Utils.stringsToFunctions=function(e,r){if(typeof e=="string")e=Utils.stringToFunction(e,r);else if(e!=null&&_typeof(e)==="object")for(var n in e)e[n]=Utils.stringsToFunctions(e[n],r);return e},Utils._use_count=0,Utils._function_cache={};var _clear_function_cache=debounce(function(){log("trace","Cleared cached ".concat(Object.keys(Utils._function_cache).length," functions (reused ").concat(Utils._use_count," times)")),Utils._use_count=0,Utils._function_cache={}},1e4),FUNCTION_MATCH_RGX=/^\s*function[^(]*\(([^)]*)\)\s*?\{([\s\S]*)\}$/m,_createObjectURL,_revokeObjectURL;function addBaseURL(e,r){if(!e||!isRelativeURL(e))return e;var n,o=e[0]!=="/";return r?(n=document.createElement("a")).href=r:n=window.location,e=o?pathForURL(n.href)+e:(n.origin||n.protocol+"//"+n.host)+e}function pathForURL(e){if(typeof e!="string"||e.search(/^(data|blob):/)!==-1)return"";var r=e.indexOf("?");-1<r&&(e=e.substr(0,r));var n=e.indexOf("#");return-1<n&&(e=e.substr(0,n)),e.substr(0,e.lastIndexOf("/")+1)||""}function extensionForURL(e){var r=(e=e.split("/").pop()).lastIndexOf(".");if(-1<r)return e.substring(r+1)}function isRelativeURL(e){return typeof e=="string"&&!(-1<e.search(/^(http|https|data|blob):/)||e.substr(0,2)==="//")}function addParamsToURL(e,r){if(!r||Object.keys(r).length===0)return[e,[]];var n=e.indexOf("?"),o=e.indexOf("#"),s="";-1<o&&(s=e.slice(o),e=e.slice(0,o)),n===-1&&(n=e.length,e+="?"),n++;var l="",h=[];for(var d in r)getURLParameter(d,e)===""?l+="".concat(d,"=").concat(r[d],"&"):h.push([d,r[d]]);return[e=e.slice(0,n)+l+e.slice(n)+s,h]}function createObjectURL(e){return _createObjectURL===void 0&&typeof(_createObjectURL=window.URL&&window.URL.createObjectURL||window.webkitURL&&window.webkitURL.createObjectURL)!="function"&&(_createObjectURL=null,log("warn","window.URL.createObjectURL (or vendor prefix) not found, unable to create local blob URLs")),_createObjectURL?_createObjectURL(e):e}function revokeObjectURL(e){return _revokeObjectURL===void 0&&typeof(_revokeObjectURL=window.URL&&window.URL.revokeObjectURL||window.webkitURL&&window.webkitURL.revokeObjectURL)!="function"&&(_revokeObjectURL=null,log("warn","window.URL.revokeObjectURL (or vendor prefix) not found, unable to create local blob URLs")),_revokeObjectURL?_revokeObjectURL(e):e}function getURLParameter(e,r){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(r);return n===null?"":decodeURIComponent(n[1].replace(/\+/g," "))}Utils.stringToFunction=function(e,r){var n=e;r&&(n+=r.toString());var o=Utils._function_cache[n];if(_clear_function_cache(),o)return Utils._use_count++,o;var s=typeof e=="string"&&e.match(FUNCTION_MATCH_RGX);if(s&&2<s.length)try{var l=s[2],h=0<(h=0<s[1].length&&s[1].split(",").map(function(y){return y.trim()}).filter(function(y){return y})).length?h:["context"],d=new Function(h.toString(),typeof r=="function"?r(l):l);return Utils._function_cache[n]=d}catch{return e}return e},Utils.device_pixel_ratio=1,Utils.isPowerOf2=function(e){return(e&e-1)==0},Utils.interpolate=function(e,r,n){if(!Array.isArray(r)||!Array.isArray(r[0])||r.length<1)return r;var o,s,l,h,d;if(e<=r[0][0])h=r[0][1],typeof n=="function"&&(h=n(h));else if(e>=r[r.length-1][0])h=r[r.length-1][1],typeof n=="function"&&(h=n(h));else for(var y=0;y<r.length-1;y++)if(e>=r[y][0]&&e<r[y+1][0]){if(o=r[y][0],s=r[y+1][0],Array.isArray(r[y][1])){h=[];for(var g=0;g<r[y][1].length;g++)typeof n=="function"?(d=n(r[y][1][g]),l=n(r[y+1][1][g])-d,h[g]=l*(e-o)/(s-o)+d):(l=r[y+1][1][g]-r[y][1][g],h[g]=l*(e-o)/(s-o)+r[y][1][g])}else h=typeof n=="function"?(d=n(r[y][1]),(l=n(r[y+1][1])-d)*(e-o)/(s-o)+d):(l=r[y+1][1]-r[y][1])*(e-o)/(s-o)+r[y][1];break}return h},Utils.toCSSColor=function(e){return e[3]===1?"rgb(".concat(e.slice(0,3).map(function(r){return Math.round(255*r)}).join(", "),")"):"rgba(".concat(e.map(function(r,n){return n<3&&Math.round(255*r)||r}).join(", "),")")},Utils.pointInTile=function(e){return 0<=e[0]&&e[1]>-Geo$1.tile_scale&&e[0]<Geo$1.tile_scale&&e[1]<=0},Utils.zoomToTileLevel=function(e){return Math.floor(e)};var DataSource=function(){function e(r,n){var o=this;if(_classCallCheck(this,e),this.config=r,this.sources=n,this.id=r.id,this.name=r.name,this.pad_scale=r.pad_scale||1e-4,this.default_winding=null,this.rasters=[],Array.isArray(r.rasters)&&r.rasters.forEach(function(l){o.rasters.indexOf(l)===-1&&o.rasters.push(l)}),this.preprocess=r.preprocess,typeof this.preprocess=="function"&&this.preprocess.bind(this),this.transform=r.transform,typeof this.transform=="function")this.transform=this.transform.bind(this);else if(_typeof(this.transform)==="object")for(var s in this.transform)typeof this.transform[s]=="function"&&(this.transform[s]=this.transform[s].bind(this));this.extra_data=r.extra_data,this.scripts=r.scripts,this.max_zoom=r.max_zoom!=null?r.max_zoom:Geo$1.default_source_max_zoom,this.setTileSize(r.tile_size),this.max_coord_zoom=this.max_zoom+this.zoom_bias,this.min_display_zoom=r.min_display_zoom!=null?r.min_display_zoom:0,this.max_display_zoom=r.max_display_zoom!=null?r.max_display_zoom:null,this._has_volatile_data=!!r.has_volatile_data}return _createClass(e,[{key:"hasLabeledData",value:function(){return!0}},{key:"_transformTile",value:function(r){if(r.source_data.layers){var n={coords:r.coords},o=[];if(typeof this.transform=="function")o.push(this.transform);else if(_typeof(this.transform)==="object")for(var s=Object.keys(this.transform).sort(),l=0;l<s.length;l++)o.push(this.transform[s[l]]);for(var h=Object.keys(r.source_data.layers).length===1&&r.source_data.layers._default,d=0;d<o.length;d++)h?r.source_data.layers._default=o[d](r.source_data.layers._default,this.extra_data,n):r.source_data.layers=o[d](r.source_data.layers,this.extra_data,n)}}},{key:"_postProcessTile",value:function(r){var n=this;for(var o in this._transformTile(r),r.source_data.layers){var s=r.source_data.layers[o];s&&s.features&&s.features.forEach(function(l){Geo$1.transformGeometry(l.geometry,function(h){h[1]=-h[1],n.pad_scale&&(h[0]=Math.round(h[0]*(1+n.pad_scale)-Geo$1.tile_scale*n.pad_scale/2),h[1]=Math.round(h[1]*(1+n.pad_scale)-Geo$1.tile_scale*n.pad_scale/2))}),n.updateDefaultWinding(l.geometry)})}r.default_winding=this.default_winding||"CCW"}},{key:"load",value:function(r){return r.source_data={},r.source_data.layers={},r.pad_scale=this.pad_scale,r.rasters=_toConsumableArray(this.rasters),this._load(r)}},{key:"_load",value:function(){throw new MethodNotImplemented("_load")}},{key:"setTileSize",value:function(r){this.tile_size=r||256,(typeof this.tile_size!="number"||this.tile_size<256||!Utils$1.isPowerOf2(this.tile_size))&&(log({level:"warn",once:!0},"Data source '".concat(this.name,"': 'tile_size' parameter must be a number that is a power of 2 greater than or equal to 256, but was '").concat(r,"'")),this.tile_size=256),this.zoom_bias=Math.log2(this.tile_size)-8}},{key:"updateDefaultWinding",value:function(r){return this.default_winding==null&&(r.type==="Polygon"?this.default_winding=Geo$1.ringWinding(r.coordinates[0]):r.type==="MultiPolygon"&&(this.default_winding=Geo$1.ringWinding(r.coordinates[0][0]))),this.default_winding}},{key:"includesTile",value:function(r,n){if(r.z<this.min_display_zoom||this.max_display_zoom!=null&&n>this.max_display_zoom)return!1;for(var o=0;o<this.rasters.length;o++){var s=this.rasters[o];if(this.sources[s]&&this.sources[s]!==this&&!this.sources[s].includesTile(r,r.z))return!1}return!0}},{key:"has_volatile_data",get:function(){return this._has_volatile_data},set:function(r){var n=0<arguments.length&&r!==void 0&&r;this._has_volatile_data=n}}],[{key:"create",value:function(r,n){for(var o in n)if(n[o].config.name===r.name&&e.sameConfig(n[o],{config:r}))return n[o];if(e.types[r.type])return new e.types[r.type](r,n)}},{key:"sameConfig",value:function(r,n){if(!r||!n)return!1;var o=Object.assign({},r.config,{id:null,tiled:null,url:null}),s=Object.assign({},n.config,{id:null,tiled:null,url:null});return JSON.stringify(o)===JSON.stringify(s)}},{key:"coordsToMeters",value:function(r){var n=_slicedToArray(Geo$1.latLngToMeters(r),2),o=n[0],s=n[1];r[0]=o,r[1]=s}},{key:"projectData",value:function(r){for(var n in r.layers)for(var o=r.layers[n].features.length,s=0;s<o;s++){var l=r.layers[n].features[s];Geo$1.transformGeometry(l.geometry,e.coordsToMeters)}}},{key:"metersToTileUnits",value:function(r,n,o){o[0]=Math.round((o[0]-n.x)*r),o[1]=-1*Math.round((o[1]-n.y)*r)}},{key:"scaleData",value:function(r,n){var o=n.coords.z,s=n.min,l=(n.max,e.metersToTileUnits.bind(this,Geo$1.unitsPerMeter(o),s));for(var h in r.layers)for(var d=r.layers[h].features.length,y=0;y<d;y++){var g=r.layers[h].features[y];Geo$1.transformGeometry(g.geometry,l)}}},{key:"register",value:function(r,n){r&&n&&(e.types[n]=r)}}]),e}();DataSource.types={};var network_request_id=0,NetworkSource=function(){_inherits(r,DataSource);var e=_createSuper(r);function r(n,o){var s;_classCallCheck(this,r),(s=e.call(this,n,o)).response_type="";var l=_slicedToArray(addParamsToURL(n.url,n.url_params),2),h=l[0],d=l[1];if(s.url=h,d.forEach(function(y){var g=_slicedToArray(y,2),v=g[0],m=g[1];log({level:"warn",once:!0},"Data source '".concat(s.name,"': parameter '").concat(v,"' already present in URL '").concat(n.url,"', ")+"skipping value '".concat(v,"=").concat(m,"' specified in 'url_params'"))}),typeof s.url!="string")throw Error("Network data source must provide a string `url` property");return s}return _createClass(r,[{key:"_load",value:function(n){var o=this,s=this.formatUrl(this.url,n),l=n.source_data;return l.url=s,new Promise(function(h,d){l.error=null;var y=network_request_id+++"-"+s,g=Utils$1.io(s,6e4,o.response_type,"GET",{},y);l.request_id=y,g.then(function(v){typeof o.preprocess=="function"&&(v=o.preprocess(v)),(v=v instanceof Promise?v:Promise.resolve(v)).then(function(m){o.parseSourceData(n,l,m),o._postProcessTile(n),h(n)})},function(v){l.error=v.stack,o._postProcessTile(n),h(n)})})}},{key:"formatUrl",value:function(){throw new MethodNotImplemented("formatUrl")}},{key:"parseSourceData",value:function(){throw new MethodNotImplemented("parseSourceData")}}]),r}(),NetworkTileSource=function(){_inherits(r,NetworkSource);var e=_createSuper(r);function r(n,o){var s;return _classCallCheck(this,r),(s=e.call(this,n,o)).tiled=!0,s.parseBounds(n),s.builds_geometry_tiles=!1,s.tms=n.tms===!0,-1<s.url.search("{s}")&&(Array.isArray(n.url_subdomains)&&0<n.url_subdomains.length?(s.url_subdomains=n.url_subdomains,s.next_url_subdomain=0):log({level:"warn",once:!0},"Data source '".concat(s.name,"': source URL includes '{s}' subdomain marker ('").concat(s.url,"'), but no subdomains ")+"were specified in 'url_subdomains' parameter")),s}return _createClass(r,[{key:"parseBounds",value:function(n){var o,s,l,h,d;Array.isArray(n.bounds)&&n.bounds.length===4&&(this.bounds=n.bounds,s=(o=_slicedToArray(this.bounds,4))[0],l=o[1],h=o[2],d=o[3],this.bounds_meters={min:Geo$1.latLngToMeters([s,d]),max:Geo$1.latLngToMeters([h,l])},this.bounds_tiles={min:{},max:{}})}},{key:"checkBounds",value:function(n){if(this.bounds){n=Geo$1.wrapTile(n,{x:!0});var o=(o=this.bounds_tiles.min[n.z])||(this.bounds_tiles.min[n.z]=Geo$1.tileForMeters(this.bounds_meters.min,n.z)),s=(s=this.bounds_tiles.max[n.z])||(this.bounds_tiles.max[n.z]=Geo$1.tileForMeters(this.bounds_meters.max,n.z));if(n.x<o.x||n.x>s.x||n.y<o.y||n.y>s.y)return!1}return!0}},{key:"includesTile",value:function(n,o){return!!_get(_getPrototypeOf(r.prototype),"includesTile",this).call(this,n,o)&&!!this.checkBounds(n)}},{key:"formatUrl",value:function(n,o){var s=Geo$1.wrapTile(o.coords,{x:!0});this.tms&&(s.y=Math.pow(2,s.z)-1-s.y);var l=n.replace("{x}",s.x).replace("{y}",s.y).replace("{z}",s.z);return this.url_subdomains!=null&&(l=l.replace("{s}",this.url_subdomains[this.next_url_subdomain]),this.next_url_subdomain=(this.next_url_subdomain+1)%this.url_subdomains.length),l}},{key:"urlHasTilePattern",value:function(n){return n&&-1<n.search("{x}")&&-1<n.search("{y}")&&-1<n.search("{z}")}}]),r}(),MapsJsSource=function(){_inherits(r,DataSource);var e=_createSuper(r);function r(n,o){var s;return _classCallCheck(this,r),(s=e.call(this,n,o)).target_name="MapsJsSource"+n.uid,s.tiled=!!n.tiled,WorkerBroker.addTarget(s.target_name,_assertThisInitialized(s)),Thread.is_worker&&WorkerBroker.postMessage(s.target_name+".onWorkerInitialized"),Thread.is_main&&(s._workers_left=0),s}return _createClass(r,[{key:"initialize",value:function(n,o,s,l){this._main_initialized||(this.provider=n,this.worker=l,this._workers_left+=s,this._on_update=o,this._main_initialized=!0,this._onProviderUpdate=this._onProviderUpdate.bind(this),n.addEventListener("update",this._onProviderUpdate),this._isReady()&&this.onReady())}},{key:"onWorkerInitialized",value:function(){--this._workers_left,this._isReady()&&this.onReady()}},{key:"onReady",value:function(){}},{key:"_isReady",value:function(){return this._main_initialized&&!this._workers_left}},{key:"_onProviderUpdate",value:function(n){this._isReady()&&this.onProviderUpdate(n)}},{key:"onProviderUpdate",value:function(n){this.dispatchUpdate(void 0,n.data)}},{key:"dispatchUpdate",value:function(n,o){this._on_update(this.name,n,o)}},{key:"dispose",value:function(){WorkerBroker.removeTarget(this.target_name),this.provider.removeEventListener("update",this._onProviderUpdate)}}]),r}(),read=function(e,r,n,o,s){var l,h,d=8*s-o-1,y=(1<<d)-1,g=y>>1,v=-7,m=n?s-1:0,w=n?-1:1,I=e[r+m];for(m+=w,l=I&(1<<-v)-1,I>>=-v,v+=d;0<v;l=256*l+e[r+m],m+=w,v-=8);for(h=l&(1<<-v)-1,l>>=-v,v+=o;0<v;h=256*h+e[r+m],m+=w,v-=8);if(l===0)l=1-g;else{if(l===y)return h?NaN:1/0*(I?-1:1);h+=Math.pow(2,o),l-=g}return(I?-1:1)*h*Math.pow(2,l-o)},write=function(e,r,n,o,s,l){var h,d,y,g=8*l-s-1,v=(1<<g)-1,m=v>>1,w=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,I=o?0:l-1,V=o?1:-1,q=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(d=isNaN(r)?1:0,h=v):(h=Math.floor(Math.log(r)/Math.LN2),r*(y=Math.pow(2,-h))<1&&(h--,y*=2),2<=(r+=1<=h+m?w/y:w*Math.pow(2,1-m))*y&&(h++,y/=2),v<=h+m?(d=0,h=v):1<=h+m?(d=(r*y-1)*Math.pow(2,s),h+=m):(d=r*Math.pow(2,m-1)*Math.pow(2,s),h=0));8<=s;e[n+I]=255&d,I+=V,d/=256,s-=8);for(h=h<<s|d,g+=s;0<g;e[n+I]=255&h,I+=V,h/=256,g-=8);e[n+I-V]|=128*q},ieee754={read,write},pbf=Pbf;function Pbf(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Pbf.Varint=0,Pbf.Fixed64=1,Pbf.Bytes=2,Pbf.Fixed32=5;var SHIFT_LEFT_32=4294967296,SHIFT_RIGHT_32=1/SHIFT_LEFT_32;function readVarintRemainder(e,r,n){var o=n.buf,s=o[n.pos++],l=(112&s)>>4;if(s<128||(l|=(127&(s=o[n.pos++]))<<3,s<128)||(l|=(127&(s=o[n.pos++]))<<10,s<128)||(l|=(127&(s=o[n.pos++]))<<17,s<128)||(l|=(127&(s=o[n.pos++]))<<24,s<128)||(l|=(1&(s=o[n.pos++]))<<31,s<128))return toNum(e,l,r);throw new Error("Expected varint not more than 10 bytes")}function readPackedEnd(e){return e.type===Pbf.Bytes?e.readVarint()+e.pos:e.pos+1}function toNum(e,r,n){return n?4294967296*r+(e>>>0):4294967296*(r>>>0)+(e>>>0)}function writeBigVarint(e,r){var n,o;if(0<=e?(n=e%4294967296|0,o=e/4294967296|0):(o=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:o=o+1|(n=0)),18446744073709552e3<=e||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),writeBigVarintLow(n,o,r),writeBigVarintHigh(o,r)}function writeBigVarintLow(e,r,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos]=127&e}function writeBigVarintHigh(e,r){var n=(7&e)<<4;r.buf[r.pos++]|=n|((e>>>=3)?128:0),e&&(r.buf[r.pos++]=127&e|((e>>>=7)?128:0),e&&(r.buf[r.pos++]=127&e|((e>>>=7)?128:0),e&&(r.buf[r.pos++]=127&e|((e>>>=7)?128:0),e&&(r.buf[r.pos++]=127&e|((e>>>=7)?128:0),e&&(r.buf[r.pos++]=127&e)))))}function makeRoomForExtraLength(e,r,n){var o=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.ceil(Math.log(r)/(7*Math.LN2));n.realloc(o);for(var s=n.pos-1;e<=s;s--)n.buf[s+o]=n.buf[s]}function writePackedVarint(e,r){for(var n=0;n<e.length;n++)r.writeVarint(e[n])}function writePackedSVarint(e,r){for(var n=0;n<e.length;n++)r.writeSVarint(e[n])}function writePackedFloat(e,r){for(var n=0;n<e.length;n++)r.writeFloat(e[n])}function writePackedDouble(e,r){for(var n=0;n<e.length;n++)r.writeDouble(e[n])}function writePackedBoolean(e,r){for(var n=0;n<e.length;n++)r.writeBoolean(e[n])}function writePackedFixed32(e,r){for(var n=0;n<e.length;n++)r.writeFixed32(e[n])}function writePackedSFixed32(e,r){for(var n=0;n<e.length;n++)r.writeSFixed32(e[n])}function writePackedFixed64(e,r){for(var n=0;n<e.length;n++)r.writeFixed64(e[n])}function writePackedSFixed64(e,r){for(var n=0;n<e.length;n++)r.writeSFixed64(e[n])}function readUInt32(e,r){return(e[r]|e[r+1]<<8|e[r+2]<<16)+16777216*e[r+3]}function writeInt32(e,r,n){e[n]=r,e[n+1]=r>>>8,e[n+2]=r>>>16,e[n+3]=r>>>24}function readInt32(e,r){return(e[r]|e[r+1]<<8|e[r+2]<<16)+(e[r+3]<<24)}function readUtf8(e,r,n){for(var o="",s=r;s<n;){var l,h,d,y=e[s],g=null,v=239<y?4:223<y?3:191<y?2:1;if(n<s+v)break;v===1?y<128&&(g=y):v===2?(192&(l=e[s+1]))==128&&(g=(31&y)<<6|63&l)<=127&&(g=null):v===3?(l=e[s+1],h=e[s+2],(192&l)==128&&(192&h)==128&&((g=(15&y)<<12|(63&l)<<6|63&h)<=2047||55296<=g&&g<=57343)&&(g=null)):v===4&&(l=e[s+1],h=e[s+2],d=e[s+3],(192&l)==128&&(192&h)==128&&(192&d)==128&&((g=(15&y)<<18|(63&l)<<12|(63&h)<<6|63&d)<=65535||1114112<=g)&&(g=null)),g===null?(g=65533,v=1):65535<g&&(g-=65536,o+=String.fromCharCode(g>>>10&1023|55296),g=56320|1023&g),o+=String.fromCharCode(g),s+=v}return o}function writeUtf8(e,r,n){for(var o,s,l=0;l<r.length;l++){if(55295<(o=r.charCodeAt(l))&&o<57344){if(!s){56319<o||l+1===r.length?(e[n++]=239,e[n++]=191,e[n++]=189):s=o;continue}if(o<56320){e[n++]=239,e[n++]=191,e[n++]=189,s=o;continue}o=s-55296<<10|o-56320|65536,s=null}else s&&(e[n++]=239,e[n++]=191,e[n++]=189,s=null);o<128?e[n++]=o:(o<2048?e[n++]=o>>6|192:(o<65536?e[n++]=o>>12|224:(e[n++]=o>>18|240,e[n++]=o>>12&63|128),e[n++]=o>>6&63|128),e[n++]=63&o|128)}return n}Pbf.prototype={destroy:function(){this.buf=null},readFields:function(e,r,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),s=o>>3,l=this.pos;this.type=7&o,e(s,r,this),this.pos===l&&this.skip(o)}return r},readMessage:function(e,r){return this.readFields(e,r,this.readVarint()+this.pos)},readFixed32:function(){var e=readUInt32(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=readInt32(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=readUInt32(this.buf,this.pos)+readUInt32(this.buf,this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,e},readSFixed64:function(){var e=readUInt32(this.buf,this.pos)+readInt32(this.buf,this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,e},readFloat:function(){var e=ieee754.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=ieee754.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var r=this.buf,n=r[this.pos++],o=127&n;return n<128?o:(o|=(127&(n=r[this.pos++]))<<7,n<128?o:(o|=(127&(n=r[this.pos++]))<<14,n<128?o:(o|=(127&(n=r[this.pos++]))<<21,n<128?o:readVarintRemainder(o|=(15&(n=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,r=readUtf8(this.buf,this.pos,e);return this.pos=e,r},readBytes:function(){var e=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,e);return this.pos=e,r},readPackedVarint:function(e,r){var n=readPackedEnd(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(r));return e},readPackedSVarint:function(e){var r=readPackedEnd(this);for(e=e||[];this.pos<r;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){var r=readPackedEnd(this);for(e=e||[];this.pos<r;)e.push(this.readBoolean());return e},readPackedFloat:function(e){var r=readPackedEnd(this);for(e=e||[];this.pos<r;)e.push(this.readFloat());return e},readPackedDouble:function(e){var r=readPackedEnd(this);for(e=e||[];this.pos<r;)e.push(this.readDouble());return e},readPackedFixed32:function(e){var r=readPackedEnd(this);for(e=e||[];this.pos<r;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){var r=readPackedEnd(this);for(e=e||[];this.pos<r;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){var r=readPackedEnd(this);for(e=e||[];this.pos<r;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){var r=readPackedEnd(this);for(e=e||[];this.pos<r;)e.push(this.readSFixed64());return e},skip:function(e){var r=7&e;if(r===Pbf.Varint)for(;127<this.buf[this.pos++];);else if(r===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Pbf.Fixed32)this.pos+=4;else{if(r!==Pbf.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(e,r){this.writeVarint(e<<3|r)},realloc:function(e){for(var r,n=this.length||16;n<this.pos+e;)n*=2;n!==this.length&&((r=new Uint8Array(n)).set(this.buf),this.buf=r,this.length=n)},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),writeInt32(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),writeInt32(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),writeInt32(this.buf,-1&e,this.pos),writeInt32(this.buf,Math.floor(e*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),writeInt32(this.buf,-1&e,this.pos),writeInt32(this.buf,Math.floor(e*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeVarint:function(e){268435455<(e=+e||0)||e<0?writeBigVarint(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(127<e?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var r=this.pos;this.pos=writeUtf8(this.buf,e,this.pos);var n=this.pos-r;128<=n&&makeRoomForExtraLength(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),ieee754.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),ieee754.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var r=e.length;this.writeVarint(r),this.realloc(r);for(var n=0;n<r;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,r){this.pos++;var n=this.pos;e(r,this);var o=this.pos-n;128<=o&&makeRoomForExtraLength(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(e,r,n){this.writeTag(e,Pbf.Bytes),this.writeRawMessage(r,n)},writePackedVarint:function(e,r){this.writeMessage(e,writePackedVarint,r)},writePackedSVarint:function(e,r){this.writeMessage(e,writePackedSVarint,r)},writePackedBoolean:function(e,r){this.writeMessage(e,writePackedBoolean,r)},writePackedFloat:function(e,r){this.writeMessage(e,writePackedFloat,r)},writePackedDouble:function(e,r){this.writeMessage(e,writePackedDouble,r)},writePackedFixed32:function(e,r){this.writeMessage(e,writePackedFixed32,r)},writePackedSFixed32:function(e,r){this.writeMessage(e,writePackedSFixed32,r)},writePackedFixed64:function(e,r){this.writeMessage(e,writePackedFixed64,r)},writePackedSFixed64:function(e,r){this.writeMessage(e,writePackedSFixed64,r)},writeBytesField:function(e,r){this.writeTag(e,Pbf.Bytes),this.writeBytes(r)},writeFixed32Field:function(e,r){this.writeTag(e,Pbf.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(e,r){this.writeTag(e,Pbf.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(e,r){this.writeTag(e,Pbf.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(e,r){this.writeTag(e,Pbf.Fixed64),this.writeSFixed64(r)},writeVarintField:function(e,r){this.writeTag(e,Pbf.Varint),this.writeVarint(r)},writeSVarintField:function(e,r){this.writeTag(e,Pbf.Varint),this.writeSVarint(r)},writeStringField:function(e,r){this.writeTag(e,Pbf.Bytes),this.writeString(r)},writeFloatField:function(e,r){this.writeTag(e,Pbf.Fixed32),this.writeFloat(r)},writeDoubleField:function(e,r){this.writeTag(e,Pbf.Fixed64),this.writeDouble(r)},writeBooleanField:function(e,r){this.writeVarintField(e,!!r)}};var pointGeometry=Point;function Point(e,r){this.x=e,this.y=r}Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,r){return this.clone()._rotateAround(e,r)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var r=e.x-this.x,n=e.y-this.y;return r*r+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,r){return Math.atan2(this.x*r-this.y*e,this.x*e+this.y*r)},_matMult:function(e){var r=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=r,this.y=n,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var r=Math.cos(e),n=Math.sin(e),o=r*this.x-n*this.y,s=n*this.x+r*this.y;return this.x=o,this.y=s,this},_rotateAround:function(e,r){var n=Math.cos(e),o=Math.sin(e),s=r.x+n*(this.x-r.x)-o*(this.y-r.y),l=r.y+o*(this.x-r.x)+n*(this.y-r.y);return this.x=s,this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Point.convert=function(e){return!(e instanceof Point)&&Array.isArray(e)?new Point(e[0],e[1]):e};var vectortilefeature=VectorTileFeature;function VectorTileFeature(e,r,n,o,s){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=o,this._values=s,e.readFields(readFeature,this,r)}function readFeature(e,r,n){e==1?r.id=n.readVarint():e==2?readTag(n,r):e==3?r.type=n.readVarint():e==4&&(r._geometry=n.pos)}function readTag(e,r){for(var n=e.readVarint()+e.pos;e.pos<n;){var o=r._keys[e.readVarint()],s=r._values[e.readVarint()];r.properties[o]=s}}function classifyRings(e){var r=e.length;if(r<=1)return[e];for(var n,o,s=[],l=0;l<r;l++){var h=signedArea(e[l]);h!==0&&(o===void 0&&(o=h<0),o===h<0?(n&&s.push(n),n=[e[l]]):n.push(e[l]))}return n&&s.push(n),s}function signedArea(e){for(var r,n,o=0,s=0,l=e.length,h=l-1;s<l;h=s++)r=e[s],o+=((n=e[h]).x-r.x)*(r.y+n.y);return o}VectorTileFeature.types=["Unknown","Point","LineString","Polygon"],VectorTileFeature.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var r,n,o=e.readVarint()+e.pos,s=1,l=0,h=0,d=0,y=[];e.pos<o;)if(l||(s=7&(n=e.readVarint()),l=n>>3),l--,s===1||s===2)h+=e.readSVarint(),d+=e.readSVarint(),s===1&&(r&&y.push(r),r=[]),r.push(new pointGeometry(h,d));else{if(s!==7)throw new Error("unknown command "+s);r&&r.push(r[0].clone())}return r&&y.push(r),y},VectorTileFeature.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var r,n=e.readVarint()+e.pos,o=1,s=0,l=0,h=0,d=1/0,y=-1/0,g=1/0,v=-1/0;e.pos<n;)if(s||(o=7&(r=e.readVarint()),s=r>>3),s--,o===1||o===2)(l+=e.readSVarint())<d&&(d=l),y<l&&(y=l),(h+=e.readSVarint())<g&&(g=h),v<h&&(v=h);else if(o!==7)throw new Error("unknown command "+o);return[d,g,y,v]},VectorTileFeature.prototype.toGeoJSON=function(e,r,n){var o,s=this.extent*Math.pow(2,n),l=this.extent*e,h=this.extent*r,d=this.loadGeometry(),y=VectorTileFeature.types[this.type];function g(I){for(var V=0;V<I.length;V++){var q=I[V],De=180-360*(q.y+h)/s;I[V]=[360*(q.x+l)/s-180,360/Math.PI*Math.atan(Math.exp(De*Math.PI/180))-90]}}switch(this.type){case 1:for(var v=[],m=0;m<d.length;m++)v[m]=d[m][0];g(d=v);break;case 2:for(m=0;m<d.length;m++)g(d[m]);break;case 3:for(d=classifyRings(d),m=0;m<d.length;m++)for(o=0;o<d[m].length;o++)g(d[m][o])}d.length===1?d=d[0]:y="Multi"+y;var w={type:"Feature",geometry:{type:y,coordinates:d},properties:this.properties};return"id"in this&&(w.id=this.id),w};var VectorTileFeature$1=vectortilefeature,long_1=Long,wasm=null;try{wasm=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function Long(e,r,n){this.low=0|e,this.high=0|r,this.unsigned=!!n}function isLong(e){return(e&&e.__isLong__)===!0}Long.prototype.__isLong__,Object.defineProperty(Long.prototype,"__isLong__",{value:!0}),Long.isLong=isLong;var INT_CACHE={},UINT_CACHE={};function fromInt(e,r){var n,o,s;return r?(s=0<=(e>>>=0)&&e<256)&&(o=UINT_CACHE[e])?o:(n=fromBits(e,(0|e)<0?-1:0,!0),s&&(UINT_CACHE[e]=n),n):(s=-128<=(e|=0)&&e<128)&&(o=INT_CACHE[e])?o:(n=fromBits(e,e<0?-1:0,!1),s&&(INT_CACHE[e]=n),n)}function fromNumber(e,r){if(isNaN(e))return r?UZERO:ZERO;if(r){if(e<0)return UZERO;if(TWO_PWR_64_DBL<=e)return MAX_UNSIGNED_VALUE}else{if(e<=-TWO_PWR_63_DBL)return MIN_VALUE;if(TWO_PWR_63_DBL<=e+1)return MAX_VALUE}return e<0?fromNumber(-e,r).neg():fromBits(e%TWO_PWR_32_DBL|0,e/TWO_PWR_32_DBL|0,r)}function fromBits(e,r,n){return new Long(e,r,n)}Long.fromInt=fromInt,Long.fromNumber=fromNumber,Long.fromBits=fromBits;var pow_dbl=Math.pow;function fromString(e,r,n){if(e.length===0)throw Error("empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return ZERO;if(r=typeof r=="number"?(n=r,!1):!!r,(n=n||10)<2||36<n)throw RangeError("radix");var o;if(0<(o=e.indexOf("-")))throw Error("interior hyphen");if(o===0)return fromString(e.substring(1),r,n).neg();for(var s=fromNumber(pow_dbl(n,8)),l=ZERO,h=0;h<e.length;h+=8){var d,y=Math.min(8,e.length-h),g=parseInt(e.substring(h,h+y),n);l=y<8?(d=fromNumber(pow_dbl(n,y)),l.mul(d).add(fromNumber(g))):(l=l.mul(s)).add(fromNumber(g))}return l.unsigned=r,l}function fromValue(e,r){return typeof e=="number"?fromNumber(e,r):typeof e=="string"?fromString(e,r):fromBits(e.low,e.high,typeof r=="boolean"?r:e.unsigned)}Long.fromString=fromString,Long.fromValue=fromValue;var TWO_PWR_16_DBL=65536,TWO_PWR_24_DBL=1<<24,TWO_PWR_32_DBL=TWO_PWR_16_DBL*TWO_PWR_16_DBL,TWO_PWR_64_DBL=TWO_PWR_32_DBL*TWO_PWR_32_DBL,TWO_PWR_63_DBL=TWO_PWR_64_DBL/2,TWO_PWR_24=fromInt(TWO_PWR_24_DBL),ZERO=fromInt(0);Long.ZERO=ZERO;var UZERO=fromInt(0,!0);Long.UZERO=UZERO;var ONE=fromInt(1);Long.ONE=ONE;var UONE=fromInt(1,!0);Long.UONE=UONE;var NEG_ONE=fromInt(-1);Long.NEG_ONE=NEG_ONE;var MAX_VALUE=fromBits(-1,2147483647,!1);Long.MAX_VALUE=MAX_VALUE;var MAX_UNSIGNED_VALUE=fromBits(-1,-1,!0);Long.MAX_UNSIGNED_VALUE=MAX_UNSIGNED_VALUE;var MIN_VALUE=fromBits(0,-2147483648,!1);Long.MIN_VALUE=MIN_VALUE;var LongPrototype=Long.prototype;LongPrototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},LongPrototype.toNumber=function(){return this.unsigned?(this.high>>>0)*TWO_PWR_32_DBL+(this.low>>>0):this.high*TWO_PWR_32_DBL+(this.low>>>0)},LongPrototype.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(MIN_VALUE)){var r=fromNumber(e),n=this.div(r),o=n.mul(r).sub(this);return n.toString(e)+o.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var s=fromNumber(pow_dbl(e,6),this.unsigned),l=this,h="";;){var d=l.div(s),y=(l.sub(d.mul(s)).toInt()>>>0).toString(e);if((l=d).isZero())return y+h;for(;y.length<6;)y="0"+y;h=""+y+h}},LongPrototype.getHighBits=function(){return this.high},LongPrototype.getHighBitsUnsigned=function(){return this.high>>>0},LongPrototype.getLowBits=function(){return this.low},LongPrototype.getLowBitsUnsigned=function(){return this.low>>>0},LongPrototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,r=31;0<r&&!(e&1<<r);r--);return this.high!=0?r+33:r+1},LongPrototype.isZero=function(){return this.high===0&&this.low===0},LongPrototype.eqz=LongPrototype.isZero,LongPrototype.isNegative=function(){return!this.unsigned&&this.high<0},LongPrototype.isPositive=function(){return this.unsigned||0<=this.high},LongPrototype.isOdd=function(){return(1&this.low)==1},LongPrototype.isEven=function(){return(1&this.low)==0},LongPrototype.equals=function(e){return isLong(e)||(e=fromValue(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},LongPrototype.eq=LongPrototype.equals,LongPrototype.notEquals=function(e){return!this.eq(e)},LongPrototype.neq=LongPrototype.notEquals,LongPrototype.ne=LongPrototype.notEquals,LongPrototype.lessThan=function(e){return this.comp(e)<0},LongPrototype.lt=LongPrototype.lessThan,LongPrototype.lessThanOrEqual=function(e){return this.comp(e)<=0},LongPrototype.lte=LongPrototype.lessThanOrEqual,LongPrototype.le=LongPrototype.lessThanOrEqual,LongPrototype.greaterThan=function(e){return 0<this.comp(e)},LongPrototype.gt=LongPrototype.greaterThan,LongPrototype.greaterThanOrEqual=function(e){return 0<=this.comp(e)},LongPrototype.gte=LongPrototype.greaterThanOrEqual,LongPrototype.ge=LongPrototype.greaterThanOrEqual,LongPrototype.compare=function(e){if(isLong(e)||(e=fromValue(e)),this.eq(e))return 0;var r=this.isNegative(),n=e.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},LongPrototype.comp=LongPrototype.compare,LongPrototype.negate=function(){return!this.unsigned&&this.eq(MIN_VALUE)?MIN_VALUE:this.not().add(ONE)},LongPrototype.neg=LongPrototype.negate,LongPrototype.add=function(e){isLong(e)||(e=fromValue(e));var r=this.high>>>16,n=65535&this.high,o=this.low>>>16,s=65535&this.low,l=e.high>>>16,h=65535&e.high,d=e.low>>>16,y=0,g=0,v=0,m=0;return v+=(m+=s+(65535&e.low))>>>16,g+=(v+=o+d)>>>16,y+=(g+=n+h)>>>16,y+=r+l,fromBits((v&=65535)<<16|(m&=65535),(y&=65535)<<16|(g&=65535),this.unsigned)},LongPrototype.subtract=function(e){return isLong(e)||(e=fromValue(e)),this.add(e.neg())},LongPrototype.sub=LongPrototype.subtract,LongPrototype.multiply=function(e){if(this.isZero())return ZERO;if(isLong(e)||(e=fromValue(e)),wasm)return fromBits(wasm.mul(this.low,this.high,e.low,e.high),wasm.get_high(),this.unsigned);if(e.isZero())return ZERO;if(this.eq(MIN_VALUE))return e.isOdd()?MIN_VALUE:ZERO;if(e.eq(MIN_VALUE))return this.isOdd()?MIN_VALUE:ZERO;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(TWO_PWR_24)&&e.lt(TWO_PWR_24))return fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,n=65535&this.high,o=this.low>>>16,s=65535&this.low,l=e.high>>>16,h=65535&e.high,d=e.low>>>16,y=65535&e.low,g=0,v=0,m=0,w=0;return m+=(w+=s*y)>>>16,v+=(m+=o*y)>>>16,m&=65535,v+=(m+=s*d)>>>16,g+=(v+=n*y)>>>16,v&=65535,g+=(v+=o*d)>>>16,v&=65535,g+=(v+=s*h)>>>16,g+=r*y+n*d+o*h+s*l,fromBits((m&=65535)<<16|(w&=65535),(g&=65535)<<16|(v&=65535),this.unsigned)},LongPrototype.mul=LongPrototype.multiply,LongPrototype.divide=function(e){if(isLong(e)||(e=fromValue(e)),e.isZero())throw Error("division by zero");var r,n,o;if(wasm)return this.unsigned||this.high!==-2147483648||e.low!==-1||e.high!==-1?fromBits((this.unsigned?wasm.div_u:wasm.div_s)(this.low,this.high,e.low,e.high),wasm.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?UZERO:ZERO;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return UZERO;if(e.gt(this.shru(1)))return UONE;n=UZERO}else{if(this.eq(MIN_VALUE))return e.eq(ONE)||e.eq(NEG_ONE)?MIN_VALUE:e.eq(MIN_VALUE)?ONE:(o=this.shr(1).div(e).shl(1)).eq(ZERO)?e.isNegative()?ONE:NEG_ONE:(r=this.sub(e.mul(o)),n=o.add(r.div(e)));if(e.eq(MIN_VALUE))return this.unsigned?UZERO:ZERO;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();n=ZERO}for(r=this;r.gte(e);){o=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(o)/Math.LN2),l=s<=48?1:pow_dbl(2,s-48),h=fromNumber(o),d=h.mul(e);d.isNegative()||d.gt(r);)d=(h=fromNumber(o-=l,this.unsigned)).mul(e);h.isZero()&&(h=ONE),n=n.add(h),r=r.sub(d)}return n},LongPrototype.div=LongPrototype.divide,LongPrototype.modulo=function(e){return isLong(e)||(e=fromValue(e)),wasm?fromBits((this.unsigned?wasm.rem_u:wasm.rem_s)(this.low,this.high,e.low,e.high),wasm.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},LongPrototype.mod=LongPrototype.modulo,LongPrototype.rem=LongPrototype.modulo,LongPrototype.not=function(){return fromBits(~this.low,~this.high,this.unsigned)},LongPrototype.and=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low&e.low,this.high&e.high,this.unsigned)},LongPrototype.or=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low|e.low,this.high|e.high,this.unsigned)},LongPrototype.xor=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low^e.low,this.high^e.high,this.unsigned)},LongPrototype.shiftLeft=function(e){return isLong(e)&&(e=e.toInt()),(e&=63)==0?this:e<32?fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):fromBits(0,this.low<<e-32,this.unsigned)},LongPrototype.shl=LongPrototype.shiftLeft,LongPrototype.shiftRight=function(e){return isLong(e)&&(e=e.toInt()),(e&=63)==0?this:e<32?fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):fromBits(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},LongPrototype.shr=LongPrototype.shiftRight,LongPrototype.shiftRightUnsigned=function(e){if(isLong(e)&&(e=e.toInt()),(e&=63)===0)return this;var r=this.high;return e<32?fromBits(this.low>>>e|r<<32-e,r>>>e,this.unsigned):fromBits(e===32?r:r>>>e-32,0,this.unsigned)},LongPrototype.shru=LongPrototype.shiftRightUnsigned,LongPrototype.shr_u=LongPrototype.shiftRightUnsigned,LongPrototype.toSigned=function(){return this.unsigned?fromBits(this.low,this.high,!1):this},LongPrototype.toUnsigned=function(){return this.unsigned?this:fromBits(this.low,this.high,!0)},LongPrototype.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},LongPrototype.toBytesLE=function(){var e=this.high,r=this.low;return[255&r,r>>>8&255,r>>>16&255,r>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},LongPrototype.toBytesBE=function(){var e=this.high,r=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,r>>>24,r>>>16&255,r>>>8&255,255&r]},Long.fromBytes=function(e,r,n){return n?Long.fromBytesLE(e,r):Long.fromBytesBE(e,r)},Long.fromBytesLE=function(e,r){return new Long(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,r)},Long.fromBytesBE=function(e,r){return new Long(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],r)};var aspromise=asPromise;function asPromise(e,r){for(var n=new Array(arguments.length-1),o=0,s=2,l=!0;s<arguments.length;)n[o++]=arguments[s++];return new Promise(function(h,d){n[o]=function(y){if(l)if(l=!1,y)d(y);else{for(var g=new Array(arguments.length-1),v=0;v<g.length;)g[v++]=arguments[v];h.apply(null,g)}};try{e.apply(r||null,n)}catch(y){l&&(l=!1,d(y))}})}var base64_1=createCommonjsModule(function(e,r){var n=r;n.length=function(d){var y=d.length;if(!y)return 0;for(var g=0;1<--y%4&&d.charAt(y)==="=";)++g;return Math.ceil(3*d.length)/4-g};for(var o=new Array(64),s=new Array(123),l=0;l<64;)s[o[l]=l<26?l+65:l<52?l+71:l<62?l-4:l-59|43]=l++;n.encode=function(d,y,g){for(var v,m=null,w=[],I=0,V=0;y<g;){var q=d[y++];switch(V){case 0:w[I++]=o[q>>2],v=(3&q)<<4,V=1;break;case 1:w[I++]=o[v|q>>4],v=(15&q)<<2,V=2;break;case 2:w[I++]=o[v|q>>6],w[I++]=o[63&q],V=0}8191<I&&((m=m||[]).push(String.fromCharCode.apply(String,w)),I=0)}return V&&(w[I++]=o[v],w[I++]=61,V===1&&(w[I++]=61)),m?(I&&m.push(String.fromCharCode.apply(String,w.slice(0,I))),m.join("")):String.fromCharCode.apply(String,w.slice(0,I))};var h="invalid encoding";n.decode=function(d,y,g){for(var v,m=g,w=0,I=0;I<d.length;){var V=d.charCodeAt(I++);if(V===61&&1<w)break;if((V=s[V])===void 0)throw Error(h);switch(w){case 0:v=V,w=1;break;case 1:y[g++]=v<<2|(48&V)>>4,v=V,w=2;break;case 2:y[g++]=(15&v)<<4|(60&V)>>2,v=V,w=3;break;case 3:y[g++]=(3&v)<<6|V,w=0}}if(w===1)throw Error(h);return g-m},n.test=function(d){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(d)}}),eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(e,r,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:r,ctx:n||this}),this},EventEmitter.prototype.off=function(e,r){if(e===void 0)this._listeners={};else if(r===void 0)this._listeners[e]=[];else for(var n=this._listeners[e],o=0;o<n.length;)n[o].fn===r?n.splice(o,1):++o;return this},EventEmitter.prototype.emit=function(e){var r=this._listeners[e];if(r){for(var n=[],o=1;o<arguments.length;)n.push(arguments[o++]);for(o=0;o<r.length;)r[o].fn.apply(r[o++].ctx,n)}return this};var float_1=factory(factory);function factory(e){function r(ga,_o,_l,wc){var _h,_p=_o<0?1:0;_p&&(_o=-_o),_o===0?ga(0<1/_o?0:2147483648,_l,wc):isNaN(_o)?ga(2143289344,_l,wc):ga(34028234663852886e22<_o?(_p<<31|2139095040)>>>0:_o<11754943508222875e-54?(_p<<31|Math.round(_o/1401298464324817e-60))>>>0:(_p<<31|(_h=Math.floor(Math.log(_o)/Math.LN2))+127<<23|8388607&Math.round(_o*Math.pow(2,-_h)*8388608))>>>0,_l,wc)}function n(ga,_o,_l){var wc=ga(_o,_l),_h=2*(wc>>31)+1,_p=wc>>>23&255,pd=8388607&wc;return _p==255?pd?NaN:1/0*_h:_p==0?1401298464324817e-60*_h*pd:_h*Math.pow(2,_p-150)*(8388608+pd)}function o(ga,_o,_l){d[0]=ga,_o[_l]=y[0],_o[_l+1]=y[1],_o[_l+2]=y[2],_o[_l+3]=y[3]}function s(ga,_o,_l){d[0]=ga,_o[_l]=y[3],_o[_l+1]=y[2],_o[_l+2]=y[1],_o[_l+3]=y[0]}function l(ga,_o){return y[0]=ga[_o],y[1]=ga[_o+1],y[2]=ga[_o+2],y[3]=ga[_o+3],d[0]}function h(ga,_o){return y[3]=ga[_o],y[2]=ga[_o+1],y[1]=ga[_o+2],y[0]=ga[_o+3],d[0]}var d,y,g,v,m,w;function I(ga,_o,_l,wc,_h,_p){var pd,oy,ny=wc<0?1:0;ny&&(wc=-wc),wc===0?(ga(0,_h,_p+_o),ga(0<1/wc?0:2147483648,_h,_p+_l)):isNaN(wc)?(ga(0,_h,_p+_o),ga(2146959360,_h,_p+_l)):17976931348623157e292<wc?(ga(0,_h,_p+_o),ga((ny<<31|2146435072)>>>0,_h,_p+_l)):wc<22250738585072014e-324?(ga((pd=wc/5e-324)>>>0,_h,_p+_o),ga((ny<<31|pd/4294967296)>>>0,_h,_p+_l)):((oy=Math.floor(Math.log(wc)/Math.LN2))===1024&&(oy=1023),ga(4503599627370496*(pd=wc*Math.pow(2,-oy))>>>0,_h,_p+_o),ga((ny<<31|oy+1023<<20|1048576*pd&1048575)>>>0,_h,_p+_l))}function V(ga,_o,_l,wc,_h){var _p=ga(wc,_h+_o),pd=ga(wc,_h+_l),oy=2*(pd>>31)+1,ny=pd>>>20&2047,fy=4294967296*(1048575&pd)+_p;return ny==2047?fy?NaN:1/0*oy:ny==0?5e-324*oy*fy:oy*Math.pow(2,ny-1075)*(fy+4503599627370496)}function q(ga,_o,_l){v[0]=ga,_o[_l]=m[0],_o[_l+1]=m[1],_o[_l+2]=m[2],_o[_l+3]=m[3],_o[_l+4]=m[4],_o[_l+5]=m[5],_o[_l+6]=m[6],_o[_l+7]=m[7]}function De(ga,_o,_l){v[0]=ga,_o[_l]=m[7],_o[_l+1]=m[6],_o[_l+2]=m[5],_o[_l+3]=m[4],_o[_l+4]=m[3],_o[_l+5]=m[2],_o[_l+6]=m[1],_o[_l+7]=m[0]}function _n(ga,_o){return m[0]=ga[_o],m[1]=ga[_o+1],m[2]=ga[_o+2],m[3]=ga[_o+3],m[4]=ga[_o+4],m[5]=ga[_o+5],m[6]=ga[_o+6],m[7]=ga[_o+7],v[0]}function ha(ga,_o){return m[7]=ga[_o],m[6]=ga[_o+1],m[5]=ga[_o+2],m[4]=ga[_o+3],m[3]=ga[_o+4],m[2]=ga[_o+5],m[1]=ga[_o+6],m[0]=ga[_o+7],v[0]}return typeof Float32Array<"u"?(d=new Float32Array([-0]),y=new Uint8Array(d.buffer),g=y[3]===128,e.writeFloatLE=g?o:s,e.writeFloatBE=g?s:o,e.readFloatLE=g?l:h,e.readFloatBE=g?h:l):(e.writeFloatLE=r.bind(null,writeUintLE),e.writeFloatBE=r.bind(null,writeUintBE),e.readFloatLE=n.bind(null,readUintLE),e.readFloatBE=n.bind(null,readUintBE)),typeof Float64Array<"u"?(v=new Float64Array([-0]),m=new Uint8Array(v.buffer),w=m[7]===128,e.writeDoubleLE=w?q:De,e.writeDoubleBE=w?De:q,e.readDoubleLE=w?_n:ha,e.readDoubleBE=w?ha:_n):(e.writeDoubleLE=I.bind(null,writeUintLE,0,4),e.writeDoubleBE=I.bind(null,writeUintBE,4,0),e.readDoubleLE=V.bind(null,readUintLE,0,4),e.readDoubleBE=V.bind(null,readUintBE,4,0)),e}function writeUintLE(e,r,n){r[n]=255&e,r[n+1]=e>>>8&255,r[n+2]=e>>>16&255,r[n+3]=e>>>24}function writeUintBE(e,r,n){r[n]=e>>>24,r[n+1]=e>>>16&255,r[n+2]=e>>>8&255,r[n+3]=255&e}function readUintLE(e,r){return(e[r]|e[r+1]<<8|e[r+2]<<16|e[r+3]<<24)>>>0}function readUintBE(e,r){return(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var utf8_1=createCommonjsModule(function(e,r){var n=r;n.length=function(o){for(var s=0,l=0,h=0;h<o.length;++h)(l=o.charCodeAt(h))<128?s+=1:l<2048?s+=2:(64512&l)==55296&&(64512&o.charCodeAt(h+1))==56320?(++h,s+=4):s+=3;return s},n.read=function(o,s,l){if(l-s<1)return"";for(var h,d=null,y=[],g=0;s<l;)(h=o[s++])<128?y[g++]=h:191<h&&h<224?y[g++]=(31&h)<<6|63&o[s++]:239<h&&h<365?(h=((7&h)<<18|(63&o[s++])<<12|(63&o[s++])<<6|63&o[s++])-65536,y[g++]=55296+(h>>10),y[g++]=56320+(1023&h)):y[g++]=(15&h)<<12|(63&o[s++])<<6|63&o[s++],8191<g&&((d=d||[]).push(String.fromCharCode.apply(String,y)),g=0);return d?(g&&d.push(String.fromCharCode.apply(String,y.slice(0,g))),d.join("")):String.fromCharCode.apply(String,y.slice(0,g))},n.write=function(o,s,l){for(var h,d,y=l,g=0;g<o.length;++g)(h=o.charCodeAt(g))<128?s[l++]=h:(h<2048?s[l++]=h>>6|192:((64512&h)==55296&&(64512&(d=o.charCodeAt(g+1)))==56320?(h=65536+((1023&h)<<10)+(1023&d),++g,s[l++]=h>>18|240,s[l++]=h>>12&63|128):s[l++]=h>>12|224,s[l++]=h>>6&63|128),s[l++]=63&h|128);return l-y}}),pool_1=pool;function pool(e,r,n){var o=n||8192,s=o>>>1,l=null,h=o;return function(d){if(d<1||s<d)return e(d);o<h+d&&(l=e(o),h=0);var y=r.call(l,h,h+=d);return 7&h&&(h=1+(7|h)),y}}var longbits=LongBits;function LongBits(e,r){this.lo=e>>>0,this.hi=r>>>0}var zero=LongBits.zero=new LongBits(0,0);zero.toNumber=function(){return 0},zero.zzEncode=zero.zzDecode=function(){return this},zero.length=function(){return 1};var zeroHash=LongBits.zeroHash="\0\0\0\0\0\0\0\0";LongBits.fromNumber=function(e){if(e===0)return zero;var r=e<0;r&&(e=-e);var n=e>>>0,o=(e-n)/4294967296>>>0;return r&&(o=~o>>>0,n=~n>>>0,4294967295<++n&&(n=0,4294967295<++o&&(o=0))),new LongBits(n,o)},LongBits.from=function(e){if(typeof e=="number")return LongBits.fromNumber(e);if(minimal.isString(e)){if(!minimal.Long)return LongBits.fromNumber(parseInt(e,10));e=minimal.Long.fromString(e)}return e.low||e.high?new LongBits(e.low>>>0,e.high>>>0):zero},LongBits.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var r=1+~this.lo>>>0,n=~this.hi>>>0;return r||(n=n+1>>>0),-(r+4294967296*n)}return this.lo+4294967296*this.hi},LongBits.prototype.toLong=function(e){return minimal.Long?new minimal.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var charCodeAt=String.prototype.charCodeAt;LongBits.fromHash=function(e){return e===zeroHash?zero:new LongBits((charCodeAt.call(e,0)|charCodeAt.call(e,1)<<8|charCodeAt.call(e,2)<<16|charCodeAt.call(e,3)<<24)>>>0,(charCodeAt.call(e,4)|charCodeAt.call(e,5)<<8|charCodeAt.call(e,6)<<16|charCodeAt.call(e,7)<<24)>>>0)},LongBits.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},LongBits.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},LongBits.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},LongBits.prototype.length=function(){var e=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n==0?r==0?e<16384?e<128?1:2:e<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10};var minimal=createCommonjsModule(function(e,r){var n=r;function o(l,h,d){for(var y=Object.keys(h),g=0;g<y.length;++g)l[y[g]]!==void 0&&d||(l[y[g]]=h[y[g]]);return l}function s(l){function h(d,y){if(!(this instanceof h))return new h(d,y);Object.defineProperty(this,"message",{get:function(){return d}}),Error.captureStackTrace?Error.captureStackTrace(this,h):Object.defineProperty(this,"stack",{value:new Error().stack||""}),y&&o(this,y)}return(h.prototype=Object.create(Error.prototype)).constructor=h,Object.defineProperty(h.prototype,"name",{get:function(){return l}}),h.prototype.toString=function(){return this.name+": "+this.message},h}n.asPromise=aspromise,n.base64=base64_1,n.EventEmitter=eventemitter,n.float=float_1,n.inquire=inquire_1,n.utf8=utf8_1,n.pool=pool_1,n.LongBits=longbits,n.isNode=!!(commonjsGlobal!==void 0&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),n.global=n.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(l){return typeof l=="number"&&isFinite(l)&&Math.floor(l)===l},n.isString=function(l){return typeof l=="string"||l instanceof String},n.isObject=function(l){return l&&typeof l=="object"},n.isset=n.isSet=function(l,h){var d=l[h];return!(d==null||!l.hasOwnProperty(h))&&(typeof d!="object"||0<(Array.isArray(d)?d.length:Object.keys(d).length))},n.Buffer=function(){try{var l=n.inquire("buffer").Buffer;return l.prototype.utf8Write?l:null}catch{return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(l){return typeof l=="number"?n.Buffer?n._Buffer_allocUnsafe(l):new n.Array(l):n.Buffer?n._Buffer_from(l):typeof Uint8Array>"u"?l:new Uint8Array(l)},n.Array=typeof Uint8Array<"u"?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(l){return l?n.LongBits.from(l).toHash():n.LongBits.zeroHash},n.longFromHash=function(l,h){var d=n.LongBits.fromHash(l);return n.Long?n.Long.fromBits(d.lo,d.hi,h):d.toNumber(!!h)},n.merge=o,n.lcFirst=function(l){return l.charAt(0).toLowerCase()+l.substring(1)},n.newError=s,n.ProtocolError=s("ProtocolError"),n.oneOfGetter=function(l){for(var h={},d=0;d<l.length;++d)h[l[d]]=1;return function(){for(var y=Object.keys(this),g=y.length-1;-1<g;--g)if(h[y[g]]===1&&this[y[g]]!==void 0&&this[y[g]]!==null)return y[g]}},n.oneOfSetter=function(l){return function(h){for(var d=0;d<l.length;++d)l[d]!==h&&delete this[l[d]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var l=n.Buffer;l?(n._Buffer_from=l.from!==Uint8Array.from&&l.from||function(h,d){return new l(h,d)},n._Buffer_allocUnsafe=l.allocUnsafe||function(h){return new l(h)}):n._Buffer_from=n._Buffer_allocUnsafe=null}}),writer=Writer,BufferWriter,LongBits$1=minimal.LongBits,base64=minimal.base64,utf8=minimal.utf8;function Op(e,r,n){this.fn=e,this.len=r,this.next=void 0,this.val=n}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create=function(){return minimal.Buffer?function(){return(Writer.create=function(){return new BufferWriter})()}:function(){return new Writer}};function writeByte(e,r,n){r[n]=255&e}function writeVarint32(e,r,n){for(;127<e;)r[n++]=127&e|128,e>>>=7;r[n]=e}function VarintOp(e,r){this.len=e,this.next=void 0,this.val=r}function writeVarint64(e,r,n){for(;e.hi;)r[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)r[n++]=127&e.lo|128,e.lo=e.lo>>>7;r[n++]=e.lo}function writeFixed32(e,r,n){r[n]=255&e,r[n+1]=e>>>8&255,r[n+2]=e>>>16&255,r[n+3]=e>>>24}Writer.create=create(),Writer.alloc=function(e){return new minimal.Array(e)},minimal.Array!==Array&&(Writer.alloc=minimal.pool(Writer.alloc,minimal.Array.prototype.subarray)),Writer.prototype._push=function(e,r,n){return this.tail=this.tail.next=new Op(e,r,n),this.len+=r,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},Writer.prototype.int32=function(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)},Writer.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Writer.prototype.uint64=function(e){var r=LongBits$1.from(e);return this._push(writeVarint64,r.length(),r)},Writer.prototype.int64=Writer.prototype.uint64,Writer.prototype.sint64=function(e){var r=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,r.length(),r)},Writer.prototype.bool=function(e){return this._push(writeByte,1,e?1:0)},Writer.prototype.fixed32=function(e){return this._push(writeFixed32,4,e>>>0)},Writer.prototype.sfixed32=Writer.prototype.fixed32,Writer.prototype.fixed64=function(e){var r=LongBits$1.from(e);return this._push(writeFixed32,4,r.lo)._push(writeFixed32,4,r.hi)},Writer.prototype.sfixed64=Writer.prototype.fixed64,Writer.prototype.float=function(e){return this._push(minimal.float.writeFloatLE,4,e)},Writer.prototype.double=function(e){return this._push(minimal.float.writeDoubleLE,8,e)};var writeBytes=minimal.Array.prototype.set?function(e,r,n){r.set(e,n)}:function(e,r,n){for(var o=0;o<e.length;++o)r[n+o]=e[o]};Writer.prototype.bytes=function(e){var r,n=e.length>>>0;return n?(minimal.isString(e)&&(r=Writer.alloc(n=base64.length(e)),base64.decode(e,r,0),e=r),this.uint32(n)._push(writeBytes,n,e)):this._push(writeByte,1,0)},Writer.prototype.string=function(e){var r=utf8.length(e);return r?this.uint32(r)._push(utf8.write,r,e):this._push(writeByte,1,0)},Writer.prototype.fork=function(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer.prototype.ldelim=function(){var e=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=r,this.len+=n),this},Writer.prototype.finish=function(){for(var e=this.head.next,r=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,r,n),n+=e.len,e=e.next;return r},Writer._configure=function(e){BufferWriter=e,Writer.create=create(),BufferWriter._configure()};var writer_buffer=BufferWriter$1;function BufferWriter$1(){writer.call(this)}function writeStringBuffer(e,r,n){e.length<40?minimal.utf8.write(e,r,n):r.utf8Write?r.utf8Write(e,n):r.write(e,n)}(BufferWriter$1.prototype=Object.create(writer.prototype)).constructor=BufferWriter$1,BufferWriter$1._configure=function(){BufferWriter$1.alloc=minimal._Buffer_allocUnsafe,BufferWriter$1.writeBytesBuffer=minimal.Buffer&&minimal.Buffer.prototype instanceof Uint8Array&&minimal.Buffer.prototype.set.name==="set"?function(e,r,n){r.set(e,n)}:function(e,r,n){if(e.copy)e.copy(r,n,0,e.length);else for(var o=0;o<e.length;)r[n++]=e[o++]}},BufferWriter$1.prototype.bytes=function(e){minimal.isString(e)&&(e=minimal._Buffer_from(e,"base64"));var r=e.length>>>0;return this.uint32(r),r&&this._push(BufferWriter$1.writeBytesBuffer,r,e),this},BufferWriter$1.prototype.string=function(e){var r=minimal.Buffer.byteLength(e);return this.uint32(r),r&&this._push(writeStringBuffer,r,e),this},BufferWriter$1._configure();var reader=Reader,BufferReader,LongBits$2=minimal.LongBits,utf8$1=minimal.utf8;function indexOutOfRange(e,r){return RangeError("index out of range: "+e.pos+" + "+(r||1)+" > "+e.len)}function Reader(e){this.buf=e,this.pos=0,this.len=e.length}var create_array=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Reader(e);throw Error("illegal buffer")},create$1=function(){return minimal.Buffer?function(e){return(Reader.create=function(r){return minimal.Buffer.isBuffer(r)?new BufferReader(r):create_array(r)})(e)}:create_array},fU;function readLongVarint(){var e=new LongBits$2(0,0),r=0;if(!(4<this.len-this.pos)){for(;r<3;++r){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*r)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*r)>>>0,e}for(;r<4;++r)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*r)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(r=0,4<this.len-this.pos){for(;r<5;++r)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*r+3)>>>0,this.buf[this.pos++]<128)return e}else for(;r<5;++r){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*r+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function readFixed32_end(e,r){return(e[r-4]|e[r-3]<<8|e[r-2]<<16|e[r-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits$2(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader.create=create$1(),Reader.prototype._slice=minimal.Array.prototype.subarray||minimal.Array.prototype.slice,Reader.prototype.uint32=(fU=4294967295,function(){if(fU=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(fU=(fU|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(fU=(fU|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(fU=(fU|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(fU=(fU|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return fU;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return fU}),Reader.prototype.int32=function(){return 0|this.uint32()},Reader.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},Reader.prototype.bool=function(){return this.uint32()!==0},Reader.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=minimal.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Reader.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=minimal.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Reader.prototype.bytes=function(){var e=this.uint32(),r=this.pos,n=this.pos+e;if(n>this.len)throw indexOutOfRange(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(r,n):r===n?new this.buf.constructor(0):this._slice.call(this.buf,r,n)},Reader.prototype.string=function(){var e=this.bytes();return utf8$1.read(e,0,e.length)},Reader.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(128&this.buf[this.pos++]);return this},Reader.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=7&this.uint32())!=4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Reader._configure=function(e){BufferReader=e,Reader.create=create$1(),BufferReader._configure();var r=minimal.Long?"toLong":"toNumber";minimal.merge(Reader.prototype,{int64:function(){return readLongVarint.call(this)[r](!1)},uint64:function(){return readLongVarint.call(this)[r](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[r](!1)},fixed64:function(){return readFixed64.call(this)[r](!0)},sfixed64:function(){return readFixed64.call(this)[r](!1)}})};var reader_buffer=BufferReader$1;function BufferReader$1(e){reader.call(this,e)}(BufferReader$1.prototype=Object.create(reader.prototype)).constructor=BufferReader$1,BufferReader$1._configure=function(){minimal.Buffer&&(BufferReader$1.prototype._slice=minimal.Buffer.prototype.slice)},BufferReader$1.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},BufferReader$1._configure();var service=Service;function Service(e,r,n){if(typeof e!="function")throw TypeError("rpcImpl must be a function");minimal.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!r,this.responseDelimited=!!n}(Service.prototype=Object.create(minimal.EventEmitter.prototype)).constructor=Service,Service.prototype.rpcCall=function e(r,n,o,s,l){if(!s)throw TypeError("request must be specified");var h=this;if(!l)return minimal.asPromise(e,h,r,n,o,s);if(h.rpcImpl)try{return h.rpcImpl(r,n[h.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(d,y){if(d)return h.emit("error",d,r),l(d);if(y!==null){if(!(y instanceof o))try{y=o[h.responseDelimited?"decodeDelimited":"decode"](y)}catch(g){return h.emit("error",g,r),l(g)}return h.emit("data",y,r),l(null,y)}h.end(!0)})}catch(d){return h.emit("error",d,r),void setTimeout(function(){l(d)},0)}else setTimeout(function(){l(Error("already ended"))},0)},Service.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var rpc_1=createCommonjsModule(function(e,r){r.Service=service}),roots={},indexMinimal=createCommonjsModule(function(e,r){var n=r;function o(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=writer,n.BufferWriter=writer_buffer,n.Reader=reader,n.BufferReader=reader_buffer,n.util=minimal,n.rpc=rpc_1,n.roots=roots,(n.configure=o)()}),minimal$1=indexMinimal;minimal$1.util.Long=long_1,minimal$1.configure(),VectorTileFeature$1.prototype.loadGeometry=function(e){var r=this._pbf;r.pos=this._geometry;for(var n,o,s=r.readVarint()+r.pos,l=1,h=0,d=0,y=0,g=[];r.pos<s;)if(h<=0&&(l=7&(o=r.readVarint()),h=o>>3),h--,l===1||l===2)d+=r.readSVarint(),y+=r.readSVarint(),l===1&&(n&&g.push(n),n=[]),n.push([d*e,y*e]);else{if(l!==7)throw new Error("unknown command "+l);n&&n.push(n[0].slice())}return n&&g.push(n),g};var MAX_SAFE_INTEGER=long_1.fromNumber(Number.MAX_SAFE_INTEGER,!0),MIN_SAFE_INTEGER=long_1.fromNumber(Number.MIN_SAFE_INTEGER,!1);function readLong(e,r,n){r.pos=e.pos;var o=n.call(r);return e.pos=r.pos,long_1.isLong(o)?0<o.comp(MAX_SAFE_INTEGER)||o.comp(MIN_SAFE_INTEGER)<0?o.toString():o.toNumber():o}var VectorTileLayer=function(){function e(r,n){_classCallCheck(this,e),this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],this._protobufjsReader=minimal$1.Reader.create(r.buf),r.readFields(readLayer,this,n),this.length=this._features.length}return _createClass(e,[{key:"feature",value:function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var n=this._pbf.readVarint()+this._pbf.pos;return new VectorTileFeature$1(this._pbf,n,this.extent,this._keys,this._values)}}]),e}();function readLayer(e,r,n){e===15?r.version=n.readVarint():e===1?r.name=n.readString():e===5?r.extent=n.readVarint():e===2?r._features.push(n.pos):e===3?r._keys.push(n.readString()):e===4&&r._values.push(readValueMessage(n,r._protobufjsReader))}function readValueMessage(e,r){for(var s=null,n=e.readVarint()+e.pos;e.pos<n;)var o=e.readVarint()>>3,s=o==1?e.readString():o==2?e.readFloat():o==3?e.readDouble():o==4?readLong(e,r,r.int64):o==5?readLong(e,r,r.uint64):o==6?readLong(e,r,r.sint64):o==7?e.readBoolean():null;return s}var VectorTile=function e(r,n){_classCallCheck(this,e),this.layers=r.readFields(readTile,{},n)};function readTile(e,r,n){var o;e!==3||(o=new VectorTileLayer(n,n.readVarint()+n.pos)).length&&(r[o.name]=o)}function getLayersFromMVT(e){var r={};for(var n in e.layers){for(var o=e.layers[n],s=[],l=Geo$1.tile_scale/o.extent,h=0,d=o.length;h<d;h++){var y=o.feature(h),g=VectorTileFeature$1.types[y.type],v=y.loadGeometry(l),m=null;switch(g){case"Point":m=decodePoint({coordinates:v});break;case"LineString":m=v.length===1?{type:g,coordinates:v[0]}:{type:"MultiLineString",coordinates:v};break;case"Polygon":m=decodeMultiPolygon({coordinates:v})}m&&m.coordinates&&s.push({type:"Feature",geometry:m,properties:y.properties})}r[n]={type:"FeatureCollection",features:s}}return r}var GeomType={UNKNOWN:0,POINT:1,LINESTRING:2,POLYGON:3};function parseGeoJSONVectorTile(e){var r=[],n=e&&e.features;if(n)for(var o=0,s=n.length;o<s;o++){var l=n[o],h=l.type,d=void 0;switch(h){case GeomType.POINT:d={type:"MultiPoint",coordinates:l.geometry.map(function(y){return y.slice()})};break;case GeomType.LINESTRING:case GeomType.POLYGON:if(d={type:"MultiLineString",coordinates:l.geometry.map(function(y){return y.map(function(g){return g.slice()})})},h===GeomType.POLYGON&&(d=decodeMultiPolygon(d))==null)continue;break;default:continue}r.push({id:l.id,type:"Feature",geometry:d,properties:l.tags})}return{type:"FeatureCollection",features:r}}function decodeMultiPolygon(e){for(var r,n=[],o=[],s=0,l=e.coordinates.length;s<l;s++){var h=e.coordinates[s],d=Geo$1.ringWinding(h);d!=null&&(d===(r=r||d)&&o.length&&(n.push(o),o=[]),o.push(h))}return 0<o.length&&n.push(o),n.length===1?(e.type="Polygon",e.coordinates=n[0]):1<n.length?(e.type="MultiPolygon",e.coordinates=n):e=null,e}function decodePoint(e){var r=e.coordinates.length;if(1<r){e.type="MultiPoint";for(var n=[],o=0;o<r;o++)n.push(e.coordinates[o][0]);e.coordinates=n}else e.type="Point",e.coordinates=e.coordinates[0][0];return e}var EMPTY_FEATURE_COLLECTION={type:"FeatureCollection",features:[]},MVTSource=function(){_inherits(r,MapsJsSource);var e=_createSuper(r);function r(n,o){return _classCallCheck(this,r),n.tiled=!0,e.call(this,n,o)}return _createClass(r,[{key:"fetchTile",value:function(n,o,s){return this.provider?this.provider.requestTileAsPromise(n,o,s).then(function(l){return l.data}):Promise.resolve()}},{key:"_load",value:function(n){var o=this,s=Geo$1.wrapTile(n.coords,{x:!0,y:!0}),l=s.x,h=s.y,d=s.z;return WorkerBroker.postMessage(this.target_name+".fetchTile",l,h,d).then(function(y){var g;return y instanceof ArrayBuffer?(g=new pbf(new Uint8Array(y)),n.source_data.layers=getLayersFromMVT(new VectorTile(g))):y?n.source_data.error=y:n.source_data.layers={_default:EMPTY_FEATURE_COLLECTION},o._postProcessTile(n),n})}},{key:"onReady",value:function(){this.dispatchUpdate()}}]),r}();DataSource.register(MVTSource,"MVT"),DataSource.register(MVTSource,"OMV");var csscolorparser=createCommonjsModule(function(e,r){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(y){return(y=Math.round(y))<0?0:255<y?255:y}function s(y){return y<0?0:1<y?1:y}function l(y){return y[y.length-1]==="%"?o(parseFloat(y)/100*255):o(parseInt(y))}function h(y){return y[y.length-1]==="%"?s(parseFloat(y)/100):s(parseFloat(y))}function d(y,g,v){return v<0?v+=1:1<v&&--v,6*v<1?y+(g-y)*v*6:2*v<1?g:3*v<2?y+(g-y)*(2/3-v)*6:y}try{r.parseCSSColor=function(y){var g,v=y.replace(/ /g,"").toLowerCase();if(v in n)return n[v].slice();if(v[0]==="#")return v.length===4?0<=(g=parseInt(v.substr(1),16))&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:v.length===7&&0<=(g=parseInt(v.substr(1),16))&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var m=v.indexOf("("),w=v.indexOf(")");if(m!==-1&&w+1===v.length){var I=v.substr(0,m),V=v.substr(m+1,w-(m+1)).split(","),q=1;switch(I){case"rgba":if(V.length!==4)return null;q=h(V.pop());case"rgb":return V.length!==3?null:[l(V[0]),l(V[1]),l(V[2]),q];case"hsla":if(V.length!==4)return null;q=h(V.pop());case"hsl":if(V.length!==3)return null;var De=(parseFloat(V[0])%360+360)%360/360,_n=h(V[1]),ha=h(V[2]),ga=ha<=.5?ha*(_n+1):ha+_n-ha*_n,_o=2*ha-ga;return[o(255*d(_o,ga,De+1/3)),o(255*d(_o,ga,De)),o(255*d(_o,ga,De-1/3)),q];default:return null}}return null}}catch{}});csscolorparser.parseCSSColor;var StyleParser={},clampPositive=function(e){return Math.max(e,0)},noNaN=function(e){return isNaN(e)?0:e},parseNumber=function(e){return Array.isArray(e)?e.map(parseFloat).map(noNaN):noNaN(parseFloat(e))},parsePositiveNumber=function(e){return Array.isArray(e)?e.map(parseNumber).map(clampPositive):clampPositive(parseNumber(e))};Object.assign(StyleParser,{clampPositive,noNaN,parseNumber,parsePositiveNumber}),StyleParser.wrapFunction=function(e){return`
        var feature = context.feature.properties;
        var global = context.global;
        var $zoom = context.zoom;
        var $layer = context.layer;
        var $source = context.source;
        var sources = context.sources;
        var $geometry = context.geometry;
        var $meters_per_pixel = context.meters_per_pixel;

        var val = (function(){ `.concat(e,` }());

        if (typeof val === 'number' && isNaN(val)) {
            val = null; // convert NaNs to nulls
        }

        return val;
    `)},StyleParser.zeroPair=Object.freeze([0,0]),StyleParser.defaults={color:[1,1,1,1],width:1,size:1,extrude:!1,height:20,min_height:0,order:0,z:0,outline:{color:[0,0,0,0],width:0},material:{ambient:1,diffuse:1}},StyleParser.macros={"Style.color.pseudoRandomColor":function(){return[parseInt(feature.id,16)/100%1*.7,parseInt(feature.id,16)/1e4%1*.7,parseInt(feature.id,16)/1e6%1*.7,1]},"Style.color.randomColor":function(){return[.7*Math.random(),.7*Math.random(),.7*Math.random(),1]}},StyleParser.getFeatureParseContext=function(e,r,n,o){return{feature:e,tile:r,global:n,sources:o,zoom:r.style_zoom,geometry:Geo$1.geometryType(e.geometry.type),meters_per_pixel:r.meters_per_pixel,meters_per_pixel_sq:r.meters_per_pixel_sq,units_per_meter_overzoom:r.units_per_meter_overzoom}};var CACHE_TYPE={STATIC:0,DYNAMIC:1,ZOOM:2};StyleParser.CACHE_TYPE=CACHE_TYPE,StyleParser.createPropertyCache=function(e){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null;if(e!=null){if(e.value)return{value:e.value,zoom:e.zoom?{}:null,type:e.type};var n={value:e,type:CACHE_TYPE.STATIC};return Array.isArray(n.value)&&Array.isArray(n.value[0])?(n.zoom={},n.type=CACHE_TYPE.ZOOM):typeof n.value=="function"&&(n.type=CACHE_TYPE.DYNAMIC),typeof r=="function"&&(n.zoom?n.value=n.value.map(function(o,s){return[o[0],r(o[1],s)]}):typeof n.value!="function"&&(n.value=r(n.value,0))),n}},StyleParser.createColorPropertyCache=function(e){return StyleParser.createPropertyCache(e,function(r){return r==="Style.color.pseudoRandomColor"?Utils$1.stringToFunction(StyleParser.wrapFunction(StyleParser.macros["Style.color.pseudoRandomColor"])):r==="Style.color.randomColor"?StyleParser.macros["Style.color.randomColor"]:r})};var isPercent=function(e){return typeof e=="string"&&e[e.length-1]==="%"},isRatio=function(e){return e==="auto"},isComputed=function(e){return isPercent(e)||isRatio(e)},dualRatioError="'size' can specify either width or height as derived from aspect ratio, but not both";StyleParser.createPointSizePropertyCache=function(e){var r=null,n=null;if(isPercent(e))r=[!0];else if(Array.isArray(e)){if(Array.isArray(e[0])){if(e.some(function(o){return Array.isArray(o[1])?o[1].some(function(s){return isComputed(s)}):isPercent(o[1])})&&(r=e.map(function(o){return Array.isArray(o[1])?o[1].map(function(s){return isPercent(s)}):isPercent(o[1])}),(n=e.map(function(o){return Array.isArray(o[1])&&o[1].map(function(s){return isRatio(s)})})).some(function(o){return Array.isArray(o)&&o.every(function(s){return s})})))throw dualRatioError}else if(e.some(isComputed)&&(r=[e.map(isPercent)],(n=[e.map(isRatio)])[0].every(function(o){return o})))throw dualRatioError}return r?((e={value:e}).has_pct=r,e.has_ratio=n,e.sprites={}):e=StyleParser.createPropertyCache(e,parsePositiveNumber),e},StyleParser.evalCachedPointSizeProperty=function(e,r,n){return e.has_pct||e.has_ratio?r?(e.sprites[r.sprite]||(e.sprites[r.sprite]=StyleParser.createPropertyCache(e.value,function(o,s){return Array.isArray(o)?(o=o.map(function(l,h){return e.has_ratio[s][h]?l:parsePositiveNumber(l)}).map(function(l,h){return e.has_pct[s][h]?r.css_size[h]*l/100:l}),e.has_ratio[s][0]?o[0]=o[1]*r.aspect:e.has_ratio[s][1]&&(o[1]=o[0]/r.aspect)):(o=parsePositiveNumber(o),o=e.has_pct[s]?r.css_size.map(function(l){return l*o/100}):[o,o]),o})),StyleParser.evalCachedProperty(e.sprites[r.sprite],n)):void 0:StyleParser.evalCachedProperty(e,n)},StyleParser.evalCachedProperty=function(e,r){if(e!=null)return e.dynamic?e.dynamic(r):e.static?e.static:e.zoom&&e.zoom[r.zoom]?e.zoom[r.zoom]:typeof e.value!="function"?Array.isArray(e.value)&&Array.isArray(e.value[0])?(e.zoom=e.zoom||{},e.zoom[r.zoom]=Utils$1.interpolate(r.zoom,e.value),e.zoom[r.zoom]):(e.static=e.value,e.static):(e.dynamic=e.value,e.dynamic(r))},StyleParser.convertUnits=function(e,r){if(e.val!=null)return e.units==="px"?e.val*Geo$1.metersPerPixel(r.zoom):e.val;if(typeof e=="string")e.trim().slice(-2)==="px"?(e=parseNumber(e),e*=Geo$1.metersPerPixel(r.zoom)):e=parseNumber(e);else if(Array.isArray(e))return Array.isArray(e[0])?e.map(function(n){return[n[0],StyleParser.convertUnits(n[1],r)]}):e.map(function(n){return StyleParser.convertUnits(n,r)});return e},StyleParser.parseUnits=function(e){var r={val:parseNumber(e)};return r.val!==0&&typeof e=="string"&&e.trim().slice(-2)==="px"&&(r.units="px"),r},StyleParser.evalCachedDistanceProperty=function(e,r){return e.dynamic?e.dynamic(r):e.zoom&&e.zoom[r.zoom]?e.zoom[r.zoom]:typeof e.value!="function"?e.zoom?(e.zoom[r.zoom]=Utils$1.interpolate(r.zoom,e.value,function(n){return StyleParser.convertUnits(n,r)}),e.zoom[r.zoom]):StyleParser.convertUnits(e.value,r):(e.dynamic=e.value,e.dynamic(r))},StyleParser.string_colors={},StyleParser.colorForString=function(e){if(StyleParser.string_colors[e])return StyleParser.string_colors[e];var r=null;return e!=="none"&&((r=csscolorparser.parseCSSColor(e))&&r.length===4?(r[0]/=255,r[1]/=255,r[2]/=255):r=StyleParser.defaults.color),StyleParser.string_colors[e]=r},StyleParser.evalCachedColorProperty=function(e){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(e.dynamic){var n=e.dynamic(r);return typeof n=="string"&&(n=StyleParser.colorForString(n)),n&&n[3]==null&&(n[3]=1),n}if(e.static)return e.static;if(e.zoom&&e.zoom[r.zoom])return e.zoom[r.zoom];if(typeof e.value=="function"){e.dynamic=e.value;var o=e.dynamic(r);return typeof o=="string"&&(o=StyleParser.colorForString(o)),o&&o[3]==null&&(o[3]=1),o}if(typeof e.value=="string")return e.static=StyleParser.colorForString(e.value),e.static;if(e.zoom){if(!e.zoom_preprocessed){for(var s=0;s<e.value.length;s++){var l=e.value[s];l&&typeof l[1]=="string"&&(l[1]=StyleParser.colorForString(l[1]))}e.zoom_preprocessed=!0}return e.zoom[r.zoom]=Utils$1.interpolate(r.zoom,e.value),e.zoom[r.zoom][3]=e.zoom[r.zoom][3]||1,e.zoom[r.zoom]}return e.static=e.value.map(function(h){return h}),e.static&&e.static[3]==null&&(e.static[3]=1),e.static},StyleParser.parseColor=function(e){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="function"&&(e=e(r)),typeof e=="string")e=StyleParser.colorForString(e);else if(Array.isArray(e)&&Array.isArray(e[0])){for(var n=0;n<e.length;n++){var o=e[n];typeof o[1]=="string"&&(o[1]=StyleParser.colorForString(o[1]))}r.zoom&&(e=Utils$1.interpolate(r.zoom,e))}return Array.isArray(e)?(e=e.map(function(s){return s}))[3]==null&&(e[3]=1):e=[0,0,0,1],e},StyleParser.calculateOrder=function(e,r){return typeof e=="function"?e=e(r):typeof e=="string"&&(e=r.feature.properties[e]?r.feature.properties[e]:parsePositiveNumber(e)),e},StyleParser.evalProperty=function(e,r){return typeof e=="function"?e(r):e};var RepeatGroup=function(){function e(r,n){_classCallCheck(this,e),this.key=r,this.repeat_dist=n,this.repeat_dist_sq=this.repeat_dist*this.repeat_dist,this.positions=[]}return _createClass(e,[{key:"check",value:function(r){for(var n=r.position,o=0;o<this.positions.length;o++){var s=this.positions[o],l=n[0]-s[0],h=n[1]-s[1],d=l*l+h*h;if(d<this.repeat_dist_sq)return{dist_sq:d,repeat_dist_sq:this.repeat_dist_sq}}}},{key:"add",value:function(r){r&&r.position&&this.positions.push(r.position)}}],[{key:"clear",value:function(r){this.groups[r]={}}},{key:"check",value:function(r,n,o){if(n.repeat_distance&&n.repeat_group&&this.groups[o][n.repeat_group])return this.groups[o][n.repeat_group].check(r)}},{key:"add",value:function(r,n,o){n.repeat_distance&&n.repeat_group&&(this.groups[o][n.repeat_group]==null&&(this.groups[o][n.repeat_group]=new e(n.repeat_group,n.repeat_distance*n.repeat_scale)),this.groups[o][n.repeat_group].add(r))}}]),e}();RepeatGroup.groups={};var GridIndex=function(){function e(r,n,o){_classCallCheck(this,e);var s=this.boxCells=[],l=this.circleCells=[];this.xCellCount=Math.ceil(r/o),this.yCellCount=Math.ceil(n/o);for(var h=0;h<this.xCellCount*this.yCellCount;h++)s.push([]),l.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=n,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}return _createClass(e,[{key:"keysLength",value:function(){return this.boxKeys.length+this.circleKeys.length}},{key:"insert",value:function(r,n,o,s,l){this._forEachCell(n,o,s,l,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(s),this.bboxes.push(l)}},{key:"insertCircle",value:function(r,n,o,s){this._forEachCell(n-s,o-s,n+s,o+s,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(n),this.circles.push(o),this.circles.push(s)}},{key:"insertCircleList",value:function(r,n){for(var o=0;o<n.length-2;o+=3)this.insertCircle("".concat(r,"/").concat(o),n[o],n[o+1],n[o+2])}},{key:"_insertBoxCell",value:function(r,n,o,s,l,h){this.boxCells[l].push(h)}},{key:"_insertCircleCell",value:function(r,n,o,s,l,h){this.circleCells[l].push(h)}},{key:"_query",value:function(r,n,o,s,l,h){if(o<0||r>this.width||s<0||n>this.height)return!l&&[];var d=[];if(r<=0&&n<=0&&this.width<=o&&this.height<=s){if(l)return!0;for(var y=0;y<this.boxKeys.length;y++)d.push({key:this.boxKeys[y],x1:this.bboxes[4*y],y1:this.bboxes[4*y+1],x2:this.bboxes[4*y+2],y2:this.bboxes[4*y+3]});for(var g=0;g<this.circleKeys.length;g++){var v=this.circles[3*g],m=this.circles[3*g+1],w=this.circles[3*g+2];d.push({key:this.circleKeys[g],x1:v-w,y1:m-w,x2:v+w,y2:m+w})}return h?d.filter(h):d}var I={hitTest:l,seenUids:{box:{},circle:{}}};return this._forEachCell(r,n,o,s,this._queryCell,d,I,h),l?0<d.length:d}},{key:"_queryCircle",value:function(r,n,o,s,l){var h=r-o,d=r+o,y=n-o,g=n+o;if(d<0||h>this.width||g<0||y>this.height)return!s&&[];var v=[],m={hitTest:s,circle:{x:r,y:n,radius:o},seenUids:{box:{},circle:{}}};return this._forEachCell(h,y,d,g,this._queryCellCircle,v,m,l),s?0<v.length:v}},{key:"query",value:function(r,n,o,s,l){return this._query(r,n,o,s,!1,l)}},{key:"hitTest",value:function(r,n,o,s,l){return this._query(r,n,o,s,!0,l)}},{key:"hitTestCircle",value:function(r,n,o,s){return this._queryCircle(r,n,o,!0,s)}},{key:"hitTestCircleList",value:function(r,n){for(var o=0;o<r.length-2;o+=3)if(this.hitTestCircle(r[o],r[o+1],r[o+2],n))return!0;return!1}},{key:"_queryCell",value:function(r,n,o,s,l,h,d,y){var g=d.seenUids,v=this.boxCells[l];if(v!==null){var m,w=this.bboxes,I=_createForOfIteratorHelper(v);try{for(I.s();!(m=I.n()).done;){var V=m.value;if(!g.box[V]){g.box[V]=!0;var q=4*V;if(r<=w[2+q]&&n<=w[3+q]&&o>=w[0+q]&&s>=w[1+q]&&(!y||y(this.boxKeys[V]))){if(d.hitTest)return h.push(!0),!0;h.push({key:this.boxKeys[V],x1:w[q],y1:w[1+q],x2:w[2+q],y2:w[3+q]})}}}}catch(pd){I.e(pd)}finally{I.f()}}var De=this.circleCells[l];if(De!==null){var _n,ha=this.circles,ga=_createForOfIteratorHelper(De);try{for(ga.s();!(_n=ga.n()).done;){var _o=_n.value;if(!g.circle[_o]){g.circle[_o]=!0;var _l=3*_o;if(this._circleAndRectCollide(ha[_l],ha[1+_l],ha[2+_l],r,n,o,s)&&(!y||y(this.circleKeys[_o]))){if(d.hitTest)return h.push(!0),!0;var wc=ha[_l],_h=ha[1+_l],_p=ha[2+_l];h.push({key:this.circleKeys[_o],x1:wc-_p,y1:_h-_p,x2:wc+_p,y2:_h+_p})}}}}catch(pd){ga.e(pd)}finally{ga.f()}}}},{key:"_queryCellCircle",value:function(r,n,o,s,l,h,d,y){var g=d.circle,v=d.seenUids,m=this.boxCells[l];if(m!==null){var w,I=this.bboxes,V=_createForOfIteratorHelper(m);try{for(V.s();!(w=V.n()).done;){var q=w.value;if(!v.box[q]){v.box[q]=!0;var De=4*q;if(this._circleAndRectCollide(g.x,g.y,g.radius,I[0+De],I[1+De],I[2+De],I[3+De])&&(!y||y(this.boxKeys[q])))return h.push(!0),!0}}}catch(_h){V.e(_h)}finally{V.f()}}var _n=this.circleCells[l];if(_n!==null){var ha,ga=this.circles,_o=_createForOfIteratorHelper(_n);try{for(_o.s();!(ha=_o.n()).done;){var _l=ha.value;if(!v.circle[_l]){v.circle[_l]=!0;var wc=3*_l;if(this._circlesCollide(ga[wc],ga[1+wc],ga[2+wc],g.x,g.y,g.radius)&&(!y||y(this.circleKeys[_l])))return h.push(!0),!0}}}catch(_h){_o.e(_h)}finally{_o.f()}}}},{key:"_forEachCell",value:function(r,n,o,s,l,h,d,y){for(var g=this._convertToXCellCoord(r),v=this._convertToYCellCoord(n),m=this._convertToXCellCoord(o),w=this._convertToYCellCoord(s),I=g;I<=m;I++)for(var V=v;V<=w;V++){var q=this.xCellCount*V+I;if(l.call(this,r,n,o,s,q,h,d,y))return}}},{key:"_convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"_convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}},{key:"_circlesCollide",value:function(r,n,o,s,l,h){var d=s-r,y=l-n,g=o+h;return d*d+y*y<g*g}},{key:"_circleAndRectCollide",value:function(r,n,o,s,l,h,d){var y=(h-s)/2,g=Math.abs(r-(s+y));if(y+o<g)return!1;var v=(d-l)/2,m=Math.abs(n-(l+v));if(v+o<m)return!1;if(g<=y||m<=v)return!0;var w=g-y,I=m-v;return w*w+I*I<=o*o}}]),e}(),CollisionUtils={toDiscardLabel:function(e,r,n,o){var s;if(o&&(s=function(_h){return _h!==o.id}),!r){if(e.type==="point"&&!e.angle){var l=e.getAABB(),h=l.left,d=l.top,y=l.right,g=l.bottom;if(n.hitTest(h,-d,y,-g,s)){if(Array.isArray(e.layout.anchor))for(var v=1;v<e.layout.anchor.length;v++){e.setAnchor(e.layout.anchor[v]);var m=e.getAABB(),w=m.left,I=m.top,V=m.right,q=m.bottom;if(!n.hitTest(w,-I,V,-q,s))return!1}return!0}return!1}var De=e.getBoundingCircles();return n.hitTestCircleList(De,s)}if(r){if(e.type==="point"&&!e.isFlat()){var _n=e.getScreenSpaceBoundingBox(),ha=_n.left,ga=_n.top,_o=_n.right,_l=_n.bottom;return n.hitTest(ha,ga,_o,_l,s)}var wc=e.getBoundingCircles();return n.hitTestCircleList(wc,s)}return!1},addLabel:function(e,r,n){var o,s,l,h,d,y,g,v,m,w,I,V,q=e.id;e.placed=!0,r||(e.type!=="point"||e.angle?(o=e.getBoundingCircles(),n.insertCircleList(q,o)):(l=(s=e.getAABB()).left,h=s.top,d=s.right,y=s.bottom,n.insert(q,l,-h,d,-y))),r&&(e.type!=="point"||e.isFlat()?(g=e.getBoundingCircles(),n.insertCircleList(q,g)):(m=(v=e.getScreenSpaceBoundingBox()).left,w=v.top,I=v.right,V=v.bottom,n.insert(q,m,w,I,V)))}},Collision={tiles:{},startTile:function(e,r){var n=1<arguments.length&&r!==void 0?r:{},o=n.apply_repeat_groups,s=o===void 0||o,l=n.return_hidden,h=l!==void 0&&l,d=n.grid_index,y=d===void 0?null:d,g=this.tiles[e]={grid_index:y||new GridIndex(Geo$1.tile_scale,Geo$1.tile_scale,240),objects:{},labels:{},styles:{},repeat:s,return_hidden:h};g.complete==null&&(g.complete=new Promise(function(v,m){g.resolve=v,g.reject=m}))},resetTile:function(e){delete this.tiles[e]},abortTile:function(e){this.tiles[e]&&this.tiles[e].resolve&&this.tiles[e].resolve([]),this.resetTile(e)},addStyle:function(e,r){this.tiles[r].styles[e]=!0},collide:function(e,r,n){var o=this.tiles[n];if(!o)return Promise.resolve([]);for(var s=o.objects,l=0;l<e.length;l++){var h=e[l],d=h.label.layout.priority;s[d]=s[d]||{},s[d][r]=s[d][r]||[],s[d][r].push(h)}return delete o.styles[r],Object.keys(o.styles).length===0&&this.endTile(n),o.complete.then(function(){return o.resolve=null,o.labels[r]||[]})},endTile:function(e){var r=this.tiles[e],n=r.labels;r.repeat&&RepeatGroup.clear(e);for(var o=Object.keys(r.objects).sort(function(v,m){return v-m}),s=0;s<o.length;s++){var l=r.objects[o[s]];if(l)for(var h in l){var d=l[h];n[h]=n[h]||[];for(var y=0;y<d.length;y++){var g=d[y];this.canBePlaced(g,e,g.linked,r)?g.linked?this.canBePlaced(g.linked,e,g,r)?(g.show=!0,(g.label.breach||g.linked.label.breach)&&(g.label.breach=!0,g.linked.label.breach=!0),n[h].push(g),this.place(g,e,r),this.place(g.linked,e,r)):r.return_hidden&&(g.show=!1,n[h].push(g)):(g.show=!0,n[h].push(g),this.place(g,e,r)):r.return_hidden&&(g.show=!1,n[h].push(g))}}}delete this.tiles[e],r.resolve()},canBePlaced:function(e,r,n,o){var s=2<arguments.length&&n!==void 0?n:null,l=(3<arguments.length&&o!==void 0?o:{}).repeat,h=l===void 0||l,d=e.label,y=e.label.layout;if(d.placed!==null)return d.placed;var g=this.tiles[r].grid_index;if(y.collide&&CollisionUtils.toDiscardLabel(d,r==="main",g,s&&s.label))y.collide&&(d.placed=!1);else{if(!(h&&RepeatGroup.check(d,y,r)))return!0;d.placed=!1}return d.placed},place:function(e,r,n){var o=e.label,s=n.repeat,l=s===void 0||s;o.placed===null&&(l&&RepeatGroup.add(o,o.layout,r),CollisionUtils.addLabel(o,r==="main",this.tiles[r].grid_index))}},Task={id:0,queue:[],max_time:20,start_time:null,state:{},ignore_user_moving_view:!1,_ignoreViewMoveWithDebounce:debounce(function(){Task.ignore_user_moving_view=!0},0,500),add:function(e){e.id=Task.id++,e.max_time=e.max_time||Task.max_time,e.pause_factor=e.pause_factor||1;var r=new Promise(function(n,o){e.resolve=n,e.reject=o});return e.promise=r,e.total_elapsed=0,e.stats={calls:0},this.queue.push(e),this.start_time=this.start_time||performance.now(),this.elapsed=performance.now()-this.start_time,this.elapsed<Task.max_time&&this.process(e),e.promise},remove:function(e){var r=this.queue.indexOf(e);-1<r&&this.queue.splice(r,1)},process:function(e){if(!this.state.user_moving_view||e.user_moving_view!==!1||this.ignore_user_moving_view)return e.pause?(e.pause--,!0):(e.stats.calls++,e.start_time=performance.now(),e.run(e));Task._ignoreViewMoveWithDebounce()},processAll:function(){this.start_time=this.start_time||performance.now(),this.ignore_user_moving_view&&!this.hasPendingTasks()&&(this.ignore_user_moving_view=!1);for(var e=0;e<this.queue.length;e++){var r=this.queue[e];if(this.process(r)!==!0&&(r.pause||(r.pause=r.elapsed>r.max_time?r.pause_factor:0),r.total_elapsed+=r.elapsed),this.elapsed=performance.now()-this.start_time,this.elapsed>=Task.max_time){this.start_time=null;break}}},finish:function(e,r){return e.elapsed=performance.now()-e.start_time,e.total_elapsed+=e.elapsed,this.remove(e),e.resolve(r),e.promise},cancel:function(e){var r;e.cancel instanceof Function&&(r=e.cancel(e)),e.resolve(r||{})},shouldContinue:function(e){return e.elapsed=performance.now()-e.start_time,this.elapsed=performance.now()-this.start_time,e.elapsed<e.max_time&&this.elapsed<Task.max_time},removeForTile:function(e){for(var r=this.queue.length-1;0<=r;r--)this.queue[r].tile_id===e&&(this.cancel(this.queue[r]),this.queue.splice(r,1))},setState:function(e){this.state=e},hasPendingTasks:function(){return!!this.queue.length}};function sliceOptions(e){return{coords:e.coords,uid:e.uid,filtering:e.filtering,sprites:e.sprites,url:e.url,element:e.element,data:e.data,width:e.width,height:e.height,density:e.density,repeat:e.repeat,TEXTURE_WRAP_S:e.TEXTURE_WRAP_S,TEXTURE_WRAP_T:e.TEXTURE_WRAP_T,UNPACK_FLIP_Y_WEBGL:e.UNPACK_FLIP_Y_WEBGL,UNPACK_PREMULTIPLY_ALPHA_WEBGL:e.UNPACK_PREMULTIPLY_ALPHA_WEBGL}}var Texture=function(){function e(r,n,o){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};_classCallCheck(this,e),s=sliceOptions(s),this.gl=r,this.texture=r.createTexture(),this.texture&&(this.valid=!0),this.manager=o,this.bind(),this.name=n,this.retain_count=0,this.config_type=null,this.loading=null,this.loaded=!1,this.filtering=s.filtering,this.density=s.density||1,this.sprites=s.sprites,this.texcoords={},this.sizes={},this.css_sizes={},this.aspects={},this._byte_length=0,this.setData(1,1,new Uint8Array([0,0,0,0]),{filtering:"nearest"}),this.loaded=!1,this.manager.textures[this.name]&&(this.retain_count=this.manager.textures[this.name].retain_count,this.manager.textures[this.name].retain_count=0,this.manager.textures[this.name].destroy()),(this.manager.textures[this.name]=this).manager.texture_configs[this.name]=JSON.stringify(Object.assign({name:n},s)),this.load(s),log("trace","creating Texture ".concat(this.name))}return _createClass(e,[{key:"destroy",value:function(r){var n=(0<arguments.length&&r!==void 0?r:{}).force;0<this.retain_count&&!n?log("error","Texture '".concat(this.name,"': destroying texture with retain count of '").concat(this.retain_count,"'")):this.valid&&(this.gl.deleteTexture(this.texture),this.texture=null,delete this.data,this.data=null,delete this.manager.textures[this.name],delete this.manager.texture_configs[this.name],this.valid=!1,this._byte_length=0,log("trace","destroying Texture ".concat(this.name)))}},{key:"retain",value:function(){this.retain_count++}},{key:"release",value:function(){this.retain_count<=0&&log("error","Texture '".concat(this.name,"': releasing texture with retain count of '").concat(this.retain_count,"'")),this.retain_count--,this.retain_count<=0&&this.destroy()}},{key:"bind",value:function(r){var n=0<arguments.length&&r!==void 0?r:0;this.valid&&(this.manager.activeUnit!==n&&(this.gl.activeTexture(this.gl.TEXTURE0+n),this.manager.activeUnit=n,this.manager.boundTexture=null),this.manager.boundTexture!==this.texture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.manager.boundTexture=this.texture))}},{key:"load",value:function(r){var n=this;return r?(this.loading=null,typeof r.url=="string"?(this.config_type="url",this.setUrl(r.url,r)):r.element?(this.config_type="element",this.setElement(r.element,r)):r.data&&r.width&&r.height&&(this.config_type="data",this.setData(r.width,r.height,r.data,r)),this.loading=this.loading&&this.loading.then(function(){return n.calculateSprites(),n})||Promise.resolve(this),this.loading):this.loading||Promise.resolve(this)}},{key:"setUrl",value:function(r,n){var o=this,s=1<arguments.length&&n!==void 0?n:{};if(this.valid)return this.url=r,this.loading=new Promise(function(l,h){var d=new Image;d.onload=function(){try{o.setElement(d,s)}catch(y){o.loaded=!1,log("warn","Texture '".concat(o.name,"': failed to load url: '").concat(o.url,"'"),y,s),o.manager.trigger("warning",{message:"Failed to load texture from ".concat(o.url),error:y,texture:s})}o.loaded=!0,l(o)},d.onerror=function(y){o.loaded=!1,log("warn","Texture '".concat(o.name,"': failed to load url: '").concat(o.url,"'"),y,s),o.manager.trigger("warning",{message:"Failed to load texture from ".concat(o.url),error:y,texture:s}),l(o)},Utils$1.isSafari()&&o.url.slice(0,5)==="data:"||(d.crossOrigin="anonymous"),d.src=o.url}),this.loading}},{key:"setData",value:function(r,n,o,s){var l=3<arguments.length&&s!==void 0?s:{};return this.width=r,this.height=n,Array.isArray(o)&&(o=new Uint8Array(o)),this.update(o,l),this.setFiltering(l),this.loaded=!0,this.loading=Promise.resolve(this),this.loading}},{key:"setElement",value:function(r,n){var o,s=r;return typeof r=="string"&&(r=document.querySelector(r)),r instanceof HTMLCanvasElement||r instanceof HTMLImageElement||r instanceof HTMLVideoElement?(this.update(r,n),this.setFiltering(n)):(this.loaded=!1,o="the 'element' parameter (`element: ".concat(JSON.stringify(s),"`) must be a CSS "),o+="selector string, or a <canvas>, <image> or <video> object",log("warn","Texture '".concat(this.name,"': ").concat(o),n),this.manager.trigger("warning",{message:"Failed to load texture because ".concat(o),texture:n})),this.loaded=!0,this.loading=Promise.resolve(this),this.loading}},{key:"update",value:function(r,n){var o=1<arguments.length&&n!==void 0?n:{};this.valid&&(this.bind(),r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof HTMLImageElement&&r.complete?(this.width=r.width,this.height=r.height,this._byte_length=this.width*this.height*4,this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,o.UNPACK_FLIP_Y_WEBGL!==!1),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.UNPACK_PREMULTIPLY_ALPHA_WEBGL||!1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,r)):(this._byte_length=r?r.byteLength:0,this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.width,this.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,r)),this.manager.trigger("update",this))}},{key:"getByteLength",value:function(){return this._byte_length}},{key:"setFiltering",value:function(r){var n,o=0<arguments.length&&r!==void 0?r:{};this.valid&&(o.filtering=o.filtering||"linear",n=this.gl,this.bind(),Utils$1.isPowerOf2(this.width)&&Utils$1.isPowerOf2(this.height)?(this.power_of_2=!0,n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,o.TEXTURE_WRAP_S||o.repeat&&n.REPEAT||n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,o.TEXTURE_WRAP_T||o.repeat&&n.REPEAT||n.CLAMP_TO_EDGE),o.filtering==="mipmap"?(this.filtering="mipmap",n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.generateMipmap(n.TEXTURE_2D)):o.filtering==="linear"?(this.filtering="linear",n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR)):o.filtering==="nearest"&&(this.filtering="nearest",n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST))):(this.power_of_2=!1,n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),o.filtering==="nearest"?(this.filtering="nearest",n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)):(this.filtering="linear",n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR))),this.manager.trigger("update",this))}},{key:"calculateSprites",value:function(){if(this.sprites)for(var r in this.sprites){var n=this.sprites[r];this.texcoords[r]=this.manager.getTexcoordsForSprite([n[0],n[1]],[n[2],n[3]],[this.width,this.height]),this.sizes[r]=[n[2],n[3]],this.css_sizes[r]=[n[2]/this.density,n[3]/this.density],this.aspects[r]=n[2]/n[3]}}}]),e}();function subscribeMixin(e){var r=[];return Object.assign(e,{subscribe:function(n){r.indexOf(n)===-1&&r.push(n)},unsubscribe:function(n){var o=r.indexOf(n);-1<o&&r.splice(o,1)},unsubscribeAll:function(){r=[]},trigger:function(n){for(var o=arguments.length,s=new Array(1<o?o-1:0),l=1;l<o;l++)s[l-1]=arguments[l];r.forEach(function(h){if(typeof h[n]=="function")try{h[n].apply(h,s)}catch(d){log("warn","Caught exception in listener for event '".concat(n,"':"),d)}})},hasSubscribersFor:function(n){var o=!1;return r.forEach(function(s){typeof s[n]=="function"&&(o=!0)}),o}})}var TextureManager=function(){function e(r){_classCallCheck(this,e),this.default=e.DEFAULT_TEXTURE_NAME,this.textures={},this.texture_configs={},this.boundTexture=null,this.activeUnit=null,this.scene_id=r,WorkerBroker.addTarget("Texture"+this.scene_id,this),subscribeMixin(this)}return _createClass(e,[{key:"create",value:function(r,n,o){for(var s=e.matchers_,l=0;l<s.length;l++){var h=s[l][0],d=s[l][1];if(d&&d(o))return new h(r,n,this,o)}return new Texture(r,n,this,o)}},{key:"retain",value:function(r){this.textures[r]&&this.textures[r].retain()}},{key:"release",value:function(r){this.textures[r]&&this.textures[r].release()}},{key:"getRetainCount",value:function(r){if(this.textures[r])return this.textures[r].retain_count}},{key:"getByteLength",value:function(r){if(this.textures[r])return this.textures[r].getByteLength()}},{key:"destroy",value:function(r){var n=this;Object.keys(this.textures).forEach(function(o){var s=n.textures[o];o!==n.default&&s.gl===r&&s.destroy({force:!0})})}},{key:"getSpriteInfo",value:function(r,n){var o=this.textures[r];return o&&{size:o.sizes[n],css_size:o.css_sizes[n],aspect:o.aspects[n],texcoords:o.texcoords[n]}}},{key:"getTexcoordsForSprite",value:function(r,n,o){var s=o[1]-r[1]-n[1];return[r[0]/o[0],s/o[1],(n[0]+r[0])/o[0],(n[1]+s)/o[1]]}},{key:"createFromObject",value:function(r,n){var o=[];if(n)for(var s in n){var l,h=n[s];this.changed(s,h)&&(l=this.create(r,s,h),o.push(l.loading))}return Promise.all(o)}},{key:"createDefault",value:function(r){return this.create(r,this.default)}},{key:"changed",value:function(r,n){var o=this.textures[r];if(o){if(o.config_type==="element"||n.element!=null)return!0;if(n=sliceOptions(n),this.texture_configs[r]===JSON.stringify(Object.assign({name:r},n)))return!1}return!0}},{key:"getInfo",value:function(r){var n=this;if(r=r||Object.keys(this.textures),Array.isArray(r))return Promise.all(r.map(function(s){return n.getInfo(s)}));var o=this.textures[r];return o?(o.loading||Promise.resolve(o)).then(function(){return{name:o.name,width:o.width,height:o.height,density:o.density,sprites:o.sprites,texcoords:o.texcoords,sizes:o.sizes,css_sizes:o.css_sizes,aspects:o.aspects,filtering:o.filtering,power_of_2:o.power_of_2,valid:o.valid}}):Promise.resolve(null)}},{key:"syncTexturesToWorker",value:function(r){var n=this;return Thread.is_main?Promise.all(r.map(function(o){var s=n.textures[o];return s&&s.loading||Promise.resolve()})).then(function(){return n.textures}):WorkerBroker.postMessage("Texture"+this.scene_id+".getInfo",r).then(function(o){return o.forEach(function(s){n.textures[s.name]=s}),n.textures})}},{key:"getMaxTextureSize",value:function(r){return r.getParameter(r.MAX_TEXTURE_SIZE)}}],[{key:"register",value:function(r,n){var o=e.matchers_;if(!(r instanceof Function&&n instanceof Function))throw"Invalid texture constructor or matcher";this.deRegister(r),o.push([r,n])}},{key:"deRegister",value:function(r){for(var n=e.matchers_,o=0;o<n.length;o++)n[o][0]===r&&n.splice(o,1)}}]),e}();TextureManager.DEFAULT_TEXTURE_NAME="__default",TextureManager.matchers_=[];var Registry={};function getTextureManager(e){return Registry[e]||(Registry[e]=new TextureManager(e)),Registry[e]}var transformMat4_1=transformMat4;function transformMat4(e,r,n){var o=r[0],s=r[1],l=r[2],h=(h=n[3]*o+n[7]*s+n[11]*l+n[15])||1;return e[0]=(n[0]*o+n[4]*s+n[8]*l+n[12])/h,e[1]=(n[1]*o+n[5]*s+n[9]*l+n[13])/h,e[2]=(n[2]*o+n[6]*s+n[10]*l+n[14])/h,e}var normalFromMat4_1=normalFromMat4;function normalFromMat4(e,r){var n=r[0],o=r[1],s=r[2],l=r[3],h=r[4],d=r[5],y=r[6],g=r[7],v=r[8],m=r[9],w=r[10],I=r[11],V=r[12],q=r[13],De=r[14],_n=r[15],ha=n*d-o*h,ga=n*y-s*h,_o=n*g-l*h,_l=o*y-s*d,wc=o*g-l*d,_h=s*g-l*y,_p=v*q-m*V,pd=v*De-w*V,oy=v*_n-I*V,ny=m*De-w*q,fy=m*_n-I*q,wy=w*_n-I*De,cy=ha*wy-ga*fy+_o*ny+_l*oy-wc*pd+_h*_p;return cy?(cy=1/cy,e[0]=(d*wy-y*fy+g*ny)*cy,e[1]=(y*oy-h*wy-g*pd)*cy,e[2]=(h*fy-d*oy+g*_p)*cy,e[3]=(s*fy-o*wy-l*ny)*cy,e[4]=(n*wy-s*oy+l*pd)*cy,e[5]=(o*oy-n*fy-l*_p)*cy,e[6]=(q*_h-De*wc+_n*_l)*cy,e[7]=(De*_o-V*_h-_n*ga)*cy,e[8]=(V*wc-q*_o+_n*ha)*cy,e):null}var invert_1=invert;function invert(e,r){var n=r[0],o=r[1],s=r[2],l=r[3],h=r[4],d=r[5],y=r[6],g=r[7],v=r[8],m=v*h-d*g,w=-v*l+d*y,I=g*l-h*y,V=n*m+o*w+s*I;return V?(V=1/V,e[0]=m*V,e[1]=(-v*o+s*g)*V,e[2]=(d*o-s*h)*V,e[3]=w*V,e[4]=(v*n-s*y)*V,e[5]=(-d*n+s*l)*V,e[6]=I*V,e[7]=(-g*n+o*y)*V,e[8]=(h*n-o*l)*V,e):null}var identity_1=identity;function identity(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}var multiply_1=multiply;function multiply(e,r,n){var o=r[0],s=r[1],l=r[2],h=r[3],d=r[4],y=r[5],g=r[6],v=r[7],m=r[8],w=r[9],I=r[10],V=r[11],q=r[12],De=r[13],_n=r[14],ha=r[15],ga=n[0],_o=n[1],_l=n[2],wc=n[3];return e[0]=ga*o+_o*d+_l*m+wc*q,e[1]=ga*s+_o*y+_l*w+wc*De,e[2]=ga*l+_o*g+_l*I+wc*_n,e[3]=ga*h+_o*v+_l*V+wc*ha,ga=n[4],_o=n[5],_l=n[6],wc=n[7],e[4]=ga*o+_o*d+_l*m+wc*q,e[5]=ga*s+_o*y+_l*w+wc*De,e[6]=ga*l+_o*g+_l*I+wc*_n,e[7]=ga*h+_o*v+_l*V+wc*ha,ga=n[8],_o=n[9],_l=n[10],wc=n[11],e[8]=ga*o+_o*d+_l*m+wc*q,e[9]=ga*s+_o*y+_l*w+wc*De,e[10]=ga*l+_o*g+_l*I+wc*_n,e[11]=ga*h+_o*v+_l*V+wc*ha,ga=n[12],_o=n[13],_l=n[14],wc=n[15],e[12]=ga*o+_o*d+_l*m+wc*q,e[13]=ga*s+_o*y+_l*w+wc*De,e[14]=ga*l+_o*g+_l*I+wc*_n,e[15]=ga*h+_o*v+_l*V+wc*ha,e}var translate_1=translate;function translate(e,r,n){var o,s,l,h,d,y,g,v,m,w,I,V,q=n[0],De=n[1],_n=n[2];return r===e?(e[12]=r[0]*q+r[4]*De+r[8]*_n+r[12],e[13]=r[1]*q+r[5]*De+r[9]*_n+r[13],e[14]=r[2]*q+r[6]*De+r[10]*_n+r[14],e[15]=r[3]*q+r[7]*De+r[11]*_n+r[15]):(o=r[0],s=r[1],l=r[2],h=r[3],d=r[4],y=r[5],g=r[6],v=r[7],m=r[8],w=r[9],I=r[10],V=r[11],e[0]=o,e[1]=s,e[2]=l,e[3]=h,e[4]=d,e[5]=y,e[6]=g,e[7]=v,e[8]=m,e[9]=w,e[10]=I,e[11]=V,e[12]=o*q+d*De+m*_n+r[12],e[13]=s*q+y*De+w*_n+r[13],e[14]=l*q+g*De+I*_n+r[14],e[15]=h*q+v*De+V*_n+r[15]),e}var scale_1=scale;function scale(e,r,n){var o=n[0],s=n[1],l=n[2];return e[0]=r[0]*o,e[1]=r[1]*o,e[2]=r[2]*o,e[3]=r[3]*o,e[4]=r[4]*s,e[5]=r[5]*s,e[6]=r[6]*s,e[7]=r[7]*s,e[8]=r[8]*l,e[9]=r[9]*l,e[10]=r[10]*l,e[11]=r[11]*l,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}var perspective_1=perspective;function perspective(e,r,n,o,s){var l=1/Math.tan(r/2),h=1/(o-s);return e[0]=l/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(s+o)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*s*o*h,e[15]=0,e}var identity_1$1=identity$1;function identity$1(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var lookAt_1=lookAt;function lookAt(e,r,n,o){var s,l,h,d,y,g,v,m,w,I,V=r[0],q=r[1],De=r[2],_n=o[0],ha=o[1],ga=o[2],_o=n[0],_l=n[1],wc=n[2];return Math.abs(V-_o)<1e-6&&Math.abs(q-_l)<1e-6&&Math.abs(De-wc)<1e-6?identity_1$1(e):(v=V-_o,m=q-_l,w=De-wc,s=ha*(w*=I=1/Math.sqrt(v*v+m*m+w*w))-ga*(m*=I),l=ga*(v*=I)-_n*w,h=_n*m-ha*v,(I=Math.sqrt(s*s+l*l+h*h))?(s*=I=1/I,l*=I,h*=I):h=l=s=0,d=m*h-w*l,y=w*s-v*h,g=v*l-m*s,(I=Math.sqrt(d*d+y*y+g*g))?(d*=I=1/I,y*=I,g*=I):g=y=d=0,e[0]=s,e[1]=d,e[2]=v,e[3]=0,e[4]=l,e[5]=y,e[6]=m,e[7]=0,e[8]=h,e[9]=g,e[10]=w,e[11]=0,e[12]=-(s*V+l*q+h*De),e[13]=-(d*V+y*q+g*De),e[14]=-(v*V+m*q+w*De),e[15]=1,e)}var copy_1=copy;function copy(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}var invert_1$1=invert$1;function invert$1(e,r){var n=r[0],o=r[1],s=r[2],l=r[3],h=r[4],d=r[5],y=r[6],g=r[7],v=r[8],m=r[9],w=r[10],I=r[11],V=r[12],q=r[13],De=r[14],_n=r[15],ha=n*d-o*h,ga=n*y-s*h,_o=n*g-l*h,_l=o*y-s*d,wc=o*g-l*d,_h=s*g-l*y,_p=v*q-m*V,pd=v*De-w*V,oy=v*_n-I*V,ny=m*De-w*q,fy=m*_n-I*q,wy=w*_n-I*De,cy=ha*wy-ga*fy+_o*ny+_l*oy-wc*pd+_h*_p;return cy?(cy=1/cy,e[0]=(d*wy-y*fy+g*ny)*cy,e[1]=(s*fy-o*wy-l*ny)*cy,e[2]=(q*_h-De*wc+_n*_l)*cy,e[3]=(w*wc-m*_h-I*_l)*cy,e[4]=(y*oy-h*wy-g*pd)*cy,e[5]=(n*wy-s*oy+l*pd)*cy,e[6]=(De*_o-V*_h-_n*ga)*cy,e[7]=(v*_h-w*_o+I*ga)*cy,e[8]=(h*fy-d*oy+g*_p)*cy,e[9]=(o*oy-n*fy-l*_p)*cy,e[10]=(V*wc-q*_o+_n*ha)*cy,e[11]=(m*_o-v*wc-I*ha)*cy,e[12]=(d*pd-h*ny-y*_p)*cy,e[13]=(n*ny-o*pd+s*_p)*cy,e[14]=(q*ga-V*_l-De*ha)*cy,e[15]=(v*_l-m*ga+w*ha)*cy,e):null}var transformMat4_1$1=transformMat4$1;function transformMat4$1(e,r,n){var o=r[0],s=r[1],l=r[2],h=r[3];return e[0]=n[0]*o+n[4]*s+n[8]*l+n[12]*h,e[1]=n[1]*o+n[5]*s+n[9]*l+n[13]*h,e[2]=n[2]*o+n[6]*s+n[10]*l+n[14]*h,e[3]=n[3]*o+n[7]*s+n[11]*l+n[15]*h,e}var normalize_1=normalize$1;function normalize$1(e,r){var n=r[0],o=r[1],s=r[2],l=r[3],h=n*n+o*o+s*s+l*l;return 0<h&&(h=1/Math.sqrt(h),e[0]=n*h,e[1]=o*h,e[2]=s*h,e[3]=l*h),e}var scale_1$1=scale$1;function scale$1(e,r,n){return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=r[3]*n,e}var vec3={fromValues:function(e,r,n){var o=new Float64Array(3);return o[0]=e,o[1]=r,o[2]=n,o},transformMat4:transformMat4_1},mat3={normalFromMat4:normalFromMat4_1,invert:invert_1,identity:identity_1},mat4={multiply:multiply_1,translate:translate_1,scale:scale_1,perspective:perspective_1,lookAt:lookAt_1,identity:identity_1$1,copy:copy_1,invert:invert_1$1},vec4={transformMat4:transformMat4_1$1,normalize:normalize_1,scale:scale_1$1},FeatureSelection=function(){function e(r,n){_classCallCheck(this,e),this._gl=r,this._requests={},this._pixels=null,this._has_dirty_buffer=!1,this._fbo=this._gl.createFramebuffer(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fbo),this._fbo_size={width:256,height:256};var o=getTextureManager(n).create(this._gl,"selection_fbo",{filtering:"nearest"});o.setData(this._fbo_size.width,this._fbo_size.height,null,{filtering:"nearest"}),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,o.texture,0);var s=this._gl.createRenderbuffer();this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,s),this._gl.renderbufferStorage(this._gl.RENDERBUFFER,this._gl.DEPTH_COMPONENT16,this._fbo_size.width,this._fbo_size.height),this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.RENDERBUFFER,s),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)}return _createClass(e,[{key:"destroy",value:function(){this._gl&&this._fbo&&(this._gl.deleteFramebuffer(this._fbo),this._fbo=null,this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null))}},{key:"bind",value:function(){var r;this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fbo),this._gl.viewport(0,0,this._fbo_size.width,this._fbo_size.height),(r=this._gl).clearColor.apply(r,_toConsumableArray(e.defaultColor))}},{key:"getFeatureAt",value:function(r,n,o){var s=n.radius,l=n.top_most_only,h=l===void 0||l;!r||r.x<0||r.y<0||1<r.x||1<r.y?o({features:null}):(this.selection_request_id=this.selection_request_id+1||0,this._requests[this.selection_request_id]={id:this.selection_request_id,point:r,radius:s,top_most_only:h,ttl:h?1:e.MAX_PICKING_TRIES,callback:o})}},{key:"hasPendingRequests",value:function(){return 0<Object.keys(this._requests).length}},{key:"clearPendingRequests",value:function(){for(var r in this._requests)this._requests[r].callback(new Error("cleared")),delete this._requests[r];this._pending_deep_request=null}},{key:"read",value:function(r){if(this.hasPendingRequests()){var n=this._gl;for(var o in n.bindFramebuffer(n.FRAMEBUFFER,this._fbo),this._pending_deep_request&&this.processRequest(this._pending_deep_request,r),this._requests)if(this.processRequest(this._requests[o],r))break;n.bindFramebuffer(n.FRAMEBUFFER,null)}}},{key:"processRequest",value:function(r,n){var o,s,l,h=this._gl,d=255,y=r.point,g=r.radius,v=(l=g?(s=Math.min(this._fbo_size.width,this._fbo_size.height),{x:Math.min(Math.ceil(2*g.x*this._fbo_size.width),s),y:Math.min(Math.ceil(2*g.y*this._fbo_size.height),s)}):(g={x:0,y:0},{x:1,y:1})).x*l.y*4;if(this._pixels==null||this._pixels.byteLength<v)this._pixels=new Uint8Array(v);else if(this._pixels.fill instanceof Function)this._pixels.fill(0,0,v);else for(var m=0;m<v;m++)this._pixels[m]=0;h.readPixels(Math.round((y.x-g.x)*this._fbo_size.width),Math.round((1-y.y-g.y)*this._fbo_size.height),l.x,l.y,h.RGBA,h.UNSIGNED_BYTE,this._pixels),r.ttl--;var w=Math.floor(l.x/2),I=Math.floor(l.y/2),V=4*(I*l.x+w),q=this._pixels.slice(V,V+4),De=q[0]+(q[1]<<8)+(q[2]<<16);if(0<De)o=De+(q[3]<<24)>>>0,d=q[3];else if(4<v)for(var _n=1/0,V=0,ha=0;ha<l.y;ha++)for(var ga,_o=0;_o<l.x;_o++,V+=4)0<(De=(q=this._pixels.slice(V,V+4))[0]+(q[1]<<8)+(q[2]<<16))&&(ga=Math.pow(_o-w,2)+Math.pow(ha-I,2))<_n&&(o=De+(q[3]<<24)>>>0,d=q[3],_n=ga);if(d!==255){var _l=this._getFeatureByKey(o,n);if(r.features||(r.features=[]),!_l)return void this._finishRead(r);if(r.features.every(function(wc){return wc.id!==_l.id})&&r.features.push(_l),r.ttl)return this._pending_deep_request=r,e._discardColor(q),this._has_dirty_buffer=!0;this._finishRead(r)}else this._finishRead(r)}},{key:"_finishRead",value:function(r){var n=r.features||e.EMPTY_ARRAY;r.top_most_only||(this._pending_deep_request=null,e._resetDiscardedColors()),delete this._requests[r.id],r.callback({features:n})}},{key:"_getFeatureByKey",value:function(r,n){for(var o=null,s=0;s<n.length;s++){var l=n[s];if(l.selection_data&&(o=l.selection_data[r])){o.tile={coords:l.coords};break}}return o}},{key:"setupDiscards",value:function(r){for(var n=e.MAX_PICKING_TRIES;n--;)r.uniform("4fv","u_selection_discard".concat(n),e._discarded_colors[n]||e.defaultColor)}},{key:"has_dirty_buffer",get:function(){return this._has_dirty_buffer},set:function(){this._has_dirty_buffer=!!this._pending_deep_request}}],[{key:"makeEntry",value:function(){this.map_entry++;var r=255&this.map_entry,n=this.map_entry>>8&255,o=this.map_entry>>16&255,s=this.map_prefix;return{key:r+(n<<8)+(o<<16)+(s<<24)>>>0,color:[r/255,n/255,o/255,s/255]}}},{key:"reset",value:function(){this.map_entry=0}},{key:"setPrefix",value:function(r){this.map_prefix=r}},{key:"_discardColor",value:function(r){this._discarded_colors.push([r[0]/255,r[1]/255,r[2]/255,r[3]/255])}},{key:"_resetDiscardedColors",value:function(){this._discarded_colors.length=0}}]),e}();FeatureSelection._discarded_colors=[],FeatureSelection.map_entry=0,FeatureSelection.map_prefix=0,FeatureSelection.defaultColor=[0,0,0,1],FeatureSelection.MAX_PICKING_TRIES=10,FeatureSelection.EMPTY_ARRAY=Object.freeze([]);var GLSL={parseUniforms:function(e){var r=[];for(var n in e){var o,s=n,l=e[n];if(typeof l=="number")r.push({type:"float",method:"1f",name:n,value:l,key:s,uniforms:e});else if(Array.isArray(l)){if(typeof l[0]=="number")2<=l.length&&l.length<=4?r.push({type:"vec"+l.length,method:l.length+"fv",name:n,value:l,key:s,uniforms:e}):4<l.length&&r.push({type:"float[]",method:"1fv",name:n+"[0]",value:l,key:s,uniforms:e});else if(typeof l[0]=="string")for(o=0;o<l.length;o++)r.push({type:"sampler2D",method:"1i",name:n+"["+o+"]",value:l[o],key:o,uniforms:l});else if(Array.isArray(l[0])&&typeof l[0][0]=="number"&&2<=l[0].length&&l[0].length<=4)for(o=0;o<l.length;o++)r.push({type:"vec"+l[0].length,method:l[o].length+"fv",name:n+"["+o+"]",value:l[o],key:o,uniforms:l})}else typeof l=="boolean"?r.push({type:"bool",method:"1i",name:n,value:l,key:s,uniforms:e}):typeof l=="string"&&r.push({type:"sampler2D",method:"1i",name:n,value:l,key:s,uniforms:e})}return r},defineVariable:function(e,r){var n,o;if(typeof r=="number")n="float";else if(Array.isArray(r))typeof r[0]=="number"?2<=r.length&&r.length<=4?n="vec"+r.length:(n="float",o=r.length):typeof r[0]=="string"&&(n="sampler2D",o=r.length);else if(typeof r=="boolean")n="bool";else{if(typeof r!="string")return;n="sampler2D"}var s="";return s+="".concat(n," ").concat(e),o&&(s+="[".concat(o,"]")),s+=`;
`},defineUniform:function(e,r){var n=GLSL.defineVariable(e,r);if(n)return"uniform "+n},isUniformDefined:function(e,r){var n=new RegExp("uniform[^;]+(?:{[\\s\\S]*})?[^;]*\\b"+e+"\\b","g");return!!r.match(n)},isSymbolReferenced:function(e,r){var n=new RegExp("\\b"+e+"\\b","g");return 0<=r.search(n)},expandVec3:function(e){var r,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;if(Array.isArray(e)){if(e.length!==2)return e;r=[].concat(_toConsumableArray(e),[n]).map(parseFloat)}else r=[e,e,e].map(parseFloat);if(r&&r.every(function(o){return typeof o=="number"&&!isNaN(o)}))return r},expandVec4:function(e){var r,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;if(Array.isArray(e)){if(e.length!==3)return e;r=[].concat(_toConsumableArray(e),[n]).map(parseFloat)}else r=[e,e,e,n].map(parseFloat);if(r&&r.every(function(o){return typeof o=="number"&&!isNaN(o)}))return r}},extensions=[];function getExtension(e,r){var n=extensions.filter(function(o){return o[0]===e})[0];return(n=n&&n[1])||(extensions.push([e,{}]),n=extensions[extensions.length-1][1]),n[r]||(n[r]=e.getExtension(r)),n[r]}function hashString(e){var r,n,o=0;if(e.length===0)return o;for(r=0,n=e.length;r<n;r++)o=(o<<5)-o+e.charCodeAt(r),o|=0;return o}var stripComments=createCommonjsModule(function(e){var r="(.|[\\r\\n]|\\n)*?\\*\\/\\n?\\n?",n=/(^|[^\S\n])(?:\/\/)([\s\S]+?)$/gm,o=/(^|[^\S\n])(?:\/\/[^!])([\s\S]+?)$/gm,s=e.exports=function(l,h){return l?s.block(s.line(l,h),h):""};s.block=function(l,h){h=h||{};var d=new RegExp("\\/\\*"+r,"gm");return h.safe&&(d=new RegExp("\\/\\*(?!\\*?\\!)"+r,"gm")),l?l.replace(d,""):""},s.line=function(l,h){var d=n;return(h=h||{}).safe&&(d=o),l?l.replace(d,""):""}}),glShaderErrors=parseErrors;function parseErrors(e){e=String(e);for(var r,n=[];r=e.match(/ERROR\:([^\n]+)/);){e=e.slice(r.index+1);var o=(h=r[1].trim()).split(":"),s=o.slice(2).join(":").trim(),l=parseInt(o[0],10),h=parseInt(o[1],10);n.push({message:s,file:l,line:h})}return n}var re_pragma=/^\s*#pragma.*$/gm,re_continue_line=/\\\s*\n/gm,ShaderProgram=function(){function e(r,n,o,s,l){if(_classCallCheck(this,e),l=l||{},this.textureManager=getTextureManager(s),this.gl=r,this.program=null,this.compiled=!1,this.compiling=!1,this.error=null,!e.polyfills[s]){e.polyfills[s]={};try{this.gl.uniformMatrix3fv(null,!1,new Float64Array(9))}catch{e.polyfills[s].uniformMatrix3fv=this.gl.uniformMatrix3fv,this.gl.uniformMatrix3fv=function(d,y,g){e.polyfills[s].uniformMatrix3fv.call(this,d,y,new Float32Array(g))}}try{this.gl.uniformMatrix4fv(null,!1,new Float64Array(16))}catch{e.polyfills[s].uniformMatrix4fv=this.gl.uniformMatrix4fv,this.gl.uniformMatrix4fv=function(d,y,g){e.polyfills[s].uniformMatrix4fv.call(this,d,y,new Float32Array(g))}}}this.defines=Object.assign({},l.defines||{}),this.blocks=Object.assign({},l.blocks||{}),this.block_scopes=Object.assign({},l.block_scopes||{}),this.extensions=l.extensions||[],this.dependent_uniforms=l.uniforms,this.uniforms={},this.attribs={},this.vertex_source=n,this.fragment_source=o,this.id=e.id++,this.name=l.name}return _createClass(e,[{key:"destroy",value:function(){this.gl.useProgram(null),this.gl.deleteProgram(this.program),this.program=null,this.uniforms={},this.attribs={},this.compiled=!1}},{key:"use",value:function(){this.compiled&&(e.current!==this&&this.gl.useProgram(this.program),e.current=this)}},{key:"compile",value:function(){var r=this;if(this.compiling)throw new Error("ShaderProgram.compile(): skipping for ".concat(this.id," (").concat(this.name,") because already compiling"));this.compiling=!0,this.compiled=!1,this.error=null,this.computed_vertex_source=this.vertex_source,this.computed_fragment_source=this.fragment_source;var n,o=this.checkExtensions(),s=this.buildDefineList(),l=this.buildShaderBlockList();for(var h in l){var d,y,g,v=l[h];!v||Array.isArray(v)&&v.length===0||(n=new RegExp("^\\s*#pragma\\s+tangram:\\s+"+h+"\\s*$","m"),d=this.computed_vertex_source.match(n),y=this.computed_fragment_source.match(n),d==null&&y==null||(g="",v.forEach(function(I){var V="".concat(I.scope,", ").concat(I.key,", ").concat(I.num);g+=`
// tangram-block-start: `.concat(V,`
`),g+=I.source,g+=`
// tangram-block-end: `.concat(V,`
`)}),d!=null&&(this.computed_vertex_source=this.computed_vertex_source.replace(n,g)),y!=null&&(this.computed_fragment_source=this.computed_fragment_source.replace(n,g)),s["TANGRAM_BLOCK_"+h.replace(/[\s-]+/g,"_").toUpperCase()]=!0))}this.computed_vertex_source=this.computed_vertex_source.replace(re_pragma,""),this.computed_fragment_source=this.computed_fragment_source.replace(re_pragma,""),this.ensureUniforms(this.dependent_uniforms);var w="",m=this.gl.getShaderPrecisionFormat(this.gl.FRAGMENT_SHADER,this.gl.HIGH_FLOAT),w=m&&0<m.precision?`precision highp float;
`:`precision mediump float;
`;s.TANGRAM_VERTEX_SHADER=!0,s.TANGRAM_FRAGMENT_SHADER=!1,this.computed_vertex_source=w+e.buildDefineString(s)+this.computed_vertex_source,s.TANGRAM_VERTEX_SHADER=!1,s.TANGRAM_FRAGMENT_SHADER=!0,this.computed_fragment_source=e.buildExtensionString(o)+w+e.buildDefineString(s)+this.computed_fragment_source,this.computed_vertex_source=this.computed_vertex_source.replace(re_continue_line,""),this.computed_fragment_source=this.computed_fragment_source.replace(re_continue_line,"");try{this.program=e.updateProgram(this.gl,this.program,this.computed_vertex_source,this.computed_fragment_source),this.compiled=!0,this.compiling=!1}catch(I){throw this.program=null,this.compiled=!1,this.compiling=!1,(this.error=I).type!=="vertex"&&I.type!=="fragment"||(this.shader_errors=I.errors,this.shader_errors.forEach(function(V){V.type=I.type,V.block=r.block(I.type,V.line)})),I}this.computed_vertex_source=null,this.computed_fragment_source=null,this.use(),this.refreshUniforms(),this.refreshAttributes()}},{key:"buildDefineList",value:function(){var r,n={};for(r in e.defines)n[r]=e.defines[r];for(r in this.defines)n[r]=this.defines[r];return n}},{key:"buildShaderBlockList",value:function(){var r,n,o={};for(r in e.blocks)o[r]=[],Array.isArray(e.blocks[r])?(n=o[r]).push.apply(n,_toConsumableArray(e.blocks[r].map(function(y,g){return{key:r,source:y,num:g,scope:"ShaderProgram"}}))):o[r]=[{key:r,source:e.blocks[r],num:0,scope:"ShaderProgram"}];for(r in this.blocks)if(o[r]=o[r]||[],Array.isArray(this.blocks[r]))for(var s=this.block_scopes&&this.block_scopes[r]||[],l=null,h=0,d=0;d<this.blocks[r].length;d++)s[d]!==l&&(l=s[d],h=0),o[r].push({key:r,source:this.blocks[r][d],num:h,scope:l||this.name}),h++;else o[r].push({key:r,source:this.blocks[r],num:0,scope:this.name});return o}},{key:"ensureUniforms",value:function(r){if(r){var n,o=stripComments(this.computed_vertex_source),s=stripComments(this.computed_fragment_source),l=[],h=[];for(var d in r){var y=GLSL.isUniformDefined(d,o),g=GLSL.isUniformDefined(d,s);if(!y||!g){if(!(n=GLSL.defineUniform(d,r[d])))continue;y||(log("trace","Program ".concat(this.name,": ").concat(d," not defined in vertex shader, injecting: '").concat(n,"'")),l.push(n)),g||(log("trace","Program ".concat(this.name,": ").concat(d," not defined in fragment shader, injecting: '").concat(n,"'")),h.push(n))}}0<l.length&&(this.computed_vertex_source=l.join(`
`)+this.computed_vertex_source),0<h.length&&(this.computed_fragment_source=h.join(`
`)+this.computed_fragment_source)}}},{key:"setUniforms",value:function(r,n){var o=!(1<arguments.length&&n!==void 0)||n;if(this.compiled){o&&(this.texture_unit=0);for(var s=GLSL.parseUniforms(r),l=0;l<s.length;l++){var h=s[l];h.type==="sampler2D"?this.setTextureUniform(h.name,h.value):this.uniform(h.method,h.name,h.value)}}}},{key:"saveUniforms",value:function(r){var n=r||this.uniforms;for(var o in n){var s=this.uniforms[o];s&&(s.saved_value=s.value)}this.saved_texture_unit=this.texture_unit||0}},{key:"restoreUniforms",value:function(r){var n=r||this.uniforms;for(var o in n){var s=this.uniforms[o];s&&s.saved_value&&(s.value=s.saved_value,this.updateUniform(s))}this.texture_unit=this.saved_texture_unit||0}},{key:"setTextureUniform",value:function(r,n){var o=this.textureManager.textures[n];o!=null?(o.bind(this.texture_unit),this.uniform("1i",r,this.texture_unit),this.texture_unit++):log("warn","Cannot find texture '".concat(n,"'"))}},{key:"uniform",value:function(r,n,o){var s;this.compiled&&(this.uniforms[n]=this.uniforms[n]||{},s=this.uniforms[n],s.name=n,s.location===void 0&&(s.location=this.gl.getUniformLocation(this.program,n)),s.method=r,s.value=o,this.updateUniform(s))}},{key:"updateUniform",value:function(r){this.compiled&&r&&r.location!=null&&(this.use(),this.commitUniform(r))}},{key:"commitUniform",value:function(r){var n=r.location,o=r.value;switch(r.method){case"1i":this.gl.uniform1i(n,o);break;case"1f":this.gl.uniform1f(n,o);break;case"2f":this.gl.uniform2f(n,o[0],o[1]);break;case"3f":this.gl.uniform3f(n,o[0],o[1],o[2]);break;case"4f":this.gl.uniform4f(n,o[0],o[1],o[2],o[3]);break;case"1iv":this.gl.uniform1iv(n,o);break;case"3iv":this.gl.uniform3iv(n,o);break;case"1fv":this.gl.uniform1fv(n,o);break;case"2fv":this.gl.uniform2fv(n,o);break;case"3fv":this.gl.uniform3fv(n,o);break;case"4fv":this.gl.uniform4fv(n,o);break;case"Matrix3fv":this.gl.uniformMatrix3fv(n,!1,o);break;case"Matrix4fv":this.gl.uniformMatrix4fv(n,!1,o)}}},{key:"refreshUniforms",value:function(){if(this.compiled)for(var r in this.uniforms){var n=this.uniforms[r];n.location=this.gl.getUniformLocation(this.program,r),this.updateUniform(n)}}},{key:"refreshAttributes",value:function(){this.attribs={}}},{key:"attribute",value:function(r){if(this.compiled){var n=this.attribs[r]=this.attribs[r]||{};return n.location!=null||(n.name=r,n.location=this.gl.getAttribLocation(this.program,r)),n}}},{key:"source",value:function(r){return r==="vertex"?this.computed_vertex_source:r==="fragment"?this.computed_fragment_source:void 0}},{key:"lines",value:function(r){var n=this.source(r);return n?n.split(`
`):[]}},{key:"line",value:function(r,n){var o=this.lines(r);if(o)return o[n]}},{key:"block",value:function(r,n){for(var o,s=this.lines(r),l=0;l<n&&l<s.length;l++){var h=s[l],d=h.match(/\/\/ tangram-block-start: ([A-Za-z0-9_-]+), ([A-Za-z0-9_-]+), (\d+)/);d&&1<d.length?o={scope:d[1],name:d[2],num:d[3]}:(d=h.match(/\/\/ tangram-block-end: ([A-Za-z0-9_-]+), ([A-Za-z0-9_-]+), (\d+)/))&&1<d.length&&(o=null),o&&(o.line=o.line==null?-1:o.line+1,o.source=h)}return o}},{key:"checkExtensions",value:function(){var r=this,n=[];return this.extensions.forEach(function(o){var s=getExtension(r.gl,o),l="TANGRAM_EXTENSION_".concat(o);r.defines[l]=s!=null,s?n.push(o):log("debug","Could not enable extension '".concat(o,"'"))}),n}}]),e}();ShaderProgram.polyfills={},ShaderProgram.id=0,ShaderProgram.current=null,ShaderProgram.defines={},ShaderProgram.blocks={},ShaderProgram.reset=function(){ShaderProgram.programs_by_source={},ShaderProgram.shaders_by_source={}},ShaderProgram.reset(),ShaderProgram.buildDefineString=function(e){var r="";for(var n in e)e[n]!=null&&e[n]!==!1&&(typeof e[n]=="boolean"&&e[n]===!0?r+="#define "+n+`
`:typeof e[n]=="number"&&Math.floor(e[n])===e[n]?r+="#define "+n+" "+e[n].toFixed(1)+`
`:r+="#define "+n+" "+e[n]+`
`);return r},ShaderProgram.buildExtensionString=function(e){var r="";return(e=e||[]).forEach(function(n){r+="#ifdef GL_".concat(n,`
#extension GL_`).concat(n,` : enable
#endif
`)}),r},ShaderProgram.addBlock=function(e){var r;ShaderProgram.blocks[e]=ShaderProgram.blocks[e]||[];for(var n=arguments.length,o=new Array(1<n?n-1:0),s=1;s<n;s++)o[s-1]=arguments[s];(r=ShaderProgram.blocks[e]).push.apply(r,o)},ShaderProgram.removeBlock=function(e){ShaderProgram.blocks[e]=[]},ShaderProgram.replaceBlock=function(e){ShaderProgram.removeBlock(e);for(var r=arguments.length,n=new Array(1<r?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];ShaderProgram.addBlock.apply(ShaderProgram,[e].concat(n))},ShaderProgram.updateProgram=function(e,r,n,o){var s=hashString(e._tangram_id+"::"+n+"::"+o);if(ShaderProgram.programs_by_source[s])return log("trace","Reusing identical source GL program object"),ShaderProgram.programs_by_source[s];var l=ShaderProgram.createShader(e,n,e.VERTEX_SHADER),h=ShaderProgram.createShader(e,o,e.FRAGMENT_SHADER);if(e.useProgram(null),r!=null)for(var d=e.getAttachedShaders(r),y=0;y<d.length;y++)e.detachShader(r,d[y]);else r=e.createProgram();if(l==null||h==null)return r;if(e.attachShader(r,l),e.attachShader(r,h),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS))return ShaderProgram.programs_by_source[s]=r;var g=new Error(`WebGL program error:
            VALIDATE_STATUS: `.concat(e.getProgramParameter(r,e.VALIDATE_STATUS),`
            ERROR: `).concat(e.getError(),`
            --- Vertex Shader ---
            `).concat(n,`
            --- Fragment Shader ---
            `).concat(o));throw Object.assign(new Error(g),{type:"program"})},ShaderProgram.createShader=function(e,r,n){var o=hashString(e._tangram_id+"::"+r);if(ShaderProgram.shaders_by_source[o])return log("trace","Reusing identical source GL shader object"),ShaderProgram.shaders_by_source[o];var s=e.createShader(n);if(e.shaderSource(s,r),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS))return ShaderProgram.shaders_by_source[o]=s;var l=n===e.VERTEX_SHADER?"vertex":"fragment",h=e.getShaderInfoLog(s),d=glShaderErrors(h);throw Object.assign(new Error(h),{type:l,errors:d})};var VertexArrayObject={disabled:!1,bound_vao:[],init:function(e){var r;this.disabled!==!0&&(r=getExtension(e,"OES_vertex_array_object")),r!=null?log("info","Vertex Array Object extension available"):this.disabled!==!0?log("warn","Vertex Array Object extension NOT available"):log("warn","Vertex Array Object extension force disabled")},create:function(e,r,n){var o={};o.setup=r,o.teardown=n;var s=getExtension(e,"OES_vertex_array_object");return s!=null&&(o._vao=s.createVertexArrayOES(),s.bindVertexArrayOES(o._vao)),o.setup(!0),o},getCurrentBinding:function(e){var r=this.bound_vao.filter(function(n){return n[0]===e})[0];return r&&r[1]},setCurrentBinding:function(e,r){var n=this.bound_vao,o=n.filter(function(s){return s[0]===e})[0];o==null?n.push([e,r]):o[1]=r},bind:function(e,r){var n,o=getExtension(e,"OES_vertex_array_object");r!=null?o!=null&&r._vao!=null?(o.bindVertexArrayOES(r._vao),this.setCurrentBinding(e,r)):r.setup(!1):(n=this.getCurrentBinding(e),o!=null?o.bindVertexArrayOES(null):n!=null&&typeof n.teardown=="function"&&n.teardown(),this.setCurrentBinding(e,null))},destroy:function(e,r){var n=getExtension(e,"OES_vertex_array_object");n!=null&&r!=null&&r._vao!=null&&(n.deleteVertexArrayOES(r._vao),r._vao=null)}},VBOMesh=function(){function e(r,n,o,s,l,h){_classCallCheck(this,e),h=h||{},this.textureManager=getTextureManager(l),this.gl=r,this.vertex_data=n,this.element_data=o,this.vertex_layout=s,this.vertex_buffer=this.gl.createBuffer(),this.buffer_size=this.vertex_data.byteLength,this.draw_mode=h.draw_mode||this.gl.TRIANGLES,this.data_usage=h.data_usage||this.gl.STATIC_DRAW,this.vertices_per_geometry=3,this.uniforms=h.uniforms,this.textures=h.textures,this.retain=h.retain||!1,this.created_at=+new Date,this.fade_in_time=h.fade_in_time||0,this.vertex_count=this.vertex_data.byteLength/this.vertex_layout.stride,this.element_count=0,this.vaos={},this.toggle_element_array=!1,this.element_data?(this.toggle_element_array=!0,this.element_count=this.element_data.length,this.geometry_count=this.element_count/this.vertices_per_geometry,this.element_type=this.element_data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT,this.element_buffer=this.gl.createBuffer(),this.buffer_size+=this.element_data.byteLength,this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.element_buffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.element_data,this.data_usage)):this.geometry_count=this.vertex_count/this.vertices_per_geometry,this.upload(),this.retain||(delete this.vertex_data,delete this.element_data),this.valid=!0}return _createClass(e,[{key:"render",value:function(r){var n=0<arguments.length&&r!==void 0?r:{};if(!this.valid)return!1;var o=n.program||ShaderProgram.current;o.use(),this.uniforms&&(o.saveUniforms(this.uniforms),o.setUniforms(this.uniforms,!1));var s=(new Date-this.created_at)/1e3;return o.uniform("1f","u_visible_time",s),this.bind(o),this.toggle_element_array?this.gl.drawElements(this.draw_mode,this.element_count,this.element_type,0):this.gl.drawArrays(this.draw_mode,0,this.vertex_count),VertexArrayObject.bind(this.gl,null),this.uniforms&&o.restoreUniforms(this.uniforms),s<this.fade_in_time}},{key:"bind",value:function(r){var n=this,o=this.vaos[r.id];o?VertexArrayObject.bind(this.gl,o):this.vaos[r.id]=VertexArrayObject.create(this.gl,function(s){n.gl.bindBuffer(n.gl.ARRAY_BUFFER,n.vertex_buffer),n.toggle_element_array&&n.gl.bindBuffer(n.gl.ELEMENT_ARRAY_BUFFER,n.element_buffer),n.vertex_layout.enable(n.gl,r,s)})}},{key:"upload",value:function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertex_buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertex_data,this.data_usage)}},{key:"destroy",value:function(){var r=this;if(!this.valid)return!1;for(var n in this.valid=!1,this.vaos)VertexArrayObject.destroy(this.gl,this.vaos[n]);return this.gl.deleteBuffer(this.vertex_buffer),this.vertex_buffer=null,this.element_buffer&&(this.gl.deleteBuffer(this.element_buffer),this.element_buffer=null),delete this.vertex_data,delete this.element_data,this.textures&&this.textures.forEach(function(o){return r.textureManager.release(o)}),!0}}]),e}(),shaderSrc_material=`/*Defines globals:materiallight_accumulator_**/struct Material{
#ifdef TANGRAM_MATERIAL_EMISSION
vec4 emission;
#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE
vec3 emissionScale;
#endif
#endif
#ifdef TANGRAM_MATERIAL_AMBIENT
vec4 ambient;
#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE
vec3 ambientScale;
#endif
#endif
#ifdef TANGRAM_MATERIAL_DIFFUSE
vec4 diffuse;
#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE
vec3 diffuseScale;
#endif
#endif
#ifdef TANGRAM_MATERIAL_SPECULAR
vec4 specular;float shininess;
#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE
vec3 specularScale;
#endif
#endif
#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE
vec3 normalScale;float normalAmount;
#endif
};uniform Material u_material;Material material;
#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE
uniform sampler2D u_material_emission_texture;
#endif
#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE
uniform sampler2D u_material_ambient_texture;
#endif
#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE
uniform sampler2D u_material_diffuse_texture;
#endif
#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE
uniform sampler2D u_material_specular_texture;
#endif
#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE
uniform sampler2D u_material_normal_texture;
#endif
vec4 light_accumulator_ambient=vec4(vec3(0.0),1.);vec4 light_accumulator_diffuse=vec4(vec3(0.0),1.);
#ifdef TANGRAM_MATERIAL_SPECULAR
vec4 light_accumulator_specular=vec4(vec3(0.0),1.);
#endif
#ifdef TANGRAM_MATERIAL_TEXTURE_SPHEREMAP
vec4 getSphereMap(in sampler2D _tex,in vec3 _eyeToPoint,in vec3 _normal,in vec2 _skew){vec3 eye=normalize(_eyeToPoint);eye.xy-=_skew;eye=normalize(eye);vec3 r=reflect(eye,_normal);r.z+=1.0;float m=2.*length(r);vec2 uv=r.xy/m+.5;return texture2D(_tex,uv);}
#endif
#ifdef TANGRAM_MATERIAL_TEXTURE_TRIPLANAR
vec3 getTriPlanarBlend(in vec3 _normal){vec3 blending=abs(_normal);blending=normalize(max(blending,0.00001));float b=(blending.x+blending.y+blending.z);return blending/b;}vec4 getTriPlanar(in sampler2D _tex,in vec3 _pos,in vec3 _normal,in vec3 _scale){vec3 blending=getTriPlanarBlend(_normal);vec4 xaxis=texture2D(_tex,fract(_pos.yz*_scale.x));vec4 yaxis=texture2D(_tex,fract(_pos.xz*_scale.y));vec4 zaxis=texture2D(_tex,fract(_pos.xy*_scale.z));return xaxis*blending.x+yaxis*blending.y+zaxis*blending.z;}
#endif
#ifdef TANGRAM_MATERIAL_TEXTURE_PLANAR
vec4 getPlanar(in sampler2D _tex,in vec3 _pos,in vec2 _scale){return texture2D(_tex,fract(_pos.xy*_scale.x));}
#endif
#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE
void calculateNormal(inout vec3 _normal){
#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_UV
_normal+=texture2D(u_material_normal_texture,fract(v_texcoord*material.normalScale.xy)).rgb*2.0-1.0;
#endif
#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_PLANAR
vec3 normalTex=getPlanar(u_material_normal_texture,v_world_position.xyz,material.normalScale.xy).rgb*2.0-1.0;_normal+=normalTex;
#endif
#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_TRIPLANAR
vec3 normalTex=getTriPlanar(u_material_normal_texture,v_world_position.xyz,_normal,material.normalScale).rgb*2.0-1.0;_normal+=normalTex;
#endif
_normal=normalize(_normal);}
#endif
void calculateMaterial(in vec3 _eyeToPoint,inout vec3 _normal){
#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE
#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_UV
material.emission*=texture2D(u_material_emission_texture,v_texcoord);
#endif
#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_PLANAR
material.emission*=getPlanar(u_material_emission_texture,v_world_position.xyz,material.emissionScale.xy);
#endif
#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_TRIPLANAR
material.emission*=getTriPlanar(u_material_emission_texture,v_world_position.xyz,_normal,material.emissionScale);
#endif
#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_SPHEREMAP
material.emission*=getSphereMap(u_material_emission_texture,_eyeToPoint,_normal,u_center_offset);
#endif
#endif
#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE
#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_UV
material.ambient*=texture2D(u_material_ambient_texture,v_texcoord);
#endif
#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_PLANAR
material.ambient*=getPlanar(u_material_ambient_texture,v_world_position.xyz,material.ambientScale.xy);
#endif
#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_TRIPLANAR
material.ambient*=getTriPlanar(u_material_ambient_texture,v_world_position.xyz,_normal,material.ambientScale);
#endif
#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_SPHEREMAP
material.ambient*=getSphereMap(u_material_ambient_texture,_eyeToPoint,_normal,u_center_offset);
#endif
#endif
#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE
#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_UV
material.diffuse*=texture2D(u_material_diffuse_texture,v_texcoord);
#endif
#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_PLANAR
material.diffuse*=getPlanar(u_material_diffuse_texture,v_world_position.xyz,material.diffuseScale.xy);
#endif
#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_TRIPLANAR
material.diffuse*=getTriPlanar(u_material_diffuse_texture,v_world_position.xyz,_normal,material.diffuseScale);
#endif
#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_SPHEREMAP
material.diffuse*=getSphereMap(u_material_diffuse_texture,_eyeToPoint,_normal,u_center_offset);
#endif
#endif
#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE
#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_UV
material.specular*=texture2D(u_material_specular_texture,v_texcoord);
#endif
#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_PLANAR
material.specular*=getPlanar(u_material_specular_texture,v_world_position.xyz,material.specularScale.xy);
#endif
#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_TRIPLANAR
material.specular*=getTriPlanar(u_material_specular_texture,v_world_position.xyz,_normal,material.specularScale);
#endif
#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_SPHEREMAP
material.specular*=getSphereMap(u_material_specular_texture,_eyeToPoint,_normal,u_center_offset);
#endif
#endif
}`,material_props=["emission","ambient","diffuse","specular"],Material=function(){function e(r){var n=this;_classCallCheck(this,e),r=r||{},material_props.forEach(function(o){var s=r[o];s!=null&&(s.texture?n[o]={texture:s.texture,mapping:s.mapping||"spheremap",scale:GLSL.expandVec3(s.scale!=null?s.scale:1),amount:GLSL.expandVec4(s.amount!=null?s.amount:1)}:typeof s=="number"||Array.isArray(s)?n[o]={amount:GLSL.expandVec4(s)}:n[o]=typeof s=="string"?{amount:StyleParser.parseColor(s)}:s)}),this.specular&&(this.specular.shininess=r.shininess?parseFloat(r.shininess):.2),r.normal!=null&&(this.normal={texture:r.normal.texture,mapping:r.normal.mapping||"triplanar",scale:GLSL.expandVec3(r.normal.scale!=null?r.normal.scale:1),amount:r.normal.amount!=null?r.normal.amount:1})}return _createClass(e,[{key:"inject",value:function(r){var n=this;material_props.forEach(function(o){var s="TANGRAM_MATERIAL_".concat(o.toUpperCase()),l=s+"_TEXTURE";r.defines[s]=n[o]!=null,n[o]&&n[o].texture&&(r.defines[l]=!0,r.defines[l+"_"+n[o].mapping.toUpperCase()]=!0,r.defines["TANGRAM_MATERIAL_TEXTURE_".concat(n[o].mapping.toUpperCase())]=!0,r.texcoords=r.texcoords||n[o].mapping==="uv")}),this.normal&&this.normal.texture&&(r.defines.TANGRAM_MATERIAL_NORMAL_TEXTURE=!0,r.defines["TANGRAM_MATERIAL_NORMAL_TEXTURE_"+this.normal.mapping.toUpperCase()]=!0,r.defines["TANGRAM_MATERIAL_TEXTURE_".concat(this.normal.mapping.toUpperCase())]=!0,r.texcoords=r.texcoords||this.normal.mapping==="uv"),r.replaceShaderBlock(e.block,shaderSrc_material,"Material"),r.addShaderBlock("setup",`
material = u_material;
`,"Material")}},{key:"setupProgram",value:function(r){var n=this;material_props.forEach(function(o){n[o]&&(n[o].texture?(r.setTextureUniform("u_material_".concat(o,"_texture"),n[o].texture),r.uniform("3fv","u_material.".concat(o,"Scale"),n[o].scale),r.uniform("4fv","u_material.".concat(o),n[o].amount)):n[o].amount&&r.uniform("4fv","u_material.".concat(o),n[o].amount))}),this.specular&&r.uniform("1f","u_material.shininess",this.specular.shininess),this.normal&&this.normal.texture&&(r.setTextureUniform("u_material_normal_texture",this.normal.texture),r.uniform("3fv","u_material.normalScale",this.normal.scale),r.uniform("1f","u_material.normalAmount",this.normal.amount))}}],[{key:"isValid",value:function(r){return r!=null&&(r.emission!=null||r.ambient!=null||r.diffuse!=null||r.specular!=null)}}]),e}(),Vector;Material.block="material";var Vector$1=Vector={};Vector.copy=function(e){for(var r=[],n=e.length,o=0;o<n;o++)r[o]=e[o];return r},Vector.neg=function(e){for(var r=[],n=e.length,o=0;o<n;o++)r[o]=-e[o];return r},Vector.add=function(e,r){for(var n=[],o=Math.min(e.length,r.length),s=0;s<o;s++)n[s]=e[s]+r[s];return n},Vector.sub=function(e,r){for(var n=[],o=Math.min(e.length,r.length),s=0;s<o;s++)n[s]=e[s]-r[s];return n},Vector.signed_area=function(e,r,n){return(r[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(r[1]-e[1])},Vector.mult=function(e,r){var n,o=[],s=e.length;if(typeof r=="number")for(n=0;n<s;n++)o[n]=e[n]*r;else for(s=Math.min(e.length,r.length),n=0;n<s;n++)o[n]=e[n]*r[n];return o},Vector.multMatrix=function(e,r){return[e[0][0]*r[0]+e[0][1]*r[1],e[1][0]*r[0]+e[1][1]*r[1]]},Vector.div=function(e,r){var n=[];if(typeof r=="number")for(s=0;s<e.length;s++)n[s]=e[s]/r;else for(var o=Math.min(e.length,r.length),s=0;s<o;s++)n[s]=e[s]/r[s];return n},Vector.perp=function(e,r){return[r[1]-e[1],e[0]-r[0]]},Vector.rot=function(e,r){var n=Math.cos(r),o=Math.sin(r);return[e[0]*n-e[1]*o,e[0]*o+e[1]*n]},Vector.angle=function(e){var r=_slicedToArray(e,2),n=r[0],o=r[1];return Math.atan2(o,n)},Vector.angleBetween=function(e,r){var n=Vector.dot(Vector.normalize(Vector.copy(e)),Vector.normalize(Vector.copy(r)));return 1<n&&(n=1),Math.acos(n)},Vector.signedAngleBetween=function(e,r){return Math.atan2(e[0]*r[1]-e[1]*r[0],e[0]*r[0]+e[1]*r[1])},Vector.isEqual=function(e,r){for(var n=e.length,o=0;o<n;o++)if(e[o]!==r[o])return!1;return!0},Vector.lengthSq=function(e){return e.length===2?e[0]*e[0]+e[1]*e[1]:3<=e.length?e[0]*e[0]+e[1]*e[1]+e[2]*e[2]:0},Vector.length=function(e){return Math.sqrt(Vector.lengthSq(e))},Vector.normalize=function(e){var r;if(e.length===2){if((r=e[0]*e[0]+e[1]*e[1])===1)return e;(r=Math.sqrt(r))!==0?(e[0]/=r,e[1]/=r):(e[0]=0,e[1]=0)}else if(3<=e.length){if((r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2])===1)return e;(r=Math.sqrt(r))!==0?(e[0]/=r,e[1]/=r,e[2]/=r):(e[0]=0,e[1]=0,e[2]=0)}return e},Vector.cross=function(e,r){return e.length===2?e[0]*r[1]-e[1]*r[0]:e.length===3?[e[1]*r[2]-e[2]*r[1],e[2]*r[0]-e[0]*r[2],e[0]*r[1]-e[1]*r[0]]:void 0},Vector.dot=function(e,r){for(var n=0,o=Math.min(e.length,r.length),s=0;s<o;s++)n+=e[s]*r[s];return n};var shaderSrc_ambientLight="/*Expected globals:light_accumulator_**/struct AmbientLight{vec3 ambient;};void calculateLight(in AmbientLight _light,in vec3 _eyeToPoint,in vec3 _normal){light_accumulator_ambient.rgb+=_light.ambient;}",shaderSrc_directionalLight=`/*Expected globals:materiallight_accumulator_**/struct DirectionalLight{vec3 ambient;vec3 diffuse;vec3 specular;vec3 direction;};void calculateLight(in DirectionalLight _light,in vec3 _eyeToPoint,in vec3 _normal){light_accumulator_ambient.rgb+=_light.ambient;float nDotVP=clamp(dot(_normal,-_light.direction),0.0,1.0);
#ifdef TANGRAM_MATERIAL_DIFFUSE
light_accumulator_diffuse.rgb+=_light.diffuse*nDotVP;
#endif
#ifdef TANGRAM_MATERIAL_SPECULAR
float pf=0.0;if(nDotVP>0.0){vec3 reflectVector=reflect(_light.direction,_normal);float eyeDotR=max(dot(normalize(_eyeToPoint),reflectVector),0.0);pf=pow(eyeDotR,material.shininess);}light_accumulator_specular.rgb+=_light.specular*pf;
#endif
}`,shaderSrc_pointLight=`/*Expected globals:materiallight_accumulator_**/struct PointLight{vec3 ambient;vec3 diffuse;vec3 specular;vec4 position;
#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT
float attenuationExponent;
#endif
#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS
float innerRadius;
#endif
#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS
float outerRadius;
#endif
};void calculateLight(in PointLight _light,in vec3 _eyeToPoint,in vec3 _normal){float dist=length(_light.position.xyz-_eyeToPoint);vec3 VP=(_light.position.xyz-_eyeToPoint)/dist;float nDotVP=clamp(dot(VP,_normal),0.0,1.0);float attenuation=1.0;
#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT
float Rin=1.0;float e=_light.attenuationExponent;
#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS
Rin=_light.innerRadius;
#endif
#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS
float Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-(pow(d,e));
#else
float d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/(pow(d,e)),0.0,1.0);
#endif
#else
float Rin=0.0;
#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS
Rin=_light.innerRadius;
#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS
float Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-d*d;
#else
float d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/d,0.0,1.0);
#endif
#else
#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS
float d=clamp(dist/_light.outerRadius,0.0,1.0);attenuation=1.0-d*d;
#else
attenuation=1.0;
#endif
#endif
#endif
light_accumulator_ambient.rgb+=_light.ambient*attenuation;
#ifdef TANGRAM_MATERIAL_DIFFUSE
light_accumulator_diffuse.rgb+=_light.diffuse*nDotVP*attenuation;
#endif
#ifdef TANGRAM_MATERIAL_SPECULAR
float pf=0.0;if(nDotVP>0.0){vec3 reflectVector=reflect(-VP,_normal);float eyeDotR=max(0.0,dot(-normalize(_eyeToPoint),reflectVector));pf=pow(eyeDotR,material.shininess);}light_accumulator_specular.rgb+=_light.specular*pf*attenuation;
#endif
}`,shaderSrc_spotLight=`/*Expected globals:materiallight_accumulator_**/struct SpotLight{vec3 ambient;vec3 diffuse;vec3 specular;vec4 position;
#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT
float attenuationExponent;
#endif
#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS
float innerRadius;
#endif
#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS
float outerRadius;
#endif
vec3 direction;float spotCosCutoff;float spotExponent;};void calculateLight(in SpotLight _light,in vec3 _eyeToPoint,in vec3 _normal){float dist=length(_light.position.xyz-_eyeToPoint);vec3 VP=(_light.position.xyz-_eyeToPoint)/dist;float nDotVP=clamp(dot(_normal,VP),0.0,1.0);float attenuation=1.0;
#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT
float Rin=1.0;float e=_light.attenuationExponent;
#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS
Rin=_light.innerRadius;
#endif
#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS
float Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-(pow(d,e));
#else
float d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/(pow(d,e)),0.0,1.0);
#endif
#else
float Rin=0.0;
#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS
Rin=_light.innerRadius;
#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS
float Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-d*d;
#else
float d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/d,0.0,1.0);
#endif
#else
#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS
float d=clamp(dist/_light.outerRadius,0.0,1.0);attenuation=1.0-d*d;
#else
attenuation=1.0;
#endif
#endif
#endif
float spotAttenuation=0.0;float spotDot=clamp(dot(-VP,_light.direction),0.0,1.0);if(spotDot>=_light.spotCosCutoff){spotAttenuation=pow(spotDot,_light.spotExponent);}light_accumulator_ambient.rgb+=_light.ambient*attenuation*spotAttenuation;
#ifdef TANGRAM_MATERIAL_DIFFUSE
light_accumulator_diffuse.rgb+=_light.diffuse*nDotVP*attenuation*spotAttenuation;
#endif
#ifdef TANGRAM_MATERIAL_SPECULAR
float pf=0.0;if(nDotVP>0.0){vec3 reflectVector=reflect(-VP,_normal);float eyeDotR=max(dot(-normalize(_eyeToPoint),reflectVector),0.0);pf=pow(eyeDotR,material.shininess);}light_accumulator_specular.rgb+=_light.specular*pf*attenuation*spotAttenuation;
#endif
}`,Light=function(){function e(r,n){_classCallCheck(this,e),this.name=n.name,this.view=r,n.ambient==null||typeof n.ambient=="number"?this.ambient=GLSL.expandVec3(n.ambient||0):this.ambient=StyleParser.parseColor(n.ambient).slice(0,3),n.diffuse==null||typeof n.diffuse=="number"?this.diffuse=GLSL.expandVec3(n.diffuse!=null?n.diffuse:1):this.diffuse=StyleParser.parseColor(n.diffuse).slice(0,3),n.specular==null||typeof n.specular=="number"?this.specular=GLSL.expandVec3(n.specular||0):this.specular=StyleParser.parseColor(n.specular).slice(0,3)}return _createClass(e,[{key:"inject",value:function(){var r=`
            uniform `.concat(this.struct_name," u_").concat(this.name,`;
            `).concat(this.struct_name," ").concat(this.name,`;
            `),n=`
            `.concat(this.name," = u_").concat(this.name,`;

        `);ShaderProgram.addBlock(e.block,r),ShaderProgram.addBlock("setup",n)}},{key:"update",value:function(){}},{key:"setupProgram",value:function(r){r.uniform("3fv","u_".concat(this.name,".ambient"),this.ambient),r.uniform("3fv","u_".concat(this.name,".diffuse"),this.diffuse),r.uniform("3fv","u_".concat(this.name,".specular"),this.specular)}}],[{key:"create",value:function(r,n){if(e.types[n.type])return new e.types[n.type](r,n)}},{key:"setMode",value:function(r,n){r===!0&&(r="fragment"),r=e.enabled&&(r??"fragment"),n.defines.TANGRAM_LIGHTING_FRAGMENT=r==="fragment",n.defines.TANGRAM_LIGHTING_VERTEX=r==="vertex"}},{key:"inject",value:function(r){if(ShaderProgram.removeBlock(e.block),e.enabled){var n="";if(r&&0<Object.keys(r).length){var o={};for(var s in r)o[r[s].type]=!0;for(var l in o)e.types[l].inject();for(var h in r)r[h].inject(),n+="calculateLight(".concat(h,`, _eyeToPoint, _normal);
`)}var d=`
            vec4 calculateLighting(in vec3 _eyeToPoint, in vec3 _normal, in vec4 _color) {

                // Do initial material calculations over normal, emission, ambient, diffuse and specular values
                calculateMaterial(_eyeToPoint,_normal);

                // Un roll the loop of individual ligths to calculate
                `.concat(n,`

                //  Final light intensity calculation
                vec4 color = vec4(vec3(0.), _color.a); // start with vertex color alpha

                #ifdef TANGRAM_MATERIAL_EMISSION
                    color.rgb = material.emission.rgb;
                    color.a *= material.emission.a;
                #endif

                #ifdef TANGRAM_MATERIAL_AMBIENT
                    color.rgb += light_accumulator_ambient.rgb * _color.rgb * material.ambient.rgb;
                    color.a *= material.ambient.a;
                #else
                    #ifdef TANGRAM_MATERIAL_DIFFUSE
                        color.rgb += light_accumulator_ambient.rgb * _color.rgb * material.diffuse.rgb;
                    #endif
                #endif

                #ifdef TANGRAM_MATERIAL_DIFFUSE
                    color.rgb += light_accumulator_diffuse.rgb * _color.rgb * material.diffuse.rgb;
                    color.a *= material.diffuse.a;
                #endif

                #ifdef TANGRAM_MATERIAL_SPECULAR
                    color.rgb += light_accumulator_specular.rgb * material.specular.rgb;
                    color.a *= material.specular.a;
                #endif

                // Clamp final color
                color = clamp(color, 0.0, 1.0);

                return color;
            }`);ShaderProgram.addBlock(e.block,d)}}}]),e}();Light.types={},Light.block="lighting",Light.enabled=!0;var AmbientLight=function(){_inherits(r,Light);var e=_createSuper(r);function r(n,o){var s;return _classCallCheck(this,r),(s=e.call(this,n,o)).type="ambient",s.struct_name="AmbientLight",s}return _createClass(r,[{key:"setupProgram",value:function(n){n.uniform("3fv","u_".concat(this.name,".ambient"),this.ambient)}}],[{key:"inject",value:function(){ShaderProgram.addBlock(Light.block,shaderSrc_ambientLight)}}]),r}();Light.types.ambient=AmbientLight;var DirectionalLight=function(){_inherits(r,Light);var e=_createSuper(r);function r(n,o){var s,l;return _classCallCheck(this,r),(s=e.call(this,n,o)).type="directional",s.struct_name="DirectionalLight",o.direction?s._direction=o.direction:(l=Math.sin(60*Math.PI/180),s._direction=[Math.cos(135*Math.PI/180)*l,Math.sin(135*Math.PI/180)*l,-.5]),o.ambient==null&&(s.ambient=GLSL.expandVec3(.5)),s.direction=s._direction.map(parseFloat),s._initial_direction=[s.direction[0],s.direction[1],s.direction[2]],s}return _createClass(r,[{key:"update",value:function(){vec3.transformMat4(this.direction,this._initial_direction,this.view.lookAtManipulator.getTransformationMatrix())}},{key:"setupProgram",value:function(n){_get(_getPrototypeOf(r.prototype),"setupProgram",this).call(this,n),n.uniform("3fv","u_".concat(this.name,".direction"),this.direction)}},{key:"direction",get:function(){return this._direction},set:function(n){this._direction=Vector$1.normalize(Vector$1.copy(n))}}],[{key:"inject",value:function(){ShaderProgram.addBlock(Light.block,shaderSrc_directionalLight)}}]),r}();Light.types.directional=DirectionalLight;var PointLight=function(){_inherits(r,Light);var e=_createSuper(r);function r(n,o){var s;return _classCallCheck(this,r),(s=e.call(this,n,o)).type="point",s.struct_name="PointLight",s.position=o.position||[0,0,"100px"],s.position_eye=[],s.origin=o.origin||"ground",s.attenuation=isNaN(parseFloat(o.attenuation))?0:parseFloat(o.attenuation),o.radius?Array.isArray(o.radius)&&o.radius.length===2?s.radius=o.radius:s.radius=[null,o.radius]:s.radius=null,s}return _createClass(r,[{key:"inject",value:function(){_get(_getPrototypeOf(r.prototype),"inject",this).call(this),ShaderProgram.defines.TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT=this.attenuation!==0,ShaderProgram.defines.TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS=this.radius!=null&&this.radius[0]!=null,ShaderProgram.defines.TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS=this.radius!=null}},{key:"update",value:function(){var n,o,s,l=this.view.lookAtManipulator.getLookAtData().zoom;this.origin==="world"?(o=(n=_slicedToArray(Geo$1.latLngToMeters(this.position),2))[0],s=n[1],this.position_eye[0]=o-this.view.lookAtManipulator.getLookAtData().position[0],this.position_eye[1]=s-this.view.lookAtManipulator.getLookAtData().position[1],this.position_eye[2]=StyleParser.convertUnits(this.position[2],{zoom:l,meters_per_pixel:Geo$1.metersPerPixel(l)}),this.position_eye[2]=this.position_eye[2]-this.view.lookAtManipulator.getLookAtData().distance):this.origin!=="ground"&&this.origin!=="camera"||(this.position_eye=StyleParser.convertUnits(this.position,{zoom:l,meters_per_pixel:Geo$1.metersPerPixel(l)}),this.origin==="ground"&&(this.position_eye[2]=this.position_eye[2]-this.view.lookAtManipulator.getLookAtData().distance)),this.position_eye[3]=1}},{key:"setupProgram",value:function(n){_get(_getPrototypeOf(r.prototype),"setupProgram",this).call(this,n),n.uniform("4fv","u_".concat(this.name,".position"),this.position_eye),ShaderProgram.defines.TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT&&n.uniform("1f","u_".concat(this.name,".attenuationExponent"),this.attenuation);var o=this.view.lookAtManipulator.getLookAtData().zoom;ShaderProgram.defines.TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS&&n.uniform("1f","u_".concat(this.name,".innerRadius"),StyleParser.convertUnits(this.radius[0],{zoom:o,meters_per_pixel:Geo$1.metersPerPixel(o)})),ShaderProgram.defines.TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS&&n.uniform("1f","u_".concat(this.name,".outerRadius"),StyleParser.convertUnits(this.radius[1],{zoom:o,meters_per_pixel:Geo$1.metersPerPixel(o)}))}}],[{key:"inject",value:function(){ShaderProgram.addBlock(Light.block,shaderSrc_pointLight)}}]),r}();Light.types.point=PointLight;var SpotLight=function(){_inherits(r,PointLight);var e=_createSuper(r);function r(n,o){var s;return _classCallCheck(this,r),(s=e.call(this,n,o)).type="spotlight",s.struct_name="SpotLight",s.direction=s._direction=(o.direction||[0,0,-1]).map(parseFloat),s._initial_direction=[s.direction[0],s.direction[1],s.direction[2]],s.exponent=o.exponent?parseFloat(o.exponent):.2,s.angle=o.angle?parseFloat(o.angle):20,s}return _createClass(r,[{key:"setupProgram",value:function(n){_get(_getPrototypeOf(r.prototype),"setupProgram",this).call(this,n),n.uniform("3fv","u_".concat(this.name,".direction"),this.direction),n.uniform("1f","u_".concat(this.name,".spotCosCutoff"),Math.cos(3.14159*this.angle/180)),n.uniform("1f","u_".concat(this.name,".spotExponent"),this.exponent)}},{key:"update",value:function(){_get(_getPrototypeOf(r.prototype),"update",this).call(this),vec3.transformMat4(this.direction,this._initial_direction,this.view.lookAtManipulator.getTransformationMatrix())}},{key:"direction",get:function(){return this._direction},set:function(n){this._direction=Vector$1.normalize(Vector$1.copy(n))}}],[{key:"inject",value:function(){ShaderProgram.addBlock(Light.block,shaderSrc_spotLight)}}]),r}();function mergeObjects(e){for(var r=0;r<(arguments.length<=1?0:arguments.length-1);r++){var n=r+1<1||arguments.length<=r+1?void 0:arguments[r+1];if(n)for(var o in n){var s=n[o];s===null||_typeof(s)!=="object"||Array.isArray(s)?s!==void 0&&(e[o]=s):e[o]===null||_typeof(e[o])!=="object"||Array.isArray(e[o])?e[o]=mergeObjects({},s):e[o]=mergeObjects(e[o],s)}}return e}Light.types.spotlight=SpotLight;var shaderSrc_selectionFragment=`
#ifdef TANGRAM_FEATURE_SELECTION
varying vec4 v_selection_color;
#endif
void main(void){
#ifdef TANGRAM_FEATURE_SELECTION
gl_FragColor=v_selection_color;
#else
gl_FragColor=vec4(0.,0.,0.,1.);
#endif
}`,shaderSrc_selectionCropFragment=`
#pragma tangram: utils
#ifdef TANGRAM_FEATURE_SELECTION
uniform float u_meters_per_pixel;varying vec4 v_selection_color;varying vec4 v_local_space_position;
#endif
void main(void){
#ifdef TANGRAM_FEATURE_SELECTION
if(isLocalSpacePixelOutsideTile(v_local_space_position,TANGRAM_TILE_SCALE.x)){discard;}else{gl_FragColor=v_selection_color;}
#else
gl_FragColor=vec4(0.,0.,0.,1.);
#endif
}`,shaderSrc_rasters=`#ifdef TANGRAM_FRAGMENT_SHADER
uniform sampler2D u_raster;uniform vec3 u_raster_offset;
#define sampleRaster() (texture2D(u_raster, v_modelpos_base_zoom.xy * u_raster_offset.z + u_raster_offset.xy))
#endif
`,Style={init:function(e){var r=0<arguments.length&&e!==void 0?e:{},n=r.generation,o=r.styles,s=r.sources,l=s===void 0?{}:s,h=r.introspection,d=r.id,y=d!==void 0?d+"/":"";this.scene_id=d,this.textureManager=getTextureManager(d),this.main_thread_target="".concat(y,"Style/").concat(this.name),this.setGeneration(n),this.styles=o,this.sources=l,this.defines=this.hasOwnProperty("defines")&&this.defines||{},this.shaders=this.hasOwnProperty("shaders")&&this.shaders||{},this.introspection=h||!1,this.selection=this.selection||this.introspection||!1,this.compile_setup=!1,this.program=null,this.selection_program=null,this.feature_style={},this.vertex_template=[],this.tile_data={},this.defines.TANGRAM_WORLD_POSITION_WRAP=1e5,this.blend=this.blend||"opaque",this.defines["TANGRAM_BLEND_".concat(this.blend.toUpperCase())]=!0,this.blend_order==null&&(this.blend_order=-1),this.removeShaderBlock("setup"),this.material instanceof Material||(Material.isValid(this.material)||(this.material=StyleParser.defaults.material),this.material=new Material(this.material)),this.material.inject(this),Light.setMode(this.lighting,this),this.setupRasters(),this.initialized=!0},destroy:function(){this.program&&(this.program.destroy(),this.program=null),this.selection_program&&(this.selection_program.destroy(),this.selection_program=null),WorkerBroker.removeTarget(this.main_thread_target),this.gl=null,this.initialized=!1},reset:function(){},baseStyle:function(){return this.base||this.name},setGeneration:function(e){this.generation=e,Thread.is_main&&WorkerBroker.addTarget(this.main_thread_target,this)},fillVertexTemplate:function(e,r,n,o){var s=o.size,l=(l=o.offset)===void 0?0:l,h=e.index[r];if(h!==void 0)for(var d=0;d<s;++d){var y=n.length>d?n[d]:n;this.vertex_template[h+d+l]=y}else log("warn","Style: in style '".concat(this.name,"', no index found in vertex layout for attribute '").concat(r,"'"))},startData:function(e){this.tile_data[e.id]=this.tile_data[e.id]||{meshes:{},uniforms:{},textures:[]}},endData:function(e){var r=this.tile_data[e.id];if(this.tile_data[e.id]=null,r&&0<Object.keys(r.meshes).length){for(var n in r.meshes){var o=r.meshes[n];o.vertex_data.vertex_count!==0?(o.vertex_data.end(),o.vertex_elements=o.vertex_data.element_buffer,o.vertex_data=o.vertex_data.vertex_buffer):delete r.meshes[n]}return e.mesh_data[this.name]=r,this.buildRasterTextures(e,r).then(function(s){return s})}return Promise.resolve(null)},hasDataForTile:function(e){return this.tile_data[e.id]!=null},getTileMesh:function(e,r){var n=this.tile_data[e.id].meshes;return n[r.key]==null&&(n[r.key]={variant:r,vertex_data:this.vertexLayoutForMeshVariant(r).createVertexData()}),n[r.key]},vertexLayoutForMeshVariant:function(){return this.vertex_layout},default_mesh_variant:{key:0},style_mesh_variants:{default:{variants:{0:{variant:{key:0},times_unref:0}}}},addMeshVariantForDraw:function(e,r){this.style_mesh_variants[e]||(this.style_mesh_variants[e]={variants:{}});var n=this.computeVariantForDraw(r);return this.style_mesh_variants[e].variants[n.key]={variant:n,times_unref:0},this.style_mesh_variants[e].variants[n.key].variant},getMeshVariantTypeForDraw:function(e){return this.getMeshVariantType(this.base,e)},getMeshVariantType:function(e,r){e===void 0&&(e="default");var n=this.style_mesh_variants[e];if(r.variantKey===void 0||!n||!n.variants[r.variantKey])return this.addMeshVariantForDraw(e,r);var o=r.variantKey,s=n.variants[o];return s.times_unref=0,s.variant},updateMeshVariantTypeCache:function(e){for(var r in this.style_mesh_variants){var n=this.style_mesh_variants[r].variants;for(var o in n){var s=n[o];s.times_unref++,s.times_unref>e&&(r!=="default"||+o!=0)&&(delete n[o],Object.keys(n).length===0&&delete this.style_mesh_variants[r])}}},computeVariantForDraw:function(){return this.default_mesh_variant},addFeature:function(e,r,n){var o=n.tile;this.tile_data[o.id]||this.startData(o);var s,l,h,d,y=this.parseFeature(e,r,n);y&&(s=this.base==="lines"?this.getMeshVariantTypeForDraw(r):this.getMeshVariantTypeForDraw(y),h=(l=this.getTileMesh(o,s)).vertex_data.offset,d=l.vertex_data.vertex_count,0<this.buildGeometry(e.geometry,y,l,n)?e.generation=this.generation:l.vertex_data.vertex_count>d&&(l.vertex_data.vertex_buffer.fill(0,h,l.vertex_data.offset),l.vertex_data.vertex_count=d,l.vertex_data.offset=h))},buildGeometry:function(e,r,n,o){var s;return e.type==="Polygon"?s=this.buildPolygons([e.coordinates],r,n,o):e.type==="MultiPolygon"?s=this.buildPolygons(e.coordinates,r,n,o):e.type==="LineString"?s=this.buildLines([e.coordinates],r,n,o):e.type==="MultiLineString"?s=this.buildLines(e.coordinates,r,n,o):e.type==="Point"?s=this.buildPoints([e.coordinates],r,n,o):e.type==="MultiPoint"&&(s=this.buildPoints(e.coordinates,r,n,o)),s},parseFeature:function(e,r,n){try{var o,s,l,h=this.feature_style;if(h.order=this.parseOrder(r.order,n),h.order==null&&this.blend!=="overlay"){var d="Layer '".concat(r.layers.join(", "),"', draw group '").concat(r.group,"': ");return d+="'order' parameter is required unless blend mode is 'overlay'",r.order!=null&&(d+="; 'order' was set to a dynamic value (e.g. string tied to feature property, ",d+="or JS function), but evaluated to null for one or more features"),void log({level:"warn",once:!0},d)}return(h=this._parseFeature(e,r,n))?(this.selection?h.interactive=StyleParser.evalProperty(this.introspection||r.interactive,n):h.interactive=!1,h.interactive===!0?(s=(o=FeatureSelection.makeEntry()).color,l=o.key,h.selection_color=s,n.tile.selection_data||(n.tile.selection_data={}),n.tile.selection_data[l]={id:e.id||l,properties:e.properties,source_name:n.source,source_layer:n.layer,layers:n.layers}):h.selection_color=FeatureSelection.defaultColor,h):void 0}catch(y){log("error","Style.parseFeature: style parsing error",e,h,y.stack)}},_parseFeature:function(){return this.feature_style},preprocess:function(e,r){if(!e.preprocessed){if(this.draw)for(var n in this.draw){var o=this.draw[n];_typeof(o)!=="object"||Array.isArray(o)?e[n]==null&&(e[n]=o):e[n]=mergeObjects({},o,e[n])}var s=r||"";if(!(e=this._preprocess(e,s)))return;e.preprocessed=!0}return e},_preprocess:function(e){return e},parseOrder:function(e,r){return typeof e!="number"?StyleParser.calculateOrder(e,r):e},scaleOrder:function(e){return 2*e},parseColor:function(e,r){return e?StyleParser.evalCachedColorProperty(e,r):this.shaders.blocks.color||this.shaders.blocks.filter?StyleParser.defaults.color:void 0},buildPolygons:function(){return 0},buildLines:function(){return 0},buildPoints:function(){return 0},setGL:function(e){this.gl=e,this.max_texture_size=this.textureManager.getMaxTextureSize(this.gl)},makeMesh:function(e,r,n){var o=2<arguments.length&&n!==void 0?n:{},s=this.vertexLayoutForMeshVariant(o.variant);return new VBOMesh(this.gl,e,r,s,this.scene_id,o)},render:function(e){return e.render()},getProgram:function(e){var r=0<arguments.length&&e!==void 0?e:"program";this.compileSetup();var n=this[r];if(n&&!n.error){if(!n.compiled)try{n.compile()}catch(o){log("error","Style: error compiling program for style '".concat(this.name,"' (program key '").concat(r,"')"),this,o.stack)}return n}},compileSetup:function(){if(!this.compile_setup){if(!this.gl)throw new Error("style.compile(): skipping for ".concat(this.name," because no GL context"));var e,r=this.buildDefineList();this.selection&&((e=Object.assign({},r)).TANGRAM_FEATURE_SELECTION=!0);var n=this.shaders&&this.shaders.blocks,o=this.shaders&&this.shaders.block_scopes,s=Object.assign({},this.shaders&&this.shaders.uniforms);for(var l in s)s[l]==null&&log({level:"warn",once:!0},"Style '".concat(this.name,"' has invalid uniform '").concat(l,"': uniform values must be non-null"));var h=this.shaders&&this.shaders.extensions;typeof h=="string"&&(h=[h]),this.program=new ShaderProgram(this.gl,this.vertex_shader_src,this.fragment_shader_src,this.scene_id,{name:this.name,defines:r,uniforms:s,blocks:n,block_scopes:o,extensions:h}),this.selection?this.selection_program=new ShaderProgram(this.gl,this.vertex_shader_src,this.crop_by_tile?shaderSrc_selectionCropFragment:shaderSrc_selectionFragment,this.scene_id,{name:this.name+" (selection)",defines:e,uniforms:s,blocks:n,block_scopes:o,extensions:h}):this.selection_program=null,this.compile_setup=!0}},addShaderBlock:function(e,r,n){var o=2<arguments.length&&n!==void 0?n:null;this.shaders.blocks=this.shaders.blocks||{},this.shaders.blocks[e]=this.shaders.blocks[e]||[],this.shaders.blocks[e].push(r),this.shaders.block_scopes=this.shaders.block_scopes||{},this.shaders.block_scopes[e]=this.shaders.block_scopes[e]||[],this.shaders.block_scopes[e].push(o)},removeShaderBlock:function(e){this.shaders.blocks&&(this.shaders.blocks[e]=null)},replaceShaderBlock:function(e,r,n){var o=2<arguments.length&&n!==void 0?n:null;this.removeShaderBlock(e),this.addShaderBlock(e,r,o)},buildDefineList:function(){var e={};if(this.defines!=null)for(var r in this.defines)e[r]=this.defines[r];if(this.shaders!=null&&this.shaders.defines!=null)for(r in this.shaders.defines)e[r]=this.shaders.defines[r];return e},hasRasters:function(){return-1<["color","normal","custom"].indexOf(this.raster)},setupRasters:function(){if(!Thread.is_main||!this.hasRasters())return!1;this.raster==="color"?this.defines.TANGRAM_RASTER_TEXTURE_COLOR=!0:this.raster==="normal"&&(this.defines.TANGRAM_RASTER_TEXTURE_NORMAL=!0);var e=!1;for(var r in this.sources)if(this.sources[r]instanceof RasterTileSource){e=!0;break}return!!e&&(this.defines.TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING=!0,this.replaceShaderBlock("raster",shaderSrc_rasters,"Raster"),!0)},buildRasterTextures:function(e,r){var n=this;if(!this.hasRasters())return Promise.resolve(r);var o={};return e.rasters.map(function(s){return n.sources[s]}).filter(function(s){return s}).forEach(function(s,l){var h;s instanceof RasterTileSource&&(h=s.tileTexture(e),o[h.url]=h)}),Object.keys(o).length===0?Promise.resolve(r):WorkerBroker.postMessage(this.main_thread_target+".loadTextures",o).then(function(s){if(!s||s.length<1)return log("trace","Missing texture info for tile ".concat(e.key)),null;if(s.some(function(g){return!g.loaded}))return null;r.uniforms=r.uniforms||{},r.textures=r.textures||[];var l,h,d=s[0].name,y=o[d].coords;return r.uniforms.u_raster=d,r.textures.push(d),e.coords.z>y.z?(l=e.coords.z-y.z,h=Math.pow(2,l),r.uniforms.u_raster_offset=[(e.coords.x%h+h)%h/h,(h-1-e.coords.y%h)/h,1/h]):r.uniforms.u_raster_offset=[0,0,1],r})},loadTextures:function(e){var r=this;return this.textureManager.createFromObject(this.gl,e).then(function(){return Promise.all(Object.keys(e).map(function(n){return r.textureManager.textures[n]&&r.textureManager.textures[n].load()}).filter(function(n){return n}))}).then(function(n){return n.forEach(function(o){return o.retain()}),n.map(function(o){return{name:o.name,width:o.width,height:o.height,loaded:o.loaded}})})},setup:function(){this.setUniforms(),this.material.setupProgram(ShaderProgram.current)},setUniforms:function(){var e=ShaderProgram.current;e&&e.setUniforms(this.shaders&&this.shaders.uniforms,!0)},render_states:{opaque:{depth_test:!0,depth_write:!0},translucent:{depth_test:!0,depth_write:!0},add:{depth_test:!0,depth_write:!1},multiply:{depth_test:!0,depth_write:!1},inlay:{depth_test:!0,depth_write:!1},overlay:{depth_test:!1,depth_write:!1}},default_blend_orders:{opaque:0,add:1,multiply:2,inlay:3,translucent:4,overlay:5},sortByBlendOrderWithinLayers:function(e){var r=[],n={};for(var o in e.forEach(function(s){var l=parseInt(s.name,10)||0;n[l]||(n[l]=[]),n[l].push(s)}),n)r.push.apply(r,_toConsumableArray(n[o].sort(Style.blendOrderSort)));return r},blendOrderSort:function(e,r){return e.blend==="opaque"||r.blend==="opaque"?e.blend==="opaque"&&r.blend==="opaque"?e.name<r.name?-1:1:e.blend==="opaque"?-1:1:e.blend_order<r.blend_order||!(e.blend_order>r.blend_order)&&(Style.default_blend_orders[e.blend]<Style.default_blend_orders[r.blend]||!(Style.default_blend_orders[e.blend]>Style.default_blend_orders[r.blend])&&e.name<r.name)?-1:1}},id$1=0,build_id=0,Tile=function(){function e(r){var n=r.coords,o=r.style_zoom,s=r.source,l=r.worker,h=r.view,d=r.sceneId;_classCallCheck(this,e),this.textureManager=getTextureManager(d),this.id=id$1++,this.worker=l,this.view=h,this.source=s,this.generation=null,this.valid=!0,this.proxy_for=null,this.proxy_depth=0,this.proxied_as=null,this.fade_in=!0,this.loading=!1,this.loaded=!1,this.built=!1,this.labeled=!1,this.error=null,this.style_zoom=o,this.coords=e.normalizedCoordinate(n,this.source,this.style_zoom),this.key=e.key(this.coords,this.source,this.style_zoom),this.overzoom=Math.max(this.style_zoom-this.coords.z,0),this.overzoom2=Math.pow(2,this.overzoom),this.min=Geo$1.metersForTile(this.coords),this.max=Geo$1.metersForTile({x:this.coords.x+1,y:this.coords.y+1,z:this.coords.z}),this.span={x:this.max.x-this.min.x,y:this.max.y-this.min.y},this.bounds={sw:{x:this.min.x,y:this.max.y},ne:{x:this.max.x,y:this.min.y}},this.center_dist=0,this.meters_per_pixel=Geo$1.metersPerPixel(this.style_zoom),this.meters_per_pixel_sq=this.meters_per_pixel*this.meters_per_pixel,this.units_per_pixel=Geo$1.units_per_pixel/this.overzoom2,this.units_per_meter_overzoom=Geo$1.unitsPerMeter(this.coords.z)*this.overzoom2,this.meshes={},this.new_mesh_styles=[]}return _createClass(e,[{key:"freeResources",value:function(){for(var r in this.meshes)this.meshes[r].forEach(function(n){return n.destroy()});this.meshes={}}},{key:"destroy",value:function(){Task.removeForTile(this.id),this.workerMessage("self.removeTile",this.id),this.freeResources(),this.worker=null,this.valid=!1}},{key:"buildAsMessage",value:function(){return{id:this.id,key:this.key,source:this.source.name,coords:this.coords,min:this.min,max:this.max,units_per_pixel:this.units_per_pixel,meters_per_pixel:this.meters_per_pixel,meters_per_pixel_sq:this.meters_per_pixel_sq,units_per_meter_overzoom:this.units_per_meter_overzoom,style_zoom:this.style_zoom,overzoom:this.overzoom,overzoom2:this.overzoom2,generation:this.generation}}},{key:"workerMessage",value:function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return WorkerBroker.postMessage.apply(WorkerBroker,[this.worker].concat(n))}},{key:"build",value:function(r,n){var o=(1<arguments.length&&n!==void 0?n:{}).fade_in,s=o===void 0||o;return this.generation=r,this.fade_in=s,this.loaded||(this.loading=!0,this.built=!1,this.labeled=!1),this.workerMessage("self.buildTile",{tile:this.buildAsMessage()})}},{key:"buildMeshes",value:function(r,n){if(!this.error){this.build_id=build_id++;var o={},s=this.mesh_data;if(s)for(var l in s){for(var h in s[l].meshes){var d=s[l].meshes[h];if(d.vertex_data){if(!r[l]){log("warn","Could not create mesh because style '".concat(l,"' not found, for tile ").concat(this.key,", aborting tile"));break}var y=Object.assign({},s[l]);y.uniforms=Object.assign({},y.uniforms,d.uniforms),y.variant=d.variant,d.textures&&(y.textures=d.textures),d.labels&&(y.retain=!0);var g=r[l].makeMesh(d.vertex_data,d.vertex_elements,y);g.variant=y.variant,g.labels=d.labels,o[l]=o[l]||[],o[l].push(g),g.variant.order==null&&(g.variant.order=o[l].length-1)}}o[l]&&o[l].sort(function(w,I){var V=w.variant.order,q=I.variant.order;return V!=null&&(q==null||V<q)?-1:1})}for(var v in delete this.mesh_data,o)this.meshes[v]&&this.meshes[v].forEach(function(w){return w.destroy()}),this.meshes[v]=o[v],this.new_mesh_styles.push(v);if(n.done){for(var m in this.meshes)this.new_mesh_styles.indexOf(m)===-1&&(this.meshes[m].forEach(function(w){return w.destroy()}),delete this.meshes[m]);this.new_mesh_styles=[]}}}},{key:"setProxyFor",value:function(r){r?(this.proxy_for=this.proxy_for||[],this.proxy_for.push(r),this.proxy_depth=1,r.proxied_as=r.style_zoom>this.style_zoom?"child":"parent"):(this.proxy_for=null,this.proxy_depth=0)}},{key:"isProxy",value:function(){return this.proxy_for!=null}},{key:"shouldProxyForStyle",value:function(r){return!this.proxy_for||this.proxy_for.some(function(n){return n.meshes[r]==null})}},{key:"setupProgram",value:function(r,n){var o=r.model,s=r.model32;n.uniform("4fv","u_tile_origin",[this.min.x,this.min.y,this.style_zoom,this.coords.z]),n.uniform("1f","u_tile_proxy_depth",this.proxy_depth),mat4.identity(o),mat4.translate(o,o,vec3.fromValues(this.min.x,this.min.y,0)),mat4.scale(o,o,vec3.fromValues(this.span.x/Geo$1.tile_scale,-1*this.span.y/Geo$1.tile_scale,1)),mat4.copy(s,o),n.uniform("Matrix4fv","u_model",s),n.uniform("1i","u_tile_fade_in",this.fade_in&&this.proxied_as!=="child")}},{key:"merge",value:function(r){return this.loading=r.loading,this.loaded=r.loaded,this.generation=r.generation,this.error=r.error,this.mesh_data=r.mesh_data,this.selection_data?Object.assign(this.selection_data,r.selection_data):this.selection_data=r.selection_data,this}}],[{key:"coord",value:function(r){return{x:r.x,y:r.y,z:r.z,key:e.coordKey(r)}}},{key:"coordKey",value:function(r){return r.x+"/"+r.y+"/"+r.z}},{key:"key",value:function(r,n,o){if(!(r.y<0||r.y>=1<<r.z||r.z<0))return[n.name,o,r.x,r.y,r.z].join("/")}},{key:"normalizedKey",value:function(r,n,o){return e.key(e.normalizedCoordinate(r,n,o),n,o)}},{key:"normalizedCoordinate",value:function(r,n){return n.zoom_bias&&(r=e.coordinateAtZoom(r,Math.max(0,r.z-n.zoom_bias))),e.coordinateWithMaxZoom(r,n.max_zoom)}},{key:"coordinateAtZoom",value:function(r,n){var o,s=r.x,l=r.y,h=r.z;return h!==n&&(o=Math.pow(2,h-n),s=Math.floor(s/o),l=Math.floor(l/o),h=n),e.coord({x:s,y:l,z:h})}},{key:"coordinateWithMaxZoom",value:function(r,n){var o=r.x,s=r.y,l=r.z;return n!==void 0&&n<l?e.coordinateAtZoom({x:o,y:s,z:l},n):e.coord({x:o,y:s,z:l})}},{key:"childrenForCoordinate",value:function(r){var n=r.x,o=r.y,s=r.z,l=r.key;return e.coord_children[l]||(s++,n*=2,o*=2,e.coord_children[l]=[e.coord({x:n,y:o,z:s}),e.coord({x:n+1,y:o,z:s}),e.coord({x:n,y:o+1,z:s}),e.coord({x:n+1,y:o+1,z:s})]),e.coord_children[l]}},{key:"isDescendant",value:function(r,n){if(n.z>r.z){var o=e.coordinateAtZoom(n,r.z),s=o.x,l=o.y;return r.x===s&&r.y===l}return!1}},{key:"cancel",value:function(r){r&&(r.canceled=!0,r.source_data&&r.source_data.request_id&&(Utils$1.cancelRequest(r.source_data.request_id),r.source_data.request_id=null),e.abortBuild(r))}},{key:"buildGeometry",value:function(r,n){var o=n.scene_id,s=n.layers,l=n.styles,h=n.global,d=n.sources,y=n.meshVariantMaxLife,g=r.source_data;for(var v in Collision.startTile(r.id,{apply_repeat_groups:!0}),s){var m=s[v];if(m&&m.config_data){if(m.config_data.source===r.source)for(var w=e._getDataForSource(g,m.config_data,v),I=0;I<w.length;I++){var V=w[I],q=V.geom;if(q)for(var De=0;De<q.features.length;De++){var _n=q.features[De];if(_n.geometry!=null){var ha=StyleParser.getFeatureParseContext(_n,r,h,d);ha.winding=r.default_winding,ha.source=r.source,ha.layer=V.layer;var ga=m.buildDrawGroups(ha,!0);if(ga)for(var _o in ga){var _l=ga[_o],wc=_l.style||_o,_h=l[wc];_h?(_l=_h.preprocess(_l,r.source))!=null&&_l.visible!==!1&&(ha.layers=_l.layers,_h.addFeature(_n,_l,ha)):log("warn","Style '".concat(wc,"' not found, skipping layer '").concat(v,"':"),_l,_n)}}}}}else log("warn","Layer ".concat(v," was defined without a geometry data source and will not be rendered."))}var _p=e._stylesForTile(r,l);e._sendStyleGroups(r,_p,{scene_id:o,meshVariantMaxLife:y},function(pd){return pd.collision?"collision":"non-collision"})}},{key:"_stylesForTile",value:function(r,n){var o=[];for(var s in n)n[s].hasDataForTile(r)&&o.push(n[s]);return o}},{key:"_sendStyleGroups",value:function(r,n,o,s){var l=o.scene_id,h=o.meshVariantMaxLife,d={};n.forEach(function(y){var g=s(y);d[g]=d[g]||[],d[g].push(y)}),0<Object.keys(d).length?function(){var y={start:!0};r.mesh_data={};for(var g in d)(function(v){var m=d[v];Promise.all(m.map(function(w){return w.endData(r)})).then(function(){log("trace","Finished style group '".concat(v,"' for tile ").concat(r.key)),d[v]=[],Object.keys(d).every(function(w){return d[w].length===0})&&(y.done=!0),WorkerBroker.postMessage("TileManager_".concat(l,".buildTileStylesCompleted"),WorkerBroker.withTransferables({tile:e.slice(r,["mesh_data","selection_data"]),progress:y})),y.start=null,r.mesh_data={},r.selection_data={},y.done&&Collision.resetTile(r.id)},function(w){log("error","Error for style group '".concat(v,"' for tile ").concat(r.key),w)})})(g);Style.updateMeshVariantTypeCache(h)}():(WorkerBroker.postMessage("TileManager_".concat(l,".buildTileStylesCompleted"),WorkerBroker.withTransferables({tile:e.slice(r),progress:{start:!0,done:!0}})),Collision.resetTile(r.id))}},{key:"_getDataForSource",value:function(r,n,o){var s=2<arguments.length&&o!==void 0?o:null,l=[];return n!=null&&r!=null&&r.layers!=null&&(!n.layer&&r.layers._default||typeof n.layer=="string"&&!r.layers[n.layer]&&new RegExp("^\\d+_"+n.layer+"$").test(s)&&r.layers._default?l.push({geom:r.layers._default}):!n.layer&&s?l.push({layer:s,geom:r.layers[s]}):typeof n.layer=="string"?l.push({layer:n.layer,geom:r.layers[n.layer]}):Array.isArray(n.layer)&&n.layer.forEach(function(h){r.layers[h]&&r.layers[h].features&&l.push({layer:h,geom:r.layers[h]})})),l}},{key:"abortBuild",value:function(r,n){if(Task.removeForTile(r.id),Collision.abortTile(r.id),r.mesh_data)for(var o in r.mesh_data){var s=r.mesh_data[o].textures;s&&s.forEach(function(l){var h=getTextureManager(n).textures[l];h&&(log("trace","releasing texture ".concat(l," for tile ").concat(r.key)),h.release())})}}},{key:"slice",value:function(r,n){var o=["id","key","loading","loaded","generation","error","debug"];Array.isArray(n)&&o.push.apply(o,_toConsumableArray(n));for(var s={},l=0;l<o.length;l++){var h=o[l];s[h]=r[h]}return s}}]),e}();Tile.coord_children={};var RasterTileSource=function(){_inherits(r,NetworkTileSource);var e=_createSuper(r);function r(n,o){var s;return _classCallCheck(this,r),(s=e.call(this,n,o)).rasters.indexOf(s.name)===-1&&s.rasters.unshift(s.name),s.filtering=n.filtering,s.textures={},s}return _createClass(r,[{key:"load",value:function(n){n.source_data={},n.source_data.layers={},n.pad_scale=this.pad_scale,n.rasters=_toConsumableArray(this.rasters);var o=Geo$1.tile_scale;return n.source_data.layers={_default:{type:"FeatureCollection",features:[{geometry:{type:"Polygon",coordinates:[[[0,0],[o,0],[o,-o],[0,-o],[0,0]]]},properties:{}}]}},n.default_winding="CW",Promise.resolve(n)}},{key:"tileTexture",value:function(n){var o,s,l=n.coords.key;return this.textures[l]||(o=Tile.coordinateWithMaxZoom(n.coords,this.max_zoom),s=this.formatUrl(this.url,{coords:o}),this.textures[l]={url:s,filtering:this.filtering,coords:o}),this.textures[l]}}]),r}(),ArrayUtils;DataSource.register(RasterTileSource,"Raster");var ArrayUtils$1=ArrayUtils={};function simplify(e,r,n,o){for(var s,l=o,h=n-r>>1,d=n-r,y=e[r],g=e[r+1],v=e[n],m=e[n+1],w=r+3;w<n;w+=3){var I,V=getSqSegDist(e[w],e[w+1],y,g,v,m);l<V?(s=w,l=V):V!==l||(I=Math.abs(w-h))<d&&(s=w,d=I)}o<l&&(3<s-r&&simplify(e,r,s,o),e[s+2]=l,3<n-s&&simplify(e,s,n,o))}function getSqSegDist(e,r,n,o,s,l){var h,d=s-n,y=l-o;return d===0&&y===0||(1<(h=((e-n)*d+(r-o)*y)/(d*d+y*y))?(n=s,o=l):0<h&&(n+=d*h,o+=y*h)),(d=e-n)*d+(y=r-o)*y}function createFeature(e,r,n,o){var s={id:e===void 0?null:e,type:r,geometry:n,tags:o,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return calcBBox(s),s}function calcBBox(e){var r=e.geometry,n=e.type;if(n==="Point"||n==="MultiPoint"||n==="LineString")calcLineBBox(e,r);else if(n==="Polygon"||n==="MultiLineString")for(var o=0;o<r.length;o++)calcLineBBox(e,r[o]);else if(n==="MultiPolygon")for(o=0;o<r.length;o++)for(var s=0;s<r[o].length;s++)calcLineBBox(e,r[o][s])}function calcLineBBox(e,r){for(var n=0;n<r.length;n+=3)e.minX=Math.min(e.minX,r[n]),e.minY=Math.min(e.minY,r[n+1]),e.maxX=Math.max(e.maxX,r[n]),e.maxY=Math.max(e.maxY,r[n+1])}function convert(e,r){var n=[];if(e.type==="FeatureCollection")for(var o=0;o<e.features.length;o++)convertFeature(n,e.features[o],r,o);else e.type==="Feature"?convertFeature(n,e,r):convertFeature(n,{geometry:e},r);return n}function convertFeature(e,r,n,o){if(r.geometry){var s=r.geometry.coordinates,l=r.geometry.type,h=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),d=[],y=r.id;if(n.promoteId?y=r.properties[n.promoteId]:n.generateId&&(y=o||0),l==="Point")convertPoint(s,d);else if(l==="MultiPoint")for(var g=0;g<s.length;g++)convertPoint(s[g],d);else if(l==="LineString")convertLine(s,d,h,!1);else if(l==="MultiLineString"){if(n.lineMetrics){for(g=0;g<s.length;g++)d=[],convertLine(s[g],d,h,!1),e.push(createFeature(y,"LineString",d,r.properties));return}convertLines(s,d,h,!1)}else if(l==="Polygon")convertLines(s,d,h,!0);else{if(l!=="MultiPolygon"){if(l!=="GeometryCollection")throw new Error("Input data is not a valid GeoJSON object.");for(g=0;g<r.geometry.geometries.length;g++)convertFeature(e,{id:y,geometry:r.geometry.geometries[g],properties:r.properties},n,o);return}for(g=0;g<s.length;g++){var v=[];convertLines(s[g],v,h,!0),d.push(v)}}e.push(createFeature(y,l,d,r.properties))}}function convertPoint(e,r){r.push(projectX(e[0])),r.push(projectY(e[1])),r.push(0)}function convertLine(e,r,n,o){for(var s,l,h=0,d=0;d<e.length;d++){var y=projectX(e[d][0]),g=projectY(e[d][1]);r.push(y),r.push(g),r.push(0),0<d&&(h+=o?(s*g-y*l)/2:Math.sqrt(Math.pow(y-s,2)+Math.pow(g-l,2))),s=y,l=g}var v=r.length-3;r[2]=1,simplify(r,0,v,n),r[2+v]=1,r.size=Math.abs(h),r.start=0,r.end=r.size}function convertLines(e,r,n,o){for(var s=0;s<e.length;s++){var l=[];convertLine(e[s],l,n,o),r.push(l)}}function projectX(e){return e/360+.5}function projectY(e){var r=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+r)/(1-r))/Math.PI;return n<0?0:1<n?1:n}function clip(e,r,n,o,s,l,h,d){if(o/=r,(n/=r)<=l&&h<o)return e;if(h<n||o<=l)return null;for(var y=[],g=0;g<e.length;g++){var v=e[g],m=v.geometry,w=v.type,I=s===0?v.minX:v.minY,V=s===0?v.maxX:v.maxY;if(n<=I&&V<o)y.push(v);else if(!(V<n||o<=I)){var q=[];if(w==="Point"||w==="MultiPoint")clipPoints(m,q,n,o,s);else if(w==="LineString")clipLine(m,q,n,o,s,!1,d.lineMetrics);else if(w==="MultiLineString")clipLines(m,q,n,o,s,!1);else if(w==="Polygon")clipLines(m,q,n,o,s,!0);else if(w==="MultiPolygon")for(var De=0;De<m.length;De++){var _n=[];clipLines(m[De],_n,n,o,s,!0),_n.length&&q.push(_n)}if(q.length){if(d.lineMetrics&&w==="LineString"){for(De=0;De<q.length;De++)y.push(createFeature(v.id,w,q[De],v.tags));continue}w!=="LineString"&&w!=="MultiLineString"||(q.length===1?(w="LineString",q=q[0]):w="MultiLineString"),w!=="Point"&&w!=="MultiPoint"||(w=q.length===3?"Point":"MultiPoint"),y.push(createFeature(v.id,w,q,v.tags))}}}return y.length?y:null}function clipPoints(e,r,n,o,s){for(var l=0;l<e.length;l+=3){var h=e[l+s];n<=h&&h<=o&&(r.push(e[l]),r.push(e[l+1]),r.push(e[l+2]))}}function clipLine(e,r,n,o,s,l,h){for(var d,y,g=newSlice(e),v=s===0?intersectX:intersectY,m=e.start,w=0;w<e.length-3;w+=3){var ga=e[w],_o=e[w+1],_l=e[w+2],I=e[w+3],V=e[w+4],q=s===0?ga:_o,De=s===0?I:V,_n=!1;h&&(d=Math.sqrt(Math.pow(ga-I,2)+Math.pow(_o-V,2))),q<n?n<De&&(y=v(g,ga,_o,I,V,n),h&&(g.start=m+d*y)):o<q?De<o&&(y=v(g,ga,_o,I,V,o),h&&(g.start=m+d*y)):addPoint(g,ga,_o,_l),De<n&&n<=q&&(y=v(g,ga,_o,I,V,n),_n=!0),o<De&&q<=o&&(y=v(g,ga,_o,I,V,o),_n=!0),!l&&_n&&(h&&(g.end=m+d*y),r.push(g),g=newSlice(e)),h&&(m+=d)}var ha=e.length-3,ga=e[ha],_o=e[ha+1],_l=e[ha+2];n<=(q=s===0?ga:_o)&&q<=o&&addPoint(g,ga,_o,_l),ha=g.length-3,l&&3<=ha&&(g[ha]!==g[0]||g[ha+1]!==g[1])&&addPoint(g,g[0],g[1],g[2]),g.length&&r.push(g)}function newSlice(e){var r=[];return r.size=e.size,r.start=e.start,r.end=e.end,r}function clipLines(e,r,n,o,s,l){for(var h=0;h<e.length;h++)clipLine(e[h],r,n,o,s,l,!1)}function addPoint(e,r,n,o){e.push(r),e.push(n),e.push(o)}function intersectX(e,r,n,o,s,l){var h=(l-r)/(o-r);return e.push(l),e.push(n+(s-n)*h),e.push(1),h}function intersectY(e,r,n,o,s,l){var h=(l-n)/(s-n);return e.push(r+(o-r)*h),e.push(l),e.push(1),h}function wrap(e,r){var n=r.buffer/r.extent,o=e,s=clip(e,1,-1-n,n,0,-1,2,r),l=clip(e,1,1-n,2+n,0,-1,2,r);return(s||l)&&(o=clip(e,1,-n,1+n,0,-1,2,r)||[],s&&(o=shiftFeatureCoords(s,1).concat(o)),l&&(o=o.concat(shiftFeatureCoords(l,-1)))),o}function shiftFeatureCoords(e,r){for(var n=[],o=0;o<e.length;o++){var s,l=e[o],h=l.type;if(h==="Point"||h==="MultiPoint"||h==="LineString")s=shiftCoords(l.geometry,r);else if(h==="MultiLineString"||h==="Polygon"){s=[];for(var d=0;d<l.geometry.length;d++)s.push(shiftCoords(l.geometry[d],r))}else if(h==="MultiPolygon")for(s=[],d=0;d<l.geometry.length;d++){for(var y=[],g=0;g<l.geometry[d].length;g++)y.push(shiftCoords(l.geometry[d][g],r));s.push(y)}n.push(createFeature(l.id,h,s,l.tags))}return n}function shiftCoords(e,r){var n=[];n.size=e.size,e.start!==void 0&&(n.start=e.start,n.end=e.end);for(var o=0;o<e.length;o+=3)n.push(e[o]+r,e[o+1],e[o+2]);return n}function transformTile(e,r){if(e.transformed)return e;for(var n,o=1<<e.z,s=e.x,l=e.y,h=0;h<e.features.length;h++){var d=e.features[h],y=d.geometry,g=d.type;if(d.geometry=[],g===1)for(n=0;n<y.length;n+=2)d.geometry.push(transformPoint(y[n],y[n+1],r,o,s,l));else for(n=0;n<y.length;n++){for(var v=[],m=0;m<y[n].length;m+=2)v.push(transformPoint(y[n][m],y[n][m+1],r,o,s,l));d.geometry.push(v)}}return e.transformed=!0,e}function transformPoint(e,r,n,o,s,l){return[Math.round(n*(e*o-s)),Math.round(n*(r*o-l))]}function createTile(e,r,n,o,s){for(var l=r===s.maxZoom?0:s.tolerance/((1<<r)*s.extent),h={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:o,z:r,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},d=0;d<e.length;d++){h.numFeatures++,addFeature(h,e[d],l,s);var y=e[d].minX,g=e[d].minY,v=e[d].maxX,m=e[d].maxY;y<h.minX&&(h.minX=y),g<h.minY&&(h.minY=g),v>h.maxX&&(h.maxX=v),m>h.maxY&&(h.maxY=m)}return h}function addFeature(e,r,n,o){var s=r.geometry,l=r.type,h=[];if(l==="Point"||l==="MultiPoint")for(var d=0;d<s.length;d+=3)h.push(s[d]),h.push(s[d+1]),e.numPoints++,e.numSimplified++;else if(l==="LineString")addLine(h,s,e,n,!1,!1);else if(l==="MultiLineString"||l==="Polygon")for(d=0;d<s.length;d++)addLine(h,s[d],e,n,l==="Polygon",d===0);else if(l==="MultiPolygon")for(var y=0;y<s.length;y++)for(var g=s[y],d=0;d<g.length;d++)addLine(h,g[d],e,n,!0,d===0);if(h.length){var v=r.tags||null;if(l==="LineString"&&o.lineMetrics){for(var m in v={},r.tags)v[m]=r.tags[m];v.mapbox_clip_start=s.start/s.size,v.mapbox_clip_end=s.end/s.size}var w={geometry:h,type:l==="Polygon"||l==="MultiPolygon"?3:l==="LineString"||l==="MultiLineString"?2:1,tags:v};r.id!==null&&(w.id=r.id),e.features.push(w)}}function addLine(e,r,n,o,s,l){var h=o*o;if(0<o&&r.size<(s?h:o))n.numPoints+=r.length/3;else{for(var d=[],y=0;y<r.length;y+=3)(o===0||r[y+2]>h)&&(n.numSimplified++,d.push(r[y]),d.push(r[y+1])),n.numPoints++;s&&rewind(d,l),e.push(d)}}function rewind(e,r){for(var n=0,o=0,s=e.length,l=s-2;o<s;l=o,o+=2)n+=(e[o]-e[l])*(e[o+1]+e[l+1]);if(0<n===r)for(o=0,s=e.length;o<s/2;o+=2){var h=e[o],d=e[o+1];e[o]=e[s-2-o],e[o+1]=e[s-1-o],e[s-2-o]=h,e[s-1-o]=d}}ArrayUtils.deepClone=function(e){return Array.isArray(e)?e.map(ArrayUtils.deepClone):e};var defaults={maxZoom:14,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1};function createGeoJsonTile(e,r,n,o,s){var l=Object.assign({},defaults,s),h=convert(e,l),d=getBBox(h=wrap(h,l)),y=d.minX,g=d.minY,v=d.maxX,m=d.maxY,w=1<<r,I=l.buffer/l.extent,V=1+I;return h=clip(h,w,n-I,n+V,0,y,v,l)||[],transformTile(createTile(h=clip(h,w,o-I,o+V,1,g,m,l)||[],r,n,o,l),l.extent)}function getBBox(e){var r,n=2,o=-1,s=1,l=0,h=_createForOfIteratorHelper(e);try{for(h.s();!(r=h.n()).done;){var d=r.value;d.minX<n&&(n=d.minX),d.maxX>o&&(o=d.maxX),d.minY<s&&(s=d.minY),d.maxY>l&&(l=d.maxY)}}catch(y){h.e(y)}finally{h.f()}return{minX:n,maxX:o,minY:s,maxY:l}}function PackingSmith(e,r){this.items=[],this.algorithm=e;var n=(r=r||{}).sort===void 0||r.sort;this.sort=n}PackingSmith.prototype={addItem:function(e){this.items.push(e)},normalizeCoordinates:function(){var e=this.items,r=1/0,n=1/0;e.forEach(function(o){var s=o;r=Math.min(r,s.x),n=Math.min(n,s.y)}),e.forEach(function(o){var s=o;s.x-=r,s.y-=n})},getStats:function(){var e=this.items.map(function(l){return l}),r=e.map(function(l){return l.x}),n=e.map(function(l){return l.y}),o=e.map(function(l){return l.x+l.width}),s=e.map(function(l){return l.y+l.height});return{minX:Math.max.apply(Math,r),minY:Math.max.apply(Math,n),maxX:Math.max.apply(Math,o),maxY:Math.max.apply(Math,s)}},getItems:function(){return this.items},processItems:function(){var e=this.items;return this.sort&&(e=this.algorithm.sort(e)),e=this.algorithm.placeItems(e),this.items=e},exportItems:function(){return this.processItems(),this.normalizeCoordinates(),this.items},export:function(){var e=this.exportItems(),r=this.getStats();return{height:r.maxY,width:r.maxX,items:e}}};var packing_smith=PackingSmith,lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,inited=!1;function init(){inited=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=0,n=e.length;r<n;++r)lookup[r]=e[r],revLookup[e.charCodeAt(r)]=r;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63}function toByteArray(e){var r,n,o,s;inited||init();var l=e.length;if(0<l%4)throw new Error("Invalid string. Length must be a multiple of 4");o=e[l-2]==="="?2:e[l-1]==="="?1:0,s=new Arr(3*l/4-o),r=0<o?l-4:l;for(var h=0,d=0;d<r;d+=4,0)n=revLookup[e.charCodeAt(d)]<<18|revLookup[e.charCodeAt(d+1)]<<12|revLookup[e.charCodeAt(d+2)]<<6|revLookup[e.charCodeAt(d+3)],s[h++]=n>>16&255,s[h++]=n>>8&255,s[h++]=255&n;return o==2?(n=revLookup[e.charCodeAt(d)]<<2|revLookup[e.charCodeAt(d+1)]>>4,s[h++]=255&n):o==1&&(n=revLookup[e.charCodeAt(d)]<<10|revLookup[e.charCodeAt(d+1)]<<4|revLookup[e.charCodeAt(d+2)]>>2,s[h++]=n>>8&255,s[h++]=255&n),s}function tripletToBase64(e){return lookup[e>>18&63]+lookup[e>>12&63]+lookup[e>>6&63]+lookup[63&e]}function encodeChunk(e,r,n){for(var o,s=[],l=r;l<n;l+=3)o=(e[l]<<16)+(e[l+1]<<8)+e[l+2],s.push(tripletToBase64(o));return s.join("")}function fromByteArray(e){var r;inited||init();for(var n=e.length,o=n%3,s="",l=[],h=0,d=n-o;h<d;h+=16383)l.push(encodeChunk(e,h,d<h+16383?d:h+16383));return o==1?(r=e[n-1],s+=lookup[r>>2],s+=lookup[r<<4&63],s+="=="):o==2&&(r=(e[n-2]<<8)+e[n-1],s+=lookup[r>>10],s+=lookup[r>>4&63],s+=lookup[r<<2&63],s+="="),l.push(s),l.join("")}function read$1(e,r,n,o,s){var l,h,d=8*s-o-1,y=(1<<d)-1,g=y>>1,v=-7,m=n?s-1:0,w=n?-1:1,I=e[r+m];for(m+=w,l=I&(1<<-v)-1,I>>=-v,v+=d;0<v;l=256*l+e[r+m],m+=w,v-=8);for(h=l&(1<<-v)-1,l>>=-v,v+=o;0<v;h=256*h+e[r+m],m+=w,v-=8);if(l===0)l=1-g;else{if(l===y)return h?NaN:1/0*(I?-1:1);h+=Math.pow(2,o),l-=g}return(I?-1:1)*h*Math.pow(2,l-o)}function write$1(e,r,n,o,s,l){var h,d,y,g=8*l-s-1,v=(1<<g)-1,m=v>>1,w=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,I=o?0:l-1,V=o?1:-1,q=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(d=isNaN(r)?1:0,h=v):(h=Math.floor(Math.log(r)/Math.LN2),r*(y=Math.pow(2,-h))<1&&(h--,y*=2),2<=(r+=1<=h+m?w/y:w*Math.pow(2,1-m))*y&&(h++,y/=2),v<=h+m?(d=0,h=v):1<=h+m?(d=(r*y-1)*Math.pow(2,s),h+=m):(d=r*Math.pow(2,m-1)*Math.pow(2,s),h=0));8<=s;e[n+I]=255&d,I+=V,d/=256,s-=8);for(h=h<<s|d,g+=s;0<g;e[n+I]=255&h,I+=V,h/=256,g-=8);e[n+I-V]|=128*q}var toString$1={}.toString,isArray=Array.isArray||function(e){return toString$1.call(e)=="[object Array]"},INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=global$1.TYPED_ARRAY_SUPPORT===void 0||global$1.TYPED_ARRAY_SUPPORT;var _kMaxLength=kMaxLength();function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(e,r){if(kMaxLength()<r)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(r)).__proto__=Buffer.prototype:(e===null&&(e=new Buffer(r)),e.length=r),e}function Buffer(e,r,n){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(e,r,n);if(typeof e!="number")return from(this,e,r,n);if(typeof r=="string")throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,e)}function from(e,r,n,o){if(typeof r=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&r instanceof ArrayBuffer?fromArrayBuffer(e,r,n,o):typeof r=="string"?fromString$1(e,r,n):fromObject(e,r)}function assertSize(e){if(typeof e!="number")throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function alloc(e,r,n,o){return assertSize(r),!(r<=0)&&n!==void 0?typeof o=="string"?createBuffer(e,r).fill(n,o):createBuffer(e,r).fill(n):createBuffer(e,r)}function allocUnsafe(e,r){if(assertSize(r),e=createBuffer(e,r<0?0:0|checked(r)),!Buffer.TYPED_ARRAY_SUPPORT)for(var n=0;n<r;++n)e[n]=0;return e}function fromString$1(e,r,n){if(typeof n=="string"&&n!==""||(n="utf8"),!Buffer.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var o=0|byteLength(r,n),s=(e=createBuffer(e,o)).write(r,n);return s!==o&&(e=e.slice(0,s)),e}function fromArrayLike(e,r){var n=r.length<0?0:0|checked(r.length);e=createBuffer(e,n);for(var o=0;o<n;o+=1)e[o]=255&r[o];return e}function fromArrayBuffer(e,r,n,o){if(r.byteLength,n<0||r.byteLength<n)throw new RangeError("'offset' is out of bounds");if(r.byteLength<n+(o||0))throw new RangeError("'length' is out of bounds");return r=n===void 0&&o===void 0?new Uint8Array(r):o===void 0?new Uint8Array(r,n):new Uint8Array(r,n,o),Buffer.TYPED_ARRAY_SUPPORT?(e=r).__proto__=Buffer.prototype:e=fromArrayLike(e,r),e}function fromObject(e,r){if(internalIsBuffer(r)){var n=0|checked(r.length);return(e=createBuffer(e,n)).length===0||r.copy(e,0,0,n),e}if(r){if(typeof ArrayBuffer<"u"&&r.buffer instanceof ArrayBuffer||"length"in r)return typeof r.length!="number"||isnan(r.length)?createBuffer(e,0):fromArrayLike(e,r);if(r.type==="Buffer"&&isArray(r.data))return fromArrayLike(e,r.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(e){if(e>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|e}function SlowBuffer(e){return+e!=e&&(e=0),Buffer.alloc(+e)}function internalIsBuffer(e){return e!=null&&e._isBuffer}function byteLength(e,r){if(internalIsBuffer(e))return e.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;typeof e!="string"&&(e=""+e);var n=e.length;if(n===0)return 0;for(var o=!1;;)switch(r){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return utf8ToBytes(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return base64ToBytes(e).length;default:if(o)return utf8ToBytes(e).length;r=(""+r).toLowerCase(),o=!0}}function slowToString(e,r,n){var o=!1;if((r===void 0||r<0)&&(r=0),r>this.length||((n===void 0||n>this.length)&&(n=this.length),n<=0)||(n>>>=0)<=(r>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":return hexSlice(this,r,n);case"utf8":case"utf-8":return utf8Slice(this,r,n);case"ascii":return asciiSlice(this,r,n);case"latin1":case"binary":return latin1Slice(this,r,n);case"base64":return base64Slice(this,r,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,r,n);default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function swap(e,r,n){var o=e[r];e[r]=e[n],e[n]=o}function bidirectionalIndexOf(e,r,n,o,s){if(e.length===0)return-1;if(typeof n=="string"?(o=n,n=0):2147483647<n?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=s?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(s)return-1;n=e.length-1}else if(n<0){if(!s)return-1;n=0}if(typeof r=="string"&&(r=Buffer.from(r,o)),internalIsBuffer(r))return r.length===0?-1:arrayIndexOf$1(e,r,n,o,s);if(typeof r=="number")return r&=255,Buffer.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?s?Uint8Array.prototype.indexOf.call(e,r,n):Uint8Array.prototype.lastIndexOf.call(e,r,n):arrayIndexOf$1(e,[r],n,o,s);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf$1(e,r,n,o,s){var l=1,h=e.length,d=r.length;if(o!==void 0&&((o=String(o).toLowerCase())==="ucs2"||o==="ucs-2"||o==="utf16le"||o==="utf-16le")){if(e.length<2||r.length<2)return-1;h/=l=2,d/=2,n/=2}function y(I,V){return l===1?I[V]:I.readUInt16BE(V*l)}if(s)for(var g=-1,v=n;v<h;v++)if(y(e,v)===y(r,g===-1?0:v-g)){if(g===-1&&(g=v),v-g+1===d)return g*l}else g!==-1&&(v-=v-g),g=-1;else for(h<n+d&&(n=h-d),v=n;0<=v;v--){for(var m=!0,w=0;w<d;w++)if(y(e,v+w)!==y(r,w)){m=!1;break}if(m)return v}return-1}function hexWrite(e,r,n,o){n=Number(n)||0;var s=e.length-n;(!o||s<(o=Number(o)))&&(o=s);var l=r.length;if(l%2!=0)throw new TypeError("Invalid hex string");l/2<o&&(o=l/2);for(var h=0;h<o;++h){var d=parseInt(r.substr(2*h,2),16);if(isNaN(d))return h;e[n+h]=d}return h}function utf8Write(e,r,n,o){return blitBuffer(utf8ToBytes(r,e.length-n),e,n,o)}function asciiWrite(e,r,n,o){return blitBuffer(asciiToBytes(r),e,n,o)}function latin1Write(e,r,n,o){return asciiWrite(e,r,n,o)}function base64Write(e,r,n,o){return blitBuffer(base64ToBytes(r),e,n,o)}function ucs2Write(e,r,n,o){return blitBuffer(utf16leToBytes(r,e.length-n),e,n,o)}function base64Slice(e,r,n){return r===0&&n===e.length?fromByteArray(e):fromByteArray(e.slice(r,n))}function utf8Slice(e,r,n){n=Math.min(e.length,n);for(var o=[],s=r;s<n;){var l,h,d,y,g=e[s],v=null,m=239<g?4:223<g?3:191<g?2:1;if(s+m<=n)switch(m){case 1:g<128&&(v=g);break;case 2:(192&(l=e[s+1]))==128&&127<(y=(31&g)<<6|63&l)&&(v=y);break;case 3:l=e[s+1],h=e[s+2],(192&l)==128&&(192&h)==128&&2047<(y=(15&g)<<12|(63&l)<<6|63&h)&&(y<55296||57343<y)&&(v=y);break;case 4:l=e[s+1],h=e[s+2],d=e[s+3],(192&l)==128&&(192&h)==128&&(192&d)==128&&65535<(y=(15&g)<<18|(63&l)<<12|(63&h)<<6|63&d)&&y<1114112&&(v=y)}v===null?(v=65533,m=1):65535<v&&(v-=65536,o.push(v>>>10&1023|55296),v=56320|1023&v),o.push(v),s+=m}return decodeCodePointsArray(o)}Buffer.poolSize=8192,Buffer._augment=function(e){return e.__proto__=Buffer.prototype,e},Buffer.from=function(e,r,n){return from(null,e,r,n)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array),Buffer.alloc=function(e,r,n){return alloc(null,e,r,n)},Buffer.allocUnsafe=function(e){return allocUnsafe(null,e)},Buffer.allocUnsafeSlow=function(e){return allocUnsafe(null,e)},Buffer.isBuffer=isBuffer,Buffer.compare=function(e,r){if(!internalIsBuffer(e)||!internalIsBuffer(r))throw new TypeError("Arguments must be Buffers");if(e===r)return 0;for(var n=e.length,o=r.length,s=0,l=Math.min(n,o);s<l;++s)if(e[s]!==r[s]){n=e[s],o=r[s];break}return n<o?-1:o<n?1:0},Buffer.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(e,r){if(!isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return Buffer.alloc(0);if(r===void 0)for(s=r=0;s<e.length;++s)r+=e[s].length;for(var n=Buffer.allocUnsafe(r),o=0,s=0;s<e.length;++s){var l=e[s];if(!internalIsBuffer(l))throw new TypeError('"list" argument must be an Array of Buffers');l.copy(n,o),o+=l.length}return n},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<e;r+=2)swap(this,r,r+1);return this},Buffer.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<e;r+=4)swap(this,r,r+3),swap(this,r+1,r+2);return this},Buffer.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<e;r+=8)swap(this,r,r+7),swap(this,r+1,r+6),swap(this,r+2,r+5),swap(this,r+3,r+4);return this},Buffer.prototype.toString=function(){var e=0|this.length;return e==0?"":arguments.length===0?utf8Slice(this,0,e):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(e){if(!internalIsBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||Buffer.compare(this,e)===0},Buffer.prototype.inspect=function(){var e="",r=INSPECT_MAX_BYTES;return 0<this.length&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},Buffer.prototype.compare=function(e,r,n,o,s){if(!internalIsBuffer(e))throw new TypeError("Argument must be a Buffer");if(r===void 0&&(r=0),n===void 0&&(n=e?e.length:0),o===void 0&&(o=0),s===void 0&&(s=this.length),r<0||n>e.length||o<0||s>this.length)throw new RangeError("out of range index");if(s<=o&&n<=r)return 0;if(s<=o)return-1;if(n<=r)return 1;if(this===e)return 0;for(var l=(s>>>=0)-(o>>>=0),h=(n>>>=0)-(r>>>=0),d=Math.min(l,h),y=this.slice(o,s),g=e.slice(r,n),v=0;v<d;++v)if(y[v]!==g[v]){l=y[v],h=g[v];break}return l<h?-1:h<l?1:0},Buffer.prototype.includes=function(e,r,n){return this.indexOf(e,r,n)!==-1},Buffer.prototype.indexOf=function(e,r,n){return bidirectionalIndexOf(this,e,r,n,!0)},Buffer.prototype.lastIndexOf=function(e,r,n){return bidirectionalIndexOf(this,e,r,n,!1)},Buffer.prototype.write=function(e,r,n,o){if(r===void 0)o="utf8",n=this.length,r=0;else if(n===void 0&&typeof r=="string")o=r,n=this.length,r=0;else{if(!isFinite(r))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");r|=0,isFinite(n)?(n|=0,o===void 0&&(o="utf8")):(o=n,n=void 0)}var s=this.length-r;if((n===void 0||s<n)&&(n=s),0<e.length&&(n<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");o=o||"utf8";for(var l=!1;;)switch(o){case"hex":return hexWrite(this,e,r,n);case"utf8":case"utf-8":return utf8Write(this,e,r,n);case"ascii":return asciiWrite(this,e,r,n);case"latin1":case"binary":return latin1Write(this,e,r,n);case"base64":return base64Write(this,e,r,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,e,r,n);default:if(l)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),l=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(e){var r=e.length;if(r<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,e);for(var n="",o=0;o<r;)n+=String.fromCharCode.apply(String,e.slice(o,o+=MAX_ARGUMENTS_LENGTH));return n}function asciiSlice(e,r,n){var o="";n=Math.min(e.length,n);for(var s=r;s<n;++s)o+=String.fromCharCode(127&e[s]);return o}function latin1Slice(e,r,n){var o="";n=Math.min(e.length,n);for(var s=r;s<n;++s)o+=String.fromCharCode(e[s]);return o}function hexSlice(e,r,n){var o=e.length;(!r||r<0)&&(r=0),(!n||n<0||o<n)&&(n=o);for(var s="",l=r;l<n;++l)s+=toHex(e[l]);return s}function utf16leSlice(e,r,n){for(var o=e.slice(r,n),s="",l=0;l<o.length;l+=2)s+=String.fromCharCode(o[l]+256*o[l+1]);return s}function checkOffset(e,r,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(n<e+r)throw new RangeError("Trying to access beyond buffer length")}function checkInt(e,r,n,o,s,l){if(!internalIsBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(s<r||r<l)throw new RangeError('"value" argument is out of bounds');if(n+o>e.length)throw new RangeError("Index out of range")}function objectWriteUInt16(e,r,n,o){r<0&&(r=65535+r+1);for(var s=0,l=Math.min(e.length-n,2);s<l;++s)e[n+s]=(r&255<<8*(o?s:1-s))>>>8*(o?s:1-s)}function objectWriteUInt32(e,r,n,o){r<0&&(r=4294967295+r+1);for(var s=0,l=Math.min(e.length-n,4);s<l;++s)e[n+s]=r>>>8*(o?s:3-s)&255}function checkIEEE754(e,r,n,o,s,l){if(n+o>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function writeFloat(e,r,n,o,s){return s||checkIEEE754(e,r,n,4),write$1(e,r,n,o,23,4),n+4}function writeDouble(e,r,n,o,s){return s||checkIEEE754(e,r,n,8),write$1(e,r,n,o,52,8),n+8}Buffer.prototype.slice=function(e,r){var n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):n<e&&(e=n),(r=r===void 0?n:~~r)<0?(r+=n)<0&&(r=0):n<r&&(r=n),r<e&&(r=e),Buffer.TYPED_ARRAY_SUPPORT)(s=this.subarray(e,r)).__proto__=Buffer.prototype;else for(var o=r-e,s=new Buffer(o,void 0),l=0;l<o;++l)s[l]=this[l+e];return s},Buffer.prototype.readUIntLE=function(e,r,n){e|=0,r|=0,n||checkOffset(e,r,this.length);for(var o=this[e],s=1,l=0;++l<r&&(s*=256);)o+=this[e+l]*s;return o},Buffer.prototype.readUIntBE=function(e,r,n){e|=0,r|=0,n||checkOffset(e,r,this.length);for(var o=this[e+--r],s=1;0<r&&(s*=256);)o+=this[e+--r]*s;return o},Buffer.prototype.readUInt8=function(e,r){return r||checkOffset(e,1,this.length),this[e]},Buffer.prototype.readUInt16LE=function(e,r){return r||checkOffset(e,2,this.length),this[e]|this[e+1]<<8},Buffer.prototype.readUInt16BE=function(e,r){return r||checkOffset(e,2,this.length),this[e]<<8|this[e+1]},Buffer.prototype.readUInt32LE=function(e,r){return r||checkOffset(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Buffer.prototype.readUInt32BE=function(e,r){return r||checkOffset(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Buffer.prototype.readIntLE=function(e,r,n){e|=0,r|=0,n||checkOffset(e,r,this.length);for(var o=this[e],s=1,l=0;++l<r&&(s*=256);)o+=this[e+l]*s;return(s*=128)<=o&&(o-=Math.pow(2,8*r)),o},Buffer.prototype.readIntBE=function(e,r,n){e|=0,r|=0,n||checkOffset(e,r,this.length);for(var o=r,s=1,l=this[e+--o];0<o&&(s*=256);)l+=this[e+--o]*s;return(s*=128)<=l&&(l-=Math.pow(2,8*r)),l},Buffer.prototype.readInt8=function(e,r){return r||checkOffset(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Buffer.prototype.readInt16LE=function(e,r){r||checkOffset(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},Buffer.prototype.readInt16BE=function(e,r){r||checkOffset(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},Buffer.prototype.readInt32LE=function(e,r){return r||checkOffset(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Buffer.prototype.readInt32BE=function(e,r){return r||checkOffset(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Buffer.prototype.readFloatLE=function(e,r){return r||checkOffset(e,4,this.length),read$1(this,e,!0,23,4)},Buffer.prototype.readFloatBE=function(e,r){return r||checkOffset(e,4,this.length),read$1(this,e,!1,23,4)},Buffer.prototype.readDoubleLE=function(e,r){return r||checkOffset(e,8,this.length),read$1(this,e,!0,52,8)},Buffer.prototype.readDoubleBE=function(e,r){return r||checkOffset(e,8,this.length),read$1(this,e,!1,52,8)},Buffer.prototype.writeUIntLE=function(e,r,n,o){e=+e,r|=0,n|=0,o||checkInt(this,e,r,n,Math.pow(2,8*n)-1,0);var s=1,l=0;for(this[r]=255&e;++l<n&&(s*=256);)this[r+l]=e/s&255;return r+n},Buffer.prototype.writeUIntBE=function(e,r,n,o){e=+e,r|=0,n|=0,o||checkInt(this,e,r,n,Math.pow(2,8*n)-1,0);var s=n-1,l=1;for(this[r+s]=255&e;0<=--s&&(l*=256);)this[r+s]=e/l&255;return r+n},Buffer.prototype.writeUInt8=function(e,r,n){return e=+e,r|=0,n||checkInt(this,e,r,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[r]=255&e,r+1},Buffer.prototype.writeUInt16LE=function(e,r,n){return e=+e,r|=0,n||checkInt(this,e,r,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=255&e,this[r+1]=e>>>8):objectWriteUInt16(this,e,r,!0),r+2},Buffer.prototype.writeUInt16BE=function(e,r,n){return e=+e,r|=0,n||checkInt(this,e,r,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=e>>>8,this[r+1]=255&e):objectWriteUInt16(this,e,r,!1),r+2},Buffer.prototype.writeUInt32LE=function(e,r,n){return e=+e,r|=0,n||checkInt(this,e,r,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[r+3]=e>>>24,this[r+2]=e>>>16,this[r+1]=e>>>8,this[r]=255&e):objectWriteUInt32(this,e,r,!0),r+4},Buffer.prototype.writeUInt32BE=function(e,r,n){return e=+e,r|=0,n||checkInt(this,e,r,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=255&e):objectWriteUInt32(this,e,r,!1),r+4},Buffer.prototype.writeIntLE=function(e,r,n,o){var s;e=+e,r|=0,o||checkInt(this,e,r,n,(s=Math.pow(2,8*n-1))-1,-s);var l=0,h=1,d=0;for(this[r]=255&e;++l<n&&(h*=256);)e<0&&d===0&&this[r+l-1]!==0&&(d=1),this[r+l]=(e/h>>0)-d&255;return r+n},Buffer.prototype.writeIntBE=function(e,r,n,o){var s;e=+e,r|=0,o||checkInt(this,e,r,n,(s=Math.pow(2,8*n-1))-1,-s);var l=n-1,h=1,d=0;for(this[r+l]=255&e;0<=--l&&(h*=256);)e<0&&d===0&&this[r+l+1]!==0&&(d=1),this[r+l]=(e/h>>0)-d&255;return r+n},Buffer.prototype.writeInt8=function(e,r,n){return e=+e,r|=0,n||checkInt(this,e,r,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[r]=255&e,r+1},Buffer.prototype.writeInt16LE=function(e,r,n){return e=+e,r|=0,n||checkInt(this,e,r,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=255&e,this[r+1]=e>>>8):objectWriteUInt16(this,e,r,!0),r+2},Buffer.prototype.writeInt16BE=function(e,r,n){return e=+e,r|=0,n||checkInt(this,e,r,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=e>>>8,this[r+1]=255&e):objectWriteUInt16(this,e,r,!1),r+2},Buffer.prototype.writeInt32LE=function(e,r,n){return e=+e,r|=0,n||checkInt(this,e,r,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=255&e,this[r+1]=e>>>8,this[r+2]=e>>>16,this[r+3]=e>>>24):objectWriteUInt32(this,e,r,!0),r+4},Buffer.prototype.writeInt32BE=function(e,r,n){return e=+e,r|=0,n||checkInt(this,e,r,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=255&e):objectWriteUInt32(this,e,r,!1),r+4},Buffer.prototype.writeFloatLE=function(e,r,n){return writeFloat(this,e,r,!0,n)},Buffer.prototype.writeFloatBE=function(e,r,n){return writeFloat(this,e,r,!1,n)},Buffer.prototype.writeDoubleLE=function(e,r,n){return writeDouble(this,e,r,!0,n)},Buffer.prototype.writeDoubleBE=function(e,r,n){return writeDouble(this,e,r,!1,n)},Buffer.prototype.copy=function(e,r,n,o){if(n=n||0,o||o===0||(o=this.length),r>=e.length&&(r=e.length),r=r||0,0<o&&o<n&&(o=n),o===n||e.length===0||this.length===0)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),e.length-r<o-n&&(o=e.length-r+n);var s,l=o-n;if(this===e&&n<r&&r<o)for(s=l-1;0<=s;--s)e[s+r]=this[s+n];else if(l<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(s=0;s<l;++s)e[s+r]=this[s+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+l),r);return l},Buffer.prototype.fill=function(e,r,n,o){if(typeof e=="string"){var s;if(typeof r=="string"?(o=r,r=0,n=this.length):typeof n=="string"&&(o=n,n=this.length),e.length!==1||(s=e.charCodeAt(0))<256&&(e=s),o!==void 0&&typeof o!="string")throw new TypeError("encoding must be a string");if(typeof o=="string"&&!Buffer.isEncoding(o))throw new TypeError("Unknown encoding: "+o)}else typeof e=="number"&&(e&=255);if(r<0||this.length<r||this.length<n)throw new RangeError("Out of range index");if(n<=r)return this;if(r>>>=0,n=n===void 0?this.length:n>>>0,typeof(e=e||0)=="number")for(d=r;d<n;++d)this[d]=e;else for(var l=internalIsBuffer(e)?e:utf8ToBytes(new Buffer(e,o).toString()),h=l.length,d=0;d<n-r;++d)this[d+r]=l[d%h];return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(e){if((e=stringtrim(e).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function stringtrim(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function toHex(e){return e<16?"0"+e.toString(16):e.toString(16)}function utf8ToBytes(e,r){var n;r=r||1/0;for(var o=e.length,s=null,l=[],h=0;h<o;++h){if(55295<(n=e.charCodeAt(h))&&n<57344){if(!s){if(56319<n){-1<(r-=3)&&l.push(239,191,189);continue}if(h+1===o){-1<(r-=3)&&l.push(239,191,189);continue}s=n;continue}if(n<56320){-1<(r-=3)&&l.push(239,191,189),s=n;continue}n=65536+(s-55296<<10|n-56320)}else s&&-1<(r-=3)&&l.push(239,191,189);if(s=null,n<128){if(--r<0)break;l.push(n)}else if(n<2048){if((r-=2)<0)break;l.push(n>>6|192,63&n|128)}else if(n<65536){if((r-=3)<0)break;l.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((r-=4)<0)break;l.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return l}function asciiToBytes(e){for(var r=[],n=0;n<e.length;++n)r.push(255&e.charCodeAt(n));return r}function utf16leToBytes(e,r){for(var n,o,s,l=[],h=0;h<e.length&&!((r-=2)<0);++h)o=(n=e.charCodeAt(h))>>8,s=n%256,l.push(s),l.push(o);return l}function base64ToBytes(e){return toByteArray(base64clean(e))}function blitBuffer(e,r,n,o){for(var s=0;s<o&&!(s+n>=r.length||s>=e.length);++s)r[s+n]=e[s];return s}function isnan(e){return e!=e}function isBuffer(e){return e!=null&&(!!e._isBuffer||isFastBuffer(e)||isSlowBuffer(e))}function isFastBuffer(e){return!!e.constructor&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}function isSlowBuffer(e){return typeof e.readFloatLE=="function"&&typeof e.slice=="function"&&isFastBuffer(e.slice(0,0))}var bufferEs6=Object.freeze({INSPECT_MAX_BYTES,kMaxLength:_kMaxLength,Buffer,SlowBuffer,isBuffer});global$1.setTimeout,global$1.clearTimeout;var performance$1=global$1.performance||{};performance$1.now||performance$1.mozNow||performance$1.msNow||performance$1.oNow||performance$1.webkitNow;var inherits,inherits=typeof Object.create=="function"?function(e,r){e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,r){e.super_=r;function n(){}n.prototype=r.prototype,e.prototype=new n,e.prototype.constructor=e},inherits$1=inherits;function inspect(e,r){var n={seen:[],stylize:stylizeNoColor};return 3<=arguments.length&&(n.depth=arguments[2]),4<=arguments.length&&(n.colors=arguments[3]),isBoolean(r)?n.showHidden=r:r&&_extend(n,r),isUndefined(n.showHidden)&&(n.showHidden=!1),isUndefined(n.depth)&&(n.depth=2),isUndefined(n.colors)&&(n.colors=!1),isUndefined(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=stylizeWithColor),formatValue(n,e,n.depth)}function stylizeWithColor(e,r){var n=inspect.styles[r];return n?"\x1B["+inspect.colors[n][0]+"m"+e+"\x1B["+inspect.colors[n][1]+"m":e}function stylizeNoColor(e,r){return e}function arrayToHash(e){var r={};return e.forEach(function(n,o){r[n]=!0}),r}function formatValue(e,r,n){if(e.customInspect&&r&&isFunction(r.inspect)&&r.inspect!==inspect&&(!r.constructor||r.constructor.prototype!==r)){var o=r.inspect(n,e);return isString(o)||(o=formatValue(e,o,n)),o}var s=formatPrimitive(e,r);if(s)return s;var l=Object.keys(r),h=arrayToHash(l);if(e.showHidden&&(l=Object.getOwnPropertyNames(r)),isError(r)&&(0<=l.indexOf("message")||0<=l.indexOf("description")))return formatError(r);if(l.length===0){if(isFunction(r)){var d=r.name?": "+r.name:"";return e.stylize("[Function"+d+"]","special")}if(isRegExp(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(isDate(r))return e.stylize(Date.prototype.toString.call(r),"date");if(isError(r))return formatError(r)}var y,g="",v=!1,m=["{","}"];return isArray$1(r)&&(v=!0,m=["[","]"]),isFunction(r)&&(g=" [Function"+(r.name?": "+r.name:"")+"]"),isRegExp(r)&&(g=" "+RegExp.prototype.toString.call(r)),isDate(r)&&(g=" "+Date.prototype.toUTCString.call(r)),isError(r)&&(g=" "+formatError(r)),l.length!==0||v&&r.length!=0?n<0?isRegExp(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),y=v?formatArray(e,r,n,h,l):l.map(function(w){return formatProperty(e,r,n,h,w,v)}),e.seen.pop(),reduceToSingleString(y,g,m)):m[0]+g+m[1]}function formatPrimitive(e,r){if(isUndefined(r))return e.stylize("undefined","undefined");if(isString(r)){var n="'"+JSON.stringify(r).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return isNumber(r)?e.stylize(""+r,"number"):isBoolean(r)?e.stylize(""+r,"boolean"):isNull(r)?e.stylize("null","null"):void 0}function formatError(e){return"["+Error.prototype.toString.call(e)+"]"}function formatArray(e,r,n,o,s){for(var l=[],h=0,d=r.length;h<d;++h)hasOwnProperty$1(r,String(h))?l.push(formatProperty(e,r,n,o,String(h),!0)):l.push("");return s.forEach(function(y){y.match(/^\d+$/)||l.push(formatProperty(e,r,n,o,y,!0))}),l}function formatProperty(e,r,n,o,s,l){var h,d,y=Object.getOwnPropertyDescriptor(r,s)||{value:r[s]};if(y.get?d=y.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):y.set&&(d=e.stylize("[Setter]","special")),hasOwnProperty$1(o,s)||(h="["+s+"]"),d||(e.seen.indexOf(y.value)<0?-1<(d=isNull(n)?formatValue(e,y.value,null):formatValue(e,y.value,n-1)).indexOf(`
`)&&(d=l?d.split(`
`).map(function(g){return"  "+g}).join(`
`).substr(2):`
`+d.split(`
`).map(function(g){return"   "+g}).join(`
`)):d=e.stylize("[Circular]","special")),isUndefined(h)){if(l&&s.match(/^\d+$/))return d;h=(h=JSON.stringify(""+s)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(h=h.substr(1,h.length-2),e.stylize(h,"name")):(h=h.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),e.stylize(h,"string"))}return h+": "+d}function reduceToSingleString(e,r,n){return 60<e.reduce(function(o,s){return s.indexOf(`
`),o+s.replace(/\u001b\[\d\d?m/g,"").length+1},0)?n[0]+(r===""?"":r+`
 `)+" "+e.join(`,
  `)+" "+n[1]:n[0]+r+" "+e.join(", ")+" "+n[1]}function isArray$1(e){return Array.isArray(e)}function isBoolean(e){return typeof e=="boolean"}function isNull(e){return e===null}function isNumber(e){return typeof e=="number"}function isString(e){return typeof e=="string"}function isUndefined(e){return e===void 0}function isRegExp(e){return isObject$1(e)&&objectToString$1(e)==="[object RegExp]"}function isObject$1(e){return typeof e=="object"&&e!==null}function isDate(e){return isObject$1(e)&&objectToString$1(e)==="[object Date]"}function isError(e){return isObject$1(e)&&(objectToString$1(e)==="[object Error]"||e instanceof Error)}function isFunction(e){return typeof e=="function"}function isPrimitive(e){return e===null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||typeof e=="symbol"||e===void 0}function objectToString$1(e){return Object.prototype.toString.call(e)}function _extend(e,r){if(!r||!isObject$1(r))return e;for(var n=Object.keys(r),o=n.length;o--;)e[n[o]]=r[n[o]];return e}function hasOwnProperty$1(e,r){return Object.prototype.hasOwnProperty.call(e,r)}function compare(e,r){if(e===r)return 0;for(var n=e.length,o=r.length,s=0,l=Math.min(n,o);s<l;++s)if(e[s]!==r[s]){n=e[s],o=r[s];break}return n<o?-1:o<n?1:0}inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var hasOwn=Object.prototype.hasOwnProperty,objectKeys$1=Object.keys||function(e){var r=[];for(var n in e)hasOwn.call(e,n)&&r.push(n);return r},pSlice=Array.prototype.slice,_functionsHaveNames;function functionsHaveNames(){return _functionsHaveNames!==void 0?_functionsHaveNames:_functionsHaveNames=(function(){}).name==="foo"}function pToString(e){return Object.prototype.toString.call(e)}function isView(e){if(!isBuffer(e)&&typeof global$1.ArrayBuffer=="function"){if(typeof ArrayBuffer.isView=="function")return ArrayBuffer.isView(e);if(e)return e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)}}function assert(e,r){e||fail(e,!0,r,"==",ok)}var regex=/\s*function\s+([^\(\s]*)\s*/;function getName(e){if(isFunction(e)){if(functionsHaveNames())return e.name;var r=e.toString().match(regex);return r&&r[1]}}function AssertionError(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=getMessage(this),this.generatedMessage=!0);var r,n,o,s,l,h=e.stackStartFunction||fail;Error.captureStackTrace?Error.captureStackTrace(this,h):(r=new Error).stack&&(l=r.stack,n=getName(h),0<=(o=l.indexOf(`
`+n))&&(s=l.indexOf(`
`,o+1),l=l.substring(s+1)),this.stack=l)}function truncate(e,r){return typeof e!="string"||e.length<r?e:e.slice(0,r)}function inspect$1(e){if(functionsHaveNames()||!isFunction(e))return inspect(e);var r=getName(e);return"[Function"+(r?": "+r:"")+"]"}function getMessage(e){return truncate(inspect$1(e.actual),128)+" "+e.operator+" "+truncate(inspect$1(e.expected),128)}function fail(e,r,n,o,s){throw new AssertionError({message:n,actual:e,expected:r,operator:o,stackStartFunction:s})}function ok(e,r){e||fail(e,!0,r,"==",ok)}function equal(e,r,n){e!=r&&fail(e,r,n,"==",equal)}function notEqual(e,r,n){e==r&&fail(e,r,n,"!=",notEqual)}function deepEqual(e,r,n){_deepEqual(e,r,!1)||fail(e,r,n,"deepEqual",deepEqual)}function deepStrictEqual(e,r,n){_deepEqual(e,r,!0)||fail(e,r,n,"deepStrictEqual",deepStrictEqual)}function _deepEqual(e,r,n,o){if(e===r)return!0;if(isBuffer(e)&&isBuffer(r))return compare(e,r)===0;if(isDate(e)&&isDate(r))return e.getTime()===r.getTime();if(isRegExp(e)&&isRegExp(r))return e.source===r.source&&e.global===r.global&&e.multiline===r.multiline&&e.lastIndex===r.lastIndex&&e.ignoreCase===r.ignoreCase;if(e!==null&&typeof e=="object"||r!==null&&typeof r=="object"){if(isView(e)&&isView(r)&&pToString(e)===pToString(r)&&!(e instanceof Float32Array||e instanceof Float64Array))return compare(new Uint8Array(e.buffer),new Uint8Array(r.buffer))===0;if(isBuffer(e)!==isBuffer(r))return!1;var s=(o=o||{actual:[],expected:[]}).actual.indexOf(e);return s!==-1&&s===o.expected.indexOf(r)||(o.actual.push(e),o.expected.push(r),objEquiv(e,r,n,o))}return n?e===r:e==r}function isArguments(e){return Object.prototype.toString.call(e)=="[object Arguments]"}function objEquiv(e,r,n,o){if(e==null||r==null)return!1;if(isPrimitive(e)||isPrimitive(r))return e===r;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(r))return!1;var s=isArguments(e),l=isArguments(r);if(s&&!l||!s&&l)return!1;if(s)return _deepEqual(e=pSlice.call(e),r=pSlice.call(r),n);var h,d,y=objectKeys$1(e),g=objectKeys$1(r);if(y.length!==g.length)return!1;for(y.sort(),g.sort(),d=y.length-1;0<=d;d--)if(y[d]!==g[d])return!1;for(d=y.length-1;0<=d;d--)if(!_deepEqual(e[h=y[d]],r[h],n,o))return!1;return!0}function notDeepEqual(e,r,n){_deepEqual(e,r,!1)&&fail(e,r,n,"notDeepEqual",notDeepEqual)}function notDeepStrictEqual(e,r,n){_deepEqual(e,r,!0)&&fail(e,r,n,"notDeepStrictEqual",notDeepStrictEqual)}function strictEqual(e,r,n){e!==r&&fail(e,r,n,"===",strictEqual)}function notStrictEqual(e,r,n){e===r&&fail(e,r,n,"!==",notStrictEqual)}function expectedException(e,r){if(e&&r){if(Object.prototype.toString.call(r)=="[object RegExp]")return r.test(e);try{if(e instanceof r)return 1}catch{}if(!Error.isPrototypeOf(r))return r.call({},e)===!0}}function _tryBlock(e){var r;try{e()}catch(n){r=n}return r}function _throws(e,r,n,o){var s;if(typeof r!="function")throw new TypeError('"block" argument must be a function');typeof n=="string"&&(o=n,n=null),s=_tryBlock(r),o=(n&&n.name?" ("+n.name+").":".")+(o?" "+o:"."),e&&!s&&fail(s,n,"Missing expected exception"+o);var l=typeof o=="string",h=!e&&s&&!n;if((!e&&isError(s)&&l&&expectedException(s,n)||h)&&fail(s,n,"Got unwanted exception"+o),e&&s&&n&&!expectedException(s,n)||!e&&s)throw s}function throws(e,r,n){_throws(!0,e,r,n)}function doesNotThrow(e,r,n){_throws(!1,e,r,n)}function ifError(e){if(e)throw e}assert.AssertionError=AssertionError,inherits$1(AssertionError,Error),assert.fail=fail,assert.ok=ok,assert.equal=equal,assert.notEqual=notEqual,assert.deepEqual=deepEqual,assert.deepStrictEqual=deepStrictEqual,assert.notDeepEqual=notDeepEqual,assert.notDeepStrictEqual=notDeepStrictEqual,assert.strictEqual=strictEqual,assert.notStrictEqual=notStrictEqual,assert.throws=throws,assert.doesNotThrow=doesNotThrow,assert.ifError=ifError;var sort=function(e){return e.sort(function(r,n){return r.height-n.height}),e},placeItems=function(e){var r=0;return e.forEach(function(n){n.x=0,n.y=r,r+=n.height}),e},topDown_algorithm={sort,placeItems},sort$1=function(e){return e.sort(function(r,n){return r.width-n.width}),e},placeItems$1=function(e){var r=0;return e.forEach(function(n){n.x=r,n.y=0,r+=n.width}),e},leftRight_algorithm={sort:sort$1,placeItems:placeItems$1},sort$2=function(e){return e.sort(function(r,n){return Math.sqrt(Math.pow(r.height,2)+Math.pow(r.width,2))-Math.sqrt(Math.pow(n.height,2)+Math.pow(n.width,2))}),e},placeItems$2=function(e){var r=0,n=0;return e.forEach(function(o){o.x=r,o.y=n,r+=o.width,n+=o.height}),e},diagonal_algorithm={sort:sort$2,placeItems:placeItems$2},sort$3=function(e){return e.sort(function(r,n){return Math.sqrt(Math.pow(r.height,2)+Math.pow(r.width,2))-Math.sqrt(Math.pow(n.height,2)+Math.pow(n.width,2))}),e},placeItems$3=function(e){var r=0,n=0;return e.forEach(function(o){var s=o.width;o.x=r-s,o.y=n,r-=s,n+=o.height}),e},altDiagonal_algorithm={sort:sort$3,placeItems:placeItems$3},GrowingPacker=function(){};GrowingPacker.prototype={fit:function(e){var r,n,o,s,l=e.length,h=0<l?e[0].width:0,d=0<l?e[0].height:0;for(this.root={x:0,y:0,width:h,height:d},r=0;r<l;r++)o=e[r],s=(n=this.findNode(this.root,o.width,o.height))?this.splitNode(n,o.width,o.height):this.growNode(o.width,o.height),o.x=s.x,o.y=s.y},findNode:function(e,r,n){return e.used?this.findNode(e.right,r,n)||this.findNode(e.down,r,n):r<=e.width&&n<=e.height?e:null},splitNode:function(e,r,n){return e.used=!0,e.down={x:e.x,y:e.y+n,width:e.width,height:e.height-n},e.right={x:e.x+r,y:e.y,width:e.width-r,height:n},e},growNode:function(e,r){var n=e<=this.root.width,o=r<=this.root.height,s=o&&this.root.height>=this.root.width+e,l=n&&this.root.width>=this.root.height+r;return s?this.growRight(e,r):l?this.growDown(e,r):o?this.growRight(e,r):n?this.growDown(e,r):null},growRight:function(e,r){var n;return this.root={used:!0,x:0,y:0,width:this.root.width+e,height:this.root.height,down:this.root,right:{x:this.root.width,y:0,width:e,height:this.root.height}},(n=this.findNode(this.root,e,r))?this.splitNode(n,e,r):null},growDown:function(e,r){var n;return this.root={used:!0,x:0,y:0,width:this.root.width,height:this.root.height+r,down:{x:0,y:this.root.height,width:this.root.width,height:r},right:this.root},(n=this.findNode(this.root,e,r))?this.splitNode(n,e,r):null}};var packer_growing=GrowingPacker,binPack=function(e,r){r=r||{};var n=new packer_growing,o=r.inPlace||!1,s=(s=e.map(function(h){return o?h:{width:h.width,height:h.height,item:h}})).sort(function(h,d){return d.width*d.height-h.width*h.height});n.fit(s);var l={width:s.reduce(function(h,d){return Math.max(h,d.x+d.width)},0),height:s.reduce(function(h,d){return Math.max(h,d.y+d.height)},0)};return o||(l.items=s),l},sort$4=function(e){return e},placeItems$4=function(e){return binPack(e,{inPlace:!0}),e},binaryTree_algorithm={sort:sort$4,placeItems:placeItems$4},algorithms={};function Layout(e,r){var n=e||"top-down";return typeof n=="string"&&assert(n=algorithms[e],"Sorry, the '"+e+"' algorithm could not be loaded."),new packing_smith(n,r)}function addAlgorithm(e,r){algorithms[e]=r}Layout.PackingSmith=packing_smith,Layout.addAlgorithm=addAlgorithm,Layout.algorithms=algorithms,addAlgorithm("top-down",topDown_algorithm),addAlgorithm("left-right",leftRight_algorithm),addAlgorithm("diagonal",diagonal_algorithm),addAlgorithm("alt-diagonal",altDiagonal_algorithm),addAlgorithm("binary-tree",binaryTree_algorithm);var layout=Layout;function isTainting(e){var r;try{e.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,1,1)}catch(n){r=n.message}return r}function bitmapToCanvas(e,r,n){var o;return e instanceof HTMLImageElement&&((o=e.ownerDocument.createElement("canvas")).width=r,o.height=n,o.getContext("2d").drawImage(e,0,0,r,n),e=o),e}var MAX_LNG_LAT=Geo$1.metersToLatLng([Geo$1.half_circumference_meters,Geo$1.half_circumference_meters]),TILE_EXPONENT=Math.log(Geo$1.tile_size)/Math.LN2,ICON_READY=1,DOM_MARKER_TYPE=8,GROUP_TYPE=16,TILE_MARGIN=100,AFFECTED_BBOX_CALC_THRESHOLD=10,ObjectSource=function(){_inherits(r,MapsJsSource);var e=_createSuper(r);function r(n,o){var s;return _classCallCheck(this,r),s=e.call(this,n,o),Thread.is_worker&&(s._quad_tree=new ns.H.geo.QuadTree,s._marker_quad_tree=new ns.H.geo.QuadTree,s._tree_entries_by_object_id={},s._groups_by_id={},s._layersCache=new ns.H.util.Cache(100)),Thread.is_main&&(s._objects_by_id={},s._commands=[],s._sendCommands=debounce(s._sendCommands,100,200),s.dispatchUpdate=s.dispatchUpdate.bind(_assertThisInitialized(s))),s}return _createClass(r,[{key:"hasLabeledData",value:function(){return!1}},{key:"onReady",value:function(){this._synced_at=this.provider.getInvalidations().getMark();var n,o,s=this.provider.getRootGroup(),l=s.getObjects(!0),h=[];for(l.push(s),n=l.length;n--;)o=l[n],this._isObjectSupported(o)&&this._shouldBeStored(o)&&(this._objects_by_id[o.getId()]=o,h.push(o.forWorkerMessage()));var d=[{method_name:"addObjects",arguments:[h]}];this._sendImmediateCommands(d)}},{key:"onProviderUpdate",value:function(n){var o,s,l,h,d=n.target,y=n.currentTarget.getInvalidations(d.type);this._isObjectSupported(d)&&(o=this._synced_at,s=d.getId(),y.isRemove(o)?(delete this._objects_by_id[s],this._commands.push({method_name:"removeObjectsByIds",arguments:[[s],!0]})):y.isAdd(o)?this._shouldBeStored(d)&&(this._objects_by_id[s]=d,this._commands.push({method_name:"addObjects",arguments:[[d.forWorkerMessage()]]})):y.isSpatial(o)||y.isZOrder(o)?this._shouldBeStored(d)&&(l=[{method_name:"removeObjectsByIds",arguments:[[s],!0]},{method_name:"addObjects",arguments:[[(this._objects_by_id[s]=d).forWorkerMessage()]]}],this.has_volatile_data&&!this.hasPendingCommands()?this._sendImmediateCommands(l):this._commands.push(l[0],l[1])):y.isVisual(o)?this._shouldBeStored(d)&&(h={method_name:"updateObjectProperties",arguments:[(this._objects_by_id[s]=d).forWorkerMessage()]},this.has_volatile_data&&!this.hasPendingCommands()?this._sendImmediateCommands([h]):this._commands.push(h)):y.isVolatility(o)&&(delete this._objects_by_id[s],this._commands.push({method_name:"removeObjectsByIds",arguments:[[s],!0]}),this._shouldBeStored(d)&&(this._objects_by_id[s]=d,this._commands.push({method_name:"addObjects",arguments:[[d.forWorkerMessage()]]}))),this._commands.length&&this._sendCommands()),this._synced_at=y.getMark()}},{key:"_shouldBeStored",value:function(n){return n.type===GROUP_TYPE||(!n.getIcon||n.getIcon().getState()===ICON_READY)&&this._hasSameVolatility(n)}},{key:"_hasSameVolatility",value:function(n){return n.getVolatility(!0)===this.has_volatile_data}},{key:"hasPendingCommands",value:function(){return 0<this._commands.length}},{key:"_sendCommands",value:function(){this._sendImmediateCommands(this._commands),this._commands=[]}},{key:"_sendImmediateCommands",value:function(n){n.length&&WorkerBroker.postMessage(this.worker,this.target_name+".executeCommands",n).then(this.dispatchUpdate)}},{key:"_isObjectSupported",value:function(n){return n.forWorkerMessage&&n.type!==DOM_MARKER_TYPE}},{key:"getSyncedAt",value:function(){return this._synced_at}},{key:"getMapObjectById",value:function(n){return this._objects_by_id[n]}},{key:"getIconBitmapByObjectId",value:function(n,o){var s=this.getMapObjectById(n);if(s){var l=s.getIcon();if(l.uid===o&&l.getState()===ICON_READY){var h=l.getSize();return bitmapToCanvas(l.getBitmap(),h.w,h.h)}}}},{key:"_getRastersForMarkers",value:function(n){for(var o={},s=layout("binary-tree"),l=0;l<n.length;l++){var h=n[l],d=h.properties.icon;o[d.id]||(s.addItem({width:d.size.w,height:d.size.h,meta:{objectId:h.id,id:d.id}}),o[d.id]=!0)}return s.export()}},{key:"fetchFeaturesForTile",value:function(n){var o=[],s=[],l=[],h=[],d=[],y=this._marker_quad_tree.intersectBoundingBox(Geo$1.getTileBoundingBox(n.coords,this.tile_size));n.source_data.error=null;for(var g=0;g<y.length;g++){var v={id:y[g].$feature$.id,properties:Object.assign({},y[g].$feature$.properties),geometry:{type:y[g].$feature$.geometry.type,coordinates:ArrayUtils$1.deepClone(y[g].$feature$.geometry.coordinates)}};o.push(v)}y=this._quad_tree.intersectBoundingBox(Geo$1.getTileBoundingBox(n.coords,this.tile_size,TILE_MARGIN));for(var m=0;m<y.length;m++){var w,I={id:y[m].$feature$.id,properties:Object.assign({},y[m].$feature$.properties),geometry:{type:y[m].$feature$.geometry.type,coordinates:ArrayUtils$1.deepClone(y[m].$feature$.geometry.coordinates)}};I.properties.overlay?s.push(I):I.geometry.type.includes("LineString")?l.push(I):I.geometry.type.includes("Polygon")&&(h.push(I),w={id:I.id,properties:I.properties,geometry:{type:I.geometry.type,coordinates:ArrayUtils$1.deepClone(I.geometry.coordinates)}},d.push(w))}o.sort(r._compareZInfo),h.sort(r._compareZInfo),s.sort(r._compareZInfo);var V=this.has_volatile_data?4096:0;d.sort(r._compareZInfo);for(var q=0;q<d.length;q++)d[q].properties.effectiveZIdx=V++;l.sort(r._compareZInfo);for(var De=0;De<l.length;De++)l[De].properties.effectiveZIdx=V++;n.source_data.layers.markers={type:"FeatureCollection",features:o},n.source_data.layers.polylines={type:"FeatureCollection",features:l},n.source_data.layers.polygons={type:"FeatureCollection",features:h},n.source_data.layers.outlines={type:"FeatureCollection",features:d},n.source_data.layers.overlays={type:"FeatureCollection",features:s}}},{key:"tileTexture",value:function(n){var o=n.source_data.layers.overlays;if(o){var s=this.name+"_"+n.coords.key,l=Tile.coordinateWithMaxZoom(n.coords,this.max_zoom),h=o.features[0].properties.overlays_config;return{name:s,filtering:this.filtering,coords:l,width:Geo$1.tile_size,height:Geo$1.tile_size,overlays_config:h,source:this.name}}}},{key:"_load",value:function(n){var o=Geo$1.wrapTile(n.coords,{x:!0}),s=o.z,l=o.x,h=o.y,d="".concat(s,"_").concat(l,"_").concat(h),y=this._layersCache.get(d),g=!1;if(y)n.source_data.layers=y;else{this.fetchFeaturesForTile(n);var v={maxZoom:this.max_zoom,tolerance:1.5,extent:Geo$1.tile_scale},m=n.source_data.layers.overlays;m.features.length&&delete n.source_data.layers.overlays;var w=n.source_data.layers.markers;for(var I in w.features.length&&delete n.source_data.layers.markers,n.source_data.layers){var V,q=n.source_data.layers[I];q.features.length&&(v.buffer=I.includes("lines")?TILE_MARGIN*Geo$1.units_per_pixel:0,V=createGeoJsonTile(q,s,l,h,v),n.source_data.layers[I]=parseGeoJSONVectorTile(V))}n.source_data.layers.overlays=this._processOverlays(n,m);for(var De=n.source_data.layers.overlays.features.length;De--;)if(!n.source_data.layers.overlays.features[De].id){g=!0,this._layersCache.drop(d);break}n.source_data.layers.markers=this._processMarkers(n,w),this._postProcessTile(n),g||this._layersCache.add(d,n.source_data.layers,1)}return n.rasters=this._getRastersForMarkers(n.source_data.layers.markers.features),Promise.resolve(n)}},{key:"_processMarkers",value:function(n,o){var s=o.features.length;if(s){for(var l=Geo$1.unitsPerMeter(n.coords.z),h=Geo$1.wrapTile(n.coords,{x:!0}),d=Geo$1.metersForTile(h),y=Geo$1.isLastTile(h),g=Geo$1.wrapMeters(n.min),v=Geo$1.wrapMeters(n.max),m=function(_n){DataSource.coordsToMeters(_n);var ha=_slicedToArray(_n,2),ga=ha[0],_o=ha[1],_l=ga>=g.x&&(y.column||ga<v.x)&&_o>=v.y&&(y.row||!n.coords.y||_o<g.y);return DataSource.metersToTileUnits(l,d,_n),_l},w=[],I=0;I<s;I++){var V,q=o.features[I].geometry,De=!1;q.type==="Point"?m(V=q.coordinates)?q.coordinates=V:De=!0:q.type==="MultiPoint"&&(q.coordinates=q.coordinates.filter(m),q.coordinates.length===0&&(De=!0)),De||w.push(o.features[I])}o.features=w}return o}},{key:"_processOverlays",value:function(n,o){var s=this;if(!o.features.length)return o;var l={coords:n.coords,min:Geo$1.metersForTile(Geo$1.wrapTile(n.coords,{x:!0}))},h={coords:n.coords,source_data:{layers:{_default:{type:"FeatureCollection",features:o.features}}}},d=Math.pow(2,n.coords.z+TILE_EXPONENT);MapsJsSource.projectData(h.source_data),MapsJsSource.scaleData(h.source_data,l);var y=o.features.map(function(v){var m=v.geometry.coordinates[0],w=m[0],I=m[m.length===5?2:3],V=Math.floor(w[0]/Geo$1.tile_scale*Geo$1.tile_size),q=Math.floor(w[1]/Geo$1.tile_scale*Geo$1.tile_size),De=Math.floor(I[0]/Geo$1.tile_scale*Geo$1.tile_size),_n=Math.floor(I[1]/Geo$1.tile_scale*Geo$1.tile_size)-q,ha=De<=V,ga=ha?d-(V-De):De-V,_o=[];return V<=Geo$1.tile_size&&_o.push([V,q,ga,_n]),ha&&0<De&&_o.push([V-d,q,ga,_n]),{id:v.id,properties:v.properties,texcoords:_o}}).filter(function(v){return s._isVisible(v.properties)&&s.isInMinMaxRange(v.properties,n.style_zoom)}),g=Geo$1.tile_scale;return n.pad_scale=this.pad_scale,n.default_winding="CW",o.features=y.length?[{geometry:{type:"Polygon",coordinates:[[[0,0],[g,0],[g,g],[0,g],[0,0]]]},properties:{overlays_config:y}}]:y,o}},{key:"executeCommands",value:function(n){for(var o,s=n.length<AFFECTED_BBOX_CALC_THRESHOLD,l=0;l<n.length;l++){var h=n[l];h.arguments.push(s);var d=this[h.method_name].apply(this,h.arguments);s&&(d&&o?o.mergeRect(d,!0,o):d&&(o=d))}return o?o.forWorkerMessage():void 0}},{key:"_getClampedGeoRectForFeature",value:function(n){var o=n.geometry.boundingBox;return new ns.H.geo.Rect(MathUtils$1.clamp(o[0],-MAX_LNG_LAT[1],MAX_LNG_LAT[1]),o[1],MathUtils$1.clamp(o[2],-MAX_LNG_LAT[1],MAX_LNG_LAT[1]),o[3])}},{key:"addObjects",value:function(n,o){for(var s,l=1<arguments.length&&o!==void 0&&o,h=0;h<n.length;h++){var d,y,g,v=n[h];v.type==="Group"?(v.$children_ids$={},this._groups_by_id[v.id]=v):(r._preprocessGeometry(v.geometry),d=this._getClampedGeoRectForFeature(v),l&&(s?s.mergeRect(d,!0,s):s=d),(g=(y=v.geometry.type.indexOf("Point")!==-1?this._marker_quad_tree:this._quad_tree).insertBoundingBox(d)).$tree=y,g.$feature$=v,this._tree_entries_by_object_id[v.id]=g)}for(var m=0;m<n.length;m++){var w=n[m];w.properties.parent&&(this._groups_by_id[w.properties.parent].$children_ids$[w.id]=w.id),w.properties.ref={effectiveVisibility:this._isVisible(w.properties),zInfo:this._getZInfo([],w)}}return this._layersCache.removeAll(),s}},{key:"removeObjectsByIds",value:function(n,o,s){for(var l,h=2<arguments.length&&s!==void 0&&s,d=0;d<n.length;d++){var y,g=n[d],v=void 0,m=void 0;(v=this._tree_entries_by_object_id[g])?(h&&(y=this._getClampedGeoRectForFeature(v.$feature$),l?l.mergeRect(y,!0,l):l=y),delete this._groups_by_id[v.$feature$.properties.parent].$children_ids$[g],v.$tree.remove(v),delete this._tree_entries_by_object_id[g]):(m=this._groups_by_id[g])&&(m.properties.parent&&delete this._groups_by_id[m.properties.parent].$children_ids$[g],o&&this.removeObjectsByIds(Object.keys(m.$children_ids$),!0),delete this._groups_by_id[g])}return this._layersCache.removeAll(),l}},{key:"updateObjectProperties",value:function(n,o){var s,l=1<arguments.length&&o!==void 0&&o;return n.type==="Group"?(mergeObjects(this._groups_by_id[n.id].properties,n.properties),this._groups_by_id[n.id].properties.ref.effectiveVisibility=this._isVisible(n.properties)):(this._tree_entries_by_object_id[n.id]||this.addObjects([n]),mergeObjects(this._tree_entries_by_object_id[n.id].$feature$.properties,n.properties),this._tree_entries_by_object_id[n.id].$feature$.properties.ref.effectiveVisibility=this._isVisible(n.properties),l&&(s=this._getClampedGeoRectForFeature(n))),s}},{key:"_getZInfo",value:function(n,o){var s=o.properties.zIdx,l=o.properties.sIdx;return n[0]|=s!==void 0,n.splice(1,0,s||0,l<0?o.id:l),o.properties.parent===0?n:this._getZInfo(n,this._groups_by_id[o.properties.parent])}},{key:"_isVisible",value:function(n){var o=n.visible,s=!n.parent||this._isVisible(this._groups_by_id[n.parent].properties);return o&&s}},{key:"isInMinMaxRange",value:function(n,o){var s=n.min<=o&&n.max>=o,l=!n.parent||this.isInMinMaxRange(this._groups_by_id[n.parent].properties,o);return s&&l}},{key:"dispose",value:function(){this._commands=[],_get(_getPrototypeOf(r.prototype),"dispose",this).call(this)}}],[{key:"_compareZInfo",value:function(n,o){for(var s,l=n.properties.ref.zInfo,h=o.properties.ref.zInfo,d=l.length,y=h.length,g=Math.min(d,y),v=1;v<g;v++)if(s=l[v]-h[v])return s;return d-y}},{key:"_preprocessGeometry",value:function(n){var o=n.type;n.coordinates=o==="Point"?r._processPointCoordinates(n.coordinates):o==="MultiPoint"?n.coordinates.map(r._processPointCoordinates):o==="LineString"?r._processLineStringCoordinates(n.coordinates):o==="MultiLineString"?n.coordinates.map(r._processLineStringCoordinates):o==="Polygon"?n.coordinates.map(r._processPolygonCoordinates):o==="MultiPolygon"?n.coordinates.map(r._processMultiPolygonCoordinates):[]}},{key:"_processPointCoordinates",value:function(n){return[n[1],n[0],n[2]]}},{key:"_processLineStringCoordinates",value:function(n){return r._latLngAltArrayToLineString(n,!1)}},{key:"_processPolygonCoordinates",value:function(n){return r._latLngAltArrayToLineString(n,!0)}},{key:"_processMultiPolygonCoordinates",value:function(n){return n.map(r._processPolygonCoordinates)}},{key:"_latLngAltArrayToLineString",value:function(n,o){for(var s=[],l=n.length,h=0;h<l;h+=3)s.push([n[h+1],n[h]]);return o&&s.push([n[1],n[0]]),s}}]),r}();MapsJsSource.register(ObjectSource,"ObjectSource");var GEOMETRY_TYPE={POLYGON:1,POLYLINE:2,OUTLINE:3},IconMap=function(){function e(){_classCallCheck(this,e),this._map={}}return _createClass(e,[{key:"set",value:function(r,n,o){var s;this._map[r]?this._map[r].accumulator.add(o):((s=new Set).add(o),this._map[r]={value:n,accumulator:s})}},{key:"get",value:function(r){return this._map[r]&&this._map[r].value}},{key:"delete",value:function(r,n){var o=this._map[r];o&&o.accumulator&&(o.accumulator.delete(n),o.accumulator.size===0&&delete this._map[r])}}]),e}(),ObjectTileSource=function(){_inherits(r,MapsJsSource);var e=_createSuper(r);function r(n,o){var s;return _classCallCheck(this,r),s=e.call(this,n,o),Thread.is_worker||(s._icons=new IconMap),s}return _createClass(r,[{key:"onProviderUpdate",value:function(n){n.target instanceof H.map.provider.Tile?this.dispatchUpdate(n.target,n.data):this.dispatchUpdate(void 0,n.data)}},{key:"onReady",value:function(){var n=this.provider;n.setTileCanvasRendering&&n.setTileCanvasRendering(!1),n.providesMarkers()&&(this._onCacheDrop=this._onCacheDrop.bind(this),n.getCache().registerOnDrop(this._onCacheDrop)),this.dispatchUpdate()}},{key:"dispose",value:function(){_get(_getPrototypeOf(r.prototype),"dispose",this).call(this);var n=this.provider;n.providesMarkers()&&n.getCache().deRegisterOnDrop(this._onCacheDrop)}},{key:"_onCacheDrop",value:function(n,o){this.provider.cacheFilter(n)&&this._deleteIcons(n,o.data)}},{key:"_deleteIcons",value:function(n,o){for(var s=0,l=o.length;s<l;s++){var h=o[s].getIcon();this._icons.delete(h.uid,n)}}},{key:"getIconBitmapByObjectId",value:function(n,o){var s=this._icons.get(o);return s&&s.getBitmap()}},{key:"requestMarkerTile",value:function(n){var o=this;return new Promise(function(s,l){o.provider?o.provider.requestTileAsPromise(n.x,n.y,n.z,!1).then(function(h){var d,y,g=[];if(h.data)for(y=(d=h.data).length;y--;){var v=d[y],m=v.getIcon();o._icons.set(m.uid,m,h.key),g.push(v.forWorkerMessage())}s(g)}):s([])})}},{key:"requestSpatialTile",value:function(n){var o=this;return new Promise(function(s,l){o.provider?o.provider.requestTileAsPromise(n.x,n.y,n.z,!1).then(function(h){var d,y=[];if(h.getObjects){d=h.getObjects();for(var g=0;g<d.length;g++){var v=d[g];y.push({id:v.getId(),geometries:v.getGeometriesForTile(h),isClosed:v.isClosed(),style:v.getStyle().forWorkerMessage()})}}s(y)}):s([])})}},{key:"_pointToArray",value:function(n){var o=Geo$1.tile_scale/this.tile_size;return[n.x*o,n.y*o]}},{key:"_getGeoJsonMultiPolygon",value:function(n){for(var o=n.geometries,s=o.length,l=[],h={coordinates:l,type:"MultiPolygon"},d=0;d<s;d++){for(var y=o[d],g=y.paths,v=g.length,m=y.interiorsIndex,w=y.outlinesIndex,I=Math.min(m,w,v),V=void 0,q=void 0,q=0;q<I;q++)V=[g[q].map(this._pointToArray,this)],l.push(V);if(I===1)for(I=Math.min(w,v),q=m;q<I;q++)V.push(g[q].map(this._pointToArray,this))}return h}},{key:"_getGeoJsonMultiLineString",value:function(n,o){for(var s=1<arguments.length&&o!==void 0&&o,l={coordinates:[],type:"MultiLineString"},h=n.geometries,d=0;d<h.length;d++)for(var y=h[d],g=s?y.outlinesIndex:0,v=s?y.paths.length:Math.min(y.interiorsIndex,y.outlinesIndex,y.paths.length),m=g;m<v;m++){var w=y.paths[m].map(this._pointToArray,this);l.coordinates.push(w)}return l}},{key:"_getGeoJsonGeometry",value:function(n,o){var s=o===GEOMETRY_TYPE.POLYGON?this._getGeoJsonMultiPolygon(n):this._getGeoJsonMultiLineString(n,o===GEOMETRY_TYPE.OUTLINE);return s.coordinates.length?s:null}},{key:"_load",value:function(n){var o=this;return new Promise(function(s,l){var h=WorkerBroker.postMessage(o.target_name+".requestMarkerTile",n.coords).then(o._prepareTileData.bind(o,n)),d=new Promise(function(y,g){WorkerBroker.postMessage(o.target_name+".requestSpatialTile",n.coords).then(function(v){for(var m=[],w=[],I=[],V=0;V<v.length;V++){var q,De=v[V],_n=void 0,ha=void 0,ha=De.isClosed?(_n=w,GEOMETRY_TYPE.POLYGON):(_n=m,GEOMETRY_TYPE.POLYLINE),ga=o._getGeoJsonGeometry(De,ha);ga&&(q={id:De.id,type:"Feature",properties:{height:0,style:De.style},geometry:ga},ha===GEOMETRY_TYPE.POLYLINE&&(q.properties.effectiveZIdx=m.length),_n.push(q));var _o=o._getGeoJsonGeometry(De,GEOMETRY_TYPE.OUTLINE);_o&&I.push({id:De.id,type:"Feature",properties:{height:0,style:De.style,effectiveZIdx:I.length},geometry:_o})}n.source_data.layers.polylines={type:"FeatureCollection",features:m},n.source_data.layers.polygons={type:"FeatureCollection",features:w},n.source_data.layers.outlines={type:"FeatureCollection",features:I},y(n)})});Promise.all([h,d]).then(function(y){o._postProcessTile(n),s(n)})})}},{key:"_prepareTileData",value:function(n,o){var s=Geo$1.wrapTile(n.coords,{x:!0,y:!0}),l=Geo$1.metersForTile(s);n.source_data.layers={markers:{features:o,type:"FeatureCollection"}};var h={coords:s,min:l},d=n.source_data,y=layout("binary-tree"),g={};for(var v in d.layers)for(var m=d.layers[v].features.length,w=0;w<m;w++){var I=d.layers[v].features[w],V=I.properties.icon;g[V.id]||(y.addItem({width:V.size.w,height:V.size.h,meta:{objectId:I.id,id:V.id}}),g[V.id]=!0),Geo$1.transformGeometry(I.geometry,function(q){var De=q[0];q[0]=q[1],q[1]=De})}return n.rasters=y.export(),MapsJsSource.projectData(n.source_data),MapsJsSource.scaleData(n.source_data,h),n}}]),r}();MapsJsSource.register(ObjectTileSource,"ObjectTileSource");var RemoteRasterTileSource=function(){_inherits(r,RasterTileSource);var e=_createSuper(r);function r(n,o){var s;return _classCallCheck(this,r),(s=e.call(this,n,o)).uid_=n.uid,s}return _createClass(r,[{key:"initialize",value:function(n,o){this.provider=n,this._on_update=o,this._onProviderUpdate=this._onProviderUpdate.bind(this),n.addEventListener("update",this._onProviderUpdate)}},{key:"_onProviderUpdate",value:function(){this._on_update(this.name)}},{key:"tileTexture",value:function(n){return Object.assign(_get(_getPrototypeOf(r.prototype),"tileTexture",this).call(this,n),{uid:this.uid_,url:this.uid_+"_"+n.coords.key,coords:n.coords})}},{key:"dispose",value:function(){this.provider.removeEventListener("update",this._onProviderUpdate)}}]),r}();function geojsonvt(e,r){return new GeoJSONVT(e,r)}function GeoJSONVT(e,r){var n=(r=this.options=extend(Object.create(this.options),r)).debug;if(n&&console.time("preprocess data"),r.maxZoom<0||24<r.maxZoom)throw new Error("maxZoom should be in the 0-24 range");if(r.promoteId&&r.generateId)throw new Error("promoteId and generateId cannot be used together.");var o=convert(e,r);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",r.indexMaxZoom,r.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(o=wrap(o,r)).length&&this.splitTile(o,0,0,0),n&&(o.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function toID(e,r,n){return 32*((1<<e)*n+r)+e}function extend(e,r){for(var n in r)e[n]=r[n];return e}DataSource.register(RemoteRasterTileSource,"RemoteRasterTileSource"),GeoJSONVT.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},GeoJSONVT.prototype.splitTile=function(e,r,n,o,s,l,h){for(var d=[e,r,n,o],y=this.options,g=y.debug;d.length;){o=d.pop(),n=d.pop(),r=d.pop(),e=d.pop();var v,m,w,I,V,q,De,_n,ha,ga,_o,_l=1<<r,wc=toID(r,n,o),_h=this.tiles[wc];if(_h||(1<g&&console.time("creation"),_h=this.tiles[wc]=createTile(e,r,n,o,y),this.tileCoords.push({z:r,x:n,y:o}),g&&(1<g&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",r,n,o,_h.numFeatures,_h.numPoints,_h.numSimplified),console.timeEnd("creation")),v="z"+r,this.stats[v]=(this.stats[v]||0)+1,this.total++)),_h.source=e,s){if(r===y.maxZoom||r===s)continue;var _p=1<<s-r;if(n!==Math.floor(l/_p)||o!==Math.floor(h/_p))continue}else if(r===y.indexMaxZoom||_h.numPoints<=y.indexMaxPoints)continue;_h.source=null,e.length!==0&&(1<g&&console.time("clipping"),w=.5-(m=.5*y.buffer/y.extent),V=1+m,ha=q=De=_n=null,ga=clip(e,_l,n-m,n+(I=.5+m),0,_h.minX,_h.maxX,y),_o=clip(e,_l,n+w,n+V,0,_h.minX,_h.maxX,y),e=null,ga&&(ha=clip(ga,_l,o-m,o+I,1,_h.minY,_h.maxY,y),q=clip(ga,_l,o+w,o+V,1,_h.minY,_h.maxY,y),ga=null),_o&&(De=clip(_o,_l,o-m,o+I,1,_h.minY,_h.maxY,y),_n=clip(_o,_l,o+w,o+V,1,_h.minY,_h.maxY,y),_o=null),1<g&&console.timeEnd("clipping"),d.push(ha||[],r+1,2*n,2*o),d.push(q||[],r+1,2*n,2*o+1),d.push(De||[],r+1,2*n+1,2*o),d.push(_n||[],r+1,2*n+1,2*o+1))}},GeoJSONVT.prototype.getTile=function(e,r,n){var o=this.options,s=o.extent,l=o.debug;if(e<0||24<e)return null;var h=1<<e,d=toID(e,r=(r%h+h)%h,n);if(this.tiles[d])return transformTile(this.tiles[d],s);1<l&&console.log("drilling down to z%d-%d-%d",e,r,n);for(var y,g=e,v=r,m=n;!y&&0<g;)g--,v=Math.floor(v/2),m=Math.floor(m/2),y=this.tiles[toID(g,v,m)];return y&&y.source?(1<l&&console.log("found parent tile z%d-%d-%d",g,v,m),1<l&&console.time("drilling down"),this.splitTile(y.source,g,v,m,e,r,n),1<l&&console.timeEnd("drilling down"),this.tiles[d]?transformTile(this.tiles[d],s):null):null};var EMPTY_FEATURE_COLLECTION$1={type:"FeatureCollection",features:[]},GeoJSONTileSource=function(){_inherits(r,MapsJsSource);var e=_createSuper(r);function r(n,o){return _classCallCheck(this,r),n.tiled=!0,n.url="",e.call(this,n,o)}return _createClass(r,[{key:"fetchTile",value:function(n,o,s){return this.provider?this.provider.requestTileAsPromise(n,o,s).then(function(l){return l.data}):Promise.resolve(EMPTY_FEATURE_COLLECTION$1)}},{key:"_load",value:function(n){var o=this,s=Geo$1.wrapTile(n.coords,{x:!0,y:!0}),l={indexMaxZoom:0,maxZoom:this.max_zoom,tolerance:1.5,extent:Geo$1.tile_scale};return WorkerBroker.postMessage(this.target_name+".fetchTile",s.x,s.y,s.z).then(function(h){for(var d in n.source_data.layers=h.type==="FeatureCollection"?{_default:h}:h,n.source_data.layers){var y=geojsonvt(n.source_data.layers[d],l).getTile(s.z,s.x,s.y);n.source_data.layers[d]=parseGeoJSONVectorTile(y)}return o._postProcessTile(n),n})}},{key:"onReady",value:function(){this.dispatchUpdate()}}]),r}();DataSource.register(GeoJSONTileSource,"GeoJSONTileSource");var DEFAULT_RESPONSE={layers:{_default:{type:"FeatureCollection",features:[{type:"Point",geometry:{}}]}}},SkyBoxSource=function(){_inherits(r,DataSource);var e=_createSuper(r);function r(n,o){return _classCallCheck(this,r),n.max_zoom=0,e.call(this,n,o)}return _createClass(r,[{key:"load",value:function(n){return n.source_data=n.coords.key==="0/0/0"?DEFAULT_RESPONSE:void 0,Promise.resolve(n)}}]),r}(),debugSettings;DataSource.register(SkyBoxSource,"SkyBox");var debugSettings$1=debugSettings={draw_label_collision_boxes:!1,draw_label_texture_boxes:!1,suppress_label_fade_in:!1,suppress_snap_animation:!1,show_hidden_labels:!1,layer_stats:!1};function mergeDebugSettings(e){Object.assign(debugSettings,e)}var WorkerType={NATIVE:0,FAKE:1},Context;function sliceObject(e,r){var n={};return r.forEach(function(o){return n[o]=e[o]}),n}var Context$1=Context={},context_id=0,gl;Context.getContext=function(e,r){var n=!1;e==null&&((e=document.createElement("canvas")).style.position="absolute",e.style.top=0,e.style.left=0,e.style.zIndex=-1,document.body.appendChild(e),n=!0);var o=e.getContext("webgl",r)||e.getContext("experimental-webgl",r);if(!o)throw new Error("Couldn't create WebGL context.");return o._tangram_id=context_id++,n?(Context.resize(o,window.innerWidth,window.innerHeight,r.device_pixel_ratio),window.addEventListener("resize",function(){Context.resize(o,window.innerWidth,window.innerHeight,r.device_pixel_ratio)})):Context.resize(o,parseFloat(e.style.width),parseFloat(e.style.height),r.device_pixel_ratio),o},Context.resize=function(e,r,n,o){e.canvas.style.width=r+"px",e.canvas.style.height=n+"px",e.canvas.width=Math.round(r*o),e.canvas.height=Math.round(n*o),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height)};var gl$1=gl={};gl.BYTE=5120,gl.UNSIGNED_BYTE=5121,gl.SHORT=5122,gl.UNSIGNED_SHORT=5123,gl.INT=5124,gl.UNSIGNED_INT=5125,gl.FLOAT=5126;var MAX_VALUE$1=Math.pow(2,16)-1,DEFAULT_SIZE=1024,HAS_ELEMENT_INDEX_UINT=!1,VertexElements=function(){function e(r){_classCallCheck(this,e),this.size_=r||DEFAULT_SIZE,this.position_=0,this.ArrayType_=Uint16Array,this.buffer_=new this.ArrayType_(this.size_),this.overflows_=!1}return _createClass(e,[{key:"push",value:function(r){if(!this.overflows_||HAS_ELEMENT_INDEX_UINT){if(MAX_VALUE$1<r){if(this.overflows_=!0,!HAS_ELEMENT_INDEX_UINT)return;this.ArrayType_===Uint16Array&&(this.ArrayType_=Uint32Array,this.buffer_=new this.ArrayType_(this.buffer_))}this.position_===this.size_&&this.expand_(),this.buffer_[this.position_]=r,this.position_+=1}}},{key:"end",value:function(){if(this.position_===0)return!1;var r=this.buffer_,n=this.position_;return this.buffer_=new this.ArrayType_(this.size_),this.position_=0,this.overflows_=!1,r.subarray(0,n)}},{key:"expand_",value:function(){this.size_=this.size_<<1;var r=new this.ArrayType_(this.size_);r.set(this.buffer_),this.buffer_=r}}]),e}(),_array_types;VertexElements.setElementIndexUint=function(e){HAS_ELEMENT_INDEX_UINT=e};var array_types=(_array_types={},_defineProperty(_array_types,gl$1.FLOAT,Float32Array),_defineProperty(_array_types,gl$1.BYTE,Int8Array),_defineProperty(_array_types,gl$1.UNSIGNED_BYTE,Uint8Array),_defineProperty(_array_types,gl$1.INT,Int32Array),_defineProperty(_array_types,gl$1.UNSIGNED_INT,Uint32Array),_defineProperty(_array_types,gl$1.SHORT,Int16Array),_defineProperty(_array_types,gl$1.UNSIGNED_SHORT,Uint16Array),_array_types),VertexData=function(){function e(r){var n=(1<arguments.length&&arguments[1]!==void 0?arguments[1]:{}).prealloc,o=n===void 0?500:n;_classCallCheck(this,e),this.vertex_layout=r,this.vertex_elements=new VertexElements,this.stride=this.vertex_layout.stride,0<e.array_pool.length?(this.vertex_buffer=e.array_pool.pop(),this.byte_length=this.vertex_buffer.byteLength,this.size=Math.floor(this.byte_length/this.stride),log("trace","VertexData: reused buffer of bytes ".concat(this.byte_length,", ").concat(this.size," vertices"))):(this.size=o,this.byte_length=this.stride*this.size,this.vertex_buffer=new Uint8Array(this.byte_length)),this.offset=0,this.vertex_count=0,this.realloc_count=0,this.setBufferViews(),this.setAddVertexFunction()}return _createClass(e,[{key:"setBufferViews",value:function(){var r=this;this.views={},this.views[gl$1.UNSIGNED_BYTE]=this.vertex_buffer,this.vertex_layout.dynamic_attribs.forEach(function(n){var o;r.views[n.type]==null&&(o=array_types[n.type],r.views[n.type]=new o(r.vertex_buffer.buffer))})}},{key:"checkBufferSize",value:function(){var r;this.offset+this.stride>this.byte_length&&(this.size=Math.floor(1.5*this.size),this.size-=this.size%4,this.byte_length=this.stride*this.size,(r=new Uint8Array(this.byte_length)).set(this.vertex_buffer),e.array_pool.push(this.vertex_buffer),this.vertex_buffer=r,this.setBufferViews(),this.realloc_count++)}},{key:"setAddVertexFunction",value:function(){this.vertexLayoutAddVertex=this.vertex_layout.getAddVertexFunction()}},{key:"addVertex",value:function(r){this.checkBufferSize(),this.vertexLayoutAddVertex(r,this.views,this.offset),this.offset+=this.stride,this.vertex_count++}},{key:"end",value:function(){return this.vertex_buffer=this.vertex_buffer.subarray(0,this.offset),this.element_buffer=this.vertex_elements.end(),log("trace","VertexData: ".concat(this.size," vertices total, realloc count ").concat(this.realloc_count)),this}}]),e}();VertexData.array_pool=[];var VertexLayout=function(){function e(r){_classCallCheck(this,e),this.attribs=r,this.dynamic_attribs=this.attribs.filter(function(g){return!g.static}),this.components=[],this.index={},this.offset={};for(var n=this.stride=0,o=0,s=0;s<this.attribs.length;s++){var l=this.attribs[s];if(l.static==null){l.offset=this.stride,l.byte_size=l.size;var h=0;switch(l.type){case gl$1.FLOAT:case gl$1.INT:case gl$1.UNSIGNED_INT:l.byte_size*=4,h=2;break;case gl$1.SHORT:case gl$1.UNSIGNED_SHORT:l.byte_size*=2,h=1}3&l.byte_size&&(l.byte_size+=4-(3&l.byte_size)),this.stride+=l.byte_size;for(var d=l.offset>>h,y=0;y<l.size;y++)this.components.push({type:l.type,shift:h,offset:d++,index:o++});this.index[l.name]=n,n+=l.size,this.offset[l.name]=l.offset}else l.static=Array.isArray(l.static)?l.static:[l.static],l.method="vertexAttrib".concat(l.static.length,"fv")}}return _createClass(e,[{key:"enable",value:function(r,n,o){for(var s,l,h=0;h<this.attribs.length;h++)s=this.attribs[h],(l=n.attribute(s.name).location)!==-1&&(s.static==null?(e.enabled_attribs[l]&&!o||r.enableVertexAttribArray(l),r.vertexAttribPointer(l,s.size,s.type,s.normalized,this.stride,s.offset),e.enabled_attribs[l]=n):r[s.method]instanceof Function&&(r.enableVertexAttribArray(l),r[s.method](l,s.static),r.disableVertexAttribArray(l),delete e.enabled_attribs[l]));for(l in e.enabled_attribs)this.disableUnusedAttribute(r,l,n)}},{key:"disableUnusedAttribute",value:function(r,n,o){e.enabled_attribs[n]!==o&&(r.disableVertexAttribArray(n),delete e.enabled_attribs[n])}},{key:"createVertexData",value:function(){return new VertexData(this)}},{key:"getAddVertexFunction",value:function(){return this.addVertex==null&&this.createAddVertexFunction(),this.addVertex}},{key:"createAddVertexFunction",value:function(){var r=hashString(JSON.stringify(this.attribs));if(e.add_vertex_funcs[r]==null){var n,o=["var t, o;"],s=_toConsumableArray(this.components);s.sort(function(y,g){return y.type!==g.type?y.type-g.type:y.index-g.index});for(var l=0;l<s.length;l++){var h=s[l];n!==h.type&&(o.push("t = vs[".concat(h.type,"];")),o.push("o = off".concat(h.shift?" >> "+h.shift:"",";")),n=h.type),o.push("t[o + ".concat(h.offset,"] = v[").concat(h.index,"];"))}o=o.join(`
`);var d=new Function("v","vs","off",o);e.add_vertex_funcs[r]=d}this.addVertex=e.add_vertex_funcs[r]}}]),e}();VertexLayout.enabled_attribs={},VertexLayout.add_vertex_funcs={};var tile_bounds=[{x:0,y:0},{x:Geo$1.tile_scale,y:-Geo$1.tile_scale}],default_uvs=[0,0,1,1];function outsideTile(e,r,n){var o=tile_bounds[0],s=tile_bounds[1];return e[0]<=o.x+n&&r[0]<=o.x+n||e[0]>=s.x-n&&r[0]>=s.x-n||e[1]>=o.y-n&&r[1]>=o.y-n||e[1]<=s.y+n&&r[1]<=s.y+n}function isCoordOutsideTile(e,r){r=r||0;var n=tile_bounds[0],o=tile_bounds[1];return e[0]<=n.x+r||e[0]>=o.x-r||e[1]>=n.y-r||e[1]<=o.y+r}var earcut_1=earcut;function earcut(e,r,n){n=n||2;var o,s,l,h,d,y,g,v=r&&r.length,m=v?r[0]*n:e.length,w=linkedList(e,0,m,n,!0),I=[];if(!w)return I;if(v&&(w=eliminateHoles(e,r,w,n)),e.length>80*n){o=l=e[0],s=h=e[1];for(var V=n;V<m;V+=n)(d=e[V])<o&&(o=d),(y=e[V+1])<s&&(s=y),l<d&&(l=d),h<y&&(h=y);g=Math.max(l-o,h-s)}return earcutLinked(w,I,n,o,s,g),I}function linkedList(e,r,n,o,s){var l,h;if(s===0<signedArea$1(e,r,n,o))for(l=r;l<n;l+=o)h=insertNode(l,e[l],e[l+1],h);else for(l=n-o;r<=l;l-=o)h=insertNode(l,e[l],e[l+1],h);return h&&equals(h,h.next)&&(removeNode(h),h=h.next),h}function filterPoints(e,r){if(!e)return e;r=r||e;var n,o=e;do if(n=!1,o.steiner||!equals(o,o.next)&&area(o.prev,o,o.next)!==0)o=o.next;else{if(removeNode(o),(o=r=o.prev)===o.next)return null;n=!0}while(n||o!==r);return r}function earcutLinked(e,r,n,o,s,l,h){if(e){!h&&l&&indexCurve(e,o,s,l);for(var d,y,g=e;e.prev!==e.next;)if(d=e.prev,y=e.next,l?isEarHashed(e,o,s,l):isEar(e))r.push(d.i/n),r.push(e.i/n),r.push(y.i/n),removeNode(e),e=y.next,g=y.next;else if((e=y)===g){h?h===1?earcutLinked(e=cureLocalIntersections(e,r,n),r,n,o,s,l,2):h===2&&splitEarcut(e,r,n,o,s,l):earcutLinked(filterPoints(e),r,n,o,s,l,1);break}}}function isEar(e){var r=e.prev,n=e,o=e.next;if(!(0<=area(r,n,o))){for(var s=e.next.next;s!==e.prev;){if(pointInTriangle(r.x,r.y,n.x,n.y,o.x,o.y,s.x,s.y)&&0<=area(s.prev,s,s.next))return;s=s.next}return 1}}function isEarHashed(e,r,n,o){var s=e.prev,l=e,h=e.next;if(!(0<=area(s,l,h))){for(var d=s.x<l.x?s.x<h.x?s.x:h.x:l.x<h.x?l.x:h.x,y=s.y<l.y?s.y<h.y?s.y:h.y:l.y<h.y?l.y:h.y,g=s.x>l.x?s.x>h.x?s.x:h.x:l.x>h.x?l.x:h.x,v=s.y>l.y?s.y>h.y?s.y:h.y:l.y>h.y?l.y:h.y,m=zOrder(d,y,r,n,o),w=zOrder(g,v,r,n,o),I=e.nextZ;I&&I.z<=w;){if(I!==e.prev&&I!==e.next&&pointInTriangle(s.x,s.y,l.x,l.y,h.x,h.y,I.x,I.y)&&0<=area(I.prev,I,I.next))return;I=I.nextZ}for(I=e.prevZ;I&&I.z>=m;){if(I!==e.prev&&I!==e.next&&pointInTriangle(s.x,s.y,l.x,l.y,h.x,h.y,I.x,I.y)&&0<=area(I.prev,I,I.next))return;I=I.prevZ}return 1}}function cureLocalIntersections(e,r,n){var o=e;do{var s=o.prev,l=o.next.next;!equals(s,l)&&intersects(s,o,o.next,l)&&locallyInside(s,l)&&locallyInside(l,s)&&(r.push(s.i/n),r.push(o.i/n),r.push(l.i/n),removeNode(o),removeNode(o.next),o=e=l),o=o.next}while(o!==e);return o}function splitEarcut(e,r,n,o,s,l){var h=e;do{for(var d=h.next.next;d!==h.prev;){if(h.i!==d.i&&isValidDiagonal(h,d)){var y=splitPolygon(h,d),h=filterPoints(h,h.next),y=filterPoints(y,y.next);return earcutLinked(h,r,n,o,s,l),void earcutLinked(y,r,n,o,s,l)}d=d.next}h=h.next}while(h!==e)}function eliminateHoles(e,r,n,o){for(var s,l=[],h=0,d=r.length;h<d;h++)(s=linkedList(e,r[h]*o,h<d-1?r[h+1]*o:e.length,o,!1))===s.next&&(s.steiner=!0),l.push(getLeftmost(s));for(l.sort(compareX),h=0;h<l.length;h++)eliminateHole(l[h],n),n=filterPoints(n,n.next);return n}function compareX(e,r){return e.x-r.x}function eliminateHole(e,r){var n;(r=findHoleBridge(e,r))&&filterPoints(n=splitPolygon(r,e),n.next)}function findHoleBridge(e,r){var n,o=r,s=e.x,l=e.y,h=-1/0;do{if(l<=o.y&&l>=o.next.y){var d=o.x+(l-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(d<=s&&h<d){if((h=d)===s){if(l===o.y)return o;if(l===o.next.y)return o.next}n=o.x<o.next.x?o:o.next}}o=o.next}while(o!==r);if(!n)return null;if(s===h)return n.prev;for(var y,g=n,v=n.x,m=n.y,w=1/0,o=n.next;o!==g;)s>=o.x&&o.x>=v&&pointInTriangle(l<m?s:h,l,v,m,l<m?h:s,l,o.x,o.y)&&((y=Math.abs(l-o.y)/(s-o.x))<w||y===w&&o.x>n.x)&&locallyInside(o,e)&&(n=o,w=y),o=o.next;return n}function indexCurve(e,r,n,o){for(var s=e;s.z===null&&(s.z=zOrder(s.x,s.y,r,n,o)),s.prevZ=s.prev,s.nextZ=s.next,(s=s.next)!==e;);s.prevZ.nextZ=null,s.prevZ=null,sortLinked(s)}function sortLinked(e){var r,n,o,s,l,h,d,y,g=1;do{for(n=e,l=e=null,h=0;n;){for(h++,o=n,r=d=0;r<g&&(d++,o=o.nextZ);r++);for(y=g;0<d||0<y&&o;)d!==0&&(y===0||!o||n.z<=o.z)?(n=(s=n).nextZ,d--):(o=(s=o).nextZ,y--),l?l.nextZ=s:e=s,s.prevZ=l,l=s;n=o}l.nextZ=null,g*=2}while(1<h);return e}function zOrder(e,r,n,o,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)/s)|e<<8))|e<<4))|e<<2))|e<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-o)/s)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function getLeftmost(e){for(var r=e,n=e;r.x<n.x&&(n=r),(r=r.next)!==e;);return n}function pointInTriangle(e,r,n,o,s,l,h,d){return 0<=(s-h)*(r-d)-(e-h)*(l-d)&&0<=(e-h)*(o-d)-(n-h)*(r-d)&&0<=(n-h)*(l-d)-(s-h)*(o-d)}function isValidDiagonal(e,r){return e.next.i!==r.i&&e.prev.i!==r.i&&!intersectsPolygon(e,r)&&locallyInside(e,r)&&locallyInside(r,e)&&middleInside(e,r)}function area(e,r,n){return(r.y-e.y)*(n.x-r.x)-(r.x-e.x)*(n.y-r.y)}function equals(e,r){return e.x===r.x&&e.y===r.y}function intersects(e,r,n,o){return equals(e,r)&&equals(n,o)||equals(e,o)&&equals(n,r)||0<area(e,r,n)!=0<area(e,r,o)&&0<area(n,o,e)!=0<area(n,o,r)}function intersectsPolygon(e,r){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==r.i&&n.next.i!==r.i&&intersects(n,n.next,e,r))return 1;n=n.next}while(n!==e)}function locallyInside(e,r){return area(e.prev,e,e.next)<0?0<=area(e,r,e.next)&&0<=area(e,e.prev,r):area(e,r,e.prev)<0||area(e,e.next,r)<0}function middleInside(e,r){for(var n=e,o=!1,s=(e.x+r.x)/2,l=(e.y+r.y)/2;n.y>l!=n.next.y>l&&s<(n.next.x-n.x)*(l-n.y)/(n.next.y-n.y)+n.x&&(o=!o),(n=n.next)!==e;);return o}function splitPolygon(e,r){var n=new Node(e.i,e.x,e.y),o=new Node(r.i,r.x,r.y),s=e.next,l=r.prev;return(e.next=r).prev=e,(n.next=s).prev=n,(o.next=n).prev=o,(l.next=o).prev=l,o}function insertNode(e,r,n,o){var s=new Node(e,r,n);return o?(s.next=o.next,(s.prev=o).next.prev=s,o.next=s):(s.prev=s).next=s,s}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,r,n){this.i=e,this.x=r,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea$1(e,r,n,o){for(var s=0,l=r,h=n-o;l<n;l+=o)s+=(e[h]-e[l])*(e[l+1]+e[h+1]),h=l;return s}earcut.deviation=function(e,r,n,o){var s=r&&r.length,l=s?r[0]*n:e.length,h=Math.abs(signedArea$1(e,0,l,n));if(s)for(var d=0,y=r.length;d<y;d++){var g=r[d]*n,v=d<y-1?r[d+1]*n:e.length;h-=Math.abs(signedArea$1(e,g,v,n))}for(var m=0,d=0;d<o.length;d+=3){var w=o[d]*n,I=o[d+1]*n,V=o[d+2]*n;m+=Math.abs((e[w]-e[V])*(e[1+I]-e[1+w])-(e[w]-e[I])*(e[1+V]-e[1+w]))}return h===0&&m===0?0:Math.abs((m-h)/h)},earcut.flatten=function(e){for(var r=e[0][0].length,n={vertices:[],holes:[],dimensions:r},o=0,s=0;s<e.length;s++){for(var l=0;l<e[s].length;l++)for(var h=0;h<r;h++)n.vertices.push(e[s][l][h]);0<s&&(o+=e[s-1].length,n.holes.push(o))}return n};var up_vec3=[0,0,1];function buildPolygons(e,r,n,o){var s,l,h,d,y,g=o.texcoord_index,v=o.texcoord_scale,m=o.texcoord_normalize,w=r.vertex_elements;g&&(m=m||1,l=(s=_slicedToArray(v||default_uvs,4))[0],h=s[1],d=s[2],y=s[3]);for(var I=0,V=e.length,q=0;q<V;q++){var De,_n,ha,ga,_o,_l=r.vertex_count,wc=e[q];g&&(_n=(De=_slicedToArray(Geo$1.findBoundingBox(wc),4))[0],ha=De[1],ga=(d-l)/(De[2]-_n),_o=(y-h)/(De[3]-ha));for(var _h=0;_h<wc.length;_h++)for(var _p=wc[_h],pd=0;pd<_p.length;pd++){var oy=_p[pd];n[0]=oy[0],n[1]=oy[1],g&&(n[g+0]=((oy[0]-_n)*ga+l)*m,n[g+1]=((oy[1]-ha)*_o+h)*m),r.addVertex(n)}for(var ny=triangulatePolygon(earcut_1.flatten(wc)),fy=0;fy<ny.length;fy++)w.push(_l+ny[fy]);I+=ny.length/3}return I}function buildExtrudedPolygons(e,r,n,o,s,l,h,d,y){var g=y.remove_tile_edges,v=y.tile_edge_tolerance,m=y.texcoord_index,w=y.texcoord_scale,I=y.texcoord_normalize,V=y.winding,q=r+(o||0),De=r+n;l[2]=De;var _n,ha,ga,_o,_l,wc,_h=buildPolygons(e,s,l,{texcoord_index:m,texcoord_scale:w,texcoord_normalize:I}),_p=s.vertex_elements,pd=s.vertex_count;m&&(I=I||1,ha=(_n=_slicedToArray(w||default_uvs,4))[0],ga=_n[1],_o=_n[2],wc=[[ha,_l=_n[3]],[ha,ga],[_o,ga],[_o,_l]]);for(var oy=e.length,ny=0;ny<oy;ny++)for(var fy=e[ny],wy=0;wy<fy.length;wy++)for(var cy=fy[wy],Gy=0;Gy<cy.length-1;Gy++)if(!g||!outsideTile(cy[Gy],cy[Gy+1],v)){var jy=void 0,Wy=void 0,Iy=[[cy[Wy=V==="CCW"?(jy=Gy)+1:(jy=Gy+1,Gy)][0],cy[Wy][1],De],[cy[Wy][0],cy[Wy][1],q],[cy[jy][0],cy[jy][1],q],[cy[jy][0],cy[jy][1],De]],vy=Vector$1.normalize([cy[Wy][0]-cy[jy][0],cy[Wy][1]-cy[jy][1],0]),Ty=Vector$1.cross(up_vec3,vy);l[h+0]=Ty[0]*d,l[h+1]=Ty[1]*d,l[h+2]=Ty[2]*d;for(var Vy=0;Vy<Iy.length;Vy++)l[0]=Iy[Vy][0],l[1]=Iy[Vy][1],l[2]=Iy[Vy][2],m&&(l[m+0]=wc[Vy][0]*I,l[m+1]=wc[Vy][1]*I),s.addVertex(l);_p.push(pd+0),_p.push(pd+1),_p.push(pd+2),_p.push(pd+2),_p.push(pd+3),_p.push(pd+0),pd+=4,_h+=2}return _h}function triangulatePolygon(e){return earcut_1(e.vertices,e.holes,e.dimensions)}var shaderSrc_polygonsVertex=`uniform vec2 u_resolution;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_tile_proxy_depth;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform mat4 u_model;uniform mat4 u_modelView;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;attribute vec4 a_position;attribute vec4 a_color;
#ifdef TANGRAM_NORMAL_ATTRIBUTE
attribute vec3 a_normal;
#define TANGRAM_NORMAL a_normal
#else
#define TANGRAM_NORMAL vec3(0., 0., 1.)
#endif
#ifdef TANGRAM_EXTRUDE_LINES
attribute vec2 a_extrude;attribute vec2 a_offset;attribute vec2 a_scaling;uniform float u_v_scale_adjust;
#endif
varying vec4 v_position;varying vec4 v_local_space_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;
#if defined(TANGRAM_TEXTURE_COORDS) || defined(TANGRAM_EXTRUDE_LINES)
attribute vec2 a_texcoord;varying vec2 v_texcoord;
#endif
#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING
varying vec4 v_modelpos_base_zoom;
#endif
#if defined(TANGRAM_LIGHTING_VERTEX)
varying vec4 v_lighting;
#endif
#define UNPACK_SCALING(x) (x / 1024.)
#pragma tangram: camera
#pragma tangram: material
#pragma tangram: lighting
#pragma tangram: raster
#pragma tangram: global
void main(){
#pragma tangram: setup
#ifdef TANGRAM_TEXTURE_COORDS
v_texcoord=a_texcoord;
#ifdef TANGRAM_EXTRUDE_LINES
v_texcoord.y*=u_v_scale_adjust;
#endif
#endif
#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING
v_modelpos_base_zoom=modelPositionBaseZoom();
#endif
vec4 position=vec4(a_position.xy,a_position.z/TANGRAM_HEIGHT_SCALE,1.);
#ifdef TANGRAM_EXTRUDE_LINES
vec2 extrude=a_extrude.xy;vec2 offset=a_offset.xy;float dz=clamp(u_map_position.z-u_tile_origin.z,0.,4.);dz+=step(1.,dz)*(1.-dz)+mix(0.,2.,clamp((dz-2.)/2.,0.,1.));float mdz=(dz-0.5)*2.;extrude-=extrude*UNPACK_SCALING(a_scaling.x)*mdz;float dwdz=UNPACK_SCALING(a_scaling.y);float sdwdz=sign(step(0.,dwdz)-0.5);offset-=offset*abs(dwdz)*((1.-step(0.,sdwdz))-(dz*-sdwdz));float ssz=exp2(-dz-(u_tile_origin.z-u_tile_origin.w));extrude*=ssz;offset*=ssz;
#ifdef TANGRAM_BLOCK_WIDTH
float width=1.;
#pragma tangram: width
extrude*=width;
#endif
position.xy+=extrude+offset;
#endif
v_world_position=wrapWorldPosition(u_model*position);v_local_space_position=position;position=u_modelView*position;
#pragma tangram: position
v_position=position;v_normal=normalize(u_normalMatrix*TANGRAM_NORMAL);v_color=a_color;
#if defined(TANGRAM_LIGHTING_VERTEX)
vec3 normal=v_normal;
#pragma tangram: normal
v_lighting=calculateLighting(position.xyz-u_eye,normal,vec4(1.));
#endif
cameraProjection(position);applyLayerOrder(a_position.w+u_tile_proxy_depth+1.,position);
#if defined(SNAP_TO_PIXEL_GRID)
snapToPixelGrid(position);
#endif
gl_Position=position;}`,shaderSrc_polygonsFragment=`uniform vec2 u_resolution;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;varying vec4 v_position;varying vec4 v_local_space_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;
#ifdef TANGRAM_EXTRUDE_LINES
uniform bool u_has_line_texture;uniform sampler2D u_texture;uniform float u_texture_ratio;uniform vec4 u_dash_background_color;
#endif
#define TANGRAM_NORMAL v_normal
#if defined(TANGRAM_TEXTURE_COORDS) || defined(TANGRAM_EXTRUDE_LINES)
varying vec2 v_texcoord;
#endif
#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING
varying vec4 v_modelpos_base_zoom;
#endif
#if defined(TANGRAM_LIGHTING_VERTEX)
varying vec4 v_lighting;
#endif
#pragma tangram: camera
#pragma tangram: material
#pragma tangram: lighting
#pragma tangram: raster
#pragma tangram: global
#pragma tangram: utils
void main(void){
#pragma tangram: setup
vec4 color=v_color;vec3 normal=TANGRAM_NORMAL;
#ifdef TANGRAM_CROP_BY_TILE
if(isLocalSpacePixelOutsideTile(v_local_space_position,TANGRAM_TILE_SCALE.x)){discard;}
#endif
#ifdef TANGRAM_RASTER_TEXTURE_COLOR
color*=sampleRaster();
#endif
#ifdef TANGRAM_EXTRUDE_LINES
if(u_has_line_texture){vec2 _line_st=vec2(v_texcoord.x,fract(v_texcoord.y/u_texture_ratio));vec4 _line_color=texture2D(u_texture,_line_st);if(_line_color.a<TANGRAM_ALPHA_TEST){
#if !defined(TANGRAM_BLEND_OVERLAY) && !defined(TANGRAM_BLEND_INLAY)
if(u_dash_background_color.a==0.){discard;}color=u_dash_background_color;
#else
color=vec4(u_dash_background_color.rgb,color.a*step(TANGRAM_EPSILON,u_dash_background_color.a));
#endif
}else{color*=_line_color;}}
#endif
#ifdef TANGRAM_RASTER_TEXTURE_NORMAL
normal=normalize(sampleRaster().rgb*2.-1.);
#endif
#if defined(TANGRAM_LIGHTING_FRAGMENT) && defined(TANGRAM_MATERIAL_NORMAL_TEXTURE)
calculateNormal(normal);
#endif
#if !defined(TANGRAM_LIGHTING_VERTEX)
#pragma tangram: normal
#endif
#pragma tangram: color
#if defined(TANGRAM_LIGHTING_FRAGMENT)
color=calculateLighting(v_position.xyz-u_eye,normal,color);
#elif defined(TANGRAM_LIGHTING_VERTEX)
color*=v_lighting;
#endif
#pragma tangram: filter
gl_FragColor=color;}`,Polygons=Object.create(Style);Object.assign(Polygons,{name:"polygons",built_in:!0,vertex_shader_src:shaderSrc_polygonsVertex,fragment_shader_src:shaderSrc_polygonsFragment,selection:!0,init:function(){Style.init.apply(this,arguments),this.defines.TANGRAM_NORMAL_ATTRIBUTE=!0,this.defines.TANGRAM_LAYER_ORDER=!0,this.defines.TANGRAM_CROP_BY_TILE=this.crop_by_tile,this.texcoords&&(this.defines.TANGRAM_TEXTURE_COORDS=!0)},vertexLayoutForMeshVariant:function(){var e;return this.vertex_layout||(e=[{name:"a_position",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_normal",size:3,type:gl$1.BYTE,normalized:!0},{name:"a_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0}],this.texcoords&&e.push({name:"a_texcoord",size:2,type:gl$1.UNSIGNED_SHORT,normalized:!0}),this.vertex_layout=new VertexLayout(e)),this.vertex_layout},_parseFeature:function(e,r,n){var o=this.feature_style;return o.color=this.parseColor(r.color,n),o.color?(o.z=r.z&&StyleParser.evalCachedDistanceProperty(r.z,n)||StyleParser.defaults.z,o.z*=Geo$1.height_scale,o.extrude=StyleParser.evalProperty(r.extrude,n),o.extrude&&(o.extrude===!0?(o.height=e.properties.height!==void 0?e.properties.height:StyleParser.defaults.height,o.min_height=e.properties.min_height!==void 0?e.properties.min_height:StyleParser.defaults.min_height):typeof o.extrude=="number"?(o.height=o.extrude,o.min_height=0):Array.isArray(o.extrude)&&(o.min_height=o.extrude[0],o.height=o.extrude[1]),o.height*=Geo$1.height_scale,o.min_height*=Geo$1.height_scale),o.tile_edges=r.tile_edges,o):null},_preprocess:function(e){return e.color=StyleParser.createColorPropertyCache(e.color),e.z=StyleParser.createPropertyCache(e.z,StyleParser.parseUnits),e},makeVertexTemplate:function(e){var r=0;return this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=e.z||0,this.vertex_template[r++]=this.scaleOrder(e.order),this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=127,this.vertex_template[r++]=255*e.color[0],this.vertex_template[r++]=255*e.color[1],this.vertex_template[r++]=255*e.color[2],this.vertex_template[r++]=255*e.color[3],this.selection&&(this.vertex_template[r++]=255*e.selection_color[0],this.vertex_template[r++]=255*e.selection_color[1],this.vertex_template[r++]=255*e.selection_color[2],this.vertex_template[r++]=255*e.selection_color[3]),this.texcoords&&(this.vertex_template[r++]=0,this.vertex_template[r++]=0),this.vertex_template},buildPolygons:function(e,r,n,o){var s=this.makeVertexTemplate(r),l={texcoord_index:this.vertex_layout.index.a_texcoord,texcoord_normalize:65535,remove_tile_edges:!r.tile_edges,tile_edge_tolerance:Geo$1.tile_scale*o.tile.pad_scale*4,winding:o.winding};return r.extrude&&r.height?buildExtrudedPolygons(e,r.z,r.height,r.min_height,n.vertex_data,s,this.vertex_layout.index.a_normal,127,l):buildPolygons(e,n.vertex_data,s,l)}});var zero_vec2=[0,0],CAP_TYPE={butt:0,square:1,round:2},JOIN_TYPE={miter:0,bevel:1,round:2},DEFAULT={MITER_LIMIT:3,TEXCOORD_NORMALIZE:1,TEXCOORD_RATIO:1,MIN_FAN_WIDTH:5},v_scale_adjust=Geo$1.tile_scale,zero_v=[0,0],one_v=[1,0],mid_v=[.5,0];function buildPolylines(e,r,n,o,s){var l,h,d=s.closed_polygon,y=s.remove_tile_edges,g=s.tile_edge_tolerance,v=s.texcoord_index,m=(s.texcoord_scale,s.texcoord_width),w=s.texcoord_ratio,I=s.texcoord_normalize,V=s.extrude_index,q=s.offset_index,De=s.join,_n=s.cap,ha=s.miter_limit,ga=s.offset,_o=s.crop_by_tile,_l=_n?CAP_TYPE[_n]:CAP_TYPE.butt,wc=De?JOIN_TYPE[De]:JOIN_TYPE.miter;wc===JOIN_TYPE.miter&&(l=(ha=ha||DEFAULT.MITER_LIMIT)*ha),v&&(I=I||DEFAULT.TEXCOORD_NORMALIZE,h=1/(m*(w=w||DEFAULT.TEXCOORD_RATIO)*v_scale_adjust));for(var _h={closed_polygon:d,remove_tile_edges:y,tile_edge_tolerance:g,miter_len_sq:l,join_type:wc,cap_type:_l,vertex_data:n,vertex_template:o,half_width:r/2,extrude_index:V,offset_index:q,v_scale:h,texcoord_index:v,texcoord_width:m,texcoord_normalize:I,offset:ga,geom_count:0,crop_by_tile:_o},_p=0;_p<e.length;_p++)buildPolyline(e[_p],_h);if(_h.extra_lines)for(var pd=0;pd<_h.extra_lines.length;pd++)buildPolyline(_h.extra_lines[pd],_h);return _h.geom_count}function buildPolyline(e,r){if(!(e.length<2)){var n,o,s=r.join_type,l=r.cap_type,h=r.closed_polygon,d=r.remove_tile_edges,y=r.tile_edge_tolerance,g=r.v_scale,v=r.miter_len_sq,m=r.crop_by_tile,w=r.texcoord_index!=null,I=0;if(h&&s===JOIN_TYPE.miter){var V=getTileBoundaryIndex(e);if(V!==0){var q=permuteLine(e,V);return r.extra_lines=r.extra_lines||[],void r.extra_lines.push(q)}}var De=0,_n=e.length-1,ha=0;for(_h=e[De],_p=e[De+1];Vector$1.isEqual(_h,_p);)if(_h=_p,_p=e[++De+1],ha++,De===e.length-1)return;for(;Vector$1.isEqual(e[_n],e[_n-1]);)if(ha++,--_n===0)return;if(!(e.length<2+ha))if(o=Vector$1.normalize(Vector$1.perp(_h,_p)),d&&outsideTile(_h,_p,y)){var ga=getNextNonBoundarySegment(e,De,y);ga&&(r.extra_lines=r.extra_lines||[],r.extra_lines.push(ga))}else{h?startPolygon(_h,n=Vector$1.normalize(Vector$1.perp(e[_n-1],_h)),o,s,r):(!m&&isCoordOutsideTile(_h)||(addCap(_h,I,o,l,!0,r),w&&l!==CAP_TYPE.butt&&(I+=.5*g*r.texcoord_width)),addVertex(_h,o,o,1,I,r,1),addVertex(_h,o,o,0,I,r,-1)),w&&(I+=g*Vector$1.length(Vector$1.sub(_p,_h)));for(var _o=De+1;_o<_n;_o++){var _l=_o,wc=_o+1,_h=e[_l],_p=e[wc];if(!Vector$1.isEqual(_h,_p)){if(d&&outsideTile(_h,_p,y)){addVertex(_h,o,o,1,I,r,1),addVertex(_h,o,o,0,I,r,-1),indexPairs(1,r);var pd=getNextNonBoundarySegment(e,_l+1,y);return void(pd&&(r.extra_lines=r.extra_lines||[],r.extra_lines.push(pd)))}n=o,o=Vector$1.normalize(Vector$1.perp(_h,_p)),s===JOIN_TYPE.miter?addMiter(I,_h,n,o,v,!1,r):addJoin(s,I,_h,n,o,!1,r),w&&(I+=g*Vector$1.length(Vector$1.sub(_p,_h)))}}_h=_p,n=o,h?endPolygon(_h,n,o=Vector$1.normalize(Vector$1.perp(_h,e[1])),s,I,r):(addVertex(_h,n,o,1,I,r,1),addVertex(_h,n,o,0,I,r,-1),indexPairs(1,r),!m&&isCoordOutsideTile(_h)||addCap(_h,I,n,l,!1,r))}}}function getTileBoundaryIndex(e){if(isCoordOutsideTile(e[0]))return 0;for(var r=0;r<e.length;r++)if(isCoordOutsideTile(e[e.length-1-r]))return e.length-1-r;return 0}function getNextNonBoundarySegment(e,r,n){for(var o=r;e[o+1]&&outsideTile(e[o],e[o+1],n);)o++;return 2<=e.length-o&&e.slice(o)}function startPolygon(e,r,n,o,s){o===void 0||isCoordOutsideTile(e)&&!s.crop_by_tile?(addVertex(e,n,n,1,0,s,1),addVertex(e,n,n,0,0,s,-1)):o===JOIN_TYPE.miter?addMiter(0,e,r,n,s.miter_len_sq,!0,s):addJoin(o,0,e,r,n,!0,s)}function endPolygon(e,r,n,o,s,l){var h;isCoordOutsideTile(e)&&!l.crop_by_tile?(addVertex(e,r,r,1,s,l,1),addVertex(e,r,r,0,s,l,-1)):(h=createMiterVec(r,n),o===JOIN_TYPE.miter&&Vector$1.lengthSq(h)>l.miter_len_sq&&(o=JOIN_TYPE.bevel),o===JOIN_TYPE.miter?(addVertex(e,h,r,1,s,l,1),addVertex(e,h,r,0,s,l,-1)):(addVertex(e,r,r,1,s,l,1),addVertex(e,r,r,0,s,l,-1))),indexPairs(1,l)}function createMiterVec(e,r){var n=Vector$1.normalize(Vector$1.add(e,r)),o=2/(1+Math.abs(Vector$1.dot(e,n)));return Vector$1.mult(n,o*o)}function addMiter(e,r,n,o,s,l,h){var d=createMiterVec(n,o);Vector$1.lengthSq(d)>s?addJoin(JOIN_TYPE.bevel,e,r,n,o,l,h):(addVertex(r,d,d,1,e,h,1),addVertex(r,d,d,0,e,h,-1),l||indexPairs(1,h))}function addJoin(e,r,n,o,s,l,h){var d=createMiterVec(o,s),y=0<s[0]*o[1]-s[1]*o[0];h.texcoord_index!=null&&(zero_v[1]=r,one_v[1]=r),y?(addVertex(n,d,d,1,r,h,1),addVertex(n,o,d,0,r,h,-1),l||indexPairs(1,h),addFan(n,Vector$1.neg(o),d,Vector$1.neg(s),d,zero_v,one_v,zero_v,!1,e===JOIN_TYPE.bevel,h),addVertex(n,d,d,1,r,h,1),addVertex(n,s,d,0,r,h,-1)):(addVertex(n,o,d,1,r,h,1),addVertex(n,d,d,0,r,h,-1),l||indexPairs(1,h),addFan(n,o,Vector$1.neg(d),s,d,one_v,zero_v,one_v,!1,e===JOIN_TYPE.bevel,h),addVertex(n,s,d,1,r,h,1),addVertex(n,d,d,0,r,h,-1))}function indexPairs(e,r){for(var n=r.vertex_data.vertex_elements,o=r.vertex_data.vertex_count-2*e-2,s=0;s<e;s++)n.push(o+2*s+2),n.push(o+2*s+1),n.push(o+2*s),n.push(o+2*s+2),n.push(o+2*s+3),n.push(o+2*s+1),r.geom_count+=2}function addVertex(e,r,n,o,s,l,h){var d=l.vertex_template,y=l.vertex_data;d[0]=e[0],d[1]=e[1];var g=l.half_width*h;d[l.extrude_index+0]=r[0]*g,d[l.extrude_index+1]=r[1]*g,l.offset&&(d[l.offset_index+0]=n[0]*l.offset,d[l.offset_index+1]=n[1]*l.offset),l.texcoord_index!=null&&(d[l.texcoord_index+0]=o*l.texcoord_normalize,d[l.texcoord_index+1]=s*l.texcoord_normalize),y.addVertex(d)}var uvCurr=[0,0];function addFan(e,r,n,o,s,l,h,d,y,g,v){for(var m=r[0]*o[1]-r[1]*o[0],w=Vector$1.dot(r,o),I=Math.atan2(m,w);I>=Math.PI;)I-=2*Math.PI;if(g)V=1;else{var V=trianglesPerArc(I,v.half_width);if(V<1)return}var q=v.vertex_data.vertex_count,De=v.vertex_data.vertex_elements;addVertex(e,n,s,h[0],h[1],v,1),addVertex(e,r,s,l[0],l[1],v,1);var _n,ha,ga=r,_o=v.texcoord_index!=null;_o&&(y?_n=Vector$1.sub(l,h):(uvCurr=Vector$1.copy(l),ha=Vector$1.div(Vector$1.sub(d,l),V)));for(var _l,wc=I/V,_h=I<0?-1:1,_p=0<m?(_l=2,1):(_l=1,2),pd=0;pd<V;pd++)pd===0&&I<0&&(ga=Vector$1.neg(ga)),ga=Vector$1.rot(ga,wc),_o&&(y?(_n=Vector$1.rot(_n,wc),uvCurr[0]=_n[0]+h[0],uvCurr[1]=_n[1]*v.texcoord_width*v.v_scale+h[1]):uvCurr=Vector$1.add(uvCurr,ha)),addVertex(e,ga,s,uvCurr[0],uvCurr[1],v,_h),De.push(q+pd+_l),De.push(q),De.push(q+pd+_p)}function addCap(e,r,n,o,s,l){var h,d=Vector$1.neg(n),y=l.texcoord_index!=null;switch(o){case CAP_TYPE.square:s?(h=[n[1],-n[0]],addVertex(e,Vector$1.add(n,h),n,1,r,l,1),addVertex(e,Vector$1.add(d,h),n,0,r,l,1),y&&(r+=.5*l.texcoord_width*l.v_scale),addVertex(e,n,n,1,r,l,1),addVertex(e,d,n,0,r,l,1)):(h=[-n[1],n[0]],addVertex(e,n,n,1,r,l,1),addVertex(e,d,n,0,r,l,1),y&&(r+=.5*l.texcoord_width*l.v_scale),addVertex(e,Vector$1.add(n,h),n,1,r,l,1),addVertex(e,Vector$1.add(d,h),n,0,r,l,1)),indexPairs(1,l);break;case CAP_TYPE.round:var g,v,m=zero_v,w=one_v,I=mid_v;s?(g=n,v=d,y&&(r+=.5*l.texcoord_width*l.v_scale,m=one_v,w=zero_v,I=mid_v)):(g=d,v=n),y&&(zero_v[1]=r,one_v[1]=r,mid_v[1]=r),addFan(e,g,zero_vec2,v,n,m,I,w,!0,!1,l);break;case CAP_TYPE.butt:return}}function trianglesPerArc(e,r){e<0&&(e=-e);var n=r>2*DEFAULT.MIN_FAN_WIDTH?Math.log2(r/DEFAULT.MIN_FAN_WIDTH):1;return Math.ceil(e/Math.PI*n)}function permuteLine(e,r){for(var n=[],o=0;o<e.length;o++){var s=(o+r)%e.length;s!=0&&n.push(e[s])}return n.push(n[0]),n}var default_dash_color=[255,255,255,255],default_background_color=[0,0,0,0];function renderDashArray(e){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},n=r.dash_color||default_dash_color,o=r.background_color||default_background_color,s=e,l=r.scale||1;s.length%2==1&&Array.prototype.push.apply(s,s);for(var h=!0,d=[],y=0;y<s.length;y++){for(var g=Math.floor(s[y]*l),v=0;v<g;v++)Array.prototype.push.apply(d,h?n:o);h=!h}return{pixels:d=new Uint8Array(d),length:d.length/4}}var Lines=Object.create(Style);Lines.vertex_layouts=[[],[]],Lines.dash_textures={};var DASH_SCALE=20;function buildPolylines$1(e,r,n,o,s,l){for(var h={closed:l,vertex_data:n,vertex_template:o,half_width:r/2,vertex_layout_index:s,geom_count:0},d=0,y=e.length;d<y;d++)buildPolyline$1(e[d],h);return h.geom_count}function buildPolyline$1(e,r){if(!(e.length<2)){for(var n,o,s=[e[0]],l=0,h=[],d=[],y=1,g=e.length;y<g;y++)e[y][0]===e[y-1][0]&&e[y][1]===e[y-1][1]||(s.push(e[y]),n=Vector$1.sub(e[y],e[y-1]),o=Vector$1.length(n),h.push(n),d.push([l,l+o]),l+=o);if(!(s.length<2)){var v=0,m=h[h.length-1],w=h[0],I=h[1],V=[0,0];2<s.length&&(r.closed&&(V[0]=Vector$1.signedAngleBetween(m,w)),V[1]=Vector$1.signedAngleBetween(w,I));var q=s[0],De=d[0];r.closed?(addVertex$1(q,r,v++,De,l,V,[m,w]),addVertex$1(q,r,v++,De,l,V,[m,w])):(addVertex$1(q,r,v++,De,l,V,[w,w]),addVertex$1(q,r,v++,De,l,V,[w,w]));for(var _n=1,ha=s.length-1;_n<ha;_n++)q=s[_n],m=h[_n-1],w=h[_n],I=h[_n+1],addVertex$1(q,r,v++,De=d[_n-1],l,V,[m,w]),addVertex$1(q,r,v++,De,l,V,[m,w]),triangulate(r),De=d[_n],V[0]=V[1],V[1]=_n!==ha-1?Vector$1.signedAngleBetween(w,I):r.closed?Vector$1.signedAngleBetween(w,h[0]):0,addVertex$1(q,r,v++,De,l,V,[m,w]),addVertex$1(q,r,v++,De,l,V,[m,w]);q=s[s.length-1],De=d[d.length-1],w=h[h.length-1],r.closed?(addVertex$1(q,r,v++,De,l,V,[w,h[0]]),addVertex$1(q,r,v++,De,l,V,[w,h[0]])):(addVertex$1(q,r,v++,De,l,V,[w,w]),addVertex$1(q,r,v++,De,l,V,[w,w])),triangulate(r)}}}function triangulate(e){var r=e.vertex_data.vertex_elements,n=e.vertex_data.vertex_count-4;r.push(2+n),r.push(1+n),r.push(n),r.push(2+n),r.push(3+n),r.push(1+n),e.geom_count+=2}Object.assign(Lines,{name:"lines",built_in:!0,vertex_shader_src:shaderSrc_polygonsVertex,fragment_shader_src:shaderSrc_polygonsFragment,selection:!0,init:function(){Style.init.apply(this,arguments),this.styles=this.styles||{},this.defines.TANGRAM_LAYER_ORDER=!0,this.defines.TANGRAM_EXTRUDE_LINES=!0,this.defines.TANGRAM_CROP_BY_TILE=this.crop_by_tile,this.defines.TANGRAM_TEXTURE_COORDS=!0,this.outline_feature_style={},this.inline_feature_style=this.feature_style},calcDistance:function(e,r){return e&&StyleParser.evalCachedDistanceProperty(e,r)||0},calcDistanceNextZoom:function(e,r){r.zoom++;var n=this.calcDistance(e,r);return r.zoom--,n},calcWidth:function(e,r,n){var o=this.calcDistance(e.width,n);if(!(o<0)){var s,l=e.next_width?this.calcDistanceNextZoom(e.next_width,n):o/2;return o===0&&l===0||l<0?!1:(r.width_unscaled=o,r.next_width_unscaled=l,e.next_width?(s=.5*(o+(l*=2)),r.width=s*n.units_per_meter_overzoom,r.width_scale=1-l/s):(r.width=o*n.units_per_meter_overzoom,r.width_scale=0),e.texcoords&&(e.inline_texcoord_width?r.texcoord_width=e.inline_texcoord_width:r.texcoord_width=(r.width_unscaled||r.next_width_unscaled)*n.units_per_meter_overzoom/n.tile.overzoom2),!0)}},calcOffset:function(e,r,n){var o,s;e.offset_precalc?(r.offset=e.offset_precalc,r.offset_scale=e.offset_scale_precalc):e.offset?(o=this.calcDistance(e.offset,n),e.next_offset?(s=2*this.calcDistanceNextZoom(e.next_offset,n),Math.abs(o)>=Math.abs(s)?(r.offset=o*n.units_per_meter_overzoom,r.offset_scale=o!==0?1-s/o:0):(r.offset=s*n.units_per_meter_overzoom,r.offset_scale=s!=0?-1*(1-o/s):0)):(r.offset=o*n.units_per_meter_overzoom,r.offset_scale=0)):(r.offset=0,r.offset_scale=0),StyleParser.evalProperty(e.offset_reverse,n)&&(r.offset*=-1)},_parseFeature:function(e,r,n){var o,s,l=this.feature_style;if(this.calcWidth(r,l,n)!==!1&&(this.calcOffset(r,l,n),l.color=this.parseColor(r.color,n),l.color))return l.variantKey=r.variantKey,l.z=r.z&&StyleParser.evalCachedDistanceProperty(r.z||0,n)||StyleParser.defaults.z,l.height=e.properties.height||StyleParser.defaults.height,l.extrude=StyleParser.evalProperty(r.extrude,n),l.extrude&&(typeof l.extrude=="number"?l.height=l.extrude:Array.isArray(l.extrude)&&(l.height=l.extrude[1])),l.extrude&&l.height&&(l.z+=l.height),l.z*=Geo$1.height_scale,l.height*=Geo$1.height_scale,l.cap=StyleParser.evalProperty(r.cap,n),l.join=StyleParser.evalProperty(r.join,n),l.miter_limit=StyleParser.evalProperty(r.miter_limit,n),l.tile_edges=r.tile_edges,l.outline=l.outline||{width:{},next_width:{},preprocessed:!0},r.outline&&r.outline.visible!==!1&&r.outline.color&&r.outline.width?(o=2*this.calcDistance(r.outline.width,n),s=2*this.calcDistanceNextZoom(r.outline.next_width,n),o==0&&s==0||o<0||s<0?(l.outline.width.value=null,l.outline.next_width.value=null,l.outline.color=null,l.outline.inline_texcoord_width=null,l.outline.texcoords=!1):(l.outline.width.value=o+l.width_unscaled,l.outline.next_width.value=s+l.next_width_unscaled,l.outline.inline_texcoord_width=l.texcoord_width,l.outline.offset_precalc=l.offset,l.outline.offset_scale_precalc=l.offset_scale,l.outline.color=r.outline.color,l.outline.cap=r.outline.cap,l.outline.join=r.outline.join,l.outline.miter_limit=r.outline.miter_limit,l.outline.texcoords=r.outline.texcoords,l.outline.style=r.outline.style,l.outline.variantKey=r.outline.variantKey,r.outline.order?l.outline.order=this.parseOrder(r.outline.order,n):l.outline.order=l.order,l.outline.order>l.order&&(l.outline.order=l.order),l.outline.order-=.5,l.outline.variant_order=0)):(l.outline.width.value=null,l.outline.next_width.value=null,l.outline.color=null,l.outline.inline_texcoord_width=null),l},_preprocess:function(e,r){var n,o=this.sources[r]?this.sources[r].config.uid:"";return e.color=StyleParser.createColorPropertyCache(e.color),e.width=StyleParser.createPropertyCache(e.width,StyleParser.parseUnits),e.width&&e.width.type!==StyleParser.CACHE_TYPE.STATIC&&(e.next_width=StyleParser.createPropertyCache(e.width,StyleParser.parseUnits)),e.offset=e.offset&&StyleParser.createPropertyCache(e.offset,StyleParser.parseUnits),e.offset&&e.offset.type!==StyleParser.CACHE_TYPE.STATIC&&(e.next_offset=StyleParser.createPropertyCache(e.offset,StyleParser.parseUnits)),e.z=StyleParser.createPropertyCache(e.z,StyleParser.parseUnits),e.dash=e.dash!==void 0?e.dash:this.dash,e.dash_key=e.dash&&this.dashTextureKey(e.dash,o),e.dash_background_color=e.dash_background_color!==void 0?e.dash_background_color:this.dash_background_color,e.dash_background_color=e.dash_background_color&&StyleParser.parseColor(e.dash_background_color),e.texture_merged=e.dash_key||(e.texture!==void 0?e.texture:this.texture),e.texcoords=this.texcoords||e.texture_merged?1:0,this.addMeshVariantForDraw(this.base,e),e.outline&&(e.outline.style=e.outline.style||this.name,e.outline.color=StyleParser.createColorPropertyCache(e.outline.color),e.outline.width=StyleParser.createPropertyCache(e.outline.width,StyleParser.parseUnits),e.outline.next_width=StyleParser.createPropertyCache(e.outline.width,StyleParser.parseUnits),e.outline.cap=e.outline.cap||e.cap,e.outline.join=e.outline.join||e.join,e.outline.miter_limit=e.outline.miter_limit||e.miter_limit,e.outline.offset=e.offset,(n=this.styles[e.outline.style])?(e.outline.dash=e.outline.dash!==void 0?e.outline.dash:n.dash,e.outline.texture=e.outline.texture!==void 0?e.outline.texture:n.texture,e.outline.dash!=null?(e.outline.dash_key=e.outline.dash&&this.dashTextureKey(e.outline.dash,o),e.outline.texture_merged=e.outline.dash_key):e.outline.dash===null||e.outline.texture!=null?(e.outline.dash_key=null,e.outline.texture_merged=e.outline.texture):(e.outline.dash=e.dash,e.outline.dash_key=e.outline.dash&&this.dashTextureKey(e.outline.dash,o),e.outline.texture_merged=e.outline.dash_key),e.outline.dash_background_color=e.outline.dash_background_color!==void 0?e.outline.dash_background_color:n.dash_background_color,e.outline.dash_background_color=e.outline.dash_background_color!==void 0?e.outline.dash_background_color:e.dash_background_color,e.outline.dash_background_color=e.outline.dash_background_color&&StyleParser.parseColor(e.outline.dash_background_color),e.outline.texcoords=n.texcoords||e.outline.texture_merged?1:0,this.addMeshVariantForDraw(this.base,e.outline)):(log({level:"warn",once:!0},"Layer '".concat(e.layers[e.layers.length-1],"': ")+"line 'outline' specifies non-existent draw style '".concat(e.outline.style,"' (or maybe the style is ")+"defined but is missing a 'base' or has another error), skipping outlines in layer"),e.outline=null)),e},dashTextureKey:function(e,r){return"__dash_"+r+"_"+this.scene_id+"_"+JSON.stringify(e)},getDashTexture:function(e,r){var n,o=this.dashTextureKey(e,this.sources[r].config.uid);Lines.dash_textures[o]==null&&(Lines.dash_textures[o]=!0,n=renderDashArray(e,{scale:DASH_SCALE}),this.textureManager.create(this.gl,o,{data:n.pixels,height:n.length,width:1,filtering:"nearest"}))},endData:function(e){var r=this;return Style.endData.call(this,e).then(function(n){if(n){n.uniforms.u_has_line_texture=!1,n.uniforms.u_texture=r.textureManager.default,n.uniforms.u_v_scale_adjust=Geo$1.tile_scale;var o=[];for(var s in n.meshes)(function(l){var h,d,y=n.meshes[l].variant;y.texture&&((h=n.meshes[l].uniforms=n.meshes[l].uniforms||{}).u_has_line_texture=!0,h.u_texture=y.texture,h.u_texture_ratio=1,y.dash&&(h.u_v_scale_adjust=Geo$1.tile_scale*DASH_SCALE,h.u_dash_background_color=y.dash_background_color||[0,0,0,0]),y.dash_key&&Lines.dash_textures[y.dash_key]==null&&(Lines.dash_textures[y.dash_key]=!0,WorkerBroker.postMessage(r.main_thread_target+".getDashTexture",y.dash,e.source)),r.textureManager.textures[y.texture]==null?o.push(r.textureManager.syncTexturesToWorker([y.texture]).then(function(g){var v=g[y.texture];v&&(h.u_texture_ratio=v.height/v.width)})):(d=r.textureManager.textures[y.texture],h.u_texture_ratio=d.height/d.width))})(s);return e.mesh_data[r.name]=n,Promise.all(o).then(function(){return n})}return n})},computeVariantForDraw:function(e){var r=e.offset?1:0;return e.dash_key&&(r+=e.dash_key,e.dash_background_color&&(r+=e.dash_background_color)),e.texture_merged&&(r+=e.texture_merged),r=hashString(r+="/"+e.texcoords),{key:e.variantKey=r,order:e.variant_order,offset:e.offset?1:0,texcoords:e.texcoords,texture:e.texture_merged,dash:e.dash,dash_key:e.dash_key,dash_background_color:e.dash_background_color}},vertexLayoutForMeshVariant:function(e){var r;return Lines.vertex_layouts[e.key]==null&&(r=[{name:"a_position",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_extrude",size:2,type:gl$1.SHORT,normalized:!1},{name:"a_offset",size:2,type:gl$1.SHORT,normalized:!1,static:e.offset?null:[0,0]},{name:"a_scaling",size:2,type:gl$1.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:gl$1.UNSIGNED_SHORT,normalized:!0,static:e.texcoords?null:[0,0]},{name:"a_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0}],Lines.vertex_layouts[e.key]=new VertexLayout(r)),Lines.vertex_layouts[e.key]},makeVertexTemplate:function(e,r){var n=0;return this.vertex_template[n++]=0,this.vertex_template[n++]=0,this.vertex_template[n++]=e.z||0,this.vertex_template[n++]=this.scaleOrder(e.order),this.vertex_template[n++]=0,this.vertex_template[n++]=0,r.variant.offset&&(this.vertex_template[n++]=0,this.vertex_template[n++]=0),this.vertex_template[n++]=1024*e.width_scale,this.vertex_template[n++]=1024*e.offset_scale,r.variant.texcoords&&(this.vertex_template[n++]=0,this.vertex_template[n++]=0),this.vertex_template[n++]=255*e.color[0],this.vertex_template[n++]=255*e.color[1],this.vertex_template[n++]=255*e.color[2],this.vertex_template[n++]=255*e.color[3],this.selection&&(this.vertex_template[n++]=255*e.selection_color[0],this.vertex_template[n++]=255*e.selection_color[1],this.vertex_template[n++]=255*e.selection_color[2],this.vertex_template[n++]=255*e.selection_color[3]),this.vertex_template},buildLines:function(e,r,n,o,s){var l;this.feature_style=this.outline_feature_style,!r.outline||r.outline.color==null||r.outline.width.value==null||(l=this.styles[r.outline.style])&&l.addFeature(o.feature,r.outline,o),this.feature_style=this.inline_feature_style;var h=n.vertex_data,d=h.vertex_layout,y=this.makeVertexTemplate(r,n);return buildPolylines(e,r.width,h,y,{cap:r.cap,join:r.join,miter_limit:r.miter_limit,extrude_index:d.index.a_extrude,offset_index:d.index.a_offset,texcoord_index:d.index.a_texcoord,texcoord_width:r.texcoord_width,texcoord_normalize:65535,closed_polygon:s&&s.closed_polygon,remove_tile_edges:!r.tile_edges&&s&&s.remove_tile_edges,tile_edge_tolerance:Geo$1.tile_scale*o.tile.pad_scale*2,offset:r.offset,crop_by_tile:this.crop_by_tile})},buildPolygons:function(e,r,n,o){for(var s=0,l=0;l<e.length;l++)s+=this.buildLines(e[l],r,n,o,{closed_polygon:!0,remove_tile_edges:!this.crop_by_tile});return s}});var TEX_COORDS=[[1,1],[1,-1],[-1,1],[-1,-1]];function addVertex$1(e,r,n,o,s,l,h){var d,y=r.vertex_template,g=r.vertex_data;setAttribute(r,"a_position",e),setAttribute(r,"a_width",r.half_width),r.vertex_layout_index.a_barycentric&&((d=[0,0,0])[n%3]=1,setAttribute(r,"a_barycentric",d)),setAttribute(r,"a_tangents",h[0].concat(h[1])),setAttribute(r,"a_segment",o),setAttribute(r,"a_texcoord",TEX_COORDS[n%4]),setAttribute(r,"a_length",s),setAttribute(r,"a_closed",r.closed?1:0),setAttribute(r,"a_angles",l),g.addVertex(y)}function setAttribute(e,r,n){var o=n.length,s=e.vertex_template,l=e.vertex_layout_index[r],h=0;if(o)for(;h!==o;)s[l+h]=n[h],h++;else s[l+h]=n}function buildPatternBuffer(e,r){for(var n=e.reduce(function(w,I){return w+I}),o=0,s=[],l=0,h=e.length;l<=h;l+=2){var d=Math.max(1e-4,e[l%h]),y=Math.max(1e-4,e[(l+1)%h]);s.push(o,o+d),o+=d+y}for(var g=new Uint8Array(4*r),v=0,m=0;m<r;m++)(function(w){var I=n*w/(r-1),V=minIdx(s.map(function(ha){return Math.abs(ha-I)})),q=void 0,De=void 0,_n=void 0,_n=V%2==0?(q=I<=s[V]?1:0,De=s[V],s[V+1]):(q=I>s[V]?2:0,De=s[V-1],s[V]);g[v++]=s[V],g[v++]=q,g[v++]=De,g[v++]=_n})(m);return g}function minIdx(e){for(var r=e[0],n=0,o=1,s=e.length;o<s;o++)e[o]<r&&(r=e[n=o]);return n}var vertex_shader_src=`uniform vec2 u_resolution;uniform vec4 u_tile_origin;uniform float u_tile_proxy_depth;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform sampler2D u_uniforms;uniform mat4 u_model;uniform mat4 u_modelView;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform vec3 u_map_position;uniform float u_antialias;uniform vec2 u_linecaps;uniform float u_linejoin;uniform float u_miter_limit;uniform float u_dash_index;uniform vec2 u_dash_caps;uniform float u_dash_phase;uniform float u_dash_period;attribute vec4 a_position;attribute vec4 a_color;attribute float a_width;
#ifdef TANGRAM_DEBUG_TRIANGLES
attribute vec3 a_barycentric;
#endif
attribute vec2 a_normal;attribute float a_length;attribute vec2 a_segment;attribute vec2 a_texcoord;attribute vec2 a_angles;attribute vec4 a_tangents;attribute float a_closed;varying vec4 v_position;varying vec4 v_local_space_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;
#ifdef TANGRAM_DEBUG_TRIANGLES
varying vec3 v_barycentric;
#endif
varying vec2 v_segment;varying vec2 v_angles;varying vec2 v_texcoord;varying vec2 v_distances;varying vec2 v_miter;varying float v_length;varying float v_linewidth_and_closed;varying float v_joinIndicator;
#define TANGRAM_NORMAL vec3(0., 0., 1.)
#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING
varying vec4 v_modelpos_base_zoom;
#endif
#if defined(TANGRAM_LIGHTING_VERTEX)
varying vec4 v_lighting;
#endif
#ifndef TANGRAM_HEIGHT_SCALE
float TANGRAM_HEIGHT_SCALE=16.0;
#endif
#define UNPACK_SCALING(x) (x / 1024.)
#pragma tangram: camera
#pragma tangram: material
#pragma tangram: lighting
#pragma tangram: global
const float PI=3.141592653589793;const float THETA=15.0*PI/180.0;float cross(in vec2 v1,in vec2 v2){return v1.x*v2.y-v1.y*v2.x;}float signed_distance(in vec2 v1,in vec2 v2,in vec2 v3){return cross(v2-v1,v1-v3)/length(v2-v1);}void rotate(in vec2 v,in float angle,out vec2 result){float cosine=cos(angle);float sine=sin(angle);result=vec2(cosine*v.x-sine*v.y,sine*v.x+cosine*v.y);}void main(){
#pragma tangram: setup
#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING
v_modelpos_base_zoom=modelPositionBaseZoom();
#endif
float linewidth=a_width*2.0;v_angles=a_angles;v_segment=a_segment;v_color=a_color;v_length=a_length;v_texcoord=a_texcoord;
#ifdef TANGRAM_DEBUG_TRIANGLES
v_barycentric=a_barycentric;
#endif
v_color.a=min(linewidth,v_color.a);linewidth=max(linewidth,1.0);linewidth/=exp2(u_map_position.z-u_tile_origin.w);v_linewidth_and_closed=linewidth*(a_closed>0.0 ?-1.0 : 1.0);if(v_color.a<=0.0){gl_Position=vec4(0.0,0.0,0.0,1.0);return;}float width=ceil(1.25*u_antialias+linewidth)/2.0;vec2 t1=normalize(a_tangents.xy);vec2 t2=normalize(a_tangents.zw);float u=a_texcoord.x;u*=-1.0;float v=a_texcoord.y;vec4 position=vec4(a_position.xy,a_position.z/TANGRAM_HEIGHT_SCALE,1.0);if(t1!=t2){float angle=a_texcoord.x==1.0 ? a_angles.x : a_angles.y;vec2 t=normalize(t1+t2);vec2 o=vec2(+t.y,-t.x);float segmentLength=a_segment.y-a_segment.x;float magnitude=width/cos(angle/2.0);float sqMagnitude=magnitude*magnitude;float seg1SqMagnitude=dot(a_tangents.xy,a_tangents.xy);float seg2SqMagnitude=dot(a_tangents.zw,a_tangents.zw);if((abs(magnitude)>linewidth)&&(sqMagnitude>=min(seg1SqMagnitude,seg2SqMagnitude))){if(u==1.0){o=vec2(-t2.y,+t2.x);}else{o=vec2(-t1.y,+t1.x);}magnitude=width;angle=0.0;v_angles.x=0.0;v_angles.y=0.0;}if(u_dash_index>0.0){if((abs(angle)>THETA)){position.xy+=v*width*o/cos(angle/2.0);float s=sign(angle);if(angle<0.0){if(u==+1.0){u=v_segment.y+v*width*tan(angle/2.0);if(v==1.0){position.xy-=2.0*width*t1/sin(angle);u-=2.0*width/sin(angle);}}else{u=v_segment.x-v*width*tan(angle/2.0);if(v==1.0){position.xy+=2.0*width*t2/sin(angle);u+=2.0*width/sin(angle);}}}else{if(u==+1.0){u=v_segment.y+v*width*tan(angle/2.0);if(v==-1.0){position.xy+=2.0*width*t1/sin(angle);u+=2.0*width/sin(angle);}}else{u=v_segment.x-v*width*tan(angle/2.0);if(v==-1.0){position.xy-=2.0*width*t2/sin(angle);u-=2.0*width/sin(angle);}}}}else{position.xy+=v*width*o/cos(angle/2.0);if(u==+1.0){u=v_segment.y;}else{u=v_segment.x;}}}else{position.xy+=v*o*magnitude;if(u==+1.0){u=v_segment.y+v*width*tan(angle/2.0);}else{u=v_segment.x-v*width*tan(angle/2.0);}}v_joinIndicator=(segmentLength+v*width*tan(angle/2.0))/segmentLength;}else{v_joinIndicator=-1.0;vec2 o=vec2(+t1.y,-t1.x);position.xy+=v*width*o;if(u==-1.0){u=v_segment.x-width;position.xy-=width*t1;}else{u=v_segment.y+width;position.xy+=width*t2;}}vec2 t;vec2 curr=a_position.xy;if(a_texcoord.x>=0.0){vec2 next=curr+t2*(v_segment.y-v_segment.x);rotate(t1,+a_angles.x/2.0,t);v_miter.x=signed_distance(curr,curr+t,position.xy);rotate(t2,+a_angles.y/2.0,t);v_miter.y=signed_distance(next,next+t,position.xy);}else{vec2 prev=curr-t1*(v_segment.y-v_segment.x);rotate(t1,-a_angles.x/2.0,t);v_miter.x=signed_distance(prev,prev+t,position.xy);rotate(t2,-a_angles.y/2.0,t);v_miter.y=signed_distance(curr,curr+t,position.xy);}v_distances=vec2(u,v*width);v_world_position=wrapWorldPosition(u_model*position);v_local_space_position=position;position=u_modelView*position;
#pragma tangram: position
v_position=position;v_normal=normalize(u_normalMatrix*TANGRAM_NORMAL);
#if defined(TANGRAM_LIGHTING_VERTEX)
vec3 normal=v_normal;
#pragma tangram: normal
v_lighting=calculateLighting(position.xyz-u_eye,normal,vec4(1.));
#endif
cameraProjection(position);
#ifdef TANGRAM_LAYER_ORDER
applyLayerOrder(a_position.w+u_tile_proxy_depth+1.,position);
#endif
gl_Position=position;}`,fragment_shader_src=`uniform vec2 u_resolution;uniform vec4 u_tile_origin;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform sampler2D u_dash_atlas;uniform float u_antialias;uniform vec2 u_linecaps;uniform float u_linejoin;uniform float u_miter_limit;uniform float u_dash_phase;uniform float u_dash_period;uniform float u_dash_index;uniform vec2 u_dash_caps;varying vec4 v_position;varying vec4 v_local_space_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;
#ifdef TANGRAM_DEBUG_TRIANGLES
varying vec3 v_barycentric;
#endif
varying vec2 v_segment;varying vec2 v_angles;varying vec2 v_texcoord;varying vec2 v_distances;varying vec2 v_miter;varying float v_length;varying float v_linewidth_and_closed;varying float v_joinIndicator;
#define TANGRAM_NORMAL v_normal
#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING
varying vec4 v_modelpos_base_zoom;
#endif
#if defined(TANGRAM_LIGHTING_VERTEX)
varying vec4 v_lighting;
#endif
#pragma tangram: camera
#pragma tangram: material
#pragma tangram: lighting
#pragma tangram: global
#pragma tangram: utils
const float PI=3.141592653589793;const float HALF_PI=PI/2.0;const float THETA=15.0*PI/180.0;/***Compute distance to cap.*@param{int}type The Type of the cap(see CAP_TYPE in pattern_lines)*@param{float}dx The distance of the pixel from the beginning of the line(not straight distance,but along the legs)*@param{float}dy The distance of the pixel from the midline(see v_distances in vertex shader,aka ±1*half_line_width)*@param{float}aa_radius The distance from the mid-line from where antialiasing starts.*For example for a linewidth 10px width and 2px filter radius it is 10px/2-2px=3px.*@return{float}distance*/float cap(int type,float dx,float dy,float aa_radius){float dist=0.0;dx=abs(dx);dy=abs(dy);if(type==1)dist=sqrt(dx*dx+dy*dy);else if(type==3)dist=(dx+abs(dy));else if(type==2)dist=max(abs(dy),(aa_radius+dx-abs(dy)));else if(type==4)dist=max(dx,dy);else if(type==5)dist=max(dx+aa_radius,dy);return dist;}/***Compute distance to join.*@param{int}type The type of the join(see JOIN_TYPE in pattern_lines)*@param{vec2}segment Interpolated a_segment attribute from the vertex shader*@param{vec2}texcoord Pair of u/v coordinates to identify the 4 different extruded points of the segment.*@param{vec2}distances 2 component vector where:*x is the distance of the pixel from the beginning of the line(along the legs)*y is the  distance of the pixel from the midline(see v_distances in vertex shader,±1*half_line_width)*@param{vec2}miter Miter point coordiante*@param{float}miter_limit The miter limit*@param{float}linewidth The width of the line*@return{float}computed distance*/float join(in int type,in vec2 segment,in vec2 texcoord,in vec2 distances,in vec2 miter,in float miter_limit,in float linewidth){float dx=distances.x;float result=abs(distances.y);if((dx<segment.x)||(dx>segment.y)){if(type==1){float s=dx<segment.x ? segment.x : segment.y;result=max(result,length(distances-vec2(s,0.0)));}else{float m=abs(texcoord.x>=0.0 ? miter.x : miter.y);if(type==2){result=max(result,m);}else if(type==0){result=max(result,m-miter_limit*linewidth/2.0);}}}return result;}void main(void){
#pragma tangram: setup
vec4 color=v_color;vec3 normal=TANGRAM_NORMAL;
#ifdef TANGRAM_CROP_BY_TILE
if(isLocalSpacePixelOutsideTile(v_local_space_position,TANGRAM_TILE_SCALE.x)){discard;}
#endif
#if defined(TANGRAM_LIGHTING_FRAGMENT) && defined(TANGRAM_MATERIAL_NORMAL_TEXTURE)
calculateNormal(normal);
#endif
#if !defined(TANGRAM_LIGHTING_VERTEX)
#pragma tangram: normal
#endif
#pragma tangram: color
#if defined(TANGRAM_LIGHTING_FRAGMENT)
color=calculateLighting(v_position.xyz-u_eye,normal,color);
#elif defined(TANGRAM_LIGHTING_VERTEX)
color*=v_lighting;
#endif
#pragma tangram: filter
if(v_color.a<=0.0){discard;}bool solid=(u_dash_index==0.0);bool closed=v_linewidth_and_closed<0.0;float dx=v_distances.x;float dy=v_distances.y;float linewidth=abs(v_linewidth_and_closed);float aa_radius=linewidth/2.0-u_antialias;float dist=0.0;vec2 linecaps=u_linecaps;vec2 dash_caps=u_dash_caps;float line_start=0.0;float line_stop=v_length;if(solid){dist=abs(dy);bool potentialCap=!closed&&v_joinIndicator<0.0;if(potentialCap&&dx<line_start){dist=cap(int(u_linecaps.x),abs(dx),abs(dy),aa_radius);}else if(potentialCap&&dx>line_stop){dist=cap(int(u_linecaps.y),abs(dx)-line_stop,abs(dy),aa_radius);}else{dist=join(int(u_linejoin),v_segment,v_texcoord,v_distances,v_miter,u_miter_limit,linewidth);}}else{float segment_start=v_segment.x;float segment_stop=v_segment.y;float segment_center=(segment_start+segment_stop)/2.0;float freq=u_dash_period*linewidth;float dash_phase=u_dash_phase-1e-5;float u=mod(dx+dash_phase*linewidth,freq);vec4 tex=texture2D(u_dash_atlas,vec2(u/freq,u_dash_index));float dash_center=float(tex.x)*255.0*linewidth;float dash_type=floor(float(tex.y)*255.0+0.5);float _start=float(tex.z)*255.0*linewidth;float _stop=float(tex.a)*255.0*linewidth;float dash_start=dx-u+_start;float dash_stop=dx-u+_stop;if((dash_stop<segment_start)&&(dash_caps.x!=5.0)){float u=mod(segment_start+dash_phase*linewidth,freq);vec4 tex=texture2D(u_dash_atlas,vec2(u/freq,u_dash_index));dash_center=float(tex.x)*255.0*linewidth;float _start=float(tex.z)*255.0*linewidth;float _stop=float(tex.a)*255.0*linewidth;dash_start=segment_start-u+_start;dash_stop=segment_start-u+_stop;}else if((dash_start>segment_stop)&&(dash_caps.y!=5.0)){float u=mod(segment_stop+dash_phase*linewidth,freq);vec4 tex=texture2D(u_dash_atlas,vec2(u/freq,u_dash_index));dash_center=float(tex.x)*255.0*linewidth;float _start=float(tex.z)*255.0*linewidth;float _stop=float(tex.a)*255.0*linewidth;dash_start=segment_stop-u+_start;dash_stop=segment_stop-u+_stop;}bool discontinuous=((dx<segment_center)&&abs(v_angles.x)>THETA)||((dx>=segment_center)&&abs(v_angles.y)>THETA);float d_join=join(int(u_linejoin),v_segment,v_texcoord,v_distances,v_miter,u_miter_limit,linewidth);if(closed){line_start+=linewidth/2.0;line_stop-=linewidth/2.0;}if(dash_stop<=line_start){discard;}if(dash_start>=line_stop){discard;}if(discontinuous){if((dash_start>segment_stop)){discard;}if((dash_stop<segment_start)){discard;}if(dash_caps.x==1.0){if((u>_stop)&&(dash_stop>segment_stop)&&(abs(v_angles.y)<HALF_PI)){discard;}}if(dash_caps.y==1.0){if((u<_start)&&(dash_start<segment_start)&&(abs(v_angles.x)<HALF_PI)){discard;}}if((dash_caps.x!=1.0)&&(dash_caps.x!=5.0)){if((dash_start<segment_start)&&(abs(v_angles.x)<HALF_PI)){float a=v_angles.x/2.0;float cos_a=cos(a);float sin_a=sin(a);float x=(segment_start-dx)*cos_a-dy*sin_a;float y=(segment_start-dx)*sin_a+dy*cos_a;if(x>0.0){discard;}dash_caps.x=4.0;}}if((dash_caps.y!=1.0)&&(dash_caps.y!=5.0)){if((dash_stop>segment_stop)&&(abs(v_angles.y)<HALF_PI)){float a=v_angles.y/2.0;float cos_a=cos(a);float sin_a=sin(a);float x=(dx-segment_stop)*cos_a-dy*sin_a;float y=(dx-segment_stop)*sin_a+dy*cos_a;if(x>0.0){discard;}dash_caps.y=4.0;}}}if((dx<line_start)&&(dash_start<=line_start)&&(dash_stop>line_start)){dist=cap(int(linecaps.x),dx-line_start,dy,aa_radius);}else if((dx>line_stop)&&(dash_stop>line_stop)&&(dash_start<line_stop)){dist=cap(int(linecaps.y),dx-line_stop,dy,aa_radius);}else if(dash_type==1.0){dist=cap(int(dash_caps.x),abs(dash_center-u),dy,aa_radius);if((dx>line_start)&&(dx<line_stop)){dist=max(dist,d_join);}}else if(dash_type==0.0){dist=abs(dy);}else if(dash_type==2.0){dist=cap(int(dash_caps.y),abs(u-dash_center),dy,aa_radius);if((dx>line_start)&&(dx<line_stop)){dist=max(dist,d_join);}}if((dx>line_start)&&(dx<line_stop)){if((dx<=segment_start)&&(dash_start<=segment_start)&&(dash_stop>=segment_start)){dist=d_join;float angle=HALF_PI+v_angles.x;float f=abs((segment_start-dx)*cos(angle)-dy*sin(angle));dist=max(f,dist);}else if((dx>segment_stop)&&(dash_start<=segment_stop)&&(dash_stop>=segment_stop)){dist=d_join;float angle=HALF_PI+v_angles.y;float f=abs((dx-segment_stop)*cos(angle)-dy*sin(angle));dist=max(f,dist);}else if(dx<(segment_start-linewidth/2.)){discard;}else if(dx>(segment_stop+linewidth/2.)){discard;}}else if(dx<(segment_start-linewidth/2.)){discard;}else if(dx>(segment_stop+linewidth/2.)){discard;}}dist=dist-aa_radius;if(dist>=0.0){if(u_antialias==0.0){discard;}else{color=vec4(color.rgb,exp(-dist*dist)*color.a);}}
#ifdef TANGRAM_DEBUG_TRIANGLES
if(any(lessThan(v_barycentric,vec3(0.0085)))){color=vec4(0.0,1.0,0.0,1.0);}
#endif
gl_FragColor=color;}`,PatternLines=Object.create(Style),CAP_TYPE$1={round:1,"arrow-tail":2,"arrow-head":3,square:4,butt:5},JOIN_TYPE$1={miter:0,round:1,bevel:2},PATTERN_MAX_WIDTH=1024,DEFAULT_LINE_CAP=CAP_TYPE$1.round,DEFAULT_JOIN_TYPE=JOIN_TYPE$1.miter,DEFAULT_DASH_PATTERN=[0,0],VARIANT_UNIQUE_PROP_NAMES="antialias join linecaps miter_limit dash_index dash dash_caps dash_phase".split(" ");function getHashForStyle(e){for(var r=[],n=0,o=VARIANT_UNIQUE_PROP_NAMES.length;n<o;n++){var s=e[VARIANT_UNIQUE_PROP_NAMES[n]];Array.isArray(s)?r.push(s.join("_")):typeof s=="boolean"?r.push(s?1:0):s&&r.push(s.toString())}return r.join("/")}Object.assign(PatternLines,{name:"pattern-lines",built_in:!0,vertex_shader_src,fragment_shader_src,selection:!0,init:function(){Style.init.apply(this,arguments),this.defines.TANGRAM_LAYER_ORDER=!0,this.defines.TANGRAM_CROP_BY_TILE=this.crop_by_tile,this.defines.TANGRAM_DEBUG_TRIANGLES=!1,this.defines.TANGRAM_DEBUG_NO_TEXTURE_FLOAT_SUPPORT=!1,this.styles=this.styles||{},PatternLines.vertex_layouts=[]},calcDistance:function(e,r){return e&&StyleParser.evalCachedDistanceProperty(e,r)||0},calcDash:function(e,r){var n=StyleParser.evalProperty(e.dash,r),o=0;return n&&((n=Array.isArray(n)&&n.length?n:DEFAULT_DASH_PATTERN).length%2==1&&(n=n.concat(n)),o=+(o=n.reduce(function(s,l){return s+l}))||0),{dash:n,dash_period:o}},calcWidth:function(e,r,n){var o=this.calcDistance(e.width,n);return!(o<0)&&(r.width=o*n.units_per_meter_overzoom,!0)},getCapType:function(e,r,n){var o=StyleParser.evalProperty(e,r);return CAP_TYPE$1[o]!==void 0?CAP_TYPE$1[o]:n},_parseFeature:function(e,r,n){if(this.calcWidth(r,this.feature_style,n)!==!1){var o=this.parseColor(r.color,n);if(o&&o[3]!==0){var s=this.getCapType(r.cap,n,DEFAULT_LINE_CAP),l=StyleParser.evalProperty(r.join,n),h=+StyleParser.evalProperty(r.miter_limit,n),d=this.calcDash(r,n),y=d.dash,g=d.dash_period,v=Object.assign({color:o,antialias:r.antialias,linecaps:[this.getCapType(r.tail_cap,n,s),this.getCapType(r.head_cap,n,s)],join:JOIN_TYPE$1[l]!==void 0?JOIN_TYPE$1[l]:DEFAULT_JOIN_TYPE,miter_limit:0<=h?h:3,dash_index:g===0?0:1,dash:y,dash_caps:[this.getCapType(r.tail_cap,n,s),this.getCapType(r.head_cap,n,s)],dash_phase:+StyleParser.evalProperty(r.dash_phase,n)||0,dash_period:g},this.feature_style);return v.z=r.z&&StyleParser.evalCachedDistanceProperty(r.z||0,n)||StyleParser.defaults.z,v.z*=Geo$1.height_scale,v.extrude=StyleParser.evalProperty(r.extrude,n),v.extrude&&(v.extrude===!0?(v.height=e.properties.height!==void 0?e.properties.height:StyleParser.defaults.height,v.min_height=e.properties.min_height!==void 0?e.properties.min_height:StyleParser.defaults.min_height):typeof v.extrude=="number"?(v.height=v.extrude,v.min_height=0):Array.isArray(v.extrude)&&(v.min_height=v.extrude[0],v.height=v.extrude[1]),v.height*=Geo$1.height_scale,v.min_height*=Geo$1.height_scale),this.addMeshVariantForDraw(this.base,v),v}}},_preprocess:function(e){e.color=StyleParser.createColorPropertyCache(e.color),e.width=StyleParser.createPropertyCache(e.width,StyleParser.parseUnits),e.width&&e.width.type!==StyleParser.CACHE_TYPE.STATIC&&(e.next_width=StyleParser.createPropertyCache(e.width,StyleParser.parseUnits)),e.z=StyleParser.createPropertyCache(e.z,StyleParser.parseUnits);var r=+e.antialias;return e.antialias=isNaN(r)?0:r,e},buildRasterTextures:function(e,r){var n=[];for(var o in r.meshes){var s,l=this.getMeshVariantTypeForDraw({variantKey:o}),h=l.uniforms,d=l.pattern;h.u_dash_index&&(s="__dash_"+d.join("_")+"_"+e.key+"_"+e.id,n.push({name:s,data:buildPatternBuffer(d,PATTERN_MAX_WIDTH)}),h.u_dash_atlas=s,r.meshes[o].textures=[s]),r.meshes[o].uniforms=h}return r.uniforms=r.uniforms||{},n.length?WorkerBroker.postMessage(this.main_thread_target+".loadTextures",n).then(function(y){return r}):Promise.resolve(r)},loadTextures:function(e){for(var r=[],n=0;n<e.length;n++){var o=e[n],s=(s=this.textureManager.textures[o.name])||this.textureManager.create(this.gl,o.name,{filtering:"nearest",repeat:!0,width:PATTERN_MAX_WIDTH,height:1,data:o.data});r.push(s.loading)}return Promise.all(r).then(function(l){return l.map(function(h){return h.retain(),h.name})})},computeVariantForDraw:function(e){var r=getHashForStyle(e);return{key:e.variantKey=r,order:e.variant_order,uniforms:{u_antialias:e.antialias,u_linecaps:e.linecaps,u_linejoin:e.join,u_miter_limit:e.miter_limit,u_dash_index:e.dash_index,u_dash_caps:e.dash_caps,u_dash_phase:e.dash_phase,u_dash_period:e.dash_period},pattern:e.dash}},vertexLayoutForMeshVariant:function(e){var r;return PatternLines.vertex_layouts[e.key]==null&&(r=[{name:"a_position",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_width",size:1,type:gl$1.FLOAT,normalized:!1},{name:"a_tangents",size:4,type:gl$1.FLOAT,normalized:!1},{name:"a_segment",size:2,type:gl$1.FLOAT,normalized:!1},{name:"a_angles",size:2,type:gl$1.FLOAT,normalized:!1},{name:"a_texcoord",size:2,type:gl$1.FLOAT,normalized:!0},{name:"a_length",size:1,type:gl$1.FLOAT,normalized:!1},{name:"a_closed",size:1,type:gl$1.FLOAT,normalized:!1},{name:"a_selection_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0}],this.defines.TANGRAM_DEBUG_TRIANGLES&&r.push({name:"a_barycentric",size:3,type:gl$1.SHORT,normalized:!1}),PatternLines.vertex_layouts[e.key]=new VertexLayout(r)),PatternLines.vertex_layouts[e.key]},makeVertexTemplate:function(e){var r=0;return this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=e.z+e.height||0,this.vertex_template[r++]=this.scaleOrder(e.order),this.vertex_template[r++]=255*e.color[0],this.vertex_template[r++]=255*e.color[1],this.vertex_template[r++]=255*e.color[2],this.vertex_template[r++]=255*e.color[3],this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.selection&&(this.vertex_template[r++]=255*e.selection_color[0],this.vertex_template[r++]=255*e.selection_color[1],this.vertex_template[r++]=255*e.selection_color[2],this.vertex_template[r++]=255*e.selection_color[3]),this.defines.TANGRAM_DEBUG_TRIANGLES&&(this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0),this.vertex_template},buildLines:function(e,r,n,o,s){var l=4<arguments.length&&s!==void 0&&s,h=n.vertex_data,d=h.vertex_layout,y=this.makeVertexTemplate(r,n);return buildPolylines$1(e,r.width,h,y,d.index,l)},buildPolygons:function(e,r,n,o){for(var s=0,l=0,h=e.length;l<h;l++)s+=this.buildLines(e[l],r,n,o,!0);return s}});var STICK_WIDTH=1;function buildQuadsForPoints(e,r,n,o){var s,l,h,d,y,g,v=o.quad,cy=o.quad_normalize,m=o.offset,w=o.offsets,I=o.offsets_alt,V=o.pre_angles,q=o.pre_angles_alt,De=o.angle,_n=o.angles,ha=o.angles_alt,ga=o.is_flat,_o=o.elevate_by_altitude,_l=o.build_stick_points,wc=o.color,_h=o.stick_color,_p=o.curve,pd=o.texcoord_scale,oy=o.texcoord_normalize,ny=o.pre_angles_normalize,fy=o.angles_normalize,wy=o.offsets_normalize,cy=cy||1,Gy=v[0]/2*cy,jy=v[1]/2*cy,Wy=[[-Gy,-jy],[Gy,-jy],[Gy,jy],[-Gy,jy]],Iy=r.vertex_elements,vy=r.vertex_count,Ty=r.vertex_layout.index,Vy=Ty.a_texcoord,a0=Ty.a_position,zy=Ty.a_shape,h0=Ty.a_offset,k0=Ty.a_offsets,_0=Ty.a_offsets_alt,T0=Ty.a_pre_angles,x0=Ty.a_pre_angles_alt,c0=Ty.a_angles,_g=Ty.a_angles_alt,w0=Ty.a_is_flat,z0=Ty.a_is_stick,d0=Ty.a_color;Vy&&(oy=oy||1,g=[[l=(s=_slicedToArray(pd||default_uvs,4))[0],h=s[1]],[d=s[2],h],[d,y=s[3]],[l,y]]);for(var y0=0,Q0=e.length,b0=0;b0<Q0;b0++){var l0=e[b0];if(_l){for(var g0=STICK_WIDTH/2*cy,F0=+cy,G0=[[-g0,0],[+g0,0],[+g0,F0],[-g0,F0]],m0=0;m0<4;m0++)Vy&&(n[Vy+0]=g[m0][0]*oy,n[Vy+1]=g[m0][1]*oy),n[a0+0]=l0[0],n[a0+1]=l0[1],_o&&(n[a0+2]=MathUtils$1.clamp(l0[2],0,32767)),n[zy+0]=G0[m0][0],n[zy+1]=G0[m0][1],n[zy+2]=0,n[d0+0]=_h[0],n[d0+1]=_h[1],n[d0+2]=_h[2],n[d0+3]=_h[3],n[z0+0]=255,r.addVertex(n);Iy.push(vy+0),Iy.push(vy+1),Iy.push(vy+2),Iy.push(vy+2),Iy.push(vy+3),Iy.push(vy+0),vy+=4,y0+=2}for(var A0=0;A0<4;A0++)Vy&&(n[Vy+0]=g[A0][0]*oy,n[Vy+1]=g[A0][1]*oy),n[a0+0]=l0[0],n[a0+1]=l0[1],_o&&(n[a0+2]=MathUtils$1.clamp(l0[2],0,32767)),n[zy+0]=Wy[A0][0],n[zy+1]=Wy[A0][1],n[zy+2]=De,n[d0+0]=wc[0],n[d0+1]=wc[1],n[d0+2]=wc[2],n[d0+3]=wc[3],n[h0+0]=m[0],n[h0+1]=m[1],n[w0+0]=ga?255:0,_l&&(n[z0+0]=0),_p&&(n[T0+0]=ny*V[0],n[T0+1]=ny*V[1],n[T0+2]=ny*V[2],n[T0+3]=ny*V[3],n[c0+0]=fy*_n[0],n[c0+1]=fy*_n[1],n[c0+2]=fy*_n[2],n[c0+3]=fy*_n[3],n[k0+0]=wy*w[0],n[k0+1]=wy*w[1],n[k0+2]=wy*w[2],n[k0+3]=wy*w[3],I&&(n[_0+0]=wy*I[0],n[_0+1]=wy*I[1],n[_0+2]=wy*I[2],n[_0+3]=wy*I[3],n[x0+0]=ny*q[0],n[x0+1]=ny*q[1],n[x0+2]=ny*q[2],n[x0+3]=ny*q[3],n[_g+0]=fy*ha[0],n[_g+1]=fy*ha[1],n[_g+2]=fy*ha[2],n[_g+3]=fy*ha[3])),r.addVertex(n);Iy.push(vy+0),Iy.push(vy+1),Iy.push(vy+2),Iy.push(vy+2),Iy.push(vy+3),Iy.push(vy+0),vy+=4,y0+=2}return y0}var id$2=0,Label={id_prefix:"",nextLabelId:function(){return"".concat(Label.id_prefix,"/").concat(id$2++)}};function textLayoutToJSON(e){return{priority:e.priority,collide:e.collide,repeat_distance:e.repeat_distance,repeat_group:e.repeat_group,buffer:e.buffer,italic:e.italic}}var lefts=["left","top-left","bottom-left"],rights=["right","top-right","bottom-right"],tops=["top","top-left","top-right"],bottoms=["bottom","bottom-left","bottom-right"],PointAnchor$1={computeOffset:function(e,r,n,o){var l=3<arguments.length&&o!==void 0?o:null;if(!n||n==="center")return e;var s=[e[0],e[1]],l=l||this.default_buffer;return this.isLeftAnchor(n)?(s[0]-=r[0]/2,n==="left"&&(s[0]-=l[0])):this.isRightAnchor(n)&&(s[0]+=r[0]/2,n==="right"&&(s[0]+=l[1])),this.isTopAnchor(n)?(s[1]-=r[1]/2,n==="top"&&(s[1]-=l[2])):this.isBottomAnchor(n)&&(s[1]+=r[1]/2,n==="bottom"&&(s[1]+=l[3])),s},alignForAnchor:function(e){if(e&&e!=="center"){if(this.isLeftAnchor(e))return"right";if(this.isRightAnchor(e))return"left"}return"center"},isLeftAnchor:function(e){return-1<lefts.indexOf(e)},isRightAnchor:function(e){return-1<rights.indexOf(e)},isTopAnchor:function(e){return-1<tops.indexOf(e)},isBottomAnchor:function(e){return-1<bottoms.indexOf(e)},default_buffer:[2.5,2.5,1.5,.75],zero_buffer:[0,0,0,0]};function encircleLine(e,r,n,o,s){var l=[],h=n-e,d=o-r,y=MathUtils$1.getLineLength(e,r,n,o),g=2*s;if((v=y/g)<=1)l.push(e+h/2,r+d/2,s);else{var v,m=g/y,w=h*m,I=d*m;(v=y/s/2)%1&&l.push(n-w/2,o-I/2,s),v|=0;for(var V=e+w/2,q=r+I/2;v--;)l.push(V,q,s),V+=w,q+=I}return l}var LabelPoint=function(){function e(r,n,o,s){_classCallCheck(this,e),this.id=Label.nextLabelId(),this.position=[r[0],r[1]],r[2]!==void 0&&this.position.push(r[2]),this.size=n,this.layout=s,this.anchor=Array.isArray(this.layout.anchor)?this.layout.anchor[0]:this.layout.anchor,this.placed=null,this.type="point",this.parent=this.layout.parent,this.offset=this.computeOffset(),this.align=this.layout.align||PointAnchor$1.alignForAnchor(this.anchor),this._is_flat=o}return _createClass(e,[{key:"toJSON",value:function(){return{id:this.id,type:this.type,is_flat:this._is_flat,position:this.position,size:this.size,offset:this.offset,align:this.align,sides:this.getSides(),breach:!this.inTileBounds(),layout:textLayoutToJSON(this.layout)}}},{key:"inTileBounds",value:function(){var r=this.getAABB(),n=r.left,o=r.top,s=r.right,l=r.bottom;return Utils$1.pointInTile([n,o])&&Utils$1.pointInTile([s,l])}},{key:"isFlat",value:function(){return this._is_flat}},{key:"setAnchor",value:function(r){this._circles=void 0,this._aabb=void 0,this.anchor=r,this.offset=this.computeOffset()}},{key:"computeOffset",value:function(){var r,n=[this.layout.offset[0],this.layout.offset[1]];return this.parent&&(r=this.parent,n=PointAnchor$1.computeOffset(n,r.size,r.anchor,PointAnchor$1.zero_buffer),n=PointAnchor$1.computeOffset(n,r.size,this.anchor,PointAnchor$1.zero_buffer),r.offset!==StyleParser.zeroPair&&(n===StyleParser.zeroPair?n=r.offset:(n[0]+=r.offset[0],n[1]+=r.offset[1]))),PointAnchor$1.computeOffset(n,this.size,this.anchor)}},{key:"getBoundingCircles",value:function(){return this.angle?(this._circles||(r=this.layout.units_per_pixel,l=-(o=(n=this.size[0]/2*r)*Math.cos(this.angle)),h=-(s=n*Math.sin(this.angle)),y=(d=_slicedToArray(this.position,2))[0],g=d[1],o+=y,s+=g*=-1,l+=y,h+=g,v=this.size[1]/2*r,this._circles=encircleLine(o,s,l,h,v)),this._circles):[];var r,n,o,s,l,h,d,y,g,v}},{key:"getAABB",value:function(){var r,n,o,s,l;return this._aabb||(r=this.layout.units_per_pixel,n=(this.size[0]/2+this.layout.buffer[0])*r,o=(this.size[1]/2+this.layout.buffer[1])*r,s=this.position[0]+this.offset[0]*r,l=this.position[1]-this.offset[1]*r,this._aabb={left:s-n,top:l+o,right:s+n,bottom:l-o}),this._aabb}},{key:"getSides",value:function(){var r=this.getAABB(),n=r.left,o=r.top,s=r.right,l=(o+r.bottom)/2;return[n,l,s,l]}}]),e}();LabelPoint.PLACEMENT={VERTEX:0,MIDPOINT:1,SPACED:2,CENTROID:3};var PLACEMENT=LabelPoint.PLACEMENT,default_spacing=80;function placePointsOnLine(e,r,n,o){var s=[],l=o.placement,h=Math.max(r[0],r[1])*o.placement_min_length_ratio*o.units_per_pixel;switch(l){case PLACEMENT.SPACED:var d=getPositionsAndAngles(e,h,o);if(!d)return[];for(var y=d.positions,g=d.angles,v=0;v<y.length;v++){var m,w=y[v],I=g[v];o.tile_edges!==!0&&isCoordOutsideTile(w)||((m=new LabelPoint(w,r,n,o)).angle=I,s.push(m))}break;case PLACEMENT.VERTEX:for(var V,q,De,_n=0;_n<e.length-1;_n++)V=e[_n],q=e[_n+1],o.tile_edges!==!0&&isCoordOutsideTile(V)||((De=new LabelPoint(V,r,n,o)).angle=getAngle(V,q,o.angle),s.push(De));(De=new LabelPoint(q,r,n,o)).angle=getAngle(V,q,o.angle),s.push(De);break;case PLACEMENT.MIDPOINT:for(var ha=0;ha<e.length-1;ha++){var ga,_o=e[ha],_l=e[ha+1],wc=[.5*(_o[0]+_l[0]),.5*(_o[1]+_l[1])];o.tile_edges!==!0&&isCoordOutsideTile(wc)||(!h||norm(_o,_l)>h)&&((ga=new LabelPoint(wc,r,n,o)).angle=getAngle(_o,_l,o.angle),s.push(ga))}}return s}function getPositionsAndAngles(e,r,n){var o=n.units_per_pixel,s=(n.placement_spacing||default_spacing)*o,l=getLineLength(e);if(l<=r)return!1;for(var h=Math.max(Math.floor(l/s),1),d=[],y=[],g=.5*(l-(h-1)*s),v=0;v<h;v++){var m=interpolateLine(e,g,r,n),w=m.position,I=m.angle;w!=null&&I!=null&&(d.push(w),y.push(I)),g+=s}return{positions:d,angles:y}}function getAngle(e,r){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;return n==="auto"?Math.atan2(r[0]-e[0],r[1]-e[1]):n}function getLineLength(e){for(var r=0,n=0;n<e.length-1;n++)r+=norm(e[n],e[n+1]);return r}function norm(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function interpolateLine(e,r,n,o){for(var s,l,h=0,d=0;d<e.length-1;d++){var y=e[d],g=e[d+1],v=norm(y,g);if(!(v<=n)&&r<(h+=v)){s=interpolateSegment(y,g,h-r),l=getAngle(y,g,o.angle);break}}return{position:s,angle:l}}function interpolateSegment(e,r,n){var o=n/norm(e,r);return[o*e[0]+(1-o)*r[0],o*e[1]+(1-o)*r[1]]}var TextSettings$1={key:function(e){return[e.style,e.weight,e.family,e.px_size,e.fill,e.stroke,e.stroke_width,e.transform,e.text_wrap,e.max_lines,e.supersample,e.background_color,e.outline_color,e.outline_width,e.padding,Utils$1.device_pixel_ratio].join("/")},defaults:{style:"normal",weight:null,size:"12px",px_size:12,family:"Helvetica",fill:"white",text_wrap:15,max_lines:5,align:"center",stroke:null,stroke_width:0,background_color:null,outline_color:null,outline_width:0,padding:[0,0,0,0]},compute:function(e,r,n){var o={};if(r.font=r.font||this.defaults,o.can_articulate=r.can_articulate,o.fill=r.font.fill&&Utils$1.toCSSColor(StyleParser.evalCachedColorProperty(r.font.fill,n))||this.defaults.fill,o.style=r.font.style||this.defaults.style,o.weight=r.font.weight||this.defaults.weight,r.font.family?(o.family=r.font.family,o.family!==this.defaults.family&&(o.family+=", "+this.defaults.family)):o.family=this.defaults.family,o.transform=r.font.transform,o.size=r.font.size||this.defaults.size,o.supersample=r.supersample_text?1.5:1,o.px_size=StyleParser.evalCachedProperty(r.font.px_size,n)*o.supersample,o.px_size!==0){r.font.stroke&&r.font.stroke.color&&(o.stroke=Utils$1.toCSSColor(StyleParser.evalCachedColorProperty(r.font.stroke.color,n)||this.defaults.stroke),o.stroke_width=StyleParser.evalCachedProperty(r.font.stroke.width,n)||this.defaults.stroke_width),o.font_css=this.fontCSS(o);var s=r.text_wrap;return s==null&&Geo$1.geometryType(e.geometry.type)!=="line"&&(s=!0),s===!0&&(s=this.defaults.text_wrap),o.text_wrap=s,o.max_lines=r.max_lines||this.defaults.max_lines,o.background_color=r.background&&r.background.color&&!r.can_articulate?Utils$1.toCSSColor(StyleParser.evalCachedColorProperty(r.background.color,n)):this.defaults.background_color,o.outline_color=r.outline&&r.outline.color&&!r.can_articulate?Utils$1.toCSSColor(StyleParser.evalCachedColorProperty(r.outline.color,n)):this.defaults.outline_color,o.outline_width=r.outline&&r.outline.width&&!r.can_articulate?StyleParser.evalCachedProperty(r.outline.width,n):this.defaults.outline_width,o.padding=r.padding&&!r.can_articulate?StyleParser.evalCachedProperty(r.padding,n):this.defaults.padding,o}},fontCSS:function(e){return[e.style,e.weight,e.px_size+"px",e.family].filter(function(r){return r}).join(" ")}},fontfaceobserver_standalone=createCommonjsModule(function(e){function r(w,I){document.addEventListener?w.addEventListener("scroll",I,!1):w.attachEvent("scroll",I)}function n(w){this.a=document.createElement("div"),this.a.setAttribute("aria-hidden","true"),this.a.appendChild(document.createTextNode(w)),this.b=document.createElement("span"),this.c=document.createElement("span"),this.h=document.createElement("span"),this.f=document.createElement("span"),this.g=-1,this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function o(w,I){w.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;left:-999px;white-space:nowrap;font:"+I+";"}function s(w){var I=w.a.offsetWidth,V=I+100;return w.f.style.width=V+"px",w.c.scrollLeft=V,w.b.scrollLeft=w.b.scrollWidth+100,w.g!==I&&(w.g=I,1)}function l(w,I){function V(){var De=q;s(De)&&De.a.parentNode&&I(De.g)}var q=w;r(w.b,V),r(w.c,V),s(w)}function h(w,I){var V=I||{};this.family=w,this.style=V.style||"normal",this.weight=V.weight||"normal",this.stretch=V.stretch||"normal"}function d(w,I){return[w.style,w.weight,function(){if(v===null){var V=document.createElement("div");try{V.style.font="condensed 100px sans-serif"}catch{}v=V.style.font!==""}return v}()?w.stretch:"","100px",I].join(" ")}var y,g,v,m;m=v=g=y=null,h.prototype.load=function(w,I){var V=this,q=w||"BESbswy",De=0,_n=I||3e3,ha=new Date().getTime();return new Promise(function(ga,_o){var _l,wc,_h;m===null&&(m=!!document.fonts),(_l=m)&&(g===null&&(g=/OS X.*Version\/10\..*Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),_l=!g),_l?(_l=new Promise(function(_p,pd){(function oy(){new Date().getTime()-ha>=_n?pd():document.fonts.load(d(V,'"'+V.family+'"'),q).then(function(ny){1<=ny.length?_p():setTimeout(oy,25)},function(){pd()})})()}),wc=new Promise(function(_p,pd){De=setTimeout(pd,_n)}),Promise.race([wc,_l]).then(function(){clearTimeout(De),ga(V)},function(){_o(V)})):(_h=function(){function _p(){var vy;(vy=fy!=-1&&wy!=-1||fy!=-1&&cy!=-1||wy!=-1&&cy!=-1)&&((vy=fy!=wy&&fy!=cy&&wy!=cy)||(y===null&&(vy=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),y=!!vy&&(parseInt(vy[1],10)<536||parseInt(vy[1],10)===536&&parseInt(vy[2],10)<=11)),vy=y&&(fy==Gy&&wy==Gy&&cy==Gy||fy==jy&&wy==jy&&cy==jy||fy==Wy&&wy==Wy&&cy==Wy)),vy=!vy),vy&&(Iy.parentNode&&Iy.parentNode.removeChild(Iy),clearTimeout(De),ga(V))}var pd=new n(q),oy=new n(q),ny=new n(q),fy=-1,wy=-1,cy=-1,Gy=-1,jy=-1,Wy=-1,Iy=document.createElement("div");Iy.dir="ltr",o(pd,d(V,"sans-serif")),o(oy,d(V,"serif")),o(ny,d(V,"monospace")),Iy.appendChild(pd.a),Iy.appendChild(oy.a),Iy.appendChild(ny.a),document.body.appendChild(Iy),Gy=pd.a.offsetWidth,jy=oy.a.offsetWidth,Wy=ny.a.offsetWidth,function vy(){var Ty;new Date().getTime()-ha>=_n?(Iy.parentNode&&Iy.parentNode.removeChild(Iy),_o(V)):((Ty=document.hidden)!==!0&&Ty!==void 0||(fy=pd.a.offsetWidth,wy=oy.a.offsetWidth,cy=ny.a.offsetWidth,_p()),De=setTimeout(vy,50))}(),l(pd,function(vy){fy=vy,_p()}),o(pd,d(V,'"'+V.family+'",sans-serif')),l(oy,function(vy){wy=vy,_p()}),o(oy,d(V,'"'+V.family+'",serif')),l(ny,function(vy){cy=vy,_p()}),o(ny,d(V,'"'+V.family+'",monospace'))},document.body?_h():document.addEventListener?document.addEventListener("DOMContentLoaded",function _p(){document.removeEventListener("DOMContentLoaded",_p),_h()}):document.attachEvent("onreadystatechange",function _p(){document.readyState!="interactive"&&document.readyState!="complete"||(document.detachEvent("onreadystatechange",_p),_h())}))})},e.exports=h}),FontManager={fonts_loaded:Promise.resolve(),last_loaded:null,loadFonts:function(e){var r=this,n=JSON.stringify(e)===this.last_loaded;return e&&!n&&function(){var o=[];for(var s in e)(function(l){Array.isArray(e[l])?e[l].forEach(function(h){return o.push(r.loadFontFace(l,h))}):o.push(r.loadFontFace(l,e[l]))})(s);r.last_loaded=JSON.stringify(e),r.fonts_loaded=Promise.all(o.filter(function(l){return l}))}(),this.fonts_loaded},loadFontFace:function(e,r){if(r!=null&&(_typeof(r)==="object"||r==="external")){var n={family:e},o=Promise.resolve();_typeof(r)==="object"&&(Object.assign(n,r),typeof r.url=="string"&&(o=this.injectFontFace(n)));var s=new fontfaceobserver_standalone(e,n);return o.then(function(){return s.load()}).then(function(){log("debug","Font face '".concat(e,"' is available"),n)},function(){log("debug","Font face '".concat(e,"' is NOT available"),n)})}},injectFontFace:function(e){var r=this,n=e.family,o=e.url,s=e.weight,l=e.style;this.supports_native_font_loading===void 0&&(this.supports_native_font_loading=window.FontFace!==void 0);var h=Promise.resolve(o);return o.slice(0,5)==="blob:"&&(h=Utils$1.io(o,6e4,"arraybuffer").then(function(d){var y=new Uint8Array(d);if(r.supports_native_font_loading)return y;for(var g="",v=0;v<y.length;v++)g+=String.fromCharCode(y[v]);return"data:font/opentype;base64,"+btoa(g)})),h.then(function(d){var y,g,v;r.supports_native_font_loading?(typeof d=="string"?y=new FontFace(n,"url(".concat(encodeURI(d),")"),{weight:s,style:l}):d instanceof Uint8Array&&(y=new FontFace(n,d,{weight:s,style:l})),document.fonts.add(y),log("trace","Adding FontFace to document.fonts:",y)):(g=`
                    @font-face {
                        font-family: '`.concat(n,`';
                        font-weight: `).concat(s||"normal",`;
                        font-style: `).concat(l||"normal",`;
                        src: url(`).concat(encodeURI(d),`);
                    }
                `),(v=document.createElement("style")).appendChild(document.createTextNode("")),document.head.appendChild(v),v.sheet.insertRule(g,0),log("trace","Injecting CSS font face:",g))})}},CanvasText=function(){function e(){_classCallCheck(this,e),this.vertical_text_buffer=1,this.horizontal_text_buffer=1,this.layout=layout("binary-tree")}return _createClass(e,[{key:"createCanvas",value:function(r,n){var o=document.createElement("canvas");return r&&n&&(o.width=r,o.height=n),o.style.backgroundColor="transparent",o}},{key:"setFont",value:function(r,n){var o=n.font_css,s=n.fill,l=n.stroke,h=n.stroke_width,d=n.px_size,y=n.supersample;this.px_size=d;var g=Utils$1.device_pixel_ratio*y;l&&0<h&&(r.strokeStyle=l,r.lineWidth=h*g),r.fillStyle=s,r.textBaseline="bottom",r.font=o,r.miterLimit=2}},{key:"textSizes",value:function(r,n,o){var s=this;return FontManager.loadFonts().then(function(){return Task.add({type:"textSizes",run:s.processTextSizesTask.bind(s),texts:n,tile_id:r,cursor:{ctx:o,styles:Object.keys(n),texts:null,style_idx:null,text_idx:null}})})}},{key:"processTextSizesTask",value:function(r){var n=r.cursor,o=r.texts,s=n.ctx;for(n.style_idx=n.style_idx||0;n.style_idx<n.styles.length;){var l=n.styles[n.style_idx];n.text_idx==null&&(n.text_idx=0,n.texts=Object.keys(o[l]));for(var h=o[l],d=!0;n.text_idx<n.texts.length;){var y=n.texts[n.text_idx],g=h[y],v=g.text_settings;if(d&&(this.setFont(s,v),d=!1),g.size=this.textSize(s,l,y,v).size,v.can_articulate){var m=!1,w=!1;if(isTextRTL(y)&&(isTextNeutral(y)?m=!0:w=!0),g.isRTL=m,g.no_curving=w||isTextCurveBlacklisted(y),g.vertical_buffer=this.vertical_text_buffer+v.outline_width+(v.padding[0]+v.padding[2])/2,g.segment_sizes=[],!g.no_curving){var I=splitLabelText(y,m);g.segments=I;for(var V=0;V<I.length;V++)g.segment_sizes.push(this.textSize(s,l,I[V],v).size)}}if(n.text_idx++,!Task.shouldContinue(r))return!1}n.text_idx=null,n.style_idx++}return Task.finish(r,{texts:o}),!0}},{key:"textSize",value:function(r,n,o,s){var l=s.transform,h=s.text_wrap,d=s.max_lines,y=s.stroke_width,g=y===void 0?0:y,v=s.supersample,m=s.padding,w=s.outline_width,I=s.can_articulate;if(e.cache.text[n]=e.cache.text[n]||{},e.cache.text[n][o])return e.cache.stats.text_hits++,e.cache.text[n][o];e.cache.stats.text_misses++,e.cache.text_count++;var V=Utils$1.device_pixel_ratio*v,q=this.applyTextTransform(o,l),De=V*(this.vertical_text_buffer+w+(m[0]+m[2])/2),_n=V*(this.horizontal_text_buffer+w+g+(m[1]+m[3])/2),ha=2*V,ga=this.px_size+ha,_o=MultiLine.parse(q,h,d,ga,r),_l=_o.height,wc=_o.width,_h=_o.lines,_p=[wc/V,_l/V];I||(_p[0]+=2*_n/V,_p[1]+=2*De/V);var pd=[wc+2*_n,_l+2*De],oy=[pd[0]/V,pd[1]/V];return e.cache.text[n][o]={lines:_h,size:{collision_size:_p,texture_size:pd,logical_size:oy,line_height:ga}},e.cache.text[n][o]}},{key:"drawTextMultiLine",value:function(r,n,o,s,l,h){var d=_slicedToArray(o,2),y=d[0],g=d[1],v=Utils$1.device_pixel_ratio*l.supersample,m=l.stroke_width||0,w=l.stroke;l.background_color&&(r.fillStyle=l.background_color,r.fillRect(y,g,s.texture_size[0],s.texture_size[1]));var I=l.outline_width*v,V=l.outline_color;I&&V&&(r.strokeStyle=V,r.lineWidth=I,r.strokeRect(y+I/2,g+I/2,s.texture_size[0]-I,s.texture_size[1]-I)),(l.background_color||I&&V)&&this.setFont(r,l);for(var q,De,_n,ha,ga=s.line_height,_o=g,_l=0;_l<n.length;_l++){var wc=n[_l];this.drawTextLine(r,wc,[y,_o],s,l,h),_o+=ga}debugSettings$1.draw_label_collision_boxes&&(r.save(),q=v*(this.horizontal_text_buffer+l.outline_width+m+(l.padding[1]+l.padding[3])/2),De=v*(this.vertical_text_buffer+l.outline_width+(l.padding[0]+l.padding[2])/2),_n=s.collision_size,r.strokeStyle="blue",r.lineWidth=2,r.strokeRect(y+q,g+De,v*_n[0],v*_n[1]),h==="curved"&&w&&0<m&&r.strokeRect(y+s.texture_size[0]+q,g+De,v*_n[0],v*_n[1]),r.restore()),debugSettings$1.draw_label_texture_boxes&&(r.save(),ha=s.texture_size,r.strokeStyle="green",r.lineWidth=2,r.strokeRect(y+2,g+2,ha[0]-4,ha[1]-4),h==="curved"&&w&&0<m&&r.strokeRect(y+2+s.texture_size[0],g+2,ha[0]-4,ha[1]-4),r.restore())}},{key:"drawTextLine",value:function(r,n,o,s,l,h){var d,y=_slicedToArray(o,2),g=y[0],v=y[1],m=l.stroke,w=l.stroke_width,I=w===void 0?0:w,V=l.transform,ga=l.align,q=l.supersample,De=l.padding,_n=l.outline_width,ha=Utils$1.device_pixel_ratio*q,ga=ga||"center",_o=s.texture_size,_l=s.line_height,wc=ha*(this.vertical_text_buffer+_n),_h=ha*(this.horizontal_text_buffer+_n+I),_p=this.applyTextTransform(n.text,V);ga==="left"?d=g+_h+De[3]*ha:ga==="center"?d=g+_o[0]/2-n.width/2-(De[1]-De[3])*ha/2:ga==="right"&&(d=g+_o[0]-n.width-_h-De[1]*ha);var pd,oy=v+wc+_l+De[0]*ha;m&&0<I&&(pd=h==="curved"?_o[0]:0,r.strokeText(_p,d+pd,oy)),r.fillText(_p,d,oy)}},{key:"rasterize",value:function(r,n,o,s,l,h){return Task.removeForTile(o),Task.add({type:"rasterizeLabels",run:this.processRasterizeTask.bind(this),cancel:e.returnNoTextures,pause_factor:2,user_moving_view:!1,texts:r,textures:n,texture_prefix:s,gl:l,tile_id:o,texture_manager:h,cursor:{styles:Object.keys(r),texts:null,style_idx:0,text_idx:null,texture_idx:0,texture_names:[]}})}},{key:"processRasterizeTask",value:function(r){if(!Task.shouldContinue(r))return!1;for(var n=r.cursor,o=r.texts,s=r.textures;n.texture_idx<r.textures.length;){for(var l=!1,h=s[n.texture_idx],d=this.createCanvas.apply(this,_toConsumableArray(h.texture_size)),y=d.getContext("2d");n.style_idx<n.styles.length;){var g=n.styles[n.style_idx];n.text_idx==null&&(n.text_idx=0,n.texts=Object.keys(o[g]));for(var v=o[g],m=!0;n.text_idx<n.texts.length;){var w=n.texts[n.text_idx],I=v[w],V=I.text_settings;if(m&&(this.setFont(y,V),m=!1),V.can_articulate){I.texcoords=I.texcoords||{};for(var q=0;q<I.type.length;q++){var De=I.type[q];switch(De){case"straight":if(I.textures[q]!==n.texture_idx)continue;var _n,ha,ga,_o,_l=I.isRTL?w.split().reverse().join():w,wc=h.texcoord_cache[g][_l],_h=void 0;wc.texcoord?_h=wc.texcoord:(_n=wc.texture_position,ga=(ha=this.textSize(y,g,_l,V)).size,_o=ha.lines,this.drawTextMultiLine(y,_o,_n,ga,V,De),_h=r.texture_manager.getTexcoordsForSprite(_n,ga.texture_size,h.texture_size),wc.texcoord=_h),I.texcoords[De]={texcoord:_h,texture_id:wc.texture_id};break;case"curved":var _p=I.segments;I.texcoords.curved=[],I.texcoords_stroke=[];for(var pd,oy,ny,fy,wy,cy,Gy,jy,Wy=0;Wy<_p.length;Wy++)I.textures[q][Wy]===n.texture_idx&&(pd=_p[Wy],fy=ny=void 0,(oy=h.texcoord_cache[g][pd]).texcoord&&oy.texcoord_stroke?(ny=oy.texcoord,fy=oy.texcoord_stroke):(wy=oy.texture_position,Gy=(cy=this.textSize(y,g,pd,V)).size,jy=cy.lines,this.drawTextMultiLine(y,jy,wy,Gy,V,De),ny=r.texture_manager.getTexcoordsForSprite(wy,Gy.texture_size,h.texture_size),fy=V.stroke&&0<V.stroke_width?r.texture_manager.getTexcoordsForSprite([wy[0]+Gy.texture_size[0],wy[1]],Gy.texture_size,h.texture_size):(l=!0,r.texture_manager.getTexcoordsForSprite([h.texture_size[0],h.texture_size[1]],[0,0],h.texture_size)),oy.texcoord=ny,oy.texcoord_stroke=fy),I.texcoords_stroke.push(fy),I.texcoords.curved.push({texcoord:ny,texture_id:oy.texture_id}))}}}else{var Iy=this.textSize(y,g,w,V).lines;for(var vy in I.align)I.align[vy].texture_id===n.texture_idx&&(this.drawTextMultiLine(y,Iy,I.align[vy].texture_position,I.size,{stroke:V.stroke,stroke_width:V.stroke_width,transform:V.transform,supersample:V.supersample,align:vy,background_color:V.background_color,outline_width:V.outline_width,outline_color:V.outline_color,padding:V.padding,fill:V.fill,font_css:V.font_css,px_size:V.px_size}),I.align[vy].texcoords=r.texture_manager.getTexcoordsForSprite(I.align[vy].texture_position,I.size.texture_size,h.texture_size))}n.text_idx++}n.text_idx=null,n.style_idx++}l===!0&&(y.fillStyle="rgba(0, 0, 0, 0)",y.fillRect(d.width-1,d.height-1,1,1));var Ty=r.texture_prefix+n.texture_idx;r.texture_manager.create(r.gl,Ty,{element:d,filtering:"linear",UNPACK_PREMULTIPLY_ALPHA_WEBGL:!0}),n.texture_names.push(Ty),n.texture_idx++,n.style_idx=0,d.width=0,d.height=0}return Task.finish(r,n.texture_names),!0}},{key:"setTextureTextPositions",value:function(r){var n={texture_id:0,texcoord_cache:{}},o=[];for(var s in r){var l=r[s];for(var h in l){var d=l[h],y=d.text_settings,g=y.can_articulate,v=y.stroke,m=y.stroke_width;if(g){d.textures=[],n.texcoord_cache[s]=n.texcoord_cache[s]||{};for(var w=0;w<d.type.length;w++)switch(d.type[w]){case"straight":var I,V=d.isRTL?h.split().reverse().join():h;n.texcoord_cache[s][V]||(I=d.size.texture_size,n.texcoord_cache[s][V]={},this.placeText(I[0],I[1],{can_articulate:g,style:s,word:V})),d.textures[w]=n.texture_id;break;case"curved":d.textures[w]=[];for(var q=0;q<d.segment_sizes.length;q++){var De,_n,ha=d.segments[q];n.texcoord_cache[s][ha]||(_n=(De=d.segment_sizes[q].texture_size)[0],v&&0<m&&(_n*=2),n.texcoord_cache[s][ha]={},this.placeText(_n,De[1],{can_articulate:g,style:s,word:ha})),d.textures[w].push(n.texture_id)}}}else{var ga=d.size.texture_size;this.placeText(ga[0],ga[1],{can_articulate:g,text_info:d})}}}var _o=this.layout.export(),_l=_o.items,wc=_o.width,_h=_o.height;n.texcoord_cache={};for(var _p=0,pd=_l.length;_p<pd;_p++){var oy=_l[_p],ny=oy.x,fy=oy.y;if(oy.meta.can_articulate){var Gy=oy.meta,jy=Gy.style,Wy=Gy.word;n.texcoord_cache[jy]=n.texcoord_cache[jy]||{},n.texcoord_cache[jy][Wy]||(n.texcoord_cache[jy][Wy]={texture_id:n.texture_id,texture_position:[ny,fy]})}else{var wy=oy.meta.text_info;for(var cy in wy.align)wy.align[cy].texture_id=n.texture_id,wy.align[cy].texture_position=[ny,fy]}}return 0<wc&&0<_h&&(o[n.texture_id]={texture_size:[wc,_h],texcoord_cache:n.texcoord_cache}),o}},{key:"placeText",value:function(r,n,o){this.layout.addItem({width:r+this.vertical_text_buffer,height:n+this.vertical_text_buffer,meta:o})}},{key:"applyTextTransform",value:function(r,n){return n==="capitalize"?r.replace(/\w\S*/g,function(o){return o.charAt(0).toUpperCase()+o.substr(1)}):n==="uppercase"?r.toUpperCase():n==="lowercase"?r.toLowerCase():r}}],[{key:"fontPixelSize",value:function(r){if(r!=null){var n=_slicedToArray((r=typeof r=="string"?r:String(r)).match(e.font_size_re)||[],3),o=n[1],s=n[2];return(s=s||"px")==="em"?o*=16:s==="pt"?o/=.75:s==="%"&&(o/=6.25),o=StyleParser.parsePositiveNumber(o),o*=Utils$1.device_pixel_ratio}}},{key:"pruneTextCache",value:function(){e.cache.text_count>e.cache.text_count_max&&(e.cache.text={},e.cache.text_count=0,log("debug","CanvasText: pruning text cache")),Object.keys(e.cache.segment).length>e.cache.segment_count_max&&(e.cache.segment={},log("debug","CanvasText: pruning segment cache"))}}]),e}();CanvasText.font_size_re=/((?:[0-9]*\.)?[0-9]+)\s*(px|pt|em|%)?/,CanvasText.cache={text:{},text_count:0,text_count_max:2e3,segment:{},segment_count_max:2e3,stats:{text_hits:0,text_misses:0,segment_hits:0,segment_misses:0}},CanvasText.EMPTY_TEXTURES_ARR=[],CanvasText.returnNoTextures=function(){return CanvasText.EMPTY_TEXTURES_ARR};var rtlDirCheck=new RegExp("[֑-߿‏‫‮יִ-﷽ﹰ-ﻼ]");function isTextRTL(e){return rtlDirCheck.test(e)}var neutral_chars="\0-/:-@[-`{-¿×÷ʹ-˿ -⯿‐-\u2029‬ -⯿",neutralDirCheck=new RegExp("["+neutral_chars+"]+");function isTextNeutral(e){return neutralDirCheck.test(e)}var markRTL="‏",arabic_range=new RegExp("^["+neutral_chars+"؀-ۿ]+"),arabic_splitters=new RegExp("["+neutral_chars+"آ-إاد-زوٱ-ٷڈ-ڙۄ-ۋۏےۓۮۯ]"),arabic_vowels=new RegExp("^[ؐ-ًؚ-ٰٟۖ-ۜ۟-۪ۤۧۨ-ۭ]+"),accents_and_vowels="[̀-֑ͯ-ׇֽֿׁׂׅׄަ-ްऀ-ःऺ-ौॎॏ॑-ॗॢॣঁ-ঃ়া-ৌৗৢৣਁ-ਃ਼-ੌੑઁ-ઃ઼ા-ૌૢૣଁ-ଃ଼ା-ୌୖୗୢୣஂா-்ௗఀ-ఃా-ౌౕౖౢౣಁ-ಃ಼ಾ-ೌೕೖೢೣഁ-ഃാ-ൌൎൗൢൣංඃ්-ෟෲෳัิ-ฺ็-๎ັິ-ຼ່-ໍ༹༘༙༵༷༾༿ཱ-ྃ྆྇ྍ-ྼ࿆ါ-း်-ှၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏႚ-ႝ឴-៑៓ᩕ-ᩞᩡ-᩼᷀-᷿⃐-⃿]",combo_characters="[्্੍્୍్್്྄္្᩠᩿]",graphemeRegex=new RegExp("^.(?:"+accents_and_vowels+"+)?("+combo_characters+"\\W(?:"+accents_and_vowels+"+)?)*"),curve_blacklist={Mongolian:"᠀-᢯"},curve_blacklist_range=Object.keys(curve_blacklist).map(function(e){return curve_blacklist[e]}).join(""),curve_blacklist_test=new RegExp("["+curve_blacklist_range+"]");function isTextCurveBlacklisted(e){return curve_blacklist_test.test(e)}var default_segment_length=2;function splitLabelText(e,r){var n=r?1:default_segment_length;if(e.length<n)return[e];var o=e;if(CanvasText.cache.segment[o])return CanvasText.cache.stats.segment_hits++,CanvasText.cache.segment[o];var s=[];if(arabic_range.exec(e)){s=e.split(arabic_splitters);for(var l,h=-1,d=0;d<s.length-1;d++)0<d&&(l=arabic_vowels.exec(s[d]))&&(s[d]=s[d].substring(l[0].length),s[d-1]+=l[0],h+=l[0].length),h+=1+s[d].length,s[d]+=e.slice(h,h+1);e=""}for(;e.length;){for(var y="",g=e,v=0;v<n&&g.length;v++){var m=(graphemeRegex.exec(g)||g)[0];y+=m,g=g.substring(m.length)}s.push(y),e=e.substring(y.length)}return r&&s.reverse(),CanvasText.cache.stats.segment_misses++,CanvasText.cache.segment[o]=s}var MultiLine=function(){function e(r){var n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1/0,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1/0;_classCallCheck(this,e),this.width=0,this.height=0,this.lines=[],this.max_lines=n,this.text_wrap=o,this.context=r}return _createClass(e,[{key:"createLine",value:function(r){return this.lines.length<this.max_lines&&new Line(r,this.text_wrap)}},{key:"push",value:function(r){if(this.lines.length<this.max_lines){var n=this.context.measureText(r.text).width;return(r.width=n)>this.width&&(this.width=Math.ceil(n)),this.lines.push(r),this.height+=r.height,!0}return this.addEllipsis(),!1}},{key:"advance",value:function(r,n){return!!this.push(r)&&this.createLine(n)}},{key:"addEllipsis",value:function(){var r=this.lines[this.lines.length-1],n=Math.ceil(this.context.measureText(e.ellipsis).width);r.append(e.ellipsis),r.width+=n,r.width>this.width&&(this.width=r.width)}},{key:"finish",value:function(r){r?this.push(r):this.addEllipsis()}}],[{key:"parse",value:function(r,n,o,s,l){for(var h=typeof n=="number"?r.split(" "):[r],d=new e(l,o,n),y=d.createLine(s),g=0;g<h.length;g++){for(var v=h[g].split(`
`),m=g===0,w=0;w<v.length&&y;w++){var I=v[w];isTextRTL(I)&&isTextNeutral(I[I.length-1])&&(I+=markRTL);var V=m?I:" "+I;if(n&&0<g&&y.exceedsTextwrap(V)){if(!(y=d.advance(y,s)))break;y.append(I),m=!0}else y.append(V);w<v.length-1&&(y=d.advance(y,s),m=!0)}g===h.length-1&&d.finish(y)}return d}}]),e}();MultiLine.ellipsis="...";var Line=function(){function e(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;_classCallCheck(this,e),this.chars=0,this.text="",this.height=Math.ceil(r),this.text_wrap=n}return _createClass(e,[{key:"append",value:function(r){this.chars+=r.length,this.text+=r}},{key:"exceedsTextwrap",value:function(r){return r.length+this.chars>this.text_wrap}}]),e}(),TextLabels={resetText:function(){this.texts={}},freeText:function(e){delete this.texts[e.id]},parseTextFeature:function(e,r,n,o){var s=this.parseTextSource(e,r,n);if(s!=null&&s!==""){var l=TextSettings$1.compute(e,r,n);if(l){var h=TextSettings$1.key(l);this.texts[o.id]=this.texts[o.id]||{};var d=this.texts[o.id][h]=this.texts[o.id][h]||{};if(s instanceof Object){var y=[],g=s.left+"-"+s.right;for(var v in s){var m,w=s[v];w&&(m=this.computeTextLayout({},e,r,n,o,w,l,g,v),d[w]||(d[w]={text_settings:l,ref:0}),y.push({draw:r,text:w,text_settings_key:h,layout:m}))}return 0<y.length&&y}var I=this.computeTextLayout({},e,r,n,o,s,l);return d[s]||(d[s]={text_settings:l,ref:0}),{draw:r,text:s,text_settings_key:h,layout:I}}}},parseTextSource:function(e,r,n){var o,s=r.text_source||"name";if(s!=null&&_typeof(s)==="object")for(var l in o={},s)o[l]=this.parseTextSourceValue(s[l],e,n);else o=this.parseTextSourceValue(s,e,n);return o},parseTextSourceValue:function(e,r,n){var o;if(Array.isArray(e)){for(var s=0;s<e.length;s++)if(typeof e[s]=="string"?o=r.properties[e[s]]:typeof e[s]=="function"&&(o=e[s](n)),o)return o}else typeof e=="string"?o=r.properties[e]:e instanceof Function&&(o=e(n));return o},prepareTextLabels:function(e,r,n){var o=this;return Object.keys(this.texts[e.id]||{}).length===0?Promise.resolve([]):WorkerBroker.postMessage(this.main_thread_target+".calcTextSizes",e.id,this.texts[e.id]).then(function(s){var l=s.texts;return e.canceled?(log("trace","Style ".concat(o.name,": stop tile build because tile was canceled: ").concat(e.key,", post-calcTextSizes()")),[]):(o.texts[e.id]=l||[],l?o.buildTextLabels(e,n):(Collision.abortTile(e.id),[]))})},collideAndRenderTextLabels:function(e,r,n){var o=this;return this.prepareTextLabels(e,r,n).then(function(s){return s.length===0?(Collision.collide([],r,e.id),Promise.resolve({})):Collision.collide(s,r,e.id).then(function(l){if(e.canceled)return log("trace","stop tile build because tile was canceled: ".concat(e.key,", post-collide()")),{};var h=o.texts[e.id];return h==null||l.length===0?{}:(o.cullTextStyles(h,l),l.forEach(function(d){var y=d.text_settings_key,g=h[y]&&h[y][d.text];g.text_settings.can_articulate?(g.type||(g.type=[]),g.type.indexOf(d.label.type)===-1&&g.type.push(d.label.type)):(g.align=g.align||{},g.align[d.label.align]={})}),{labels:l,texts:h,textures:[]})})})},cullTextStyles:function(e,r){for(var n=0;n<r.length;n++){var o=r[n];e[o.text_settings_key][o.text].ref++}for(var s in e)for(var l in e[s])e[s][l].ref<1&&delete e[s][l];for(var h in e)Object.keys(e[h]).length===0&&delete e[h]},calcTextSizes:function(e,r){return this._canvas_text||(this._canvas_text=new CanvasText,this._canvas_ctx_for_sizes=this._canvas_text.createCanvas().getContext("2d")),this._canvas_text.textSizes(e,r,this._canvas_ctx_for_sizes)},preprocessText:function(e){if(e&&e.font&&_typeof(e.font)==="object")return e.font.fill=StyleParser.createPropertyCache(e.font.fill),e.font.stroke&&(e.font.stroke.color=StyleParser.createPropertyCache(e.font.stroke.color)),e.background&&e.background.color&&(e.background.color=StyleParser.createPropertyCache(e.background.color)),e.outline&&(e.outline.color&&(e.outline.color=StyleParser.createPropertyCache(e.outline.color)),e.outline.width&&(e.outline.width=StyleParser.createPropertyCache(e.outline.width,StyleParser.parsePositiveNumber))),e.padding&&(Array.isArray(e.padding)?e.padding.length===2&&(e.padding=[e.padding[0],e.padding[1],e.padding[0],e.padding[1]]):e.padding=Array(4).fill(e.padding),e.padding=StyleParser.createPropertyCache(e.padding,function(r){return r.map(StyleParser.parsePositiveNumber)})),e.font.px_size=StyleParser.createPropertyCache(e.font.size||TextSettings$1.defaults.size,CanvasText.fontPixelSize),e.font.stroke&&e.font.stroke.width!=null&&(e.font.stroke.width=StyleParser.createPropertyCache(e.font.stroke.width,StyleParser.parsePositiveNumber)),e.offset=StyleParser.createPropertyCache(e.offset,function(r){return Array.isArray(r)&&r.map(StyleParser.parseNumber)}),e.buffer=StyleParser.createPropertyCache(e.buffer,function(r){return(Array.isArray(r)?r:[r,r]).map(StyleParser.parsePositiveNumber)}),e.repeat_distance=StyleParser.createPropertyCache(e.repeat_distance||Geo$1.tile_size,StyleParser.parsePositiveNumber),e},computeTextLayout:function(e,r,n,o,s,l,h,d,y){var g=e||{};return(g=this.computeLayout(g,r,n,o,s)).repeat_distance&&(d&&(g.repeat_group+="/"+d),g.repeat_group+="/"+l),g.subdiv=s.overzoom2,g.align=n.align,g.italic=h.style!=="normal",y==="right"?g.orientation=1:y==="left"&&(g.orientation=-1),g}};function degToRad(e){return e*Math.PI/180}var PI_OVER_180=Math.PI/180,HORIZON_THRESHOLD_MULTIPLIER=.75,ZOOM_FOR_BOUNDS_EPSILON=.001,NEAR_PLANE=1,LookAtManipulator=function(){function e(r,n){_classCallCheck(this,e),this._min_zoom=H.util.constants.DEFAULT_MIN_ZOOM_LEVEL,this._max_zoom=H.util.constants.DEFAULT_MAX_ZOOM_LEVEL,this._viewport=r,this._center_offset=[],this._center_offset_normalized=[],this._viewport_aspect_ratio=1,this._focal_length=[[16,2],[17,2.5],[18,3],[19,4],[20,6]],this._view_matrix=new Float64Array(16),this._projection_matrix=new Float64Array(16),this._heading_matrix=new Float64Array(16),this._tilt_matrix=new Float64Array(16),this._transformation_matrix=new Float64Array(16),this._camera_matrix=new Float64Array(16),this._lookAtData={position:[0,0,0],zoom:0,tile_level:0,tetragon:void 0,bounds:void 0,unpadded_bounds:void 0,distance:void 0,tilt:0,incline:0,heading:180},this._zoom_direction=0,this._horizon=0,this.handleViewportUpdate(!0),n?this.setLookAtData(n):this._updateMatrices(),ShaderProgram.replaceBlock("camera",`
            uniform mat4 u_projection;
            uniform vec3 u_eye;
            uniform vec2 u_center_offset;

            void cameraProjection (inout vec4 position) {
                position = u_projection * position;
            }`)}return _createClass(e,[{key:"getZoomForBounds",value:function(r,n,o,s){var l,h=this.clone(),d=this._max_zoom,y=this._min_zoom,g=(d-y)/2,v=d-g,m=n,w=MathUtils$1.getBBoxCenter(MathUtils$1.getBBox(r));for(m===void 0?m=w:(l=w[0]-m[0],Math.abs(l)>Geo$1.half_circumference_meters+1e-8&&(m[0]+=Math.round(l/Geo$1.circumference_meters)*Geo$1.circumference_meters));ZOOM_FOR_BOUNDS_EPSILON<g;)(function(){h.setLookAtData({zoom:v,position:m,tilt:o,heading:s});var I,V,q,De,_n,ha=h.getLookAtData().bounds;r.every(function(ga){return MathUtils$1.isPointInsidePolygon(ga,ha)})?y=v:(V=(I=_slicedToArray(MathUtils$1.getBBox(ha),4))[0],q=I[1],De=I[2],_n=I[3],De-V+1e-8>=Geo$1.circumference_meters&&_n-q+1e-8>=Geo$1.circumference_meters?y=v:d=v),v=d-(g=(d-y)/2)})();return y}},{key:"setZoomConstraints",value:function(r,n){this._min_zoom=r,this._max_zoom=n,this.setLookAtData(this.getLookAtData())}},{key:"setLookAtData",value:function(r,n){var o,s,l,h,d,y=r.position,g=r.zoom;y===o&&r.bounds!==o&&(y=MathUtils$1.getBBoxCenter(MathUtils$1.getBBox(r.bounds))),g===o&&r.bounds!==o&&(g=this.getZoomForBounds(r.bounds,y,r.tilt,r.heading)),n!==o&&(s=y||this.screenToWorld(n)),g!==o&&(g=MathUtils$1.clamp(g,this._min_zoom,this._max_zoom),(l=Utils$1.zoomToTileLevel(g))!==(h=this._lookAtData.tile_level)&&(this._zoom_direction=h<l?1:-1),this._lookAtData.zoom=g,this._lookAtData.tile_level=l),r.tilt!==o&&(this._lookAtData.tilt=r.tilt),r.heading!==o&&(this._lookAtData.heading=r.heading),n!==o?(this._updateMatrices(),d=this.screenToWorld(n),this._lookAtData.position[0]-=d[0]-s[0],this._lookAtData.position[1]-=d[1]-s[1]):y&&(this._lookAtData.position=y),this._lookAtData.position[2]=0,this._lookAtData.position[1]=MathUtils$1.clamp(this._lookAtData.position[1],-Geo$1.half_circumference_meters,Geo$1.half_circumference_meters),this._updateMatrices(),this._updateVisibleBounds()}},{key:"getZoomDirection",value:function(){return this._zoom_direction}},{key:"resetZoomDirection",value:function(){this._zoom_direction=0}},{key:"getLookAtData",value:function(){return this._lookAtData}},{key:"handleViewportUpdate",value:function(r){var n=0<arguments.length&&r!==void 0&&r,o=this._viewport,s=o.width,l=o.height;this._viewport_aspect_ratio=s/l;var h=this._viewport.center.x-(s/2<<0),d=this._viewport.center.y-(l/2<<0);this._center_offset[0]=h,this._center_offset[1]=d,this._center_offset_normalized[0]=h/s,this._center_offset_normalized[1]=d/-l,n||(this._updateMatrices(),this._updateVisibleBounds())}},{key:"setupMatrices",value:function(r,n){mat4.multiply(r.model_view32,this._view_matrix,r.model),n.uniform("Matrix4fv","u_modelView",r.model_view32),mat3.normalFromMat4(r.normal32,r.model_view32),mat3.invert(r.inverse_normal32,r.normal32),n.uniform("Matrix3fv","u_normalMatrix",r.normal32),n.uniform("Matrix3fv","u_inverseNormalMatrix",r.inverse_normal32)}},{key:"_updateMatrices",value:function(){var r=this._viewport.height*Geo$1.metersPerPixel(this._lookAtData.zoom),n=Utils$1.interpolate(this._lookAtData.zoom,this._focal_length);this._lookAtData.distance=r/2*n;var o=this._lookAtData.position[0],s=this._lookAtData.position[1];mat4.lookAt(this._view_matrix,vec3.fromValues(o,s,0),vec3.fromValues(o,s,-1),vec3.fromValues(0,1,0)),this._heading_matrix=mat4.identity(this._heading_matrix);var l=180-this._lookAtData.heading;l*=PI_OVER_180,this._heading_matrix[0]=Math.cos(l),this._heading_matrix[1]=-Math.sin(l),this._heading_matrix[4]=Math.sin(l),this._heading_matrix[5]=Math.cos(l),this._tilt_matrix=mat4.identity(this._tilt_matrix),l=0<(l=this._lookAtData.tilt?this._lookAtData.tilt*PI_OVER_180:0)?-l:l,this._tilt_matrix[5]=Math.cos(l),this._tilt_matrix[6]=Math.sin(l),this._tilt_matrix[9]=-Math.sin(l),this._tilt_matrix[10]=Math.cos(l),mat4.multiply(this._transformation_matrix,this._tilt_matrix,this._heading_matrix),mat4.multiply(this._view_matrix,this._transformation_matrix,this._view_matrix);var h=2*Math.atan(1/n),d=2*this._lookAtData.distance;this._depth_buffer_adjustment=2/Math.log(d/NEAR_PLANE),mat4.perspective(this._projection_matrix,h,this._viewport_aspect_ratio,NEAR_PLANE,d),this._projection_matrix[8]=2*-this._center_offset_normalized[0],this._projection_matrix[9]=2*-this._center_offset_normalized[1],mat4.translate(this._projection_matrix,this._projection_matrix,vec3.fromValues(0,0,-this._lookAtData.distance)),this._camera_matrix=mat4.multiply(this._camera_matrix,this._projection_matrix,this._view_matrix)}},{key:"_updateVisibleBounds",value:function(){var r,n,o,s,l,h=this._viewport,d=h.width,y=h.height,g=h.padding,v=degToRad(this._lookAtData.tilt);this._horizon=Math.max((g.top+y)/2-Math.cos(v)*(g.top*(1-Math.sin(v))+y*HORIZON_THRESHOLD_MULTIPLIER),0),this._lookAtData.tetragon=[this.screenToWorld([0,this._horizon]),this.screenToWorld([d,this._horizon]),this.screenToWorld([d,y]),this.screenToWorld([0,y])],this._lookAtData.unpadded_bounds=this._clipAgainstGeoBounds(this._lookAtData.tetragon),g.left===0&&g.top===0&&g.right===0&&g.bottom===0?this._lookAtData.bounds=this._lookAtData.unpadded_bounds:(r=g.left,n=Math.max(this._horizon,g.top),o=d-g.right,s=y-g.bottom,l=[this.screenToWorld([r,n]),this.screenToWorld([o,n]),this.screenToWorld([o,s]),this.screenToWorld([r,s])],this._lookAtData.bounds=this._clipAgainstGeoBounds(l))}},{key:"_clipAgainstGeoBounds",value:function(r){var n,o=_slicedToArray(MathUtils$1.getBBox(r),4),y=o[0],g=o[1],v=o[2],m=o[3],s=Geo$1.half_circumference_meters,l=[[y-1,+s],[v+1,+s],[v+1,-s],[y-1,-s]],h=MathUtils$1.clipPolygon(l,r)[0],d=_slicedToArray(MathUtils$1.getBBox(h),4),y=d[0],g=d[1],v=d[2],m=d[3];v-y>=Geo$1.circumference_meters&&(h=[[(n=(v-y)/2)-s,m],[n+s,m],[n+s,g],[n-s,g]]);var w=[];return h&&(w=MathUtils$1.splitLegs(h,s)),w}},{key:"applyPxOffset",value:function(r){var n=_slicedToArray(r,2),o=n[0],s=n[1],l=Math.PI-this._lookAtData.heading*PI_OVER_180,h=Geo$1.metersPerPixel(this._lookAtData.zoom);this._lookAtData.position[0]+=(o*Math.cos(l)+s*Math.sin(l))*h,this._lookAtData.position[1]-=(s*Math.cos(l)-o*Math.sin(l))*h,this._lookAtData.position[1]=MathUtils$1.clamp(this._lookAtData.position[1],-Geo$1.half_circumference_meters,Geo$1.half_circumference_meters),this._updateMatrices(),this._updateVisibleBounds()}},{key:"screenToWorld",value:function(r){var n=_slicedToArray(r,2),o=n[0],s=n[1],l=this._viewport,h=l.width,d=l.height;return h===0||d===0?[0,0]:(o-=h/2,s-=d/2,this._clipCoordsToWorldPlaneCoords([2*(o+h/2)/h-1,1-2*(s+d/2)/d,-1,1]))}},{key:"_clipToScreenCoords",value:function(r){var n=this._viewport,o=n.width,s=n.height;return[(.5*r[0]+.5)*o,s-(.5*r[1]+.5)*s]}},{key:"_isScreenPointInViewPort",value:function(r){var n=this._viewport,o=n.width,s=n.height;return 0<=r[0]&&r[0]<=o&&0<=r[1]&&r[1]<=s}},{key:"worldToScreen",value:function(r,n){var o,s,l,h,d,y,g=1<arguments.length&&n!==void 0&&n;return r[2]||(r[2]=0),g?(o=this._worldToClipCoords(r),d=this._clipToScreenCoords(o)):(s=Math.sign(this._lookAtData.position[0]),l=Math.trunc(this._lookAtData.position[0]/Geo$1.circumference_meters+s/2),r[0]+=Geo$1.circumference_meters*l,h=this._worldToClipCoords(r),y=d=this._clipToScreenCoords(h),this._isScreenPointInViewPort(d)||(h=this._worldToClipCoords([r[0]+Geo$1.circumference_meters,r[1],r[2]]),d=this._clipToScreenCoords(h),this._isScreenPointInViewPort(d)||(h=this._worldToClipCoords([r[0]-Geo$1.circumference_meters,r[1],r[2]]),d=this._clipToScreenCoords(h)),this._isScreenPointInViewPort(d)||(d=y))),d}},{key:"getHorizon",value:function(){return this._horizon}},{key:"_clipCoordsToWorldPlaneCoords",value:function(r){var n=[],o=this._lookAtData.distance,s=this._lookAtData.position,l=[0,0,o,0],h=0,d=o*Math.sin(PI_OVER_180*this._lookAtData.tilt)*Math.cos(PI_OVER_180*this._lookAtData.heading),y=o*Math.sin(PI_OVER_180*this._lookAtData.tilt)*Math.sin(PI_OVER_180*this._lookAtData.heading),g=new Float64Array(16),v=new Float64Array(16);return mat4.invert(g,this._projection_matrix),vec4.transformMat4(n,r,g),n[2]=-1,n[3]=0,mat4.invert(v,this._view_matrix),vec4.transformMat4(n,n,v),vec4.normalize(n,n),vec4.transformMat4(l,l,this._transformation_matrix),n[2]!==0&&(h=-l[2]/n[2]),vec4.scale(n,n,h),[s[0]+(n[0]+y),s[1]+(n[1]+d)]}},{key:"_worldToClipCoords",value:function(r){var n=[r[0],r[1],r[2],1];return vec4.transformMat4(n,n,this._view_matrix),vec4.transformMat4(n,n,this._projection_matrix),vec4.scale(n,n,1/n[3]),n}},{key:"setupProgram",value:function(r){r.uniform("Matrix4fv","u_projection",this._projection_matrix),r.uniform("3f","u_eye",[0,0,this._lookAtData.distance]),r.uniform("2fv","u_center_offset",this._center_offset_normalized),r.uniform("1f","u_tilt",this._lookAtData.tilt*PI_OVER_180),r.uniform("1f","u_heading",this._lookAtData.heading*PI_OVER_180),r.uniform("1f","u_near_plane",NEAR_PLANE),r.uniform("1f","u_depth_buffer_adjustment",this._depth_buffer_adjustment)}},{key:"getTransformationMatrix",value:function(){return this._transformation_matrix}},{key:"getCameraMatrix",value:function(){return this._camera_matrix}},{key:"clone",value:function(){var r=new e(this._viewport,this._lookAtData);return r.setZoomConstraints(this._min_zoom,this._max_zoom),r}},{key:"getViewport",value:function(){return this._viewport}}]),e}();function getX(e){return e.x===void 0?e[0]:e.x}function getY(e){return e.y===void 0?e[1]:e.y}function xAscendingComparator(e,r){return getX(e)-getX(r)}function yAscendingComparator(e,r){return getY(e)-getY(r)}function sortByX(e){return e.sort(xAscendingComparator)}function sortByY(e){return e.sort(yAscendingComparator)}function getMinMax(e,r){for(var n,o=e[0],s=o,l=0;l<e.length;l+=1)r(n=e[l],o)<0?o=n:0<r(n,s)&&(s=n);return[o,s]}function groupByCoord(e,r){return Object.values(r.reduce(function(n,o){var s=o[+e];return n[s]||(n[s]=[]),n[s].push(o),n},{}))}function groupByX(e){return groupByCoord(!1,e)}function groupByY(e){return groupByCoord(!0,e)}function createTileRangeByCoord(e,r,n){var o=+e,s=r[o],l=n[o];if(l<s)return[];var h=[r];if(l<s)return h;for(var d=r[(1+o)%2],y=e?function(v){return h.push([d,v])}:function(v){return h.push([v,d])},g=s+1;g<l;g+=1)y(g);return h.push(n),h}function createTileRangeByX(e,r){return createTileRangeByCoord(!1,e,r)}function createTileRangeByY(e,r){return createTileRangeByCoord(!0,e,r)}function deduplicate(e){var r={},n=[];return e.forEach(function(o){var s=o.key||(Array.isArray(o)?"".concat(o[0],"/").concat(o[1]):"".concat(o.x,"/").concat(o.y));r[s]||(r[s]=!0,n.push(o))}),n}function flat(e){return e.reduce(function(r,n){return r.concat(n)})}function applyMargin(e,r){if(r<=0)return e;var n,o=function(l){var h=_slicedToArray(getMinMax(l,xAscendingComparator),2),d=h[0],y=h[1],g=[d[0]-r,d[1]],v=[y[0]+r,y[1]];return l.concat(createTileRangeByX(g,d),createTileRangeByX(y,v))},s=function(l){var h=_slicedToArray(getMinMax(l,yAscendingComparator),2),d=h[0],y=h[1],g=[d[0],d[1]-r],v=[y[0],y[1]+r];return l.concat(createTileRangeByY(g,d),createTileRangeByY(y,v))};return deduplicate((n=groupByY(flat(groupByX(e).map(s))),flat(n.map(o))))}function constructTiles(e,r,n){return e.map(function(o){var s=_slicedToArray(o,2),l=s[0],h=s[1];return Tile.coord(Geo$1.wrapTile({x:l,y:h,z:r},{x:!n,y:!0}))})}function getTileGrid(e,r,n){function o(s){return Object.values(Geo$1.metersToExactTileCoords(s,e.tile_level))}return deduplicate(constructTiles(applyMargin(rasterizeTetragon(o(e.tetragon[0]),o(e.tetragon[1]),o(e.tetragon[3]),o(e.tetragon[2])),r),e.tile_level,n))}function rasterizeTetragon(e,r,n,o){var s=rasterizeTriangle(r,e,n),l=rasterizeTriangle(n,o,r);return deduplicate(s.concat(l))}function rasterizeTriangle(e,r,n){var o=_slicedToArray(sliceTriangle.apply(void 0,_toConsumableArray(sortByY([e,r,n]))),2),s=o[0],l=o[1];return deduplicate(rasterizeBottomFlatTriangle.apply(void 0,_toConsumableArray(s)).concat(rasterizeTopFlatTriangle.apply(void 0,_toConsumableArray(l))))}function sliceTriangle(e,r,n){var o=_slicedToArray(e,2),s=o[0],l=o[1],h=_slicedToArray(r,2),d=h[0],y=h[1],g=_slicedToArray(n,2),v=g[0],m=g[1],w=s+(y-l)/(m-l)*(v-s);return[[[s,l]].concat(_toConsumableArray(sortByX([[d,y],[w,y]]))),[].concat(_toConsumableArray(sortByX([[d,y],[w,y]])),[[v,m]])]}function rasterizeBottomFlatTriangle(e,r,n){var o=_slicedToArray(e,2),s=o[0],l=o[1],h=_slicedToArray(r,2),d=h[0],y=h[1];return scanFlatTriangle(s,d,_slicedToArray(n,1)[0],l,y)}function rasterizeTopFlatTriangle(e,r,n){var o=_slicedToArray(e,2),s=o[0],l=o[1],h=_slicedToArray(r,1)[0],d=_slicedToArray(n,2);return scanFlatTriangle(d[0],s,h,d[1],l)}var scanStepStatic=.125;function getScanStep(e,r){return scanStepStatic*(r-e)/(Math.ceil(r)-Math.floor(e))}function scanFlatTriangle(e,r,n,o,s){var l=Math.min(e,r),h=Math.max(e,n),d=Math.min(o,s),y=Math.max(o,s);if(Math.floor(o)===Math.floor(s))return scanRow(l,h,o);if(y-d<scanStepStatic)return scanRectangle([l,d],[h,y]);function g(ga){V=V.concat(scanRow(q,De,Math.floor(ga))),q+=w,De+=I}var v=getScanStep(d,y),m=(y-d)/v,w=(r-e)/m,I=(n-e)/m,V=[],q=e,De=e;if(o<s)for(var _n=d;_n<=y;_n+=v)g(_n);else for(var ha=y;d<=ha;ha-=v)g(ha);return deduplicate(V)}function xCoordsToPoints(e,r){return e.map(function(n){return[n,r]})}function createCoordRange(e,r){var n=Math.floor(e),o=Math.floor(r);if(o<n)return[];if(n===o)return[n];for(var s=[],l=n;l<=o;l+=1)s.push(l);return s}function scanRow(e,r,n){return xCoordsToPoints(createCoordRange(e,r),n)}function scanRectangle(e,r){var n=_slicedToArray(e,2),o=n[0],s=n[1],l=_slicedToArray(r,2),h=l[0],d=l[1],y=createCoordRange(o,h),g=xCoordsToPoints(y,s),v=xCoordsToPoints(y,d);return g.concat(v)}var VIEW_PAN_SNAP_TIME=.5,Z_PRECISION=1e5,View=function(){function e(r,n){_classCallCheck(this,e),subscribeMixin(this),this.scene=r,this.createMatrices(),this.bounds=null,this.center_tile=null,this.panning=!1,this.panning_stop_at=0,this.pan_snap_timer=0,this.user_input_at=0,this.user_input_timeout=50,this.user_input_active=!1,this.size={},this.buffer=0,this.wrap=n.wrapView!==!1,this.preserve_tiles_within_zoom=1,this.lookAtManipulator=new LookAtManipulator(n.viewport),this._viewport=n.viewport,this._offset_buffer=[0,0],this.handleViewportUpdate(!0)}return _createClass(e,[{key:"update",value:function(){this.pan_snap_timer=(new Date-this.panning_stop_at)/1e3,this.user_input_active=new Date-this.user_input_at<this.user_input_timeout,this.scene.tile_manager.updateTilesVisibilityCounters()}},{key:"handleViewportUpdate",value:function(r){var n=0<arguments.length&&r!==void 0&&r,o=this._viewport,s=o.width,l=o.height;this.size.css={width:s,height:l},this.size.device={width:Math.round(s*Utils$1.device_pixel_ratio),height:Math.round(l*Utils$1.device_pixel_ratio)},this.lookAtManipulator.handleViewportUpdate(),n||this.updateBounds()}},{key:"setLookAtData",value:function(r,n){e._setLookAtDataForManipulator(this.lookAtManipulator,r,n),this.updateBounds()}},{key:"getLookAtData",value:function(r){var n=0<arguments.length&&r!==void 0&&r;return e._getLookAtDataFromManipulator(this.lookAtManipulator,n)}},{key:"getBestLookAtData",value:function(r,n,o){var s=2<arguments.length&&o!==void 0&&o,l=this.lookAtManipulator.clone();return e._setLookAtDataForManipulator(l,r,n),e._getLookAtDataFromManipulator(l,s)}},{key:"getTileLevel",value:function(){return this.lookAtManipulator.getLookAtData().tile_level}},{key:"applyPxOffset",value:function(r){var n=this._offset_buffer;n[0]+=r[0],n[1]+=r[1];var o,s,l=Math.abs(n[0]),h=Math.abs(n[1]);(1<=l||1<=h)&&(o=~~n[0],s=~~n[1],this.lookAtManipulator.applyPxOffset([l<1?0:o,h<1?0:s]),1<=l&&(n[0]-=o),1<=h&&(n[1]-=s),this.updateBounds())}},{key:"setPanning",value:function(r){this.panning=r,this.panning||(this.panning_stop_at=+new Date)}},{key:"markUserInput",value:function(){this.user_input_at=+new Date}},{key:"ready",value:function(){return typeof this.size.css.width=="number"&&typeof this.size.css.height=="number"}},{key:"updateBounds",value:function(){var r,n;this.markUserInput(),this.ready()&&(this.center_tile=Geo$1.tileForMeters(this.lookAtManipulator.getLookAtData().position,this.lookAtManipulator.getLookAtData().tile_level),r=this.lookAtManipulator.screenToWorld([0,this.size.css.height]),n=this.lookAtManipulator.screenToWorld([this.size.css.width,0]),this.bounds={sw:{x:r[0],y:r[1]},ne:{x:n[0],y:n[1]}},this.scene.tile_manager.updateTilesForView(!0),this.trigger("move"),this.scene.requestRedraw())}},{key:"getTileGridFlatForBBox",value:function(r,n,o,s,l,h){var d,y=4<arguments.length&&l!==void 0?l:0,g=!(5<arguments.length&&h!==void 0)||h,v=this.lookAtManipulator.getLookAtData().tile_level,m=Geo$1.tileForMeters([n,r],v),w=Geo$1.tileForMeters([s,o],v);m.x-=y,m.y-=y,w.x+=y,w.y+=y,g===!1&&(d=(1<<v)-1,m.x=Math.min(Math.max(0,m.x),d),m.y=Math.min(Math.max(0,m.y),d),w.x=Math.min(Math.max(0,w.x),d),w.y=Math.min(Math.max(0,w.y),d));for(var I=[],V={},q=m.x;q<=w.x;q++)for(var De=m.y;De<=w.y;De++){var _n=Tile.coord(Geo$1.wrapTile({x:q,y:De,z:v},{x:!g,y:!0}));V[_n.key]||(V[_n.key]=!0,I.push(_n))}return I}},{key:"getTileGridFlat",value:function(){return this.getTileGridFlatForBBox(this.bounds.ne.y,this.bounds.sw.x,this.bounds.sw.y,this.bounds.ne.x,this.buffer,this.wrap)}},{key:"getTileGridDistorted",value:function(){return getTileGrid(this.lookAtManipulator.getLookAtData(),this.buffer,this.wrap)}},{key:"findVisibleTileCoordinates",value:function(){if(!this.bounds)return[];var r=this.lookAtManipulator.getLookAtData(),n=r.tilt,o=r.heading;return n===0&&o===180?this.getTileGridFlat():this.getTileGridDistorted()}},{key:"createMatrices",value:function(){this.matrices={},this.matrices.model=new Float64Array(16),this.matrices.model32=new Float32Array(16),this.matrices.model_view=new Float64Array(16),this.matrices.model_view32=new Float32Array(16),this.matrices.normal=new Float64Array(9),this.matrices.normal32=new Float32Array(9),this.matrices.inverse_normal32=new Float32Array(9)}},{key:"setupTile",value:function(r,n){r.setupProgram(this.matrices,n),this.lookAtManipulator.setupMatrices(this.matrices,n)}},{key:"setupProgram",value:function(r){var n=this.lookAtManipulator.getLookAtData();r.uniform("2fv","u_resolution",[this.size.device.width,this.size.device.height]),r.uniform("3fv","u_map_position",[n.position[0],n.position[1],Math.trunc(n.zoom*Z_PRECISION)/Z_PRECISION]),r.uniform("1f","u_meters_per_pixel",Geo$1.metersPerPixel(n.zoom)),r.uniform("1f","u_device_pixel_ratio",Utils$1.device_pixel_ratio),r.uniform("1f","u_view_pan_snap_timer",this.pan_snap_timer),r.uniform("1i","u_view_panning",this.panning),r.uniform("1f","u_horizon",this.lookAtManipulator.getHorizon()/(this.size.css.height/2)),this.lookAtManipulator.setupProgram(r)}},{key:"isAnimating",value:function(){return this.pan_snap_timer<=VIEW_PAN_SNAP_TIME}},{key:"xyToGeo",value:function(r,n){var o=this.lookAtManipulator.screenToWorld([r,n]),s=_slicedToArray(Geo$1.metersToLatLng(o),2),l=s[0];return{lat:s[1],lng:l}}},{key:"geoToPixel",value:function(r){var n=Geo$1.latLngToMeters([r.lng,r.lat]);n.push(r.alt||0);var o=this.lookAtManipulator.worldToScreen(n);return{x:Math.floor(o[0]),y:Math.floor(o[1])}}},{key:"geoToMeters",value:function(r){var n=_slicedToArray(Geo$1.latLngToMeters([r.lng,r.lat]),2);return{x:n[0],y:n[1],z:r.alt||0}}},{key:"metersToGeo",value:function(r){var n=_slicedToArray(Geo$1.metersToLatLng([r.x,r.y]),2),o=n[0];return{lat:n[1],lng:o,alt:r.z||0}}},{key:"setZoomConstraints",value:function(r,n){this.lookAtManipulator.setZoomConstraints(r,n)}}],[{key:"_setLookAtDataForManipulator",value:function(r,n,o){var s=n.position,l=n.zoom,h=n.tilt,d=n.heading,y=n.bounds,g={zoom:l,tilt:h,heading:d};if(s&&typeof s.lng=="number"&&typeof s.lat=="number"&&(g.position=Geo$1.latLngToMeters([s.lng,s.lat])),y){var v=y.getExterior().getLatLngAltArray(),m=v.length/3,w=Array(m);if(y.getBoundingBox().isCDB())for(var I=v[1],V=0,q=0;q<m;q++){var De,_n=v[3*q+1];0<q&&(De=_n-I,180<Math.abs(De)&&(V+=I<_n?-360:360)),I=_n,w[q]=Geo$1.latLngToMeters([_n+V,v[3*q]])}else for(var ha=0;ha<m;ha++)w[ha]=Geo$1.latLngToMeters([v[3*ha+1],v[3*ha]]);g.bounds=w}r.setLookAtData(g,o)}},{key:"_getLookAtDataFromManipulator",value:function(r,n){var o=1<arguments.length&&n!==void 0&&n,s=r.getLookAtData(),l=s.heading,h=s.incline,d=s.tilt,y=s.zoom,g=s.position,v=s.bounds,m=s.unpadded_bounds,w=_slicedToArray(Geo$1.metersToLatLng(g),2),I=w[0],V=w[1],q=new H.geo.LineString;return(o?m:v).forEach(function(De){var _n=Geo$1.metersToLatLng(De);q.pushLatLngAlt(_n[1],_n[0],0)}),{heading:l,incline:h,tilt:d,zoom:y,bounds:new H.geo.Polygon(q),position:{lat:V,lng:I,alt:g[2]}}}}]),e}(),shaderSrc_pointsVertex=`uniform vec2 u_resolution;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_tile_proxy_depth;uniform bool u_tile_fade_in;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform float u_visible_time;uniform bool u_view_panning;uniform float u_tilt;uniform mat4 u_model;uniform mat4 u_modelView;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform float u_heading;uniform float u_near_plane;uniform float u_depth_buffer_adjustment;attribute vec4 a_position;attribute vec4 a_shape;attribute vec4 a_color;attribute vec2 a_texcoord;attribute vec2 a_offset;uniform float u_point_type;attribute float a_is_flat;
#ifdef TANGRAM_IS_TEXT_STYLE
attribute vec4 a_offsets_alt;attribute vec4 a_pre_angles_alt;attribute vec4 a_angles_alt;attribute vec4 a_offsets;attribute vec4 a_pre_angles;attribute vec4 a_angles;
#endif
#ifdef TANGRAM_POINT_DRAW_STICK
attribute float a_is_stick;attribute float a_stick_height;varying float v_is_stick;
#endif
varying vec4 v_color;varying vec2 v_texcoord;varying vec4 v_world_position;varying float v_alpha_factor;
#ifdef TANGRAM_HAS_SHADER_POINTS
attribute float a_outline_edge;attribute vec4 a_outline_color;varying float v_outline_edge;varying vec4 v_outline_color;varying float v_aa_offset;
#endif
#ifdef TANGRAM_SHOW_HIDDEN_LABELS
varying float v_label_hidden;
#endif
#define PI 3.14159265359
#define TANGRAM_NORMAL vec3(0., 0., 1.)
#pragma tangram: camera
#pragma tangram: material
#pragma tangram: lighting
#pragma tangram: raster
#pragma tangram: global
vec2 rotate2D(vec2 _st,float _angle){return mat2(cos(_angle),-sin(_angle),sin(_angle),cos(_angle))*_st;}vec3 rotateX3D(vec3 _st,float _angle){return mat3(1.,0.,0.,0.,cos(_angle),sin(_angle),0.,-sin(_angle),cos(_angle))*_st;}vec3 rotateZ3D(vec3 _st,float _angle){return mat3(cos(_angle),sin(_angle),0.,-sin(_angle),cos(_angle),0.,0.,0.,1.)*_st;}
#ifdef TANGRAM_IS_TEXT_STYLE
float mix4linear(float a,float b,float c,float d,float x){return mix(mix(a,b,3.*x),mix(b,mix(c,d,3.*(max(x,.66)-.66)),3.*(clamp(x,.33,.66)-.33)),step(0.33,x));}
#endif
void main(){
#pragma tangram: setup
#ifndef TANGRAM_SHOW_HIDDEN_LABELS
if(a_shape.w==0.){gl_Position=vec4(0.,0.,0.,1.);return;}
#else
if(a_shape.w==0.){v_label_hidden=1.;}else{v_label_hidden=0.;}
#endif
v_alpha_factor=1.0;v_color=a_color;v_texcoord=a_texcoord;
#ifdef TANGRAM_HAS_SHADER_POINTS
v_outline_color=a_outline_color;v_outline_edge=a_outline_edge;if(u_point_type==TANGRAM_POINT_TYPE_SHADER){v_outline_color=a_outline_color;v_outline_edge=a_outline_edge;float size=abs(a_shape.x/128.);v_texcoord=sign(a_shape.xy)*(size+1.0)/size;size+=2.0;v_aa_offset=2.0/size;}
#endif
vec4 position=u_modelView*vec4(a_position.xyz,1.);vec4 shape=vec4(a_shape.xy,0.,0.);vec2 offset=vec2(a_offset.x,-a_offset.y);
#ifdef TANGRAM_POINT_DRAW_STICK
v_is_stick=a_is_stick;float scaled_stick_height=(sin(u_tilt+(1.5*PI))+1.0)*a_stick_height;offset.y+=(1.0-a_is_stick)*scaled_stick_height;
#endif
float zoom=clamp(u_map_position.z-u_tile_origin.z,0.,1.);float theta=a_shape.z/4096.;float heading=u_heading;float delta=(heading-PI);float new_theta=theta-delta;float reversed=abs(new_theta)>PI/2. ? 1. : 0.;if(a_is_flat==1.0){
#ifdef TANGRAM_IS_TEXT_STYLE
if(a_offsets[0]!=0.){vec4 angles_scaled;vec4 pre_angles_scaled;vec4 offsets_scaled;if(reversed==1.){offsets_scaled=a_offsets_alt*4.;angles_scaled=(PI/16384.)*a_angles_alt;pre_angles_scaled=(PI/128.)*a_pre_angles_alt;}else{offsets_scaled=a_offsets*4.;angles_scaled=(PI/16384.)*a_angles;pre_angles_scaled=(PI/128.)*a_pre_angles;}float pre_angle=mix4linear(pre_angles_scaled[0],pre_angles_scaled[1],pre_angles_scaled[2],pre_angles_scaled[3],zoom);float angle=mix4linear(angles_scaled[0],angles_scaled[1],angles_scaled[2],angles_scaled[3],zoom);float offset_curve=mix4linear(offsets_scaled[0],offsets_scaled[1],offsets_scaled[2],offsets_scaled[3],zoom);shape.xy=rotate2D(shape.xy,pre_angle+PI*reversed);shape.x+=offset_curve;shape.xy=rotate2D(shape.xy,angle);shape.xy+=rotate2D(offset,theta);}else{shape.xy=rotate2D(shape.xy+offset*256.,theta+(PI*reversed));}
#else
shape.xy=rotate2D(shape.xy+offset*256.,theta);
#endif
shape.xy/=pow(2.,4.+(u_map_position.z-u_tile_origin.w));shape=u_modelView*shape;position+=shape;}else{shape.xy/=256.;
#ifdef TANGRAM_POINT_DRAW_STICK
shape.y*=1.0+(scaled_stick_height-1.0)*a_is_stick;
#endif
shape.xy=rotate2D(shape.xy+offset,theta);}
#ifdef TANGRAM_FADE_IN_RATE
if(u_tile_fade_in){v_alpha_factor*=clamp(u_visible_time*TANGRAM_FADE_IN_RATE,0.,1.);}
#endif
#ifdef TANGRAM_FADE_ON_ZOOM_OUT
v_alpha_factor*=clamp(1.+TANGRAM_FADE_ON_ZOOM_OUT_RATE*(u_map_position.z-u_tile_origin.z),0.,1.);
#endif
v_world_position=u_model*position;v_world_position.xy+=shape.xy*u_meters_per_pixel;v_world_position=wrapWorldPosition(v_world_position);
#pragma tangram: position
cameraProjection(position);
#ifdef TANGRAM_LAYER_ORDER
applyLayerOrder(a_position.w+u_tile_proxy_depth+1.,position);/***Due to the precision loss on depth buffer,we had a z-fighting of translucent points when the distance to the camera was big.*For more information about the problem see: https:*For more information about the fix see: https:*position.z=(2.0*log(position.w/u_near_plane)/log(u_far_plane/u_near_plane)-1.0)*position.w;*/position.z=(log(position.w/u_near_plane)*u_depth_buffer_adjustment-1.0)*position.w;
#endif
if(a_is_flat!=1.){position.xy+=shape.xy*position.w*2.*u_device_pixel_ratio/u_resolution;}
#ifdef TANGRAM_HAS_SHADER_POINTS
if(u_point_type==TANGRAM_POINT_TYPE_SHADER){position.xy+=sign(shape.xy)*position.w*u_device_pixel_ratio/u_resolution;}
#endif
if(!u_view_panning){snapToPixelGrid(position);}gl_Position=position;}`,shaderSrc_pointsFragment=`uniform vec2 u_resolution;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform float u_visible_time;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform sampler2D u_texture;uniform float u_point_type;uniform bool u_apply_color_blocks;varying vec4 v_color;varying vec2 v_texcoord;varying vec4 v_world_position;varying float v_alpha_factor;
#ifdef TANGRAM_HAS_SHADER_POINTS
varying vec4 v_outline_color;varying float v_outline_edge;varying float v_aa_offset;
#endif
#ifdef TANGRAM_SHOW_HIDDEN_LABELS
varying float v_label_hidden;
#endif
#ifdef TANGRAM_POINT_DRAW_STICK
varying float v_is_stick;
#endif
#define TANGRAM_NORMAL vec3(0., 0., 1.)
#pragma tangram: camera
#pragma tangram: material
#pragma tangram: lighting
#pragma tangram: raster
#pragma tangram: global
#ifdef TANGRAM_HAS_SHADER_POINTS
float _tangram_antialias(float l,float R){float low=R-v_aa_offset;float high=R+v_aa_offset;return 1.-smoothstep(low,high,l);}
#endif
void mixTextureColor(inout vec4 color){
#ifdef TANGRAM_HAS_SHADER_POINTS
if(u_point_type==TANGRAM_POINT_TYPE_TEXTURE){color*=texture2D(u_texture,v_texcoord);}else if(u_point_type==TANGRAM_POINT_TYPE_LABEL){color=texture2D(u_texture,v_texcoord);color.rgb/=max(color.a,0.001);}else if(u_point_type==TANGRAM_POINT_TYPE_SHADER){float outline_edge=v_outline_edge;vec4 outlineColor=v_outline_color;float l=length(v_texcoord);float outer_alpha=_tangram_antialias(l,1.);float fill_alpha=_tangram_antialias(l,1.-v_outline_edge*0.5)*color.a;float stroke_alpha=(outer_alpha-_tangram_antialias(l,1.-v_outline_edge))*outlineColor.a;
#ifdef TANGRAM_BLEND_ADD
color.a=stroke_alpha+fill_alpha;color.rgb=color.rgb*fill_alpha+outlineColor.rgb*stroke_alpha;
#else
color.a=stroke_alpha+fill_alpha*(1.-stroke_alpha);color.rgb=mix(color.rgb*fill_alpha,outlineColor.rgb,stroke_alpha)/max(color.a,0.001);
#endif
}
#else
color=texture2D(u_texture,v_texcoord);color.rgb/=max(color.a,0.001);
#endif
if(u_apply_color_blocks){
#pragma tangram: color
#pragma tangram: filter
}color.a*=v_alpha_factor;
#ifdef TANGRAM_SHOW_HIDDEN_LABELS
if(v_label_hidden>0.){color.a*=0.5;color.rgb=vec3(1.,0.,0.);}
#endif
#if !defined(TANGRAM_BLEND_OVERLAY) && !defined(TANGRAM_BLEND_INLAY) && !defined(TANGRAM_BLEND_ADD)
if(color.a<TANGRAM_ALPHA_TEST){discard;}
#endif
}void main(void){
#pragma tangram: setup
vec4 color=v_color;
#ifdef TANGRAM_POINT_DRAW_STICK
if(v_is_stick==0.0){mixTextureColor(color);}
#else
mixTextureColor(color);
#endif
gl_FragColor=color;}`,PLACEMENT$1=LabelPoint.PLACEMENT,pre_angles_normalize=128/Math.PI,angles_normalize=16384/Math.PI,offsets_normalize=64,texcoord_normalize=65535,Points=Object.create(Style),TANGRAM_POINT_TYPE_TEXTURE=1,TANGRAM_POINT_TYPE_LABEL=2,TANGRAM_POINT_TYPE_SHADER=3,DEFAULT_POINT_SIZE=16;Object.assign(Points,TextLabels),Object.assign(Points,{name:"points",built_in:!0,vertex_shader_src:shaderSrc_pointsVertex,fragment_shader_src:shaderSrc_pointsFragment,selection:!0,collision:!0,blend:"overlay",init:function(e){var r=0<arguments.length&&e!==void 0?e:{};Style.init.call(this,r),this.setupDefines(),this.defines.TANGRAM_HAS_SHADER_POINTS=!0,this.defines.TANGRAM_POINT_TYPE_TEXTURE=TANGRAM_POINT_TYPE_TEXTURE,this.defines.TANGRAM_POINT_TYPE_LABEL=TANGRAM_POINT_TYPE_LABEL,this.defines.TANGRAM_POINT_TYPE_SHADER=TANGRAM_POINT_TYPE_SHADER,this.defines.TANGRAM_POINT_DRAW_STICK=!!this.stick,this.collision_group_points=this.name+"-points",this.collision_group_text=this.name+"-text",this.reset()},setupDefines:function(){this.blend!=="overlay"&&(this.defines.TANGRAM_LAYER_ORDER=!0),this.defines.TANGRAM_FADE_ON_ZOOM_OUT=!0,this.defines.TANGRAM_FADE_ON_ZOOM_OUT_RATE=2,debugSettings$1.suppress_label_fade_in||this.suppress_fade?(this.fade_in_time=0,this.defines.TANGRAM_FADE_IN_RATE=null):(this.fade_in_time=.15,this.defines.TANGRAM_FADE_IN_RATE=1/this.fade_in_time),debugSettings$1.suppress_snap_animation||(this.defines.TANGRAM_VIEW_PAN_SNAP_RATE=1/VIEW_PAN_SNAP_TIME),debugSettings$1.show_hidden_labels&&(this.defines.TANGRAM_SHOW_HIDDEN_LABELS=!0)},reset:function(){this.queues={},this.resetText(),this.texture_missing_sprites={}},addFeature:function(e,r,n){var o,s,l,h=n.tile,d={};if(d.color=this.parseColor(r.color,n),d.texture=r.texture,d.label_texture=null,d.color||d.texture){if(this.hasSprites(d)){if(!(o=this.parseSprite(d,r,n)))return;d.texcoords=o.texcoords}if(d.size=r.size,d.size){if(d.size=StyleParser.evalCachedPointSizeProperty(r.size,o,n),d.size==null)return void log({level:"warn",once:!0},"Layer '".concat(r.layers[r.layers.length-1],"': ")+"'size' includes % and/or ratio-based scaling (".concat(JSON.stringify(r.size.value),"); ")+"these can only applied to sprites, but no sprite was specified, skipping features in layer");typeof d.size=="number"&&(d.size=[d.size,d.size])}else d.size=o&&o.css_size||[DEFAULT_POINT_SIZE,DEFAULT_POINT_SIZE];r.outline&&(d.outline_width=StyleParser.evalCachedProperty(r.outline.width,n)||StyleParser.defaults.outline.width,d.outline_color=this.parseColor(r.outline.color,n)),d.outline_edge_pct=0,d.outline_width&&d.outline_color&&(s=d.outline_width,d.size[0]+=s,d.size[1]+=s,d.outline_edge_pct=s/Math.min(d.size[0],d.size[1])*2),d.size[0]=Math.min(d.size[0],256),d.size[1]=Math.min(d.size[1],256),d.placement=r.placement,d.placement_min_length_ratio=StyleParser.evalCachedProperty(r.placement_min_length_ratio,n),d.placement===PLACEMENT$1.SPACED&&r.placement_spacing&&(d.placement_spacing=StyleParser.evalCachedProperty(r.placement_spacing,n)),d.angle=StyleParser.evalProperty(r.angle,n)||0,d.elevate_by_altitude=!!r.elevate_by_altitude,d.z=r.z?MathUtils$1.clamp(StyleParser.evalCachedDistanceProperty(r.z,n),0,32767):StyleParser.defaults.z,d.flat=r.flat,d.tile_edges=r.tile_edges,this.computeLayout(d,e,r,n,h),r.stick&&!d.flat&&(l=StyleParser.parseNumber(StyleParser.evalProperty(r.stick.height,n)),d.stick={color:this.parseColor(r.stick.color,n)||StyleParser.defaults.color,height:l?Math.max(l,0):0});var y=r.text&&StyleParser.evalProperty(r.text.visible,n)!==!1&&this.parseTextFeature(e,r.text,n,h);Array.isArray(y)&&log({level:"warn",once:!(y=null)},"Layer '".concat(r.layers[r.layers.length-1],"': ")+"cannot use boundary labels (e.g. 'text_source: { left: ..., right: ... }') for 'text' labels attached to 'points'; "+"provided 'text_source' value was ".concat(JSON.stringify(r.text.text_source))),y&&(y.layout.parent=d,y.layout.priority=r.text.priority?Math.max(y.layout.priority,d.priority+.5):d.priority+.5,y.layout.move_into_tile=!1,Collision.addStyle(this.collision_group_text,h.id)),this.queueFeature({feature:e,draw:r,context:n,style:d,text_feature:y},h),Collision.addStyle(this.collision_group_points,h.id)}},hasSprites:function(e){return e.texture&&this.textureManager.textures[e.texture]&&this.textureManager.textures[e.texture].sprites},getSpriteInfo:function(e,r){var n=this.textureManager.textures[e.texture].sprites[r]&&this.textureManager.getSpriteInfo(e.texture,r);return r&&!n?(this.texture_missing_sprites[e.texture]=this.texture_missing_sprites[e.texture]||{},this.texture_missing_sprites[e.texture][r]||(log("debug","Style: in style '".concat(this.name,"', could not find sprite '").concat(r,"' for texture '").concat(e.texture,"'")),this.texture_missing_sprites[e.texture][r]=!0)):n&&(n.sprite=r),n},parseSprite:function(e,r,n){var o=StyleParser.evalProperty(r.sprite,n);return this.getSpriteInfo(e,o)||this.getSpriteInfo(e,r.sprite_default)},queueFeature:function(e,r){this.tile_data[r.id]&&this.queues[r.id]||this.startData(r),this.queues[r.id]=this.queues[r.id]||[],this.queues[r.id].push(e)},endData:function(e){var r=this;if(e.canceled)return log("trace","Style ".concat(this.name,": stop tile build because tile was canceled: ").concat(e.key)),Promise.resolve();var n=this.queues[e.id];delete this.queues[e.id];var o=[],s=[];return n.forEach(function(l){for(var h=l.style,d=l.feature,y=d.geometry,g=r.buildLabels(h.size,y,h),v=0;v<g.length;v++){var m,w=g[v],I={feature:d,draw:l.draw,context:l.context,style:h,label:w};s.push(I),l.text_feature&&(m={feature:d,draw:l.text_feature.draw,context:l.context,text:l.text_feature.text,text_settings_key:l.text_feature.text_settings_key,layout:l.text_feature.layout,point_label:w,linked:I},o.push(m),l.draw.text.optional||(I.linked=m))}}),Promise.all([Collision.collide(s,this.collision_group_points,e.id).then(function(l){l.forEach(function(h){r.feature_style=h.style,r.feature_style.label=h.label,r.feature_style.linked=h.linked,Style.addFeature.call(r,h.feature,h.draw,h.context)})}),this.collideAndRenderTextLabels(e,this.collision_group_text,o)]).then(function(l){var h=_slicedToArray(l,2)[1],d=h.labels,y=h.texts;return d&&y&&d.forEach(function(g){var v=g.text_settings_key,m=y[v]&&y[v][g.text],w=r.feature_style;w.label=g.label,w.linked=g.linked,w.size=m.size.logical_size,w.angle=0,g.label.text_data={text_info:m,text_settings_key:v,text:g.text},w.label_texture=r.textureManager.default,Style.addFeature.call(r,g.feature,g.draw,g.context)}),r.freeText(e),Style.endData.call(r,e)})},_preprocess:function(e){e.color=StyleParser.createColorPropertyCache(e.color),e.texture=e.texture!==void 0?e.texture:this.texture,e.outline&&(e.outline.color=StyleParser.createColorPropertyCache(e.outline.color),e.outline.width=StyleParser.createPropertyCache(e.outline.width,StyleParser.parsePositiveNumber)),e.z=StyleParser.createPropertyCache(e.z,StyleParser.parseUnits);try{e.size=StyleParser.createPointSizePropertyCache(e.size)}catch(r){return log({level:"warn",once:!0},"Layer '".concat(e.layers[e.layers.length-1],"': ")+"".concat(r," (").concat(JSON.stringify(e.size),"), skipping features in layer")),null}return e.offset=StyleParser.createPropertyCache(e.offset,function(r){return Array.isArray(r)&&r.map(StyleParser.parseNumber)}),e.buffer=StyleParser.createPropertyCache(e.buffer,function(r){return(Array.isArray(r)?r:[r,r]).map(StyleParser.parsePositiveNumber)}),e.repeat_distance=StyleParser.createPropertyCache(e.repeat_distance,StyleParser.parseNumber),e.repeat_group==null&&(e.repeat_group=e.layers.join("-")),e.placement=PLACEMENT$1[e.placement&&e.placement.toUpperCase()],e.placement==null&&(e.placement=PLACEMENT$1.VERTEX),e.placement_spacing=e.placement_spacing!=null?e.placement_spacing:80,e.placement_spacing=StyleParser.createPropertyCache(e.placement_spacing,StyleParser.parsePositiveNumber),e.placement_min_length_ratio=e.placement_min_length_ratio!=null?e.placement_min_length_ratio:1,e.placement_min_length_ratio=StyleParser.createPropertyCache(e.placement_min_length_ratio,StyleParser.parsePositiveNumber),typeof e.angle=="number"?e.angle=e.angle*Math.PI/180:e.angle=e.angle||0,e.text=this.preprocessText(e.text),e.text&&(e.text.variantKey=e.variantKey,e.text.group=e.group,e.text.layers=e.layers,e.text.order=e.order,e.text.repeat_group=e.text.repeat_group||e.repeat_group,e.text.anchor=e.text.anchor||this.default_anchor,e.text.optional=typeof e.text.optional=="boolean"&&e.text.optional,e.text.interactive=e.text.interactive||e.interactive),e.stick&&(e.stick.color=StyleParser.createColorPropertyCache(e.stick.color)),e},default_anchor:["bottom","top","right","left"],computeLayout:function(e,r,n,o,s){var l=e||{};l.id=r,l.units_per_pixel=s.units_per_pixel||1,l.collide=n.collide!==!1,l.anchor=n.anchor,l.offset=StyleParser.evalCachedProperty(n.offset,o)||StyleParser.zeroPair,l.buffer=StyleParser.evalCachedProperty(n.buffer,o)||StyleParser.zeroPair,l.repeat_distance=StyleParser.evalCachedProperty(n.repeat_distance,o),l.repeat_distance&&(l.repeat_distance*=l.units_per_pixel,l.repeat_scale=1,typeof n.repeat_group=="function"?l.repeat_group=n.repeat_group(o):l.repeat_group=n.repeat_group);var h=n.priority;return h!=null?typeof h=="function"&&(h=h(o)):h=4294967295,l.priority=h,l},buildTextLabels:function(e,r){for(var n=[],o=0;o<r.length;o++){var s=r[o],l=this.texts[e.id][s.text_settings_key][s.text].size.collision_size;s.label=new LabelPoint(s.point_label.position,l,s.point_label.isFlat(),s.layout),n.push(s)}return n},buildLabels:function(e,r,n){var o=!!n.flat,s=[];if(r.type==="Point")s.push(new LabelPoint(r.coordinates,e,o,n));else if(r.type==="MultiPoint")for(var l=r.coordinates,h=0;h<l.length;++h){var d=l[h];s.push(new LabelPoint(d,e,o,n))}else if(r.type==="LineString")for(var y=placePointsOnLine(r.coordinates,e,o,n),g=0;g<y.length;++g)s.push(y[g]);else if(r.type==="MultiLineString")for(var v=r.coordinates,m=0;m<v.length;m++)for(var w=placePointsOnLine(v[m],e,o,n),I=0;I<w.length;++I)s.push(w[I]);else if(r.type==="Polygon")if(n.placement===PLACEMENT$1.CENTROID){var V=Geo$1.centroid(r.coordinates);s.push(new LabelPoint(V,e,o,n))}else for(var q=r.coordinates,De=0;De<q.length;De++)for(var _n=placePointsOnLine(q[De],e,o,n),ha=0;ha<_n.length;++ha)s.push(_n[ha]);else if(r.type==="MultiPolygon")if(n.placement===PLACEMENT$1.CENTROID){var ga=Geo$1.multiCentroid(r.coordinates);s.push(new LabelPoint(ga,e,o,n))}else for(var _o=r.coordinates,_l=0;_l<_o.length;_l++)for(var wc=_o[_l],_h=0;_h<wc.length;_h++)for(var _p=placePointsOnLine(wc[_h],e,o,n),pd=0;pd<_p.length;++pd)s.push(_p[pd]);return s},makeVertexTemplate:function(e,r){var n,o=e.color||StyleParser.defaults.color,s=r.vertex_data.vertex_layout;return this.fillVertexTemplate(s,"a_position",0,{size:2}),this.fillVertexTemplate(s,"a_position",e.z||0,{size:1,offset:2}),this.fillVertexTemplate(s,"a_position",this.scaleOrder(e.order),{size:1,offset:3}),this.fillVertexTemplate(s,"a_shape",0,{size:4}),this.fillVertexTemplate(s,"a_shape",e.label.layout.collide?0:1,{size:1,offset:3}),this.fillVertexTemplate(s,"a_texcoord",0,{size:2}),this.fillVertexTemplate(s,"a_offset",0,{size:2}),this.fillVertexTemplate(s,"a_color",Vector$1.mult(o,255),{size:4}),this.defines.TANGRAM_HAS_SHADER_POINTS&&r.variant.shader_point&&(n=e.outline_color||StyleParser.defaults.outline.color,this.fillVertexTemplate(s,"a_outline_color",Vector$1.mult(n,255),{size:4}),this.fillVertexTemplate(s,"a_outline_edge",e.outline_edge_pct||StyleParser.defaults.outline.width,{size:1})),this.selection&&this.fillVertexTemplate(s,"a_selection_color",Vector$1.mult(e.selection_color,255),{size:4}),this.fillVertexTemplate(s,"a_is_flat",0,{size:1}),this.defines.TANGRAM_POINT_DRAW_STICK&&e.stick&&(this.fillVertexTemplate(s,"a_is_stick",0,{size:1}),this.fillVertexTemplate(s,"a_stick_height",e.stick.height,{size:1})),this.vertex_template},buildQuad:function(e,r,n,o,s,l,h,d,y,g,v,m,w,I,V,q,De,_n,ha){return r[0]<=0||r[1]<=0?0:buildQuadsForPoints(e,V,q,{quad:r,quad_normalize:256,offset:d,offsets:y,offsets_alt:g,pre_angles:l,pre_angles_alt:h,angle:4096*n,angles:o,angles_alt:s,is_flat:w,elevate_by_altitude:I,build_stick_points:De,stick_color:De&&Vector$1.mult(_n,255),color:Vector$1.mult(ha||StyleParser.defaults.color,255),curve:m,texcoord_scale:v,texcoord_normalize,pre_angles_normalize,angles_normalize,offsets_normalize})},build:function(e,r,n){var o=e.label;return o.type==="curved"?this.buildCurvedLabel(o,e,r,n):this.buildStraightLabel(o,e,r,n)},buildStraightLabel:function(e,r,n,o){var s,l=this.makeVertexTemplate(r,n),h=e.angle||r.angle,d=e.type!=="point"?(s=r.size[e.type],default_uvs):(s=r.size,r.texcoords||default_uvs);n.uniforms=n.uniforms||{},r.label_texture?(n.uniforms.u_texture=r.label_texture,n.uniforms.u_point_type=TANGRAM_POINT_TYPE_LABEL,n.uniforms.u_apply_color_blocks=!1):(r.texture?(n.uniforms.u_texture=r.texture,n.uniforms.u_point_type=TANGRAM_POINT_TYPE_TEXTURE):(n.uniforms.u_texture=this.textureManager.default,n.uniforms.u_point_type=TANGRAM_POINT_TYPE_SHADER),n.uniforms.u_apply_color_blocks=!0);var y=e.offset,g=this.defines.TANGRAM_POINT_DRAW_STICK&&!r.label_texture&&r.stick&&0<r.stick.height,v=this.buildQuad([e.position],s,h,null,null,null,null,y,null,null,d,!1,e.isFlat(),r.elevate_by_altitude,n.vertex_data,l,g,g&&r.stick.color,r.color),m=r.linked&&r.linked.label.id;return this.trackLabel(e,m,n,v,o,g),v},buildCurvedLabel:function(e,r,n,o){for(var s=this.makeVertexTemplate(r,n),l=e.angle,h=0,d=0;d<2;d++)for(var y=0;y<e.num_segments;y++){var g=r.size[e.type][y],v=default_uvs,m=this.getTileMesh(o.tile,this.getMeshVariantTypeForDraw(r));m.uniforms=m.uniforms||{},m.uniforms.u_texture=r.label_texture,m.uniforms.u_point_type=TANGRAM_POINT_TYPE_LABEL,m.uniforms.u_apply_color_blocks=!1;var w=e.offset||[0,0],I=e.position,V=e.angles[y],q=e.offsets[y],De=e.pre_angles[y],_n=e.num_segments-y-1,ha=e.alt_angles[_n],ga=e.alt_pre_angles[_n],_o=e.alt_offsets[_n],_l=this.buildQuad([I],g,l,V,ha,De,ga,w,q,_o,v,!0,e.isFlat(),r.elevate_by_altitude,m.vertex_data,s,!1,!1,r.color);h+=_l;var wc=r.linked&&r.linked.label.id;this.trackLabel(e,wc,n,_l,o,!1)}return h},trackLabel:function(e,r,n,o,s,l){var h=5<arguments.length&&l!==void 0&&l;n.labels=n.labels||{},n.labels.collision=n.labels.collision||{},n.labels["non-collision"]=n.labels["non-collision"]||{};var d=e.layout.collide?n.labels.collision:n.labels["non-collision"];d[e.id]=d[e.id]||{container:{label:e.text_data?Object.assign(e.toJSON(),{text_data:e.text_data}):e.toJSON(),linked:r},ranges:[]};var y=2*o,g=n.vertex_data.offset-n.vertex_data.stride*y;d[e.id].ranges.push([g,y,h])},buildLines:function(e,r,n,o){return this.build(r,n,o)},buildPoints:function(e,r,n,o){return this.build(r,n,o)},buildPolygons:function(e,r,n,o){return this.build(r,n,o)},vertexLayoutForMeshVariant:function(e){var r;return this.vertex_layout||(r=[{name:"a_position",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_shape",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:gl$1.UNSIGNED_SHORT,normalized:!0},{name:"a_offset",size:2,type:gl$1.SHORT,normalized:!1},{name:"a_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_outline_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0,static:[0,0,0,0]},{name:"a_outline_edge",size:1,type:gl$1.FLOAT,normalized:!1,static:0},{name:"a_selection_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_is_flat",size:1,type:gl$1.UNSIGNED_BYTE,normalized:!0}],this.defines&&this.defines.TANGRAM_POINT_DRAW_STICK&&r.push({name:"a_is_stick",size:1,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_stick_height",size:1,type:gl$1.FLOAT,normalized:!1}),this.vertex_layout=new VertexLayout(r),(r=r.map(function(n){return Object.assign({},n)})).forEach(function(n){n.name!=="a_outline_color"&&n.name!=="a_outline_edge"||(n.static=null)}),this.vertex_layout_shader_point=new VertexLayout(r)),e.shader_point?this.vertex_layout_shader_point:this.vertex_layout},computeVariantForDraw:function(e){var r=e.label_texture||e.texture||this.default_mesh_variant.key;return{key:r,shader_point:r===this.default_mesh_variant.key,order:e.label_texture?1:0}},makeMesh:function(e,r,n){var o=2<arguments.length&&n!==void 0?n:{},o=Object.assign({},o,{fade_in_time:this.fade_in_time});return Style.makeMesh.call(this,e,r,o)}});var STOPS=[0,.33,.66,.99],LINE_EXCEED_STRAIGHT=1.5,LINE_EXCEED_STRAIGHT_NO_CURVE=1.8,LINE_EXCEED_STAIGHT_LOOSE=2.3,STRAIGHT_ANGLE_TOLERANCE=.1,CURVE_MIN_TOTAL_COST=1.3,CURVE_MIN_AVG_COST=.4,CURVE_MAX_ANGLE=1,ORIENTED_LABEL_OFFSET_FACTOR=1.2,VERTICAL_ANGLE_TOLERANCE=.01,LabelLine={create:function(e,r,n,o,s){for(var l=[{type:"straight",tolerance:s.no_curving?LINE_EXCEED_STRAIGHT_NO_CURVE:LINE_EXCEED_STRAIGHT},{type:"curved"},{type:"straight",tolerance:LINE_EXCEED_STAIGHT_LOOSE}],h=0;h<l.length;h++){var d=l[h],y=void 0;if(d.type==="straight"?y=new LabelLineStraight(r,n,o,s,d.tolerance):d.type==="curved"&&!s.no_curving&&2<n.length&&(y=new LabelLineCurved(e,n,o,s)),y&&!y.throw_away)return y}return!1}},LabelLineBase=function(){function e(r,n){_classCallCheck(this,e),this.id=Label.nextLabelId(),this.layout=n,this.position=[],this.angle=0,this.offset=n.offset.slice(),this.unit_scale=this.layout.units_per_pixel,this.type="",this.throw_away=!1,this._is_flat=r,this._circles=void 0,this.placed=null}return _createClass(e,[{key:"toJSON",value:function(){return{id:this.id,type:this.type,is_flat:this._is_flat,position:this.position,size:this.size,offset:this.offset,angle:this.angle,breach:this.breach,layout:textLayoutToJSON(this.layout),circles:this.getBoundingCircles()}}},{key:"inTileBounds",value:function(){var r=this.getAABB(),n=r.left,o=r.top,s=r.right,l=r.bottom;return Utils$1.pointInTile([n,o])&&Utils$1.pointInTile([s,l])}},{key:"getAABBForSegment",value:function(r,n,o,s){var l,h=this.unit_scale,d=n/2,y=o/2,g=_slicedToArray(r,2),v=g[0],m=g[1];this.offset[0]===0&&this.offset[1]===0||(v+=(l=Vector$1.rot(this.offset,this.angle))[0]*h,m-=l[1]*h);var w=[[Math.cos(s),-Math.sin(s)],[Math.sin(s),Math.cos(s)]],I=Vector$1.multMatrix(w,[-d,-y]),V=Vector$1.multMatrix(w,[d,-y]),q=Vector$1.multMatrix(w,[d,y]),De=Vector$1.multMatrix(w,[-d,y]);return{left:v+Math.min(I[0],V[0],q[0],De[0]),top:m+Math.max(I[1],V[1],q[1],De[1]),right:v+Math.max(I[0],V[0],q[0],De[0]),bottom:m+Math.min(I[1],V[1],q[1],De[1])}}},{key:"isFlat",value:function(){return this._is_flat}},{key:"getBoundingCircles",value:function(){}},{key:"getAABB",value:function(){}}],[{key:"splitLineByOrientation",value:function(r){for(var n=[r[0]],o=0,s=0,l=0,h=n,d=!1,y=1;y<r.length;y++){var g=r[y],v=r[y-1],m=Vector$1.length(Vector$1.sub(g,v));g[0]>v[0]?l===1?(n.push(g),s<(o+=m)&&(h=n,s=o,d=!1)):(n=[v,g],s<(o=m)&&(h=n,s=o,d=!1),l=1):g[0]<v[0]?l===-1?(n.unshift(g),s<(o+=m)&&(h=n,s=o,d=!0)):(n=[g,v],s<(o=m)&&(h=n,s=o,d=!0),l=-1):(l===-1?n.unshift(g):(n.push(g),l=1),s<(o+=m)&&(h=n,s=o,d=l===-1))}return[h,d]}}]),e}(),LabelLineStraight=function(){_inherits(r,LabelLineBase);var e=_createSuper(r);function r(n,o,s,l,h){var d;return _classCallCheck(this,r),(d=e.call(this,s,l)).type="straight",d.size=n,d.throw_away=!d.fit(n,o,l,h),d}return _createClass(r,[{key:"fit",value:function(n,o,s,l){var h,d=this.unit_scale,y=_slicedToArray(LabelLineBase.splitLineByOrientation(o),2);o=y[0],h=y[1],typeof s.orientation=="number"&&(this.offset[1]+=ORIENTED_LABEL_OFFSET_FACTOR*(n[1]-s.vertical_buffer),h&&(this.offset[1]*=-1),s.orientation===-1&&(this.offset[1]*=-1));for(var g=getLineLengths(o),v=n[0]*d,m=0;m<o.length-1;m++)for(var w=o[m],I=0,V=0,q=m+1,De=void 0;q<o.length;){var _n=o[q-1],ha=o[q],ga=getAngleForSegment(_n,ha);if(q!==m+1&&(I+=getAbsAngleDiff(ga,De)),Math.abs(I)>STRAIGHT_ANGLE_TOLERANCE)break;if(calcFitness(V+=g[q-1],v)<l){var _o=Vector$1.mult(Vector$1.add(w,ha),.5);return this.angle=-ga,Math.abs(this.angle-Math.PI/2)<VERTICAL_ANGLE_TOLERANCE&&(this.angle=-Math.PI/2,typeof s.orientation=="number"&&(this.offset[1]*=-1)),this.position=_o,this.breach=!this.inTileBounds(),!0}De=ga,q++}return!1}},{key:"getBoundingCircles",value:function(){var n,o,s,l,h,d,y,g,v,m,w,I,V,q;return this._circles||(n=this.unit_scale,h=-(s=(o=this.size[0]/2*n)*Math.cos(this.angle)),d=-(l=o*Math.sin(this.angle)),y=this.offset[0]*n,g=this.offset[1]*n,m=(v=_slicedToArray(this.position,2))[0],w=v[1],w*=-1,y&&(I=[s,l],Vector$1.normalize(I),I[0]*=y,I[1]*=y,m+=I[0],w+=I[1]),g&&(V=[l,-s],Vector$1.normalize(V),V[0]*=g,V[1]*=g,m-=V[0],w-=V[1]),s+=m,l+=w,h+=m,d+=w,q=this.size[1]/2*n,this._circles=encircleLine(s,l,h,d,q)),this._circles}},{key:"getAABB",value:function(){var n,o,s,l,h;return this._aabb||(n=this.unit_scale,o=this.size,s=this.layout.buffer,l=(o[0]+2*s[0])*n,h=(o[1]+2*s[1])*n,this._aabb=this.getAABBForSegment(this.position,l,h,this.angle)),this._aabb}}]),r}(),LabelLineCurved=function(){_inherits(r,LabelLineBase);var e=_createSuper(r);function r(n,o,s,l){var h;return _classCallCheck(this,r),(h=e.call(this,s,l)).type="curved",h.positions=[],h.angles=[],h._aabbs=[],h.pre_angles=[],h.offsets=[],h.num_segments=n.length,h.sizes=n,h.alt_angles=[],h.alt_pre_angles=[],h.alt_offsets=[],h.throw_away=!h.fit(h.sizes,o,l),h}return _createClass(r,[{key:"toJSON",value:function(){return{id:this.id,type:this.type,is_flat:this._is_flat,position:this.position,breach:this.breach,layout:textLayoutToJSON(this.layout),circles:this.getBoundingCircles()}}},{key:"fit",value:function(n,o,s){var l,h=this.unit_scale,d=Math.max.apply(Math,_toConsumableArray(n.map(function(c0){return c0[1]}))),y=d*h,g=_slicedToArray(LabelLineBase.splitLineByOrientation(o),2);o=g[0],l=g[1],typeof s.orientation=="number"&&(this.offset[1]+=ORIENTED_LABEL_OFFSET_FACTOR*(d-s.vertical_buffer),l&&(this.offset[1]*=-1),s.orientation===-1&&(this.offset[1]*=-1));var v=getLineLengths(o),m=n.map(function(c0){return c0[0]*h}),w=v.reduce(function(c0,_g){return c0+_g},0),I=m.reduce(function(c0,_g){return c0+_g},0);if(w<I)return!1;var V=o.length-1;if(V<2)return!1;var q=r.curvaturePlacement(o,w,v,I,0,V),De=o[q];if(q===-1||V-q<2)return!1;this.position=De;for(var _n=0;_n<m.length;_n++){this.positions[_n]=[],this.offsets[_n]=[],this.angles[_n]=[],this.pre_angles[_n]=[];for(var ha=0;ha<STOPS.length;ha++){var ga=STOPS[ha],_o=_slicedToArray(r.scaleLine(ga,o),2),_l=_o[0],wc=_o[1],De=_l[q],_h=r.placeAtIndex(q,_l,wc,m),_p=_h.positions,pd=_h.offsets,oy=_h.angles,ny=_h.pre_angles,fy=pd.map(function(_g){return Math.sqrt(_g[0]*_g[0]+_g[1]*_g[1])/h});if(ga===0){this.angle=1/oy.length*oy.reduce(function(_g,w0){return _g+w0});for(var wy=0;wy<_p.length;wy++){var cy=_p[wy],Gy=ny[wy],jy=m[wy],Wy=Gy+oy[wy];this._aabbs.push(this.getAABBForSegment(cy,jy,y,Wy))}}this.positions[_n].push(_p[_n]),this.offsets[_n].push(fy[_n]),this.angles[_n].push(oy[_n]),this.pre_angles[_n].push(ny[_n])}}for(var m=n.slice().reverse().map(function(_g){return _g[0]*h}),Iy=0;Iy<m.length;Iy++){this.alt_offsets[Iy]=[],this.alt_angles[Iy]=[],this.alt_pre_angles[Iy]=[];for(var vy=0;vy<STOPS.length;vy++){var Ty=STOPS[vy],Vy=_slicedToArray(r.scaleLine(Ty,o),2),a0=Vy[0],zy=Vy[1];De=a0[q];var h0=r.placeAtIndex(q,a0,zy,m),k0=h0.offsets,_0=h0.angles,T0=h0.pre_angles,x0=k0.map(function(_g){return Math.sqrt(_g[0]*_g[0]+_g[1]*_g[1])/h});Ty===0&&(this.alt_angle=1/_0.length*_0.reduce(function(_g,w0){return _g+w0})),this.alt_offsets[Iy].push(x0[Iy]),this.alt_angles[Iy].push(_0[Iy]),this.alt_pre_angles[Iy].push(T0[Iy])}}return!0}},{key:"getBoundingCircles",value:function(){if(!this._circles){for(var n=[],o=this.unit_scale,s=0;s<this.positions.length;s++){var l=this.sizes[s],h=this.angles[s][0],d=this.positions[s][0],y=l[0]/2*o,g=y*Math.cos(h),v=y*Math.sin(h),m=-g,w=-v,I=_slicedToArray(d,2),V=I[0],q=I[1],De=encircleLine(g+=V,v+=q*=-1,m+=V,w+=q,l[1]/2*o);Array.prototype.push.apply(n,De)}this._circles=n}return this._circles}},{key:"getAABB",value:function(){if(!this._aabb){for(var s=1/0,l=-1/0,h=-1/0,d=1/0,n=0;n<this._aabbs.length;n++)var o=this._aabbs[n],s=Math.min(s,o.left),l=Math.max(l,o.top),h=Math.max(h,o.right),d=Math.min(d,o.bottom);this._aabb={left:s,top:l,right:h,bottom:d}}return this._aabb}}],[{key:"curvaturePlacement",value:function(n,o,s,l,h,d){h=h||0,d=d||n.length-1;for(var y=[],g=h+1;g<d;g++){var v=n[g-1],m=n[g],w=n[g+1],I=Vector$1.perp(m,v),V=Vector$1.perp(w,m),q=Vector$1.angleBetween(I,V);CURVE_MAX_ANGLE<q&&(q=1/0),y.push(q)}y.push(1/0);for(var De=[],_n=[],ha=h,ga=0,_o=0;_o<h;_o++)ga+=s[_o];for(;ga+l<o;){for(var _l=ga+l,wc=ga,_h=ha,_p=0;_h<d&&wc+s[_h]<_l&&(_p+=y[_h])!==1/0;)wc+=s[_h],_h++;if(_p===0)return ha;var pd=_p/(_h-ha);De.push(_p),_n.push(pd),ga+=s[ha],ha++}if(De.length===0)return-1;var oy=Math.min.apply(null,De),ny=_n[De.indexOf(oy)];return oy<CURVE_MIN_TOTAL_COST&&ny<CURVE_MIN_AVG_COST?De.indexOf(oy):-1}},{key:"scaleLine",value:function(n,o){var s=[o[0]],l=[];return o.forEach(function(h,d){var y,g;d!==o.length-1&&(y=Vector$1.sub(o[d+1],o[d]),g=Vector$1.mult(y,1+n),s.push(Vector$1.add(s[d],g)),l.push(Vector$1.length(g)))}),[s,l]}},{key:"placeAtIndex",value:function(n,o,s,l){var h=o[n],d=_slicedToArray(r.getIndicesAndOffsets(n,s,l),2),y=d[0],g=d[1],v=r.getPositionsFromIndicesAndOffsets(o,y,g),m=_slicedToArray(r.getAnglesFromIndicesAndOffsets(h,y,o,v),3);return{positions:v,offsets:m[0],angles:m[1],pre_angles:m[2]}}},{key:"getIndicesAndOffsets",value:function(n,o,s){for(var l=s.length,h=[],d=[],y=0,g=0,v=0;y<l;){for(var m=s[y];y<l&&g+.5*m<=v+o[n];){var w=g-v+.5*m;d.push(w),h.push(n),g+=m,m=s[++y]}v+=o[n],n++}return[h,d]}},{key:"getPositionsFromIndicesAndOffsets",value:function(n,o,s){for(var l=[],h=0;h<o.length;h++){var d=o[h],y=s[h],g=getAngleForSegment(n[d],n[d+1]),v=Vector$1.rot([y,0],g),m=Vector$1.add(n[d],v);l.push(m)}return l}},{key:"getAnglesFromIndicesAndOffsets",value:function(n,o,s,l){for(var h=[],d=[],y=[],g=0;g<l.length;g++){var v,m,w=l[g],I=o[g],V=Vector$1.sub(w,n),q=-Vector$1.angle(V),De=getTextAngleForSegment(s[I],s[I+1])-q;0<g&&(v=h[g-1],m=d[g-1],Math.abs(q-v)>Math.PI&&(q+=v<q?-2*Math.PI:2*Math.PI),Math.abs(m-De)>Math.PI&&(De+=m<De?-2*Math.PI:2*Math.PI)),h.push(q),d.push(De),y.push(V)}return[y,h,d]}}]),r}();function calcFitness(e,r){return r/e}function getAngleForSegment(e,r){var n=Vector$1.sub(r,e);return Vector$1.angle(n)}function getTextAngleForSegment(e,r){return-getAngleForSegment(e,r)}function getLineLengths(e){for(var r=[],n=0;n<e.length-1;n++){var o=e[n],s=e[n+1],l=Math.hypot(o[0]-s[0],o[1]-s[1]);r.push(l)}return r}function getAbsAngleDiff(e,r){for(var n,o=r<e?(n=r,e):(n=e,r);o-n>Math.PI;)n+=2*Math.PI;return Math.abs(o-n)}var TextStyle=Object.create(Points);Object.assign(TextStyle,{name:"text",super:Points,built_in:!0,init:function(e){var r=0<arguments.length&&e!==void 0?e:{};Style.init.call(this,r),this.setupDefines(),this.defines.TANGRAM_HAS_SHADER_POINTS=!1,this.defines.TANGRAM_IS_TEXT_STYLE=!0,this.reset()},makeVertexTemplate:function(e,r){this.super.makeVertexTemplate.apply(this,arguments);var n=r.vertex_data.vertex_layout;return this.fillVertexTemplate(n,"a_pre_angles",0,{size:4}),this.fillVertexTemplate(n,"a_offsets",0,{size:4}),this.fillVertexTemplate(n,"a_angles",0,{size:4}),this.fillVertexTemplate(n,"a_offsets_alt",0,{size:4}),this.fillVertexTemplate(n,"a_pre_angles_alt",0,{size:4}),this.fillVertexTemplate(n,"a_angles_alt",0,{size:4}),this.vertex_template},reset:function(){this.queues={},this.resetText()},addFeature:function(e,r,n){var o=this,s=n.tile,l=e.geometry.type;r.can_articulate=l==="LineString"||l==="MultiLineString",r.supersample_text=l==="LineString"||l==="MultiLineString";var h=this.parseTextFeature(e,r,n,s);h&&(h instanceof Array?h.forEach(function(d){d.feature=e,d.context=n,d.layout.vertex=!1,o.queueFeature(d,s)}):(h.feature=e,h.context=n,h.layout.vertex=!1,this.queueFeature(h,s)),Collision.addStyle(this.name,s.id))},endData:function(e){var r=this,n=this.queues[e.id];return delete this.queues[e.id],this.collideAndRenderTextLabels(e,this.name,n).then(function(o){var s=o.labels,l=o.texts;return s&&l&&(r.texts[e.id]=l,s.forEach(function(h){var d=h.text_settings_key,y=r.texts[e.id][d]&&r.texts[e.id][d][h.text],g=r.feature_style;g.label=h.label,h.label.text_data={text_info:y,text_settings_key:d,text:h.text},g.label_texture=r.textureManager.default,y.text_settings.can_articulate?(g.size={},h.label.type==="straight"?g.size.straight=y.size.logical_size:g.size.curved=y.segment_sizes.map(function(v){return v.logical_size})):g.size=y.size.logical_size,Style.addFeature.call(r,h.feature,h.draw,h.context)})),r.freeText(e),Style.endData.call(r,e).then(function(h){if(h){for(var d in h.meshes)h.meshes[d].uniforms.u_apply_color_blocks=!0;e.mesh_data[r.name]=h}return h})})},_preprocess:function(e){return this.preprocessText(e)},buildTextLabels:function(e,r){for(var n=[],o=0;o<r.length;o++){var s,l=r[o],h=this.texts[e.id][l.text_settings_key][l.text],d=void 0;l.layout.vertical_buffer=h.vertical_buffer,d=h.text_settings.can_articulate?(s=h.segment_sizes.map(function(v){return v.collision_size}),l.layout.no_curving=h.no_curving,this.buildLabels(s,l.feature.geometry,l.layout,h.size.collision_size)):this.buildLabels(h.size.collision_size,l.feature.geometry,l.layout);for(var y=0;y<d.length;y++){var g=Object.create(l);g.label=d[y],n.push(g)}}return n},buildLabels:function(e,r,n,o){var s,l,h=r.type!=="Point",d=[];if(r.type==="LineString")Array.prototype.push.apply(d,this.buildLineLabels(r.coordinates,e,h,n,o));else if(r.type==="MultiLineString")for(var y=r.coordinates,g=0;g<y.length;++g)Array.prototype.push.apply(d,this.buildLineLabels(y[g],e,h,n,o));else if(r.type==="Point")d.push(new LabelPoint(r.coordinates,e,h,n));else if(r.type==="MultiPoint")for(var v=r.coordinates,m=0;m<v.length;++m)d.push(new LabelPoint(v[m],e,h,n));else r.type==="Polygon"?(s=Geo$1.centroid(r.coordinates),d.push(new LabelPoint(s,e,h,n))):r.type==="MultiPolygon"&&(l=Geo$1.multiCentroid(r.coordinates),d.push(new LabelPoint(l,e,h,n)));return d},buildLineLabels:function(e,r,n,o,s){var l,h=[],d=Math.min(o.subdiv,e.length-1);if(1<d)for(var y=(e.length-1)/d,g=0;g<d;g++){var v=Math.floor(g*y),m=Math.floor((g+1)*y)+1,w=e.slice(v,m),I=LabelLine.create(r,s,w,n,o);I&&h.push(I)}return h.length<d&&(l=LabelLine.create(r,s,e,n,o))&&h.push(l),h},vertexLayoutForMeshVariant:function(){var e;return this.vertex_layout||(e=[{name:"a_position",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_shape",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:gl$1.UNSIGNED_SHORT,normalized:!0},{name:"a_offset",size:2,type:gl$1.SHORT,normalized:!1},{name:"a_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_angles",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_offsets",size:4,type:gl$1.UNSIGNED_SHORT,normalized:!1},{name:"a_pre_angles",size:4,type:gl$1.BYTE,normalized:!1},{name:"a_selection_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_is_flat",size:1,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_offsets_alt",size:4,type:gl$1.UNSIGNED_SHORT,normalized:!1},{name:"a_pre_angles_alt",size:4,type:gl$1.BYTE,normalized:!1},{name:"a_angles_alt",size:4,type:gl$1.SHORT,normalized:!1}],this.vertex_layout=new VertexLayout(e)),this.vertex_layout},getMeshVariantTypeForDraw:Points.getMeshVariantTypeForDraw}),TextStyle.texture_id=0;var RasterStyle=Object.create(Polygons);Object.assign(RasterStyle,{name:"raster",super:Polygons,built_in:!0,init:function(){this.raster=this.raster||"color",this.super.init.apply(this,arguments),this.selection=!1,this.defines.SNAP_TO_PIXEL_GRID=!0},_preprocess:function(e){return e.color=e.color||StyleParser.defaults.color,this.super._preprocess.apply(this,arguments)}});var CustomIcons=Object.create(Points);Object.assign(CustomIcons,{name:"custom_icons",collision:!1,init:function(e){var r=0<arguments.length&&e!==void 0?e:{};Points.init.call(this,r)},loadTexture:function(e,r,n){var o,s=e.width,l=e.height,h=e.items,d=document.createElement("canvas"),y=Utils$1.device_pixel_ratio,g=this.sources[r],v={sprites:{}};if(d.width=s*y,d.height=l*y,g){var m,w=h.length,I=d.getContext("2d");for(I.scale(y,y);m=h[--w];){var V,q=g.getIconBitmapByObjectId(m.meta.objectId,m.meta.id);q&&((V=isTainting(q))?log("error",V):(I.drawImage(q,m.x,m.y,m.width,m.height),v.sprites[m.meta.id]=[m.x,m.y,m.width,m.height]))}}return v.element=d,(o=this.textureManager.create(this.gl,n,v)).retain(),o.loading.then(function(De){return De.name})},buildRasterTextures:function(e,r){return WorkerBroker.postMessage(this.main_thread_target+".loadTexture",e.rasters,e.source,e.texture_name).then(function(n){return r.textures.push(n),r})},addFeature:function(e,r,n){var o=n.tile.rasters,s={};o.items.forEach(function(d){s[d.meta.id]=[d.x,d.y,d.width,d.height]});var l="".concat(n.tile.source,"_dyn_").concat(n.tile.coords.key,"_").concat(this.generation,"_").concat(n.tile.id);r.texture=n.tile.texture_name=l;var h=Object.assign({},DEFAULT_TEXTURE_INFO,{name:l,width:o.width,height:o.height,sprites:s,manager:this.textureManager});Texture.prototype.calculateSprites.apply(h),this.textureManager.textures[l]=h,Points.addFeature.apply(this,arguments),delete this.textureManager.textures[l]}});var DEFAULT_TEXTURE_INFO={filtering:"linear",density:1,valid:!0,power_of_2:!1,texcoords:{},sizes:{},css_sizes:{},aspects:{}},OverlayStyle=Object.create(Polygons);Object.assign(OverlayStyle,{name:"overlays",super:Polygons,init:function(e){var r=0<arguments.length&&e!==void 0?e:{};this.selection=r.selection||!0,this.raster=this.raster||"color",this.super.init.apply(this,arguments)},setupRasters:function(){if(!Thread.is_main)return!1;if(this.super.setupRasters.call(this))return!0;var e=!1;for(var r in this.sources)if(this.sources[r]instanceof ObjectSource){e=!0;break}return!!e&&(this.defines.TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING=!0,this.replaceShaderBlock("raster",shaderSrc_rasters,"Raster"),!0)},loadTextures:function(e,r){var n,o,s,l=this.sources[r],h=e.name;if(e.overlays_config.forEach(function(g){var v,m=g.texcoords,w=g.id,I=l.getMapObjectById(w),V=I.getBitmap();V&&((v=isTainting(V=bitmapToCanvas(V,V.width,V.height)))?log("error",v):(n||((n=document.createElement("canvas")).width=e.width,n.height=e.height,o=n.getContext("2d")),o.save(),o.globalAlpha=I.getOpacity(),m.forEach(function(q){return o.drawImage(V,q[0],q[1],q[2],q[3])}),o.restore(),s=!0))}),s){e.element=n;var d={};return d[h]=e,this.super.loadTextures.call(this,d)}var y=this.textureManager.textures[this.textureManager.default];return Promise.resolve([{name:y.name,width:y.width,height:y.height,loaded:y.loaded}])},buildRasterTextures:function(e,r){var n=this.sources[e.source].tileTexture(e);return n?WorkerBroker.postMessage(this.main_thread_target+".loadTextures",n,e.source).then(function(o){if(!o||o.length<1)return r;if(o.some(function(l){return!l.loaded}))return null;var s=o[0].name;return r.uniforms=r.uniforms||{},r.textures=r.textures||[],r.uniforms.u_raster=s,r.uniforms.u_raster_offset=[0,0,1],r.textures.push(s),r}):Promise.resolve(r)}});var shaderSrc_Vertex="uniform float u_horizon;uniform float u_tilt;uniform float u_zoom;attribute vec2 a_position;attribute float a_is_sky;attribute float a_is_top;attribute vec4 a_color;varying vec4 v_color;const float SIN_THRESHOLD_ANGLE=0.96126069082;void main(){v_color=a_color;float sin_tilt=sin(u_tilt);float sky_bottom_alpha=1.-max(sin_tilt-SIN_THRESHOLD_ANGLE,0.)*3.;if((a_position.y==1.&&a_is_sky==0.)||(a_position.y==0.&&a_is_sky==1.)){v_color.w=sky_bottom_alpha;}float fog_height=max((22.-u_zoom)*0.04,0.)*(sin_tilt-.7);float position_z=u_zoom<17. ? .942 : .9418;gl_Position=vec4(a_position.x,a_is_sky*(a_position.y+a_is_top)+1.0-u_horizon-(1.0-a_is_sky)*(1.0-a_position.y)*fog_height,position_z,1.0);}",shaderSrc_Fragment="varying vec4 v_color;void main(void){gl_FragColor=v_color;}",STYLE_NAME="skybox",SkyBox=Object.create(Style),positions=[-1,0,1,0,-1,1,-1,1,1,0,1,1,-1,0,1,0,-1,1,-1,1,1,0,1,1];Object.assign(SkyBox,{name:STYLE_NAME,built_in:!0,vertex_shader_src:shaderSrc_Vertex,fragment_shader_src:shaderSrc_Fragment,selection:!1,blend:"inlay",blend_order:1,init:function(){Style.init.apply(this,arguments),this.selection=!1},_preprocess:function(e){return e.color={top:StyleParser.createColorPropertyCache(e.color.zenith),bottom:StyleParser.createColorPropertyCache(e.color.horizon),fog:StyleParser.createColorPropertyCache(e.color.fog)},e},vertexLayoutForMeshVariant:function(){var e;return this.vertex_layout||(e=[{name:"a_position",size:2,type:gl$1.FLOAT,normalized:!1},{name:"a_is_sky",size:1,type:gl$1.FLOAT,normalized:!0},{name:"a_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_is_top",size:1,type:gl$1.FLOAT,normalized:!0}],this.vertex_layout=new VertexLayout(e)),this.vertex_layout},makeVertexTemplate:function(){var e=0;return this.vertex_template[e++]=0,this.vertex_template[1]=0,this.vertex_template},parseFeature:function(e,r,n){var o=this.feature_style;return r.color&&r.color.top&&r.color.bottom&&(o.color_top=this.parseColor(r.color.top,n),o.color_bottom=this.parseColor(r.color.bottom,n),o.color_fog=this.parseColor(r.color.fog||"white",n),Array.isArray(o.color_fog)&&(o.color_fog=o.color_fog.slice(),o.color_fog[3]=0)),o},buildGeometry:function(e,r,n){for(var o=this.makeVertexTemplate(r),s=n.vertex_data,l=n.vertex_data.vertex_layout,h=s.vertex_layout.index.a_position,d={top:r.color_top,bottom:r.color_bottom},y={top:r.color_bottom,bottom:r.color_fog},g=0,v=positions.length-1;g<v;g+=2){o[h+0]=positions[g],o[h+1]=positions[g+1];var m=g<12,w=0<positions[g+1],I=m?d:y;this.fillVertexTemplate(l,"a_is_sky",m?1:0,{size:1}),this.fillVertexTemplate(l,"a_is_top",w?1:0,{size:1}),this.fillVertexTemplate(l,"a_color",Vector$1.mult(w?I.top:I.bottom,255),{size:4}),s.addVertex(o)}return 4}});var shaderSrc_accessors=`#ifdef TANGRAM_VERTEX_SHADER
vec4 modelPosition(){return vec4(a_position.xyz/TANGRAM_TILE_SCALE*exp2(u_tile_origin.z-u_tile_origin.w),1.)+vec4(0.,1.,0.,0.);}vec4 modelPositionBaseZoom(){return vec4(a_position.xyz/TANGRAM_TILE_SCALE,1.)+vec4(0.,1.,0.,0.);}
#endif
vec4 worldPosition(){return v_world_position;}
#ifdef TANGRAM_VERTEX_SHADER
vec4 wrapWorldPosition(vec4 world_position){
#if defined(TANGRAM_WORLD_POSITION_WRAP)
vec2 anchor=u_tile_origin.xy-mod(u_tile_origin.xy,TANGRAM_WORLD_POSITION_WRAP);world_position.xy-=anchor;
#endif
return world_position;}
#endif
#if defined(TANGRAM_VERTEX_SHADER)
vec3 worldNormal(){return TANGRAM_NORMAL;}
#elif defined(TANGRAM_FRAGMENT_SHADER)
vec3 worldNormal(){return u_inverseNormalMatrix*TANGRAM_NORMAL;}
#endif
`,shaderSrc_layerOrder="void applyLayerOrder(float layer,inout vec4 position){position.z-=layer*TANGRAM_LAYER_DELTA*position.w;}",shaderSrc_selectionGlobals=`
#if defined(TANGRAM_FEATURE_SELECTION) && defined(TANGRAM_VERTEX_SHADER)
attribute vec4 a_selection_color;varying vec4 v_selection_color;uniform vec4 u_selection_discard0;uniform vec4 u_selection_discard1;uniform vec4 u_selection_discard2;uniform vec4 u_selection_discard3;uniform vec4 u_selection_discard4;uniform vec4 u_selection_discard5;uniform vec4 u_selection_discard6;uniform vec4 u_selection_discard7;uniform vec4 u_selection_discard8;uniform vec4 u_selection_discard9;
#endif
`,shaderSrc_selectionVertex=`
#if defined(TANGRAM_FEATURE_SELECTION) && defined(TANGRAM_VERTEX_SHADER)
if(a_selection_color.rgb==vec3(0.)||a_selection_color==u_selection_discard0||a_selection_color==u_selection_discard1||a_selection_color==u_selection_discard2||a_selection_color==u_selection_discard3||a_selection_color==u_selection_discard4||a_selection_color==u_selection_discard5||a_selection_color==u_selection_discard6||a_selection_color==u_selection_discard7||a_selection_color==u_selection_discard8||a_selection_color==u_selection_discard9){gl_Position=vec4(0.,0.,0.,1.);return;}v_selection_color=a_selection_color;
#endif
`,shaderSrc_utils=`#ifndef UTILS
#define UTILS
bool isLocalSpacePixelOutsideTile(vec4 pixel_local_space_position,float tile_scale){return pixel_local_space_position.x<0.||pixel_local_space_position.x>=tile_scale||pixel_local_space_position.y>0.||pixel_local_space_position.y<=-tile_scale;}
#endif
`,shaderSrc_snapToPixelGrid=`uniform float u_view_pan_snap_timer;void snapToPixelGrid(inout vec4 position){vec2 position_fract=fract((((position.xy/position.w)+1.)*.5)*u_resolution);vec2 position_snap=position.xy+((step(0.5,position_fract)-position_fract)*position.w*2./u_resolution);
#ifdef TANGRAM_VIEW_PAN_SNAP_RATE
position.xy=mix(position.xy,position_snap,clamp(u_view_pan_snap_timer*TANGRAM_VIEW_PAN_SNAP_RATE,0.,1.));
#else
position.xy=position_snap;
#endif
}`,StyleManager=function(){function e(){_classCallCheck(this,e),this.styles={},this.base_styles={},this.register(Object.create(Polygons)),this.register(Object.create(Lines)),this.register(Object.create(PatternLines)),this.register(Object.create(Points)),this.register(Object.create(TextStyle)),this.register(Object.create(RasterStyle)),this.register(Object.create(CustomIcons)),this.register(Object.create(OverlayStyle)),this.register(Object.create(SkyBox))}return _createClass(e,[{key:"init",value:function(){ShaderProgram.removeBlock("global"),ShaderProgram.removeBlock("setup"),ShaderProgram.addBlock("global",shaderSrc_accessors),ShaderProgram.addBlock("global",shaderSrc_layerOrder),ShaderProgram.addBlock("global",shaderSrc_selectionGlobals),ShaderProgram.addBlock("global",shaderSrc_snapToPixelGrid),ShaderProgram.replaceBlock("utils",shaderSrc_utils),ShaderProgram.replaceBlock("setup",shaderSrc_selectionVertex),ShaderProgram.defines.TANGRAM_EPSILON=1e-5,ShaderProgram.defines.TANGRAM_LAYER_DELTA=1/16384,ShaderProgram.defines.TANGRAM_TILE_SCALE="vec3(".concat(Geo$1.tile_scale,"., ").concat(Geo$1.tile_scale,"., u_meters_per_pixel * ").concat(Geo$1.tile_size,".)"),ShaderProgram.defines.TANGRAM_HEIGHT_SCALE=Geo$1.height_scale,ShaderProgram.defines.TANGRAM_ALPHA_TEST=.1,Lines.dash_textures={}}},{key:"destroy",value:function(r){var n=this;Object.keys(this.styles).forEach(function(o){var s=n.styles[o];s.gl===r&&(log("trace","StyleManager.destroy: destroying render style ".concat(s.name)),s.base&&n.remove(s.name),s.destroy())})}},{key:"register",value:function(r){this.styles[r.name]=r,this.base_styles[r.name]=r}},{key:"remove",value:function(r){delete this.styles[r]}},{key:"mix",value:function(r,n){if(r.mixed)return r;r.mixed={};var o=[];r.mix&&(Array.isArray(r.mix)?o.push.apply(o,_toConsumableArray(r.mix)):o.push(r.mix),(o=o.map(function(l){return n[l]}).filter(function(l){return l&&l!==r})).forEach(function(l){return r.mixed[l.name]=!0})),o.push(r),r.animated=o.some(function(l){return l&&l.animated}),r.texcoords=o.some(function(l){return l&&l.texcoords}),r.base=o.map(function(l){return l.base}).filter(function(l){return l}).pop(),r.lighting=o.map(function(l){return l.lighting}).filter(function(l){return l!=null}).pop(),r.texture=o.map(function(l){return l.texture}).filter(function(l){return l}).pop(),r.raster=o.map(function(l){return l.raster}).filter(function(l){return l!=null}).pop(),r.dash=o.map(function(l){return l.dash}).filter(function(l){return l!=null}).pop(),r.dash_background_color=o.map(function(l){return l.dash_background_color}).filter(function(l){return l!=null}).pop(),o.some(function(l){return l.hasOwnProperty("blend")&&l.blend})&&(r.blend=o.map(function(l){return l.hasOwnProperty("blend")&&l.blend}).filter(function(l){return l}).pop()),r.blend_order=o.map(function(l){return l.blend_order}).filter(function(l){return l!=null}).pop(),r.defines=Object.assign.apply(Object,[{}].concat(_toConsumableArray(o.map(function(l){return l.defines}).filter(function(l){return l})))),r.material=Object.assign.apply(Object,[{}].concat(_toConsumableArray(o.map(function(l){return l.material}).filter(function(l){return l}))));var s=o.map(function(l){return l.draw}).filter(function(l){return l});return 0<s.length&&(r.draw=mergeObjects.apply(void 0,[{}].concat(_toConsumableArray(s)))),this.mixShaders(r,n,o),r}},{key:"mixShaders",value:function(r,n,o){var s={},l=o.map(function(v){return v.shaders}).filter(function(v){return v});if(s.defines=Object.assign.apply(Object,[{}].concat(_toConsumableArray(l.map(function(v){return v.defines}).filter(function(v){return v})))),s.uniforms={},s._uniforms=r.shaders&&r.shaders.uniforms||{},s._uniform_scopes={},o.filter(function(v){return v.shaders&&v.shaders.uniforms}).forEach(function(v){for(var m in v.shaders.uniforms)(function(w){s._uniform_scopes[w]=v.name,Object.defineProperty(s.uniforms,w,{enumerable:!0,configurable:!0,get:function(){return s._uniforms[w]!==void 0?s._uniforms[w]:n[s._uniform_scopes[w]].shaders.uniforms!==s.uniforms?n[s._uniform_scopes[w]].shaders.uniforms[w]:void 0},set:function(I){s._uniforms[w]=I}})})(m)}),s.extensions=Object.keys(l.map(function(v){return v.extensions}).filter(function(v){return v}).reduce(function(v,m){return typeof m=="string"?v[m]=!0:m.forEach(function(w){return v[w]=!0}),v},{})||{}),r.shaders&&r.shaders.blocks)for(var h in r.shaders.block_scopes=r.shaders.block_scopes||{},r.shaders.blocks){var d,y=r.shaders.blocks[h];r.shaders.block_scopes[h]=r.shaders.block_scopes[h]||[],Array.isArray(y)?(d=r.shaders.block_scopes[h]).push.apply(d,_toConsumableArray(y.map(function(){return r.name}))):r.shaders.block_scopes[h].push(r.name)}var g={};return l.forEach(function(v){if(v.blocks){s.blocks=s.blocks||{},s.block_scopes=s.block_scopes||{};var m={};for(var w in v.blocks){var I=v.blocks[w],V=v.block_scopes[w];s.blocks[w]=s.blocks[w]||[],s.block_scopes[w]=s.block_scopes[w]||[],I=Array.isArray(I)?I:[I],V=Array.isArray(V)?V:[V];for(var q=0;q<I.length;q++)g[V[q]]||(m[V[q]]=!0,s.blocks[w].push(I[q]),s.block_scopes[w].push(V[q]))}Object.assign(g,m)}}),Object.assign(r.mixed,g),r.shaders=s,r}},{key:"create",value:function(r,n,o){var s=2<arguments.length&&o!==void 0?o:{},l=mergeObjects({},n);return l.name=r,(l=this.mix(l,s)).base&&this.base_styles[l.base]?this.styles[r]=l=Object.assign(Object.create(this.base_styles[l.base]),l):l.base=null,l}},{key:"build",value:function(r){var n=this,o=Object.keys(r).sort(function(h,d){return n.inheritanceDepth(h,r)-n.inheritanceDepth(d,r)});for(var s in this.styles)this.base_styles[s]?this.styles[s].reset():delete this.styles[s];var l={};return o.forEach(function(h){l[h]=n.create(h,r[h],l)}),this.styles}},{key:"initStyles",value:function(r){var n=0<arguments.length&&r!==void 0?r:{};for(var o in this.styles)this.styles[o].init(n)}},{key:"inheritanceDepth",value:function(r,n){for(var o=this,s=0;;){var l=n[r];if(!l||!l.mix)break;if(s++,Array.isArray(l.mix)){s+=Math.max.apply(Math,_toConsumableArray(l.mix.map(function(h){if(r!==h)return o.inheritanceDepth(h,n)})));break}if(r===l.mix)break;r=l.mix}return s}}]),e}();function isNothing(e){return e==null}function isObject$2(e){return typeof e=="object"&&e!==null}function toArray(e){return Array.isArray(e)?e:isNothing(e)?[]:[e]}function extend$1(e,r){var n,o,s,l;if(r)for(n=0,o=(l=Object.keys(r)).length;n<o;n+=1)e[s=l[n]]=r[s];return e}function repeat(e,r){for(var n="",o=0;o<r;o+=1)n+=e;return n}function isNegativeZero(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var isNothing_1=isNothing,isObject_1=isObject$2,toArray_1=toArray,repeat_1=repeat,isNegativeZero_1=isNegativeZero,extend_1=extend$1,common={isNothing:isNothing_1,isObject:isObject_1,toArray:toArray_1,repeat:repeat_1,isNegativeZero:isNegativeZero_1,extend:extend_1};function YAMLException(e,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||"",this.name="YAMLException",this.reason=e,this.mark=r,this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():"")}YAMLException.prototype=Object.create(Error.prototype),YAMLException.prototype.constructor=YAMLException,YAMLException.prototype.toString=function(e){var r=this.name+": ";return r+=this.reason||"(unknown reason)",!e&&this.mark&&(r+=" "+this.mark.toString()),r};var exception=YAMLException;function Mark(e,r,n,o,s){this.name=e,this.buffer=r,this.position=n,this.line=o,this.column=s}Mark.prototype.getSnippet=function(e,r){var n,o,s,l,h;if(!this.buffer)return null;for(e=e||4,r=r||75,n="",o=this.position;0<o&&`\0\r
\u2028\u2029`.indexOf(this.buffer.charAt(o-1))===-1;)if(--o,this.position-o>r/2-1){n=" ... ",o+=5;break}for(s="",l=this.position;l<this.buffer.length&&`\0\r
\u2028\u2029`.indexOf(this.buffer.charAt(l))===-1;)if((l+=1)-this.position>r/2-1){s=" ... ",l-=5;break}return h=this.buffer.slice(o,l),common.repeat(" ",e)+n+h+s+`
`+common.repeat(" ",e+this.position-o+n.length)+"^"},Mark.prototype.toString=function(e){var r,n="";return this.name&&(n+='in "'+this.name+'" '),n+="at line "+(this.line+1)+", column "+(this.column+1),e||(r=this.getSnippet())&&(n+=`:
`+r),n};var mark=Mark,TYPE_CONSTRUCTOR_OPTIONS=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"],YAML_NODE_KINDS=["scalar","sequence","mapping"];function compileStyleAliases(e){var r={};return e!==null&&Object.keys(e).forEach(function(n){e[n].forEach(function(o){r[String(o)]=n})}),r}function Type(e,r){if(r=r||{},Object.keys(r).forEach(function(n){if(TYPE_CONSTRUCTOR_OPTIONS.indexOf(n)===-1)throw new exception('Unknown option "'+n+'" is met in definition of "'+e+'" YAML type.')}),this.tag=e,this.kind=r.kind||null,this.resolve=r.resolve||function(){return!0},this.construct=r.construct||function(n){return n},this.instanceOf=r.instanceOf||null,this.predicate=r.predicate||null,this.represent=r.represent||null,this.defaultStyle=r.defaultStyle||null,this.styleAliases=compileStyleAliases(r.styleAliases||null),YAML_NODE_KINDS.indexOf(this.kind)===-1)throw new exception('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var type=Type;function compileList(e,r,n){var o=[];return e.include.forEach(function(s){n=compileList(s,r,n)}),e[r].forEach(function(s){n.forEach(function(l,h){l.tag===s.tag&&o.push(h)}),n.push(s)}),n.filter(function(s,l){return o.indexOf(l)===-1})}function compileMap(){var e,r,n={};function o(s){n[s.tag]=s}for(e=0,r=arguments.length;e<r;e+=1)arguments[e].forEach(o);return n}function Schema(e){this.include=e.include||[],this.implicit=e.implicit||[],this.explicit=e.explicit||[],this.implicit.forEach(function(r){if(r.loadKind&&r.loadKind!=="scalar")throw new exception("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")}),this.compiledImplicit=compileList(this,"implicit",[]),this.compiledExplicit=compileList(this,"explicit",[]),this.compiledTypeMap=compileMap(this.compiledImplicit,this.compiledExplicit)}Schema.DEFAULT=null,Schema.create=function(e,r){var n,o;switch(arguments.length){case 1:n=Schema.DEFAULT,o=e;break;case 2:n=e,o=r;break;default:throw new exception("Wrong number of arguments for Schema.create function")}if(n=common.toArray(n),o=common.toArray(o),!n.every(function(s){return s instanceof Schema}))throw new exception("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!o.every(function(s){return s instanceof type}))throw new exception("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new Schema({include:n,explicit:o})};var schema=Schema,str=new type("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),seq=new type("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),map=new type("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),failsafe=new schema({explicit:[str,seq,map]});function resolveYamlNull(e){if(e===null)return!0;var r=e.length;return r===1&&e==="~"||r===4&&(e==="null"||e==="Null"||e==="NULL")}function constructYamlNull(){return null}function isNull$1(e){return e===null}var _null=new type("tag:yaml.org,2002:null",{kind:"scalar",resolve:resolveYamlNull,construct:constructYamlNull,predicate:isNull$1,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"});function resolveYamlBoolean(e){if(e===null)return!1;var r=e.length;return r===4&&(e==="true"||e==="True"||e==="TRUE")||r===5&&(e==="false"||e==="False"||e==="FALSE")}function constructYamlBoolean(e){return e==="true"||e==="True"||e==="TRUE"}function isBoolean$1(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var bool=new type("tag:yaml.org,2002:bool",{kind:"scalar",resolve:resolveYamlBoolean,construct:constructYamlBoolean,predicate:isBoolean$1,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function isHexCode(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function isOctCode(e){return 48<=e&&e<=55}function isDecCode(e){return 48<=e&&e<=57}function resolveYamlInteger(e){if(e===null)return!1;var r,n=e.length,o=0,s=!1;if(!n)return!1;if((r=e[o])!=="-"&&r!=="+"||(r=e[++o]),r==="0"){if(o+1===n)return!0;if((r=e[++o])==="b"){for(o++;o<n;o++)if((r=e[o])!=="_"){if(r!=="0"&&r!=="1")return!1;s=!0}return s}if(r==="x"){for(o++;o<n;o++)if((r=e[o])!=="_"){if(!isHexCode(e.charCodeAt(o)))return!1;s=!0}return s}for(;o<n;o++)if((r=e[o])!=="_"){if(!isOctCode(e.charCodeAt(o)))return!1;s=!0}return s}for(;o<n;o++)if((r=e[o])!=="_"){if(r===":")break;if(!isDecCode(e.charCodeAt(o)))return!1;s=!0}return!!s&&(r!==":"||/^(:[0-5]?[0-9])+$/.test(e.slice(o)))}function constructYamlInteger(e){var r,n,o=e,s=1,l=[];return o.indexOf("_")!==-1&&(o=o.replace(/_/g,"")),(r=o[0])!=="-"&&r!=="+"||(r==="-"&&(s=-1),r=(o=o.slice(1))[0]),o==="0"?0:r==="0"?o[1]==="b"?s*parseInt(o.slice(2),2):o[1]==="x"?s*parseInt(o,16):s*parseInt(o,8):o.indexOf(":")!==-1?(o.split(":").forEach(function(h){l.unshift(parseInt(h,10))}),o=0,n=1,l.forEach(function(h){o+=h*n,n*=60}),s*o):s*parseInt(o,10)}function isInteger(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1==0&&!common.isNegativeZero(e)}var int_1=new type("tag:yaml.org,2002:int",{kind:"scalar",resolve:resolveYamlInteger,construct:constructYamlInteger,predicate:isInteger,represent:{binary:function(e){return"0b"+e.toString(2)},octal:function(e){return"0"+e.toString(8)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return"0x"+e.toString(16).toUpperCase()}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),YAML_FLOAT_PATTERN=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)\\.[0-9_]*(?:[eE][-+][0-9]+)?|\\.[0-9_]+(?:[eE][-+][0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function resolveYamlFloat(e){return e!==null&&!!YAML_FLOAT_PATTERN.test(e)}function constructYamlFloat(e){var r,n=e.replace(/_/g,"").toLowerCase(),o=n[0]==="-"?-1:1,s=[];return 0<="+-".indexOf(n[0])&&(n=n.slice(1)),n===".inf"?o==1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:n===".nan"?NaN:0<=n.indexOf(":")?(n.split(":").forEach(function(l){s.unshift(parseFloat(l,10))}),n=0,r=1,s.forEach(function(l){n+=l*r,r*=60}),o*n):o*parseFloat(n,10)}var SCIENTIFIC_WITHOUT_DOT=/^[-+]?[0-9]+e/;function representYamlFloat(e,r){var n;if(isNaN(e))switch(r){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(r){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(r){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(common.isNegativeZero(e))return"-0.0";return n=e.toString(10),SCIENTIFIC_WITHOUT_DOT.test(n)?n.replace("e",".e"):n}function isFloat(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!=0||common.isNegativeZero(e))}var float_1$1=new type("tag:yaml.org,2002:float",{kind:"scalar",resolve:resolveYamlFloat,construct:constructYamlFloat,predicate:isFloat,represent:representYamlFloat,defaultStyle:"lowercase"}),json=new schema({include:[failsafe],implicit:[_null,bool,int_1,float_1$1]}),core=new schema({include:[json]}),YAML_TIMESTAMP_REGEXP=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?)?$");function resolveYamlTimestamp(e){return e!==null&&YAML_TIMESTAMP_REGEXP.exec(e)!==null}function constructYamlTimestamp(e){var r,n,o,s,l,h,d,y=0,g=null,v=YAML_TIMESTAMP_REGEXP.exec(e);if(v===null)throw new Error("Date resolve error");if(r=+v[1],n=v[2]-1,o=+v[3],!v[4])return new Date(Date.UTC(r,n,o));if(s=+v[4],l=+v[5],h=+v[6],v[7]){for(y=v[7].slice(0,3);y.length<3;)y+="0";y=+y}return v[9]&&(g=6e4*(60*+v[10]+ +(v[11]||0)),v[9]==="-"&&(g=-g)),d=new Date(Date.UTC(r,n,o,s,l,h,y)),g&&d.setTime(d.getTime()-g),d}function representYamlTimestamp(e){return e.toISOString()}var timestamp=new type("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:resolveYamlTimestamp,construct:constructYamlTimestamp,instanceOf:Date,represent:representYamlTimestamp});function resolveYamlMerge(e){return e==="<<"||e===null}var merge=new type("tag:yaml.org,2002:merge",{kind:"scalar",resolve:resolveYamlMerge}),NodeBuffer=bufferEs6.Buffer,BASE64_MAP=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function resolveYamlBinary(e){if(e===null)return!1;for(var r,n=0,o=e.length,s=BASE64_MAP,l=0;l<o;l++)if(!(64<(r=s.indexOf(e.charAt(l))))){if(r<0)return!1;n+=6}return n%8==0}function constructYamlBinary(e){for(var r,n=e.replace(/[\r\n=]/g,""),o=n.length,s=BASE64_MAP,l=0,h=[],d=0;d<o;d++)d%4==0&&d&&(h.push(l>>16&255),h.push(l>>8&255),h.push(255&l)),l=l<<6|s.indexOf(n.charAt(d));return(r=o%4*6)==0?(h.push(l>>16&255),h.push(l>>8&255),h.push(255&l)):r==18?(h.push(l>>10&255),h.push(l>>2&255)):r==12&&h.push(l>>4&255),NodeBuffer?new NodeBuffer(h):h}function representYamlBinary(e){for(var r,n="",o=0,s=e.length,l=BASE64_MAP,h=0;h<s;h++)h%3==0&&h&&(n+=l[o>>18&63],n+=l[o>>12&63],n+=l[o>>6&63],n+=l[63&o]),o=(o<<8)+e[h];return(r=s%3)==0?(n+=l[o>>18&63],n+=l[o>>12&63],n+=l[o>>6&63],n+=l[63&o]):r==2?(n+=l[o>>10&63],n+=l[o>>4&63],n+=l[o<<2&63],n+=l[64]):r==1&&(n+=l[o>>2&63],n+=l[o<<4&63],n+=l[64],n+=l[64]),n}function isBinary(e){return NodeBuffer&&NodeBuffer.isBuffer(e)}var binary=new type("tag:yaml.org,2002:binary",{kind:"scalar",resolve:resolveYamlBinary,construct:constructYamlBinary,predicate:isBinary,represent:representYamlBinary}),_hasOwnProperty=Object.prototype.hasOwnProperty,_toString=Object.prototype.toString;function resolveYamlOmap(e){if(e===null)return!0;for(var r,n,o,s=[],l=e,h=0,d=l.length;h<d;h+=1){if(r=l[h],o=!1,_toString.call(r)!=="[object Object]")return!1;for(n in r)if(_hasOwnProperty.call(r,n)){if(o)return!1;o=!0}if(!o||s.indexOf(n)!==-1)return!1;s.push(n)}return!0}function constructYamlOmap(e){return e!==null?e:[]}var omap=new type("tag:yaml.org,2002:omap",{kind:"sequence",resolve:resolveYamlOmap,construct:constructYamlOmap}),_toString$1=Object.prototype.toString;function resolveYamlPairs(e){if(e===null)return!0;for(var r,n,o=e,s=new Array(o.length),l=0,h=o.length;l<h;l+=1){if(r=o[l],_toString$1.call(r)!=="[object Object]"||(n=Object.keys(r)).length!==1)return!1;s[l]=[n[0],r[n[0]]]}return!0}function constructYamlPairs(e){if(e===null)return[];for(var r,n,o=e,s=new Array(o.length),l=0,h=o.length;l<h;l+=1)r=o[l],n=Object.keys(r),s[l]=[n[0],r[n[0]]];return s}var pairs=new type("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:resolveYamlPairs,construct:constructYamlPairs}),_hasOwnProperty$1=Object.prototype.hasOwnProperty;function resolveYamlSet(e){if(e===null)return!0;var r,n=e;for(r in n)if(_hasOwnProperty$1.call(n,r)&&n[r]!==null)return!1;return!0}function constructYamlSet(e){return e!==null?e:{}}var set$2=new type("tag:yaml.org,2002:set",{kind:"mapping",resolve:resolveYamlSet,construct:constructYamlSet}),default_safe=new schema({include:[core],implicit:[timestamp,merge],explicit:[binary,omap,pairs,set$2]});function resolveJavascriptUndefined(){return!0}function constructJavascriptUndefined(){}function representJavascriptUndefined(){return""}function isUndefined$1(e){return e===void 0}var _undefined=new type("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:resolveJavascriptUndefined,construct:constructJavascriptUndefined,predicate:isUndefined$1,represent:representJavascriptUndefined});function resolveJavascriptRegExp(e){if(e===null||e.length===0)return!1;var r=e,n=/\/([gim]*)$/.exec(e),o="";return!(r[0]==="/"&&(n&&(o=n[1]),3<o.length||r[r.length-o.length-1]!=="/"))}function constructJavascriptRegExp(e){var r=e,n=/\/([gim]*)$/.exec(e),o="";return r[0]==="/"&&(n&&(o=n[1]),r=r.slice(1,r.length-o.length-1)),new RegExp(r,o)}function representJavascriptRegExp(e){var r="/"+e.source+"/";return e.global&&(r+="g"),e.multiline&&(r+="m"),e.ignoreCase&&(r+="i"),r}function isRegExp$1(e){return Object.prototype.toString.call(e)==="[object RegExp]"}var regexp=new type("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:resolveJavascriptRegExp,construct:constructJavascriptRegExp,predicate:isRegExp$1,represent:representJavascriptRegExp}),esprima;try{var _require=commonjsRequire,esprima=_require("esprima")}catch(e){typeof window<"u"&&(esprima=window.esprima)}function resolveJavascriptFunction(e){if(e===null)return!1;try{var r="("+e+")",n=esprima.parse(r,{range:!0});return!(n.type!=="Program"||n.body.length!==1||n.body[0].type!=="ExpressionStatement"||n.body[0].expression.type!=="FunctionExpression")}catch{return!1}}function constructJavascriptFunction(e){var r,n="("+e+")",o=esprima.parse(n,{range:!0}),s=[];if(o.type!=="Program"||o.body.length!==1||o.body[0].type!=="ExpressionStatement"||o.body[0].expression.type!=="FunctionExpression")throw new Error("Failed to resolve function");return o.body[0].expression.params.forEach(function(l){s.push(l.name)}),r=o.body[0].expression.body.range,new Function(s,n.slice(r[0]+1,r[1]-1))}function representJavascriptFunction(e){return e.toString()}function isFunction$1(e){return Object.prototype.toString.call(e)==="[object Function]"}var _function=new type("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:resolveJavascriptFunction,construct:constructJavascriptFunction,predicate:isFunction$1,represent:representJavascriptFunction}),default_full=schema.DEFAULT=new schema({include:[default_safe],explicit:[_undefined,regexp,_function]}),_hasOwnProperty$2=Object.prototype.hasOwnProperty,CONTEXT_FLOW_IN=1,CONTEXT_FLOW_OUT=2,CONTEXT_BLOCK_IN=3,CONTEXT_BLOCK_OUT=4,CHOMPING_CLIP=1,CHOMPING_STRIP=2,CHOMPING_KEEP=3,PATTERN_NON_PRINTABLE=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,PATTERN_NON_ASCII_LINE_BREAKS=/[\x85\u2028\u2029]/,PATTERN_FLOW_INDICATORS=/[,\[\]\{\}]/,PATTERN_TAG_HANDLE=/^(?:!|!!|![a-z\-]+!)$/i,PATTERN_TAG_URI=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function is_EOL(e){return e===10||e===13}function is_WHITE_SPACE(e){return e===9||e===32}function is_WS_OR_EOL(e){return e===9||e===32||e===10||e===13}function is_FLOW_INDICATOR(e){return e===44||e===91||e===93||e===123||e===125}function fromHexCode(e){var r;return 48<=e&&e<=57?e-48:97<=(r=32|e)&&r<=102?r-97+10:-1}function escapedHexLen(e){return e===120?2:e===117?4:e===85?8:0}function fromDecimalCode(e){return 48<=e&&e<=57?e-48:-1}function simpleEscapeSequence(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"":e===95?" ":e===76?"\u2028":e===80?"\u2029":""}function charFromCodepoint(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10),56320+(e-65536&1023))}for(var simpleEscapeCheck=new Array(256),simpleEscapeMap=new Array(256),i=0;i<256;i++)simpleEscapeCheck[i]=simpleEscapeSequence(i)?1:0,simpleEscapeMap[i]=simpleEscapeSequence(i);function State$1(e,r){this.input=e,this.filename=r.filename||null,this.schema=r.schema||default_full,this.onWarning=r.onWarning||null,this.legacy=r.legacy||!1,this.json=r.json||!1,this.listener=r.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.documents=[]}function generateError(e,r){return new exception(r,new mark(e.filename,e.input,e.position,e.line,e.position-e.lineStart))}function throwError(e,r){throw generateError(e,r)}function throwWarning(e,r){e.onWarning&&e.onWarning.call(null,generateError(e,r))}var directiveHandlers={YAML:function(e,r,n){var o,s,l;e.version!==null&&throwError(e,"duplication of %YAML directive"),n.length!==1&&throwError(e,"YAML directive accepts exactly one argument"),(o=/^([0-9]+)\.([0-9]+)$/.exec(n[0]))===null&&throwError(e,"ill-formed argument of the YAML directive"),s=parseInt(o[1],10),l=parseInt(o[2],10),s!==1&&throwError(e,"unacceptable YAML version of the document"),e.version=n[0],e.checkLineBreaks=l<2,l!==1&&l!==2&&throwWarning(e,"unsupported YAML version of the document")},TAG:function(e,r,n){var o,s;n.length!==2&&throwError(e,"TAG directive accepts exactly two arguments"),o=n[0],s=n[1],PATTERN_TAG_HANDLE.test(o)||throwError(e,"ill-formed tag handle (first argument) of the TAG directive"),_hasOwnProperty$2.call(e.tagMap,o)&&throwError(e,'there is a previously declared suffix for "'+o+'" tag handle'),PATTERN_TAG_URI.test(s)||throwError(e,"ill-formed tag prefix (second argument) of the TAG directive"),e.tagMap[o]=s}};function captureSegment(e,r,n,o){var s,l,h,d;if(r<n){if(d=e.input.slice(r,n),o)for(s=0,l=d.length;s<l;s+=1)(h=d.charCodeAt(s))===9||32<=h&&h<=1114111||throwError(e,"expected valid JSON character");else PATTERN_NON_PRINTABLE.test(d)&&throwError(e,"the stream contains non-printable characters");e.result+=d}}function mergeMappings(e,r,n,o){var s,l,h,d;for(common.isObject(n)||throwError(e,"cannot merge mappings; the provided source object is unacceptable"),h=0,d=(s=Object.keys(n)).length;h<d;h+=1)l=s[h],_hasOwnProperty$2.call(r,l)||(r[l]=n[l],o[l]=!0)}function storeMappingPair(e,r,n,o,s,l){var h,d;if(s=String(s),r===null&&(r={}),o==="tag:yaml.org,2002:merge")if(Array.isArray(l))for(h=0,d=l.length;h<d;h+=1)mergeMappings(e,r,l[h],n);else mergeMappings(e,r,l,n);else e.json||_hasOwnProperty$2.call(n,s)||!_hasOwnProperty$2.call(r,s)||throwError(e,"duplicated mapping key"),r[s]=l,delete n[s];return r}function readLineBreak(e){var r=e.input.charCodeAt(e.position);r===10?e.position++:r===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):throwError(e,"a line break is expected"),e.line+=1,e.lineStart=e.position}function skipSeparationSpace(e,r,n){for(var o=0,s=e.input.charCodeAt(e.position);s!==0;){for(;is_WHITE_SPACE(s);)s=e.input.charCodeAt(++e.position);if(r&&s===35)for(;(s=e.input.charCodeAt(++e.position))!==10&&s!==13&&s!==0;);if(!is_EOL(s))break;for(readLineBreak(e),s=e.input.charCodeAt(e.position),o++,e.lineIndent=0;s===32;)e.lineIndent++,s=e.input.charCodeAt(++e.position)}return n!==-1&&o!==0&&e.lineIndent<n&&throwWarning(e,"deficient indentation"),o}function testDocumentSeparator(e){var r=e.position,n=e.input.charCodeAt(r);return n!==45&&n!==46||n!==e.input.charCodeAt(r+1)||n!==e.input.charCodeAt(r+2)||(r+=3,(n=e.input.charCodeAt(r))!==0&&!is_WS_OR_EOL(n))?void 0:1}function writeFoldedLines(e,r){r===1?e.result+=" ":1<r&&(e.result+=common.repeat(`
`,r-1))}function readPlainScalar(e,r,n){var o,s,l,h,d,y,g,v=e.kind,m=e.result,w=e.input.charCodeAt(e.position);if(!is_WS_OR_EOL(w)&&!is_FLOW_INDICATOR(w)&&w!==35&&w!==38&&w!==42&&w!==33&&w!==124&&w!==62&&w!==39&&w!==34&&w!==37&&w!==64&&w!==96&&(w!==63&&w!==45||!(is_WS_OR_EOL(o=e.input.charCodeAt(e.position+1))||n&&is_FLOW_INDICATOR(o)))){for(e.kind="scalar",e.result="",s=l=e.position,h=!1;w!==0;){if(w===58){if(is_WS_OR_EOL(o=e.input.charCodeAt(e.position+1))||n&&is_FLOW_INDICATOR(o))break}else if(w===35){if(is_WS_OR_EOL(e.input.charCodeAt(e.position-1)))break}else{if(e.position===e.lineStart&&testDocumentSeparator(e)||n&&is_FLOW_INDICATOR(w))break;if(is_EOL(w)){if(d=e.line,y=e.lineStart,g=e.lineIndent,skipSeparationSpace(e,!1,-1),e.lineIndent>=r){h=!0,w=e.input.charCodeAt(e.position);continue}e.position=l,e.line=d,e.lineStart=y,e.lineIndent=g;break}}h&&(captureSegment(e,s,l,!1),writeFoldedLines(e,e.line-d),s=l=e.position,h=!1),is_WHITE_SPACE(w)||(l=e.position+1),w=e.input.charCodeAt(++e.position)}if(captureSegment(e,s,l,!1),e.result)return 1;e.kind=v,e.result=m}}function readSingleQuotedScalar(e,r){var n,o,s=e.input.charCodeAt(e.position);if(s===39){for(e.kind="scalar",e.result="",e.position++,n=o=e.position;(s=e.input.charCodeAt(e.position))!==0;)if(s===39){if(captureSegment(e,n,e.position,!0),(s=e.input.charCodeAt(++e.position))!==39)return 1;n=o=e.position,e.position++}else is_EOL(s)?(captureSegment(e,n,o,!0),writeFoldedLines(e,skipSeparationSpace(e,!1,r)),n=o=e.position):e.position===e.lineStart&&testDocumentSeparator(e)?throwError(e,"unexpected end of the document within a single quoted scalar"):(e.position++,o=e.position);throwError(e,"unexpected end of the stream within a single quoted scalar")}}function readDoubleQuotedScalar(e,r){var n,o,s,l,h,d=e.input.charCodeAt(e.position);if(d===34){for(e.kind="scalar",e.result="",e.position++,n=o=e.position;(d=e.input.charCodeAt(e.position))!==0;){if(d===34)return captureSegment(e,n,e.position,!0),e.position++,1;if(d===92){if(captureSegment(e,n,e.position,!0),is_EOL(d=e.input.charCodeAt(++e.position)))skipSeparationSpace(e,!1,r);else if(d<256&&simpleEscapeCheck[d])e.result+=simpleEscapeMap[d],e.position++;else if(0<(h=escapedHexLen(d))){for(s=h,l=0;0<s;s--)0<=(h=fromHexCode(d=e.input.charCodeAt(++e.position)))?l=(l<<4)+h:throwError(e,"expected hexadecimal character");e.result+=charFromCodepoint(l),e.position++}else throwError(e,"unknown escape sequence");n=o=e.position}else is_EOL(d)?(captureSegment(e,n,o,!0),writeFoldedLines(e,skipSeparationSpace(e,!1,r)),n=o=e.position):e.position===e.lineStart&&testDocumentSeparator(e)?throwError(e,"unexpected end of the document within a double quoted scalar"):(e.position++,o=e.position)}throwError(e,"unexpected end of the stream within a double quoted scalar")}}function readFlowCollection(e,r){var n,o,s,l,h,d,y,g,v,m=!0,w=e.tag,I=e.anchor,V={},q=e.input.charCodeAt(e.position);if(q===91)d=!(s=93),o=[];else{if(q!==123)return;s=125,d=!0,o={}}for(e.anchor!==null&&(e.anchorMap[e.anchor]=o),q=e.input.charCodeAt(++e.position);q!==0;){if(skipSeparationSpace(e,!0,r),(q=e.input.charCodeAt(e.position))===s)return e.position++,e.tag=w,e.anchor=I,e.kind=d?"mapping":"sequence",e.result=o,1;m||throwError(e,"missed comma between flow collection entries"),v=null,l=h=!1,q===63&&is_WS_OR_EOL(e.input.charCodeAt(e.position+1))&&(l=h=!0,e.position++,skipSeparationSpace(e,!0,r)),n=e.line,composeNode(e,r,CONTEXT_FLOW_IN,!1,!0),g=e.tag,y=e.result,skipSeparationSpace(e,!0,r),q=e.input.charCodeAt(e.position),!h&&e.line!==n||q!==58||(l=!0,q=e.input.charCodeAt(++e.position),skipSeparationSpace(e,!0,r),composeNode(e,r,CONTEXT_FLOW_IN,!1,!0),v=e.result),d?storeMappingPair(e,o,V,g,y,v):l?o.push(storeMappingPair(e,null,V,g,y,v)):o.push(y),skipSeparationSpace(e,!0,r),(q=e.input.charCodeAt(e.position))===44?(m=!0,q=e.input.charCodeAt(++e.position)):m=!1}throwError(e,"unexpected end of the stream within a flow collection")}function readBlockScalar(e,r){var n,o,s,l=CHOMPING_CLIP,h=!1,d=r,y=0,g=!1,v=e.input.charCodeAt(e.position);if(v===124)o=!1;else{if(v!==62)return;o=!0}for(e.kind="scalar",e.result="";v!==0;)if((v=e.input.charCodeAt(++e.position))===43||v===45)CHOMPING_CLIP===l?l=v===43?CHOMPING_KEEP:CHOMPING_STRIP:throwError(e,"repeat of a chomping mode identifier");else{if(!(0<=(s=fromDecimalCode(v))))break;s===0?throwError(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):h?throwError(e,"repeat of an indentation width identifier"):(d=r+s-1,h=!0)}if(is_WHITE_SPACE(v)){for(;is_WHITE_SPACE(v=e.input.charCodeAt(++e.position)););if(v===35)for(;!is_EOL(v=e.input.charCodeAt(++e.position))&&v!==0;);}for(;v!==0;){for(readLineBreak(e),e.lineIndent=0,v=e.input.charCodeAt(e.position);(!h||e.lineIndent<d)&&v===32;)e.lineIndent++,v=e.input.charCodeAt(++e.position);if(!h&&e.lineIndent>d&&(d=e.lineIndent),is_EOL(v))y++;else{if(e.lineIndent<d){l===CHOMPING_KEEP?e.result+=common.repeat(`
`,y):l===CHOMPING_CLIP&&h&&(e.result+=`
`);break}for(o?is_WHITE_SPACE(v)?(g=!0,e.result+=common.repeat(`
`,y+1)):g?(g=!1,e.result+=common.repeat(`
`,y+1)):y===0?h&&(e.result+=" "):e.result+=common.repeat(`
`,y):e.result+=h?common.repeat(`
`,y+1):common.repeat(`
`,y),h=!0,y=0,n=e.position;!is_EOL(v)&&v!==0;)v=e.input.charCodeAt(++e.position);captureSegment(e,n,e.position,!1)}}return 1}function readBlockSequence(e,r){var n,o,s=e.tag,l=e.anchor,h=[],d=!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=h),o=e.input.charCodeAt(e.position);o!==0&&o===45&&is_WS_OR_EOL(e.input.charCodeAt(e.position+1));)if(d=!0,e.position++,skipSeparationSpace(e,!0,-1)&&e.lineIndent<=r)h.push(null),o=e.input.charCodeAt(e.position);else if(n=e.line,composeNode(e,r,CONTEXT_BLOCK_IN,!1,!0),h.push(e.result),skipSeparationSpace(e,!0,-1),o=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>r)&&o!==0)throwError(e,"bad indentation of a sequence entry");else if(e.lineIndent<r)break;return!!d&&(e.tag=s,e.anchor=l,e.kind="sequence",e.result=h,!0)}function readBlockMapping(e,r,n){var o,s,l,h,d=e.tag,y=e.anchor,g={},v={},m=null,w=null,I=null,V=!1,q=!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=g),h=e.input.charCodeAt(e.position);h!==0;){if(o=e.input.charCodeAt(e.position+1),l=e.line,h!==63&&h!==58||!is_WS_OR_EOL(o)){if(!composeNode(e,n,CONTEXT_FLOW_OUT,!1,!0))break;if(e.line===l){for(h=e.input.charCodeAt(e.position);is_WHITE_SPACE(h);)h=e.input.charCodeAt(++e.position);if(h===58)is_WS_OR_EOL(h=e.input.charCodeAt(++e.position))||throwError(e,"a whitespace character is expected after the key-value separator within a block mapping"),V&&(storeMappingPair(e,g,v,m,w,null),m=w=I=null),s=V=!(q=!0),m=e.tag,w=e.result;else{if(!q)return e.tag=d,e.anchor=y,1;throwError(e,"can not read an implicit mapping pair; a colon is missed")}}else{if(!q)return e.tag=d,e.anchor=y,1;throwError(e,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else h===63?(V&&(storeMappingPair(e,g,v,m,w,null),m=w=I=null),s=V=q=!0):V?s=!(V=!1):throwError(e,"incomplete explicit mapping pair; a key node is missed"),e.position+=1,h=o;if((e.line===l||e.lineIndent>r)&&(composeNode(e,r,CONTEXT_BLOCK_OUT,!0,s)&&(V?w=e.result:I=e.result),V||(storeMappingPair(e,g,v,m,w,I),m=w=I=null),skipSeparationSpace(e,!0,-1),h=e.input.charCodeAt(e.position)),e.lineIndent>r&&h!==0)throwError(e,"bad indentation of a mapping entry");else if(e.lineIndent<r)break}return V&&storeMappingPair(e,g,v,m,w,null),q&&(e.tag=d,e.anchor=y,e.kind="mapping",e.result=g),q}function readTagProperty(e){var r,n,o,s=!1,l=!1,h=e.input.charCodeAt(e.position);if(h===33){if(e.tag!==null&&throwError(e,"duplication of a tag property"),(h=e.input.charCodeAt(++e.position))===60?(s=!0,h=e.input.charCodeAt(++e.position)):h===33?(l=!0,n="!!",h=e.input.charCodeAt(++e.position)):n="!",r=e.position,s){for(;(h=e.input.charCodeAt(++e.position))!==0&&h!==62;);e.position<e.length?(o=e.input.slice(r,e.position),h=e.input.charCodeAt(++e.position)):throwError(e,"unexpected end of the stream within a verbatim tag")}else{for(;h!==0&&!is_WS_OR_EOL(h);)h===33&&(l?throwError(e,"tag suffix cannot contain exclamation marks"):(n=e.input.slice(r-1,e.position+1),PATTERN_TAG_HANDLE.test(n)||throwError(e,"named tag handle cannot contain such characters"),l=!0,r=e.position+1)),h=e.input.charCodeAt(++e.position);o=e.input.slice(r,e.position),PATTERN_FLOW_INDICATORS.test(o)&&throwError(e,"tag suffix cannot contain flow indicator characters")}return o&&!PATTERN_TAG_URI.test(o)&&throwError(e,"tag name cannot contain such characters: "+o),s?e.tag=o:_hasOwnProperty$2.call(e.tagMap,n)?e.tag=e.tagMap[n]+o:n==="!"?e.tag="!"+o:n==="!!"?e.tag="tag:yaml.org,2002:"+o:throwError(e,'undeclared tag handle "'+n+'"'),1}}function readAnchorProperty(e){var r,n=e.input.charCodeAt(e.position);if(n===38){for(e.anchor!==null&&throwError(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),r=e.position;n!==0&&!is_WS_OR_EOL(n)&&!is_FLOW_INDICATOR(n);)n=e.input.charCodeAt(++e.position);return e.position===r&&throwError(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(r,e.position),1}}function readAlias(e){var r,n,o=e.input.charCodeAt(e.position);if(o===42){for(o=e.input.charCodeAt(++e.position),r=e.position;o!==0&&!is_WS_OR_EOL(o)&&!is_FLOW_INDICATOR(o);)o=e.input.charCodeAt(++e.position);return e.position===r&&throwError(e,"name of an alias node must contain at least one character"),n=e.input.slice(r,e.position),e.anchorMap.hasOwnProperty(n)||throwError(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],skipSeparationSpace(e,!0,-1),1}}function composeNode(e,r,n,o,s){var l,h,d,y,g,v,m,w,I=1,V=!1,q=!1;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,l=h=d=CONTEXT_BLOCK_OUT===n||CONTEXT_BLOCK_IN===n,o&&skipSeparationSpace(e,!0,-1)&&(V=!0,e.lineIndent>r?I=1:e.lineIndent===r?I=0:e.lineIndent<r&&(I=-1)),I===1)for(;readTagProperty(e)||readAnchorProperty(e);)skipSeparationSpace(e,!0,-1)?(V=!0,d=l,e.lineIndent>r?I=1:e.lineIndent===r?I=0:e.lineIndent<r&&(I=-1)):d=!1;if(d=d&&(V||s),I!==1&&CONTEXT_BLOCK_OUT!==n||(m=CONTEXT_FLOW_IN===n||CONTEXT_FLOW_OUT===n?r:r+1,w=e.position-e.lineStart,I===1?d&&(readBlockSequence(e,w)||readBlockMapping(e,w,m))||readFlowCollection(e,m)?q=!0:(h&&readBlockScalar(e,m)||readSingleQuotedScalar(e,m)||readDoubleQuotedScalar(e,m)?q=!0:readAlias(e)?(q=!0,e.tag===null&&e.anchor===null||throwError(e,"alias node should not have any properties")):readPlainScalar(e,m,CONTEXT_FLOW_IN===n)&&(q=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):I===0&&(q=d&&readBlockSequence(e,w))),e.tag!==null&&e.tag!=="!")if(e.tag==="?"){for(y=0,g=e.implicitTypes.length;y<g;y+=1)if((v=e.implicitTypes[y]).resolve(e.result)){e.result=v.construct(e.result),e.tag=v.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else _hasOwnProperty$2.call(e.typeMap,e.tag)?(v=e.typeMap[e.tag],e.result!==null&&v.kind!==e.kind&&throwError(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+v.kind+'", not "'+e.kind+'"'),v.resolve(e.result)?(e.result=v.construct(e.result),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):throwError(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")):throwError(e,"unknown tag !<"+e.tag+">");return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||q}function readDocument(e){var r,n,o,s,l=e.position,h=!1;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap={},e.anchorMap={};(s=e.input.charCodeAt(e.position))!==0&&(skipSeparationSpace(e,!0,-1),s=e.input.charCodeAt(e.position),!(0<e.lineIndent||s!==37));){for(h=!0,s=e.input.charCodeAt(++e.position),r=e.position;s!==0&&!is_WS_OR_EOL(s);)s=e.input.charCodeAt(++e.position);for(o=[],(n=e.input.slice(r,e.position)).length<1&&throwError(e,"directive name must not be less than one character in length");s!==0;){for(;is_WHITE_SPACE(s);)s=e.input.charCodeAt(++e.position);if(s===35){for(;(s=e.input.charCodeAt(++e.position))!==0&&!is_EOL(s););break}if(is_EOL(s))break;for(r=e.position;s!==0&&!is_WS_OR_EOL(s);)s=e.input.charCodeAt(++e.position);o.push(e.input.slice(r,e.position))}s!==0&&readLineBreak(e),_hasOwnProperty$2.call(directiveHandlers,n)?directiveHandlers[n](e,n,o):throwWarning(e,'unknown document directive "'+n+'"')}skipSeparationSpace(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,skipSeparationSpace(e,!0,-1)):h&&throwError(e,"directives end mark is expected"),composeNode(e,e.lineIndent-1,CONTEXT_BLOCK_OUT,!1,!0),skipSeparationSpace(e,!0,-1),e.checkLineBreaks&&PATTERN_NON_ASCII_LINE_BREAKS.test(e.input.slice(l,e.position))&&throwWarning(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&testDocumentSeparator(e)?e.input.charCodeAt(e.position)===46&&(e.position+=3,skipSeparationSpace(e,!0,-1)):e.position<e.length-1&&throwError(e,"end of the stream or a document separator is expected")}function loadDocuments(e,r){r=r||{},(e=String(e)).length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var n=new State$1(e,r);for(n.input+="\0";n.input.charCodeAt(n.position)===32;)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)readDocument(n);return n.documents}function loadAll(e,r,n){for(var o=loadDocuments(e,n),s=0,l=o.length;s<l;s+=1)r(o[s])}function load(e,r){var n=loadDocuments(e,r);if(n.length!==0){if(n.length===1)return n[0];throw new exception("expected a single document in the stream, but found more")}}function safeLoadAll(e,r,n){loadAll(e,r,common.extend({schema:default_safe},n))}function safeLoad(e,r){return load(e,common.extend({schema:default_safe},r))}var loadAll_1=loadAll,load_1=load,safeLoadAll_1=safeLoadAll,safeLoad_1=safeLoad,loader={loadAll:loadAll_1,load:load_1,safeLoadAll:safeLoadAll_1,safeLoad:safeLoad_1},_toString$2=Object.prototype.toString,_hasOwnProperty$3=Object.prototype.hasOwnProperty,CHAR_TAB=9,CHAR_LINE_FEED=10,CHAR_CARRIAGE_RETURN=13,CHAR_SPACE=32,CHAR_EXCLAMATION=33,CHAR_DOUBLE_QUOTE=34,CHAR_SHARP=35,CHAR_PERCENT=37,CHAR_AMPERSAND=38,CHAR_SINGLE_QUOTE=39,CHAR_ASTERISK=42,CHAR_COMMA=44,CHAR_MINUS=45,CHAR_COLON=58,CHAR_GREATER_THAN=62,CHAR_QUESTION=63,CHAR_COMMERCIAL_AT=64,CHAR_LEFT_SQUARE_BRACKET=91,CHAR_RIGHT_SQUARE_BRACKET=93,CHAR_GRAVE_ACCENT=96,CHAR_LEFT_CURLY_BRACKET=123,CHAR_VERTICAL_LINE=124,CHAR_RIGHT_CURLY_BRACKET=125,ESCAPE_SEQUENCES={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},DEPRECATED_BOOLEANS_SYNTAX=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"];function compileStyleMap(e,r){var n,o,s,l,h,d,y;if(r===null)return{};for(n={},s=0,l=(o=Object.keys(r)).length;s<l;s+=1)h=o[s],d=String(r[h]),h.slice(0,2)==="!!"&&(h="tag:yaml.org,2002:"+h.slice(2)),(y=e.compiledTypeMap[h])&&_hasOwnProperty$3.call(y.styleAliases,d)&&(d=y.styleAliases[d]),n[h]=d;return n}function encodeHex(e){var r,n,o=e.toString(16).toUpperCase();if(e<=255)r="x",n=2;else if(e<=65535)r="u",n=4;else{if(!(e<=4294967295))throw new exception("code point within a string may not be greater than 0xFFFFFFFF");r="U",n=8}return"\\"+r+common.repeat("0",n-o.length)+o}function State$2(e){this.schema=e.schema||default_full,this.indent=Math.max(1,e.indent||2),this.skipInvalid=e.skipInvalid||!1,this.flowLevel=common.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=compileStyleMap(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function indentString(e,r){for(var n,o=common.repeat(" ",r),s=0,l=-1,h="",d=e.length;s<d;)s=(l=e.indexOf(`
`,s))===-1?(n=e.slice(s),d):(n=e.slice(s,l+1),l+1),n.length&&n!==`
`&&(h+=o),h+=n;return h}function generateNextLine(e,r){return`
`+common.repeat(" ",e.indent*r)}function testImplicitResolving(e,r){for(var n=0,o=e.implicitTypes.length;n<o;n+=1)if(e.implicitTypes[n].resolve(r))return 1}function StringBuilder(e){this.source=e,this.result="",this.checkpoint=0}function writeScalar(e,r,n,o){var s,l,h,d,y,g,v,m,w,I,V,q,De,_n,ha,ga,_o,_l,wc,_h;if(r.length!==0)if(DEPRECATED_BOOLEANS_SYNTAX.indexOf(r)===-1){for(s=!0,l=r.length?r.charCodeAt(0):0,h=CHAR_SPACE===l||CHAR_SPACE===r.charCodeAt(r.length-1),CHAR_MINUS!==l&&CHAR_QUESTION!==l&&CHAR_COMMERCIAL_AT!==l&&CHAR_GRAVE_ACCENT!==l||(s=!1),y=d=h||-1<e.flowLevel&&e.flowLevel<=n?(h&&(s=!1),!1):!o,g=!0,v=new StringBuilder(r),m=!1,I=w=0,V=e.indent*n,(q=e.lineWidth)===-1&&(q=9007199254740991),V<40?q-=V:q=40,_n=0;_n<r.length;_n++){if(De=r.charCodeAt(_n),s){if(simpleChar(De))continue;s=!1}g&&De===CHAR_SINGLE_QUOTE&&(g=!1),ha=ESCAPE_SEQUENCES[De],ga=needsHexEscape(De),(ha||ga)&&(De!==CHAR_LINE_FEED&&De!==CHAR_DOUBLE_QUOTE&&De!==CHAR_SINGLE_QUOTE?y=d=!1:De===CHAR_LINE_FEED&&(g=!(m=!0),0<_n&&r.charCodeAt(_n-1)===CHAR_SPACE&&(d=y=!1),d&&(_o=_n-w,w=_n,I<_o&&(I=_o))),De!==CHAR_DOUBLE_QUOTE&&(g=!1),v.takeUpTo(_n),v.escapeChar())}if(s&&testImplicitResolving(e,r)&&(s=!1),_l="",(d||y)&&(wc=0,r.charCodeAt(r.length-1)===CHAR_LINE_FEED&&(wc+=1,r.charCodeAt(r.length-2)===CHAR_LINE_FEED&&(wc+=1)),wc===0?_l="-":wc===2&&(_l="+")),(y&&I<q||e.tag!==null)&&(d=!1),m||(y=!1),s)e.dump=r;else if(g)e.dump="'"+r+"'";else if(d)_h=fold(r,q),e.dump=">"+_l+`
`+indentString(_h,V);else if(y)_l||(r=r.replace(/\n$/,"")),e.dump="|"+_l+`
`+indentString(r,V);else{if(!v)throw new Error("Failed to dump scalar value");v.finish(),e.dump='"'+v.result+'"'}}else e.dump="'"+r+"'";else e.dump="''"}function fold(e,r){var n,o="",s=0,l=e.length,h=/\n+$/.exec(e);for(h&&(l=h.index+1);s<l;)s=l<(n=e.indexOf(`
`,s))||n===-1?(o&&(o+=`

`),o+=foldLine(e.slice(s,l),r),l):(o&&(o+=`

`),o+=foldLine(e.slice(s,n),r),n+1);return h&&h[0]!==`
`&&(o+=h[0]),o}function foldLine(e,r){if(e==="")return e;for(var n,o,s=/[^\s] [^\s]/g,l="",h=0,d=0,y=s.exec(e);y;)r<(n=y.index)-d&&(o=h!==d?h:n,l&&(l+=`
`),l+=e.slice(d,o),d=o+1),h=n+1,y=s.exec(e);return l&&(l+=`
`),d!==h&&e.length-d>r?l+=e.slice(d,h)+`
`+e.slice(h+1):l+=e.slice(d),l}function simpleChar(e){return CHAR_TAB!==e&&CHAR_LINE_FEED!==e&&CHAR_CARRIAGE_RETURN!==e&&CHAR_COMMA!==e&&CHAR_LEFT_SQUARE_BRACKET!==e&&CHAR_RIGHT_SQUARE_BRACKET!==e&&CHAR_LEFT_CURLY_BRACKET!==e&&CHAR_RIGHT_CURLY_BRACKET!==e&&CHAR_SHARP!==e&&CHAR_AMPERSAND!==e&&CHAR_ASTERISK!==e&&CHAR_EXCLAMATION!==e&&CHAR_VERTICAL_LINE!==e&&CHAR_GREATER_THAN!==e&&CHAR_SINGLE_QUOTE!==e&&CHAR_DOUBLE_QUOTE!==e&&CHAR_PERCENT!==e&&CHAR_COLON!==e&&!ESCAPE_SEQUENCES[e]&&!needsHexEscape(e)}function needsHexEscape(e){return!(32<=e&&e<=126||e===133||160<=e&&e<=55295||57344<=e&&e<=65533||65536<=e&&e<=1114111)}function writeFlowSequence(e,r,n){for(var o="",s=e.tag,l=0,h=n.length;l<h;l+=1)writeNode(e,r,n[l],!1,!1)&&(l!==0&&(o+=", "),o+=e.dump);e.tag=s,e.dump="["+o+"]"}function writeBlockSequence(e,r,n,o){for(var s="",l=e.tag,h=0,d=n.length;h<d;h+=1)writeNode(e,r+1,n[h],!0,!0)&&(o&&h===0||(s+=generateNextLine(e,r)),s+="- "+e.dump);e.tag=l,e.dump=s||"[]"}function writeFlowMapping(e,r,n){for(var o,s,l,h="",d=e.tag,y=Object.keys(n),g=0,v=y.length;g<v;g+=1)l="",g!==0&&(l+=", "),s=n[o=y[g]],writeNode(e,r,o,!1,!1)&&(1024<e.dump.length&&(l+="? "),l+=e.dump+": ",writeNode(e,r,s,!1,!1)&&(h+=l+=e.dump));e.tag=d,e.dump="{"+h+"}"}function writeBlockMapping(e,r,n,o){var s,l,h,d,y,g,v="",m=e.tag,w=Object.keys(n);if(e.sortKeys===!0)w.sort();else if(typeof e.sortKeys=="function")w.sort(e.sortKeys);else if(e.sortKeys)throw new exception("sortKeys must be a boolean or a function");for(s=0,l=w.length;s<l;s+=1)g="",o&&s===0||(g+=generateNextLine(e,r)),d=n[h=w[s]],writeNode(e,r+1,h,!0,!0,!0)&&((y=e.tag!==null&&e.tag!=="?"||e.dump&&1024<e.dump.length)&&(e.dump&&CHAR_LINE_FEED===e.dump.charCodeAt(0)?g+="?":g+="? "),g+=e.dump,y&&(g+=generateNextLine(e,r)),writeNode(e,r+1,d,!0,y)&&(e.dump&&CHAR_LINE_FEED===e.dump.charCodeAt(0)?g+=":":g+=": ",v+=g+=e.dump));e.tag=m,e.dump=v||"{}"}function detectType(e,r,n){for(var o,s,l,h=n?e.explicitTypes:e.implicitTypes,d=0,y=h.length;d<y;d+=1)if(((s=h[d]).instanceOf||s.predicate)&&(!s.instanceOf||typeof r=="object"&&r instanceof s.instanceOf)&&(!s.predicate||s.predicate(r))){if(e.tag=n?s.tag:"?",s.represent){if(l=e.styleMap[s.tag]||s.defaultStyle,_toString$2.call(s.represent)==="[object Function]")o=s.represent(r,l);else{if(!_hasOwnProperty$3.call(s.represent,l))throw new exception("!<"+s.tag+'> tag resolver accepts not "'+l+'" style');o=s.represent[l](r,l)}e.dump=o}return 1}}function writeNode(e,r,n,o,s,l){e.tag=null,e.dump=n,detectType(e,n,!1)||detectType(e,n,!0);var h=_toString$2.call(e.dump);o=o&&(e.flowLevel<0||e.flowLevel>r);var d,y,g=h==="[object Object]"||h==="[object Array]";if(g&&(y=(d=e.duplicates.indexOf(n))!==-1),(e.tag!==null&&e.tag!=="?"||y||e.indent!==2&&0<r)&&(s=!1),y&&e.usedDuplicates[d])e.dump="*ref_"+d;else{if(g&&y&&!e.usedDuplicates[d]&&(e.usedDuplicates[d]=!0),h==="[object Object]")o&&Object.keys(e.dump).length!==0?(writeBlockMapping(e,r,e.dump,s),y&&(e.dump="&ref_"+d+e.dump)):(writeFlowMapping(e,r,e.dump),y&&(e.dump="&ref_"+d+" "+e.dump));else if(h==="[object Array]")o&&e.dump.length!==0?(writeBlockSequence(e,r,e.dump,s),y&&(e.dump="&ref_"+d+e.dump)):(writeFlowSequence(e,r,e.dump),y&&(e.dump="&ref_"+d+" "+e.dump));else{if(h!=="[object String]"){if(e.skipInvalid)return;throw new exception("unacceptable kind of an object to dump "+h)}e.tag!=="?"&&writeScalar(e,e.dump,r,l)}e.tag!==null&&e.tag!=="?"&&(e.dump="!<"+e.tag+"> "+e.dump)}return 1}function getDuplicateReferences(e,r){var n,o,s=[],l=[];for(inspectNode(e,s,l),n=0,o=l.length;n<o;n+=1)r.duplicates.push(s[l[n]]);r.usedDuplicates=new Array(o)}function inspectNode(e,r,n){var o,s,l;if(e!==null&&typeof e=="object")if((s=r.indexOf(e))!==-1)n.indexOf(s)===-1&&n.push(s);else if(r.push(e),Array.isArray(e))for(s=0,l=e.length;s<l;s+=1)inspectNode(e[s],r,n);else for(s=0,l=(o=Object.keys(e)).length;s<l;s+=1)inspectNode(e[o[s]],r,n)}function dump(e,r){var n=new State$2(r=r||{});return n.noRefs||getDuplicateReferences(e,n),writeNode(n,0,e,!0,!0)?n.dump+`
`:""}function safeDump(e,r){return dump(e,common.extend({schema:default_safe},r))}StringBuilder.prototype.takeUpTo=function(e){var r;if(e<this.checkpoint)throw(r=new Error("position should be > checkpoint")).position=e,r.checkpoint=this.checkpoint,r;return this.result+=this.source.slice(this.checkpoint,e),this.checkpoint=e,this},StringBuilder.prototype.escapeChar=function(){var e=this.source.charCodeAt(this.checkpoint),r=ESCAPE_SEQUENCES[e]||encodeHex(e);return this.result+=r,this.checkpoint+=1,this},StringBuilder.prototype.finish=function(){this.source.length>this.checkpoint&&this.takeUpTo(this.source.length)};var dump_1=dump,safeDump_1=safeDump,dumper={dump:dump_1,safeDump:safeDump_1};function deprecated(e){return function(){throw new Error("Function "+e+" is deprecated and cannot be used.")}}var Type$1=type,Schema$1=schema,FAILSAFE_SCHEMA=failsafe,JSON_SCHEMA=json,CORE_SCHEMA=core,DEFAULT_SAFE_SCHEMA=default_safe,DEFAULT_FULL_SCHEMA=default_full,load$1=loader.load,loadAll$1=loader.loadAll,safeLoad$1=loader.safeLoad,safeLoadAll$1=loader.safeLoadAll,dump$1=dumper.dump,safeDump$1=dumper.safeDump,YAMLException$1=exception,MINIMAL_SCHEMA=failsafe,SAFE_SCHEMA=default_safe,DEFAULT_SCHEMA=default_full,scan=deprecated("scan"),parse=deprecated("parse"),compose=deprecated("compose"),addConstructor=deprecated("addConstructor"),jsYaml={Type:Type$1,Schema:Schema$1,FAILSAFE_SCHEMA,JSON_SCHEMA,CORE_SCHEMA,DEFAULT_SAFE_SCHEMA,DEFAULT_FULL_SCHEMA,load:load$1,loadAll:loadAll$1,safeLoad:safeLoad$1,safeLoadAll:safeLoadAll$1,dump:dump$1,safeDump:safeDump$1,YAMLException:YAMLException$1,MINIMAL_SCHEMA,SAFE_SCHEMA,DEFAULT_SCHEMA,scan,parse,compose,addConstructor},jsYaml$1=jsYaml,SceneBundle=function(){function e(r,n){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;_classCallCheck(this,e),this.url=r,!n||isRelativeURL(n)&&!isRelativeURL(this.url)?this.path=pathForURL(this.url):this.path=n,this.path_for_parent=n||this.path,this.parent=o,this.container=null,this.parent&&(this.parent.container?this.container=this.parent.container:this.parent.isContainer()&&(this.container=this.parent))}return _createClass(e,[{key:"load",value:function(){return loadResource(this.url)}},{key:"resourceFor",value:function(r){return{url:this.urlFor(r),path:this.pathFor(r),type:this.typeFor(r)}}},{key:"urlFor",value:function(r){return isGlobal(r)?r:isRelativeURL(r)&&this.container?this.parent.urlFor(this.path_for_parent+r):addBaseURL(r,this.path)}},{key:"pathFor",value:function(r){return pathForURL(r)}},{key:"typeFor",value:function(r){return extensionForURL(r)}},{key:"isContainer",value:function(){return!1}}]),e}();function createSceneBundle(e,r,n){return new SceneBundle(e,r,n)}function isGlobal(e){return!(!e||e.slice(0,7)!=="global.")}function parseResource(e){var r;try{r=jsYaml$1.safeLoad(e,{json:!0})}catch(n){throw n}return r}function loadResource(e){return new Promise(function(r,n){typeof e=="string"?Utils$1.io(e).then(function(o){try{var s=parseResource(o);r(s)}catch(l){n(l)}},n):(e=Object.assign({},e),r(e))})}function notNull(e){return e!=null}function wrap$1(e){return"("+e+")"}function maybeQuote(e){return typeof e=="string"?'"'+e+'"':e}function lookUp(e){return e[0]==="$"?"context['"+e.substring(1)+"']":"context.feature.properties['"+e+"']"}function nullValue(e,r){return" true "}function propertyEqual(e,r){return wrap$1(maybeQuote(r)+" === "+lookUp(e))}function propertyOr(e,r){return wrap$1(r.map(function(n){return propertyEqual(e,n)}).join(" || "))}function printNested(e,r){return wrap$1(e.filter(notNull).map(function(n){return wrap$1(n.join(" && "))}).join(" "+r+" "))}function any(e,r,n){return r&&0<r.length?printNested(r.map(function(o){return parseFilter(o,n)}),"||"):"true"}function all(e,r,n){return r&&0<r.length?printNested(r.map(function(o){return parseFilter(o,n)}),"&&"):"true"}function not(e,r,n){return"!"+wrap$1(parseFilter(r,n).join(" && "))}function none(e,r,n){return"!"+wrap$1(any(null,r,n))}function propertyMatchesBoolean(e,r){return wrap$1(lookUp(e)+(r?" != ":" == ")+"null")}function rangeMatch(e,r,n){var o,s,l=[],h=n&&typeof n.rangeTransform=="function"&&n.rangeTransform;return r.max&&(o=h?h(r.max):r.max,l.push(lookUp(e)+" < "+o)),r.min&&(s=h?s=h(r.min):r.min,l.push(lookUp(e)+" >= "+s)),wrap$1(l.join(" && "))}function parseFilter(e,r){var n=[];if(typeof e=="function")return[wrap$1(e.toString()+"(context)")];if(Array.isArray(e))return[any(null,e,r)];if(e==null)return["true"];for(var o=Object.keys(e),s=0;s<o.length;s++){var l=o[s],h=e[l],d=_typeof(h);if(d==="string"||d==="number")n.push(propertyEqual(l,h));else if(d==="boolean")n.push(propertyMatchesBoolean(l,h));else if(l==="not")n.push(not(l,h,r));else if(l==="any")n.push(any(l,h,r));else if(l==="all")n.push(all(l,h,r));else if(l==="none")n.push(none(l,h,r));else if(Array.isArray(h))n.push(propertyOr(l,h));else if(d==="object"&&h!=null)(h.max||h.min)&&n.push(rangeMatch(l,h,r));else{if(h!=null)throw new Error("Unknown Query syntax: "+h);n.push(nullValue())}}return o.length===0?["true"]:n}function filterToString(e){return wrap$1(e.join(" && "))}function buildFilter(e,r){return e==null?function(){return!0}:new Function("context","return "+filterToString(parseFilter(e,r))+";")}var reserved=["filter","draw","visible","enabled","data"],layer_cache={};function cacheKey(e){if(1<e.length){for(var r=e[0],n=1;n<e.length;n++)r+="/"+e[n];return r}return e[0]}function mergeTrees(e,r){for(var n,o=0,s=0;s<e.length;s++)e[s].length>o&&(o=e[s].length);if(o===0)return null;for(var l={visible:!0},h=0;h<o;h++)(function(d){n=[],e.forEach(function(y){y[d]&&y[d][r]&&n.indexOf(y[d][r])===-1&&n.push(y[d][r])}),n.length!==0&&(n.sort(function(y,g){return(y&&y.layer_name)>(g&&g.layer_name)?1:-1}),mergeObjects.apply(void 0,[l].concat(_toConsumableArray(n))),delete l.layer_name)})(h);return l.visible===!1?null:l}var blacklist=["any","all","not","none"],Layer=function(){function e(r){var n,o=r.layer,s=r.name,l=r.parent,h=r.draw,d=r.visible,y=r.enabled,g=r.filter,v=r.styles;if(_classCallCheck(this,e),this.id=e.id++,this.config_data=o.data,this.parent=l,this.name=s,this.full_name=this.parent?this.parent.full_name+":"+this.name:this.name,this.draw=h,this.filter=g,this.styles=v,this.is_built=!1,y=y===void 0?d:y,this.parent&&this.parent.visible===!1?this.enabled=!1:this.enabled=y!==!1,this.draw)for(var m in this.draw)this.draw[m]=this.draw[m]==null?{}:this.draw[m],_typeof(this.draw[m])!=="object"?(n="Draw group '".concat(m,"' for layer ").concat(this.full_name," is invalid, must be an object, "),log("warn",n+="but was set to `".concat(m,": ").concat(this.draw[m],"` instead")),delete this.draw[m]):this.draw[m].layer_name=this.full_name}return _createClass(e,[{key:"build",value:function(){log("trace","Building layer '".concat(this.full_name,"'")),this.buildFilter(),this.buildDraw(),this.is_built=!0}},{key:"buildDraw",value:function(){this.draw=Utils$1.stringsToFunctions(this.draw,StyleParser.wrapFunction),this.calculatedDraw=calculateDraw(this)}},{key:"buildFilter",value:function(){this.filter_original=this.filter,this.filter=Utils$1.stringsToFunctions(this.filter,StyleParser.wrapFunction);var r=_typeof(this.filter);if(this.filter==null||r==="object"||r==="function")try{this.buildZooms(),this.buildPropMatches(),this.filter!=null&&(typeof this.filter=="function"||0<Object.keys(this.filter).length)?this.filter=buildFilter(this.filter,FilterOptions):this.filter=null}catch(s){var n="Filter for layer ".concat(this.full_name," is invalid, `filter: ").concat(JSON.stringify(this.filter),"` ");log("warn",n+="failed with error '".concat(s.message,"', stack trace: ").concat(s.stack))}else{var o="Filter for layer ".concat(this.full_name," is invalid, filter value must be an object or function, ");log("warn",o+="but was set to `filter: ".concat(this.filter,"` instead"))}}},{key:"buildZooms",value:function(){var r=this.filter&&this.filter.$zoom,n=_typeof(r);if(r!=null&&n!=="function"){if(this.zooms={},n==="number")this.zooms[r]=!0;else if(Array.isArray(r))for(var o=0;o<r.length;o++)this.zooms[r[o]]=!0;else if(n==="object"&&(r.min!=null||r.max!=null))for(var s=r.min||0,l=r.max||25,h=s;h<l;h++)this.zooms[h]=!0;delete this.filter.$zoom}}},{key:"buildPropMatches",value:function(){var r=this;this.filter&&!Array.isArray(this.filter)&&typeof this.filter!="function"&&Object.keys(this.filter).forEach(function(n){if(blacklist.indexOf(n)===-1){var o=r.filter[n],s=_typeof(o),l=Array.isArray(o);if(!l&&s!=="string"&&s!=="number")return;n[0]==="$"?(r.context_prop_matches=r.context_prop_matches||[],r.context_prop_matches.push([n.substring(1),l?o:[o]])):(r.feature_prop_matches=r.feature_prop_matches||[],r.feature_prop_matches.push([n,l?o:[o]])),delete r.filter[n]}})}},{key:"doPropMatches",value:function(r){if(this.feature_prop_matches)for(var n=0;n<this.feature_prop_matches.length;n++){var o=this.feature_prop_matches[n],s=r.feature.properties[o[0]];if(s==null||o[1].indexOf(s)===-1)return!1}if(this.context_prop_matches)for(var l=0;l<this.context_prop_matches.length;l++){var h=this.context_prop_matches[l],d=r[h[0]];if(d==null||h[1].indexOf(d)===-1)return!1}return!0}},{key:"doesMatch",value:function(r){if(!this.enabled||(this.is_built||this.build(),this.zooms!=null&&!this.zooms[r.zoom])||!this.doPropMatches(r))return!1;var n;if(this.filter instanceof Function)try{n=this.filter(r)}catch(s){var o="Filter for this ".concat(this.full_name,": `filter: ").concat(this.filter_original,"` ");log("error",o+="failed with error '".concat(s.message,"', stack trace: ").concat(s.stack),r.feature)}else n=this.filter==null;return!!n&&(this.children_to_parse&&(parseLayerChildren(this,this.children_to_parse,this.styles),delete this.children_to_parse),!0)}}]),e}();Layer.id=0;var LayerLeaf=function(){_inherits(r,Layer);var e=_createSuper(r);function r(n){var o;return _classCallCheck(this,r),(o=e.call(this,n)).is_leaf=!0,o}return r}(),LayerTree=function(){_inherits(r,Layer);var e=_createSuper(r);function r(n){var o;return _classCallCheck(this,r),(o=e.call(this,n)).is_tree=!0,o.layers=n.layers||[],o}return _createClass(r,[{key:"addLayer",value:function(n){this.layers.push(n)}},{key:"buildDrawGroups",value:function(n){var o=[],s=[];if(matchFeature(n,[this],o,s),0<o.length){var l=cacheKey(s);if(layer_cache[l]===void 0){for(var h=o.map(function(V){return V&&V.visible!==!1&&V.calculatedDraw}),d={},y=0;y<h.length;y++){var g=h[y];if(g)for(var v=0;v<g.length;v++){var m=g[v];for(var w in m)d[w]=!0}}for(var I in d)layer_cache[l]=layer_cache[l]||{},layer_cache[l][I]=mergeTrees(h,I),layer_cache[l][I]?(layer_cache[l][I].key=l+"/"+I,layer_cache[l][I].layers=o.map(function(V){return V&&V.full_name}),layer_cache[l][I].group=I):delete layer_cache[l][I];layer_cache[l]&&Object.keys(layer_cache[l]).length===0&&(layer_cache[l]=null)}return layer_cache[l]}}}]),r}(),FilterOptions={rangeTransform:function(e){return typeof e=="string"&&e.trim().slice(-3)==="px2"?"".concat(parseFloat(e)," * context.meters_per_pixel_sq"):e}},SceneLoader;function isReserved(e){return-1<reserved.indexOf(e)}function isEmpty(e){return Object.keys(e).length===0}function groupProps(e){var r={},n={};for(var o in e)isReserved(o)?r[o]=e[o]:n[o]=e[o];return[r,n]}function calculateDraw(e){var r,n=[];return e.parent&&(r=e.parent.calculatedDraw||[],n.push.apply(n,_toConsumableArray(r))),n.push(e.draw),n}function parseLayerNode(e,r,n,o){var s={name:e,layer:r=r??{},parent:n,styles:o},l=_slicedToArray(groupProps(r),2),h=l[0],d=l[1],y=isEmpty(d),g=y&&n!=null?LayerLeaf:LayerTree,v=new g(Object.assign(s,h));return v.enabled&&(n&&n.addLayer(v),v.children_to_parse=y?null:d),v}function parseLayerChildren(e,r,n){for(var o in r){var s,l=r[o];_typeof(l)!=="object"||Array.isArray(l)?(s="Layer value must be an object: cannot create layer '".concat(o,": ").concat(JSON.stringify(l),"'"),s+=", under parent layer '".concat(e.full_name,"'."),n[e.name]&&(s+=" The parent name '".concat(e.name,"' is also the name of a style, did you mean to create a 'draw' group"),e.parent&&(s+=" under '".concat(e.parent.name,"'")),s+=" instead?"),log("warn",s)):parseLayerNode(o,l,e,n)}}function parseLayers(e,r){layer_cache={};var n={};for(var o in e){var s=e[o];s&&(n[o]=parseLayerNode(o,s,null,r))}return n}function matchFeature(e,r,n,o){var s=!1;if(r.length!==0){for(var l=0;l<r.length;l++){var h=r[l];h.is_leaf?h.doesMatch(e)&&(s=!0,n.push(h),o.push(h.id)):h.is_tree&&h.doesMatch(e)&&(s=!0,matchFeature(e,h.layers,n,o)||(n.push(h),o.push(h.id)))}return s}}var GLOBAL_PROP_RGX=/^global\.(.+)$/,SceneLoader$1=SceneLoader={loadScene:function(e,r){var n=this,o=1<arguments.length&&r!==void 0?r:{},s=o.path,l=o.type,h=[];return this.loadSceneRecursive({url:e,path:s,type:l},null,h).then(function(d){return n.finalize(d)}).then(function(d){var y=d.config,g=d.bundle;return y?(0<h.length&&h.forEach(function(v){var m="Failed to import scene: ".concat(v.url);log("error",m,v),n.trigger("error",{type:"scene_import",message:m,error:v,url:v.url})}),{config:y,bundle:g}):Promise.reject(h[0])})},loadSceneRecursive:function(e,r,n){var o=this,s=e.url,l=e.path;e.type;var h=2<arguments.length&&n!==void 0?n:[];if(!s)return Promise.resolve({});var d=createSceneBundle(s,l,r);return d.load().then(function(y){if(y.import==null)return o.normalize(y,d),{config:y,bundle:d};Array.isArray(y.import)||(y.import=[y.import]);var g=[];return y.import.forEach(function(v){_typeof(v)==="object"&&(v=createObjectURL(new Blob([JSON.stringify(v)]))),g.push(d.resourceFor(v))}),delete y.import,Promise.all(g.map(function(v){return o.loadSceneRecursive(v,d,h)})).then(function(v){v.forEach(function(w){return o.normalize(w.config,w.bundle)});var m=v.map(function(w){return w.config});return y=mergeObjects.apply(void 0,_toConsumableArray(m).concat([y])),o.normalize(y,d),{config:y,bundle:d}})}).catch(function(y){return y.url=s,h.push(y),{}})},normalize:function(e,r){return this.normalizeDataSources(e,r),this.normalizeFonts(e,r),this.normalizeTextures(e,r),this.hoistTextures(e,r),{config:e,bundle:r}},normalizeDataSources:function(e,r){for(var n in e.sources=e.sources||{},e.sources)this.normalizeDataSource(e.sources[n],r);return e},normalizeDataSource:function(e,r){if(e.url&&(e.url=r.urlFor(e.url)),e.scripts)for(var n in Array.isArray(e.scripts)&&(e.scripts=e.scripts.reduce(function(o,s){return o[s]=s,o},{})),e.scripts)e.scripts[n]=r.urlFor(e.scripts[n]);return e},normalizeFonts:function(e,r){for(var n in e.fonts=e.fonts||{},e.fonts){var o;Array.isArray(e.fonts[n])?e.fonts[n].forEach(function(s){s.url=s.url&&r.urlFor(s.url)}):(o=e.fonts[n]).url=o.url&&r.urlFor(o.url)}return e},normalizeTextures:function(e,r){if(e.textures=e.textures||{},e.textures)for(var n in e.textures){var o=e.textures[n];o.url&&(o.url=r.urlFor(o.url))}},hoistTextures:function(e,r){var n=this;if(e.styles)for(var o in e.styles)(function(m){var w=e.styles[m],I=w.texture;typeof I!="string"||e.textures[I]||(w.texture=n.hoistTexture(I,e,r)),w.material&&["emission","ambient","diffuse","specular","normal"].forEach(function(V){var q=w.material[V]!=null&&w.material[V].texture;typeof q!="string"||e.textures[q]||(w.material[V].texture=n.hoistTexture(q,e,r))})})(o);if(this.hoistStyleShaderUniformTextures(e,r,{include_globals:!1}),e.layers)for(var s=[e.layers];0<s.length;){var l=s.pop();if(_typeof(l)==="object"&&!Array.isArray(l))for(var h in l)if(h==="draw"){var d,y,g=l[h];for(var v in g)g[v].texture&&(typeof(d=g[v].texture)!="string"||e.textures[d]||(g[v].texture=this.hoistTexture(d,e,r))),g[v].outline&&g[v].outline.texture&&(typeof(y=g[v].outline.texture)!="string"||e.textures[y]||(g[v].outline.texture=this.hoistTexture(y,e,r)))}else{if(isReserved(h))continue;s.push(l[h])}}},hoistStyleShaderUniformTextures:function(e,r,n){var o=this,s=n.include_globals;if(e.styles)for(var l in e.styles){var h=e.styles[l];h.shaders&&h.shaders.uniforms&&GLSL.parseUniforms(h.shaders.uniforms).forEach(function(d){var y=d.type,g=d.value,v=d.key,m=d.uniforms;y!=="sampler2D"||typeof g!="string"||e.textures[g]||!s&&isGlobal(g)||(m[v]=o.hoistTexture(g,e,r))})}},hoistTexture:function(e,r,n){var o=isGlobal(e),s=o?e:n.urlFor(e),l=o?"texture-".concat(s):s;return r.textures[l]={url:s},l},applyGlobalProperties:function(e){if(!e.global||Object.keys(e.global).length===0)return e;var r=flattenProperties(e.global);return function n(o){if(typeof o=="string"){var s=function d(y,g,v){var m=2<arguments.length&&v!==void 0?v:[];if(-1<m.indexOf(y))log({level:"warn",once:!0},"Global properties: cyclical reference detected",m);else{m.push(y);var w=GLOBAL_PROP_RGX.exec(y);if(w){var I=w[1];if(I){var V=g[I];if(V!==void 0)return typeof V=="string"&&GLOBAL_PROP_RGX.exec(V)?d(V,g,m):V;log({level:"warn",once:!0},"Global property not found: "+y)}else log({level:"warn",once:!0},"Invalid global property reference: "+y)}}}(o,r);s!==void 0&&(o=s)}else if(Array.isArray(o))for(var l=0;l<o.length;l++)o[l]=n(o[l]);else if(_typeof(o)==="object")for(var h in o)o[h]=n(o[h]);return o}(e)},finalize:function(e){var r=e.config,n=e.bundle;return r?(r.global=r.global||{},r.scene=r.scene||{},r.cameras=r.cameras||{},r.lights=r.lights||{},r.styles=r.styles||{},r.layers=r.layers||{},r.camera&&(r.cameras.default=r.camera),Object.keys(r.cameras).length===0&&(r.cameras.default={}),Object.keys(r.lights).length!==0&&!Object.keys(r.lights).every(function(o){return r.lights[o].visible===!1})||(r.lights.default_light={type:"directional"}),{config:r,bundle:n}):{}}};function flattenProperties(e){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:".",n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{},o=(o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)?o+r:"";for(var s in e){var l=o+s,h=e[s];_typeof(n[l]=h)!=="object"||Array.isArray(h)||flattenProperties(h,r,l,n)}return n}subscribeMixin(SceneLoader);var TilePyramid=function(){function e(){_classCallCheck(this,e),this.coords={},this.max_proxy_descendant_depth=6,this.max_proxy_ancestor_depth=10}return _createClass(e,[{key:"sourceTiles",value:function(r,n){return this.coords[r.key]&&this.coords[r.key].sources&&this.coords[r.key].sources[n.name]}},{key:"addTile",value:function(r){var n=r.coords.key,o=this.coords[n];(o=o||(this.coords[n]={descendants:0})).sources||(o.sources={}),o.sources[r.source.name]||(o.sources[r.source.name]={});for(var s=(o.sources[r.source.name][r.style_zoom]=r).coords.z-1;0<=s;s--){var l=Tile.coordinateAtZoom(r.coords,s);this.coords[l.key]||(this.coords[l.key]={descendants:0}),this.coords[l.key].descendants++}}},{key:"removeTile",value:function(r){var n=this.sourceTiles(r.coords,r.source),o=r.coords.key;n&&(delete n[r.style_zoom],Object.keys(n).length===0&&(delete this.coords[o].sources[r.source.name],Object.keys(this.coords[o].sources).length===0&&(delete this.coords[o].sources,this.coords[o].descendants===0&&delete this.coords[o])));for(var s=r.coords.z-1;0<=s;s--){var l=Tile.coordinateAtZoom(r.coords,s);this.coords[l.key]&&0<this.coords[l.key].descendants&&(this.coords[l.key].descendants--,this.coords[l.key].descendants!==0||this.coords[l.key].sources||delete this.coords[l.key])}}},{key:"getAncestor",value:function(r,n){var o=r.coords,s=r.style_zoom,l=r.source,h=1<arguments.length&&n!==void 0?n:1;if(!(h>this.max_proxy_ancestor_depth)){if(s>l.max_coord_zoom){var d=this.sourceTiles(o,l);if(d){for(var y=s-1;y>=l.max_coord_zoom;y--)if(d[y]&&d[y].loaded)return d[y]}s=l.max_coord_zoom}s--;var g=Tile.coordinateAtZoom(o,o.z-1),v=this.sourceTiles(g,l);return v&&v[s]&&v[s].loaded?v[s]:0<g.z?this.getAncestor({coords:g,style_zoom:s,source:l},h+1):void 0}}},{key:"getDescendants",value:function(r,n){var o=r.coords,s=r.style_zoom,l=r.source,h=1<arguments.length&&n!==void 0?n:1,d=[];if(s>=l.max_coord_zoom){var y=this.sourceTiles(o,l);if(y){for(var g=Math.max(Geo$1.default_view_max_zoom,s+this.max_proxy_descendant_depth),v=s+1;v<=g;v++)if(y[v]&&y[v].loaded)return d.push(y[v]),d}return d}if(this.coords[o.key]&&0<this.coords[o.key].descendants){s++;for(var m=Tile.childrenForCoordinate(o),w=0;w<m.length;w++){var I=m[w],V=this.sourceTiles(I,l);V&&V[s]&&V[s].loaded?d.push(V[s]):h<=this.max_proxy_descendant_depth&&I.z<=l.max_coord_zoom&&d.push.apply(d,_toConsumableArray(this.getDescendants({coords:I,source:l,style_zoom:s},h+1)))}}return d}}]),e}(),LabelMainPass=function(){function e(r,n,o,s){_classCallCheck(this,e),Object.assign(this,r),this.placed=null,this._tile=s;var l=Geo$1.unitsPerMeter(s.coords.z)*Math.pow(2,o-s.style_zoom);this.layout=Object.assign({},r.layout),this.layout.repeat_scale=.75,this.layout.repeat_distance=this.layout.repeat_distance||0,this.layout.repeat_distance/=l,this.position=Geo$1.tileSpaceToMeters(this.position,s.coords.z,s.min),this._worldToScreen=n,this._screenSpaceBoundingBox=void 0,this._boundingCircles=void 0}return _createClass(e,[{key:"getTile",value:function(){return this._tile}},{key:"isFlat",value:function(){return this.is_flat}},{key:"getScreenSpaceBoundingBox",value:function(){var r,n,o,s,l,h,d;return this._screenSpaceBoundingBox||((r=this._worldToScreen(this.position,!0))[0]+=this.offset[0],r[1]+=this.offset[1],n=this.size[0]/2+this.layout.buffer[0],o=this.size[1]/2+this.layout.buffer[1],s=r[0]-n,l=r[0]+n,h=r[1]-o,d=r[1]+o,this._screenSpaceBoundingBox={left:s,bottom:d,right:l,top:h}),this._screenSpaceBoundingBox}},{key:"getBoundingCircles",value:function(){return this._boundingCircles||(this._boundingCircles=this.type==="point"?this._convertSidesToScreenSpaceCircles():this._convertCirclesToScreenSpace()),this._boundingCircles}},{key:"_convertSidesToScreenSpaceCircles",value:function(){var r=this._tile.coords.z,n=this._tile.min,o=Geo$1.tileSpaceToMeters([this.sides[0],this.sides[1]],r,n),s=Geo$1.tileSpaceToMeters([this.sides[2],this.sides[3]],r,n),l=_slicedToArray(this._worldToScreen(o,!0),2),h=l[0],d=l[1],y=_slicedToArray(this._worldToScreen(s,!0),2);return encircleLine(h,d,y[0],y[1],this.size[1]/2+this.layout.buffer[1])}},{key:"_convertCirclesToScreenSpace",value:function(){for(var r=[],n=this.circles,o=this._tile.coords.z,s=this._tile.min,l=0;l<n.length-2;l+=3){var h=Geo$1.tileSpaceToMeters([n[l],-n[l+1]],o,s),d=n[l+2]/Geo$1.unitsPerMeter(o),y=[h[0]+d,h[1]],g=this._worldToScreen(h,!0),v=this._worldToScreen(y,!0),m=MathUtils$1.getLineLength(g[0],g[1],v[0],v[1]);r.push(g[0],g[1],m)}return r}}]),e}(),labelsMainPass={mainThreadLabelCollisionPass},visible={},prev_visible={},IS_LITTLE_ENDIAN=new Uint8Array(new Uint32Array([305419896]).buffer)[0]===120;function _createContainer(e,r,n,o,s){var l=e.container,h=l.label,d=l.linked,y=e.ranges;return{label:new LabelMainPass(h,n,o,s),linked:d,ranges:y,mesh:r}}function mainThreadLabelCollisionPass(e,r,n,o,s,l){prev_visible=visible,visible={};var h={},d={},y=[],g=n.worldToScreen.bind(n),v=new TextMeshHelper(l);for(var m in e.forEach(function(De){for(var _n in De.meshes)De.meshes[_n].forEach(function(ha){if(ha.labels){for(var ga in v.trackMesh(ha),ha.labels["non-collision"]){var _o=_createContainer(ha.labels["non-collision"][ga],ha,g,r,De);_o.label.text_data&&v.insertLabel(_o,De)}for(var _l in ha.labels.collision){var wc;h[_l]||(wc=_createContainer(ha.labels.collision[_l],ha,g,r,De),h[_l]=wc.label,d[_l]=wc)}}})}),d){var w=d[m];w.linked&&(w.linked=d[w.linked]),y.push(w)}var I=n.getViewport(),V=I.width,q=I.height;return Collision.startTile("main",{apply_repeat_groups:!0,return_hidden:!0,grid_index:new GridIndex(V,q,30)}),Collision.addStyle("main","main"),Collision.collide(y,"main","main").then(function(De){return De.forEach(function(_n){var ha,ga,_o,_l,wc,_h,_p=_n.mesh,pd=_n.label.getTile();_p.valid&&(!(ha=0)!==_n.show||o&&_n.label.breach&&!prev_visible[_n.label.id]||(ha=1),ha&&(visible[_n.label.id]=!0),_n.label.text_data&&v.insertLabel(_n,pd),ga=_p.vertex_layout.offset.a_shape,_o=_p.vertex_layout.stride,wc=(_l=_p.vertex_layout.attribs.find(function(oy){return oy.name==="a_shape"})).byte_size/_l.size,ga+=3*wc,_h=!0,_n.ranges.forEach(function(oy){if(_h){for(var ny=0;ny<oy[1];ny++){if(_p.vertex_data[oy[0]+ny*_o+ga]===ha)return void(_h=!1);_p.vertex_data[oy[0]+ny*_o+ga]=ha}v.trackMesh(_p)}}))}),v.createTextures(s).then(function(){return v.updateMeshes()})}).then(function(De){De.forEach(function(_n){return _n.valid&&_n.upload()}),e.forEach(function(_n){_n.labeled=!0}),y=[],d={},h={}})}var TextMeshHelper=function(){function e(r){_classCallCheck(this,e),this.textureManager=getTextureManager(r),this.tiles={},this.meshes=[],this.containers=[]}return _createClass(e,[{key:"insertLabel",value:function(r,n){var o=r.label.text_data,s=o.text_settings_key,l=o.text,h=o.text_info;this.containers.push(r);var d=this._ensureTextSection(n,s);d[l]?r.label.text_data.text_info=d[l]:d[l]=h}},{key:"trackMesh",value:function(r){this.meshes.indexOf(r)===-1&&this.meshes.push(r)}},{key:"updateMeshes",value:function(){var r=this;return this.containers.forEach(function(n){var o,s,l,h,d,y,g,v,m,w;n.label.text_data&&(o=n.label.getTile(),(s=n.mesh).valid?(l=n.label.type,h=n.label.text_data.text_info,r.tiles[o.id]&&r.tiles[o.id].textures&&(d=r.tiles[o.id].textures[0],s.uniforms.u_texture=d,s.textures.indexOf(d)===-1&&s.textures.push(d),l==="point"||l==="straight"?(y=l==="point"?h.align[n.label.align].texcoords:h.texcoords[l].texcoord,r.setTexCoords(s,n,y)):l==="curved"&&(g=h.segments.length,v=h.texcoords_stroke,m=h.texcoords.curved,r.setTexCoords(s,n,function(I){return I<g?v[I]:m[I-g].texcoord})))):r.tiles[o.id]&&r.tiles[o.id].textures&&(w=r.tiles[o.id].textures[0],r.textureManager.release(w)))}),this.meshes}},{key:"setTexCoords",value:function(r,n,o){var s,l,h,d,y,g,v=o instanceof Function;v||(l=(s=_slicedToArray(o,4))[0],h=s[1],d=s[2],y=s[3],g=[[l,h],[d,h],[d,y],[l,y]]);var m=r.vertex_layout.stride,w=new DataView(r.vertex_data.buffer),I=r.vertex_layout.offset.a_texcoord;n.ranges.forEach(function(V,q){var De,_n,ha,ga,_o,_l=_slicedToArray(V,3),wc=_l[0],_h=_l[1],_p=_l[2];v&&(_n=(De=_slicedToArray(o(q),4))[0],ha=De[1],ga=De[2],_o=De[3],g=[[_n,ha],[ga,ha],[ga,_o],[_n,_o]]);for(var pd=_p?_h/2:0;pd<_h;pd++){var oy=g[pd%4],ny=wc+pd*m;w.setUint16(ny+I,oy[0]*texcoord_normalize,IS_LITTLE_ENDIAN),w.setUint16(ny+I+2,oy[1]*texcoord_normalize,IS_LITTLE_ENDIAN)}})}},{key:"createTextures",value:function(r){var n=this;return Promise.all(Object.values(this.tiles).map(function(o){var s=o.id,l=o.key,h=o.texts;return n._createTexturesForTile(r,h,"labels-".concat(l,"-").concat(s),s,n.textureManager).then(function(d){d.length&&(d.forEach(function(y){n.textureManager.retain(y),1<n.textureManager.getRetainCount(y)&&n.textureManager.release(y)}),n.tiles[s].textures=d)})}))}},{key:"_createTexturesForTile",value:function(r,n,o,s,l){var h=new CanvasText,d=h.setTextureTextPositions(n);return h.rasterize(n,d,s,o,r,l)}},{key:"_ensureTile",value:function(r){var n=r.id,o=r.key;return this.tiles[n]||(this.tiles[n]={id:n,key:o,texts:{}}),this.tiles[n]}},{key:"_ensureTextSection",value:function(r,n){var o=this._ensureTile(r).texts;return o[n]||(o[n]={}),o[n]}}]),e}(),TILE_VISIBILITY_COUNTER_THRESHOLD=30,TileManager=function(){function e(r){var n=this,o=r.scene,s=r.view;_classCallCheck(this,e),this._scene=o,this._view=s,this._visible_tiles={},this._pyramid=new TilePyramid,this._visible_coords={},this._building_tiles=null,this._renderable_tiles=[],this._active_styles=[],this._tile_visibility_counters={},this._update_labels_on_queue_check=!1,this._all_visible_tiles_are_cached=!1,this._debouncedUpdateLabels=debounce(this._updateLabels.bind(this),100,200),this._main_thread_target=["TileManager",this._scene.id].join("_"),WorkerBroker.addTarget(this._main_thread_target,this),this._keepCoordinate=this._keepCoordinate.bind(this),this._removeTilesFilter=this._removeTilesFilter.bind(this),this._removeCachedTilesFilter=this._removeCachedTilesFilter.bind(this),this._is_labeled=!1,this._tile_cache=new H.util.Cache(getMaxTileCacheSize(),function(l,h,d){n._visible_tiles[l]&&n._visible_tiles[l]===h||h.destroy()})}return _createClass(e,[{key:"destroy",value:function(){this._tile_cache.removeAll(),this.forEachVisibleTile(function(r){return r.destroy()}),this._visible_tiles={},this._pyramid=null,this._visible_coords={},this._scene=null,this._view=null}},{key:"keepTile",value:function(r){this._visible_tiles[r.key]=r,this._pyramid.addTile(r)}},{key:"hasTile",value:function(r){return this._visible_tiles[r]!==void 0}},{key:"_forgetTile",value:function(r){var n,o;this.hasTile(r)&&(n=this._visible_tiles[r],this._pyramid.removeTile(n),delete this._visible_tiles[r],n.loaded?this._tile_cache.add(n.key,n,getTileByteLength(n)):(o=this._tile_cache.get(n.key))?this._tile_cache.drop(o.key):n.destroy(),this._tileBuildStop(n))}},{key:"removeTile",value:function(r){this._forgetTile(r),this._scene.requestRedraw()}},{key:"forEachVisibleTile",value:function(r){for(var n in this._visible_tiles)r(this._visible_tiles[n])}},{key:"removeTiles",value:function(r){for(var n in this._visible_tiles)r(this._visible_tiles[n])&&this.removeTile(n)}},{key:"removeCachedTiles",value:function(r){var n=this;this._tile_cache.forEach(function(o,s){r(s)&&n._tile_cache.drop(o)})}},{key:"updateTilesForView",value:function(r){var n=0<arguments.length&&r!==void 0&&r;this._visible_coords={};for(var o=this._view.findVisibleTileCoordinates(),s=0;s<o.length;s++){var l=o[s];this._visible_coords[l.key]=l}this.updateTileStates(n)}},{key:"updateTileStates",value:function(r){var n=0<arguments.length&&r!==void 0&&r;for(var o in this._all_visible_tiles_are_cached=!0,this._visible_coords)this._keepCoordinate(o,n);this._all_visible_tiles_are_cached&&(this._is_labeled=!1,this._debouncedUpdateLabels()),this._tile_cache.removeAll(this._removeCachedTilesFilter),this._updateProxyTiles(),this.removeTiles(this._removeTilesFilter),this._updateRenderableTiles(),this._updateActiveStyles()}},{key:"_removeTilesFilter",value:function(r){if(r.style_zoom===this._view.lookAtManipulator.getLookAtData().tile_level){if(this._visible_coords[r.coords.key])return!1;for(var n in this._visible_coords)if(Tile.isDescendant(r.coords,this._visible_coords[n]))return!1}return!r.isProxy()}},{key:"_updateLabels",value:function(){var r,n=this;this._building_tiles&&Object.keys(this._building_tiles).length!==0||(CanvasText.pruneTextCache(),r=this._renderable_tiles.sort(compareTileCoords),labelsMainPass.mainThreadLabelCollisionPass(r,roundPrecision(this._view.lookAtManipulator.getLookAtData().zoom,2),this._view.lookAtManipulator,this.isLoadingVisibleTiles(),this._scene.gl,this._scene.id).then(function(){n._is_labeled=!Task.hasPendingTasks(),n._scene&&n._scene.immediateRedraw(),n._update_labels_on_queue_check=!1}))}},{key:"_updateProxyTiles",value:function(){var r,n=this,o=this._view.lookAtManipulator.getZoomDirection();o!==0&&(r=!1,this.forEachVisibleTile(function(s){var l;if(s.setProxyFor(null),o===1)s.built||(l=n._pyramid.getAncestor(s))&&(l.setProxyFor(s),r=!0);else if(o===-1&&!s.built)for(var h=n._pyramid.getDescendants(s),d=0;d<h.length;d++)h[d].setProxyFor(s),r=!0}),r||this._view.lookAtManipulator.resetZoomDirection())}},{key:"getRenderableTiles",value:function(){return this._renderable_tiles}},{key:"_updateRenderableTiles",value:function(){for(var r in this._renderable_tiles=[],this._visible_tiles){var n=this._visible_tiles[r],o=this._tile_cache.get(r);n.loaded?(this._renderable_tiles.push(n),o&&o!==n&&this._tile_cache.drop(r)):o&&(o.generation===this._scene.generation?this._renderable_tiles.push(o):this._tile_cache.drop(r))}return this._renderable_tiles}},{key:"getWorkerForTile",value:function(r,n){var o=n.has_volatile_data?this._scene.getWorkers(WorkerType.FAKE)[0]:n.tiled?this._scene.getWorkers(WorkerType.NATIVE)[Math.abs(r.x+r.y+r.z)%this._scene.num_workers]:this._scene.getWorkers(WorkerType.NATIVE)[n.id%this._scene.num_workers];return o}},{key:"getActiveStyles",value:function(){return this._active_styles}},{key:"_updateActiveStyles",value:function(){for(var r=this._renderable_tiles,n={},o=0;o<r.length;o++){var s=r[o];Object.keys(s.meshes).forEach(function(l){return n[l]=!0})}return this._active_styles=Object.keys(n),this._active_styles}},{key:"isLoadingVisibleTiles",value:function(){var r=!1;for(var n in this._visible_tiles)if(!this._visible_tiles[n].built){r=!0;break}return r}},{key:"updateTilesVisibilityCounters",value:function(){var r=this;Object.keys(this._visible_coords).forEach(function(s){s in r._tile_visibility_counters||(r._tile_visibility_counters[s]=0)});var n=Object.keys(this._tile_visibility_counters),o=[];n.forEach(function(s){s in r._visible_coords?(r._tile_visibility_counters[s]++,r._tile_visibility_counters[s]>=TILE_VISIBILITY_COUNTER_THRESHOLD&&o.push(r._visible_coords[s])):(r._tile_visibility_counters[s]--,r._tile_visibility_counters[s]<=0&&delete r._tile_visibility_counters[s])}),o.length&&this.loadCoordinates(o)}},{key:"loadCoordinates",value:function(r){var n=this;r.sort(function(o,s){var l=n._view.lookAtManipulator.getLookAtData().position,h=Geo$1.metersPerTile(o.z)/2,d=Geo$1.metersForTile(o);d.x+=h,d.y-=h;var y=Geo$1.metersForTile(s);y.x+=h,y.y-=h;var g=Math.abs(l[0]-d.x)+Math.abs(l[1]-d.y),v=Math.abs(l[0]-y.x)+Math.abs(l[1]-y.y);return(o.center_dist=g)<(s.center_dist=v)?-1:v===g?0:1}),r.forEach(function(o){return n.loadCoordinate(o)})}},{key:"_keepCoordinate",value:function(r,n){var o=1<arguments.length&&n!==void 0&&n,s=this._visible_coords[r];if(s.z===this._view.center_tile.z)for(var l in this._scene.sources){var h,d,y,g=this._scene.sources[l];g.builds_geometry_tiles&&g.includesTile(s,this._view.lookAtManipulator.getLookAtData().tile_level)&&(h=Tile.normalizedKey(s,g,this._view.lookAtManipulator.getLookAtData().tile_level))&&!this.hasTile(h)&&((d=o&&this._tile_cache.get(h))||(this._all_visible_tiles_are_cached=!1),y=d||new Tile({source:g,coords:s,worker:this.getWorkerForTile(s,g),style_zoom:Utils$1.zoomToTileLevel(s.z),view:this._view,sceneId:this._scene.id}),g.config.type==="ObjectSource"&&(y.syncedAt=g.getSyncedAt()),this.keepTile(y))}}},{key:"loadCoordinate",value:function(r){if(r.z===this._view.center_tile.z)for(var n in this._scene.sources){var o,s=this._scene.sources[n];s.builds_geometry_tiles&&s.includesTile(r,this._view.lookAtManipulator.getLookAtData().tile_level)&&(o=Tile.normalizedKey(r,s,this._view.lookAtManipulator.getLookAtData().tile_level),this.hasTile(o)&&this.buildTile(this._visible_tiles[o]))}}},{key:"buildTile",value:function(r,n){this._building_tiles&&this._building_tiles[r.key]||r.built&&r.generation===this._scene.generation||(this._tileBuildStart(r.key),r.build(this._scene.generation,n))}},{key:"buildTileStylesCompleted",value:function(r){var n=r.tile,o=r.progress;if(this._visible_tiles[n.key]==null)Tile.abortBuild(n,this._scene.id);else if(n.generation!==this._scene.generation)Tile.abortBuild(n,this._scene.id);else{if(n.id<this._visible_tiles[n.key].id)return void Tile.abortBuild(n,this._scene.id);n=this._visible_tiles[n.key].merge(n),o.done&&(n.built=!0),n.buildMeshes(this._scene.styles,o),this.updateTileStates(),this._scene.requestRedraw()}o.done&&this._tileBuildStop(n)}},{key:"buildTileError",value:function(r){this._forgetTile(r.key),Tile.abortBuild(r,this._scene.id)}},{key:"_tileBuildStart",value:function(r){this._is_labeled=!1,this._building_tiles=this._building_tiles||{},this._building_tiles[r]=!0}},{key:"_tileBuildStop",value:function(r){this._building_tiles&&(r.source&&r.source.hasLabeledData()&&(this._update_labels_on_queue_check=!0),delete this._building_tiles[r.key],Task.removeForTile(r.id),this.checkBuildQueue())}},{key:"isReady",value:function(){return this._is_labeled&&!this.isLoadingVisibleTiles()}},{key:"checkBuildQueue",value:function(){this._building_tiles&&Object.keys(this._building_tiles).length!==0||(this._building_tiles=null,this._update_labels_on_queue_check?this._updateLabels():(this._is_labeled=!Task.hasPendingTasks(),this._scene.immediateRedraw()))}},{key:"_removeCachedTilesFilter",value:function(r,n){var o=n.source;return!this._visible_tiles[r]&&(n.generation!==this._scene.generation||o.config.type==="ObjectSource"&&o.getSyncedAt()>n.syncedAt)}}]),e}();function compareTileCoords(e,r){var n=e.coords,o=r.coords;return n.z-o.z||n.x-o.x||n.y-o.y}function roundPrecision(e,r){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:2,o=Math.pow(10,n);return Math.round(Math.floor(e*r)/r*o)/o}function getTileByteLength(e){var r=0;for(var n in e.meshes)for(var o=e.meshes[n],s=0;s<o.length;s++){var l=o[s];r+=l.buffer_size;for(var h=0;h<l.textures.length;h++)r+=e.textureManager.getByteLength(l.textures[h])}return r}function getMaxTileCacheSize(){var e=.1;return navigator&&navigator.deviceMemory?e=5*navigator.deviceMemory/100:window&&window.screen&&(e=window.screen.width/512*window.screen.height/512*.03*3,e=Math.min(e,1)),1024*e*1024*1024}var RenderState=function(){function e(r,n){_classCallCheck(this,e),n(r),this.value=r,this.setup=n}return _createClass(e,[{key:"get",value:function(){return this.value}},{key:"set",value:function(r){JSON.stringify(this.value)!==JSON.stringify(r)&&(this.setup(r),this.value=r)}}]),e}(),RenderStateManager=function e(r){_classCallCheck(this,e),this.defaults={},this.defaults.culling=!0,this.defaults.culling_face=r.BACK,this.defaults.blending=!1,this.defaults.blending_src=r.ONE_MINUS_SRC_ALPHA,this.defaults.blending_dst=r.ONE_MINUS_SRC_ALPHA,this.defaults.blending_src_alpha=r.ONE,this.defaults.blending_dst_alpha=r.ONE_MINUS_SRC_ALPHA,this.defaults.depth_write=!0,this.defaults.depth_test=!0,r.depthFunc(r.LESS),this.culling=new RenderState({cull:this.defaults.culling,face:this.defaults.culling_face},function(n){n.cull?(r.enable(r.CULL_FACE),r.cullFace(n.face)):r.disable(r.CULL_FACE)}),this.blending=new RenderState({blend:this.defaults.blending,src:this.defaults.blending_src,dst:this.defaults.blending_dst,src_alpha:this.defaults.blending_src_alpha,dst_alpha:this.defaults.blending_dst_alpha},function(n){n.blend?(r.enable(r.BLEND),n.src_alpha&&n.dst_alpha?r.blendFuncSeparate(n.src,n.dst,n.src_alpha,n.dst_alpha):r.blendFunc(n.src,n.dst)):r.disable(r.BLEND)}),this.depth_write=new RenderState({depth_write:this.defaults.depth_write},function(n){r.depthMask(n.depth_write)}),this.depth_test=new RenderState({depth_test:this.defaults.depth_test},function(n){n.depth_test?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST)})},MediaCapture=function(){function e(){_classCallCheck(this,e),this.canvas=null,this.gl=null,this.screenshot_canvas=null,this.screenshot_context=null,this.queue_screenshot=null,this.video_capture=null}return _createClass(e,[{key:"setCanvas",value:function(r,n){this.canvas=r,this.gl=n}},{key:"screenshot",value:function(r){var n=this,o=(0<arguments.length&&r!==void 0?r:{}).background;return this.queue_screenshot!=null||(this.queue_screenshot={background:o},this.queue_screenshot.promise=new Promise(function(s,l){n.queue_screenshot.resolve=s,n.queue_screenshot.reject=l})),this.queue_screenshot.promise}},{key:"completeScreenshot",value:function(){if(this.queue_screenshot!=null){var r=this.canvas.width,n=this.canvas.height,o=new Uint8Array(r*n*4);this.gl.readPixels(0,0,r,n,this.gl.RGBA,this.gl.UNSIGNED_BYTE,o);for(var s=(s=this.queue_screenshot.background)&&s!=="transparent"?StyleParser.parseColor(s).slice(0,3).map(function(ga){return 255*ga}):null,l=new Uint8ClampedArray(r*n*4),h=0;h<n;h++)for(var d=0;d<r;d++){var y=4*((n-h-1)*r+d),g=4*(h*r+d),v=o[3+y];l[0+g]=255*o[0+y]/v,l[1+g]=255*o[1+y]/v,l[2+g]=255*o[2+y]/v,l[3+g]=v,s&&(v/=255,l[0+g]=l[0+g]*v+s[0]*(1-v),l[1+g]=l[1+g]*v+s[1]*(1-v),l[2+g]=l[2+g]*v+s[2]*(1-v),l[3+g]=255)}this.screenshot_canvas=this.screenshot_canvas||document.createElement("canvas");var m=this.screenshot_canvas;m.width=r,m.height=n,this.screenshot_context=this.screenshot_context||m.getContext("2d");var w=this.screenshot_context,I=new ImageData(l,r,n);w.putImageData(I,0,0);for(var V=m.toDataURL("image/png"),q=atob(V.slice(22)),De=new Uint8Array(q.length),_n=0;_n<q.length;++_n)De[_n]=q.charCodeAt(_n);var ha=new Blob([De],{type:"image/png"});this.queue_screenshot.resolve({url:V,blob:ha,type:"png"}),this.queue_screenshot=null}}},{key:"startVideoCapture",value:function(){var r=this;if(typeof window.MediaRecorder!="function"||!this.canvas||typeof this.canvas.captureStream!="function")return log("warn","Video capture (Canvas.captureStream and/or MediaRecorder APIs) not supported by browser"),!1;if(this.video_capture)return log("warn","Video capture already in progress, call Scene.stopVideoCapture() first"),!1;try{var n=this.video_capture={};n.chunks=[],n.stream=this.canvas.captureStream(),n.options={mimeType:"video/webm"},n.media_recorder=new MediaRecorder(n.stream,n.options),n.media_recorder.ondataavailable=function(o){var s,l;0<o.data.size&&n.chunks.push(o.data),n.resolve&&(l=createObjectURL(s=new Blob(n.chunks,{type:n.options.mimeType})),n.stream&&(n.stream.getTracks()||[]).forEach(function(h){h.stop(),n.stream.removeTrack(h)}),n.stream=null,n.media_recorder=null,r.video_capture=null,n.resolve({url:l,blob:s,type:"webm"}))},n.media_recorder.start()}catch(o){return this.video_capture=null,log("error","Scene video capture failed",o),!1}return!0}},{key:"stopVideoCapture",value:function(){var r=this;return this.video_capture?(this.video_capture.promise=new Promise(function(n,o){r.video_capture.resolve=n,r.video_capture.reject=o}),this.video_capture.media_recorder.stop(),this.video_capture.promise):(log("warn","No scene video capture in progress, call Scene.startVideoCapture() first"),Promise.resolve({}))}}]),e}(),SceneWorker=function(){function e(){_classCallCheck(this,e),this.sources={},this.styles={},this.layers={},this.tiles={},this._isConfigured=!1}return _createClass(e,[{key:"init",value:function(r,n,o,s,l,h,d){return this.setMeshVariantMaxLife(d),this.scene_id=r,this.textureManager=getTextureManager(r),this._worker_id=n,log.setLevel(o),Utils$1.device_pixel_ratio=s,VertexElements.setElementIndexUint(l),FeatureSelection.setPrefix(this._worker_id),this._style_manager=new StyleManager,this._importExternalScripts(h),Label.id_prefix=n,this._isConfigured=!1,n}},{key:"dispose",value:function(){this._last_config_sources=null,this._config_sources=null,this.sources=null,this._style_manager=null,this.styles=null,this.layers=null,this.tiles=null}},{key:"_importExternalScripts",value:function(r){var n;r.length!==0&&(log("debug","loading custom data source scripts in worker:",r),n=Object.getOwnPropertyNames(window),importScripts.apply(void 0,_toConsumableArray(r)),Object.getOwnPropertyNames(window).forEach(function(o){n.indexOf(o)===-1&&(self[o]=window[o])}))}},{key:"updateConfig",value:function(r,n){var l=r.config,o=r.generation,s=r.introspection,l=JSON.parse(l);for(var h in mergeDebugSettings(n),this._generation=o,this._isConfigured=!1,l.layers)l.layers[h]&&(l.layers[h].data=Utils$1.stringsToFunctions(l.layers[h].data));this.global=Utils$1.stringsToFunctions(l.global),this._createDataSources(l),l.styles=Utils$1.stringsToFunctions(l.styles,StyleParser.wrapFunction),this.styles=this._style_manager.build(l.styles),self.is_fake_worker=Thread.is_main,this._style_manager.initStyles({generation:this._generation,styles:this.styles,sources:this.sources,introspection:s,id:this.scene_id}),delete self.is_fake_worker,this.layers=parseLayers(l.layers,this._style_manager.styles),this._configuring=this._syncTextures(l.textures)}},{key:"setMeshVariantMaxLife",value:function(r){this.meshVariantMaxLife=r}},{key:"_createDataSources",value:function(r){var n=this;this._last_config_sources=this._config_sources||{},this._config_sources=r.sources;var o=this.sources,s=[];for(var l in r.sources=Utils$1.stringsToFunctions(r.sources),this.sources={},self.is_fake_worker=Thread.is_main,r.sources)if(JSON.stringify(this._last_config_sources[l])!==JSON.stringify(r.sources[l])){var h=void 0;try{h=DataSource.create(Object.assign({},r.sources[l],{name:l}),this.sources)}catch(d){log("error","Error creating source.",d.message,r.sources[l]);continue}h&&(this.sources[l]=h,s.push(l))}else this.sources[l]=o[l];delete self.is_fake_worker,s.forEach(function(d){for(var y in n.tiles)n.tiles[y].source===d&&delete n.tiles[y]})}},{key:"awaitConfiguration",value:function(){return this._configuring}},{key:"_onConfig",value:function(r){var n=this;if((this._isConfigured=!0)!==r.loaded)r.loading=!0,r.loaded=!1,r.error=null,this._loadTileSourceData(r).then(function(){if(n.getTile(r.id)){r.loading=!1,r.loaded=!0;try{Tile.buildGeometry(r,n)}catch(o){r.error=o.toString(),WorkerBroker.postMessage("TileManager_".concat(n.scene_id,".buildTileError"),Tile.slice(r))}}else log("trace","stop tile build after data source load because tile was removed. Key: ".concat(r.key,", id: ").concat(r.id))},function(o){r.loading=!1,r.loaded=!1,r.error=o.stack,log("error","tile load error for tile with key ".concat(r.key," and id ").concat(r.id,": ").concat(r.error)),WorkerBroker.postMessage("TileManager_".concat(n.scene_id,".buildTileError"),Tile.slice(r))});else{log("trace","used worker cache for tile with key ".concat(r.key," and id ").concat(r.id));try{Tile.buildGeometry(r,this)}catch(o){r.error=o.toString(),WorkerBroker.postMessage("TileManager_".concat(this.scene_id,".buildTileError"),Tile.slice(r))}}}},{key:"buildTile",value:function(r){var n,o=r.tile,s=this.getTile(o.id);s&&s.loading||(o=this.tiles[o.id]=Object.assign(s||{},o),this._isConfigured?this._onConfig(o):(n=this).awaitConfiguration().then(function(){return n._onConfig(o)}))}},{key:"_loadTileSourceData",value:function(r){return this.sources[r.source]?this.sources[r.source].load(r):(r.source_data={},Promise.resolve(r))}},{key:"getTile",value:function(r){return this.tiles[r]}},{key:"removeTile",value:function(r){var n=this.tiles[r];n!=null&&(n.loading===!0&&(log("trace","cancel tile load for tile id ".concat(r)),n.loading=!1,Tile.cancel(n)),delete this.tiles[r],log("trace","remove tile from cache, tile id: ".concat(r)))}},{key:"queryFeatures",value:function(r){var n=this,o=r.filter,s=r.visible,l=r.geometry,h=r.tile_ids,d=[],y=h.map(function(g){return n.tiles[g]}).filter(function(g){return g});return o!=null&&(o=-1<["{","["].indexOf(o[0])?JSON.parse(o):o,o=Utils$1.stringsToFunctions(o,StyleParser.wrapFunction)),o=buildFilter(o,FilterOptions),y.forEach(function(g){for(var v in g.source_data.layers)(function(m){g.source_data.layers[m].features.forEach(function(w){var I,V;s===!0&&w.generation!==n._generation||s===!1&&w.generation===n._generation||((I=StyleParser.getFeatureParseContext(w,g,n.global)).source=g.source,I.layer=m,o(I)&&(V={type:w.type,properties:w.properties},l===!0&&(V.geometry=Geo$1.copyGeometry(w.geometry),Geo$1.tileSpaceToLatlng(V.geometry,g.coords.z,g.min)),d.push(V)))})})(v)}),d}},{key:"resetFeatureSelection",value:function(){FeatureSelection.reset()}},{key:"_syncTextures",value:function(r){var n=[];return r&&n.push.apply(n,_toConsumableArray(Object.keys(r))),log("trace","sync textures to worker:",n),0<n.length?this.textureManager.syncTexturesToWorker(n):Promise.resolve()}},{key:"profile",value:function(r){console.profile("worker ".concat(this._worker_id,": ").concat(r))}},{key:"profileEnd",value:function(r){console.profileEnd("worker ".concat(this._worker_id,": ").concat(r))}},{key:"terminate",value:function(){this.dispose()}}]),e}();(Thread.is_worker||self.H&&self.H.DEBUG)&&WorkerBroker.addTarget("self",new SceneWorker);var Scene=function(){function e(r,n){_classCallCheck(this,e),n=n||{},subscribeMixin(this),this.id=e.id++,this.textureManager=getTextureManager(this.id),this.initialized=!1,this.initializing=null,this.sources={},this.view=new View(this,n),this.tile_manager=new TileManager({scene:this,view:this.view}),this.num_workers=n.numWorkers||2,n.disableVertexArrayObjects===!0&&(VertexArrayObject.disabled=!0),Utils$1.device_pixel_ratio=n.devicePixelRatio,this.config=null,this.config_source=r,this.config_bundle=null,this.last_valid_config_source=null,this.styles=null,this.style_manager=new StyleManager,this.building=null,this.dirty=!0,n.preUpdate&&this.subscribe({pre_update:n.preUpdate}),n.postUpdate&&this.subscribe({post_update:n.postUpdate}),this.render_loop=!n.disableRenderLoop,this.render_loop_active=!1,this.render_loop_stop=!1,this.render_count=0,this.last_render_count=0,this.render_count_changed=!1,this.frame=0,this.last_main_render=-1,this.last_selection_render=-1,this.media_capture=new MediaCapture,this.selection=null,this.introspection=n.introspection===!0,this.viewport=n.viewport,this.adjustMeshVariantMaxLife(),this.container=n.container,this.canvas=null,this.contextOptions=n.webGLContextOptions,this.lights=null,this.background=null,this.createListeners(),this.updating=0,this.generation=e.generation,this.last_complete_generation=e.generation,this.log_level=n.logLevel||"warn",log.setLevel(this.log_level),log.reset()}return _createClass(e,[{key:"load",value:function(r,n){var o=this,s=0<arguments.length&&r!==void 0?r:null,l=1<arguments.length&&n!==void 0?n:{};return this.initializing||(log.reset(),this.updating++,this.initialized=!1,this.initial_build_time=null,(l=typeof l=="string"?{base_path:l}:l).blocking=l.blocking===void 0||l.blocking,this.render_loop!==!1&&this.setupRenderLoop(),this.createCanvas(),this.textureManager.destroy(this.gl),this.initializing=this.loadScene(s,l).then(function(){return o.createWorkers()}).then(function(){o.resetFeatureSelection();var h=_typeof(o.config_source)==="object"||o.hasSubscribersFor("load"),d=o.updateConfig({serialize_funcs:h,normalize:!1,load_event:!0,fade_in:!0});if(l.blocking===!0)return d}).then(function(){o.updating--,o.initializing=null,o.initialized=!0,o.last_valid_config_source=o.config_source,o.last_valid_options={base_path:l.base_path,file_type:l.file_type},o.requestRedraw()}).catch(function(h){var d,y;if(o.initializing=null,o.updating=0,y=h.name==="YAMLException"?(d="yaml","Error parsing scene YAML"):"Error initializing scene",o.trigger("error",{type:d,message:y,error:h,url:o.config_source}),y="Scene.load() failed to load ".concat(o.config_source,": ").concat(h.message),o.last_valid_config_source)return log("warn",y,h),log("info","Scene.load() reverting to last valid configuration"),o.load(o.last_valid_config_source,o.last_valid_base_path);throw log("error",y,h),h})),this.initializing}},{key:"destroy",value:function(){var r;this.initialized=!1,this.render_loop_stop=!0,this.destroyListeners(),this.canvas&&this.canvas.parentNode&&(this.canvas.parentNode.removeChild(this.canvas),this.canvas=null),this.container=null,this.selection&&this.selection.destroy(),this.gl&&(this.textureManager.destroy(this.gl),this.style_manager.destroy(this.gl),this.styles={},ShaderProgram.reset(),(r=this.gl.getExtension("WEBGL_lose_context"))&&r.loseContext(),this.gl=null),this.sources={},this.tile_manager.destroy(),this.tile_manager=null,this.destroyWorkers(),log.reset()}},{key:"createCanvas",value:function(){if(!this.canvas){this.container=this.container||document.body,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.top=0,this.canvas.style.left=0,this.container.style.backgroundColor="transparent",this.container.appendChild(this.canvas);try{this.gl=Context$1.getContext(this.canvas,Object.assign({alpha:!0,premultipliedAlpha:!1,stencil:!0,device_pixel_ratio:Utils$1.device_pixel_ratio},this.contextOptions))}catch{throw new Error("Couldn't create WebGL context. Your browser may not support WebGL, or it's turned off? Visit http://webglreport.com/ for more info.")}this.handleViewportUpdate(),VertexArrayObject.init(this.gl),this.render_states=new RenderStateManager(this.gl),this.media_capture.setCanvas(this.canvas,this.gl)}}},{key:"getWorkerUrl",value:function(){var r,n;if(__worker_src__!==void 0&&(n="("+__worker_src__+")()",__worker_src_origin__&&__worker_src_map__!==""&&(n+=`
//# sourceMappingURL=`+__worker_src_origin__.slice(0,__worker_src_origin__.lastIndexOf("/")+1)+__worker_src_map__),r=createObjectURL(new Blob([n],{type:"application/javascript"}))),!r)throw new Error("Couldn't find internal Tangram source variable (may indicate the library did not build correctly)");return r}},{key:"updateExternalScripts",value:function(){var r=_toConsumableArray(this.external_scripts||[]),n=[];if(this.config.scene.scripts)for(var o in this.config.scene.scripts)n.indexOf(this.config.scene.scripts[o])===-1&&n.push(this.config.scene.scripts[o]);for(var s in this.config.sources){var l=this.config.sources[s];if(l.scripts)for(var h in l.scripts)n.indexOf(l.scripts[h])===-1&&n.push(l.scripts[h])}return this.external_scripts=n,!(this.external_scripts.length===r.length&&this.external_scripts.every(function(d,y){return d===r[y]}))}},{key:"createWorkers",value:function(){return this.updateExternalScripts()&&this.destroyWorkers(),this._workers?Promise.resolve():this.makeWorkers(this.getWorkerUrl())}},{key:"makeWorkers",value:function(r){var n=this,o=!!this.gl.getExtension("OES_element_index_uint"),s=[];this._workers=[];for(var l=0;l<this.num_workers;l++)(function(){var d=new Worker(r);n._workers[l]=d,WorkerBroker.addWorker(d),log("debug","Scene.makeWorkers: initializing worker ".concat(l));var y=l;s.push(WorkerBroker.postMessage(d,"self.init",n.id,l,n.log_level,Utils$1.device_pixel_ratio,o,n.external_scripts,n.meshVariantMaxLife).then(function(g){return log("debug","Scene.makeWorkers: initialized worker ".concat(g)),g},function(g){return log("error","Scene.makeWorkers: failed to initialize worker ".concat(y,":"),g),Promise.reject(g)}))})();var h=new SceneWorker;return this._workers.push(h),s.push(h.init(this.id,l,this.log_level,Utils$1.device_pixel_ratio,o,[],this.meshVariantMaxLife)),this.next_worker=0,Promise.all(s).then(function(){log.setWorkers(n._workers.slice(0,n.num_workers)),revokeObjectURL(r)})}},{key:"getWorkers",value:function(r){return this._workers.filter(function(n){switch(r){case WorkerType.NATIVE:return n instanceof Worker;case WorkerType.FAKE:return n instanceof SceneWorker;default:return!0}})}},{key:"destroyWorkers",value:function(){this.selection=null,Array.isArray(this._workers)&&(log.setWorkers(null),this._workers.forEach(function(r){r.terminate()}),this._workers=null)}},{key:"ready",value:function(){return!(!this.view.ready()||Object.keys(this.sources).length===0)}},{key:"handleViewportUpdate",value:function(){var r=this.viewport,n=r.width,o=r.height;0<n&&0<o&&(this.dirty=!0,this.view.handleViewportUpdate(),this.gl&&Context$1.resize(this.gl,n,o,Utils$1.device_pixel_ratio)),this.adjustMeshVariantMaxLife()&&this.syncMeshVariantMaxLife()}},{key:"adjustMeshVariantMaxLife",value:function(){var r=this.viewport,n=r.width,o=r.height,s=Utils$1.device_pixel_ratio,l=n/s/256*(o/s/256),h=Math.max(Math.ceil(2*l),8);if(this.meshVariantMaxLife!==h)return this.meshVariantMaxLife=h,!0}},{key:"syncMeshVariantMaxLife",value:function(){this._workers&&WorkerBroker.postMessage(this._workers,"self.setMeshVariantMaxLife",this.meshVariantMaxLife)}},{key:"requestRedraw",value:function(){this.dirty=!0}},{key:"immediateRedraw",value:function(){this.dirty=!0,this.update()}},{key:"renderLoop",value:function(){this.render_loop_active=!0,this.initialized&&this.update(),Task.setState({user_moving_view:this.view.user_input_active}),Task.processAll(),this.render_loop_stop?(this.render_loop_stop=!1,this.render_loop_active=!1):window.requestAnimationFrame(this.renderLoop.bind(this))}},{key:"setupRenderLoop",value:function(){var r=this;this.render_loop_active||setTimeout(function(){r.renderLoop()},0)}},{key:"update",value:function(){var r=this.dirty,n=!!this.selection&&this.selection.hasPendingRequests(),o=!(r===!1&&n===!1||this.initialized===!1||0<this.updating||this.ready()===!1);return this.trigger("pre_update",o),this.view.update(),o&&(this.dirty=!1,this.render({main:r,selection:n}),this.updateViewComplete(),this.media_capture.completeScreenshot(),this.trigger("post_update",o),this.animated!==!0&&!this.view.isAnimating()||(this.dirty=!0),this.frame++,log("trace","Scene.render()"),!0)}},{key:"render",value:function(r){var n=this,o=r.main,s=r.selection,l=this.gl;if(Object.keys(this.lights).forEach(function(h){return n.lights[h].update()}),o&&(this.render_count=this.renderPass(),this.last_main_render=this.frame),s){if(this.view.panning||this.view.user_input_active)return void this.selection.clearPendingRequests();(this.last_selection_render<this.last_main_render||this.selection.has_dirty_buffer)&&(this.selection.bind(),this.renderPass("selection_program",{allow_blend:!1}),l.bindFramebuffer(l.FRAMEBUFFER,null),l.viewport(0,0,this.canvas.width,this.canvas.height),l.clearColor.apply(l,_toConsumableArray(this.background.color)),this.last_selection_render=this.frame,this.selection.has_dirty_buffer=!1),this.selection.read(this.tile_manager.getRenderableTiles()),this.selection.has_dirty_buffer&&this.render({main:!1,selection:s})}return this.render_count_changed=!1,this.render_count!==this.last_render_count&&(this.render_count_changed=!0),this.last_render_count=this.render_count,!0}},{key:"renderPass",value:function(r,n){var o=this,s=0<arguments.length&&r!==void 0?r:"program",h=(1<arguments.length&&n!==void 0?n:{}).allow_blend,l=this.gl,h=h==null||h;this.clearFrame();for(var d,y=Style.sortByBlendOrderWithinLayers(this.tile_manager.getActiveStyles().map(function(_n){return o.styles[_n]}).filter(function(_n){return _n})),g=0,v=0,m=0;m<y.length;m++){var w,I,V=y[m],q=v-(w=parseInt(V.name));(V.clean_depth||q)&&(this.render_states.depth_write.value.depth_write?l.clear(l.DEPTH_BUFFER_BIT):(l.depthMask(!0),l.clear(l.DEPTH_BUFFER_BIT),l.depthMask(!1)),q&&(v=w)),V.blend!==d&&(I=Object.assign({},Style.render_states[V.blend],{blend:h&&V.blend}),this.setRenderState(I));var De=V.blend==="translucent"&&s==="program";De&&(this.gl.colorMask(!1,!1,!1,!1),this.renderStyle(V.name,s),this.gl.colorMask(!0,!0,!0,!0),this.gl.depthFunc(this.gl.EQUAL),this.gl.enable(this.gl.STENCIL_TEST),this.gl.clear(this.gl.STENCIL_BUFFER_BIT),this.gl.stencilFunc(this.gl.EQUAL,this.gl.ZERO,255),this.gl.stencilOp(this.gl.KEEP,this.gl.KEEP,this.gl.INCR)),g+=this.renderStyle(V.name,s),De&&(this.gl.disable(this.gl.STENCIL_TEST),this.gl.depthFunc(this.gl.LESS)),d=V.blend}return g}},{key:"renderStyle",value:function(r,n){for(var o,s=this,l=this.styles[r],h=!0,d=0,y=this.tile_manager.getRenderableTiles(),g=Math.max.apply(Math,_toConsumableArray(y.map(function(w){return w.meshes[r]?Math.max.apply(Math,_toConsumableArray(w.meshes[r].map(function(I){return I.variant.order}))):-1}))),v=0;v<g+1;v++){var m=function(w){for(var I=0;I<y.length;I++){var V=y[I];if(V.meshes[r]!=null&&V.shouldProxyForStyle(r))for(var q=V.meshes[r].filter(function(ga){return ga.variant.order===w}),De=0,_n=q.length;De<_n;De+=1){var ha=q[De];if(h===!0&&(h=!1,!(o=s.setupStyle(l,n))))return{v:0};s.view.setupTile(V,o),s.selection.setupDiscards(o),l.render(ha)&&s.requestRedraw(),d+=ha.geometry_count}}}(v);if(_typeof(m)==="object")return m.v}return d}},{key:"setupStyle",value:function(r,n){var o;try{if(!(o=r.getProgram(n)))return}catch{return void this.trigger("warning",{type:"styles",message:"Error compiling style ".concat(r.name),style:r,shader_errors:r.program&&r.program.shader_errors})}for(var s in o.use(),r.setup(),this.view.setupProgram(o),this.lights)this.lights[s].setupProgram(o);return o}},{key:"clearFrame",value:function(){this.initialized&&(this.render_states.depth_write.set({depth_write:!0}),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT))}},{key:"setRenderState",value:function(r){var n,o,s=0<arguments.length&&r!==void 0?r:{},l=s.depth_test,h=s.depth_write,d=s.cull_face,y=s.blend;this.initialized&&(n=this.render_states,l=l!==!1&&n.defaults.depth_test,h=h!==!1&&n.defaults.depth_write,d=d!==!1&&n.defaults.culling,y=y??n.defaults.blending,o=this.gl,n.depth_test.set({depth_test:l}),n.depth_write.set({depth_write:h}),n.culling.set({cull:d,face:n.defaults.culling_face}),!y||y==="opaque"?n.blending.set({blend:!1}):y==="overlay"||y==="inlay"||y==="translucent"?n.blending.set({blend:!0,src:o.SRC_ALPHA,dst:o.ONE_MINUS_SRC_ALPHA,src_alpha:o.ONE,dst_alpha:o.ONE_MINUS_SRC_ALPHA}):y==="add"?n.blending.set({blend:!0,src:o.ONE,dst:o.ONE}):y==="multiply"&&n.blending.set({blend:!0,src:o.ZERO,dst:o.SRC_COLOR}))}},{key:"getFeatureAt",value:function(r,n,o){var s,l=n.radius,h=n.top_most_only;this.initialized?(s={x:r.x/this.view.size.css.width,y:r.y/this.view.size.css.height},l=0<l?{x:l/this.view.size.css.width,y:l/this.view.size.css.height}:null,this.selection.getFeatureAt(s,{radius:l,top_most_only:h},o)):log("debug","Scene.getFeatureAt() called before scene was initialized")}},{key:"queryFeatures",value:function(r){var n=0<arguments.length&&r!==void 0?r:{},m=n.filter,o=n.unique,s=o===void 0||o,l=n.group_by,h=l===void 0?null:l,d=n.visible,y=d===void 0?null:d,g=n.geometry,v=g!==void 0&&g,m=Utils$1.serializeWithFunctions(m),w=this.tile_manager.getRenderableTiles().map(function(I){return I.id});return WorkerBroker.postMessage(this._workers,"self.queryFeatures",{filter:m,visible:y,geometry:v,tile_ids:w}).then(function(I){var V=[],q={},De={},_n=(s=typeof s=="string"?[s]:s)&&function(ga){return JSON.stringify(Array.isArray(s)?sliceObject(ga,s):ga)},ha=(h=(typeof h=="string"||Array.isArray(h))&&h)&&function(ga){return Array.isArray(h)?JSON.stringify(sliceObject(ga,h)):ga[h]};return I.forEach(function(ga){return ga.forEach(function(_o){if(_n){var _l=_n(_o);if(q[_l])return;q[_l]=!0}var wc;ha?(wc=ha(_o.properties),De[wc]=De[wc]||[],De[wc].push(_o)):V.push(_o)})}),ha?De:V})}},{key:"loadScene",value:function(r,n){var o=this,s=0<arguments.length&&r!==void 0?r:null,l=1<arguments.length&&n!==void 0?n:{},h=l.base_path,d=l.file_type;return this.config_source=s||this.config_source,typeof this.config_source=="string"?this.base_path=pathForURL(h||this.config_source):this.base_path=pathForURL(h),this.config_path=this.base_path,SceneLoader$1.loadScene(this.config_source,{path:this.base_path,type:d}).then(function(y){var g=y.config,v=y.bundle;return o.config=g,o.config_bundle=v,o.config})}},{key:"createDataSources",value:function(){var r=this,n=[],o=Object.keys(this.sources),s=0;for(var l in this.config.sources){var h=this.config.sources[l],d=this.sources[l];try{var y=Object.assign({},h,{name:l,id:s++});if(this.sources[l]=DataSource.create(y,this.sources),!this.sources[l])throw{}}catch(w){delete this.sources[l];var g="Could not create data source: ".concat(w.message);log("warn","Scene: ".concat(g),h),this.trigger("warning",{type:"sources",source:h,message:g})}DataSource.sameConfig(this.sources[l],d)||n.push(l)}for(var v in o.forEach(function(w){r.config.sources[w]||(delete r.sources[w],n.push(w))}),0<n.length&&this.tile_manager.removeTiles(function(w){return-1<n.indexOf(w.source.name)}),this.config.layers){var m=this.config.layers[v];m.enabled!==!1&&m.data&&this.sources[m.data.source]&&(this.sources[m.data.source].builds_geometry_tiles=!0)}}},{key:"loadTextures",value:function(){var r=this;return this.textureManager.createFromObject(this.gl,this.config.textures).then(function(){return r.textureManager.createDefault(r.gl)})}},{key:"updateStyles",value:function(){if(!this.initialized&&!this.initializing)throw new Error("Scene.updateStyles() called before scene was initialized");for(var r in this.styles=this.style_manager.build(this.config.styles),this.style_manager.initStyles(this),this.styles)this.styles[r].setGL(this.gl);this.dirty=!0}},{key:"createLights",value:function(){for(var r in this.lights={},this.config.lights){var n;this.config.lights[r]&&_typeof(this.config.lights[r])==="object"&&((n=this.config.lights[r]).name=r.replace("-","_"),n.visible=n.visible!==!1,n.visible&&(this.lights[n.name]=Light.create(this.view,n)))}Light.inject(this.lights)}},{key:"setBackground",value:function(){var r,n=this.config.scene.background;this.background={},n&&n.color&&(this.background.color=StyleParser.parseColor(n.color)),this.background.color||(this.background.color=[0,0,0,0]),this.background.color[3]===1?this.canvas.style.backgroundColor="rgba(".concat(this.background.color.map(function(o){return Math.floor(255*o)}).join(", "),")"):this.canvas.style.backgroundColor="transparent",(r=this.gl).clearColor.apply(r,_toConsumableArray(this.background.color))}},{key:"setIntrospection",value:function(r){var n=this;return r!==this.introspection?(this.introspection=r||!1,this.updating++,this.updateConfig({normalize:!1}).then(function(){return n.updating--})):Promise.resolve()}},{key:"updateConfig",value:function(r){var n=0<arguments.length&&r!==void 0?r:{},o=n.load_event,s=o!==void 0&&o,l=n.serialize_funcs,h=n.normalize,d=h===void 0||h;n.fade_in,this.generation=++e.generation,this.updating++,this.config=SceneLoader$1.applyGlobalProperties(this.config),d?SceneLoader$1.normalize(this.config,this.config_bundle):(SceneLoader$1.hoistStyleShaderUniformTextures(this.config,this.config_bundle,{include_globals:!0}),SceneLoader$1.normalizeTextures(this.config,this.config_bundle)),this.trigger(s?"load":"update",{config:this.config}),this.style_manager.init(),this.createLights(),this.createDataSources(),this.loadTextures(),this.setBackground(),FontManager.loadFonts(this.config.fonts),this.updateStyles();var y=this.syncConfigToWorker({serialize_funcs:l});return this.updating--,this.view.updateBounds(),this.requestRedraw(),y}},{key:"syncConfigToWorker",value:function(r){var n=(0<arguments.length&&r!==void 0?r:{}).serialize_funcs,o=n===void 0||n?Utils$1.serializeWithFunctions(this.config):JSON.stringify(this.config);return WorkerBroker.postMessage(this._workers,"self.updateConfig",{config:o,generation:this.generation,introspection:this.introspection},debugSettings$1)}},{key:"createListeners",value:function(){var r=this;this.listeners={},this.listeners.view={move:function(){return r.trigger("move")}},this.view.subscribe(this.listeners.view),this.listeners.texture={update:function(){return r.dirty=!0},warning:function(n){return r.trigger("warning",Object.assign({type:"textures"},n))}},this.textureManager.subscribe(this.listeners.texture),this.listeners.scene_loader={error:function(n){return r.trigger("error",Object.assign({type:"scene"},n))}},SceneLoader$1.subscribe(this.listeners.scene_loader)}},{key:"destroyListeners",value:function(){this.unsubscribeAll(),this.view.unsubscribe(this.listeners.view),this.textureManager.unsubscribe(this.listeners.texture),SceneLoader$1.unsubscribe(this.listeners.scene_loader),this.listeners=null}},{key:"resetFeatureSelection",value:function(){this.selection?this._workers&&WorkerBroker.postMessage(this._workers,"self.resetFeatureSelection"):this.selection=new FeatureSelection(this.gl,this.id)}},{key:"updateViewComplete",value:function(){(this.render_count_changed||this.generation!==this.last_complete_generation)&&this.tile_manager.isReady()&&(this.last_complete_generation=this.generation,this.trigger("view_complete"))}},{key:"resetViewComplete",value:function(){this.last_complete_generation=null}},{key:"screenshot",value:function(r){var n=(0<arguments.length&&r!==void 0?r:{}).background,o=n===void 0?"white":n;return this.requestRedraw(),this.media_capture.screenshot({background:o})}},{key:"pixelRatio",value:function(){return Utils$1.device_pixel_ratio}},{key:"startVideoCapture",value:function(){return this.requestRedraw(),this.media_capture.startVideoCapture()}},{key:"stopVideoCapture",value:function(){return this.media_capture.stopVideoCapture()}},{key:"_profile",value:function(r){console.profile("main thread: ".concat(r)),WorkerBroker.postMessage(this._workers,"self.profile",r)}},{key:"_profileEnd",value:function(r){console.profileEnd("main thread: ".concat(r)),WorkerBroker.postMessage(this._workers,"self.profileEnd",r)}},{key:"getCameraMatrix",value:function(){return this.view.lookAtManipulator.getCameraMatrix()}},{key:"animated",get:function(){var r=this;return this.config.scene.animated!==void 0?this.config.scene.animated:this.tile_manager.getActiveStyles().some(function(n){return r.styles[n]&&r.styles[n].animated})}}],[{key:"create",value:function(r,n){return new e(r,1<arguments.length&&n!==void 0?n:{})}}]),e}();Scene.id=0,Scene.generation=0;var RemoteTexture=function(){_inherits(r,Texture);var e=_createSuper(r);function r(n,o,s){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};_classCallCheck(this,r);var h=Math.pow(2,l.coords.z),d=Math.abs(Math.floor(l.coords.x/h)),y=Math.abs(h*d-Math.abs(l.coords.x)),g=l.coords;return l.coords={x:y,y:g.y,z:g.z},e.call(this,n,o,s,l)}return _createClass(r,[{key:"load",value:function(n){var o=this;if(!n||!n.uid)return _get(_getPrototypeOf(r.prototype),"load",this).call(this,n);var s=n.coords,l=new Uint8Array([0,0,0,0]);return this.loading=new Promise(function(h,d){var y=H.map.DataModel.invoke(n.uid,"requestTileAsPromise",[s.x,s.y,s.z])||null;y?y.then(function(g){var v=g.data;o.loaded=!0,v&&!(v instanceof ArrayBuffer)&&(v.tagName.toUpperCase()==="IMG"||v.tagName.toUpperCase()==="CANVAS")?o.setElement(v,n):o.setData(1,1,l,{filtering:"nearest"})},function(){o.loaded=!1}).then(h,function(g){return d(g)}):d(new Error("Unable to invoke on target "+n.uid))}),this.loading}}]),r}();TextureManager.register(RemoteTexture,function(e){return e&&e.uid}),self.H=self.H||{},self.H.gl={DataSource,Geo:Geo$1,MathUtils:MathUtils$1,Scene,Task,Tile,WorkerBroker,log,SceneLoader:SceneLoader$1,yaml:jsYaml$1}}()};f()}(),this.H=this.H||{},this.H.venues=function(e){function r(_e,G){var k,j,G=(G=G===void 0?{}:G).insertAt;_e&&typeof document<"u"&&(k=document.head||document.getElementsByTagName("head")[0],(j=document.createElement("style")).type="text/css",G==="top"&&k.firstChild?k.insertBefore(j,k.firstChild):k.appendChild(j),j.styleSheet?j.styleSheet.cssText=_e:j.appendChild(document.createTextNode(_e)))}function n(_e,_){var k,j=Object.keys(_e);return Object.getOwnPropertySymbols&&(k=Object.getOwnPropertySymbols(_e),_&&(k=k.filter(function(G){return Object.getOwnPropertyDescriptor(_e,G).enumerable})),j.push.apply(j,k)),j}function o(_e){for(var _=1;_<arguments.length;_++){var k=arguments[_]!=null?arguments[_]:{};_%2?n(Object(k),!0).forEach(function(j){v(_e,j,k[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(k)):n(Object(k)).forEach(function(j){Object.defineProperty(_e,j,Object.getOwnPropertyDescriptor(k,j))})}return _e}function s(){s=function(){return _e};var _e={},_=Object.prototype,k=_.hasOwnProperty,dy=typeof Symbol=="function"?Symbol:{},j=dy.iterator||"@@iterator",G=dy.asyncIterator||"@@asyncIterator",_t=dy.toStringTag||"@@toStringTag";function _r(_d,ly,my){return Object.defineProperty(_d,ly,{value:my,enumerable:!0,configurable:!0,writable:!0}),_d[ly]}try{_r({},"")}catch{_r=function(ly,my,yy){return ly[my]=yy}}function _s(_d,$y,my,Qy){var xy,My,Sy,Jy,$y=$y&&$y.prototype instanceof bc?$y:bc,$y=Object.create($y.prototype),Qy=new ry(Qy||[]);return $y._invoke=(xy=_d,My=my,Sy=Qy,Jy="suspendedStart",function(mg,e0){if(Jy==="executing")throw new Error("Generator is already running");if(Jy==="completed"){if(mg==="throw")throw e0;return Ey()}for(Sy.method=mg,Sy.arg=e0;;){var Fy=Sy.delegate;if(Fy&&(Fy=function By(s0,Uy){var f0=s0.iterator[Uy.method];if(f0===void 0){if(Uy.delegate=null,Uy.method==="throw"){if(s0.iterator.return&&(Uy.method="return",Uy.arg=void 0,By(s0,Uy),Uy.method==="throw"))return Ba;Uy.method="throw",Uy.arg=new TypeError("The iterator does not provide a 'throw' method")}return Ba}return f0=_a(f0,s0.iterator,Uy.arg),f0.type==="throw"?(Uy.method="throw",Uy.arg=f0.arg,Uy.delegate=null,Ba):(f0=f0.arg,f0?f0.done?(Uy[s0.resultName]=f0.value,Uy.next=s0.nextLoc,Uy.method!=="return"&&(Uy.method="next",Uy.arg=void 0),Uy.delegate=null,Ba):f0:(Uy.method="throw",Uy.arg=new TypeError("iterator result is not an object"),Uy.delegate=null,Ba))}(Fy,Sy),Fy)){if(Fy===Ba)continue;return Fy}if(Sy.method==="next")Sy.sent=Sy._sent=Sy.arg;else if(Sy.method==="throw"){if(Jy==="suspendedStart")throw Jy="completed",Sy.arg;Sy.dispatchException(Sy.arg)}else Sy.method==="return"&&Sy.abrupt("return",Sy.arg);if(Jy="executing",Fy=_a(xy,My,Sy),Fy.type==="normal"){if(Jy=Sy.done?"completed":"suspendedYield",Fy.arg===Ba)continue;return{value:Fy.arg,done:Sy.done}}Fy.type==="throw"&&(Jy="completed",Sy.method="throw",Sy.arg=Fy.arg)}}),$y}function _a(_d,ly,my){try{return{type:"normal",arg:_d.call(ly,my)}}catch(yy){return{type:"throw",arg:yy}}}_e.wrap=_s;var Ba={};function bc(){}function sd(){}function ad(){}var dy={},gy=(_r(dy,j,function(){return this}),Object.getPrototypeOf),gy=gy&&gy(gy(uy([]))),ay=(gy&&gy!==_&&k.call(gy,j)&&(dy=gy),ad.prototype=bc.prototype=Object.create(dy));function by(_d){["next","throw","return"].forEach(function(ly){_r(_d,ly,function(my){return this._invoke(ly,my)})})}function py(_d,ly){var my;this._invoke=function(yy,xy){function My(){return new ly(function(Sy,Jy){(function $y(s0,mg,e0,Fy){var By,s0=_a(_d[s0],_d,mg);if(s0.type!=="throw")return(mg=(By=s0.arg).value)&&typeof mg=="object"&&k.call(mg,"__await")?ly.resolve(mg.__await).then(function(Uy){$y("next",Uy,e0,Fy)},function(Uy){$y("throw",Uy,e0,Fy)}):ly.resolve(mg).then(function(Uy){By.value=Uy,e0(By)},function(Uy){return $y("throw",Uy,e0,Fy)});Fy(s0.arg)})(yy,xy,Sy,Jy)})}return my=my?my.then(My,My):My()}}function iy(_d){var ly={tryLoc:_d[0]};1 in _d&&(ly.catchLoc=_d[1]),2 in _d&&(ly.finallyLoc=_d[2],ly.afterLoc=_d[3]),this.tryEntries.push(ly)}function ey(_d){var ly=_d.completion||{};ly.type="normal",delete ly.arg,_d.completion=ly}function ry(_d){this.tryEntries=[{tryLoc:"root"}],_d.forEach(iy,this),this.reset(!0)}function uy(_d){if(_d){var ly,my=_d[j];if(my)return my.call(_d);if(typeof _d.next=="function")return _d;if(!isNaN(_d.length))return ly=-1,(my=function yy(){for(;++ly<_d.length;)if(k.call(_d,ly))return yy.value=_d[ly],yy.done=!1,yy;return yy.value=void 0,yy.done=!0,yy}).next=my}return{next:Ey}}function Ey(){return{value:void 0,done:!0}}return _r(ay,"constructor",sd.prototype=ad),_r(ad,"constructor",sd),sd.displayName=_r(ad,_t,"GeneratorFunction"),_e.isGeneratorFunction=function(_d){return _d=typeof _d=="function"&&_d.constructor,!!_d&&(_d===sd||(_d.displayName||_d.name)==="GeneratorFunction")},_e.mark=function(_d){return Object.setPrototypeOf?Object.setPrototypeOf(_d,ad):(_d.__proto__=ad,_r(_d,_t,"GeneratorFunction")),_d.prototype=Object.create(ay),_d},_e.awrap=function(_d){return{__await:_d}},by(py.prototype),_r(py.prototype,G,function(){return this}),_e.AsyncIterator=py,_e.async=function(_d,ly,my,yy,xy){xy===void 0&&(xy=Promise);var My=new py(_s(_d,ly,my,yy),xy);return _e.isGeneratorFunction(ly)?My:My.next().then(function(Sy){return Sy.done?Sy.value:My.next()})},by(ay),_r(ay,_t,"Generator"),_r(ay,j,function(){return this}),_r(ay,"toString",function(){return"[object Generator]"}),_e.keys=function(_d){var ly,my=[];for(ly in _d)my.push(ly);return my.reverse(),function yy(){for(;my.length;){var xy=my.pop();if(xy in _d)return yy.value=xy,yy.done=!1,yy}return yy.done=!0,yy}},_e.values=uy,ry.prototype={constructor:ry,reset:function(_d){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(ey),!_d)for(var ly in this)ly.charAt(0)==="t"&&k.call(this,ly)&&!isNaN(+ly.slice(1))&&(this[ly]=void 0)},stop:function(){this.done=!0;var _d=this.tryEntries[0].completion;if(_d.type==="throw")throw _d.arg;return this.rval},dispatchException:function(_d){if(this.done)throw _d;var ly=this;function my($y,Qy){return My.type="throw",My.arg=_d,ly.next=$y,Qy&&(ly.method="next",ly.arg=void 0),!!Qy}for(var yy=this.tryEntries.length-1;0<=yy;--yy){var xy=this.tryEntries[yy],My=xy.completion;if(xy.tryLoc==="root")return my("end");if(xy.tryLoc<=this.prev){var Sy=k.call(xy,"catchLoc"),Jy=k.call(xy,"finallyLoc");if(Sy&&Jy){if(this.prev<xy.catchLoc)return my(xy.catchLoc,!0);if(this.prev<xy.finallyLoc)return my(xy.finallyLoc)}else if(Sy){if(this.prev<xy.catchLoc)return my(xy.catchLoc,!0)}else{if(!Jy)throw new Error("try statement without catch or finally");if(this.prev<xy.finallyLoc)return my(xy.finallyLoc)}}}},abrupt:function(_d,ly){for(var my=this.tryEntries.length-1;0<=my;--my){var yy=this.tryEntries[my];if(yy.tryLoc<=this.prev&&k.call(yy,"finallyLoc")&&this.prev<yy.finallyLoc){var xy=yy;break}}var My=(xy=xy&&(_d==="break"||_d==="continue")&&xy.tryLoc<=ly&&ly<=xy.finallyLoc?null:xy)?xy.completion:{};return My.type=_d,My.arg=ly,xy?(this.method="next",this.next=xy.finallyLoc,Ba):this.complete(My)},complete:function(_d,ly){if(_d.type==="throw")throw _d.arg;return _d.type==="break"||_d.type==="continue"?this.next=_d.arg:_d.type==="return"?(this.rval=this.arg=_d.arg,this.method="return",this.next="end"):_d.type==="normal"&&ly&&(this.next=ly),Ba},finish:function(_d){for(var ly=this.tryEntries.length-1;0<=ly;--ly){var my=this.tryEntries[ly];if(my.finallyLoc===_d)return this.complete(my.completion,my.afterLoc),ey(my),Ba}},catch:function(_d){for(var ly=this.tryEntries.length-1;0<=ly;--ly){var my,yy,xy=this.tryEntries[ly];if(xy.tryLoc===_d)return(my=xy.completion).type==="throw"&&(yy=my.arg,ey(xy)),yy}throw new Error("illegal catch attempt")},delegateYield:function(_d,ly,my){return this.delegate={iterator:uy(_d),resultName:ly,nextLoc:my},this.method==="next"&&(this.arg=void 0),Ba}},_e}function l(_e){return(l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(_e)}function h(_e,_,k,j,G,_t,_r){try{var _s=_e[_t](_r),_a=_s.value}catch(Ba){return void k(Ba)}_s.done?_(_a):Promise.resolve(_a).then(j,G)}function d(_e,_){if(!(_e instanceof _))throw new TypeError("Cannot call a class as a function")}function y(_e,_){for(var k=0;k<_.length;k++){var j=_[k];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(_e,j.key,j)}}function g(_e,_,k){return _&&y(_e.prototype,_),k&&y(_e,k),Object.defineProperty(_e,"prototype",{writable:!1}),_e}function v(_e,_,k){return _ in _e?Object.defineProperty(_e,_,{value:k,enumerable:!0,configurable:!0,writable:!0}):_e[_]=k,_e}function m(_e,_){if(typeof _!="function"&&_!==null)throw new TypeError("Super expression must either be null or a function");_e.prototype=Object.create(_&&_.prototype,{constructor:{value:_e,writable:!0,configurable:!0}}),Object.defineProperty(_e,"prototype",{writable:!1}),_&&I(_e,_)}function w(_e){return(w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(_){return _.__proto__||Object.getPrototypeOf(_)})(_e)}function I(_e,_){return(I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(k,j){return k.__proto__=j,k})(_e,_)}function V(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function q(_e,_,k){return(q=V()?Reflect.construct.bind():function(j,G,_t){var _r=[null];return _r.push.apply(_r,G),G=new(Function.bind.apply(j,_r)),_t&&I(G,_t.prototype),G}).apply(null,arguments)}function De(_e,_){if(_e==null)return{};var k,j=function(_r,_s){if(_r==null)return{};for(var _a,Ba={},bc=Object.keys(_r),sd=0;sd<bc.length;sd++)_a=bc[sd],0<=_s.indexOf(_a)||(Ba[_a]=_r[_a]);return Ba}(_e,_);if(Object.getOwnPropertySymbols)for(var G=Object.getOwnPropertySymbols(_e),_t=0;_t<G.length;_t++)k=G[_t],0<=_.indexOf(k)||Object.prototype.propertyIsEnumerable.call(_e,k)&&(j[k]=_e[k]);return j}function _n(_e){if(_e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return _e}function ha(_e){var _=V();return function(){var k,j=w(_e),j=(k=_?(k=w(this).constructor,Reflect.construct(j,arguments,k)):j.apply(this,arguments),this);if(k&&(typeof k=="object"||typeof k=="function"))return k;if(k!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _n(j)}}function ga(){return(ga=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(_e,_,k){var j=function(G,_t){for(;!Object.prototype.hasOwnProperty.call(G,_t)&&(G=w(G))!==null;);return G}(_e,_);if(j)return j=Object.getOwnPropertyDescriptor(j,_),j.get?j.get.call(arguments.length<3?_e:k):j.value}).apply(this,arguments)}function _o(_e,_){return function(k){if(Array.isArray(k))return k}(_e)||function(k,j){var G=k==null?null:typeof Symbol<"u"&&k[Symbol.iterator]||k["@@iterator"];if(G!=null){var _t,_r,_s=[],_a=!0,Ba=!1;try{for(G=G.call(k);!(_a=(_t=G.next()).done)&&(_s.push(_t.value),!j||_s.length!==j);_a=!0);}catch(bc){Ba=!0,_r=bc}finally{try{_a||G.return==null||G.return()}finally{if(Ba)throw _r}}return _s}}(_e,_)||wc(_e,_)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function _l(_e){return function(_){if(Array.isArray(_))return _h(_)}(_e)||function(_){if(typeof Symbol<"u"&&_[Symbol.iterator]!=null||_["@@iterator"]!=null)return Array.from(_)}(_e)||wc(_e)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function wc(_e,_){if(_e){if(typeof _e=="string")return _h(_e,_);var k=Object.prototype.toString.call(_e).slice(8,-1);return(k=k==="Object"&&_e.constructor?_e.constructor.name:k)==="Map"||k==="Set"?Array.from(_e):k==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k)?_h(_e,_):void 0}}function _h(_e,_){(_==null||_>_e.length)&&(_=_e.length);for(var k=0,j=new Array(_);k<_;k++)j[k]=_e[k];return j}r(`.H_l_right .venues-ui__drawings .trigger.button--active .arrow {
  transform: rotate(90deg);
}
.H_l_right .venues-ui__drawings .drawings {
  right: 45px;
  left: initial;
}`);var _p=function(){m(_,H.map.Feature);var _e=ha(_);function _(k){var j;return d(this,_),(j=_e.call(this)).id=k.id,j.model=k,j}return g(_,[{key:"getData",value:function(){return this.model}},{key:"getAddress",value:function(){return this.model.getInternalAddress()}},{key:"getCenter",value:function(){var j=_o(this.model.getCenter(),2),k=j[0],j=j[1];return new H.geo.Point(j,k)}},{key:"getId",value:function(){return this.model.getId()}},{key:"getIdentifier",value:function(){return this.model.getIdentifier()}},{key:"getName",value:function(){return this.model.getDisplayName()}},{key:"toGeoJSON",value:function(){return this.model.toJSON()}},{key:"getLevel",value:function(){return this.getParentEventTarget()}},{key:"getVenue",value:function(){return this.getLevel().getDrawing().getParentEventTarget()}}]),_}(),pd=function(){m(_,H.map.Feature);var _e=ha(_);function _(k){var j;return d(this,_),(j=_e.call(this)).id=k.id,j.model=k,j}return g(_,[{key:"getData",value:function(){return this.model}},{key:"getBoundingBox",value:function(){return q(H.geo.Rect,_l(this.model.getBoundingBox()))}},{key:"getCenter",value:function(){var j=_o(this.model.getCenter(),2),k=j[0],j=j[1];return new H.geo.Point(j,k)}},{key:"getId",value:function(){return this.model.getId()}},{key:"getIdentifier",value:function(){return this.model.getIdentifier()}},{key:"getName",value:function(){return this.model.getDisplayName()}},{key:"getLevel",value:function(k){return this.getLevels().find(function(j){return j.getIdentifier()===k})}},{key:"getLevels",value:function(){var k=this.getData().getLevels().map(function(j){return j.getIdentifier()});return this.getVenue().getLevels().filter(function(j){return k.indexOf(j.id)!==-1})}},{key:"getMainLevel",value:function(){return this.getLevel(this.model.getMainLevel().getIdentifier())}},{key:"getVenue",value:function(){return this.getParentEventTarget()}}]),_}(),oy=function(){m(_,H.map.Feature);var _e=ha(_);function _(k){var j;return d(this,_),(j=_e.call(this)).id=k.id,j.model=k,j}return g(_,[{key:"getGeometry",value:function(k){return this.getGeometries().find(function(j){return j.getIdentifier()===k})}},{key:"getGeometries",value:function(){var k=this.getData().getGeometries().map(function(j){return j.getIdentifier()});return this.getDrawing().getVenue().getGeometries().filter(function(j){return k.indexOf(j.id)!==-1})}},{key:"getData",value:function(){return this.model}},{key:"getId",value:function(){return this.model.getId()}},{key:"getIdentifier",value:function(){return this.model.getIdentifier()}},{key:"getName",value:function(){return this.model.getDisplayName()}},{key:"getShortName",value:function(){return this.model.getShortName()}},{key:"getZIndex",value:function(){return this.model.getZIndex()}},{key:"isMain",value:function(){return this.model.isMain()}},{key:"getDrawing",value:function(){return this.getParentEventTarget()}},{key:"getVenue",value:function(){return this.getDrawing().getParentEventTarget()}}]),_}();function ny(_e,_,k,j){for(var G,_t=j,_r=k-_>>1,_s=k-_,_a=_e[_],Ba=_e[_+1],bc=_e[k],sd=_e[k+1],ad=_+3;ad<k;ad+=3){var dy=function(gy,ay,by,py,iy,ey){var ry=iy-by,uy=ey-py;{var Ey;ry===0&&uy===0||(1<(Ey=((gy-by)*ry+(ay-py)*uy)/(ry*ry+uy*uy))?(by=iy,py=ey):0<Ey&&(by+=ry*Ey,py+=uy*Ey))}return(ry=gy-by)*ry+(uy=ay-py)*uy}(_e[ad],_e[ad+1],_a,Ba,bc,sd);_t<dy?(G=ad,_t=dy):dy===_t&&(dy=Math.abs(ad-_r))<_s&&(G=ad,_s=dy)}j<_t&&(3<G-_&&ny(_e,_,G,j),_e[G+2]=_t,3<k-G&&ny(_e,G,k,j))}function fy(G,_s,k,j){var G={id:G===void 0?null:G,type:_s,geometry:k,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},_t=G,_r=_t.geometry,_s=_t.type;if(_s==="Point"||_s==="MultiPoint"||_s==="LineString")wy(_t,_r);else if(_s==="Polygon"||_s==="MultiLineString")for(var _a=0;_a<_r.length;_a++)wy(_t,_r[_a]);else if(_s==="MultiPolygon")for(_a=0;_a<_r.length;_a++)for(var Ba=0;Ba<_r[_a].length;Ba++)wy(_t,_r[_a][Ba]);return G}function wy(_e,_){for(var k=0;k<_.length;k+=3)_e.minX=Math.min(_e.minX,_[k]),_e.minY=Math.min(_e.minY,_[k+1]),_e.maxX=Math.max(_e.maxX,_[k]),_e.maxY=Math.max(_e.maxY,_[k+1])}function cy(_e,_,k,j){if(_.geometry){var G=_.geometry.coordinates,_t=_.geometry.type,_r=Math.pow(k.tolerance/((1<<k.maxZoom)*k.extent),2),_s=[],_a=_.id;if(k.promoteId?_a=_.properties[k.promoteId]:k.generateId&&(_a=j||0),_t==="Point")Gy(G,_s);else if(_t==="MultiPoint")for(var Ba=0;Ba<G.length;Ba++)Gy(G[Ba],_s);else if(_t==="LineString")jy(G,_s,_r,!1);else if(_t==="MultiLineString"){if(k.lineMetrics){for(Ba=0;Ba<G.length;Ba++)jy(G[Ba],_s=[],_r,!1),_e.push(fy(_a,"LineString",_s,_.properties));return}Wy(G,_s,_r,!1)}else if(_t==="Polygon")Wy(G,_s,_r,!0);else{if(_t!=="MultiPolygon"){if(_t!=="GeometryCollection")throw new Error("Input data is not a valid GeoJSON object.");for(Ba=0;Ba<_.geometry.geometries.length;Ba++)cy(_e,{id:_a,geometry:_.geometry.geometries[Ba],properties:_.properties},k,j);return}for(Ba=0;Ba<G.length;Ba++){var bc=[];Wy(G[Ba],bc,_r,!0),_s.push(bc)}}_e.push(fy(_a,_t,_s,_.properties))}}function Gy(_e,_){_.push(Iy(_e[0])),_.push(vy(_e[1])),_.push(0)}function jy(_e,_,k,j){for(var G,_t,_r=0,_s=0;_s<_e.length;_s++){var _a=Iy(_e[_s][0]),Ba=vy(_e[_s][1]);_.push(_a),_.push(Ba),_.push(0),0<_s&&(_r+=j?(G*Ba-_a*_t)/2:Math.sqrt(Math.pow(_a-G,2)+Math.pow(Ba-_t,2))),G=_a,_t=Ba}var bc=_.length-3;_[2]=1,ny(_,0,bc,k),_[2+bc]=1,_.size=Math.abs(_r),_.start=0,_.end=_.size}function Wy(_e,_,k,j){for(var G=0;G<_e.length;G++){var _t=[];jy(_e[G],_t,k,j),_.push(_t)}}function Iy(_e){return _e/360+.5}function vy(_e){return _e=Math.sin(_e*Math.PI/180),_e=.5-.25*Math.log((1+_e)/(1-_e))/Math.PI,_e<0?0:1<_e?1:_e}function Ty(_e,_,k,j,G,_t,_r,_s){if(j/=_,(k/=_)<=_t&&_r<j)return _e;if(_r<k||j<=_t)return null;for(var _a=[],Ba=0;Ba<_e.length;Ba++){var bc=_e[Ba],sd=bc.geometry,ad=bc.type,dy=G===0?bc.minX:bc.minY,gy=G===0?bc.maxX:bc.maxY;if(k<=dy&&gy<j)_a.push(bc);else if(!(gy<k||j<=dy)){var ay=[];if(ad==="Point"||ad==="MultiPoint"){Ey=uy=ry=ey=iy=py=by=void 0;for(var by=sd,py=ay,iy=k,ey=j,ry=G,uy=0;uy<by.length;uy+=3){var Ey=by[uy+ry];iy<=Ey&&Ey<=ey&&(py.push(by[uy]),py.push(by[uy+1]),py.push(by[uy+2]))}}else if(ad==="LineString")Vy(sd,ay,k,j,G,!1,_s.lineMetrics);else if(ad==="MultiLineString")zy(sd,ay,k,j,G,!1);else if(ad==="Polygon")zy(sd,ay,k,j,G,!0);else if(ad==="MultiPolygon")for(var _d=0;_d<sd.length;_d++){var ly=[];zy(sd[_d],ly,k,j,G,!0),ly.length&&ay.push(ly)}if(ay.length)if(_s.lineMetrics&&ad==="LineString")for(_d=0;_d<ay.length;_d++)_a.push(fy(bc.id,ad,ay[_d],bc.tags));else ad!=="LineString"&&ad!=="MultiLineString"||(ay.length===1?(ad="LineString",ay=ay[0]):ad="MultiLineString"),ad!=="Point"&&ad!=="MultiPoint"||(ad=ay.length===3?"Point":"MultiPoint"),_a.push(fy(bc.id,ad,ay,bc.tags))}}return _a.length?_a:null}function Vy(_e,_,k,j,G,_t,_r){for(var _s,_a,Ba=a0(_e),bc=G===0?k0:_0,sd=_e.start,ad=0;ad<_e.length-3;ad+=3){var ey=_e[ad],ry=_e[ad+1],uy=_e[ad+2],dy=_e[ad+3],gy=_e[ad+4],ay=G===0?ey:ry,by=G===0?dy:gy,py=!1;_r&&(_s=Math.sqrt(Math.pow(ey-dy,2)+Math.pow(ry-gy,2))),ay<k?k<by&&(_a=bc(Ba,ey,ry,dy,gy,k),_r&&(Ba.start=sd+_s*_a)):j<ay?by<j&&(_a=bc(Ba,ey,ry,dy,gy,j),_r&&(Ba.start=sd+_s*_a)):h0(Ba,ey,ry,uy),by<k&&k<=ay&&(_a=bc(Ba,ey,ry,dy,gy,k),py=!0),j<by&&ay<=j&&(_a=bc(Ba,ey,ry,dy,gy,j),py=!0),!_t&&py&&(_r&&(Ba.end=sd+_s*_a),_.push(Ba),Ba=a0(_e)),_r&&(sd+=_s)}var iy=_e.length-3,ey=_e[iy],ry=_e[1+iy],uy=_e[2+iy];k<=(ay=G===0?ey:ry)&&ay<=j&&h0(Ba,ey,ry,uy),iy=Ba.length-3,_t&&3<=iy&&(Ba[iy]!==Ba[0]||Ba[1+iy]!==Ba[1])&&h0(Ba,Ba[0],Ba[1],Ba[2]),Ba.length&&_.push(Ba)}function a0(_e){var _=[];return _.size=_e.size,_.start=_e.start,_.end=_e.end,_}function zy(_e,_,k,j,G,_t){for(var _r=0;_r<_e.length;_r++)Vy(_e[_r],_,k,j,G,_t,!1)}function h0(_e,_,k,j){_e.push(_),_e.push(k),_e.push(j)}function k0(_e,_,k,j,G,_t){return j=(_t-_)/(j-_),_e.push(_t),_e.push(k+(G-k)*j),_e.push(1),j}function _0(_e,_,k,j,G,_t){return G=(_t-k)/(G-k),_e.push(_+(j-_)*G),_e.push(_t),_e.push(1),G}function T0(_e,_){for(var k=[],j=0;j<_e.length;j++){var G=_e[j],_t=G.type;if(_t==="Point"||_t==="MultiPoint"||_t==="LineString")_r=x0(G.geometry,_);else if(_t==="MultiLineString"||_t==="Polygon")for(var _r=[],_s=0;_s<G.geometry.length;_s++)_r.push(x0(G.geometry[_s],_));else if(_t==="MultiPolygon")for(_r=[],_s=0;_s<G.geometry.length;_s++){for(var _a=[],Ba=0;Ba<G.geometry[_s].length;Ba++)_a.push(x0(G.geometry[_s][Ba],_));_r.push(_a)}k.push(fy(G.id,_t,_r,G.tags))}return k}function x0(_e,_){var k=[];k.size=_e.size,_e.start!==void 0&&(k.start=_e.start,k.end=_e.end);for(var j=0;j<_e.length;j+=3)k.push(_e[j]+_,_e[j+1],_e[j+2]);return k}function c0(_e,_){if(!_e.transformed){for(var k,j=1<<_e.z,G=_e.x,_t=_e.y,_r=0;_r<_e.features.length;_r++){var _s=_e.features[_r],_a=_s.geometry,Ba=_s.type;if(_s.geometry=[],Ba===1)for(k=0;k<_a.length;k+=2)_s.geometry.push(_g(_a[k],_a[k+1],_,j,G,_t));else for(k=0;k<_a.length;k++){for(var bc=[],sd=0;sd<_a[k].length;sd+=2)bc.push(_g(_a[k][sd],_a[k][sd+1],_,j,G,_t));_s.geometry.push(bc)}}_e.transformed=!0}return _e}function _g(_e,_,k,j,G,_t){return[Math.round(k*(_e*j-G)),Math.round(k*(_*j-_t))]}function w0(_e,_,k,j,G){for(var _t=_===G.maxZoom?0:G.tolerance/((1<<_)*G.extent),_r={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:k,y:j,z:_,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},_s=0;_s<_e.length;_s++){_r.numFeatures++,ey=iy=py=by=ay=gy=dy=ad=sd=ey=bc=Ba=_a=void 0;var _a=_r,Ba=_e[_s],bc=_t,ey=G,sd=Ba.geometry,ad=Ba.type,dy=[];if(ad==="Point"||ad==="MultiPoint")for(var gy=0;gy<sd.length;gy+=3)dy.push(sd[gy]),dy.push(sd[gy+1]),_a.numPoints++,_a.numSimplified++;else if(ad==="LineString")z0(dy,sd,_a,bc,!1,!1);else if(ad==="MultiLineString"||ad==="Polygon")for(gy=0;gy<sd.length;gy++)z0(dy,sd[gy],_a,bc,ad==="Polygon",gy===0);else if(ad==="MultiPolygon")for(var ay=0;ay<sd.length;ay++){var by=sd[ay];for(gy=0;gy<by.length;gy++)z0(dy,by[gy],_a,bc,!0,gy===0)}if(dy.length){var py=Ba.tags||null;if(ad==="LineString"&&ey.lineMetrics){for(var iy in py={},Ba.tags)py[iy]=Ba.tags[iy];py.mapbox_clip_start=sd.start/sd.size,py.mapbox_clip_end=sd.end/sd.size}ey={geometry:dy,type:ad==="Polygon"||ad==="MultiPolygon"?3:ad==="LineString"||ad==="MultiLineString"?2:1,tags:py},Ba.id!==null&&(ey.id=Ba.id),_a.features.push(ey)}var ey=_e[_s].minX,ry=_e[_s].minY,uy=_e[_s].maxX,Ey=_e[_s].maxY;ey<_r.minX&&(_r.minX=ey),ry<_r.minY&&(_r.minY=ry),uy>_r.maxX&&(_r.maxX=uy),Ey>_r.maxY&&(_r.maxY=Ey)}return _r}function z0(_e,_,k,j,G,_t){var _r=j*j;if(0<j&&_.size<(G?_r:j))k.numPoints+=_.length/3;else{for(var _s=[],_a=0;_a<_.length;_a+=3)(j===0||_[_a+2]>_r)&&(k.numSimplified++,_s.push(_[_a]),_s.push(_[_a+1])),k.numPoints++;if(G){for(var Ba=_s,G=_t,bc=0,sd=0,ad=Ba.length,dy=ad-2;sd<ad;dy=sd,sd+=2)bc+=(Ba[sd]-Ba[dy])*(Ba[sd+1]+Ba[dy+1]);if(0<bc===G)for(sd=0,ad=Ba.length;sd<ad/2;sd+=2){var gy=Ba[sd],ay=Ba[sd+1];Ba[sd]=Ba[ad-2-sd],Ba[sd+1]=Ba[ad-1-sd],Ba[ad-2-sd]=gy,Ba[ad-1-sd]=ay}}_e.push(_s)}}function d0(_a,_){var k=(_=this.options=function(Ba,bc){for(var sd in bc)Ba[sd]=bc[sd];return Ba}(Object.create(this.options),_)).debug;if(k&&console.time("preprocess data"),_.maxZoom<0||24<_.maxZoom)throw new Error("maxZoom should be in the 0-24 range");if(_.promoteId&&_.generateId)throw new Error("promoteId and generateId cannot be used together.");var j,G,_t,_r,_s,_a=function(Ba,bc){var sd=[];if(Ba.type==="FeatureCollection")for(var ad=0;ad<Ba.features.length;ad++)cy(sd,Ba.features[ad],bc,ad);else Ba.type==="Feature"?cy(sd,Ba,bc):cy(sd,{geometry:Ba},bc);return sd}(_a,_);this.tiles={},this.tileCoords=[],k&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",_.indexMaxZoom,_.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),j=_a,G=(_=_).buffer/_.extent,_r=Ty(_t=j,1,-1-G,G,0,-1,2,_),_s=Ty(j,1,1-G,2+G,0,-1,2,_),(_r||_s)&&(_t=Ty(j,1,-G,1+G,0,-1,2,_)||[],_r&&(_t=T0(_r,1).concat(_t)),_s&&(_t=_t.concat(T0(_s,-1)))),(_a=_t).length&&this.splitTile(_a,0,0,0),k&&(_a.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function y0(_e,_,k){return 32*((1<<_e)*k+_)+_e}d0.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},d0.prototype.splitTile=function(_e,_,k,j,G,_t,_r){for(var _s=[_e,_,k,j],_a=this.options,Ba=_a.debug;_s.length;){j=_s.pop(),k=_s.pop(),_=_s.pop(),_e=_s.pop();var bc,sd,ad,dy,gy,ay,by,py,iy,ey=1<<_,ry=y0(_,k,j),uy=this.tiles[ry];if(uy||(1<Ba&&console.time("creation"),uy=this.tiles[ry]=w0(_e,_,k,j,_a),this.tileCoords.push({z:_,x:k,y:j}),Ba&&(1<Ba&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",_,k,j,uy.numFeatures,uy.numPoints,uy.numSimplified),console.timeEnd("creation")),this.stats[ry="z"+_]=(this.stats[ry]||0)+1,this.total++)),uy.source=_e,G){if(_===_a.maxZoom||_===G)continue;var ry=1<<G-_;if(k!==Math.floor(_t/ry)||j!==Math.floor(_r/ry))continue}else if(_===_a.indexMaxZoom||uy.numPoints<=_a.indexMaxPoints)continue;uy.source=null,_e.length!==0&&(1<Ba&&console.time("clipping"),bc=.5-(ry=.5*_a.buffer/_a.extent),ad=1+ry,by=dy=gy=ay=null,py=Ty(_e,ey,k-ry,k+(sd=.5+ry),0,uy.minX,uy.maxX,_a),iy=Ty(_e,ey,k+bc,k+ad,0,uy.minX,uy.maxX,_a),_e=null,py&&(by=Ty(py,ey,j-ry,j+sd,1,uy.minY,uy.maxY,_a),dy=Ty(py,ey,j+bc,j+ad,1,uy.minY,uy.maxY,_a),py=null),iy&&(gy=Ty(iy,ey,j-ry,j+sd,1,uy.minY,uy.maxY,_a),ay=Ty(iy,ey,j+bc,j+ad,1,uy.minY,uy.maxY,_a),iy=null),1<Ba&&console.timeEnd("clipping"),_s.push(by||[],_+1,2*k,2*j),_s.push(dy||[],_+1,2*k,2*j+1),_s.push(gy||[],_+1,2*k+1,2*j),_s.push(ay||[],_+1,2*k+1,2*j+1))}},d0.prototype.getTile=function(_e,_,k){var G=this.options,j=G.extent,G=G.debug;if(_e<0||24<_e)return null;var _t=1<<_e,_t=y0(_e,_=(_%_t+_t)%_t,k);if(this.tiles[_t])return c0(this.tiles[_t],j);1<G&&console.log("drilling down to z%d-%d-%d",_e,_,k);for(var _r,_s=_e,_a=_,Ba=k;!_r&&0<_s;)_s--,_a=Math.floor(_a/2),Ba=Math.floor(Ba/2),_r=this.tiles[y0(_s,_a,Ba)];return _r&&_r.source?(1<G&&console.log("found parent tile z%d-%d-%d",_s,_a,Ba),1<G&&console.time("drilling down"),this.splitTile(_r.source,_s,_a,Ba,_e,_,k),1<G&&console.timeEnd("drilling down"),this.tiles[_t]?c0(this.tiles[_t],j):null):null};function Q0(_e){var _=[],k=_e&&_e.features;if(k)for(var j=0,G=k.length;j<G;j+=1){var _t=k[j],_r=_t.type,_s=void 0,_a=!1;switch(_r){case x_:_s={type:l0.MULTI_POINT,coordinates:_t.geometry.map(function(Ba){return Ba.slice()})};break;case n0:case L0:_s={type:l0.MULTI_LINESTRING,coordinates:_t.geometry.map(function(Ba){return Ba.map(function(bc){return bc.slice()})})},_r===L0&&(_s=function(Ba){for(var bc,sd=[],ad=[],dy=0,gy=Ba.coordinates.length;dy<gy;dy+=1){var ay=Ba.coordinates[dy],by=p0(ay);by!==null&&(by===(bc=bc||by)&&ad.length&&(sd.push(ad),ad=[]),ad.push(ay))}return 0<ad.length&&sd.push(ad),sd.length===1?(Ba.type=l0.POLYGON,Ba.coordinates=sd[0]):1<sd.length?(Ba.type=l0.MULTI_POLYGON,Ba.coordinates=sd):Ba=null,Ba}(_s))==null&&(_a=!0);break;default:_a=!0}_a||_.push({geometry:_s,id:_t.id,properties:_t.tags,type:"Feature"})}return{type:"FeatureCollection",features:_}}function b0(_e,_,_r,j,G){j=j,G=G,_=1<<(_=_),(_t=[])[0]=((_e=_e)[0]/G+_r)/_,_t[1]=(_e[1]/G+j)/_;var _t,_r={x:_t[0],y:_t[1]};return G=(_e=_r).x,_e=_e.y,G=360*(G-.5),j=Math.exp(Math.PI*(.5-_e)/.25)-1,_e=Math.exp(Math.PI*(.5-_e)/.25)+1,[G,180*Math.asin(j/_e)/Math.PI]}var l0={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINESTRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection"},g0={fillColor:"#e0e0e0",outlineColor:"#829DB4",outlineWidth:1},F0={fill:"#333333",size:13},G0={fillColor:"#F2F285",outlineColor:"#0088BF",outlineWidth:1.2},m0=16,A0=18,b_=24,r0={FOOTPRINT:"FOOTPRINT",ICON:"ICON",TEXT:"TEXT",VECTOR:"VECTOR"},l_=Object.freeze({v1:1,v2:2}),x_=1,n0=2,L0=3,M0="CW",u_="CCW",p0=function(_e){return _e=function(_){for(var k=0,j=_.length,G=0;G<j-1;G+=1){var _t=_[G],_r=_[G+1];k+=_t[0]*_r[1]-_r[0]*_t[1]}return k+=_[j-1][0]*_[0][1]-_[0][0]*_[j-1][1]}(_e),0<_e?M0:_e<0?u_:void 0};(function(_e){function _(G){if(j[G])return j[G].exports;var _t=j[G]={i:G,l:!1,exports:{}};return k[G].call(_t.exports,_t,_t.exports,_),_t.l=!0,_t.exports}var k,j;_e.exports=(k=[function(G,_t,sd){function _s(ad){return(_s=typeof Symbol=="function"&&l(Symbol.iterator)=="symbol"?function(dy){return l(dy)}:function(dy){return dy&&typeof Symbol=="function"&&dy.constructor===Symbol&&dy!==Symbol.prototype?"symbol":l(dy)})(ad)}var _a=sd(1),sd=sd(7),Ba=sd.get,bc=(sd.deepValue,sd.isArray),sd=function(){function ad(py,By){var ey=By.location,ey=ey===void 0?0:ey,ry=By.distance,ry=ry===void 0?100:ry,uy=By.threshold,uy=uy===void 0?.6:uy,Ey=By.maxPatternLength,Ey=Ey===void 0?32:Ey,_d=By.caseSensitive,_d=_d!==void 0&&_d,ly=By.tokenSeparator,ly=ly===void 0?/ +/g:ly,my=By.findAllMatches,my=my!==void 0&&my,yy=By.minMatchCharLength,yy=yy===void 0?1:yy,xy=By.id,xy=xy===void 0?null:xy,My=By.keys,My=My===void 0?[]:My,Sy=By.shouldSort,Sy=Sy===void 0||Sy,Jy=By.getFn,Jy=Jy===void 0?Ba:Jy,$y=By.sortFn,$y=$y===void 0?function(s0,Uy){return s0.score-Uy.score}:$y,Qy=By.tokenize,Qy=Qy!==void 0&&Qy,mg=By.matchAllTokens,mg=mg!==void 0&&mg,e0=By.includeMatches,e0=e0!==void 0&&e0,Fy=By.includeScore,Fy=Fy!==void 0&&Fy,By=By.verbose,By=By!==void 0&&By;if(!(this instanceof ad))throw new TypeError("Cannot call a class as a function");this.options={location:ey,distance:ry,threshold:uy,maxPatternLength:Ey,isCaseSensitive:_d,tokenSeparator:ly,findAllMatches:my,minMatchCharLength:yy,id:xy,keys:My,includeMatches:e0,includeScore:Fy,shouldSort:Sy,getFn:Jy,sortFn:$y,verbose:By,tokenize:Qy,matchAllTokens:mg},this.setCollection(py),this._processKeys(My)}for(var dy=ad.prototype,gy=[{key:"setCollection",value:function(py){return this.list=py}},{key:"_processKeys",value:function(py){if(this._keyWeights={},this._keyNames=[],py.length&&typeof py[0]=="string")for(var iy=0,ey=py.length;iy<ey;iy+=1){var ry=py[iy];this._keyWeights[ry]=1,this._keyNames.push(ry)}else{for(var uy=null,Ey=null,_d=0,ly=0,my=py.length;ly<my;ly+=1){var yy=py[ly];if(!yy.hasOwnProperty("name"))throw new Error('Missing "name" property in key object');var xy=yy.name;if(this._keyNames.push(xy),!yy.hasOwnProperty("weight"))throw new Error('Missing "weight" property in key object');if(yy=yy.weight,yy<0||1<yy)throw new Error('"weight" property in key must bein the range of [0, 1)');Ey=Ey==null?yy:Math.max(Ey,yy),uy=uy==null?yy:Math.min(uy,yy),_d+=this._keyWeights[xy]=yy}if(1<_d)throw new Error("Total of weights cannot exceed 1")}}},{key:"search",value:function(ey){var iy=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{limit:!1},ey=(this._log(`---------
Search pattern: "`.concat(ey,'"')),this._prepareSearchers(ey)),ry=ey.tokenSearchers,ey=ey.fullSearcher,ry=this._search(ry,ey);return this._computeScore(ry),this.options.shouldSort&&this._sort(ry),iy.limit&&typeof iy.limit=="number"&&(ry=ry.slice(0,iy.limit)),this._format(ry)}},{key:"_prepareSearchers",value:function(){var py=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",iy=[];if(this.options.tokenize)for(var ey=py.split(this.options.tokenSeparator),ry=0,uy=ey.length;ry<uy;ry+=1)iy.push(new _a(ey[ry],this.options));return{tokenSearchers:iy,fullSearcher:new _a(py,this.options)}}},{key:"_search",value:function(){var py=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],iy=1<arguments.length?arguments[1]:void 0,ey=this.list,ry={},uy=[];if(typeof ey[0]=="string")for(var Ey=0,_d=ey.length;Ey<_d;Ey+=1)this._analyze({key:"",value:ey[Ey],record:Ey,index:Ey},{resultMap:ry,results:uy,tokenSearchers:py,fullSearcher:iy});else for(var ly=0,my=ey.length;ly<my;ly+=1)for(var yy=ey[ly],xy=0,My=this._keyNames.length;xy<My;xy+=1){var Sy=this._keyNames[xy];this._analyze({key:Sy,value:this.options.getFn(yy,Sy),record:yy,index:ly},{resultMap:ry,results:uy,tokenSearchers:py,fullSearcher:iy})}return uy}},{key:"_analyze",value:function(ly,iy){var ey=this,ry=ly.key,uy=ly.arrayIndex,Ey=ly.value,_d=ly.record,ly=ly.index,My=iy.tokenSearchers,my=My===void 0?[]:My,yy=iy.fullSearcher,My=iy.resultMap,xy=My===void 0?{}:My,My=iy.results,Sy=My===void 0?[]:My;(function Jy($y,Qy,mg,e0){if(Qy!=null){if(typeof Qy=="string"){var Fy=!1,By=-1,s0=0,Uy=(ey._log(`
Key: `.concat(ry===""?"--":ry)),yy.search(Qy));if(ey._log('Full text: "'.concat(Qy,'", score: ').concat(Uy.score)),ey.options.tokenize){for(var f0=Qy.split(ey.options.tokenSeparator),S_=f0.length,B0=[],k_=0,J_=my.length;k_<J_;k_+=1){var N_=my[k_];ey._log(`
Pattern: "`.concat(N_.pattern,'"'));for(var j_=!1,L_=0;L_<S_;L_+=1){var a_=f0[L_],P_=N_.search(a_),R_={};P_.isMatch?(R_[a_]=P_.score,j_=Fy=!0,B0.push(P_.score)):(R_[a_]=1,ey.options.matchAllTokens||B0.push(1)),ey._log('Token: "'.concat(a_,'", score: ').concat(R_[a_]))}j_&&(s0+=1)}for(var By=B0[0],D_=B0.length,O_=1;O_<D_;O_+=1)By+=B0[O_];ey._log("Token score average:",By/=D_)}var m_=Uy.score,J0=(ey._log("Score average:",m_=-1<By?(m_+By)/2:m_),!ey.options.tokenize||!ey.options.matchAllTokens||s0>=my.length);ey._log(`
Check Matches: `.concat(J0)),(Fy||Uy.isMatch)&&J0&&(J0={key:ry,arrayIndex:$y,value:Qy,score:m_},ey.options.includeMatches&&(J0.matchedIndices=Uy.matchedIndices),($y=xy[e0])?$y.output.push(J0):(xy[e0]={item:mg,output:[J0]},Sy.push(xy[e0])))}else if(bc(Qy))for(var __=0,Q_=Qy.length;__<Q_;__+=1)Jy(__,Qy[__],mg,e0)}})(uy===void 0?-1:uy,Ey,_d,ly)}},{key:"_computeScore",value:function(py){this._log(`

Computing score:
`);for(var iy=this._keyWeights,ey=!!Object.keys(iy).length,ry=0,uy=py.length;ry<uy;ry+=1){for(var Ey=py[ry],_d=Ey.output,ly=_d.length,my=1,yy=0;yy<ly;yy+=1){var xy=_d[yy],Sy=xy.key,My=ey?iy[Sy]:1,Sy=xy.score===0&&iy&&0<iy[Sy]?Number.EPSILON:xy.score;my*=Math.pow(Sy,My)}Ey.score=my,this._log(Ey)}}},{key:"_sort",value:function(py){this._log(`

Sorting....`),py.sort(this.options.sortFn)}},{key:"_format",value:function(py){var iy,ey=[],ry=(this.options.verbose&&(iy=[],this._log(`

Output:

`,JSON.stringify(py,function(xy,My){if(_s(My)==="object"&&My!==null){if(iy.indexOf(My)!==-1)return;iy.push(My)}return My},2)),iy=null),[]);this.options.includeMatches&&ry.push(function(xy,My){var Sy=xy.output;My.matches=[];for(var Jy=0,$y=Sy.length;Jy<$y;Jy+=1){var Qy,mg=Sy[Jy];mg.matchedIndices.length!==0&&(Qy={indices:mg.matchedIndices,value:mg.value},mg.key&&(Qy.key=mg.key),mg.hasOwnProperty("arrayIndex")&&-1<mg.arrayIndex&&(Qy.arrayIndex=mg.arrayIndex),My.matches.push(Qy))}}),this.options.includeScore&&ry.push(function(xy,My){My.score=xy.score});for(var uy=0,Ey=py.length;uy<Ey;uy+=1){var _d=py[uy];if(this.options.id&&(_d.item=this.options.getFn(_d.item,this.options.id)[0]),ry.length){for(var ly={item:_d.item},my=0,yy=ry.length;my<yy;my+=1)ry[my](_d,ly);ey.push(ly)}else ey.push(_d.item)}return ey}},{key:"_log",value:function(){var py;this.options.verbose&&(py=console).log.apply(py,arguments)}}],ay=0;ay<gy.length;ay++){var by=gy[ay];by.enumerable=by.enumerable||!1,by.configurable=!0,"value"in by&&(by.writable=!0),Object.defineProperty(dy,by.key,by)}return ad}();G.exports=sd},function(G,_t,bc){var _s=bc(2),_a=bc(3),Ba=bc(6),bc=function(){function sd(by,yy){var iy=yy.location,iy=iy===void 0?0:iy,ey=yy.distance,ey=ey===void 0?100:ey,ry=yy.threshold,ry=ry===void 0?.6:ry,uy=yy.maxPatternLength,uy=uy===void 0?32:uy,Ey=yy.isCaseSensitive,Ey=Ey!==void 0&&Ey,_d=yy.tokenSeparator,_d=_d===void 0?/ +/g:_d,ly=yy.findAllMatches,ly=ly!==void 0&&ly,my=yy.minMatchCharLength,my=my===void 0?1:my,yy=yy.includeMatches,yy=yy!==void 0&&yy;if(!(this instanceof sd))throw new TypeError("Cannot call a class as a function");this.options={location:iy,distance:ey,threshold:ry,maxPatternLength:uy,isCaseSensitive:Ey,tokenSeparator:_d,findAllMatches:ly,includeMatches:yy,minMatchCharLength:my},this.pattern=Ey?by:by.toLowerCase(),this.pattern.length<=uy&&(this.patternAlphabet=Ba(this.pattern))}for(var ad=sd.prototype,dy=[{key:"search",value:function(by){var py=this.options,iy=py.isCaseSensitive,py=py.includeMatches;if(iy||(by=by.toLowerCase()),this.pattern===by)return iy={isMatch:!0,score:0},py&&(iy.matchedIndices=[[0,by.length-1]]),iy;var iy=this.options,Ey=iy.maxPatternLength,iy=iy.tokenSeparator;if(this.pattern.length>Ey)return _s(by,this.pattern,iy);var Ey=this.options,iy=Ey.location,ey=Ey.distance,ry=Ey.threshold,uy=Ey.findAllMatches,Ey=Ey.minMatchCharLength;return _a(by,this.pattern,this.patternAlphabet,{location:iy,distance:ey,threshold:ry,findAllMatches:uy,minMatchCharLength:Ey,includeMatches:py})}}],gy=0;gy<dy.length;gy++){var ay=dy[gy];ay.enumerable=ay.enumerable||!1,ay.configurable=!0,"value"in ay&&(ay.writable=!0),Object.defineProperty(ad,ay.key,ay)}return sd}();G.exports=bc},function(G,_t){var _r=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;G.exports=function(_s,Ba){var sd=2<arguments.length&&arguments[2]!==void 0?arguments[2]:/ +/g,Ba=new RegExp(Ba.replace(_r,"\\$&").replace(sd,"|")),bc=_s.match(Ba),sd=!!bc,ad=[];if(sd)for(var dy=0,gy=bc.length;dy<gy;dy+=1){var ay=bc[dy];ad.push([_s.indexOf(ay),ay.length-1])}return{score:sd?.5:1,isMatch:sd,matchedIndices:ad}}},function(G,_t,_r){var _s=_r(4),_a=_r(5);G.exports=function(Ba,bc,sd,ad){for(var dy=ad.location,ay=ad.distance,gy=ay===void 0?100:ay,ay=ad.threshold,py=ad.findAllMatches,by=py!==void 0&&py,py=ad.minMatchCharLength,py=py===void 0?1:py,ad=ad.includeMatches,ad=ad!==void 0&&ad,iy=dy===void 0?0:dy,ey=Ba.length,ry=ay===void 0?.6:ay,uy=Ba.indexOf(bc,iy),Ey=bc.length,_d=[],ly=0;ly<ey;ly+=1)_d[ly]=0;uy!==-1&&(dy=_s(bc,{errors:0,currentLocation:uy,expectedLocation:iy,distance:gy}),ry=Math.min(dy,ry),(uy=Ba.lastIndexOf(bc,iy+Ey))!==-1&&(ay=_s(bc,{errors:0,currentLocation:uy,expectedLocation:iy,distance:gy}),ry=Math.min(ay,ry)));for(var uy=-1,my=[],yy=1,xy=Ey+ey,My=1<<(Ey<=31?Ey-1:30),Sy=0;Sy<Ey;Sy+=1){for(var Jy=0,$y=xy;Jy<$y;)_s(bc,{errors:Sy,currentLocation:iy+$y,expectedLocation:iy,distance:gy})<=ry?Jy=$y:xy=$y,$y=Math.floor((xy-Jy)/2+Jy);var xy=$y,Qy=Math.max(1,iy-$y+1),mg=by?ey:Math.min(iy+$y,ey)+Ey,e0=Array(mg+2);e0[mg+1]=(1<<Sy)-1;for(var Fy=mg;Qy<=Fy;--Fy){var By=Fy-1,s0=sd[Ba.charAt(By)];if(s0&&(_d[By]=1),e0[Fy]=(e0[Fy+1]<<1|1)&s0,Sy!==0&&(e0[Fy]|=(my[Fy+1]|my[Fy])<<1|1|my[Fy+1]),e0[Fy]&My&&(yy=_s(bc,{errors:Sy,currentLocation:By,expectedLocation:iy,distance:gy}))<=ry){if(ry=yy,(uy=By)<=iy)break;Qy=Math.max(1,2*iy-uy)}}if(_s(bc,{errors:Sy+1,currentLocation:iy,expectedLocation:iy,distance:gy})>ry)break;my=e0}return dy={isMatch:0<=uy,score:yy===0?.001:yy},ad&&(dy.matchedIndices=_a(_d,py)),dy}},function(G,_t){G.exports=function(ad,bc){var sd=bc.errors,_a=bc.currentLocation,Ba=bc.expectedLocation,bc=bc.distance,bc=bc===void 0?100:bc,sd=(sd===void 0?0:sd)/ad.length,ad=Math.abs((Ba===void 0?0:Ba)-(_a===void 0?0:_a));return bc?sd+ad/bc:ad?1:sd}},function(G,_t){G.exports=function(){for(var _r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],_s=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,_a=[],Ba=-1,bc=0,sd=_r.length;bc<sd;bc+=1){var ad=_r[bc];ad&&Ba===-1?Ba=bc:ad||Ba===-1||((ad=bc-1)-Ba+1>=_s&&_a.push([Ba,ad]),Ba=-1)}return _r[bc-1]&&_s<=bc-Ba&&_a.push([Ba,bc-1]),_a}},function(G,_t){G.exports=function(_r){for(var _s={},_a=_r.length,Ba=0;Ba<_a;Ba+=1)_s[_r.charAt(Ba)]=0;for(var bc=0;bc<_a;bc+=1)_s[_r.charAt(bc)]|=1<<_a-bc-1;return _s}},function(G,_t){function _r(bc){return Array.isArray?Array.isArray(bc):Object.prototype.toString.call(bc)==="[object Array]"}function _s(bc){if(bc==null)return"";if(typeof bc=="string")return bc;var sd=bc+"";return sd=="0"&&1/bc==-1/0?"-0":sd}function _a(bc){return typeof bc=="string"}function Ba(bc){return typeof bc=="number"}G.exports={get:function(bc,sd){var ad=[];return function dy(gy,ay){if(ay){var by=ay.indexOf("."),py=ay,iy=null,ey=(by!==-1&&(py=ay.slice(0,by),iy=ay.slice(by+1)),gy[py]);if(ey!=null)if(iy||!_a(ey)&&!Ba(ey))if(_r(ey))for(var ry=0,uy=ey.length;ry<uy;ry+=1)dy(ey[ry],iy);else iy&&dy(ey,iy);else ad.push(_s(ey))}else ad.push(gy)}(bc,sd),ad},isArray:_r,isString:_a,isNum:Ba,toString:_s}}],j={},_.m=k,_.c=j,_.d=function(G,_t,_r){_.o(G,_t)||Object.defineProperty(G,_t,{enumerable:!0,get:_r})},_.r=function(G){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(G,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(G,"__esModule",{value:!0})},_.t=function(G,_t){if(1&_t&&(G=_(G)),8&_t||4&_t&&l(G)=="object"&&G&&G.__esModule)return G;var _r=Object.create(null);if(_.r(_r),Object.defineProperty(_r,"default",{enumerable:!0,value:G}),2&_t&&typeof G!="string")for(var _s in G)_.d(_r,_s,(function(_a){return G[_a]}).bind(null,_s));return _r},_.n=function(G){var _t=G&&G.__esModule?function(){return G.default}:function(){return G};return _.d(_t,"a",_t),_t},_.o=function(G,_t){return Object.prototype.hasOwnProperty.call(G,_t)},_.p="",_(_.s=0))})(Ny={exports:{}});var Ny=Ny.exports,_m=(Cy=Ny)&&Cy.__esModule&&Object.prototype.hasOwnProperty.call(Cy,"default")?Cy.default:Cy,D0=(Ny.Fuse,g(function _e(_r){var k=_r.addressList,k=k===void 0?[]:k,j=_r.geometries,j=j===void 0?[]:j,G=_r.entity,G=G===void 0?null:G,_t=_r.name,_t=_t===void 0?"":_t,_r=_r.icon,_r=_r===void 0?"":_r;d(this,_e),this.addressList=k,this.geometries=j,this.icon=_r,this.entity=G,this.name=_t})),_y={keys:[{name:"name",weight:.6},{name:"addressList",weight:.4}],threshold:.2},t_=function(){function _e(_){d(this,_e),this.fuseSearch=null,this.levels_=null,this.searchListEntities_=[],this.searchListIcons_=[],this.searchList_=[],this.venueModel=_,this.init()}return g(_e,[{key:"init",value:function(){var _=this.venueModel.getGeometries().reduce(function(k,j){return k[j.getId()]=j,k},{}),_=(this.initEntityList(this.venueModel.getOccupant()),this.initIconList(_),this.levels_=this.venueModel.getLevels().map(function(k){return{levelId:k.getId(),levelName:k.getName(),drawingId:k.getDrawing().getId(),drawingName:k.getDrawing().getName()}}),[].concat(_l(this.searchListEntities_),_l(this.searchListIcons_)));this.searchList_=_.sort(function(k,j){return k.name.localeCompare(j.name)}),this.fuseSearch_=new _m(this.searchList_,_y)}},{key:"initEntityList",value:function(){var _=(0<arguments.length&&arguments[0]!==void 0?arguments[0]:[]).map(function(k){return k.spaceIds?new D0({geometries:k.space,addressList:k.spaceIds||[],name:k.properties.name||"",entity:k}):null}).filter(function(k){return k!==null});this.searchListEntities_=_}},{key:"initIconList",value:function(){this.searchListIcons_=Object.values(0<arguments.length&&arguments[0]!==void 0?arguments[0]:{}).filter(function(_){return _.isIcon()}).map(function(_){var k=_.getIcon();return new D0({geometries:[_],icon:k,name:_.properties.name||""})})}},{key:"all",value:function(){return this.searchList_}},{key:"allIconTypes",value:function(){var _=this.searchListIcons_.reduce(function(k,j){return k[j.name]=j.name,k},{});return Object.keys(_)}},{key:"find",value:function(){var _=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"";return _===""?this.searchList_:this.fuseSearch_.search(_)}}]),_e}(),P0=Object.freeze({SITE:"SITE",IMAGES:"IMAGES",THEME:"THEME"}),H0="indoor.Site",$0="indoor.Structure",V0="indoor.Occupant",U0="indoor.Space",c_="indoor.SpaceGroups",e_="Address",h_="indoor.Level",W0="indoor.Entrance",r_="OCCUPANT_NAMES",p_="SPACE_NAME",f_="INTERNAL_ADDRESS_SHORT",N0="INTERNAL_ADDRESS",d_="INTERNAL_ADDRESS_LONG",Y0="SPACE_TYPE_NAME",i_="SPACE_CATEGORY_NAME",q0="Point",v0="LineString",o0="Polygon",X0="MultiPoint",K0="MultiLineString",Z0="MultiPolygon",j0=Object.freeze({STANDARD:"STANDARD",FLATTEN:"FLATTEN",OUTDOOR_MAIN:"OUTDOOR_MAIN",INDOOR_MAIN:"INDOOR_MAIN",NO_OUTDOORS:"NO_OUTDOORS",FLATTEN_INDOOR_MAIN:"FLATTEN_INDOOR_MAIN",FLATTEN_OUTDOOR_COPY:"FLATTEN_OUTDOOR_COPY"}),n_="9999999999999",$="icons",_i="config",Fa="https://interactive.data.api.platform.here.com/interactive/v1/catalogs",Cy=Object.freeze({THEME:"THEME",THEME_MAP:"THEME_MAP",PRESETS:"PRESETS",SDK_STRINGS:"SDK_STRINGS",ICON_FILE:"ICON_FILE",INPUT_COLORS:"INPUT_COLORS",BASE_MAP_INFO:"BASE_MAP_INFO",CONFIG_PROFILE:"CONFIG_PROFILE",NAV_THEME:"NAV_THEME",NAV_NAME_THEME:"NAV_NAME_THEME",NAV_PROP_MAP:"NAV_PROP_MAP",NAV_STRINGS:"NAV_STRINGS",NAV_THEME_MAP:"NAV_THEME_MAP",NAV_NAME_THEME_MAP:"NAV_NAME_THEME_MAP",V4_THEME_FAMILY:"V4_THEME_FAMILY",V4_MAPTYPE_THEME:"V4_MAPTYPE_THEME",ICON:"ICON",MARKER:"MARKER",PERMISSIONS:"PERMISSIONS",NAICS_ARRAY:"NAICS_ARRAY",NAICS_MAP:"NAICS_MAP"}),Cy=(Object.freeze((v(Ny={},Cy.THEME,"themeUrls"),v(Ny,Cy.THEME_MAP,"themeMapUrl"),v(Ny,Cy.PRESETS,"presetsUrl"),v(Ny,Cy.SDK_STRINGS,"stringsUrl"),Ny)),Object.freeze((v(Ny={},Cy.THEME,"themeOverrides"),v(Ny,Cy.THEME_MAP,"themeMapOverrides"),v(Ny,Cy.PRESETS,"presetOverrides"),v(Ny,Cy.SDK_STRINGS,"stringsOverrides"),v(Ny,Cy.INPUT_COLORS,"inputColorOverrides"),Ny)),Object.freeze((v(Ny={},Cy.THEME,["Modern","Standard","Factory","Navteq","TheBase","Westfield_noLabels","Westfield","TDM_noLabel"]),v(Ny,Cy.SDK_STRINGS,["Standard","SDK","sdk/standard"]),v(Ny,Cy.V4_THEME_FAMILY,["modern","standard"]),v(Ny,Cy.V4_MAPTYPE_THEME,["Airport Terminal","Airport","Casino","College Building","College Campus","Convention","General","Hospital","Outdoor","Retail","School Building","School Campus","Shopping Mall","Traffic","Train Station"]),v(Ny,Cy.NAV_THEME,["Factory","MapEditor"]),v(Ny,Cy.ICON,["Multicolor","Standard","TheBase","Factory"]),Ny)),Object.freeze((v(Ny={},Cy.THEME,"Modern"),v(Ny,Cy.THEME_MAP,"Standard"),v(Ny,Cy.PRESETS,"Standard"),v(Ny,Cy.SDK_STRINGS,"Standard"),v(Ny,Cy.ICON_FILE,"Standard"),v(Ny,Cy.INPUT_COLORS,"Standard"),v(Ny,Cy.BASE_MAP_INFO,"Standard"),v(Ny,Cy.CONFIG_PROFILE,"factory"),v(Ny,Cy.NAV_THEME,"Factory"),v(Ny,Cy.NAV_NAME_THEME,"FactoryName"),v(Ny,Cy.NAV_PROP_MAP,"Standard"),v(Ny,Cy.NAV_STRINGS,"Standard"),v(Ny,Cy.NAV_THEME_MAP,"Standard"),v(Ny,Cy.NAV_NAME_THEME_MAP,"StandardName"),v(Ny,Cy.V4_THEME_FAMILY,"Standard"),v(Ny,Cy.V4_MAPTYPE_THEME,"Standard"),v(Ny,Cy.ICON,"Multicolor"),v(Ny,Cy.MARKER,"Standard"),Ny)),Object.freeze({GEO_JSON:"GEO_JSON",V5_MAP:"V5_MAP",V5_NAV:"V5_NAV",V5_INFO:"V5_INFO",KML:"KML",SVG:"SVG",PNG:"PNG"})),_u=(Object.freeze(v({},Cy.GEO_JSON,{COMMUNITY_MAP:"COMMUNITY_MAP",COMMUNITY_ENTITY:"COMMUNITY_ENTITY",PATH_LEVEL_GEOMETRY:"PATH_LEVEL_GEOMETRY",GEOJSON_LEVEL_GEOMETRY:"GEOJSON_LEVEL_GEOMETRY"})),Object.freeze({ACCOUNT_API:"ACCOUNT_API",DEFAULT_COLLECTION:"DEFAULT_COLLECTION",CATALOG_LAYER:"CATALOG_LAYER"})),_c=Object.freeze((v(Ny={},_u.ACCOUNT_API,{BASE_URL:"https://account.api.here.com/authorization/v1.1/projects/me"}),v(Ny,_u.DEFAULT_COLLECTION,{BASE_URL:"https://config.data.api.platform.here.com/config/v1/catalogs",PARAMS:{CREATED_BY:"created",COLLECTION:"-collection"}}),v(Ny,_u.CATALOG_LAYER,{BASE_URL:"https://interactive.data.api.platform.here.com/interactive/v1/catalogs",MOMDATA_LAYER:"9999999999999",ICON_LAYER:"icons",THEMERULE_LAYER:"config",COLLECTION_LAYER:"layers/9999999999999/search",PARAMS:{FEATURE_TYPE:{KEY:"p.featureType",VALUE:"indoor.Site"}}}),Ny)),_f=Object.freeze({isIconsEnabled:!0,isMetaEnabled:!0,metaOptions:{},iconOptions:{}}),sy=Object.freeze({GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE",PATCH:"PATCH",OPTIONS:"OPTIONS",HEAD:"HEAD"});function ty(){}function hy(){hy.init.call(this)}function Ay(_e){return _e._maxListeners===void 0?hy.defaultMaxListeners:_e._maxListeners}function ky(_e,_,k,j){var G,_t;if(typeof k!="function")throw new TypeError('"listener" argument must be a function');return(G=_e._events)?(G.newListener&&(_e.emit("newListener",_,k.listener||k),G=_e._events),_t=G[_]):(G=_e._events=new ty,_e._eventsCount=0),_t?(typeof _t=="function"?_t=G[_]=j?[k,_t]:[_t,k]:j?_t.unshift(k):_t.push(k),_t.warned||(j=Ay(_e))&&0<j&&_t.length>j&&(_t.warned=!0,(j=new Error("Possible EventEmitter memory leak detected. "+_t.length+" "+_+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",j.emitter=_e,j.type=_,j.count=_t.length,j=j,typeof console.warn=="function"?console.warn(j):console.log(j))):(_t=G[_]=k,++_e._eventsCount),_e}function Ly(_e,_,k){var j=!1;function G(){_e.removeListener(_,G),j||(j=!0,k.apply(_e,arguments))}return G.listener=k,G}function Hy(_e){var _=this._events;if(_){if(_=_[_e],typeof _=="function")return 1;if(_)return _.length}return 0}function Yy(_e,_){for(var k=new Array(_);_--;)k[_]=_e[_];return k}ty.prototype=Object.create(null),(hy.EventEmitter=hy).usingDomains=!1,hy.prototype.domain=void 0,hy.prototype._events=void 0,hy.prototype._maxListeners=void 0,hy.defaultMaxListeners=10,hy.init=function(){this.domain=null,hy.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new ty,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},hy.prototype.setMaxListeners=function(_e){if(typeof _e!="number"||_e<0||isNaN(_e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=_e,this},hy.prototype.getMaxListeners=function(){return Ay(this)},hy.prototype.emit=function(_e){var _,k,j,G=_e==="error",_t=this._events;if(_t)G=G&&_t.error==null;else if(!G)return!1;if(_r=this.domain,G){var _r,G=arguments[1];if(_r)return(G=G||new Error('Uncaught, unspecified "error" event')).domainEmitter=this,G.domain=_r,G.domainThrown=!1,_r.emit("error",G),!1;throw G instanceof Error?G:((_r=new Error('Uncaught, unspecified "error" event. ('+G+")")).context=G,_r)}if(!(_=_t[_e]))return!1;var _s,_a=typeof _=="function";switch(_s=arguments.length){case 1:var gy=_,dy=_a,Ba=this;if(dy)gy.call(Ba);else for(var bc=gy.length,sd=Yy(gy,bc),ad=0;ad<bc;++ad)sd[ad].call(Ba);break;case 2:var dy=_,gy=_a,ay=this,by=arguments[1];if(gy)dy.call(ay,by);else for(var py=dy.length,iy=Yy(dy,py),ey=0;ey<py;++ey)iy[ey].call(ay,by);break;case 3:var xy=_,yy=_a,ry=this,uy=arguments[1],Ey=arguments[2];if(yy)xy.call(ry,uy,Ey);else for(var _d=xy.length,ly=Yy(xy,_d),my=0;my<_d;++my)ly[my].call(ry,uy,Ey);break;case 4:var yy=_,xy=_a,My=this,Sy=arguments[1],Jy=arguments[2],$y=arguments[3];if(xy)yy.call(My,Sy,Jy,$y);else for(var Qy=yy.length,mg=Yy(yy,Qy),e0=0;e0<Qy;++e0)mg[e0].call(My,Sy,Jy,$y);break;default:for(k=new Array(_s-1),j=1;j<_s;j++)k[j-1]=arguments[j];var Fy=_,By=_a,s0=this,Uy=k;if(By)Fy.apply(s0,Uy);else for(var f0=Fy.length,S_=Yy(Fy,f0),B0=0;B0<f0;++B0)S_[B0].apply(s0,Uy)}return!0},hy.prototype.on=hy.prototype.addListener=function(_e,_){return ky(this,_e,_,!1)},hy.prototype.prependListener=function(_e,_){return ky(this,_e,_,!0)},hy.prototype.once=function(_e,_){if(typeof _!="function")throw new TypeError('"listener" argument must be a function');return this.on(_e,Ly(this,_e,_)),this},hy.prototype.prependOnceListener=function(_e,_){if(typeof _!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(_e,Ly(this,_e,_)),this},hy.prototype.removeListener=function(_e,_){var k,j,G,_t,_r;if(typeof _!="function")throw new TypeError('"listener" argument must be a function');if((j=this._events)&&(k=j[_e])){if(k===_||k.listener&&k.listener===_)--this._eventsCount==0?this._events=new ty:(delete j[_e],j.removeListener&&this.emit("removeListener",_e,k.listener||_));else if(typeof k!="function"){for(G=-1,_t=k.length;0<_t--;)if(k[_t]===_||k[_t].listener&&k[_t].listener===_){_r=k[_t].listener,G=_t;break}if(G<0)return this;if(k.length===1){if(k[0]=void 0,--this._eventsCount==0)return this._events=new ty,this;delete j[_e]}else{for(var _s=k,_a=G,Ba=_a+1,bc=_s.length;Ba<bc;_a+=1,Ba+=1)_s[_a]=_s[Ba];_s.pop()}j.removeListener&&this.emit("removeListener",_e,_r||_)}}return this},hy.prototype.removeAllListeners=function(_e){var _,k=this._events;if(k){if(!k.removeListener)return arguments.length===0?(this._events=new ty,this._eventsCount=0):k[_e]&&(--this._eventsCount==0?this._events=new ty:delete k[_e]),this;if(arguments.length===0){for(var j,G=Object.keys(k),_t=0;_t<G.length;++_t)(j=G[_t])!=="removeListener"&&this.removeAllListeners(j);return this.removeAllListeners("removeListener"),this._events=new ty,this._eventsCount=0,this}if(typeof(_=k[_e])=="function")this.removeListener(_e,_);else if(_)for(;this.removeListener(_e,_[_.length-1]),_[0];);}return this},hy.prototype.listeners=function(k){var _=this._events,k=_&&(_=_[k])?typeof _=="function"?[_.listener||_]:function(j){for(var G=new Array(j.length),_t=0;_t<G.length;++_t)G[_t]=j[_t].listener||j[_t];return G}(_):[];return k},hy.listenerCount=function(_e,_){return typeof _e.listenerCount=="function"?_e.listenerCount(_):Hy.call(_e,_)},hy.prototype.listenerCount=Hy,hy.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]};function i0(_e,_,k){return k===g_.ObjectType.SEGMENT_START_MARKER?_e===0?K_:null:k===g_.ObjectType.SEGMENT_FINISH_MARKER?_.length===1||_e===_.length-1?Z_:null:_[_e].departure.place.type==="indoor"?Y_:X_}var Ry="venues-ui-button--active",Oy="venues-ui-button",Py="venues-ui__drawings",Dy="data-drawing",Xy=function(){function _e(_,k,_r){var G=this,_t=(d(this,_e),this.clickHandler=_r,this.containerDiv=document.createElement("div"),this.containerDiv.setAttribute("class",Py),document.createElement("div")),_r=(_t.setAttribute("class","trigger ".concat(Oy)),document.createElement("div"));_r.setAttribute("class","arrow arrow--down"),_t.appendChild(_r),_t.addEventListener("click",function(){_t.classList.toggle(Ry),G.containerButtons.classList.toggle("drawings--open")}),this.containerDiv.appendChild(_t),this.containerButtons=document.createElement("div"),this.containerButtons.setAttribute("class","drawings"),this.containerDiv.appendChild(this.containerButtons),k&&this.update(k),_.appendChild(this.containerDiv)}return g(_e,[{key:"drawButton",value:function(_,k,_r){var G=this,_t=document.createElement("div"),_r=Number(_r)===Number(_);_t.setAttribute("class",_r?"".concat(Oy," ").concat(Ry):Oy),_t.innerHTML=k,_t.setAttribute(Dy,_),_t.addEventListener("click",function(){G.switch(_),G.clickHandler(_)}),this.containerButtons.appendChild(_t)}},{key:"switch",value:function(_){this.containerButtons.querySelectorAll(".".concat(Py," .").concat(Ry)).forEach(function(k){return k.setAttribute("class",Oy)}),_=this.containerButtons.querySelector("[".concat(Dy,"='").concat(_,"']")),_&&_.setAttribute("class","".concat(Oy," ").concat(Ry))}},{key:"update",value:function(_){var k=this,j=(this.containerButtons.innerHTML="",function(G){return G=G.getDrawings(),new Map(G.map(function(_t){var _r=_t.getDisplayName()||_t.getName();return[_t.getId(),_r]}))}(_));0<j.size&&j.forEach(function(G,_t){return k.drawButton(_t,G,_.getRootDrawing().getId())})}}]),_e}(),_v="venues-ui-button--active",Ky="venues-ui-button",Zy="data-level",qy="venues-ui__levels",S0=function(){function _e(_,k,j,G){var _t=4<arguments.length&&arguments[4]!==void 0?arguments[4]:4;d(this,_e),this.clickHandler=G,this.levelButtonCount=_t,this.currentScrollIndex=0,this.containerUI=document.createElement("div"),this.containerUI.setAttribute("class","".concat(qy)),this.containerButtons=document.createElement("div"),this.containerButtons.setAttribute("class","levels"),this.containerUI.appendChild(this.containerButtons),k&&this.update(k,j),_.appendChild(this.containerUI)}return g(_e,[{key:"clear",value:function(){this.containerButtons.innerHTML="",this.buttonScrollUp&&(this.containerUI.removeChild(this.buttonScrollUp),this.buttonScrollUp=null),this.buttonScrollDown&&(this.containerUI.removeChild(this.buttonScrollDown),this.buttonScrollDown=null)}},{key:"drawLevelButton",value:function(_,k){var j=this,G=document.createElement("div");G.innerHTML=k,G.style.fontSize="".concat(Math.max(Math.min(28.8/k.length,11.52),10),"px"),G.style.display="block",G.setAttribute("class",Ky),G.setAttribute(Zy,_),G.addEventListener("click",function(){j.switch(_),j.clickHandler(_)}),this.containerButtons.appendChild(G)}},{key:"drawScrollButtons",value:function(){var _=this,k=(this.buttonScrollUp=document.createElement("div"),this.buttonScrollUp.setAttribute("class","".concat(Ky," ").concat(Ky,"--up")),document.createElement("div")),k=(k.setAttribute("class","arrow arrow--up"),this.buttonScrollUp.appendChild(k),this.buttonScrollUp.addEventListener("click",function(){return _.scroll(1)}),this.containerUI.insertBefore(this.buttonScrollUp,this.containerButtons),this.buttonScrollDown=document.createElement("div"),this.buttonScrollDown.setAttribute("class","".concat(Ky," ").concat(Ky,"--down")),document.createElement("div"));k.setAttribute("class","arrow arrow--down"),this.buttonScrollDown.appendChild(k),this.buttonScrollDown.addEventListener("click",function(){return _.scroll(-1)}),this.containerUI.appendChild(this.buttonScrollDown)}},{key:"scroll",value:function(){var _,k,j=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,G=Array.from(this.containerButtons.querySelectorAll(".".concat(Ky))).reverse(),_t=[];0<=j?(this.currentScrollIndex=Math.min(this.currentScrollIndex+j,G.length-this.levelButtonCount),_=Math.min(this.currentScrollIndex,G.length-this.levelButtonCount),k=Math.min(this.currentScrollIndex+this.levelButtonCount,G.length),_t=G.slice(_,k)):j<0&&(this.currentScrollIndex=Math.max(this.currentScrollIndex+j,0),_=Math.max(0,this.currentScrollIndex),k=Math.min(G.length,this.currentScrollIndex+this.levelButtonCount),_t=G.slice(_,k)),G.forEach(function(_r){_t.indexOf(_r)!==-1?_r.style.display="block":_r.style.display="none"}),this.buttonScrollDown&&(this.currentScrollIndex===0?this.buttonScrollDown.setAttribute("disabled","disabled"):this.buttonScrollDown.removeAttribute("disabled")),this.buttonScrollUp&&(this.currentScrollIndex===G.length-this.levelButtonCount?this.buttonScrollUp.setAttribute("disabled","disabled"):this.buttonScrollUp.removeAttribute("disabled"))}},{key:"switch",value:function(j){this.containerButtons.querySelectorAll(".".concat(_v)).forEach(function(G){return G.setAttribute("class",Ky)});var k,j=this.containerButtons.querySelector(".".concat(qy," [").concat(Zy,"='").concat(j,"']"));j&&(k=Array.from(this.containerButtons.querySelectorAll(".".concat(Ky))).reverse(),j.setAttribute("class","".concat(Ky," ").concat(_v)),((k=k.indexOf(j))<this.currentScrollIndex||k>=this.currentScrollIndex+4)&&this.scroll(k-this.currentScrollIndex))}},{key:"update",value:function(_,_t){var j,G=this,_t=function(){return new Map((0<arguments.length&&arguments[0]!==void 0?arguments[0]:[]).map(function(_s){return[_s.getZIndex(),_s.getShortName()||_s.getDisplayName()||_s.getName()]}))}((j=_,((_t=_t)===j0.FLATTEN?(_t=j.getVenueModel().getLevelMapFlattenedByZIndex_(),Object.values(_t).map(function(_s){return _s[0]})):j.getLevels()).sort(function(_s,_a){return _a.getZIndex()-_s.getZIndex()}))),_r=_.getMainLevel().getZIndex();this.clear(),_t.forEach(function(_s,_a){return G.drawLevelButton(_a,_s)}),_t.size>this.levelButtonCount&&(_t.size>this.levelButtonCount+1?this.currentScrollIndex=Math.min(Array.from(_t).reverse().findIndex(function(_s){return _s[0]===_r}),_t.size-this.levelButtonCount):this.currentScrollIndex=0,this.drawScrollButtons(),this.scroll(0)),this.switch(_r)}}]),_e}(),u0=function(){function _e(_,k){d(this,_e),this.baseTheme=_,this.metaInformation=k,this.labelStyleMap={},this.styleMap={},this.setStyleMap()}return g(_e,[{key:"setStyleMap",value:function(){this.styleMap.ENTRANCE=this.baseTheme.entranceRules.default.styleProperties,this.labelStyleMap.ENTRANCE=this.baseTheme.entranceRules.default.textLabelStyleProperties;for(var _=0,k=Object.entries(this.baseTheme.spaceRules);_<k.length;_++){var G=_o(k[_],2),j=G[0],G=G[1],_t=G.properties.behavioralAppearance.default.styleProperties,_r=G.properties.behavioralAppearance.default.textLabelStyleProperties;if(this.styleMap[j]=_t,this.labelStyleMap[j]=_r,G.spaceTypes)for(var _s=0,_a=Object.entries(G.spaceTypes);_s<_a.length;_s++){var sd=_o(_a[_s],2),Ba=sd[0],sd=sd[1],bc=sd.behavioralAppearance.default.styleProperties,sd=sd.behavioralAppearance.default.textLabelStyleProperties;this.styleMap["".concat(j,"_").concat(Ba)]=bc&&Object.keys(bc)!==0?bc:_t,this.labelStyleMap["".concat(j,"_").concat(Ba)]=sd&&Object.keys(sd)!==0?sd:_r}}}},{key:"getBaseTheme",value:function(){return this.baseTheme}},{key:"getStyleMap",value:function(){return this.styleMap}},{key:"getGeometryStyle",value:function(_){return this.styleMap&&Object.getOwnPropertyNames(this.styleMap)?this.styleMap[_]:null}},{key:"getLabelStyle",value:function(_){return this.labelStyleMap&&Object.getOwnPropertyNames(this.labelStyleMap)?this.labelStyleMap[_]:null}}],[{key:"getGeometryDefaultStyle",value:function(){return{fill:"#e5e5e5",fillOpacity:1,stroke:"#6c7a89",strokeOpacity:1,strokeWidth:2}}},{key:"getLabelDefaultStyle",value:function(){return{stroke:"#6c7a89",zmin:15}}}]),_e}(),R0=function(){function _e(){d(this,_e),this.config=Object.seal({emitEventOnOverrideUpdate:!0}),this.imageCache={},this.releaseSettings_={displayOptions:{},mom:[]},this.theme={}}return g(_e,[{key:"getMomData",value:function(){return this.releaseSettings_.mom}},{key:"getTheme",value:function(){return this.theme||{}}},{key:"getStyle",value:function(_r){var k=1<arguments.length&&arguments[1]!==void 0&&arguments[1],j=this.getTheme(),G=u0.getGeometryDefaultStyle(),_t=_r.properties.spaceType,_r=_r.properties.spaceCategory,_s=_r;return _t&&(_s="".concat(_r,"_").concat(_t)),{m:(_r=(_r=j.getGeometryStyle(_s))&&!k?_r:G).fill&&_r.fill.toLowerCase()||"#fff",w:_r.strokeWidth/10||.1,o:_r.stroke&&_r.stroke.toLowerCase()||"#fff",l:"Dark"}}},{key:"getLabelStyle",value:function(_){this.getTheme();var k=u0.getLabelDefaultStyle();return{fill:k.stroke,zmin:k.zmin}}}]),_e}(),O0=Math.PI/180,w_=180/Math.PI,I0=function(){function _e(){d(this,_e)}return g(_e,null,[{key:"toRadians",value:function(_){return _*O0}},{key:"toDegrees",value:function(_){return _*w_}},{key:"getBoundingBox",value:function(_,k){var j=[];switch(_){case q0:j=[k,k];break;case X0:case v0:j=k;break;case K0:case o0:j=k.reduce(function(G,_t){return G.concat(_t)},[]);break;case Z0:j=k.reduce(function(G,_t){return G.concat(_t)},[]).reduce(function(G,_t){return G.concat(_t)},[])}return _e.getBoundingBoxVertices(j)}},{key:"getInverseTransform",value:function(_){var k=_[0]*_[3]-_[1]*_[2],k=[_[3]/k,-_[1]/k,-_[2]/k,_[0]/k,0,0];return k[4]=-(k[0]*_[4]+k[2]*_[5]),k[5]=-(k[1]*_[4]+k[3]*_[5]),k}},{key:"applyTransformToPoint",value:function(_,k){return[k[0]*_[0]+k[1]*_[2]+_[4],k[0]*_[1]+k[1]*_[3]+_[5]]}},{key:"transformProduct",value:function(_,k){var j=[0,0,0,0,0,0];return j[0]=k[0]*_[0]+k[2]*_[1],j[1]=k[1]*_[0]+k[3]*_[1],j[2]=k[0]*_[2]+k[2]*_[3],j[3]=k[1]*_[2]+k[3]*_[3],j[4]=k[0]*_[4]+k[2]*_[5]+k[4],j[5]=k[1]*_[4]+k[3]*_[5]+k[5],j}},{key:"convertLonLatToMerc",value:function(j){var k=j[0]*O0,j=j[1]*O0,j=Math.sin(j);return[.5+k/(2*Math.PI),.5-Math.log((1+j)/(1-j))/(4*Math.PI)]}},{key:"convertMercToLatLon",value:function(j){var k=2*Math.PI*(j[0]-.5),j=Math.atan(Math.sinh(2*Math.PI*(.5-j[1])));return[k/O0,j/O0]}},{key:"getTransformScale",value:function(_){return Math.sqrt(_[0]*_[3]-_[1]*_[2])}},{key:"getLonLatToMercTransform",value:function(G){var k=[.002777777777777778,0,0,-1/(360*Math.cos(G[1]*O0)),0,0],j=_e.applyTransformToPoint(k,G),G=_e.convertLonLatToMerc(G);return k[4]=G[0]-j[0],k[5]=G[1]-j[1],k}},{key:"getNatToMercTransform",value:function(_){var k=[_[4],_[5]],k=_e.getLonLatToMercTransform(k);return _e.transformProduct(_,k)}},{key:"convertMxMy2LonLat",value:function(_,k){return _.length&&k.length?_e.applyTransformToPoint(_,k):[]}},{key:"convertLonLat2MxMy",value:function(_,k){return!_.length||!k.length?[]:(_=_e.getInverseTransform(_),_e.applyTransformToPoint(_,k))}},{key:"getFlattenedQuadraticBezierCurve",value:function(_,k,j){var G=[],_t=3<arguments.length&&arguments[3]!==void 0?arguments[3]:10;_t<1&&(_t=6);for(var _r=0;_r<=_t;_r+=1){var _a=_r/_t,bc=(1-_a)*(1-_a),_s=2*_a*(1-_a),_a=_a*_a,Ba=bc*_[0]+_s*k[0]+_a*j[0],bc=bc*_[1]+_s*k[1]+_a*j[1];G.push([Ba,bc])}return G}},{key:"getFlattenedCubicBezierCurve",value:function(_,k,j,G){var _t=[],_r=4<arguments.length&&arguments[4]!==void 0?arguments[4]:10;_r<1&&(_r=6);for(var _s=0;_s<=_r;_s+=1){var bc=_s/_r,ad=(1-bc)*(1-bc)*(1-bc),_a=3*bc*(1-bc)*(1-bc),Ba=3*bc*bc*(1-bc),bc=bc*bc*bc,sd=ad*_[0]+_a*k[0]+Ba*j[0]+bc*G[0],ad=ad*_[1]+_a*k[1]+Ba*j[1]+bc*G[1];_t.push([sd,ad])}return _t}},{key:"getRectangularCoordinatesOfLabelArea",value:function(bc,k){var j=!(2<arguments.length&&arguments[2]!==void 0)||arguments[2],_a=_o(bc,6),G=_a[0],_t=_a[1],_r=_a[2],_s=_a[3],_a=_a[5],Ba=_e.getDeltaLonLatForMeterAtGivenLonLat(G,_t),bc=bc[4];return j?(_a&&(bc*=-1),k!=null&&(bc=(bc+=k<0?2*Math.PI+k:k)<0?2*Math.PI+bc:bc)):bc=0,_e.getRectVerticesFromSignatureRectRepresentation([G,_t],{xLength:_r,yLength:_s},bc,Ba)}},{key:"getRotatedPoint",value:function(_a,_r){var j=!(2<arguments.length&&arguments[2]!==void 0)||arguments[2],G=3<arguments.length&&arguments[3]!==void 0?arguments[3]:[0,0],_t=Math.cos(_r),_r=Math.sin(_r),_s=_a[0]-G[0],_a=_a[1]-G[1],Ba=[];return[(Ba=j?[_s*_t+_a*_r,_a*_t-_s*_r]:[_s*_t-_a*_r,_a*_t+_s*_r])[0]+G[0],Ba[1]+G[1]]}},{key:"getRectVerticesFromSignatureRectRepresentation",value:function(ad,_r,j,G){var _t=_r.xLength,_r=_r.yLength,_s=!(4<arguments.length&&arguments[4]!==void 0)||arguments[4],ad=_o(ad,2),_a=ad[0],Ba=ad[1],bc=_t/2,sd=_r/2,ad=_o(G,2),dy=ad[0],gy=ad[1];return[[1,1],[-1,1],[-1,-1],[1,-1]].map(function(ay){return[ay[0]*bc,ay[1]*sd]}).map(function(ay){return _e.getRotatedPoint(ay,j,_s)}).map(function(ay){return[ay[0]*dy,ay[1]*gy]}).map(function(ay){return[ay[0]+_a,ay[1]+Ba]})}},{key:"getScaleFactorForRectInSpace",value:function(_,k,j,G){return _/=j,j=k/G,j<_?j:_}},{key:"getDeltaLonLatForMeterAtGivenLonLat",value:function(_,k){return[1/6371e3*(180/Math.PI)/Math.cos(k*Math.PI/180),1/6371e3*(180/Math.PI)]}},{key:"getBoundingBoxVertices",value:function(){var _=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],k=[[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]];return _.reduce(function(j,G){return[[Math.min(G[0],j[0][0]),Math.min(G[1],j[0][1])],[Math.max(G[0],j[1][0]),Math.max(G[1],j[1][1])]]},k)}},{key:"isPointInBoundingBox",value:function(_,k){var j,G,_t,_r;if(_&&k)return _=_o(_,2),j=_[0],_=_[1],k=_o(k,2),_t=_o(k[0],2),G=_t[0],_t=_t[1],k=_o(k[1],2),_r=k[0],k=k[1],j<=_r&&G<=j&&_<=k&&_t<=_}},{key:"isPointOnLineSegment",value:function(_t,_s,Ba){var _t=_o(_t,2),G=_t[0],_t=_t[1],_s=_o(_s,2),_r=_s[0],_s=_s[1],Ba=_o(Ba,2),_a=Ba[0],Ba=Ba[1],bc=(_s-_t)*(Ba-_t)<=0;return _r===_a?_r===G&&bc:_t-Ba==(Ba-_s)/(_a-_r)*(G-_a)&&bc}},{key:"rayIntersectLineSegment",value:function(_t,_s,Ba){var _t=_o(_t,2),G=_t[0],_t=_t[1],_s=_o(_s,2),_r=_s[0],_s=_s[1],Ba=_o(Ba,2),_a=Ba[0],Ba=Ba[1];return _r===_a?!1:(G=(G-_r)/(_a-_r),0<=G&&G<1&&_t<(Ba-_s)*G+_s)}},{key:"isPointInPolygon",value:function(_t,k){var _t=_o(_t,2),j=_t[0],G=_t[1],_t=k.length;if(_t<3)return!1;var _r=0,_s=k[_t-1];return k.forEach(function(_a){_e.rayIntersectLineSegment([j,G],_s,_a)&&(_r+=1),_s=_a}),_r%2!=0}},{key:"isPointOnLineString",value:function(j,k){var j=_o(j,2),G=j[0],_t=j[1],_r=k.length;if(!(_r<2))for(var _s=k[_r-1],_a=0;_a<_r;_a+=1){var Ba=k[_a];if(_e.isPointOnLineSegment([G,_t],_s,Ba))return!0;_s=k[_a]}return!1}},{key:"getAreaOfPolygon",value:function(_){var k=_.length;if(k<3)return null;var j=0,G=_[k-1];return _.forEach(function(_t){var _r,_s,_a,Ba;j+=.5*(_s=_t,_r=_o(_r=G,2),_a=_r[0],_r=_r[1],_s=_o(_s,2),Ba=_s[0],_a*_s[1]-_r*Ba),G=_t}),j}},{key:"getDistanceBetweenPoints",value:function(_t,j){var _t=_o(_t,2),G=_t[0],_t=_t[1],j=_o(j,2),G=G-j[0],_t=_t-j[1];return Math.sqrt(G*G+_t*_t)}}]),_e}(),I_=function(){function _e(){d(this,_e),this.spaceRules={}}return g(_e,null,[{key:"getDataEntriesOne",value:function(G,k){var j,G=[G,""];return k!==null&&Array.isArray(k)?G[1]=k.toString():k!==null&&l(k)==="object"?0<(j=Object.entries(k)).length&&(j=this.getDataEntriesOne(j[0][0],j[0][1]),G[0]="".concat(G[0],".").concat(j[0]),G[1]=j[1]):G[1]=k,G}},{key:"getDataEntriesAll",value:function(_){for(var k=[],j=0,G=Object.entries(_);j<G.length;j++){var _t=_o(G[j],2),_r=_t[0],_t=_t[1],_r=this.getDataEntriesOne(_r,_t);k.push(_r)}return k}},{key:"doFindComboMatch",value:function(_,k){var j="";if(_&&_.configuration&&_.configuration.combinations)for(var G=this.getDataEntriesAll(k),k=Object.entries(_.configuration.combinations),_t=0,_r=0,_s=k;_r<_s.length;_r++)(function(){var Ba=_s[_r],bc=Object.keys(Ba[1]).filter(function(sd){return G.some(function(ad){return sd===ad[0]&&Ba[1][sd]===ad[1]})});bc.length===Object.keys(Ba[1]).length&&bc.length>_t&&(j=Ba[0],_t=bc.length)})();return j}},{key:"getIconFromCombinations",value:function(_,k){if(_&&_.configuration.combinations&&k&&0<Object.keys(k).length&&_.behavioralAppearance.combinations&&0<Object.keys(_.behavioralAppearance.combinations).length){if(k=this.doFindComboMatch(_,k),k===""||!_.behavioralAppearance.combinations[k].labelIcon)return"";if(_.behavioralAppearance.combinations&&_.behavioralAppearance.combinations[k]&&_.behavioralAppearance.combinations[k].labelIcon)return _.behavioralAppearance.combinations[k].labelIcon.referenceUri}return""}},{key:"findSpace",value:function(_,k){if(k.spaceTypes&&k.spaceTypes[_])return k.spaceTypes[_]}},{key:"findCategory",value:function(_){if(this.spaceRules[_])return this.spaceRules[_]}},{key:"setSpaceRules",value:function(_){this.spaceRules=_}},{key:"getSpaceIcon",value:function(_,_r,j){var G,_t="",_r=this.findCategory(_r);return _r&&(_=this.findSpace(_,_r))&&(G="",(G=j?this.getIconFromCombinations(_,j):G)&&G!==""?_t=G:_.behavioralAppearance.default.labelIcon?_t=_.behavioralAppearance.default.labelIcon.referenceUri:_r.properties.behavioralAppearance.default.labelIcon&&(_t=_r.properties.behavioralAppearance.default.labelIcon.referenceUri)),_t}}]),_e}(),E0=function(){function _e(){d(this,_e),this.themeRule={},this.svgList={},this.defaultLang="ENG"}return g(_e,null,[{key:"getNumberFromAlphaNumeric",value:function(_){try{var k=_.split("").reverse().join("").replace(/[^0-9]/g,"").substr(0,6);return parseInt(k,10)}catch{return null}}},{key:"extractNumFromSting",value:function(_){try{var k=_.replace(/[^0-9]/g,"");return parseInt(k,10)}catch{return console.warn("Exception in converting string to Id"),this.getNumberFromAlphaNumeric(_)}}},{key:"getVenueId",value:function(_){var k;return typeof _!="number"?(k=_.substr(_.length-6),parseInt(k,10)):_}},{key:"getStringFormatIdentifier",value:function(_){return typeof _=="number"||_.length<13?"indoormap-00000000-0000-4000-a000-".concat(_.toString().padStart(12,"0")):_}},{key:"setSite",value:function(G,k){var j=this.getName(G),G={id:this.getStringFormatIdentifier(k),location:G.referencePoint,properties:G.properties,geometry:G.geometry,map_version:G.properties.indoorSiteMetadata.legacyVersion.mapVersion,identifier:this.getVenueId(k),obj_type:"CommunityMap"};return G.properties.name=j,G.properties.display_name=j,G}},{key:"setEntrance",value:function(_){var k=this.themeRule.entranceRules.default.labelIcon.referenceUri,j=this.extractNumFromSting(_.id),G=this.getName(_),_t=_.properties;return _t.icon=!0,_t.svg=this.svgList[k.toLowerCase()],_t.name=G||"entrance",_t.display_name=G||"entrance",_t.level={id:_.properties.level.id},{id:_.id,levelId:_.properties.level.id,momType:W0,geometry:_.geometry,location:_.geometry,properties:_t,identifier:j,label_area:[_.referencePoint.coordinates[0],_.referencePoint.coordinates[1],50,50,180]}}},{key:"setStructure",value:function(_){var k=this.extractNumFromSting(_.id),j=this.getName(_),G=_.properties;return G.is_root=_.properties.drawOrder===0,G.display_name=j,G.map_type=_.properties.structureType,G.name=j,{id:_.id,obj_type:"Drawing",identifier:k,properties:G}}},{key:"getNameByPriority",value:function(_,k){for(var j,G=this,_t="",_r=0;_r<_.length;_r++){var _s=_[_r];if(((j=_s).nameType==="OFFICIAL"&&j.languageCode&&j.languageCode===G.defaultLang||j.nameType==="OFFICIAL")&&(k&&k===_s.nameType||!k)){_t=_s.name;break}if(_s.nameType==="ABBREVIATION"&&(k&&k===_s.nameType||!k)){_t=_s.name;break}if(_s.nameType==="UNCLASSIFIED"&&(k&&k===_s.nameType||!k)){_t=_s.name;break}if(!_s.nameType&&_s.name){_t=_s.name;break}}return _t}},{key:"getName",value:function(_,k){return _.properties&&_.properties.names?this.getNameByPriority(_.properties.names,k):_.properties.placeProperties&&_.properties.placeProperties&&_.properties.placeProperties.names?this.getNameByPriority(_.properties.placeProperties.names,k):_.properties.locationDetails&&_.properties.locationDetails[0]&&_.properties.locationDetails[0].names?this.getNameByPriority(_.properties.locationDetails[0].names,k):""}},{key:"setLevel",value:function(_){var k=this.extractNumFromSting(_.id),j=_.properties.names,G=_.properties;return G["short name"]=this.getNameByPriority(j,j&&j.length!==1?"ABBREVIATION":""),G.name=this.getNameByPriority(j,j&&j.length!==1?"ABBREVIATION":""),{id:_.id,obj_type:"Level",identifier:k,properties:G}}},{key:"setLevelConnector",value:function(_){var k=this.extractNumFromSting(_.id);return{id:_.id,obj_type:"LevelConnector",properties:_.properties,geometry:_.geometry,identifier:k,location:_.geometry}}},{key:"setOccupant",value:function(_){var k=this.getName(_),j=this.extractNumFromSting(_.id),G=_.properties;return G.occupantName=k,G.email=_.properties.placeProperties&&_.properties.placeProperties.contacts&&_.properties.placeProperties.contacts.find(function(_t){return _t.contactType==="EMAIL"})&&_.properties.placeProperties.contacts.find(function(_t){return _t.contactType==="EMAIL"}).value,G.name=k,G.tags=_.properties.attributes&&_.properties.attributes.tags,{geometry:_.geometry,id:_.id,obj_type:"Geometry",properties:G,identifier:j,spaceIds:_.properties.spaces||[],type:"Feature",momType:V0}}},{key:"getIcon",value:function(_){var k=!1,j="";return this.svgList[_]&&(k=!0,j=this.svgList[_]),{icon:k,svg:j}}},{key:"setSpace",value:function(_){var j=I_.getSpaceIcon(_.properties.spaceType,_.properties.spaceCategory,_.properties.spaceTypeProperties),_s=this.getName(_),j=this.getIcon(j),k=j.icon,j=j.svg,G=this.extractNumFromSting(_.id),_t=(_.properties.level.id.includes("out"),_.properties.level.id),_r=_.properties,_s=(_r.spaceName=_s,_r[_.properties.spaceCategory]=_.properties.spaceType,_r.spaceType=_.properties.spaceType,_r.spaceCategory=_.properties.spaceCategory,_r.icon=k,_r.svg=j,{geometry:_.geometry,id:_.id,levelId:_t,label_area:[_.referencePoint.coordinates[0],_.referencePoint.coordinates[1],50,50,180],location:_.referencePoint,obj_type:"Geometry",identifier:G,properties:_r,momType:U0,type:"Feature"});return _.properties.spaceAddress&&_.properties.spaceAddress.id&&(_s.addressId=_.properties.spaceAddress.id),_s}},{key:"setSpaceGroups",value:function(_){var k=this.extractNumFromSting(_.id);return{id:_.id,obj_type:"SpaceGroups",properties:_.properties,geometry:_.geometry,location:_.referencePoint,identifier:k}}},{key:"setTopology",value:function(_){var k=this.extractNumFromSting(_.id);return{id:_.id,obj_type:"Topology",properties:_.properties,geometry:_.geometry,identifier:k}}},{key:"setAddress",value:function(_){var k=this.extractNumFromSting(_.id),j=this.getName(_),G=_.properties;return G.addressName=j,G.name=j,{id:_.id,properties:G,obj_type:"Address",identifier:k}}},{key:"manageSvgDimensions",value:function(_){for(var k={},j=0,G=Object.entries(_);j<G.length;j++){var _t,_r,_a=_o(G[j],2),_s=_a[0],_a=_a[1];typeof _a=="string"&&(_t=_a.indexOf("<g")!==-1&&_a.indexOf("<g")||_a.indexOf("<p"),_r=_a.indexOf("</s"),_t&&_r&&(_a=_a.substring(_t-1,_r-1),k[_s]="<svg width='64' height='64' viewBox='0 0 24 32' fill='none' xmlns='http://www.w3.org/2000/svg'>".concat(_a,"</svg>")))}return k}},{key:"getSiteBoundingBox",value:function(_){if(_){var _=_o(I0.getBoundingBox(_.geometry.type,_.geometry.coordinates),2),k=_[0],_=_[1];if(k)return"".concat(k[0],",").concat(k[1],",").concat(_[0],",").concat(_[1])}return"null, null, null, null"}}]),_e}(),o_=function(){function _e(){d(this,_e)}return g(_e,null,[{key:"get",value:function(_){return fetch(_,1<arguments.length&&arguments[1]!==void 0?arguments[1]:{method:"GET"}).then(function(k){return k.ok?k.json():Promise.reject(new Error("Call failed for ".concat(_," : ").concat(k.status," ").concat(k.statusText)))})}},{key:"getFormattedIndoorMapId",value:function(_){return typeof _=="number"?"indoormap-00000000-0000-4000-a000-".concat(_.toString().padStart(12,"0")):_.includes("indoormap")?_:"indoormap-00000000-0000-4000-a000-".concat(_.padStart(12,"0"))}},{key:"getConfigUrl",value:function(_,k,_a){var G=_a.apiKey,_s=_a.url,_t=_a.token,_a=_a.hrn,_r={method:"GET",mode:"cors",cache:"default"},_s="".concat(_s||Fa,"/").concat(_a),_a="";return k===P0.SITE&&(_a="".concat(_s,"/layers/").concat(n_,"/search?p.featureType=indoor.Site&p.indoorMapId='").concat(this.getFormattedIndoorMapId(_),"'")),k===P0.IMAGES&&(_a="".concat(_s,"/layers/").concat($,"/features/svg")),k===P0.Theme&&(_a="".concat(_s,"/layers/").concat(_i,"/features/indoorMapRules")),_t?_r.headers={Authorization:"Bearer ".concat(_t)}:_a=_a.concat("".concat(k===P0.SITE?"&":"?","apiKey=").concat(G)),this.get(_a,_r)}},{key:"getMomData",value:function(_s,_r){var j=_r.apiKey,_a=_r.url,G=_r.token,_r=_r.hrn,_t={method:"GET",mode:"cors",cache:"default"},_a="".concat(_a||Fa,"/").concat(_r),_r=_s&&_s.features&&_s.features.find(function(Ba){return Ba.momType===H0}),_s=E0.getSiteBoundingBox(_r),_a="".concat(_a,"/layers/").concat(n_,"/bbox?bbox=").concat(_s,"&f.momType=indoor.Level,indoor.Space,indoor.Site,indoor.Structure,indoor.Occupant,indoor.SpaceGroups,Address,indoor.Entrance");return G?_t.headers={Authorization:"Bearer ".concat(G)}:_a=_a.concat("&apiKey=".concat(j)),{mom:this.get(_a,_t),site:_r}}},{key:"getDefaultCollection",value:function(k){var k=k.token,G=_c[_u.DEFAULT_COLLECTION],j=G.PARAMS,G=G.BASE_URL,G=encodeURI("".concat(G,"?sortBy=").concat(j.CREATED_BY,"&q=").concat(j.COLLECTION));return k?(j={method:"GET",headers:{Authorization:"Bearer ".concat(k)}},this.get(G,j)):Promise.reject(new Error("Please provide valid token"))}},{key:"getProjectAccountDetails",value:function(k){var k=k.token,j=_c[_u.ACCOUNT_API].BASE_URL;return k?(k={method:"GET",mode:"cors",headers:{Authorization:"Bearer ".concat(k)}},this.get(j,k)):Promise.reject(new Error("Please provide valid token"))}},{key:"fetchIndoorMapList",value:function(){var _=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},k=_.hrn,_t=_.url,G=_c[_u.CATALOG_LAYER],j=G.PARAMS,G=G.COLLECTION_LAYER,_t=_t||Fa;return k?(_t=encodeURI("".concat(_t,"/").concat(k,"/").concat(G,"?").concat(j.FEATURE_TYPE.KEY,"=").concat(j.FEATURE_TYPE.VALUE)),G=(k=this.createBaseUrl(_t,sy.GET,{},_)).URL,j=k.options,this.get(G,j)):Promise.reject(new Error("Please provide valid hrn"))}},{key:"createBaseUrl",value:function(){var _=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",_r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:sy.GET,k=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{},G=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{},j=G.token,G=G.apiKey,_t=_,_r={method:_r,mode:"cors"};return j?_r.headers=o({Authorization:"Bearer ".concat(j)},k):_t=_.concat("&apiKey=".concat(G)),{URL:_t,options:_r}}}]),_e}(),s_=function(){function _e(){d(this,_e)}return g(_e,null,[{key:"isPointOnGeoJSONLineString",value:function(_,k){var j=!1;if(k&&1<k.length){for(var G,_t,_r=1;_r<k.length;_r+=1)if(G=k[_r-1],_t=k[_r],I0.isPointOnLineSegment(_,G,_t)){j=!0;break}}return j}},{key:"isPointOnGeoJSONMultiLineString",value:function(_,k){for(var j=!1,G=0;G<k.length;G+=1)if(_e.isPointOnGeoJSONLineString(_,k[G])){j=!0;break}return j}},{key:"isPointInsideGeoJSONPolygon",value:function(_,k){var j=!1;if(j=I0.isPointInPolygon(_,k[0])?!0:j){for(var G=1;G<k.length;G+=1)if(I0.isPointInPolygon(_,k[G])){j=!1;break}}return j}},{key:"isPointInsideGeoJSONMultiPolygon",value:function(_,k){for(var j=k.length,G=0;G<j;G+=1)if(_e.isPointInsideGeoJSONPolygon(_,k[G]))return!0;return!1}},{key:"getGeometriesByLonLat",value:function(_,k){for(var j=2<arguments.length&&arguments[2]!==void 0&&arguments[2],G=[],_t=k.filter(function(_a){return I0.isPointInBoundingBox(_,_a.getBoundingBox())}),_r=0;_r<_t.length;_r+=1){var _s=_t[_r];if(_s.isPointInsideGeometry(_,!0)&&(G.push(_s),!j))break}return G.sort(function(_a,Ba){return Ba.getZIndex()-_a.getZIndex()})}}]),_e}(),B_=function(){function _e(){var _=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},k=1<arguments.length?arguments[1]:void 0,j=2<arguments.length?arguments[2]:void 0;d(this,_e),this.id=_.id,this.properties=_.properties||{},this.labelArea=_.label_area||[],this.geometry=_.geometry||{},this.location=_.location||{},this.address=_.address||{},this.level=k,this.zIndex=j,this.spaceId=_.spaceId,this.state_={isHighlighted:!1,highlightedStyle:{}},this.geometryData=_}return g(_e,[{key:"getId",value:function(){return this.geometryData&&this.geometryData.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getProperties",value:function(){return this.properties}},{key:"getInternalAddress",value:function(){return this.address?this.address.properties&&this.address.properties.name:null}},{key:"getCenter",value:function(){return this.location.coordinates||[]}},{key:"getCoordinates",value:function(){return this.geometry.coordinates||[]}},{key:"getDisplayName",value:function(){return this.properties.display_name||""}},{key:"getName",value:function(){return this.properties.name||""}},{key:"getStyle",value:function(){return this.getMetaInformation_().getStyle(this)}},{key:"getIcon",value:function(){return this.properties.svg}},{key:"getLabelArea",value:function(){return this.labelArea||[]}},{key:"getLabelStyle",value:function(){return this.getMetaInformation_().getLabelStyle(this)||null}},{key:"getLevel",value:function(){return this.level}},{key:"getType",value:function(){return this.geometry.type}},{key:"getZIndex",value:function(){return this.zIndex}},{key:"getBoundingBox",value:function(){var _=this.getType(),k=this.getCoordinates(),j=[];switch(_){case q0:j=[k,k];break;case X0:case v0:j=k;break;case K0:case o0:j=k.reduce(function(G,_t){return G.concat(_t)},[]);break;case Z0:j=k.reduce(function(G,_t){return G.concat(_t)},[]).reduce(function(G,_t){return G.concat(_t)},[])}return I0.getBoundingBoxVertices(j)}},{key:"isIcon",value:function(){return!!this.properties.icon}},{key:"isPointInsideGeometry",value:function(_){var k,j=1<arguments.length&&arguments[1]!==void 0&&arguments[1],G=!1;switch(this.getType()){case q0:k=this.getLabelArea()&&I0.getRectangularCoordinatesOfLabelArea(this.getLabelArea()),G=I0.isPointInPolygon(_,k);break;case X0:break;case v0:G=j&&s_.isPointOnGeoJSONLineString(_,this.getCoordinates());break;case K0:G=j&&s_.isPointOnGeoJSONMultiLineString(_,this.getCoordinates());break;case o0:G=s_.isPointInsideGeoJSONPolygon(_,this.getCoordinates());break;case Z0:G=s_.isPointInsideGeoJSONMultiPolygon(_,this.getCoordinates())}return G}},{key:"highlight",value:function(){var _=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],k=1<arguments.length?arguments[1]:void 0;this.state_.isHighlighted=_,this.state_.highlightedStyle=_?k:{}}},{key:"isHighlighted",value:function(){return!!this.state_.isHighlighted}},{key:"getHighlightedStyle",value:function(){return this.state_.highlightedStyle||{}}},{key:"toJSON",value:function(){return o({},this.geometry)}},{key:"getMetaInformation_",value:function(){return this.getLevel()?this.getLevel().getDrawing().getVenueModel().metaInformation_:null}}]),_e}(),z_=function(){function _e(_,k){var j=this;d(this,_e),this.id=_&&_.id,this.properties=_&&_.properties,this.zIndexCount=0,this.geometries=_&&_.features&&Object.values(_.features).reduce(function(G,_t){return G[[_t.id]]=new B_(_t,j,_t.properties.drawOrder),G},{}),this.drawing=k,this.levelData=_}return g(_e,[{key:"getId",value:function(){return this.levelData&&this.levelData.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getProperties",value:function(){return this.properties}},{key:"getName",value:function(){return this.properties&&this.properties.name||""}},{key:"getDisplayName",value:function(){return this.properties&&this.properties.display_name||""}},{key:"getDrawing",value:function(){return this.drawing}},{key:"getShortName",value:function(){return this.properties&&this.properties["short name"]||""}},{key:"getZIndex",value:function(){return this.properties&&this.properties.zLevel}},{key:"getFeatureCollectionArray",value:function(){return this.getGeometries().map(function(_){return _.toJSON()})}},{key:"getGeometryById",value:function(_){return this.geometries[_]}},{key:"getGeometries",value:function(){return 0<arguments.length&&arguments[0]!==void 0&&arguments[0]?this.geometries&&Object.values(this.geometries).sort(function(_,k){return k.getZIndex()-_.getZIndex()}):this.geometries&&Object.values(this.geometries).sort(function(_,k){return _.getZIndex()-k.getZIndex()})}},{key:"getGeometriesByAddress",value:function(_){return Object.values(this.geometries).filter(function(k){return k.address&&k.address.properties&&k.address.properties.name&&k.address.properties.name===_})}},{key:"isMain",value:function(){return!!this.properties.isMain}}]),_e}(),F_=function(){function _e(_){var k=this,j=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},G=2<arguments.length&&arguments[2]!==void 0?arguments[2]:[],_t=3<arguments.length?arguments[3]:void 0;d(this,_e),this.venueModel=_t,this.levels=G.map(function(_r){return new z_(_r,k)}),this.structure=_,this.id=_&&_.id,this.properties=j}return g(_e,[{key:"getId",value:function(){return this.structure&&this.structure&&this.structure.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getProperties",value:function(){return this.properties}},{key:"isRoot",value:function(){return!!this.properties.is_root}},{key:"getDisplayName",value:function(){return this.properties.display_name||""}},{key:"getName",value:function(){return this.properties.name||""}},{key:"getBoundingBox",value:function(){if(this.structure&&this.structure.geometry){var k=_o(I0.getBoundingBox(this.structure.geometry.type,this.structure.geometry.coordinates),2),_=k[0],k=k[1];if(_)return[k[1],_[0],_[1],k[0]]}return[null,null,null,null]}},{key:"getCenter",value:function(){return this.structure&&this.structure.location&&this.structure.location.coordinates}},{key:"getGeometryById",value:function(_){return this.getGeometries().find(function(k){return k.getId()===_||k.getIdentifier()===_})}},{key:"getGeometries",value:function(){return this.levels.flatMap(function(_){return _.getGeometries()})}},{key:"getLevelById",value:function(_){return this.levels.find(function(k){return k.getId()===_||k.getIdentifier()===_})}},{key:"getLevelByZIndex",value:function(_){return this.levels.find(function(k){return k.getZIndex()===_})}},{key:"getLevels",value:function(){return this.levels}},{key:"getMainLevel",value:function(){return this.levels.find(function(_){return _.isMain()})}},{key:"getVenueModel",value:function(){return this.venueModel}}]),_e}(),U_=j0.STANDARD,C_=function(){function _e(_){var k=this,j=1<arguments.length&&arguments[1]!==void 0?arguments[1]:new R0;d(this,_e),this.metaInformation_=j,this.momStructure=_,this.id=_&&_.site&&_.site.id,this.location=_&&_.site&&_.site.location||{},this.properties=_&&_.site&&o({},_.site.properties),this.drawings=_&&_.structure&&Object.values(_.structure).map(function(G){var _t=_.getStructureWiseGeometry(G.id);return new F_(G,G.properties,Object.values(_t),k)})}return g(_e,[{key:"getDisplaySettings",value:function(){return(this.metaInformation_.releaseSettings_?this.metaInformation_.releaseSettings_.displayOptions:"").display||U_}},{key:"getId",value:function(){return this.momStructure&&this.momStructure.site&&this.momStructure.site.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getName",value:function(){return this.properties.name}},{key:"getBoundingBox",value:function(){if(this.momStructure){var k=_o(I0.getBoundingBox(this.momStructure.site.geometry.type,this.momStructure.site.geometry.coordinates),2),_=k[0],k=k[1];if(_)return[k[1],_[0],_[1],k[0]]}return[null,null,null,null]}},{key:"getCenter",value:function(){return this.location.coordinates}},{key:"getGeometryById",value:function(_){return this.getGeometries().find(function(k){return k.getId()===_||k.getIdentifier()===_})}},{key:"getGeometries",value:function(){return this.getLevels().sort(function(_,k){return _.getZIndex()-k.getZIndex()}).flatMap(function(_){return _.getGeometries()})}},{key:"getGeometriesByLonLat",value:function(_){var k=this,G=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[],j=!(2<arguments.length&&arguments[2]!==void 0)||arguments[2],G=G.map(function(_t){return k.getLevelById(_t)});return G.length===0&&(G=this.drawings.filter(function(_t){return _t=_t.getBoundingBox(),I0.isPointInBoundingBox(_,_t)}).flatMap(function(_t){return _t.getLevels()})),s_.getGeometriesByLonLat(_,G.flatMap(function(_t){return _t.getGeometries(!0)}),j)}},{key:"getDrawingById",value:function(_){return this.drawings.find(function(k){return k.getId()===_||k.getIdentifier()===_})}},{key:"getDrawings",value:function(){return this.drawings}},{key:"getRootDrawing",value:function(){return this.drawings.find(function(_){return _.isRoot()})}},{key:"getLevelById",value:function(_){return this.getLevels().find(function(k){return k.getId()===_||k.getIdentifier()===_})}},{key:"getLevelsByZIndex",value:function(){var _=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0;return this.getLevels().filter(function(k){return Number(k.getZIndex())===Number(_)})}},{key:"getLevels",value:function(){return this.drawings.flatMap(function(_){return _.getLevels()})}},{key:"getMomStructure",value:function(){return this.momStructure}},{key:"getLevelMapFlattenedByZIndex_",value:function(){return this.getLevels().reduce(function(_,k){var j=k.getZIndex();return _[j]||(_[j]=[]),_[j].push(k),_},{})}},{key:"getOccupant",value:function(){var _=this.momStructure.occupant;return Object.values(_)}}]),_e}(),G_=function(){function _e(_){d(this,_e),this.theme=_&&_.theme,this.level=_&&_.level,this.site=_&&_.site,this.spaces=_&&_.spaces,this.address=_&&_.address,this.levelConnector=_&&_.levelConnector,this.topology=_&&_.topology,this.entrance=_&&_.entrance,this.occupant=_&&_.occupant,this.structure=_&&_.structure,this.spaceGroups=_&&_.spaceGroups,this.levelWiseGeometry={},this.levelStructureMapping=_&&_.levelStructureMapping,this.outdoorLevelMapping=_&&_.outdoorLevelMapping||{},this.labelTextPreference=_&&_.labelTextPreference||null}return g(_e,[{key:"setSpaceWithLevel",value:function(){var _=this;this.spaces&&Object.values(this.spaces).forEach(function(k){var j="",G=(k.addressId&&(j=_.address&&_.address[k.addressId]&&_.address[k.addressId].properties.addressName),k.properties),j=(G.addressName=j,_.getLabelAsPerPreference(o(o({},k),{},{properties:G}))),G=k.properties,j=(G.name=j,G.display_name=j,k.properties.icon&&(G.name=k.id,G.display_name=k.id),k),G=(j.properties=G,j.address=_.address[k.addressId],(_.spaces[k.id]=k).levelId);_.outdoorLevelMapping[G]&&(G=_.outdoorLevelMapping[G]),_.levelWiseGeometry[G]||(_.levelWiseGeometry[G]={}),_.levelWiseGeometry[G][j.id]=j})}},{key:"setOccupantWithLevel",value:function(){var _=this;this.occupant&&Object.values(this.occupant).forEach(function(k){var j,G;k.spaceIds&&k.properties.occupantName&&(j=[],G=[],k.spaceIds.forEach(function(_t){function _r(Ba){var ad=!1,ad=(_.labelTextPreference&&_.labelTextPreference.length&&(ad=_.labelTextPreference.indexOf("OCCUPANT_NAMES")!==-1),_.labelTextPreference===null||ad),bc=Ba,sd=Ba.properties,ad=(sd.name=Ba.properties.icon||!ad?Ba.properties.name:k.properties.occupantName,sd.display_name=Ba.properties.icon||!ad?Ba.properties.display_name:k.properties.occupantName,sd.address=Ba.address,sd.occupantName=k.properties.occupantName,Ba.levelId);_.outdoorLevelMapping[ad]&&(ad=_.outdoorLevelMapping[ad]),_.levelWiseGeometry[ad]||(_.levelWiseGeometry[ad]={}),_.levelWiseGeometry[ad][Ba.id]=bc,j.push(bc),G.push(Ba.id)}var _s=_t.id,_s=_.spaces[_s],_a=null;_.spaceGroups&&Object.values(_.spaceGroups).forEach(function(Ba){Ba.properties.spaceGroups&&Ba.properties.spaceGroups&&Ba.properties.spaceGroups.forEach(function(bc){bc.mainSpace&&bc.mainSpace.id===_t.id&&(_a=bc.spaces.map(function(sd){return sd.id}))})}),_a&&0<_a.length&&_a.forEach(function(Ba){_r(_.spaces[Ba])}),_s&&_r(_s)}),_.occupant[k.id]=k,_.occupant[k.id].space=j,_.occupant[k.id].spaceIds=G)})}},{key:"setEntrance",value:function(){var _=this;this.entrance&&Object.values(this.entrance).forEach(function(k){var j=k.properties.level.id;_.levelWiseGeometry[j]||(_.levelWiseGeometry[k.properties.level.id]={}),_.outdoorLevelMapping[j]&&(j=_.outdoorLevelMapping[j]),_.levelWiseGeometry[j][k.id]=k})}},{key:"setLevelWiseGeometry",value:function(){var _=this;this.level&&Object.keys(this.level).forEach(function(k){_.levelWiseGeometry[k]={}}),this.setSpaceWithLevel(),this.setOccupantWithLevel(),this.setEntrance()}},{key:"getStructureWiseGeometry",value:function(_){for(var k={},j=0,G=Object.entries(this.levelWiseGeometry);j<G.length;j++){var _r=_o(G[j],2),_t=_r[0],_r=_r[1];_===this.levelStructureMapping[_t]&&(k[_t]=this.level[_t],k[_t].features=_r)}return k}},{key:"getLabelAsPerPreference",value:function(G){var G=G.properties,k=G.spaceType,_r=G.occupantName,_a=G.spaceName,j=G.addressName,G=G.spaceCategory,_t=(v(Ba={},r_,_r),v(Ba,p_,_a),v(Ba,Y0,k?k.charAt(0).toUpperCase()+k.slice(1).toLowerCase():""),v(Ba,i_,G?G.charAt(0).toUpperCase()+G.slice(1).toLowerCase():""),v(Ba,f_,j),v(Ba,N0,j),v(Ba,d_,j),Ba),_r=this.theme.spaceRules,_s="",_a=G&&k&&_r[G]&&_r[G].spaceTypes&&_r[G].spaceTypes[k].behavioralAppearance.default.labelType;if(_a==="NONE"){if(!this.labelTextPreference)return"";_t[Y0]=""}if(j=G&&k&&_r[G]&&_r[G].properties&&_r[G].properties.behavioralAppearance&&_r[G].properties.behavioralAppearance.default&&_r[G].properties.behavioralAppearance.default.labelType,(j==="NONE"||j===void 0)&&_a===void 0){if(!this.labelTextPreference)return"";_t[Y0]="",_t[i_]=""}var Ba=G&&k&&_r[G]&&_r[G].properties&&_r[G].properties.behavioralAppearance&&_r[G].properties.behavioralAppearance.default&&_r[G].properties.behavioralAppearance.default.labelTextPreference,bc=Ba&&this.labelTextPreference?this.labelTextPreference:Ba;if(bc){for(var sd=0;sd<bc.length;sd++)if(_t[bc[sd]]){_s=_t[bc[sd]];break}}return _s}}]),_e}(),M_=function(){function _e(_s){var G=_s.apiKey,_t=_s.baseUrl,_r=_s.token,_s=_s.hrn;d(this,_e),this.hostOptions_={apiKey:G,url:_t,token:_r,hrn:_s},this.momData=[],this.theme={},this.loadOptions={}}var _,k;return g(_e,[{key:"setHostOptions",value:function(j){Object.keys(j).length!==0&&(this.hostOptions_=o(o({},this.hostOptions_),j))}},{key:"getToken",value:function(){return this.hostOptions_.token}},{key:"getHrn",value:function(){return this.hostOptions_.hrn}},{key:"load",value:function(j){var G=this,_t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};return this.loadOptions=o(o(o({},_f),_t),{},{venueId:j}),this.hostOptions_.mapData=_t.mapData,this.hostOptions_.themeRule=_t.themeRule,this.hostOptions_.svgList=_t.svgList,this.hostOptions_.labelTextPreference=_t.labelTextPreferenceOverride,this.getHrn()?this.getVenueModalInstance():this.getToken()?this.getDefaultCollectionWithToken().then(function(){return G.getVenueModalInstance()}).catch(function(){return Promise.reject(new Error("Unable to find indoor map collection. Please contact your administrator"))}):Promise.reject(new Error("In order to load indoor map, Please provide either hrn or token"))}},{key:"getVenueModalInstance",value:function(){var j=this;return Promise.resolve().then(function(){return j.loadOptions.isMetaEnabled?j.getMeta_(j.loadOptions.isIconsEnabled).catch(function(G){return console.warn(G),Promise.resolve()}):Promise.reject()}).then(function(G){return j.getVenue_(G)}).then(function(G){return G}).catch(function(G){console.debug("Captured event VENUE_ERROR_STATE",G)})}},{key:"createMomStructure",value:function(){var j=this,G={site:{},structure:{},level:{},levelConnector:{},occupant:{},spaces:{},spaceGroups:{},topology:{},address:{},outdoorLevelMapping:{},entrance:{},levelStructureMapping:{}};return this.momData.forEach(function(_t){var _r="indoormap-00000000-0000-4000-a000-".concat(j.loadOptions.venueId.toString().padStart(12,"0")),_s=_t.id;_t.momType!==e_&&!j.hostOptions_.mapData&&_t.properties.indoorMapId!=j.loadOptions.venueId&&_t.properties.indoorMapId!==_r||(_t.momType===H0?G.site=E0.setSite(_t,j.loadOptions.venueId):_t.momType===$0?G.structure[_s]=E0.setStructure(_t):_t.momType!==h_||_t.properties.isOutdoor&&(!_t.properties.isOutdoor||_t.properties.parentIndoorLevel)?_t.momType===h_&&_t.properties.isOutdoor&&_t.properties.parentIndoorLevel?G.outdoorLevelMapping[_t.id]=_t.properties.parentIndoorLevel.id:_t.momType===W0?G.entrance[_s]=E0.setEntrance(_t):_t.momType===V0?G.occupant[_s]=E0.setOccupant(_t):_t.momType===U0?G.spaces[_s]=E0.setSpace(_t):_t.momType===c_?G.spaceGroups[_s]=E0.setSpaceGroups(_t):_t.momType===e_&&(G.address[_s]=E0.setAddress(_t)):(G.level[_s]=E0.setLevel(_t),G.levelStructureMapping[_s]=_t.properties.structure.id))}),G.theme=this.theme,G.labelTextPreference=this.hostOptions_.labelTextPreference,new G_(G)}},{key:"getVenue_",value:function(j){this.momData=j.getMomData();var G=this.createMomStructure();return G.setLevelWiseGeometry(),new C_(G,j)}},{key:"setConfigData",value:function(_r){var G=_r.themeRule,_t=_r.svgList,_r=_r.defaultLang;I_.setSpaceRules(G.spaceRules),E0.svgList=_t,E0.themeRule=G,E0.defaultLang=_r,this.theme=G}},{key:"getMeta_",value:function(){var j=this,G=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],_t=new R0,_r=this.hostOptions_.mapData?{}:this.getMetaConfig_(this.loadOptions.venueId,P0.SITE),_s=this.hostOptions_.themeRule||this.getMetaConfig_(this.loadOptions.venueId,P0.Theme),_a=[];return G&&(_a=this.hostOptions_.svgList||this.getMetaConfig_(this.loadOptions.venueId,P0.IMAGES)),new Promise(function(Ba){Promise.all([_r,_s,_a]).then(function(sd){var sd=_o(sd,3),ad=sd[0],dy=sd[1],gy=sd[2],ay=j.hostOptions_.mapData?{mom:new Promise(function(by){return by(j.hostOptions_.mapData)}),site:j.hostOptions_.mapData.features.find(function(by){return by.momType===H0})}:o_.getMomData(ad,j.hostOptions_);ay.mom.then(function(by){var py=dy.properties;_t.imageCache=G?E0.manageSvgDimensions(gy.properties):[],j.setConfigData({themeRule:py,svgList:_t.imageCache,defaultLang:ay&&ay.site&&ay.site.properties.defaultLanguageCode}),_t.releaseSettings_={displayOptions:{display:py.entranceRules.default.displayName||j0.STANDARD},mom:by.features},_t.theme=new u0(py,_t),Ba(_t)})})})}},{key:"getMetaConfig_",value:function(j,G){return o_.getConfigUrl(j,G,this.hostOptions_)}},{key:"fetchCollections",value:function(){return o_.getDefaultCollection(this.hostOptions_)}},{key:"fetchUserProjects",value:function(){return o_.getProjectAccountDetails(this.hostOptions_)}},{key:"getDefaultCollectionWithToken",value:(_=s().mark(function j(){var G=this;return s().wrap(function(_t){for(;;)switch(_t.prev=_t.next){case 0:return _t.abrupt("return",Promise.all([this.fetchCollections(),this.fetchUserProjects()]).then(function(_s){var _s=_o(_s,2),_a=_s[0],_s=_s[1],_a=G.getHrnFromDefaultCollection(_a,_s);return _a.hrn?(_s={hrn:_a.hrn},G.setHostOptions(_s),Promise.resolve()):Promise.reject()}).catch(function(_r){return Promise.reject(_r)}));case 1:case"end":return _t.stop()}},j,this)}),k=function(){var j=this,G=arguments;return new Promise(function(_t,_r){var _s=_.apply(j,G);function _a(bc){h(_s,_t,_r,_a,Ba,"next",bc)}function Ba(bc){h(_s,_t,_r,_a,Ba,"throw",bc)}_a(void 0)})},function(){return k.apply(this,arguments)})},{key:"getHrnFromDefaultCollection",value:function(_r,G){var _t,_r=_r.results.items;return Array.isArray(_r)&&_r.length?(_t=this.getProjectRealm(G),_r.find(function(_s){return _s.hrn.includes(_t)})):Promise.reject(new Error("Error while accessing default collection"))}},{key:"getProjectRealm",value:function(j){return Array.isArray(j.items)&&j.items.length&&j.items[0].id.includes("indoor-")?(j=j.items[0].hrn,this.getRealmNameFromHrn(j)):""}},{key:"getRealmNameFromHrn",value:function(j){return j?(j=j.split(":")).length&&j[4]:""}},{key:"getSupportedMapList",value:function(){var j=this,_t=this.hostOptions_,G=_t.hrn,_t=_t.token;return G?this.fetchMapInfoList():_t?this.getDefaultCollectionWithToken().then(function(){return j.fetchMapInfoList()}).catch(function(){return Promise.reject(new Error("Unable to find indoor map collection. Please contact your administrator"))}):Promise.reject(new Error("In order to load map list, Please provide either hrn or token"))}},{key:"fetchMapInfoList",value:function(){var j=this;return o_.fetchIndoorMapList(this.hostOptions_).then(function(G){return G=G.features,0<G.length?G.map(function(_s){var _s=_s.properties,_r=_s.placeProperties,_s=_s.indoorMapId,_a=_s.split("-").pop(),_a=_a.substring(_a.length-5);return{mapIdentifier:_s,mapName:j.getMapName(_r.names).name,mapId:_a}}):[]}).catch(function(G){Promise.reject(new Error("".concat(G,": Error while fetching map list")))})}},{key:"getMapName",value:function(j){return Array.isArray(j)&&0<j.length?j.find(function(G){return G.nameType==="OFFICIAL"}):{}}}]),_e}(),H_=["origin","destination"],V_=function(){function _e(){var _=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};if(d(this,_e),!_.apiKey&&!_.token)throw new Error("API key or Token is missing");this.config_=o({baseUrl:"https://meta-indoor-routing.api-gateway.ls.hereapi.com"},_)}return g(_e,[{key:"calculateRoute",value:function(G){var k=G.origin,k=k===void 0?{}:k,j=G.destination,j=j===void 0?{}:j,G=De(G,H_);if(!k.coordinates||!j.coordinates)throw new Error("Waypoint coordinates are missing");function _t(bc){var sd=bc.coordinates,Ba=bc.venueId,bc=bc.levelId,sd=sd.join(",");return Ba&&bc?sd.concat(";indoorMapId=",Ba,";levelId=",bc):sd}var _r=new URL("".concat(this.config_.baseUrl,"/v1/routes")),_s=new URLSearchParams({origin:_t(k),destination:_t(j),apiKey:this.config_.apiKey});return Object.entries(G).forEach(function(bc){var bc=_o(bc,2),Ba=bc[0],bc=bc[1];_s.append(Ba,l(bc)==="object"?JSON.stringify(bc):bc)}),_r.search=_s,fetch(_r,{headers:{"X-Api-Key":this.config_.apiKey}}).then(function(_a){return _a.json()})}}]),_e}(),C0={VENUE_DATA_LOADED:"VENUE_DATA_LOADED",VENUE_THEME_LOADED:"VENUE_THEME_LOADED",VENUE_ICONS_LOADED:"VENUE_ICONS_LOADED",VENUE_MOM_DATA_LOADED:"VENUE_MOM_DATA_LOADED",VENUE_ERROR_STATE:"VENUE_ERROR_STATE",VENUE_MAP_DATA_LOADED:"VENUE_MAP_DATA_LOADED",VENUE_ENTITY_DATA_LOADED:"VENUE_ENTITY_DATA_LOADED",VENUE_DATA_MODEL_LOADED:"VENUE_DATA_MODEL_LOADED",VENUE_NAV_DATA_LOADED:"VENUE_NAV_DATA_LOADED",META_DATA_LOADED:"META_DATA_LOADED",META_DATA_MODEL_LOADED:"META_DATA_MODEL_LOADED",META_DATA_MODEL_UPDATED:"META_DATA_MODEL_UPDATED"},Ny=(Object.freeze((v(Cy={},C0.VENUE_DATA_LOADED,{description:"event fired when all requested files along with metadata & overrides are loaded",emitTemplate:{}}),v(Cy,C0.VENUE_MAP_DATA_LOADED,{description:"event fired when requested levels, drawings & community files are loaded",emitTemplate:{}}),v(Cy,C0.VENUE_ENTITY_DATA_LOADED,{description:"event fired when requested entity data is loaded",emitTemplate:{}}),v(Cy,C0.VENUE_DATA_MODEL_LOADED,{description:"event fired when a map file is loaded",emitTemplate:{}}),v(Cy,C0.VENUE_NAV_DATA_LOADED,{description:"event fired when requested navigation product is loaded",emitTemplate:{}}),v(Cy,C0.META_DATA_LOADED,{description:"event fired when all requested meta files are loaded except icon & marker",emitTemplate:{}}),v(Cy,C0.META_DATA_MODEL_LOADED,{description:"event fired when a specific model is loaded except icon & marker",emitTemplate:{}}),v(Cy,C0.META_DATA_MODEL_UPDATED,{description:"event fired when a specific meta override is added or removed",emitTemplate:{}}),v(Cy,C0.VENUE_ICONS_LOADED,{description:"event fired when all icons of venue are loaded",emitTemplate:{}}),Cy)),new hy),t0=(Ny.EVENT_NAME=C0,Ny.on("newListener",function(_e){C0[_e]||console.warn("subscribing for un-registered/documented event")}),function(){m(_,H.map.Feature);var _e=ha(_);function _(k){var j;if(d(this,_),j=_e.call(this),k instanceof C_)return j.venueModel=k,j.search_=new t_(k),j.status_={activeDrawingId:k.getRootDrawing().getIdentifier(),activeLevelIndex:k.getRootDrawing().getMainLevel().getZIndex()},j.mapObjectStore_=j.getDefaultMapObjectsStore_(),j.drawings=k.getDrawings().map(function(G){return G=new pd(G),G.setParentEventTarget(_n(j)),G}),j.levels=k.getLevels().map(function(G){var _t=new oy(G);return _t.setParentEventTarget(j.drawings.find(function(_r){return _r.getIdentifier()===_t.getData().getDrawing().getIdentifier()})),_t}),j.geometries=k.getGeometries().map(function(G){var _t=new _p(G);return _t.setParentEventTarget(j.levels.find(function(_r){return _r.getIdentifier()===_t.getData().getLevel().getIdentifier()})),_t}),j.mutualExclusiveHighlight_=!1,j;throw new Error("It is mandatory to provide valid instance of venueModel")}return g(_,[{key:"getData",value:function(){return this.venueModel}},{key:"getBoundingBox",value:function(){return q(H.geo.Rect,_l(this.venueModel.getBoundingBox()))}},{key:"getCenter",value:function(){var j=_o(this.venueModel.getCenter(),2),k=j[0],j=j[1];return new H.geo.Point(j,k)}},{key:"getId",value:function(){return this.venueModel.getId()}},{key:"getIdentifier",value:function(){return this.venueModel.getIdentifier()}},{key:"getName",value:function(){return this.venueModel.getName()}},{key:"getDrawing",value:function(k){return this.drawings.find(function(j){return j.getIdentifier()===k})}},{key:"getDrawings",value:function(){return this.drawings}},{key:"getLevel",value:function(k){return this.levels.find(function(j){return j.getIdentifier()===k})}},{key:"getLevels",value:function(){return this.levels}},{key:"getGeometry",value:function(k){return this.getGeometries().find(function(j){return j.getIdentifier()===k})}},{key:"getGeometries",value:function(){return this.geometries}},{key:"getActiveLevels",value:function(){var k=this;return this.getData().getDisplaySettings()===j0.FLATTEN?this.venueModel.getLevelsByZIndex(this.status_.activeLevelIndex).map(function(j){return k.getLevel(j.getIdentifier())}):[this.venueModel.getDrawingById(this.status_.activeDrawingId).getLevelByZIndex(this.status_.activeLevelIndex)].map(function(j){return k.getLevel(j.getIdentifier())})}},{key:"getActiveDrawing",value:function(){return this.getDrawing(this.status_.activeDrawingId)}},{key:"setActiveDrawing",value:function(k){if(this.status_.activeDrawingId!==k){var j=this.venueModel.getDrawingById(k);if(!j)throw new Error("Drawing ".concat(k," was not found"));var G=this.status_.activeDrawingId;this.status_.activeDrawingId=j.id,this.setActiveLevelIndex(j.getMainLevel().getZIndex()),this.dispatchEvent(new H.util.ChangeEvent(_.EVENTS.DRAWING_CHANGE,k,G))}}},{key:"getActiveLevelIndex",value:function(){return this.status_.activeLevelIndex}},{key:"setActiveLevelIndex",value:function(k){var j;this.venueModel.getLevelsByZIndex(k)&&(j=this.status_.activeLevelIndex,this.status_.activeLevelIndex=k,this.dispatchEvent(new H.util.ChangeEvent(_.EVENTS.LEVEL_CHANGE,k,j)))}},{key:"isActive",value:function(){var k=this.getParentEventTarget();return!!k&&this===k.activeVenue}},{key:"getHighlightedGeometries",value:function(){var k=this;return this.venueModel.getGeometries().filter(function(j){return j.isHighlighted()}).map(function(j){return k.getGeometry(j.getIdentifier())})}},{key:"setHighlightedGeometries",value:function(){var k=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],j=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[],_t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{},G=3<arguments.length&&arguments[3]!==void 0&&arguments[3],_t=o(o({},G0),_t),_r=_t.fillColor,_s=_t.outlineColor,_a=_t.outlineWidth;this.mutualExclusiveHighlight_=!!G,this.mutualExclusiveHighlight_&&this.getHighlightedGeometries().forEach(function(Ba){Ba.getData().highlight(!1)}),j.forEach(function(Ba){Ba.getData().highlight(k,{m:_r,o:_s,w:_a})}),this.dispatchEvent(_.EVENTS.GEOMETRY_HIGHLIGHT)}},{key:"getMapObjects",value:function(){var k=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.getActiveLevelIndex(),j=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.getActiveDrawing();return this.mapObjectStore_[k][j.getIdentifier()]}},{key:"setMapObjects",value:function(){var k=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],j=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.getActiveLevelIndex(),G=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.getActiveDrawing();this.mapObjectStore_[j]&&this.mapObjectStore_[j][G.getIdentifier()]&&(this.mapObjectStore_[j][G.getIdentifier()]=_l(k)),this.updateMapObjectsVisibility_()}},{key:"search",value:function(){var k=this;return this.search_.find(0<arguments.length&&arguments[0]!==void 0?arguments[0]:"").flatMap(function(j){return j.geometries.map(function(G){return k.getGeometry(G.id)})})}},{key:"updateMapObjectsVisibility_",value:function(){Object.values(this.mapObjectStore_).forEach(function(k){Object.values(k).forEach(function(j){return j.forEach(function(G){return G.setVisibility(!1)})})}),this.isActive()&&this.mapObjectStore_[this.getActiveLevelIndex()][this.getActiveDrawing().getIdentifier()].forEach(function(k){return k.setVisibility(!0)})}},{key:"getDefaultMapObjectsStore_",value:function(){var k=this,j=this.getData().getDisplaySettings()===j0.FLATTEN;return this.venueModel.getLevels().reduce(function(_s,_t){var _r=_t.getZIndex(),_s=o({},_s);return _s[_r]||(_s[_r]={}),_s[_r][_t.getDrawing().getIdentifier()]=[],j&&(_s[_r][k.venueModel.getRootDrawing().getIdentifier()]=[]),_s},{})}}]),_}()),y_=(t0.EVENTS={ACTIVE_VENUE_CHANGE:"activevenuechange",DRAWING_CHANGE:"drawingchange",LEVEL_CHANGE:"levelchange",GEOMETRY_HIGHLIGHT:"geometryhighlight"},function(){function _e(){d(this,_e)}return g(_e,null,[{key:"getIconLayer",value:function(){return{type:"FeatureCollection",features:(0<arguments.length&&arguments[0]!==void 0?arguments[0]:[]).flatMap(function(_){return _.getData().getGeometries()}).filter(function(_){return _.isIcon()&&_.getIcon()}).map(function(_){var j=_o(_.getLabelArea(),2),k=j[0],j=j[1],G=_.getLevel(),_t=_.getIcon(),_r=_.properties.spaceType||_.properties.spaceCategory||_.getDisplayName();return{type:"Feature",properties:{id:_.getIdentifier(),geometryId:_.getIdentifier(),levelId:G.getIdentifier(),name:_r,venueId:G.getDrawing().getVenueModel().getIdentifier(),url:_t?"data:image/svg+xml;utf8,".concat(encodeURIComponent(_t)):""},geometry:{type:l0.POINT,coordinates:[k,j]}}})}}},{key:"getLabelLayer",value:function(){return{type:"FeatureCollection",features:(0<arguments.length&&arguments[0]!==void 0?arguments[0]:[]).flatMap(function(_){return _.getData().getGeometries()}).filter(function(_){return _.getDisplayName()&&!_.isIcon()}).map(function(_){var j=_o(_.getLabelArea(),2),k=j[0],j=j[1],_t=_.getLabelStyle(),G=_t.fill,_t=_t.zmin,_r=_.getLevel();return{type:"Feature",properties:{id:_.getIdentifier(),geometryId:_.getIdentifier(),levelId:_r.getIdentifier(),venueId:_r.getDrawing().getVenueModel().getIdentifier(),name:_.getDisplayName(),minZoom:_t||15,textFillColor:G.toLowerCase()},geometry:{type:l0.POINT,coordinates:[k,j]}}})}}},{key:"getGeometryLayer",value:function(){return{type:"FeatureCollection",features:(0<arguments.length&&arguments[0]!==void 0?arguments[0]:[]).flatMap(function(_){return _.getData().getGeometries()}).filter(function(_){return _.getType()!==l0.POINT}).map(function(_){var G=_.getHighlightedStyle()||{},k=G.m,j=G.o,G=G.w,_s=o({},_.getStyle()),_t=_s.m,_r=_s.o,_s=_s.w,bc=g0,_a=bc.fillColor,Ba=bc.outlineColor,bc=bc.outlineWidth,sd=_.getLevel();return{type:"Feature",properties:{id:_.getIdentifier(),fillColor:(k||_t||_a).toLowerCase(),geometryId:_.getIdentifier(),levelId:sd.getIdentifier(),venueId:sd.getDrawing().getVenueModel().getIdentifier(),outlineColor:(j||_r||Ba).toLowerCase(),outlineWidth:Number(((G||_s||bc)/3).toFixed(2)),zIndex:_.getZIndex()},geometry:{type:_.getType(),coordinates:_.getCoordinates()}}})}}},{key:"getFootprintLayer",value:function(_){return{type:"FeatureCollection",features:_.flatMap(function(k){var j=k.getData().getRootDrawing().getMainLevel().getIdentifier(),G=k.getLevel(j).getData().getGeometries().filter(function(_t){return _t.getType()===l0.POLYGON});return[{type:"Feature",properties:{isFootprint:!0,levelId:j,venueId:k.getIdentifier(),zIndex:1},geometry:{type:"MultiPolygon",coordinates:G.map(function(_t){return _t.getCoordinates()})}},{type:"Feature",properties:{isFootprint:!0,levelId:j,venueId:k.getIdentifier(),zIndex:2,venueName:k.getName()},geometry:{type:"Point",coordinates:k.getCenter().toGeoJSON().coordinates.slice(0,2)}}]})}}}]),_e}()),q_=function(){function _e(){d(this,_e)}return g(_e,null,[{key:"getStyle",value:function(){var _=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],k=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[],j={styles:[{layer:r0.FOOTPRINT,when:["==",["geometry-type"],"Polygon"],technique:"solid-line",color:"#613F8E",lineWidth:"2px",renderOrder:1},{layer:r0.FOOTPRINT,when:["==",["geometry-type"],"Polygon"],technique:"fill",color:"#AF91B4",renderOrder:2},{layer:r0.FOOTPRINT,when:["==",["geometry-type"],"Point"],technique:"text",color:"black",size:16,text:["get","venueName"],priority:61},{layer:r0.VECTOR,when:["==",["geometry-type"],"Polygon"],technique:"fill",color:["get","fillColor"],renderOrder:["get","zIndex"]},{layer:r0.VECTOR,technique:"solid-line",color:["get","outlineColor"],lineWidth:["get","outlineWidth"],renderOrder:["get","zIndex"]},{layer:r0.TEXT,minZoomLevel:["get","minZoom"],technique:"text",color:["get","textFillColor"],size:F0.size,text:["get","name"],priority:60},{layer:r0.ICON,minZoomLevel:m0,when:["==",["geometry-type"],"Point"],technique:"labeled-icon",textIsOptional:!0,size:0,imageTexture:["concat","texture",["get","name"]],screenWidth:["interpolate",["linear"],["zoom"],15,3,21,70],screenHeight:["interpolate",["linear"],["zoom"],15,3,21,70],priority:61}],images:{},imageTextures:[]};return _.forEach(function(G){var _t="texture"+G.properties.name;j.images[_t]||(j.images[_t]={url:G.properties.url,preload:!0},j.imageTextures.push({name:_t,image:_t}))}),k.forEach(function(G){var _t,_a=G.getData().getHighlightedStyle(),_r=_a.m,_s=_a.o,_a=_a.w;(_t=j.styles).push.apply(_t,[{layer:r0.VECTOR,when:["==",["get","id"],G.id],technique:"fill",color:_r,renderOrder:["get","zIndex"]},{layer:r0.VECTOR,when:["==",["get","id"],G.id],technique:"solid-line",color:_s,lineWidth:_a,renderOrder:["get","zIndex"]}])}),new H.map.render.harp.Style(j)}}]),_e}(),$_=function(){function _e(){d(this,_e)}return g(_e,null,[{key:"getIconsTextures",value:function(){var _={},k={},j=(0<arguments.length&&arguments[0]!==void 0?arguments[0]:[]).reduce(function(G,_t){var _r=_t.properties.name;return G[_r]||(G[_r]=[]),G[_r].push(_t),G},{});return Object.keys(j).forEach(function(G){var _t="texture".concat(G),_r="sprite".concat(G),_s=j[G][0].properties.url;_[_t]={url:_s,sprites:v({},_r,[0,0,50,50])},j[G].forEach(function(_a){_a=_a.properties,k["icon".concat(_a.name)]={filter:{name:_a.name,$zoom:{min:m0}},draw:{points:{interactive:!0,priority:1,size:[[15,"50%"],[16,"55%"],[17,"60%"],[18,"65%"],[19,"75%"],[20,"80%"],[21,"100%"]],texture:_t,sprite:_r}}}})}),{textures:_,iconLayers:k}}},{key:"getFootprintLayer",value:function(){return{data:{source:"venues",layer:r0.FOOTPRINT},draw:{polygons:{interactive:!0,color:"#AF91B4",order:2},lines:{color:"#613F8E",width:"2px",order:1},points:{color:"[0, 0, 0, 0]",size:"0px",order:3,priority:1,text:{anchor:"center",collide:!1,font:{fill:"black",size:"16px"},text_source:"function() { return feature.venueName }"}}}}}},{key:"getGeometryLayer",value:function(){var _,k,j,G=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],_t={};return G.length&&(_=(j=G[0].getData().getHighlightedStyle()).m,k=j.o,j=j.w,_t={filter:{id:G.map(function(_r){return _r.id})},draw:{polygons:{interactive:!0,color:_},lines:{color:k,width:j}}}),{data:{source:"venues",layer:r0.VECTOR},draw:{polygons:{interactive:!0,color:"function() { return feature.fillColor }",order:"function() { return feature.zIndex }"},lines:{color:"function() { return feature.outlineColor }",order:"function() { return feature.zIndex }",width:"function() { return feature.outlineWidth }"}},highlighted:_t}}},{key:"getTextLayer",value:function(){return{filter:{$zoom:{min:A0}},data:{source:"venues",layer:r0.TEXT},draw:{points:{filter:"function() { return $zoom > feature.minZoom }",color:"[0, 0, 0, 0]",size:"0px",offset:["0px","-10px"],priority:2,text:{font:{fill:"function() { return feature.textFillColor }",size:F0.size},text_source:"function() { return feature.name }"}}}}}},{key:"getIconLayer",value:function(_){return o({data:{source:"venues",layer:r0.ICON}},_)}},{key:"getStyle",value:function(){var j=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],k=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[],j=_e.getIconsTextures(j),_=j.textures,j=j.iconLayers,k={venue_footprints:_e.getFootprintLayer(),venue_geometries:_e.getGeometryLayer(k),venue_labels:_e.getTextLayer(),venue_icons:_e.getIconLayer(j)},j=H.gl.yaml.safeDump({sources:{venues:{max_zoom:b_,type:"GeoJSONTileSource"}},layers:k,textures:_});return new H.map.render.webgl.Style(j)}}]),_e}(),W_={type:"FeatureCollection",features:[]},E_={extent:4096,indexMaxZoom:0,maxZoom:24,tolerance:3},Cy=function(){m(_,H.map.provider.RemoteTileProvider);var _e=ha(_);function _(k){return d(this,_),(k=_e.call(this,k)).venues=[],k.activeVenue=null,k.dataLayers_={},k.tileIndexes_={},k.addEventListener(t0.EVENTS.ACTIVE_VENUE_CHANGE,k.activeVenueChangeHandler_,void 0,_n(k)),k}return g(_,[{key:"setStyle",value:function(k){return this.setStyleInternal(k)}},{key:"getStyle",value:function(){return this.getStyleInternal()}},{key:"isFeatureVisible_",value:function(k,j){var G=k.properties;return this.activeVenue&&G.venueId===this.activeVenue.getIdentifier()?j!==r0.FOOTPRINT&&this.activeVenue.getActiveLevels().some(function(_t){return _t.id===G.levelId}):G.isFootprint===!0&&j===r0.FOOTPRINT}},{key:"requestInternal",value:function(k,j,G,_t){function _r(Ba){for(var bc=0;bc<Ba.length;bc+=1)Ba[bc]=Ba[bc].map(function(sd){return b0(sd,G,k,j,E_.extent)})}var _s=this,_a={};return Object.keys(this.tileIndexes_).forEach(function(Ba){var bc=_s.tileIndexes_[Ba].getTile(G,k,j);_a[Ba]=bc?Q0(bc):W_,_a[Ba].features=_a[Ba].features.filter(function(by){return _s.isFeatureVisible_(by,Ba)});for(var sd=0;sd<_a[Ba].features.length;sd+=1){var ad=_a[Ba].features[sd],dy=ad.geometry.type;if(dy===l0.POLYGON||dy===l0.MULTI_LINESTRING)_r(ad.geometry.coordinates);else if(dy===l0.MULTI_POLYGON)ad.geometry.coordinates.map(_r);else for(var gy=ad.geometry.coordinates,ay=0;ay<gy.length;ay+=1)gy[ay]=b0(gy[ay],G,k,j,E_.extent)}}),_t(_a),{cancel:function(){}}}},{key:"getActiveVenue",value:function(){return this.activeVenue}},{key:"getVenue",value:function(k){return k?this.venues.find(function(j){return j.getIdentifier()===k}):this.activeVenue}},{key:"setActiveVenue",value:function(k){var j=this.activeVenue;this.activeVenue=k,this.dispatchEvent(new H.util.ChangeEvent(t0.EVENTS.ACTIVE_VENUE_CHANGE,k,j)),this.reload()}},{key:"addVenue",value:function(k){var j=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(!(k instanceof t0))throw new Error("Invalid argument");var G=k.getIdentifier();if(this.getVenue(G))throw new Error("Please invoke provider.removeVenue to remove old instance of venue ".concat(G," before adding new"));k.setParentEventTarget(this),this.venues.push(k),j||(this.reloadData_(),this.reloadStyle_())}},{key:"addVenues",value:function(){var k=this,j=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[];0<j.length&&(j.forEach(function(G){G instanceof t0&&k.addVenue(G,!0)}),this.reloadData_(),this.reloadStyle_())}},{key:"removeVenue",value:function(k){var j;k instanceof t0&&-1<this.venues.indexOf(k)&&(j=k.getIdentifier(),this.activeVenue&&this.activeVenue.getIdentifier()===j&&this.setActiveVenue(null),this.venues.splice(this.venues.indexOf(k),1),this.reloadData_(),this.reloadStyle_(),this.reload())}},{key:"getFeatureProxy",value:function(_r,j,G){var _t=_r.geometryId,_r=_r.venueId,_r=this.getVenue(_r);return _t?G(_r.getGeometries().find(function(_s){return _s.id===_t})):_r&&G(_r),!0}},{key:"addVenueEventListeners_",value:function(k){k&&(k.addEventListener(t0.EVENTS.GEOMETRY_HIGHLIGHT,this.geometryHighlightHandler_,void 0,this),k.addEventListener(t0.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),k.addEventListener(t0.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this))}},{key:"removeVenueEventListeners_",value:function(k){k&&(k.removeEventListener(t0.EVENTS.GEOMETRY_HIGHLIGHT,this.geometryHighlightHandler_,void 0,this),k.removeEventListener(t0.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),k.removeEventListener(t0.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this))}},{key:"activeVenueChangeHandler_",value:function(G){var j=G.oldValue,G=G.newValue;j&&(this.removeVenueEventListeners_(j),j.updateMapObjectsVisibility_()),G&&(this.addVenueEventListeners_(G),G.updateMapObjectsVisibility_())}},{key:"drawingChangeHandler_",value:function(){this.reload()}},{key:"levelChangeHandler_",value:function(){this.activeVenue&&(this.activeVenue.updateMapObjectsVisibility_(),this.reload())}},{key:"geometryHighlightHandler_",value:function(){this.reloadStyle_(this.activeVenue.getHighlightedGeometries())}},{key:"createDataLayers_",value:function(){var k=this,j=0<arguments.length&&arguments[0]!==void 0?arguments[0]:Object.keys(r0),G=r0.FOOTPRINT,_t=r0.ICON,_r=r0.TEXT,_s=r0.VECTOR;j.forEach(function(_a){switch(_a){case _s:k.dataLayers_[_s]=y_.getGeometryLayer(k.venues);break;case G:k.dataLayers_[G]=y_.getFootprintLayer(k.venues);break;case _t:k.dataLayers_[_t]=y_.getIconLayer(k.venues);break;case _r:k.dataLayers_[_r]=y_.getLabelLayer(k.venues);break;default:throw new Error("Unsupported Layer ".concat(_a))}})}},{key:"createTileIndexes_",value:function(){var k=this;(0<arguments.length&&arguments[0]!==void 0?arguments[0]:Object.keys(r0)).forEach(function(j){k.tileIndexes_[j]=new d0(k.dataLayers_[j],E_)})}},{key:"reloadData_",value:function(){var k=0<arguments.length&&arguments[0]!==void 0?arguments[0]:Object.keys(r0);this.createDataLayers_(k),this.createTileIndexes_(k)}},{key:"reloadStyle_",value:function(k){var j=this.dataLayers_[r0.ICON]?this.dataLayers_[r0.ICON].features:[];this.getEngineType()===H.Map.EngineType.WEBGL?this.setStyle($_.getStyle(j,k)):this.getEngineType()===H.Map.EngineType.HARP&&this.setStyle(q_.getStyle(j,k))}},{key:"providesGeoJSON",value:function(){return!0}}]),_}(),Y_=new H.map.SpatialStyle({strokeColor:"#1ab4bf",lineWidth:3}),X_=new H.map.SpatialStyle({strokeColor:"#1ab4bf",lineWidth:3}),K_=new H.map.Icon("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDQwIDUwIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGRlZnM+PHBhdGggaWQ9ImIiIGQ9Ik0zNC4yNSAzMS42NTJBMTkuMDE1IDE5LjAxNSAwIDAgMCAzOSAxOS4wNkMzOSA4LjU0OSAzMC40NzggMCAyMCAwUzEgOC41NSAxIDE5LjA1OWMwIDQuODIzIDEuNzk1IDkuMjMzIDQuNzUgMTIuNTkzTDE5Ljk3NSA0NiAzNC4yNSAzMS42NTJ6Ii8+PHBhdGggaWQ9ImEiIGQ9Ik0zNC4yNSAzMS42NTJBMTkuMDE1IDE5LjAxNSAwIDAgMCAzOSAxOS4wNkMzOSA4LjU0OSAzMC40NzggMCAyMCAwUzEgOC41NSAxIDE5LjA1OWMwIDQuODIzIDEuNzk1IDkuMjMzIDQuNzUgMTIuNTkzTDE5Ljk3NSA0NiAzNC4yNSAzMS42NTJ6Ii8+PG1hc2sgaWQ9ImMiIHdpZHRoPSIzOCIgaGVpZ2h0PSI0NiIgeD0iMCIgeT0iMCIgZmlsbD0iI2ZmZiI+PHVzZSB4bGluazpocmVmPSIjYSIvPjwvbWFzaz48L2RlZnM+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48ZWxsaXBzZSBjeD0iMjAiIGN5PSI0NS4xNiIgZmlsbD0iI0ZGRiIgc3Ryb2tlPSIjOTc5Nzk3IiBzdHJva2Utd2lkdGg9Ii4yNSIgcng9IjMuNSIgcnk9IjMuNSIvPjx1c2UgZmlsbD0iIzAxQjZCMiIgeGxpbms6aHJlZj0iI2IiLz48cGF0aCBmaWxsPSIjMzIzMjMyIiBmaWxsLW9wYWNpdHk9Ii41IiBkPSJNMTEuODEgMzcuNjZoMTYuMzhsLTguMiA4eiIvPjx1c2Ugc3Ryb2tlPSIjNDE2QTg2IiBzdHJva2Utd2lkdGg9Ii41IiBtYXNrPSJ1cmwoI2MpIiB4bGluazpocmVmPSIjYSIvPjxlbGxpcHNlIGN4PSIxOS44MSIgY3k9IjE5LjE5IiBmaWxsPSIjRkZGIiByeD0iNC44MSIgcnk9IjQuODEiLz48L2c+PC9zdmc+"),Z_=new H.map.Icon("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDQwIDUwIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGRlZnM+PHBhdGggaWQ9ImEiIGQ9Ik0zNC4yNSAzMS42NTJBMTkuMDE1IDE5LjAxNSAwIDAgMCAzOSAxOS4wNkMzOSA4LjU0OSAzMC40NzggMCAyMCAwUzEgOC41NSAxIDE5LjA1OWMwIDQuODIzIDEuNzk1IDkuMjMzIDQuNzUgMTIuNTkzTDE5Ljk3NSA0NiAzMi44MyAzMy4xMDRjLjQwNy0uMzc0IDEuNDE5LTEuNDUyIDEuNDE5LTEuNDUyeiIvPjxtYXNrIGlkPSJjIiB3aWR0aD0iMzgiIGhlaWdodD0iNDYiIHg9IjAiIHk9IjAiIGZpbGw9IiNmZmYiPjx1c2UgeGxpbms6aHJlZj0iI2EiLz48L21hc2s+PGVsbGlwc2UgaWQ9ImIiIGN4PSIxOS44MDciIGN5PSIxOS4xNjgiIHJ4PSIxMi4zNjMiIHJ5PSIxMi4xOTciLz48bWFzayBpZD0iZCIgd2lkdGg9IjI1LjcyNSIgaGVpZ2h0PSIyNS4zOTQiIHg9Ii0uNSIgeT0iLS41Ij48cGF0aCBmaWxsPSIjZmZmIiBkPSJNNi45NDQgNi40NzFoMjUuNzI1djI1LjM5NEg2Ljk0NHoiLz48dXNlIHhsaW5rOmhyZWY9IiNiIi8+PC9tYXNrPjwvZGVmcz48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxlbGxpcHNlIGN4PSIyMCIgY3k9IjQ1LjE2IiBmaWxsPSIjRkZGIiBzdHJva2U9IiM5Nzk3OTciIHN0cm9rZS13aWR0aD0iLjI1IiByeD0iMy41IiByeT0iMy41Ii8+PHVzZSBmaWxsPSIjMzIzMjMyIiB4bGluazpocmVmPSIjYSIvPjxwYXRoIGZpbGw9IiM3RDdEN0QiIGQ9Ik0xMi4wMTEgMzcuODA1aDE1Ljk3OGwtNy45MTYgOHoiLz48dXNlIHN0cm9rZT0iIzdDN0M3QyIgc3Ryb2tlLXdpZHRoPSIuNSIgbWFzaz0idXJsKCNlKSIgeGxpbms6aHJlZj0iI2EiLz48dXNlIHN0cm9rZT0iI0ZGRiIgc3Ryb2tlLXdpZHRoPSIuNSIgbWFzaz0idXJsKCNjKSIgeGxpbms6aHJlZj0iI2EiLz48ZWxsaXBzZSBmaWxsPSIjRkZGIiBjeD0iMTkuODA3IiBjeT0iMTkuMTY4IiByeD0iMTIuMzYzIiByeT0iMTIuMTk3Ii8+PHBhdGggZmlsbD0iIzMyMzIzMiIgZD0iTTYuODEyIDYuOTQ4aDYuNDV2Ni4zNjRoLTYuNDV6bTAgMTIuNzI3aDYuNDV2Ni4zNjRoLTYuNDV6bTYuNDUtNi4zNjNoNi40NXY2LjM2NGgtNi40NXptMCAxMi43MjdoNi40NXY2LjM2NGgtNi40NXptNi40NS0xOS4wOTFoNi40NXY2LjM2NGgtNi40NXptMCAxMi43MjdoNi40NXY2LjM2NGgtNi40NXptNi40NS02LjM2M2g2LjQ1djYuMzY0aC02LjQ1em0wIDEyLjcyN2g2LjQ1djYuMzY0aC02LjQ1eiIvPjx1c2Ugc3Ryb2tlPSIjRkZGIiBtYXNrPSJ1cmwoI2QpIiB4bGluazpocmVmPSIjYiIgc3Ryb2tlLWxpbmVjYXA9InNxdWFyZSIvPjwvZz48L3N2Zz4="),g_=function(){function _e(_,k){d(this,_e),this.indoorMapObjects_=null,this.outdoorMapObjects_=null,this.createRouteObjects_(_,k)}return g(_e,[{key:"createRouteObjects_",value:function(_){for(var k=this,_=_.sections,j=_===void 0?[]:_,G=1<arguments.length&&arguments[1]!==void 0?arguments[1]:i0,_t=(this.indoorMapObjects_={},this.outdoorMapObjects_=new H.map.Group,function(_a){var Ba,bc=j[_a],ad=bc.departure.place,sd=ad.id,ad=ad.type,dy=H.util.flexiblePolyline.decode(bc.polyline).polyline,gy=void 0,ay=void 0,by=G(_a,j,_e.ObjectType.SEGMENT_START_MARKER),by=(by&&(gy=new H.map.Marker(bc.departure.place.location,{icon:by})),G(_a,j,_e.ObjectType.SEGMENT_FINISH_MARKER)),py=(by&&(ay=new H.map.Marker(bc.arrival.place.location,{icon:by})),G(_a,j,_e.ObjectType.SEGMENT_POLYLINE));ad==="indoor"?(by=function(){var iy=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],ey=new Map,ry=new H.geo.LineString,uy=_o(iy[0],3)[2];return ey.set(uy,[ry]),iy.forEach(function(Ey){Ey[2]!==uy&&(uy=Ey[2],ry=new H.geo.LineString,ey.has(uy)?ey.get(uy).push(ry):ey.set(uy,[ry])),ry.pushLatLngAlt.apply(ry,_l(Ey))}),ey}(dy),Ba=Array.from(by.keys()).reduce(function(iy,ey){return iy[ey]||(iy[ey]=new H.map.Group),iy},{}),py&&by.forEach(function(iy,ey){iy.forEach(function(ry){1<ry.getPointCount()&&(ry=new H.map.Polyline(ry,{style:py}),Ba[ey].addObject(ry))})}),gy&&Ba[bc.departure.place.location.lvl].addObject(gy),ay&&Ba[bc.arrival.place.location.lvl].addObject(ay),k.indoorMapObjects_[sd]=o(o({},k.indoorMapObjects_[sd]||{}),Ba)):(py&&(_a=new H.geo.LineString(dy.flatMap(function(iy){return[iy[0],iy[1],0]})),ad=new H.map.Polyline(_a,{style:py}),k.outdoorMapObjects_.addObject(ad)),gy&&k.outdoorMapObjects_.addObject(gy),ay&&k.outdoorMapObjects_.addObject(ay))}),_r=0;_r<j.length;_r++)_t(_r)}},{key:"getIndoorObjects",value:function(){return this.indoorMapObjects_}},{key:"getOutdoorObjects",value:function(){return this.outdoorMapObjects_}}]),_e}(),T_=(g_.ObjectType={SEGMENT_START_MARKER:1,SEGMENT_FINISH_MARKER:2,SEGMENT_POLYLINE:3},function(){m(_,H.service.Service);var _e=ha(_);function _(k){d(this,_),j=_e.call(this,_,o(o({},k),{},{baseUrl:void 0}));var j,G={apiKey:k.apikey,baseUrl:k.baseUrl,token:k.token},_t={apiKey:G.apiKey,token:G.token},_r=(G.apiKey||(G.apiKey=j.getUrl().getQuery().apikey),k.useLegacy||!1);return j.venueService_=new M_(G,_r),_t.apiKey||(_t.apiKey=j.getUrl().getQuery().apikey),k.routingBaseUrl&&(_t.baseUrl=k.routingBaseUrl),j.routingService_=new V_(_t),j}return g(_,[{key:"loadVenue",value:function(k){return console.warn("Venue service version 1 is no longer supported hence "+k+" could not be loaded"),Promise.resolve()}},{key:"calculateRoute",value:function(k){return console.warn("HERE Indoor Routing is deprecated and will be removed soon."),this.routingService_.calculateRoute(k)}}]),_}()),v_=(T_.CONFIG_KEY="venues",function(){m(_,H.service.Service);var _e=ha(_);function _(_t){d(this,_),j=_e.call(this,_,o(o({},_t),{},{baseUrl:void 0}));var j,G={apiKey:_t.apikey,baseUrl:_t.baseUrl,token:_t.token,hrn:_t.hrn},_t=(G.apiKey||(G.apiKey=j.getUrl().getQuery().apikey),_t.useLegacy||!1);return j.venueService_=new M_(G,_t),j}return g(_,[{key:"loadVenue",value:function(k){return this.venueService_.load(k,1<arguments.length&&arguments[1]!==void 0?arguments[1]:{}).then(function(j){return new t0(j)})}},{key:"getMapInfoList",value:function(){return this.venueService_.getSupportedMapList()}}]),_}()),Ny=(v_.CONFIG_KEY="indoorMaps",H.service.Platform.prototype.getVenuesService=function(_e,_){var k=v_;return _!==1&&_?_!==l_.v2||_e.token||(_e.hrn?_e.apikey||console.error("Venue Service version 2 requires either apikey or token"):console.error("Token is mandatory when Hrn is not provided in Venue Service version 2")):(console.warn("Venue service version 1 is no longer supported"),k=T_),this.createService(k,_e)},v_.LABEL_TEXT_PREFERENCE_OVERRIDE={OCCUPANT_NAMES:"OCCUPANT_NAMES",SPACE_NAME:"SPACE_NAME",SPACE_TYPE_NAME:"SPACE_TYPE_NAME",SPACE_CATEGORY_NAME:"SPACE_CATEGORY_NAME",INTERNAL_ADDRESS:"INTERNAL_ADDRESS"},function(){m(_,H.ui.Control);var _e=ha(_);function _(k){var j,G=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};return d(this,_),(j=_e.call(this)).provider_=null,j.levelSelectorUI_=null,j.setAlignment(G&&G.alignment||H.ui.LayoutAlignment.RIGHT_BOTTOM),j.addClass("venues-ui"),k instanceof t0&&j.setVenue(k),j}return g(_,[{key:"renderInternal",value:function(k,j){ga(w(_.prototype),"renderInternal",this).call(this,k,j),this.createLevelSelectorUI_(k),this.venue&&this.setVenue(this.venue)}},{key:"setVenue",value:function(k){k instanceof t0&&(this.removeEventListeners_(),this.venue=k,this.provider_=k.getParentEventTarget(),this.update_(),this.addEventListeners_())}},{key:"createLevelSelectorUI_",value:function(k){var j=this;k.innerHTML="",this.levelSelectorUI_=null,this.levelSelectorUI_=new S0(k,null,null,function(G){return j.venue.setActiveLevelIndex(G)})}},{key:"update_",value:function(){var k,j;this.levelSelectorUI_&&(k=this.venue.getActiveDrawing().getData(),j=this.venue.getData().getDisplaySettings(),this.levelSelectorUI_.update(k,j),this.levelChangeHandler_())}},{key:"addEventListeners_",value:function(){this.venue&&(this.venue.addEventListener(t0.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),this.venue.addEventListener(t0.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this)),this.provider_&&this.provider_.addEventListener(t0.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"removeEventListeners_",value:function(){this.venue&&(this.venue.removeEventListener(t0.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),this.venue.removeEventListener(t0.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this)),this.provider_&&this.provider_.removeEventListener(t0.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"levelChangeHandler_",value:function(){this.levelSelectorUI_.switch(this.venue.getActiveLevelIndex())}},{key:"drawingChangeHandler_",value:function(){this.update_()}},{key:"activeVenueChangeHandler_",value:function(k){this.setVenue(k.newValue)}}]),_}()),A_=function(){m(_,H.ui.Control);var _e=ha(_);function _(k){var j,G=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};return d(this,_),(j=_e.call(this)).provider_=null,j.drawingSelectorUI_=null,j.addClass("venues-ui"),j.setAlignment(G&&G.alignment||H.ui.LayoutAlignment.RIGHT_BOTTOM),k instanceof t0&&j.setVenue(k),j}return g(_,[{key:"renderInternal",value:function(k,j){ga(w(_.prototype),"renderInternal",this).call(this,k,j),this.createDrawingSelectorUI_(k),this.venue&&this.setVenue(this.venue)}},{key:"setVenue",value:function(k){k instanceof t0&&(this.removeEventListeners_(),this.venue=k,this.provider_=k.getParentEventTarget(),this.drawingSelectorUI_&&this.drawingSelectorUI_.update(k.getData()),this.addEventListeners_())}},{key:"createDrawingSelectorUI_",value:function(k){var j=this;k.innerHTML="",this.drawingSelectorUI_=null,this.drawingSelectorUI_=new Xy(k,null,function(G){return j.venue.setActiveDrawing(G)})}},{key:"addEventListeners_",value:function(){this.venue&&this.venue.addEventListener(t0.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this),this.provider_&&this.provider_.addEventListener(t0.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"removeEventListeners_",value:function(){this.venue&&this.venue.removeEventListener(t0.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this),this.provider_&&this.provider_.removeEventListener(t0.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"drawingChangeHandler_",value:function(){this.drawingSelectorUI_.switch(this.venue.getActiveDrawing().id)}},{key:"activeVenueChangeHandler_",value:function(k){this.setVenue(k.newValue)}}]),_}(),A_=Object.freeze({__proto__:null,DrawingControl:A_,LevelControl:Ny});return r(`.venues-ui * {
  font-family: "Fira Sans", "Helvetica Neue", Helvetica, sans-serif;
  color: #0F1621;
}
.venues-ui .arrow {
  display: block;
  width: 100%;
  height: 100%;
  background-repeat: no-repeat;
  background-position: center;
}
.venues-ui .arrow--up {
  background-image: url("data:image/svg+xml,%0A%3Csvg width='13px' height='9px' viewBox='0 0 13 9' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cg id='VenueMap_Facilities_Detail' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3E%3Cg id='Floorplan-Switcher' transform='translate(-426.000000, -584.000000)' fill='%23383C45'%3E%3Cg id='Map-Controls-Copy' transform='translate(417.753906, 572.000000)'%3E%3Cg id='Chevron,-Dark' transform='translate(15.000000, 16.499023) rotate(-180.000000) translate(-15.000000, -16.499023) translate(9.000000, 12.749023)'%3E%3Cpath d='M6.0105,7.5 L4.1895,5.76404817 L0.1695,1.90510321 C0.057,1.79759174 0,1.68291284 0,1.56106651 C0,1.44065367 0.057,1.32597477 0.1695,1.2184633 L1.2465,0.16771789 C1.347,0.0587729358 1.47,0.00430045872 1.617,0.00430045872 C1.764,0.00430045872 1.887,0.0587729358 1.986,0.166284404 L6.009,3.98365826 L10.023,0.161983945 C10.122,0.0530389908 10.236,0 10.3695,0 C10.503,0 10.62,0.0530389908 10.7205,0.161983945 L11.841,1.21129587 C12.0525,1.43922018 12.0525,1.67144495 11.8425,1.89793578 L7.827,5.76118119 L6.0105,7.5 Z' id='Fill-3'%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
}
.venues-ui .arrow--down {
  background-image: url("data:image/svg+xml,%0A%3Csvg width='13px' height='9px' viewBox='0 0 13 9' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cg id='VenueMap_Facilities_Detail' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3E%3Cg id='Floorplan-Switcher' transform='translate(-347.000000, -704.000000)' fill='%23383C45'%3E%3Cg id='Map-Controls' transform='translate(338.251953, 572.000000)'%3E%3Cg id='Chevron,-Dark' transform='translate(9.000000, 132.746094)'%3E%3Cpath d='M6.0105,7.5 L4.1895,5.76404817 L0.1695,1.90510321 C0.057,1.79759174 0,1.68291284 0,1.56106651 C0,1.44065367 0.057,1.32597477 0.1695,1.2184633 L1.2465,0.16771789 C1.347,0.0587729358 1.47,0.00430045872 1.617,0.00430045872 C1.764,0.00430045872 1.887,0.0587729358 1.986,0.166284404 L6.009,3.98365826 L10.023,0.161983945 C10.122,0.0530389908 10.236,0 10.3695,0 C10.503,0 10.62,0.0530389908 10.7205,0.161983945 L11.841,1.21129587 C12.0525,1.43922018 12.0525,1.67144495 11.8425,1.89793578 L7.827,5.76118119 L6.0105,7.5 Z' id='Fill-3'%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
}
.venues-ui .venues-ui-button {
  display: block;
  width: 40px;
  height: 40px;
  line-height: 40px;
  font-size: 16px;
  font-weight: 600;
  background-color: #fff;
  border: none;
  border-bottom: 1px solid #9FA2A6;
  cursor: pointer;
  overflow: hidden;
  color: #6e737a;
  text-align: center;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.venues-ui .venues-ui-button:hover, .venues-ui .venues-ui-button--active {
  background-color: #f0f0f0;
  color: #0F1621;
}
@keyframes fade {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
.venues-ui__drawings .drawings {
  position: absolute;
  top: 0;
  right: 45px;
  display: none;
  opacity: 0;
  border-radius: 5px;
  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);
}
.venues-ui__drawings .drawings--open {
  display: block;
  opacity: 1;
  animation: fade 1s;
}
.venues-ui__drawings .drawings .venues-ui-button {
  width: auto;
  padding: 0 10px;
}
.venues-ui__drawings .drawings .venues-ui-button:first-of-type {
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
}
.venues-ui__drawings .drawings .venues-ui-button:last-of-type {
  border-bottom-left-radius: 5px;
  border-bottom-right-radius: 5px;
}
.venues-ui__drawings .trigger {
  border-radius: 5px;
  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);
}
.venues-ui__drawings .trigger .arrow {
  transform: rotate(0);
  transition: 0.4s;
}
.venues-ui__drawings .trigger.venues-ui-button--active .arrow {
  transform: rotate(90deg);
  transition: 0.4s;
}
.venues-ui__levels {
  border-radius: 5px;
  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);
}
.venues-ui__levels .levels {
  overflow: hidden;
}
.venues-ui__levels .venues-ui-button--up + .levels .venues-ui-button {
  border-radius: 0;
}
.venues-ui__levels .venues-ui-button:first-of-type {
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
}
.venues-ui__levels .venues-ui-button:last-of-type {
  border-bottom-left-radius: 5px;
  border-bottom-right-radius: 5px;
}
.venues-ui__levels .venues-ui-button[disabled=disabled] .arrow {
  opacity: 0.5;
}
.venues-ui__directory {
  position: absolute;
  top: 10px;
  right: 60px;
  bottom: calc(100% - 45px);
  width: 350px;
  overflow: hidden;
  background: white;
  border-radius: 5px;
  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);
}
.venues-ui__directory.active {
  bottom: 10px;
}
.venues-ui__directory .directory__list {
  top: 80px;
  bottom: 20px;
  position: absolute;
  overflow-y: scroll;
  right: 10px;
  left: 10px;
  font-size: 12px;
}
.venues-ui__directory .directory__list svg {
  width: 25px;
  height: 25px;
}
.venues-ui__directory .directory__heading {
  margin: 8px;
  font-size: 15px;
  font-weight: normal;
  cursor: pointer;
}
.venues-ui__directory .directory__input {
  margin: 10px;
}
.venues-ui__directory .directory__input input {
  width: 100%;
  padding: 5px 0;
}
.venues-ui__directory .directory__trigger {
  position: absolute;
  right: 10px;
  top: 15px;
  width: 10px;
  height: 10px;
}
.venues-ui__directory .directory__trigger .arrow {
  transform: rotate(0);
  transition: 0.4s;
}
.venues-ui__directory .directory__trigger--active .arrow {
  transform: rotate(-180deg);
  transition: 0.4s;
}`),e.Drawing=pd,e.Geometry=_p,e.Level=oy,e.Provider=Cy,e.Route=g_,e.Service=T_,e.Service2=v_,e.Venue=t0,e.ui=A_,Object.defineProperty(e,"__esModule",{value:!0}),e}({})}).call(self);const H$1=H,Map$1=({latitude:e,longitude:r})=>{const n=reactExports.useRef(null),o=reactExports.useRef(null),s=reactExports.useRef(null),[l,h]=reactExports.useState(!1),[d,y]=reactExports.useState(null),g="-2g-PjnOVpx7sQF1dOHsMSpYriM1AqbPsapyYB-cSv8";return reactExports.useEffect(()=>{if(setTimeout(()=>{h(!0)},1e3),l)try{v(s.current,o.current,{lat:e,lng:r},{lat:e,lng:r})}catch(w){y(w)}function v(w,I,V,q){function De(ga){I.addObjects([new H$1.map.Marker(V,{icon:m("black")})])}const _n=w.getRoutingService(null,8),ha={origin:`${V.lat},${V.lng}`,destination:`${q.lat},${q.lng}`,transportMode:"car",return:"polyline"};_n.calculateRoute(ha,De,console.error)}function m(w){const I=`<svg width="20" height="20" version="1.1" xmlns="http://www.w3.org/2000/svg">
        <g id="marker">
          <circle cx="10" cy="10" r="7" fill="${w}" stroke="${w}" stroke-width="4" />
          <circle cx="10" cy="10" r="4" fill="white" />
          <polygon points="10,3 6,14 14,14" fill="red" />
        </g>
      </svg>`;return new H$1.map.Icon(I,{anchor:{x:10,y:10}})}if(!o.current){s.current=new H$1.service.Platform({apiKey:g});const w=s.current.getRasterTileService({queryParams:{style:"explore.day",size:512}}),I=new H$1.service.rasterTile.Provider(w),V=new H$1.map.layer.TileLayer(I),q=new H$1.Map(n.current,V,{pixelRatio:window.devicePixelRatio,center:{lat:e,lng:r},zoom:14});new H$1.mapevents.Behavior(new H$1.mapevents.MapEvents(q)),o.current=q}},[g,l,e,r]),d?jsxRuntimeExports.jsx("div",{children:"Something went wrong. Please try again later."}):jsxRuntimeExports.jsx("div",{style:{width:"100%",height:"300px"},ref:n})},ReportModal=({showModal:e,handleClose:r,handleReport:n,postToReport:o})=>{const[s,l]=reactExports.useState(""),[h,d]=reactExports.useState(""),y=()=>{s.trim()!==""&&(n(o,{reason:s,description:h}),r())};return jsxRuntimeExports.jsxs(Modal,{show:e,onHide:r,children:[jsxRuntimeExports.jsx(Modal.Header,{closeButton:!0,children:jsxRuntimeExports.jsx(Modal.Title,{children:"Report Post"})}),jsxRuntimeExports.jsx(Modal.Body,{children:jsxRuntimeExports.jsxs(BootstrapForm,{children:[jsxRuntimeExports.jsxs(BootstrapForm.Group,{controlId:"reason",children:[jsxRuntimeExports.jsx(BootstrapForm.Label,{children:"Reason for Reporting"}),jsxRuntimeExports.jsx(BootstrapForm.Control,{type:"text",placeholder:"Enter reason",value:s,onChange:g=>l(g.target.value)})]}),jsxRuntimeExports.jsxs(BootstrapForm.Group,{controlId:"description",children:[jsxRuntimeExports.jsx(BootstrapForm.Label,{children:"Description (optional)"}),jsxRuntimeExports.jsx(BootstrapForm.Control,{as:"textarea",rows:3,placeholder:"Enter additional details",value:h,onChange:g=>d(g.target.value)})]})]})}),jsxRuntimeExports.jsxs(Modal.Footer,{children:[jsxRuntimeExports.jsx(Button,{variant:"secondary",onClick:r,children:"Close"}),jsxRuntimeExports.jsx(Button,{variant:"primary",onClick:y,disabled:!s.trim(),children:"Submit Report"})]})]})},PostDetailScreen=()=>{var Wy,Iy;const e="https://nahalasm.shop/UserProfileImages/",{userInfo:r}=useSelector(vy=>vy.userAuth),{postId:n}=useParams(),[o,s]=reactExports.useState(0),[l,h]=reactExports.useState(!1),[d,y]=reactExports.useState({}),[g,v]=reactExports.useState(null),[m,w]=reactExports.useState(null),[I,V]=reactExports.useState(!1),[q,De]=reactExports.useState(!1),_n=(Wy=d==null?void 0:d.stores)!=null&&Wy.profileImageName?d.stores.profileImageName:e+"defaultImage.jpeg",ha=useNavigate(),[ga]=useGetPostByIdMutation(),[_o]=useRemovePostMutation(),[_l]=useReportPostMutation();reactExports.useEffect(()=>{(async()=>{try{const Ty=await ga(n);y(Ty.data);const Vy=Ty.data.reports.some(a0=>a0.reporter===r.id);De(Vy)}catch(Ty){console.error("Error fetching post details:",Ty),Q.error(Ty.data.message)}})()},[n,ga]);const wc=vy=>{s(vy)},_h=vy=>{var Vy,a0,zy;const Ty=vy==="next"?(o+1)%(((Vy=d==null?void 0:d.images)==null?void 0:Vy.length)||1):(o-1+(((a0=d==null?void 0:d.images)==null?void 0:a0.length)||1))%(((zy=d==null?void 0:d.images)==null?void 0:zy.length)||1);s(Ty)},_p=(d==null?void 0:d.stores)&&(d==null?void 0:d.stores._id)===r.id,pd=()=>{const vy={profileImage:{src:_n,alt:"Profile"},artistName:d==null?void 0:d.stores.name};return _p?jsxRuntimeExports.jsxs("div",{className:"artist-info",onClick:()=>ha("/profile"),children:[jsxRuntimeExports.jsx("img",{...vy.profileImage}),jsxRuntimeExports.jsx("h3",{children:vy.artistName})]}):jsxRuntimeExports.jsxs("div",{className:"artist-info",children:[jsxRuntimeExports.jsx("img",{...vy.profileImage,onClick:()=>ha(`/profile/${d==null?void 0:d.stores._id}`)}),jsxRuntimeExports.jsx("h3",{style:{marginRight:"60px"},onClick:()=>ha(`/profile/${d==null?void 0:d.stores._id}`),children:vy.artistName})]})},oy=()=>_p?jsxRuntimeExports.jsxs("div",{className:"button-container",children:[jsxRuntimeExports.jsx("button",{className:"edit-removeButton",onClick:()=>jy(d._id),children:"Edit Post"}),jsxRuntimeExports.jsx(Button$1,{className:"edit-removeButton removeButton",colorScheme:"red",onClick:()=>wy(d._id),children:"Remove"})]}):jsxRuntimeExports.jsxs("div",{className:"button-container text-center",children:[jsxRuntimeExports.jsx(ChatButton,{userId:d==null?void 0:d.stores._id}),jsxRuntimeExports.jsx("button",{className:"followButton removeButton",style:{color:"white",backgroundColor:"red",fontSize:16,fontFamily:"Roboto",fontWeight:"700",padding:"8px 16px",border:"none",borderRadius:"4px",cursor:"pointer"},onClick:()=>q?null:ny(d._id),children:q?"Reported":"Report"})]}),ny=async vy=>{V(!0),w(vy)},fy=async(vy,Ty)=>{try{if(!vy){console.error("postId is not available");return}const Vy=await _l({postId:vy,data:Ty});Vy.data.message==="Report submitted successfully"?(Q.success("Post reported successfully!"),V(!1),De(!0)):(console.error("Error reporting post:",Vy),Q.error("Failed to report post")),w(null)}catch(Vy){console.error("Error reporting post:",Vy),Q.error("Failed to report post")}},wy=async vy=>{v(vy),h(!0)},cy=async()=>{var vy;try{const Ty=String(g),Vy=await _o(Ty);Vy.data.status==="success"?(Q.warning("Post removed successfully"),ha("/")):(console.error("Error Removing Post: ",Vy),Q.error("Failed to Remove Post"))}catch(Ty){console.error("Error removing post:",Ty),Q.error(((vy=Ty==null?void 0:Ty.data)==null?void 0:vy.message)||"Failed to remove post")}finally{h(!1),v(null)}},Gy=()=>{h(!1),v(null)},jy=vy=>{ha(`/updatePost/${vy}`)};return jsxRuntimeExports.jsxs(ChakraProvider,{children:[jsxRuntimeExports.jsxs(Container,{children:[jsxRuntimeExports.jsxs(Row,{children:[d&&d.images&&jsxRuntimeExports.jsx(Col,{md:8,children:jsxRuntimeExports.jsxs("div",{className:"image-section pt-5",children:[jsxRuntimeExports.jsxs("div",{className:"large-image-container",children:[jsxRuntimeExports.jsx("img",{src:(Iy=d.images[o])==null?void 0:Iy.url,alt:"Large",className:"large-image"}),jsxRuntimeExports.jsxs("div",{className:"arrow-icons",children:[jsxRuntimeExports.jsx(FaArrowLeft,{onClick:()=>_h("prev")}),jsxRuntimeExports.jsx(FaArrowRight,{onClick:()=>_h("next")})]})]}),jsxRuntimeExports.jsx("div",{className:"small-images d-flex",children:d.images&&d.images.map((vy,Ty)=>jsxRuntimeExports.jsx("img",{src:vy==null?void 0:vy.url,alt:`Small ${Ty}`,onClick:()=>wc(Ty),className:Ty===o?"selected":""},Ty))})]})}),d&&(d==null?void 0:d.stores)&&jsxRuntimeExports.jsx(Col,{md:4,children:jsxRuntimeExports.jsxs("div",{className:"details-section pt-5",children:[jsxRuntimeExports.jsxs("div",{className:"product-details-box mb-3",children:[jsxRuntimeExports.jsx("h2",{children:d.title}),jsxRuntimeExports.jsx("p",{children:d.description})]}),jsxRuntimeExports.jsxs("div",{className:"artist-details-box mb-3",children:[jsxRuntimeExports.jsx("div",{children:pd()}),jsxRuntimeExports.jsx("div",{className:"rem-editButton",children:oy()})]}),jsxRuntimeExports.jsxs("div",{className:"location-box mb-3",children:[jsxRuntimeExports.jsx("h5",{children:"Posted from:"}),jsxRuntimeExports.jsx("div",{className:"address-info",children:jsxRuntimeExports.jsx("p",{children:d.address})}),jsxRuntimeExports.jsx("div",{className:"map-container",children:d.latitude&&d.longitude?jsxRuntimeExports.jsx(Map$1,{latitude:d.latitude,longitude:d.longitude}):jsxRuntimeExports.jsx("p",{children:"Location not provided"})})]})]})})]}),l&&jsxRuntimeExports.jsx(ConfirmationDialog,{onConfirm:cy,onCancel:Gy})]}),I&&jsxRuntimeExports.jsx(ReportModal,{showModal:I,handleClose:()=>{V(!1)},handleReport:fy,postToReport:m})]})};export{PostDetailScreen as default};
